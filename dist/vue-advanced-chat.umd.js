(function(aa,r){typeof exports=="object"&&typeof module!="undefined"?r(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],r):(aa=typeof globalThis!="undefined"?globalThis:aa||self,r(aa["vue-advanced-chat"]={},aa.Vue))})(this,function(aa,r){"use strict";var Ye=(e,t)=>{const a=e.__vccOpts||e;for(const[n,d]of t)a[n]=d;return a};const _i={name:"AppLoader",props:{show:{type:Boolean,default:!1},infinite:{type:Boolean,default:!1}}},pi=r.createElementVNode("div",{id:"vac-circle"},null,-1);function vi(e,t,a,n,d,s){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-fade-spinner",appear:""},{default:r.withCtx(()=>[a.show?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-loader-wrapper",{"vac-container-center":!a.infinite,"vac-container-top":a.infinite}])},[r.renderSlot(e.$slots,"spinner-icon",r.normalizeProps(r.guardReactiveProps({show:a.show,infinite:a.infinite})),()=>[pi])],2)):r.createCommentVNode("",!0)]),_:3})}var Rr=Ye(_i,[["render",vi]]);const gi={name:"SvgIcon",props:{name:{type:String,default:null},param:{type:String,default:null}},data(){return{svgItem:{search:{path:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"},add:{path:"M17,13H13V17H11V13H7V11H11V7H13V11H17M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"},toggle:{path:"M5,13L9,17L7.6,18.42L1.18,12L7.6,5.58L9,7L5,11H21V13H5M21,6V8H11V6H21M21,16V18H11V16H21Z"},menu:{path:"M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z"},close:{path:"M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z"},file:{path:"M14,17H7V15H14M17,13H7V11H17M17,9H7V7H17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z"},paperclip:{path:"M16.5,6V17.5A4,4 0 0,1 12.5,21.5A4,4 0 0,1 8.5,17.5V5A2.5,2.5 0 0,1 11,2.5A2.5,2.5 0 0,1 13.5,5V15.5A1,1 0 0,1 12.5,16.5A1,1 0 0,1 11.5,15.5V6H10V15.5A2.5,2.5 0 0,0 12.5,18A2.5,2.5 0 0,0 15,15.5V5A4,4 0 0,0 11,1A4,4 0 0,0 7,5V17.5A5.5,5.5 0 0,0 12.5,23A5.5,5.5 0 0,0 18,17.5V6H16.5Z"},"close-outline":{path:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},send:{path:"M2,21L23,12L2,3V10L17,12L2,14V21Z"},emoji:{path:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"},document:{path:"M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"},pencil:{path:"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"},checkmark:{path:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"},"double-checkmark":{path:"M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z"},eye:{path:"M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"},dropdown:{path:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"},deleted:{path:"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12C4,13.85 4.63,15.55 5.68,16.91L16.91,5.68C15.55,4.63 13.85,4 12,4M12,20A8,8 0 0,0 20,12C20,10.15 19.37,8.45 18.32,7.09L7.09,18.32C8.45,19.37 10.15,20 12,20Z"},microphone:{size:"large",path:"M432.8,216.4v39.2c0,45.2-15.3,84.3-45.2,118.4c-29.8,33.2-67.3,52.8-111.6,57.9v40.9h78.4c5.1,0,10.2,1.7,13.6,6c4.3,4.3,6,8.5,6,13.6c0,5.1-1.7,10.2-6,13.6c-4.3,4.3-8.5,6-13.6,6H157.6c-5.1,0-10.2-1.7-13.6-6c-4.3-4.3-6-8.5-6-13.6c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6H236v-40.9c-44.3-5.1-81.8-23.9-111.6-57.9s-45.2-73.3-45.2-118.4v-39.2c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6s10.2,1.7,13.6,6c4.3,4.3,6,8.5,6,13.6v39.2c0,37.5,13.6,70.7,40,97.1s59.6,40,97.1,40s70.7-13.6,97.1-40c26.4-26.4,40-59.6,40-97.1v-39.2c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6c5.1,0,10.2,1.7,13.6,6C430.2,206.2,432.8,211.3,432.8,216.4z M353.5,98v157.6c0,27.3-9.4,50.3-29,69c-19.6,19.6-42.6,29-69,29s-50.3-9.4-69-29c-19.6-19.6-29-42.6-29-69V98c0-27.3,9.4-50.3,29-69c19.6-19.6,42.6-29,69-29s50.3,9.4,69,29C344.2,47.7,353.5,71.6,353.5,98z"},"audio-play":{size:"medium",path:"M43.331,21.237L7.233,0.397c-0.917-0.529-2.044-0.529-2.96,0c-0.916,0.528-1.48,1.505-1.48,2.563v41.684   c0,1.058,0.564,2.035,1.48,2.563c0.458,0.268,0.969,0.397,1.48,0.397c0.511,0,1.022-0.133,1.48-0.397l36.098-20.84   c0.918-0.529,1.479-1.506,1.479-2.564S44.247,21.767,43.331,21.237z"},"audio-pause":{size:"medium",path:"M17.991,40.976c0,3.662-2.969,6.631-6.631,6.631l0,0c-3.662,0-6.631-2.969-6.631-6.631V6.631C4.729,2.969,7.698,0,11.36,0l0,0c3.662,0,6.631,2.969,6.631,6.631V40.976z",path2:"M42.877,40.976c0,3.662-2.969,6.631-6.631,6.631l0,0c-3.662,0-6.631-2.969-6.631-6.631V6.631C29.616,2.969,32.585,0,36.246,0l0,0c3.662,0,6.631,2.969,6.631,6.631V40.976z"}}}},computed:{svgId(){const e=this.param?"-"+this.param:"";return`vac-icon-${this.name}${e}`},size(){const e=this.svgItem[this.name];return e.size==="large"?512:e.size==="medium"?48:24}}},bi=["viewBox"],yi=["id","d"],xi=["id","d"];function wi(e,t,a,n,d,s){return r.openBlock(),r.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",width:"24",height:"24",viewBox:`0 0 ${s.size} ${s.size}`},[r.createElementVNode("path",{id:s.svgId,d:d.svgItem[a.name].path},null,8,yi),d.svgItem[a.name].path2?(r.openBlock(),r.createElementBlock("path",{key:0,id:s.svgId,d:d.svgItem[a.name].path2},null,8,xi)):r.createCommentVNode("",!0)],8,bi)}var mt=Ye(gi,[["render",wi]]);const ki={name:"RoomsSearch",components:{SvgIcon:mt},props:{textMessages:{type:Object,required:!0},showSearch:{type:Boolean,required:!0},showAddRoom:{type:Boolean,required:!0},rooms:{type:Array,required:!0},loadingRooms:{type:Boolean,required:!0}},emits:["search-room","add-room"],computed:{showSearchBar(){return this.showSearch||this.showAddRoom}}},Si={key:0,class:"vac-icon-search"},Ei=["placeholder"];function Mi(e,t,a,n,d,s){const k=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",{class:r.normalizeClass({"vac-box-search":s.showSearchBar,"vac-box-empty":!s.showSearchBar})},[a.showSearch?(r.openBlock(),r.createElementBlock(r.Fragment,{key:0},[!a.loadingRooms&&a.rooms.length?(r.openBlock(),r.createElementBlock("div",Si,[r.renderSlot(e.$slots,"search-icon",{},()=>[r.createVNode(k,{name:"search"})])])):r.createCommentVNode("",!0),!a.loadingRooms&&a.rooms.length?(r.openBlock(),r.createElementBlock("input",{key:1,type:"search",placeholder:a.textMessages.SEARCH,autocomplete:"off",class:"vac-input",onInput:t[0]||(t[0]=C=>e.$emit("search-room",C))},null,40,Ei)):r.createCommentVNode("",!0)],64)):r.createCommentVNode("",!0),a.showAddRoom?(r.openBlock(),r.createElementBlock("div",{key:1,class:"vac-svg-button vac-add-icon",onClick:t[1]||(t[1]=C=>e.$emit("add-room"))},[r.renderSlot(e.$slots,"add-icon",{},()=>[r.createVNode(k,{name:"add"})])])):r.createCommentVNode("",!0)],2)}var Ri=Ye(ki,[["render",Mi]]),ht={},Aa={};Aa.__esModule=!0,Aa.inherits=Ti;function Ti(e,t){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=Object.create(e.prototype);for(var d in a)n[d]=a[d];return n.constructor=t,t.prototype=n,t}var qa={};qa.__esModule=!0;var Ai=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tt={defaultProtocol:"http",events:null,format:cs,formatHref:cs,nl2br:!1,tagName:"a",target:Ci,validate:!0,ignoreTags:[],attributes:null,className:"linkified"};qa.defaults=Tt,qa.Options=ls,qa.contains=Bi;function ls(e){e=e||{},this.defaultProtocol=e.hasOwnProperty("defaultProtocol")?e.defaultProtocol:Tt.defaultProtocol,this.events=e.hasOwnProperty("events")?e.events:Tt.events,this.format=e.hasOwnProperty("format")?e.format:Tt.format,this.formatHref=e.hasOwnProperty("formatHref")?e.formatHref:Tt.formatHref,this.nl2br=e.hasOwnProperty("nl2br")?e.nl2br:Tt.nl2br,this.tagName=e.hasOwnProperty("tagName")?e.tagName:Tt.tagName,this.target=e.hasOwnProperty("target")?e.target:Tt.target,this.validate=e.hasOwnProperty("validate")?e.validate:Tt.validate,this.ignoreTags=[],this.attributes=e.attributes||e.linkAttributes||Tt.attributes,this.className=e.hasOwnProperty("className")?e.className:e.linkClass||Tt.className;for(var t=e.hasOwnProperty("ignoreTags")?e.ignoreTags:Tt.ignoreTags,a=0;a<t.length;a++)this.ignoreTags.push(t[a].toUpperCase())}ls.prototype={resolve:function(t){var a=t.toHref(this.defaultProtocol);return{formatted:this.get("format",t.toString(),t),formattedHref:this.get("formatHref",a,t),tagName:this.get("tagName",a,t),className:this.get("className",a,t),target:this.get("target",a,t),events:this.getObject("events",a,t),attributes:this.getObject("attributes",a,t)}},check:function(t){return this.get("validate",t.toString(),t)},get:function(t,a,n){var d=void 0,s=this[t];if(!s)return s;switch(typeof s=="undefined"?"undefined":Ai(s)){case"function":return s(a,n.type);case"object":return d=s.hasOwnProperty(n.type)?s[n.type]:Tt[t],typeof d=="function"?d(a,n.type):d}return s},getObject:function(t,a,n){var d=this[t];return typeof d=="function"?d(a,n.type):d}};function Bi(e,t){for(var a=0;a<e.length;a++)if(e[a]===t)return!0;return!1}function cs(e){return e}function Ci(e,t){return t==="url"?"_blank":null}var Yt={},$t={};$t.__esModule=!0,$t.stateify=$t.TokenState=$t.CharacterState=void 0;var ds=Aa;function mo(){return function(e){this.j=[],this.T=e||null}}var ho=mo();ho.prototype={defaultTransition:!1,on:function(t,a){if(t instanceof Array){for(var n=0;n<t.length;n++)this.j.push([t[n],a]);return this}return this.j.push([t,a]),this},next:function(t){for(var a=0;a<this.j.length;a++){var n=this.j[a],d=n[0],s=n[1];if(this.test(t,d))return s}return this.defaultTransition},accepts:function(){return!!this.T},test:function(t,a){return t===a},emit:function(){return this.T}};var uo=(0,ds.inherits)(ho,mo(),{test:function(t,a){return t===a||a instanceof RegExp&&a.test(t)}}),Oi=(0,ds.inherits)(ho,mo(),{jump:function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=this.next(new t(""));return n===this.defaultTransition?(n=new this.constructor(a),this.on(t,n)):a&&(n.T=a),n},test:function(t,a){return t instanceof a}});function Ni(e,t,a,n){for(var d=0,s=e.length,k=t,C=[],L=void 0;d<s&&(L=k.next(e[d]));)k=L,d++;if(d>=s)return[];for(;d<s-1;)L=new uo(n),C.push(L),k.on(e[d],L),k=L,d++;return L=new uo(a),C.push(L),k.on(e[s-1],L),C}$t.CharacterState=uo,$t.TokenState=Oi,$t.stateify=Ni;var we={},Tr={};Tr.__esModule=!0;function Li(){return function(e){e&&(this.v=e)}}Tr.createTokenClass=Li,we.__esModule=!0,we.AMPERSAND=we.CLOSEPAREN=we.CLOSEANGLEBRACKET=we.CLOSEBRACKET=we.CLOSEBRACE=we.OPENPAREN=we.OPENANGLEBRACKET=we.OPENBRACKET=we.OPENBRACE=we.WS=we.TLD=we.SYM=we.UNDERSCORE=we.SLASH=we.MAILTO=we.PROTOCOL=we.QUERY=we.POUND=we.PLUS=we.NUM=we.NL=we.LOCALHOST=we.PUNCTUATION=we.DOT=we.COLON=we.AT=we.DOMAIN=we.Base=void 0;var ms=Tr,Ii=Aa,fo=(0,ms.createTokenClass)();fo.prototype={toString:function(){return this.v+""}};function Xe(e){var t=e?{v:e}:{};return(0,Ii.inherits)(fo,(0,ms.createTokenClass)(),t)}var ji=Xe(),Vi=Xe("@"),Hi=Xe(":"),Pi=Xe("."),Fi=Xe(),Ui=Xe(),Di=Xe(`
`),zi=Xe(),qi=Xe("+"),Yi=Xe("#"),Xi=Xe(),Gi=Xe("mailto:"),Ki=Xe("?"),Zi=Xe("/"),Wi=Xe("_"),Qi=Xe(),Ji=Xe(),$i=Xe(),el=Xe("{"),tl=Xe("["),al=Xe("<"),rl=Xe("("),ol=Xe("}"),sl=Xe("]"),nl=Xe(">"),il=Xe(")"),ll=Xe("&");we.Base=fo,we.DOMAIN=ji,we.AT=Vi,we.COLON=Hi,we.DOT=Pi,we.PUNCTUATION=Fi,we.LOCALHOST=Ui,we.NL=Di,we.NUM=zi,we.PLUS=qi,we.POUND=Yi,we.QUERY=Ki,we.PROTOCOL=Xi,we.MAILTO=Gi,we.SLASH=Zi,we.UNDERSCORE=Wi,we.SYM=Qi,we.TLD=Ji,we.WS=$i,we.OPENBRACE=el,we.OPENBRACKET=tl,we.OPENANGLEBRACKET=al,we.OPENPAREN=rl,we.CLOSEBRACE=ol,we.CLOSEBRACKET=sl,we.CLOSEANGLEBRACKET=nl,we.CLOSEPAREN=il,we.AMPERSAND=ll,Yt.__esModule=!0,Yt.start=Yt.run=Yt.TOKENS=Yt.State=void 0;var ra=$t,Le=we,cl=dl(Le);function dl(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}var hs="aaa|aarp|abarth|abb|abbott|abbvie|abc|able|abogado|abudhabi|ac|academy|accenture|accountant|accountants|aco|active|actor|ad|adac|ads|adult|ae|aeg|aero|aetna|af|afamilycompany|afl|africa|ag|agakhan|agency|ai|aig|aigo|airbus|airforce|airtel|akdn|al|alfaromeo|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|am|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|ao|aol|apartments|app|apple|aq|aquarelle|ar|arab|aramco|archi|army|arpa|art|arte|as|asda|asia|associates|at|athleta|attorney|au|auction|audi|audible|audio|auspost|author|auto|autos|avianca|aw|aws|ax|axa|az|azure|ba|baby|baidu|banamex|bananarepublic|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bb|bbc|bbt|bbva|bcg|bcn|bd|be|beats|beauty|beer|bentley|berlin|best|bestbuy|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|blanco|blockbuster|blog|bloomberg|blue|bm|bms|bmw|bn|bnl|bnpparibas|bo|boats|boehringer|bofa|bom|bond|boo|book|booking|boots|bosch|bostik|boston|bot|boutique|box|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|budapest|bugatti|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|calvinklein|cam|camera|camp|cancerresearch|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|cartier|casa|case|caseih|cash|casino|cat|catering|catholic|cba|cbn|cbre|cbs|cc|cd|ceb|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|chase|chat|cheap|chintai|chloe|christmas|chrome|chrysler|church|ci|cipriani|circle|cisco|citadel|citi|citic|city|cityeats|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|comcast|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cookingchannel|cool|coop|corsica|country|coupon|coupons|courses|cr|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|csc|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|data|date|dating|datsun|day|dclk|dds|de|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dj|dk|dm|dnp|do|docs|doctor|dodge|dog|doha|domains|dot|download|drive|dtv|dubai|duck|dunlop|duns|dupont|durban|dvag|dvr|dz|earth|eat|ec|eco|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epost|epson|equipment|er|ericsson|erni|es|esq|estate|esurance|et|etisalat|eu|eurovision|eus|events|everbank|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fi|fiat|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|flir|florist|flowers|fly|fm|fo|foo|food|foodnetwork|football|ford|forex|forsale|forum|foundation|fox|fr|free|fresenius|frl|frogans|frontdoor|frontier|ftr|fujitsu|fujixerox|fun|fund|furniture|futbol|fyi|ga|gal|gallery|gallo|gallup|game|games|gap|garden|gb|gbiz|gd|gdn|ge|gea|gent|genting|george|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glade|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|godaddy|gold|goldpoint|golf|goo|goodhands|goodyear|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|grocery|group|gs|gt|gu|guardian|gucci|guge|guide|guitars|guru|gw|gy|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hgtv|hiphop|hisamitsu|hitachi|hiv|hk|hkt|hm|hn|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|honeywell|horse|hospital|host|hosting|hot|hoteles|hotels|hotmail|house|how|hr|hsbc|ht|htc|hu|hughes|hyatt|hyundai|ibm|icbc|ice|icu|id|ie|ieee|ifm|ikano|il|im|imamat|imdb|immo|immobilien|in|industries|infiniti|info|ing|ink|institute|insurance|insure|int|intel|international|intuit|investments|io|ipiranga|iq|ir|irish|is|iselect|ismaili|ist|istanbul|it|itau|itv|iveco|iwc|jaguar|java|jcb|jcp|je|jeep|jetzt|jewelry|jio|jlc|jll|jm|jmp|jnj|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|juniper|kaufen|kddi|ke|kerryhotels|kerrylogistics|kerryproperties|kfh|kg|kh|ki|kia|kim|kinder|kindle|kitchen|kiwi|km|kn|koeln|komatsu|kosher|kp|kpmg|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|ladbrokes|lamborghini|lamer|lancaster|lancia|lancome|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|li|liaison|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|linde|link|lipsy|live|living|lixil|lk|loan|loans|locker|locus|loft|lol|london|lotte|lotto|love|lpl|lplfinancial|lr|ls|lt|ltd|ltda|lu|lundbeck|lupin|luxe|luxury|lv|ly|ma|macys|madrid|maif|maison|makeup|man|management|mango|map|market|marketing|markets|marriott|marshalls|maserati|mattel|mba|mc|mckinsey|md|me|med|media|meet|melbourne|meme|memorial|men|menu|meo|merckmsd|metlife|mg|mh|miami|microsoft|mil|mini|mint|mit|mitsubishi|mk|ml|mlb|mls|mm|mma|mn|mo|mobi|mobile|mobily|moda|moe|moi|mom|monash|money|monster|mopar|mormon|mortgage|moscow|moto|motorcycles|mov|movie|movistar|mp|mq|mr|ms|msd|mt|mtn|mtr|mu|museum|mutual|mv|mw|mx|my|mz|na|nab|nadex|nagoya|name|nationwide|natura|navy|nba|nc|ne|nec|net|netbank|netflix|network|neustar|new|newholland|news|next|nextdirect|nexus|nf|nfl|ng|ngo|nhk|ni|nico|nike|nikon|ninja|nissan|nissay|nl|no|nokia|northwesternmutual|norton|now|nowruz|nowtv|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|observer|off|office|okinawa|olayan|olayangroup|oldnavy|ollo|om|omega|one|ong|onl|online|onyourside|ooo|open|oracle|orange|org|organic|origins|osaka|otsuka|ott|ovh|pa|page|panasonic|panerai|paris|pars|partners|parts|party|passagens|pay|pccw|pe|pet|pf|pfizer|pg|ph|pharmacy|phd|philips|phone|photo|photography|photos|physio|piaget|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pnc|pohl|poker|politie|porn|post|pr|pramerica|praxi|press|prime|pro|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|qvc|racing|radio|raid|re|read|realestate|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|rightathome|ril|rio|rip|rmit|ro|rocher|rocks|rodeo|rogers|room|rs|rsvp|ru|rugby|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sapo|sarl|sas|save|saxo|sb|sbi|sbs|sc|sca|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scjohnson|scor|scot|sd|se|search|seat|secure|security|seek|select|sener|services|ses|seven|sew|sex|sexy|sfr|sg|sh|shangrila|sharp|shaw|shell|shia|shiksha|shoes|shop|shopping|shouji|show|showtime|shriram|si|silk|sina|singles|site|sj|sk|ski|skin|sky|skype|sl|sling|sm|smart|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|space|spiegel|spot|spreadbetting|sr|srl|srt|st|stada|staples|star|starhub|statebank|statefarm|statoil|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiftcover|swiss|sx|sy|sydney|symantec|systems|sz|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|tdk|team|tech|technology|tel|telecity|telefonica|temasek|tennis|teva|tf|tg|th|thd|theater|theatre|tiaa|tickets|tienda|tiffany|tips|tires|tirol|tj|tjmaxx|tjx|tk|tkmaxx|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tr|trade|trading|training|travel|travelchannel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubank|ubs|uconnect|ug|uk|unicom|university|uno|uol|ups|us|uy|uz|va|vacations|vana|vanguard|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|vista|vistaprint|viva|vivo|vlaanderen|vn|vodka|volkswagen|volvo|vote|voting|voto|voyage|vu|vuelos|wales|walmart|walter|wang|wanggou|warman|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|ws|wtc|wtf|xbox|xerox|xfinity|xihuan|xin|xn--11b4c3d|xn--1ck2e1b|xn--1qqw23a|xn--2scrj9c|xn--30rr7y|xn--3bst00m|xn--3ds443g|xn--3e0b707e|xn--3hcrj9c|xn--3oq18vl8pn36a|xn--3pxu8k|xn--42c2d9a|xn--45br5cyl|xn--45brj9c|xn--45q11c|xn--4gbrim|xn--54b7fta0cc|xn--55qw42g|xn--55qx5d|xn--5su34j936bgsg|xn--5tzm5g|xn--6frz82g|xn--6qq986b3xl|xn--80adxhks|xn--80ao21a|xn--80aqecdr1a|xn--80asehdb|xn--80aswg|xn--8y0a063a|xn--90a3ac|xn--90ae|xn--90ais|xn--9dbq2a|xn--9et52u|xn--9krt00a|xn--b4w605ferd|xn--bck1b9a5dre4c|xn--c1avg|xn--c2br7g|xn--cck2b3b|xn--cg4bki|xn--clchc0ea0b2g2a9gcd|xn--czr694b|xn--czrs0t|xn--czru2d|xn--d1acj3b|xn--d1alf|xn--e1a4c|xn--eckvdtc9d|xn--efvy88h|xn--estv75g|xn--fct429k|xn--fhbei|xn--fiq228c5hs|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--fjq720a|xn--flw351e|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--fzys8d69uvgm|xn--g2xx48c|xn--gckr3f0f|xn--gecrj9c|xn--gk3at1e|xn--h2breg3eve|xn--h2brj9c|xn--h2brj9c8c|xn--hxt814e|xn--i1b6b1a6a2e|xn--imr513n|xn--io0a7i|xn--j1aef|xn--j1amh|xn--j6w193g|xn--jlq61u9w7b|xn--jvr189m|xn--kcrx77d1x4a|xn--kprw13d|xn--kpry57d|xn--kpu716f|xn--kput3i|xn--l1acc|xn--lgbbat1ad8j|xn--mgb9awbf|xn--mgba3a3ejt|xn--mgba3a4f16a|xn--mgba7c0bbn0a|xn--mgbaakc7dvf|xn--mgbaam7a8h|xn--mgbab2bd|xn--mgbai9azgqp6j|xn--mgbayh7gpa|xn--mgbb9fbpob|xn--mgbbh1a|xn--mgbbh1a71e|xn--mgbc0a9azcg|xn--mgbca7dzdo|xn--mgberp4a5d4ar|xn--mgbgu82a|xn--mgbi4ecexp|xn--mgbpl2fh|xn--mgbt3dhd|xn--mgbtx2b|xn--mgbx4cd0ab|xn--mix891f|xn--mk1bu44c|xn--mxtq1m|xn--ngbc5azd|xn--ngbe9e0a|xn--ngbrx|xn--node|xn--nqv7f|xn--nqv7fs00ema|xn--nyqy26a|xn--o3cw4h|xn--ogbpf8fl|xn--p1acf|xn--p1ai|xn--pbt977c|xn--pgbs0dh|xn--pssy2u|xn--q9jyb4c|xn--qcka1pmc|xn--qxam|xn--rhqv96g|xn--rovu88b|xn--rvc1e0am3e|xn--s9brj9c|xn--ses554g|xn--t60b56a|xn--tckwe|xn--tiq49xqyj|xn--unup4y|xn--vermgensberater-ctb|xn--vermgensberatung-pwb|xn--vhquv|xn--vuq861b|xn--w4r85el8fhu5dnra|xn--w4rs40l|xn--wgbh1c|xn--wgbl6a|xn--xhq521b|xn--xkc2al3hye2a|xn--xkc2dl3a5ee0h|xn--y9a3aq|xn--yfro4i67o|xn--ygbi2ammx|xn--zfr164b|xperia|xxx|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|you|youtube|yt|yun|za|zappos|zara|zero|zip|zippo|zm|zone|zuerich|zw".split("|"),_o="0123456789".split(""),Ar="0123456789abcdefghijklmnopqrstuvwxyz".split(""),us=[" ","\f","\r","	","\v","\xA0","\u1680","\u180E"],yt=[],ze=function(t){return new ra.CharacterState(t)},Lt=ze(),po=ze(Le.NUM),Ba=ze(Le.DOMAIN),Ya=ze(),vo=ze(Le.WS);Lt.on("@",ze(Le.AT)).on(".",ze(Le.DOT)).on("+",ze(Le.PLUS)).on("#",ze(Le.POUND)).on("?",ze(Le.QUERY)).on("/",ze(Le.SLASH)).on("_",ze(Le.UNDERSCORE)).on(":",ze(Le.COLON)).on("{",ze(Le.OPENBRACE)).on("[",ze(Le.OPENBRACKET)).on("<",ze(Le.OPENANGLEBRACKET)).on("(",ze(Le.OPENPAREN)).on("}",ze(Le.CLOSEBRACE)).on("]",ze(Le.CLOSEBRACKET)).on(">",ze(Le.CLOSEANGLEBRACKET)).on(")",ze(Le.CLOSEPAREN)).on("&",ze(Le.AMPERSAND)).on([",",";","!",'"',"'"],ze(Le.PUNCTUATION)),Lt.on(`
`,ze(Le.NL)).on(us,vo),vo.on(us,vo);for(var go=0;go<hs.length;go++){var ml=(0,ra.stateify)(hs[go],Lt,Le.TLD,Le.DOMAIN);yt.push.apply(yt,ml)}var fs=(0,ra.stateify)("file",Lt,Le.DOMAIN,Le.DOMAIN),_s=(0,ra.stateify)("ftp",Lt,Le.DOMAIN,Le.DOMAIN),ps=(0,ra.stateify)("http",Lt,Le.DOMAIN,Le.DOMAIN),vs=(0,ra.stateify)("mailto",Lt,Le.DOMAIN,Le.DOMAIN);yt.push.apply(yt,fs),yt.push.apply(yt,_s),yt.push.apply(yt,ps),yt.push.apply(yt,vs);var hl=fs.pop(),ul=_s.pop(),fl=ps.pop(),_l=vs.pop(),Br=ze(Le.DOMAIN),Cr=ze(Le.PROTOCOL),pl=ze(Le.MAILTO);ul.on("s",Br).on(":",Cr),fl.on("s",Br).on(":",Cr),yt.push(Br),hl.on(":",Cr),Br.on(":",Cr),_l.on(":",pl);var vl=(0,ra.stateify)("localhost",Lt,Le.LOCALHOST,Le.DOMAIN);yt.push.apply(yt,vl),Lt.on(_o,po),po.on("-",Ya).on(_o,po).on(Ar,Ba),Ba.on("-",Ya).on(Ar,Ba);for(var bo=0;bo<yt.length;bo++)yt[bo].on("-",Ya).on(Ar,Ba);Ya.on("-",Ya).on(_o,Ba).on(Ar,Ba),Lt.defaultTransition=ze(Le.SYM);var gl=function(t){for(var a=t.replace(/[A-Z]/g,function(M){return M.toLowerCase()}),n=t.length,d=[],s=0;s<n;){for(var k=Lt,C=null,L=0,b=null,R=-1;s<n&&(C=k.next(a[s]));)k=C,k.accepts()?(R=0,b=k):R>=0&&R++,L++,s++;if(!(R<0)){s-=R,L-=R;var h=b.emit();d.push(new h(t.substr(s-L,L)))}}return d},bl=Lt;Yt.State=ra.CharacterState,Yt.TOKENS=cl,Yt.run=gl,Yt.start=bl;var Xt={},xt={};xt.__esModule=!0,xt.URL=xt.TEXT=xt.NL=xt.EMAIL=xt.MAILTOEMAIL=xt.Base=void 0;var Ca=Tr,Xa=Aa,Ga=we;function yl(e){return e instanceof Ga.DOMAIN||e instanceof Ga.TLD}var ma=(0,Ca.createTokenClass)();ma.prototype={type:"token",isLink:!1,toString:function(){for(var t=[],a=0;a<this.v.length;a++)t.push(this.v[a].toString());return t.join("")},toHref:function(){return this.toString()},toObject:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http";return{type:this.type,value:this.toString(),href:this.toHref(t)}}};var xl=(0,Xa.inherits)(ma,(0,Ca.createTokenClass)(),{type:"email",isLink:!0}),wl=(0,Xa.inherits)(ma,(0,Ca.createTokenClass)(),{type:"email",isLink:!0,toHref:function(){return"mailto:"+this.toString()}}),kl=(0,Xa.inherits)(ma,(0,Ca.createTokenClass)(),{type:"text"}),Sl=(0,Xa.inherits)(ma,(0,Ca.createTokenClass)(),{type:"nl"}),El=(0,Xa.inherits)(ma,(0,Ca.createTokenClass)(),{type:"url",isLink:!0,toHref:function(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http",a=!1,n=!1,d=this.v,s=[],k=0;d[k]instanceof Ga.PROTOCOL;)a=!0,s.push(d[k].toString().toLowerCase()),k++;for(;d[k]instanceof Ga.SLASH;)n=!0,s.push(d[k].toString()),k++;for(;yl(d[k]);)s.push(d[k].toString().toLowerCase()),k++;for(;k<d.length;k++)s.push(d[k].toString());return s=s.join(""),a||n||(s=t+"://"+s),s},hasProtocol:function(){return this.v[0]instanceof Ga.PROTOCOL}});xt.Base=ma,xt.MAILTOEMAIL=xl,xt.EMAIL=wl,xt.NL=Sl,xt.TEXT=kl,xt.URL=El,Xt.__esModule=!0,Xt.start=Xt.run=Xt.TOKENS=Xt.State=void 0;var gs=$t,wt=xt,Ml=Rl(wt),me=we;function Rl(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}var Ie=function(t){return new gs.TokenState(t)},Or=Ie(),bs=Ie(),ys=Ie(),yo=Ie(),xs=Ie(),oa=Ie(),Nr=Ie(),Ka=Ie(wt.URL),ws=Ie(),ks=Ie(wt.URL),et=Ie(wt.URL),Za=Ie(),Wa=Ie(),Qa=Ie(),Ja=Ie(),$a=Ie(),ha=Ie(wt.URL),ua=Ie(wt.URL),fa=Ie(wt.URL),_a=Ie(wt.URL),er=Ie(),tr=Ie(),ar=Ie(),rr=Ie(),Oa=Ie(),xo=Ie(),Lr=Ie(wt.EMAIL),Ss=Ie(),Tl=Ie(wt.EMAIL),pa=Ie(wt.MAILTOEMAIL),wo=Ie(),Na=Ie(),Ir=Ie(),Es=Ie(),Al=Ie(wt.NL);Or.on(me.NL,Al).on(me.PROTOCOL,bs).on(me.MAILTO,ys).on(me.SLASH,yo),bs.on(me.SLASH,yo),yo.on(me.SLASH,xs),Or.on(me.TLD,oa).on(me.DOMAIN,oa).on(me.LOCALHOST,Ka).on(me.NUM,oa),xs.on(me.TLD,et).on(me.DOMAIN,et).on(me.NUM,et).on(me.LOCALHOST,et),oa.on(me.DOT,Nr),Oa.on(me.DOT,xo),Nr.on(me.TLD,Ka).on(me.DOMAIN,oa).on(me.NUM,oa).on(me.LOCALHOST,oa),xo.on(me.TLD,Lr).on(me.DOMAIN,Oa).on(me.NUM,Oa).on(me.LOCALHOST,Oa),Ka.on(me.DOT,Nr),Lr.on(me.DOT,xo),Ka.on(me.COLON,ws).on(me.SLASH,et),ws.on(me.NUM,ks),ks.on(me.SLASH,et),Lr.on(me.COLON,Ss),Ss.on(me.NUM,Tl);var ut=[me.DOMAIN,me.AT,me.LOCALHOST,me.NUM,me.PLUS,me.POUND,me.PROTOCOL,me.SLASH,me.TLD,me.UNDERSCORE,me.SYM,me.AMPERSAND],ft=[me.COLON,me.DOT,me.QUERY,me.PUNCTUATION,me.CLOSEBRACE,me.CLOSEBRACKET,me.CLOSEANGLEBRACKET,me.CLOSEPAREN,me.OPENBRACE,me.OPENBRACKET,me.OPENANGLEBRACKET,me.OPENPAREN];et.on(me.OPENBRACE,Wa).on(me.OPENBRACKET,Qa).on(me.OPENANGLEBRACKET,Ja).on(me.OPENPAREN,$a),Za.on(me.OPENBRACE,Wa).on(me.OPENBRACKET,Qa).on(me.OPENANGLEBRACKET,Ja).on(me.OPENPAREN,$a),Wa.on(me.CLOSEBRACE,et),Qa.on(me.CLOSEBRACKET,et),Ja.on(me.CLOSEANGLEBRACKET,et),$a.on(me.CLOSEPAREN,et),ha.on(me.CLOSEBRACE,et),ua.on(me.CLOSEBRACKET,et),fa.on(me.CLOSEANGLEBRACKET,et),_a.on(me.CLOSEPAREN,et),er.on(me.CLOSEBRACE,et),tr.on(me.CLOSEBRACKET,et),ar.on(me.CLOSEANGLEBRACKET,et),rr.on(me.CLOSEPAREN,et),Wa.on(ut,ha),Qa.on(ut,ua),Ja.on(ut,fa),$a.on(ut,_a),Wa.on(ft,er),Qa.on(ft,tr),Ja.on(ft,ar),$a.on(ft,rr),ha.on(ut,ha),ua.on(ut,ua),fa.on(ut,fa),_a.on(ut,_a),ha.on(ft,ha),ua.on(ft,ua),fa.on(ft,fa),_a.on(ft,_a),er.on(ut,ha),tr.on(ut,ua),ar.on(ut,fa),rr.on(ut,_a),er.on(ft,er),tr.on(ft,tr),ar.on(ft,ar),rr.on(ft,rr),et.on(ut,et),Za.on(ut,et),et.on(ft,Za),Za.on(ft,Za),ys.on(me.TLD,pa).on(me.DOMAIN,pa).on(me.NUM,pa).on(me.LOCALHOST,pa),pa.on(ut,pa).on(ft,wo),wo.on(ut,pa).on(ft,wo);var or=[me.DOMAIN,me.NUM,me.PLUS,me.POUND,me.QUERY,me.UNDERSCORE,me.SYM,me.AMPERSAND,me.TLD];oa.on(or,Na).on(me.AT,Ir),Ka.on(or,Na).on(me.AT,Ir),Nr.on(or,Na),Na.on(or,Na).on(me.AT,Ir).on(me.DOT,Es),Es.on(or,Na),Ir.on(me.TLD,Oa).on(me.DOMAIN,Oa).on(me.LOCALHOST,Lr);var Bl=function(t){for(var a=t.length,n=0,d=[],s=[];n<a;){for(var k=Or,C=null,L=null,b=0,R=null,h=-1;n<a&&!(C=k.next(t[n]));)s.push(t[n++]);for(;n<a&&(L=C||k.next(t[n]));)C=null,k=L,k.accepts()?(h=0,R=k):h>=0&&h++,n++,b++;if(h<0)for(var M=n-b;M<n;M++)s.push(t[M]);else{s.length>0&&(d.push(new wt.TEXT(s)),s=[]),n-=h,b-=h;var w=R.emit();d.push(new w(t.slice(n-b,n)))}}return s.length>0&&d.push(new wt.TEXT(s)),d};Xt.State=gs.TokenState,Xt.TOKENS=Ml,Xt.run=Bl,Xt.start=Or,ht.__esModule=!0,ht.tokenize=ht.test=ht.scanner=ht.parser=ht.options=ht.inherits=ht.find=void 0;var Cl=Aa,Ol=qa,Nl=ko(Ol),Ll=Yt,Ms=ko(Ll),Il=Xt,Rs=ko(Il);function ko(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"});var So=function(t){return Rs.run(Ms.run(t))},jl=function(t){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=So(t),d=[],s=0;s<n.length;s++){var k=n[s];k.isLink&&(!a||k.type===a)&&d.push(k.toObject())}return d},Vl=function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=So(t);return n.length===1&&n[0].isLink&&(!a||n[0].type===a)};ht.find=jl,ht.inherits=Cl.inherits,ht.options=Nl,ht.parser=Rs,ht.scanner=Ms,ht.test=Vl,ht.tokenize=So;var Ts=ht,Hl=(e,t,a)=>{const n={bold:a.bold,italic:a.italic,strike:a.strike,underline:a.underline,multilineCode:a.multilineCode,inlineCode:a.inlineCode},d={[n.bold]:{end:"\\"+n.bold,allowed_chars:".",type:"bold"},[n.italic]:{end:n.italic,allowed_chars:".",type:"italic"},[n.strike]:{end:n.strike,allowed_chars:".",type:"strike"},[n.underline]:{end:n.underline,allowed_chars:".",type:"underline"},[n.multilineCode]:{end:n.multilineCode,allowed_chars:`(.|
)`,type:"multiline-code"},[n.inlineCode]:{end:n.inlineCode,allowed_chars:".",type:"inline-code"},"<usertag>":{allowed_chars:".",end:"</usertag>",type:"tag"}},s=jr(e,d),k=Pl(s,d),C=[].concat.apply([],k);return t&&Ul(C),C};function jr(e,t){let a=[],n=-1,d=null,s=Ts.find(e),k=!1;if(s.length>0&&(n=e.indexOf(s[0].value),k=!0),Object.keys(t).forEach(C=>{const L=e.indexOf(C);L>=0&&(n<0||L<n)&&(n=L,d=C,k=!1)}),k&&d!==-1){let C=e.substr(0,n),L=e.substr(n,s[0].value.length),b=e.substr(n+s[0].value.length);return a.push(C),a.push(L),a=a.concat(jr(b,t)),a}if(d){let C=e.substr(0,n);const L=d;let b=e.substr(n+L.length);if(e.replace(/\s/g,"").length===L.length*2)return[e];const R=b.match(new RegExp("^("+(t[L].allowed_chars||".")+"*"+(t[L].end?"?":"")+")"+(t[L].end?"("+t[L].end+")":""),"m"));if(!R||!R[1])C=C+L,a.push(C);else{C&&a.push(C);const h={start:L,content:jr(R[1],t),end:R[2],type:t[L].type};a.push(h),b=b.substr(R[0].length)}return a=a.concat(jr(b,t)),a}else return e?[e]:[]}function Pl(e,t){const a=[];return e.forEach(n=>{typeof n=="string"?a.push({types:[],value:n}):t[n.start]&&a.push(Fl(n))}),a}function Fl(e){const t=[];return As(e,t,[]),t}function As(e,t,a){e.content.forEach(n=>{typeof n=="string"?t.push({types:Bs(a.concat([e.type])),value:n}):As(n,t,Bs([n.type].concat([e.type]).concat(a)))})}function Bs(e){return[...new Set(e)]}function Ul(e){const t=[];return e.forEach(a=>{const n=Ts.find(a.value);if(n.length){const d=a.value.replace(n[0].value,"");t.push({types:a.types,value:d}),a.types=["url"].concat(a.types),a.href=n[0].href,a.value=n[0].value}t.push(a)}),t}const Eo=["png","jpg","jpeg","webp","svg","gif"],Cs=["mp4","video/ogg","webm","quicktime"],Dl=["mp3","audio/ogg","wav","mpeg"],zl={name:"FormatMessage",components:{SvgIcon:mt},props:{content:{type:[String,Number],required:!0},deleted:{type:Boolean,default:!1},users:{type:Array,default:()=>[]},linkify:{type:Boolean,default:!0},singleLine:{type:Boolean,default:!1},reply:{type:Boolean,default:!1},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0}},emits:["open-user-tag"],computed:{linkifiedMessage(){const e=Hl(this.formatTags(this.content),this.linkify&&!this.linkOptions.disabled,this.textFormatting);return e.forEach(t=>{t.url=this.checkType(t,"url"),t.bold=this.checkType(t,"bold"),t.italic=this.checkType(t,"italic"),t.strike=this.checkType(t,"strike"),t.underline=this.checkType(t,"underline"),t.inline=this.checkType(t,"inline-code"),t.multiline=this.checkType(t,"multiline-code"),t.tag=this.checkType(t,"tag"),t.image=this.checkImageType(t),t.value=this.replaceEmojiByElement(t.value)}),e},formattedContent(){return this.formatTags(this.content)}},methods:{checkType(e,t){return e.types.indexOf(t)!==-1},checkImageType(e){let t=e.value.lastIndexOf(".");e.value.lastIndexOf("/")>t&&(t=-1);const n=e.value.substring(t+1,e.value.length),d=t>0&&Eo.some(s=>n.toLowerCase().includes(s));return d&&this.setImageSize(e),d},setImageSize(e){const t=new Image;t.src=e.value,t.addEventListener("load",a);function a(n){const d=n.path[0].width/150;e.height=Math.round(n.path[0].height/d)+"px",t.removeEventListener("load",a)}},formatTags(e){const t="<usertag>",a="</usertag>",n=[...e.matchAll(new RegExp(t,"gi"))].map(s=>s.index),d=e;return n.forEach(s=>{const k=d.substring(s+t.length,d.indexOf(a,s)),C=this.users.find(L=>L._id===k);e=e.replaceAll(k,`@${(C==null?void 0:C.username)||"unknown"}`)}),e},openTag(e){if(!this.singleLine&&this.checkType(e,"tag")){const t=this.users.find(a=>e.value.indexOf(a.username)!==-1);this.$emit("open-user-tag",t)}},replaceEmojiByElement(e){let t;return this.singleLine?t=16:t=this.containsOnlyEmojis()?28:20,e.replaceAll(/[\p{Extended_Pictographic}\u{1F3FB}-\u{1F3FF}\u{1F9B0}-\u{1F9B3}]/gu,a=>`<span style="font-size: ${t}px">${a}</span>`)},containsOnlyEmojis(){const e=this.content.replace(new RegExp("[\0-\u1EEFf]","g"),""),t=this.content.replace(new RegExp(`[
\rs]+|( )+`,"g"),"");return e.length===t.length}}},ql={class:"vac-image-link-container"},Yl={class:"vac-image-link-message"},Xl=["innerHTML"],Gl=["innerHTML"];function Kl(e,t,a,n,d,s){const k=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",{class:r.normalizeClass(["vac-format-message-wrapper",{"vac-text-ellipsis":a.singleLine}])},[a.textFormatting.disabled?(r.openBlock(),r.createElementBlock("div",{key:1,innerHTML:s.formattedContent},null,8,Gl)):(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass({"vac-text-ellipsis":a.singleLine})},[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(s.linkifiedMessage,(C,L)=>(r.openBlock(),r.createElementBlock("div",{key:L,class:"vac-format-container"},[(r.openBlock(),r.createBlock(r.resolveDynamicComponent(C.url?"a":"span"),{class:r.normalizeClass({"vac-text-ellipsis":a.singleLine,"vac-text-bold":C.bold,"vac-text-italic":a.deleted||C.italic,"vac-text-strike":C.strike,"vac-text-underline":C.underline,"vac-text-inline-code":!a.singleLine&&C.inline,"vac-text-multiline-code":!a.singleLine&&C.multiline,"vac-text-tag":!a.singleLine&&!a.reply&&C.tag}),href:C.href,target:C.href?a.linkOptions.target:null,rel:C.href?a.linkOptions.rel:null,onClick:b=>s.openTag(C)},{default:r.withCtx(()=>[r.renderSlot(e.$slots,"deleted-icon",r.normalizeProps(r.guardReactiveProps({deleted:a.deleted})),()=>[a.deleted?(r.openBlock(),r.createBlock(k,{key:0,name:"deleted",class:"vac-icon-deleted"})):r.createCommentVNode("",!0)]),C.url&&C.image?(r.openBlock(),r.createElementBlock(r.Fragment,{key:0},[r.createElementVNode("div",ql,[r.createElementVNode("div",{class:"vac-image-link",style:r.normalizeStyle({"background-image":`url('${C.value}')`,height:C.height})},null,4)]),r.createElementVNode("div",Yl,[r.createElementVNode("span",null,r.toDisplayString(C.value),1)])],64)):(r.openBlock(),r.createElementBlock("span",{key:1,innerHTML:C.value},null,8,Xl))]),_:2},1032,["class","href","target","rel","onClick"]))]))),128))],2))],2)}var sr=Ye(zl,[["render",Kl]]);const va="__v-click-outside",Os=typeof window!="undefined",Zl=typeof navigator!="undefined",Wl=Os&&("ontouchstart"in window||Zl&&navigator.msMaxTouchPoints>0)?["touchstart"]:["click"],Ql=e=>{const t=typeof e=="function";if(!t&&typeof e!="object")throw new Error("v-click-outside: Binding value must be a function or an object");return{handler:t?e:e.handler,middleware:e.middleware||(a=>a),events:e.events||Wl,isActive:e.isActive!==!1,detectIframe:e.detectIframe!==!1,capture:Boolean(e.capture)}},Ns=({event:e,handler:t,middleware:a})=>{a(e)&&t(e)},Jl=({el:e,event:t,handler:a,middleware:n})=>{setTimeout(()=>{const{activeElement:d}=document;d&&d.tagName==="IFRAME"&&!e.contains(d)&&Ns({event:t,handler:a,middleware:n})},0)},$l=({el:e,event:t,handler:a,middleware:n})=>{const d=t.path||t.composedPath&&t.composedPath();(d?d.indexOf(e)<0:!e.contains(t.target))&&Ns({event:t,handler:a,middleware:n})},Ls=(e,{value:t})=>{const{events:a,handler:n,middleware:d,isActive:s,detectIframe:k,capture:C}=Ql(t);if(!!s){if(e[va]=a.map(L=>({event:L,srcTarget:document.documentElement,handler:b=>$l({el:e,event:b,handler:n,middleware:d}),capture:C})),k){const L={event:"blur",srcTarget:window,handler:b=>Jl({el:e,event:b,handler:n,middleware:d}),capture:C};e[va]=[...e[va],L]}e[va].forEach(({event:L,srcTarget:b,handler:R})=>setTimeout(()=>{!e[va]||b.addEventListener(L,R,C)},0))}},Is=e=>{(e[va]||[]).forEach(({event:a,srcTarget:n,handler:d,capture:s})=>n.removeEventListener(a,d,s)),delete e[va]};var Vr=Os?{beforeMount:Ls,updated:(e,{value:t,oldValue:a})=>{JSON.stringify(t)!==JSON.stringify(a)&&(Is(e),Ls(e,{value:t}))},unmounted:Is}:{},js=(e,t,a)=>{if(e.typingUsers&&e.typingUsers.length){const n=e.users.filter(d=>{if(d._id!==t&&e.typingUsers.indexOf(d._id)!==-1&&!(d.status&&d.status.state==="offline"))return!0});return n.length?e.users.length===2?a.IS_TYPING:n.map(d=>d.username).join(", ")+" "+a.IS_TYPING:void 0}};function nr(e,t){if(!(!t||!t.type))return e.some(a=>t.type.toLowerCase().includes(a))}function La(e){return nr(Eo,e)}function ir(e){return nr(Cs,e)}function Vs(e){return nr(Eo,e)||nr(Cs,e)}function Hr(e){return nr(Dl,e)}const e0={name:"RoomsContent",components:{SvgIcon:mt,FormatMessage:sr},directives:{clickOutside:Vr},props:{currentUserId:{type:[String,Number],required:!0},room:{type:Object,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},textMessages:{type:Object,required:!0},roomActions:{type:Array,required:!0}},emits:["room-action-handler"],data(){return{roomMenuOpened:null}},computed:{getLastMessage(){const e=this.typingUsers;if(e)return e;const t=this.room.lastMessage.deleted?this.textMessages.MESSAGE_DELETED:this.room.lastMessage.content;if(this.room.users.length<=2)return t;const a=this.room.users.find(n=>n._id===this.room.lastMessage.senderId);return this.room.lastMessage.username?`${this.room.lastMessage.username} - ${t}`:!a||a._id===this.currentUserId?t:`${a.username} - ${t}`},userStatus(){if(!this.room.users||this.room.users.length!==2)return;const e=this.room.users.find(t=>t._id!==this.currentUserId);return e&&e.status?e.status.state:null},typingUsers(){return js(this.room,this.currentUserId,this.textMessages)},isMessageCheckmarkVisible(){return!this.typingUsers&&this.room.lastMessage&&!this.room.lastMessage.deleted&&this.room.lastMessage.senderId===this.currentUserId&&(this.room.lastMessage.saved||this.room.lastMessage.distributed||this.room.lastMessage.seen)},formattedDuration(){var t,a;const e=(a=(t=this.room.lastMessage)==null?void 0:t.files)==null?void 0:a[0];if(e){if(!e.duration)return`${e.name}.${e.extension}`;let n=Math.floor(e.duration);return(n-(n%=60))/60+(n>9?":":":0")+n}return""},isAudio(){return this.room.lastMessage.files?Hr(this.room.lastMessage.files[0]):!1}},methods:{roomActionHandler(e){this.closeRoomMenu(),this.$emit("room-action-handler",{action:e,roomId:this.room.roomId})},closeRoomMenu(){this.roomMenuOpened=null}}},t0={class:"vac-room-container"},a0={class:"vac-name-container vac-text-ellipsis"},r0={class:"vac-title-container"},o0={class:"vac-room-name vac-text-ellipsis"},s0={key:1,class:"vac-text-date"},n0={key:0},i0={key:1,class:"vac-text-ellipsis"},l0={key:3,class:"vac-text-ellipsis"},c0={class:"vac-room-options-container"},d0={key:0,class:"vac-badge-counter vac-room-badge"},m0={key:0,class:"vac-menu-options"},h0={class:"vac-menu-list"},u0=["onClick"];function f0(e,t,a,n,d,s){const k=r.resolveComponent("svg-icon"),C=r.resolveComponent("format-message"),L=r.resolveDirective("click-outside");return r.openBlock(),r.createElementBlock("div",t0,[r.renderSlot(e.$slots,"room-list-item",r.normalizeProps(r.guardReactiveProps({room:a.room})),()=>[r.renderSlot(e.$slots,"room-list-avatar",r.normalizeProps(r.guardReactiveProps({room:a.room})),()=>[a.room.avatar?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-avatar",style:r.normalizeStyle({"background-image":`url('${a.room.avatar}')`})},null,4)):r.createCommentVNode("",!0)]),r.createElementVNode("div",a0,[r.createElementVNode("div",r0,[s.userStatus?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-state-circle",{"vac-state-online":s.userStatus==="online"}])},null,2)):r.createCommentVNode("",!0),r.createElementVNode("div",o0,r.toDisplayString(a.room.roomName),1),a.room.lastMessage?(r.openBlock(),r.createElementBlock("div",s0,r.toDisplayString(a.room.lastMessage.timestamp),1)):r.createCommentVNode("",!0)]),r.createElementVNode("div",{class:r.normalizeClass(["vac-text-last",{"vac-message-new":a.room.lastMessage&&a.room.lastMessage.new&&!s.typingUsers}])},[s.isMessageCheckmarkVisible?(r.openBlock(),r.createElementBlock("span",n0,[r.renderSlot(e.$slots,"checkmark-icon",r.normalizeProps(r.guardReactiveProps({message:a.room.lastMessage})),()=>[r.createVNode(k,{name:a.room.lastMessage.distributed?"double-checkmark":"checkmark",param:a.room.lastMessage.seen?"seen":"",class:"vac-icon-check"},null,8,["name","param"])])])):r.createCommentVNode("",!0),a.room.lastMessage&&!a.room.lastMessage.deleted&&s.isAudio?(r.openBlock(),r.createElementBlock("div",i0,[r.renderSlot(e.$slots,"microphone-icon",{},()=>[r.createVNode(k,{name:"microphone",class:"vac-icon-microphone"})]),r.createTextVNode(" "+r.toDisplayString(s.formattedDuration),1)])):a.room.lastMessage?(r.openBlock(),r.createBlock(C,{key:2,content:s.getLastMessage,deleted:!!a.room.lastMessage.deleted&&!s.typingUsers,users:a.room.users,linkify:!1,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"single-line":!0},{"deleted-icon":r.withCtx(b=>[r.renderSlot(e.$slots,"deleted-icon",r.normalizeProps(r.guardReactiveProps(b)))]),_:3},8,["content","deleted","users","text-formatting","link-options"])):r.createCommentVNode("",!0),!a.room.lastMessage&&s.typingUsers?(r.openBlock(),r.createElementBlock("div",l0,r.toDisplayString(s.typingUsers),1)):r.createCommentVNode("",!0),r.createElementVNode("div",c0,[a.room.unreadCount?(r.openBlock(),r.createElementBlock("div",d0,r.toDisplayString(a.room.unreadCount),1)):r.createCommentVNode("",!0),r.renderSlot(e.$slots,"room-list-options",r.normalizeProps(r.guardReactiveProps({room:a.room})),()=>[a.roomActions.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-svg-button vac-list-room-options",onClick:t[0]||(t[0]=r.withModifiers(b=>d.roomMenuOpened=a.room.roomId,["stop"]))},[r.renderSlot(e.$slots,"room-list-options-icon",{},()=>[r.createVNode(k,{name:"dropdown",param:"room"})])])):r.createCommentVNode("",!0),a.roomActions.length?(r.openBlock(),r.createBlock(r.Transition,{key:1,name:"vac-slide-left"},{default:r.withCtx(()=>[d.roomMenuOpened===a.room.roomId?r.withDirectives((r.openBlock(),r.createElementBlock("div",m0,[r.createElementVNode("div",h0,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.roomActions,b=>(r.openBlock(),r.createElementBlock("div",{key:b.name},[r.createElementVNode("div",{class:"vac-menu-item",onClick:r.withModifiers(R=>s.roomActionHandler(b),["stop"])},r.toDisplayString(b.title),9,u0)]))),128))])])),[[L,s.closeRoomMenu]]):r.createCommentVNode("",!0)]),_:1})):r.createCommentVNode("",!0)])])],2)])])])}var _0=Ye(e0,[["render",f0]]),Mo=(e,t,a,n=!1)=>!a||a===""?e:e.filter(d=>n?Pr(d[t]).startsWith(Pr(a)):Pr(d[t]).includes(Pr(a)));function Pr(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}const p0={name:"RoomsList",components:{Loader:Rr,RoomsSearch:Ri,RoomContent:_0},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},showRoomsList:{type:Boolean,required:!0},showSearch:{type:Boolean,required:!0},showAddRoom:{type:Boolean,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},isMobile:{type:Boolean,required:!0},rooms:{type:Array,required:!0},loadingRooms:{type:Boolean,required:!0},roomsLoaded:{type:Boolean,required:!0},room:{type:Object,required:!0},roomActions:{type:Array,required:!0},scrollDistance:{type:Number,required:!0}},emits:["add-room","room-action-handler","loading-more-rooms","fetch-room","fetch-more-rooms"],data(){return{filteredRooms:this.rooms||[],observer:null,showLoader:!0,loadingMoreRooms:!1,selectedRoomId:""}},watch:{rooms:{deep:!0,handler(e,t){this.filteredRooms=e,(e.length!==t.length||this.roomsLoaded)&&(this.loadingMoreRooms=!1)}},loadingRooms(e){e||setTimeout(()=>this.initIntersectionObserver())},loadingMoreRooms(e){this.$emit("loading-more-rooms",e)},roomsLoaded:{immediate:!0,handler(e){e&&(this.loadingMoreRooms=!1,this.loadingRooms||(this.showLoader=!1))}},room:{immediate:!0,handler(e){e&&!this.isMobile&&(this.selectedRoomId=e.roomId)}}},methods:{initIntersectionObserver(){this.observer&&(this.showLoader=!0,this.observer.disconnect());const e=document.querySelector("vue-advanced-chat").shadowRoot.getElementById("infinite-loader-rooms");if(e){const t={root:document.querySelector("vue-advanced-chat").shadowRoot.getElementById("rooms-list"),rootMargin:`${this.scrollDistance}px`,threshold:0};this.observer=new IntersectionObserver(a=>{a[0].isIntersecting&&this.loadMoreRooms()},t),this.observer.observe(e)}},searchRoom(e){this.filteredRooms=Mo(this.rooms,"roomName",e.target.value)},openRoom(e){e.roomId===this.room.roomId&&!this.isMobile||(this.isMobile||(this.selectedRoomId=e.roomId),this.$emit("fetch-room",{room:e}))},loadMoreRooms(){if(!this.loadingMoreRooms){if(this.roomsLoaded){this.loadingMoreRooms=!1,this.showLoader=!1;return}this.$emit("fetch-more-rooms"),this.loadingMoreRooms=!0}}}},v0={key:0,class:"vac-rooms-empty"},g0={key:1,id:"rooms-list",class:"vac-room-list"},b0=["id","onClick"],y0={key:0,id:"infinite-loader-rooms"};function x0(e,t,a,n,d,s){const k=r.resolveComponent("rooms-search"),C=r.resolveComponent("loader"),L=r.resolveComponent("room-content");return r.withDirectives((r.openBlock(),r.createElementBlock("div",{class:r.normalizeClass(["vac-rooms-container",{"vac-rooms-container-full":a.isMobile,"vac-app-border-r":!a.isMobile}])},[r.renderSlot(e.$slots,"rooms-header"),r.renderSlot(e.$slots,"rooms-list-search",{},()=>[r.createVNode(k,{rooms:a.rooms,"loading-rooms":a.loadingRooms,"text-messages":a.textMessages,"show-search":a.showSearch,"show-add-room":a.showAddRoom,onSearchRoom:s.searchRoom,onAddRoom:t[0]||(t[0]=b=>e.$emit("add-room"))},{"add-icon":r.withCtx(()=>[r.renderSlot(e.$slots,"add-icon")]),_:3},8,["rooms","loading-rooms","text-messages","show-search","show-add-room","onSearchRoom"])]),r.createVNode(C,{show:a.loadingRooms},r.createSlots({_:2},[r.renderList(e.$slots,(b,R)=>({name:R,fn:r.withCtx(h=>[r.renderSlot(e.$slots,R,r.normalizeProps(r.guardReactiveProps(h)))])}))]),1032,["show"]),!a.loadingRooms&&!a.rooms.length?(r.openBlock(),r.createElementBlock("div",v0,[r.renderSlot(e.$slots,"rooms-empty",{},()=>[r.createTextVNode(r.toDisplayString(a.textMessages.ROOMS_EMPTY),1)])])):r.createCommentVNode("",!0),a.loadingRooms?r.createCommentVNode("",!0):(r.openBlock(),r.createElementBlock("div",g0,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(d.filteredRooms,b=>(r.openBlock(),r.createElementBlock("div",{id:b.roomId,key:b.roomId,class:r.normalizeClass(["vac-room-item",{"vac-room-selected":d.selectedRoomId===b.roomId}]),onClick:R=>s.openRoom(b)},[r.createVNode(L,{"current-user-id":a.currentUserId,room:b,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"text-messages":a.textMessages,"room-actions":a.roomActions,onRoomActionHandler:t[1]||(t[1]=R=>e.$emit("room-action-handler",R))},r.createSlots({_:2},[r.renderList(e.$slots,(R,h)=>({name:h,fn:r.withCtx(M=>[r.renderSlot(e.$slots,h,r.normalizeProps(r.guardReactiveProps(M)))])}))]),1032,["current-user-id","room","text-formatting","link-options","text-messages","room-actions"])],10,b0))),128)),r.createVNode(r.Transition,{name:"vac-fade-message"},{default:r.withCtx(()=>[a.rooms.length&&!a.loadingRooms?(r.openBlock(),r.createElementBlock("div",y0,[r.createVNode(C,{show:d.showLoader,infinite:!0},r.createSlots({_:2},[r.renderList(e.$slots,(b,R)=>({name:R,fn:r.withCtx(h=>[r.renderSlot(e.$slots,R,r.normalizeProps(r.guardReactiveProps(h)))])}))]),1032,["show"])])):r.createCommentVNode("",!0)]),_:3})]))],2)),[[r.vShow,a.showRoomsList]])}var w0=Ye(p0,[["render",x0]]);const k0={name:"RoomHeader",components:{SvgIcon:mt},directives:{clickOutside:Vr},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},singleRoom:{type:Boolean,required:!0},showRoomsList:{type:Boolean,required:!0},isMobile:{type:Boolean,required:!0},roomInfoEnabled:{type:Boolean,required:!0},menuActions:{type:Array,required:!0},room:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0},messageSelectionActions:{type:Array,required:!0},selectedMessagesTotal:{type:Number,required:!0}},emits:["toggle-rooms-list","room-info","menu-action-handler","cancel-message-selection","message-selection-action-handler"],data(){return{menuOpened:!1,messageSelectionAnimationEnded:!0}},computed:{typingUsers(){return js(this.room,this.currentUserId,this.textMessages)},userStatus(){if(!this.room.users||this.room.users.length!==2)return;const e=this.room.users.find(a=>a._id!==this.currentUserId);if(!e.status)return;let t="";return e.status.state==="online"?t=this.textMessages.IS_ONLINE:e.status.lastChanged&&(t=this.textMessages.LAST_SEEN+e.status.lastChanged),t}},watch:{messageSelectionEnabled(e){e?this.messageSelectionAnimationEnded=!1:setTimeout(()=>{this.messageSelectionAnimationEnded=!0},300)}},methods:{menuActionHandler(e){this.closeMenu(),this.$emit("menu-action-handler",e)},closeMenu(){this.menuOpened=!1},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",e)}}},S0={class:"vac-room-header vac-app-border-b"},E0={class:"vac-room-wrapper"},M0={key:0,class:"vac-room-selection"},R0=["id"],T0=["onClick"],A0={class:"vac-selection-button-count"},B0={class:"vac-text-ellipsis"},C0={class:"vac-room-name vac-text-ellipsis"},O0={key:0,class:"vac-room-info vac-text-ellipsis"},N0={key:1,class:"vac-room-info vac-text-ellipsis"},L0={key:0,class:"vac-menu-options"},I0={class:"vac-menu-list"},j0=["onClick"];function V0(e,t,a,n,d,s){const k=r.resolveComponent("svg-icon"),C=r.resolveDirective("click-outside");return r.openBlock(),r.createElementBlock("div",S0,[r.renderSlot(e.$slots,"room-header",r.normalizeProps(r.guardReactiveProps({room:a.room,typingUsers:s.typingUsers,userStatus:s.userStatus})),()=>[r.createElementVNode("div",E0,[r.createVNode(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.messageSelectionEnabled?(r.openBlock(),r.createElementBlock("div",M0,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.messageSelectionActions,L=>(r.openBlock(),r.createElementBlock("div",{id:L.name,key:L.name},[r.createElementVNode("div",{class:"vac-selection-button",onClick:b=>s.messageSelectionActionHandler(L)},[r.createTextVNode(r.toDisplayString(L.title)+" ",1),r.createElementVNode("span",A0,r.toDisplayString(a.selectedMessagesTotal),1)],8,T0)],8,R0))),128)),r.createElementVNode("div",{class:"vac-selection-cancel vac-item-clickable",onClick:t[0]||(t[0]=L=>e.$emit("cancel-message-selection"))},r.toDisplayString(a.textMessages.CANCEL_SELECT_MESSAGE),1)])):r.createCommentVNode("",!0)]),_:1}),!a.messageSelectionEnabled&&d.messageSelectionAnimationEnded?(r.openBlock(),r.createElementBlock(r.Fragment,{key:0},[a.singleRoom?r.createCommentVNode("",!0):(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-svg-button vac-toggle-button",{"vac-rotate-icon-init":!a.isMobile,"vac-rotate-icon":!a.showRoomsList&&!a.isMobile}]),onClick:t[1]||(t[1]=L=>e.$emit("toggle-rooms-list"))},[r.renderSlot(e.$slots,"toggle-icon",{},()=>[r.createVNode(k,{name:"toggle"})])],2)),r.createElementVNode("div",{class:r.normalizeClass(["vac-info-wrapper",{"vac-item-clickable":a.roomInfoEnabled}]),onClick:t[2]||(t[2]=L=>e.$emit("room-info"))},[r.renderSlot(e.$slots,"room-header-avatar",r.normalizeProps(r.guardReactiveProps({room:a.room})),()=>[a.room.avatar?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-avatar",style:r.normalizeStyle({"background-image":`url('${a.room.avatar}')`})},null,4)):r.createCommentVNode("",!0)]),r.renderSlot(e.$slots,"room-header-info",r.normalizeProps(r.guardReactiveProps({room:a.room,typingUsers:s.typingUsers,userStatus:s.userStatus})),()=>[r.createElementVNode("div",B0,[r.createElementVNode("div",C0,r.toDisplayString(a.room.roomName),1),s.typingUsers?(r.openBlock(),r.createElementBlock("div",O0,r.toDisplayString(s.typingUsers),1)):(r.openBlock(),r.createElementBlock("div",N0,r.toDisplayString(s.userStatus),1))])])],2),a.room.roomId?r.renderSlot(e.$slots,"room-options",{key:1},()=>[a.menuActions.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-svg-button vac-room-options",onClick:t[3]||(t[3]=L=>d.menuOpened=!d.menuOpened)},[r.renderSlot(e.$slots,"menu-icon",{},()=>[r.createVNode(k,{name:"menu"})])])):r.createCommentVNode("",!0),a.menuActions.length?(r.openBlock(),r.createBlock(r.Transition,{key:1,name:"vac-slide-left"},{default:r.withCtx(()=>[d.menuOpened?r.withDirectives((r.openBlock(),r.createElementBlock("div",L0,[r.createElementVNode("div",I0,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.menuActions,L=>(r.openBlock(),r.createElementBlock("div",{key:L.name},[r.createElementVNode("div",{class:"vac-menu-item",onClick:b=>s.menuActionHandler(L)},r.toDisplayString(L.title),9,j0)]))),128))])])),[[C,s.closeMenu]]):r.createCommentVNode("",!0)]),_:1})):r.createCommentVNode("",!0)]):r.createCommentVNode("",!0)],64)):r.createCommentVNode("",!0)])])])}var H0=Ye(k0,[["render",V0]]);function Fr(e){if(typeof e!="string"||!e)throw new Error("expected a non-empty string, got: "+e)}function Ro(e){if(typeof e!="number")throw new Error("expected a number, got: "+e)}const P0=1,F0=1,ga="emoji",Ia="keyvalue",To="favorites",U0="tokens",Hs="tokens",D0="unicode",Ps="count",z0="group",q0="order",Fs="group-order",Ao="eTag",Ur="url",Us="skinTone",ja="readonly",Bo="readwrite",Ds="skinUnicodes",Y0="skinUnicodes",X0="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",G0="en";function K0(e,t){const a=new Set,n=[];for(const d of e){const s=t(d);a.has(s)||(a.add(s),n.push(d))}return n}function zs(e){return K0(e,t=>t.unicode)}function Z0(e){function t(a,n,d){const s=n?e.createObjectStore(a,{keyPath:n}):e.createObjectStore(a);if(d)for(const[k,[C,L]]of Object.entries(d))s.createIndex(k,C,{multiEntry:L});return s}t(Ia),t(ga,D0,{[Hs]:[U0,!0],[Fs]:[[z0,q0]],[Ds]:[Y0,!0]}),t(To,void 0,{[Ps]:[""]})}const Co={},Dr={},zr={};function qs(e,t,a){a.onerror=()=>t(a.error),a.onblocked=()=>t(new Error("IDB blocked")),a.onsuccess=()=>e(a.result)}async function W0(e){const t=await new Promise((a,n)=>{const d=indexedDB.open(e,P0);Co[e]=d,d.onupgradeneeded=s=>{s.oldVersion<F0&&Z0(d.result)},qs(a,n,d)});return t.onclose=()=>Oo(e),t}function Q0(e){return Dr[e]||(Dr[e]=W0(e)),Dr[e]}function ea(e,t,a,n){return new Promise((d,s)=>{const k=e.transaction(t,a,{durability:"relaxed"}),C=typeof t=="string"?k.objectStore(t):t.map(b=>k.objectStore(b));let L;n(C,k,b=>{L=b}),k.oncomplete=()=>d(L),k.onerror=()=>s(k.error)})}function Oo(e){const t=Co[e],a=t&&t.result;if(a){a.close();const n=zr[e];if(n)for(const d of n)d()}delete Co[e],delete Dr[e],delete zr[e]}function J0(e){return new Promise((t,a)=>{Oo(e);const n=indexedDB.deleteDatabase(e);qs(t,a,n)})}function $0(e,t){let a=zr[e];a||(a=zr[e]=[]),a.push(t)}const ec=new Set([":D","XD",":'D","O:)",":X",":P",";P","XP",":L",":Z",":j","8D","XO","8)",":B",":O",":S",":'o","Dx","X(","D:",":C",">0)",":3","</3","<3","\\M/",":E","8#"]);function Va(e){return e.split(/[\s_]+/).map(t=>!t.match(/\w/)||ec.has(t)?t.toLowerCase():t.replace(/[)(:,]/g,"").replace(/’/g,"'").toLowerCase()).filter(Boolean)}const tc=2;function Ys(e){return e.filter(Boolean).map(t=>t.toLowerCase()).filter(t=>t.length>=tc)}function ac(e){return e.map(({annotation:a,emoticon:n,group:d,order:s,shortcodes:k,skins:C,tags:L,emoji:b,version:R})=>{const h=[...new Set(Ys([...(k||[]).map(Va).flat(),...L.map(Va).flat(),...Va(a),n]))].sort(),M={annotation:a,group:d,order:s,tags:L,tokens:h,unicode:b,version:R};if(n&&(M.emoticon=n),k&&(M.shortcodes=k),C){M.skinTones=[],M.skinUnicodes=[],M.skinVersions=[];for(const{tone:w,emoji:o,version:F}of C)M.skinTones.push(w),M.skinUnicodes.push(o),M.skinVersions.push(F)}return M})}function Xs(e,t,a,n){e[t](a).onsuccess=d=>n&&n(d.target.result)}function ba(e,t,a){Xs(e,"get",t,a)}function Gs(e,t,a){Xs(e,"getAll",t,a)}function No(e){e.commit&&e.commit()}function rc(e,t){let a=e[0];for(let n=1;n<e.length;n++){const d=e[n];t(a)>t(d)&&(a=d)}return a}function Ks(e,t){const a=rc(e,d=>d.length),n=[];for(const d of a)e.some(s=>s.findIndex(k=>t(k)===t(d))===-1)||n.push(d);return n}async function oc(e){return!await Lo(e,Ia,Ur)}async function sc(e,t,a){const[n,d]=await Promise.all([Ao,Ur].map(s=>Lo(e,Ia,s)));return n===a&&d===t}async function nc(e,t){return ea(e,ga,ja,(n,d,s)=>{let k;const C=()=>{n.getAll(k&&IDBKeyRange.lowerBound(k,!0),50).onsuccess=L=>{const b=L.target.result;for(const R of b)if(k=R.unicode,t(R))return s(R);if(b.length<50)return s();C()}};C()})}async function Zs(e,t,a,n){try{const d=ac(t);await ea(e,[ga,Ia],Bo,([s,k],C)=>{let L,b,R=0;function h(){++R===2&&M()}function M(){if(!(L===n&&b===a)){s.clear();for(const w of d)s.put(w);k.put(n,Ao),k.put(a,Ur),No(C)}}ba(k,Ao,w=>{L=w,h()}),ba(k,Ur,w=>{b=w,h()})})}finally{}}async function ic(e,t){return ea(e,ga,ja,(a,n,d)=>{const s=IDBKeyRange.bound([t,0],[t+1,0],!1,!0);Gs(a.index(Fs),s,d)})}async function Ws(e,t){const a=Ys(Va(t));return a.length?ea(e,ga,ja,(n,d,s)=>{const k=[],C=()=>{k.length===a.length&&L()},L=()=>{const b=Ks(k,R=>R.unicode);s(b.sort((R,h)=>R.order<h.order?-1:1))};for(let b=0;b<a.length;b++){const R=a[b],h=b===a.length-1?IDBKeyRange.bound(R,R+"\uFFFF",!1,!0):IDBKeyRange.only(R);Gs(n.index(Hs),h,M=>{k.push(M),C()})}}):[]}async function lc(e,t){const a=await Ws(e,t);return a.length?a.filter(n=>(n.shortcodes||[]).map(s=>s.toLowerCase()).includes(t.toLowerCase()))[0]||null:await nc(e,d=>(d.shortcodes||[]).includes(t.toLowerCase()))||null}async function cc(e,t){return ea(e,ga,ja,(a,n,d)=>ba(a,t,s=>{if(s)return d(s);ba(a.index(Ds),t,k=>d(k||null))}))}function Lo(e,t,a){return ea(e,t,ja,(n,d,s)=>ba(n,a,s))}function dc(e,t,a,n){return ea(e,t,Bo,(d,s)=>{d.put(n,a),No(s)})}function mc(e,t){return ea(e,To,Bo,(a,n)=>ba(a,t,d=>{a.put((d||0)+1,t),No(n)}))}function hc(e,t,a){return a===0?[]:ea(e,[To,ga],ja,([n,d],s,k)=>{const C=[];n.index(Ps).openCursor(void 0,"prev").onsuccess=L=>{const b=L.target.result;if(!b)return k(C);function R(w){if(C.push(w),C.length===a)return k(C);b.continue()}const h=b.primaryKey,M=t.byName(h);if(M)return R(M);ba(d,h,w=>{if(w)return R(w);b.continue()})}})}const qr="";function uc(e,t){const a=new Map;for(const d of e){const s=t(d);for(const k of s){let C=a;for(let b=0;b<k.length;b++){const R=k.charAt(b);let h=C.get(R);h||(h=new Map,C.set(R,h)),C=h}let L=C.get(qr);L||(L=[],C.set(qr,L)),L.push(d)}}return(d,s)=>{let k=a;for(let b=0;b<d.length;b++){const R=d.charAt(b),h=k.get(R);if(h)k=h;else return[]}if(s)return k.get(qr)||[];const C=[],L=[k];for(;L.length;){const R=[...L.shift().entries()].sort((h,M)=>h[0]<M[0]?-1:1);for(const[h,M]of R)h===qr?C.push(...M):L.push(M)}return C}}const fc=["name","url"];function _c(e){const t=e&&Array.isArray(e),a=t&&e.length&&(!e[0]||fc.some(n=>!(n in e[0])));if(!t||a)throw new Error("Custom emojis are in the wrong format")}function Qs(e){_c(e);const t=(M,w)=>M.name.toLowerCase()<w.name.toLowerCase()?-1:1,a=e.sort(t),d=uc(e,M=>[...new Set((M.shortcodes||[]).map(w=>Va(w)).flat())]),s=M=>d(M,!0),k=M=>d(M,!1),C=M=>{const w=Va(M),o=w.map((F,H)=>(H<w.length-1?s:k)(F));return Ks(o,F=>F.name).sort(t)},L=new Map,b=new Map;for(const M of e){b.set(M.name.toLowerCase(),M);for(const w of M.shortcodes||[])L.set(w.toLowerCase(),M)}return{all:a,search:C,byShortcode:M=>L.get(M.toLowerCase()),byName:M=>b.get(M.toLowerCase())}}function lr(e){if(!e)return e;if(delete e.tokens,e.skinTones){const t=e.skinTones.length;e.skins=Array(t);for(let a=0;a<t;a++)e.skins[a]={tone:e.skinTones[a],unicode:e.skinUnicodes[a],version:e.skinVersions[a]};delete e.skinTones,delete e.skinUnicodes,delete e.skinVersions}return e}function Js(e){e||console.warn("emoji-picker-element is more efficient if the dataSource server exposes an ETag header.")}const pc=["annotation","emoji","group","order","tags","version"];function vc(e){if(!e||!Array.isArray(e)||!e[0]||typeof e[0]!="object"||pc.some(t=>!(t in e[0])))throw new Error("Emoji data is in the wrong format")}function $s(e,t){if(Math.floor(e.status/100)!==2)throw new Error("Failed to fetch: "+t+":  "+e.status)}async function gc(e){const t=await fetch(e,{method:"HEAD"});$s(t,e);const a=t.headers.get("etag");return Js(a),a}async function Io(e){const t=await fetch(e);$s(t,e);const a=t.headers.get("etag");Js(a);const n=await t.json();return vc(n),[a,n]}function bc(e){for(var t="",a=new Uint8Array(e),n=a.byteLength,d=-1;++d<n;)t+=String.fromCharCode(a[d]);return t}function yc(e){for(var t=e.length,a=new ArrayBuffer(t),n=new Uint8Array(a),d=-1;++d<t;)n[d]=e.charCodeAt(d);return a}async function en(e){const t=JSON.stringify(e),a=yc(t),n=await crypto.subtle.digest("SHA-1",a),d=bc(n);return btoa(d)}async function xc(e,t){let a,n=await gc(t);if(!n){const d=await Io(t);n=d[0],a=d[1],n||(n=await en(a))}await sc(e,t,n)||(a||(a=(await Io(t))[1]),await Zs(e,a,t,n))}async function wc(e,t){let[a,n]=await Io(t);a||(a=await en(n)),await Zs(e,n,t,a)}class tn{constructor({dataSource:t=X0,locale:a=G0,customEmoji:n=[]}={}){this.dataSource=t,this.locale=a,this._dbName=`emoji-picker-element-${this.locale}`,this._db=void 0,this._lazyUpdate=void 0,this._custom=Qs(n),this._clear=this._clear.bind(this),this._ready=this._init()}async _init(){const t=this._db=await Q0(this._dbName);$0(this._dbName,this._clear);const a=this.dataSource;await oc(t)?await wc(t,a):this._lazyUpdate=xc(t,a)}async ready(){const t=async()=>(this._ready||(this._ready=this._init()),this._ready);await t(),this._db||await t()}async getEmojiByGroup(t){return Ro(t),await this.ready(),zs(await ic(this._db,t)).map(lr)}async getEmojiBySearchQuery(t){Fr(t),await this.ready();const a=this._custom.search(t),n=zs(await Ws(this._db,t)).map(lr);return[...a,...n]}async getEmojiByShortcode(t){Fr(t),await this.ready();const a=this._custom.byShortcode(t);return a||lr(await lc(this._db,t))}async getEmojiByUnicodeOrName(t){Fr(t),await this.ready();const a=this._custom.byName(t);return a||lr(await cc(this._db,t))}async getPreferredSkinTone(){return await this.ready(),await Lo(this._db,Ia,Us)||0}async setPreferredSkinTone(t){return Ro(t),await this.ready(),dc(this._db,Ia,Us,t)}async incrementFavoriteEmojiCount(t){return Fr(t),await this.ready(),mc(this._db,t)}async getTopFavoriteEmoji(t){return Ro(t),await this.ready(),(await hc(this._db,this._custom,t)).map(lr)}set customEmoji(t){this._custom=Qs(t)}get customEmoji(){return this._custom.all}async _shutdown(){await this.ready();try{await this._lazyUpdate}catch{}}_clear(){this._db=this._ready=this._lazyUpdate=void 0}async close(){await this._shutdown(),await Oo(this._dbName)}async delete(){await this._shutdown(),await J0(this._dbName)}}function cr(){}function an(e){return e()}function rn(){return Object.create(null)}function dr(e){e.forEach(an)}function on(e){return typeof e=="function"}function kc(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let Yr;function Xr(e,t){return Yr||(Yr=document.createElement("a")),Yr.href=t,e===Yr.href}function Sc(e){return Object.keys(e).length===0}function Ec(e){return e&&on(e.destroy)?e.destroy:cr}function Ge(e,t){e.appendChild(t)}function Pt(e,t,a){e.insertBefore(t,a||null)}function Ft(e){e.parentNode.removeChild(e)}function qe(e){return document.createElement(e)}function Gt(e){return document.createTextNode(e)}function Ut(e,t,a,n){return e.addEventListener(t,a,n),()=>e.removeEventListener(t,a,n)}function J(e,t,a){a==null?e.removeAttribute(t):e.getAttribute(t)!==a&&e.setAttribute(t,a)}function Kt(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function sn(e,t){e.value=t==null?"":t}function sa(e,t,a,n){a===null?e.style.removeProperty(t):e.style.setProperty(t,a,n?"important":"")}let jo;function mr(e){jo=e}const hr=[],Ha=[],Gr=[],nn=[],ln=Promise.resolve();let Vo=!1;function cn(){Vo||(Vo=!0,ln.then(dn))}function Mc(){return cn(),ln}function Ho(e){Gr.push(e)}const Po=new Set;let Kr=0;function dn(){const e=jo;do{for(;Kr<hr.length;){const t=hr[Kr];Kr++,mr(t),Rc(t.$$)}for(mr(null),hr.length=0,Kr=0;Ha.length;)Ha.pop()();for(let t=0;t<Gr.length;t+=1){const a=Gr[t];Po.has(a)||(Po.add(a),a())}Gr.length=0}while(hr.length);for(;nn.length;)nn.pop()();Vo=!1,Po.clear(),mr(e)}function Rc(e){if(e.fragment!==null){e.update(),dr(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Ho)}}const Tc=new Set;function Ac(e,t){e&&e.i&&(Tc.delete(e),e.i(t))}const Bc=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;function ur(e,t){e.d(1),t.delete(e.key)}function fr(e,t,a,n,d,s,k,C,L,b,R,h){let M=e.length,w=s.length,o=M;const F={};for(;o--;)F[e[o].key]=o;const H=[],V=new Map,c=new Map;for(o=w;o--;){const O=h(d,s,o),l=a(O);let x=k.get(l);x?n&&x.p(O,t):(x=b(l,O),x.c()),V.set(l,H[o]=x),l in F&&c.set(l,Math.abs(o-F[l]))}const A=new Set,N=new Set;function E(O){Ac(O,1),O.m(C,R),k.set(O.key,O),R=O.first,w--}for(;M&&w;){const O=H[w-1],l=e[M-1],x=O.key,y=l.key;O===l?(R=O.first,M--,w--):V.has(y)?!k.has(x)||A.has(x)?E(O):N.has(y)?M--:c.get(x)>c.get(y)?(N.add(x),E(O)):(A.add(y),M--):(L(l,k),M--)}for(;M--;){const O=e[M];V.has(O.key)||L(O,k)}for(;w;)E(H[w-1]);return H}function Cc(e,t,a,n){const{fragment:d,on_mount:s,on_destroy:k,after_update:C}=e.$$;d&&d.m(t,a),n||Ho(()=>{const L=s.map(an).filter(on);k?k.push(...L):dr(L),e.$$.on_mount=[]}),C.forEach(Ho)}function Oc(e,t){const a=e.$$;a.fragment!==null&&(dr(a.on_destroy),a.fragment&&a.fragment.d(t),a.on_destroy=a.fragment=null,a.ctx=[])}function Nc(e,t){e.$$.dirty[0]===-1&&(hr.push(e),cn(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Lc(e,t,a,n,d,s,k,C=[-1]){const L=jo;mr(e);const b=e.$$={fragment:null,ctx:null,props:s,update:cr,not_equal:d,bound:rn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(L?L.$$.context:[]),callbacks:rn(),dirty:C,skip_bound:!1,root:t.target||L.$$.root};k&&k(b.root);let R=!1;b.ctx=a?a(e,t.props||{},(h,M,...w)=>{const o=w.length?w[0]:M;return b.ctx&&d(b.ctx[h],b.ctx[h]=o)&&(!b.skip_bound&&b.bound[h]&&b.bound[h](o),R&&Nc(e,h)),M}):[],b.update(),R=!0,dr(b.before_update),b.fragment=n?n(b.ctx):!1,t.target&&(b.fragment&&b.fragment.c(),Cc(e,t.target,void 0,void 0),dn()),mr(L)}class Ic{$destroy(){Oc(this,1),this.$destroy=cr}$on(t,a){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(a),()=>{const d=n.indexOf(a);d!==-1&&n.splice(d,1)}}$set(t){this.$$set&&!Sc(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const mn=[[-1,"\u2728","custom"],[0,"\u{1F600}","smileys-emotion"],[1,"\u{1F44B}","people-body"],[3,"\u{1F431}","animals-nature"],[4,"\u{1F34E}","food-drink"],[5,"\u{1F3E0}\uFE0F","travel-places"],[6,"\u26BD","activities"],[7,"\u{1F4DD}","objects"],[8,"\u26D4\uFE0F","symbols"],[9,"\u{1F3C1}","flags"]].map(([e,t,a])=>({id:e,emoji:t,name:a})),Zr=mn.slice(1),jc=mn[0],Vc=2,hn=6,un=typeof requestIdleCallback=="function"?requestIdleCallback:setTimeout;function fn(e){return e.unicode.includes("\u200D")}const Hc={"\u{1FAE0}":14,"\u{1F972}":13.1,"\u{1F97B}":12.1,"\u{1F970}":11,"\u{1F929}":5,"\u{1F471}\u200D\u2640\uFE0F":4,"\u{1F923}":3,"\u{1F441}\uFE0F\u200D\u{1F5E8}\uFE0F":2,"\u{1F600}":1,"\u{1F610}\uFE0F":.7,"\u{1F603}":.6},Pc=1e3,Fc="\u{1F590}\uFE0F",Uc=8,Dc=["\u{1F60A}","\u{1F612}","\u2665\uFE0F","\u{1F44D}\uFE0F","\u{1F60D}","\u{1F602}","\u{1F62D}","\u263A\uFE0F","\u{1F614}","\u{1F629}","\u{1F60F}","\u{1F495}","\u{1F64C}","\u{1F618}"],_n='"Twemoji Mozilla","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji","EmojiOne Color","Android Emoji",sans-serif',zc=(e,t)=>e<t?-1:e>t?1:0,pn=(e,t)=>{const a=document.createElement("canvas");a.width=a.height=1;const n=a.getContext("2d");return n.textBaseline="top",n.font=`100px ${_n}`,n.fillStyle=t,n.scale(.01,.01),n.fillText(e,0,0),n.getImageData(0,0,1,1).data},qc=(e,t)=>{const a=[...e].join(","),n=[...t].join(",");return a===n&&!a.startsWith("0,0,0,")};function Yc(e){const t=pn(e,"#000"),a=pn(e,"#fff");return t&&a&&qc(t,a)}function Xc(){const e=Object.entries(Hc);try{for(const[t,a]of e)if(Yc(t))return a}catch{}finally{}return e[0][1]}const Fo=new Promise(e=>un(()=>e(Xc()))),Uo=new Map,Gc="\uFE0F",Kc="\uD83C",Zc="\u200D",Wc=127995,Qc=57339;function Jc(e,t){if(t===0)return e;const a=e.indexOf(Zc);return a!==-1?e.substring(0,a)+String.fromCodePoint(Wc+t-1)+e.substring(a):(e.endsWith(Gc)&&(e=e.substring(0,e.length-1)),e+Kc+String.fromCodePoint(Qc+t-1))}function na(e){e.preventDefault(),e.stopPropagation()}function Do(e,t,a){return t+=e?-1:1,t<0?t=a.length-1:t>=a.length&&(t=0),t}function vn(e,t){const a=new Set,n=[];for(const d of e){const s=t(d);a.has(s)||(a.add(s),n.push(d))}return n}function $c(e,t){const a=n=>{const d={};for(const s of n)typeof s.tone=="number"&&s.version<=t&&(d[s.tone]=s.unicode);return d};return e.map(({unicode:n,skins:d,shortcodes:s,url:k,name:C,category:L})=>({unicode:n,name:C,shortcodes:s,url:k,category:L,id:n||C,skins:d&&a(d),title:(s||[]).join(", ")}))}const Wr=requestAnimationFrame;let e1=typeof ResizeObserver=="function";function t1(e,t){let a;return e1?(a=new ResizeObserver(n=>t(n[0].contentRect.width)),a.observe(e)):Wr(()=>t(e.getBoundingClientRect().width)),{destroy(){a&&a.disconnect()}}}function gn(e){{const t=document.createRange();return t.selectNode(e.firstChild),t.getBoundingClientRect().width}}let zo;function a1(e,t,a){for(const n of e){const d=a(n),s=gn(d);typeof zo=="undefined"&&(zo=gn(t));const k=s/1.8<zo;Uo.set(n.unicode,k)}}function r1(e){return vn(e,t=>t)}const{Map:_r}=Bc;function bn(e,t,a){const n=e.slice();return n[63]=t[a],n[65]=a,n}function yn(e,t,a){const n=e.slice();return n[66]=t[a],n[65]=a,n}function xn(e,t,a){const n=e.slice();return n[63]=t[a],n[65]=a,n}function wn(e,t,a){const n=e.slice();return n[69]=t[a],n}function kn(e,t,a){const n=e.slice();return n[72]=t[a],n[65]=a,n}function Sn(e,t){let a,n=t[72]+"",d,s,k,C,L,b;return{key:e,first:null,c(){a=qe("div"),d=Gt(n),J(a,"id",s="skintone-"+t[65]),J(a,"class",k="emoji hide-focus "+(t[65]===t[20]?"active":"")),J(a,"aria-selected",C=t[65]===t[20]),J(a,"role","option"),J(a,"title",L=t[0].skinTones[t[65]]),J(a,"tabindex","-1"),J(a,"aria-label",b=t[0].skinTones[t[65]]),this.first=a},m(R,h){Pt(R,a,h),Ge(a,d)},p(R,h){t=R,h[0]&512&&n!==(n=t[72]+"")&&Kt(d,n),h[0]&512&&s!==(s="skintone-"+t[65])&&J(a,"id",s),h[0]&1049088&&k!==(k="emoji hide-focus "+(t[65]===t[20]?"active":""))&&J(a,"class",k),h[0]&1049088&&C!==(C=t[65]===t[20])&&J(a,"aria-selected",C),h[0]&513&&L!==(L=t[0].skinTones[t[65]])&&J(a,"title",L),h[0]&513&&b!==(b=t[0].skinTones[t[65]])&&J(a,"aria-label",b)},d(R){R&&Ft(a)}}}function En(e,t){let a,n,d=t[69].emoji+"",s,k,C,L,b,R,h;function M(){return t[49](t[69])}return{key:e,first:null,c(){a=qe("button"),n=qe("div"),s=Gt(d),J(n,"class","nav-emoji emoji"),J(a,"role","tab"),J(a,"class","nav-button"),J(a,"aria-controls",k="tab-"+t[69].id),J(a,"aria-label",C=t[0].categories[t[69].name]),J(a,"aria-selected",L=!t[4]&&t[13].id===t[69].id),J(a,"title",b=t[0].categories[t[69].name]),this.first=a},m(w,o){Pt(w,a,o),Ge(a,n),Ge(n,s),R||(h=Ut(a,"click",M),R=!0)},p(w,o){t=w,o[0]&4096&&d!==(d=t[69].emoji+"")&&Kt(s,d),o[0]&4096&&k!==(k="tab-"+t[69].id)&&J(a,"aria-controls",k),o[0]&4097&&C!==(C=t[0].categories[t[69].name])&&J(a,"aria-label",C),o[0]&12304&&L!==(L=!t[4]&&t[13].id===t[69].id)&&J(a,"aria-selected",L),o[0]&4097&&b!==(b=t[0].categories[t[69].name])&&J(a,"title",b)},d(w){w&&Ft(a),R=!1,h()}}}function o1(e){let t,a;return{c(){t=qe("img"),J(t,"class","custom-emoji"),Xr(t.src,a=e[63].url)||J(t,"src",a),J(t,"alt",""),J(t,"loading","lazy")},m(n,d){Pt(n,t,d)},p(n,d){d[0]&32768&&!Xr(t.src,a=n[63].url)&&J(t,"src",a)},d(n){n&&Ft(t)}}}function s1(e){let t=e[27](e[63],e[8])+"",a;return{c(){a=Gt(t)},m(n,d){Pt(n,a,d)},p(n,d){d[0]&33024&&t!==(t=n[27](n[63],n[8])+"")&&Kt(a,t)},d(n){n&&Ft(a)}}}function Mn(e,t){let a,n,d,s,k,C,L;function b(M,w){return M[63].unicode?s1:o1}let R=b(t),h=R(t);return{key:e,first:null,c(){a=qe("button"),h.c(),J(a,"role",n=t[4]?"option":"menuitem"),J(a,"aria-selected",d=t[4]?t[65]==t[5]:""),J(a,"aria-label",s=t[28](t[63],t[8])),J(a,"title",k=t[63].title),J(a,"class",C="emoji "+(t[4]&&t[65]===t[5]?"active":"")),J(a,"id",L="emo-"+t[63].id),this.first=a},m(M,w){Pt(M,a,w),h.m(a,null)},p(M,w){t=M,R===(R=b(t))&&h?h.p(t,w):(h.d(1),h=R(t),h&&(h.c(),h.m(a,null))),w[0]&16&&n!==(n=t[4]?"option":"menuitem")&&J(a,"role",n),w[0]&32816&&d!==(d=t[4]?t[65]==t[5]:"")&&J(a,"aria-selected",d),w[0]&33024&&s!==(s=t[28](t[63],t[8]))&&J(a,"aria-label",s),w[0]&32768&&k!==(k=t[63].title)&&J(a,"title",k),w[0]&32816&&C!==(C="emoji "+(t[4]&&t[65]===t[5]?"active":""))&&J(a,"class",C),w[0]&32768&&L!==(L="emo-"+t[63].id)&&J(a,"id",L)},d(M){M&&Ft(a),h.d()}}}function Rn(e,t){let a,n=(t[4]?t[0].searchResultsLabel:t[66].category?t[66].category:t[15].length>1?t[0].categories.custom:t[0].categories[t[13].name])+"",d,s,k,C,L=[],b=new _r,R,h,M,w=t[66].emojis;const o=F=>F[63].id;for(let F=0;F<w.length;F+=1){let H=xn(t,w,F),V=o(H);b.set(V,L[F]=Mn(V,H))}return{key:e,first:null,c(){a=qe("div"),d=Gt(n),C=qe("div");for(let F=0;F<L.length;F+=1)L[F].c();J(a,"id",s="menu-label-"+t[65]),J(a,"class",k="category "+(t[15].length===1&&t[15][0].category===""?"gone":"")),J(a,"aria-hidden","true"),J(C,"class","emoji-menu"),J(C,"role",R=t[4]?"listbox":"menu"),J(C,"aria-labelledby",h="menu-label-"+t[65]),J(C,"id",M=t[4]?"search-results":""),this.first=a},m(F,H){Pt(F,a,H),Ge(a,d),Pt(F,C,H);for(let V=0;V<L.length;V+=1)L[V].m(C,null)},p(F,H){t=F,H[0]&40977&&n!==(n=(t[4]?t[0].searchResultsLabel:t[66].category?t[66].category:t[15].length>1?t[0].categories.custom:t[0].categories[t[13].name])+"")&&Kt(d,n),H[0]&32768&&s!==(s="menu-label-"+t[65])&&J(a,"id",s),H[0]&32768&&k!==(k="category "+(t[15].length===1&&t[15][0].category===""?"gone":""))&&J(a,"class",k),H[0]&402686256&&(w=t[66].emojis,L=fr(L,H,o,1,t,w,b,C,ur,Mn,null,xn)),H[0]&16&&R!==(R=t[4]?"listbox":"menu")&&J(C,"role",R),H[0]&32768&&h!==(h="menu-label-"+t[65])&&J(C,"aria-labelledby",h),H[0]&16&&M!==(M=t[4]?"search-results":"")&&J(C,"id",M)},d(F){F&&Ft(a),F&&Ft(C);for(let H=0;H<L.length;H+=1)L[H].d()}}}function n1(e){let t,a;return{c(){t=qe("img"),J(t,"class","custom-emoji"),Xr(t.src,a=e[63].url)||J(t,"src",a),J(t,"alt",""),J(t,"loading","lazy")},m(n,d){Pt(n,t,d)},p(n,d){d[0]&1024&&!Xr(t.src,a=n[63].url)&&J(t,"src",a)},d(n){n&&Ft(t)}}}function i1(e){let t=e[27](e[63],e[8])+"",a;return{c(){a=Gt(t)},m(n,d){Pt(n,a,d)},p(n,d){d[0]&1280&&t!==(t=n[27](n[63],n[8])+"")&&Kt(a,t)},d(n){n&&Ft(a)}}}function Tn(e,t){let a,n,d,s;function k(b,R){return b[63].unicode?i1:n1}let C=k(t),L=C(t);return{key:e,first:null,c(){a=qe("button"),L.c(),J(a,"role","menuitem"),J(a,"aria-label",n=t[28](t[63],t[8])),J(a,"title",d=t[63].title),J(a,"class","emoji"),J(a,"id",s="fav-"+t[63].id),this.first=a},m(b,R){Pt(b,a,R),L.m(a,null)},p(b,R){t=b,C===(C=k(t))&&L?L.p(t,R):(L.d(1),L=C(t),L&&(L.c(),L.m(a,null))),R[0]&1280&&n!==(n=t[28](t[63],t[8]))&&J(a,"aria-label",n),R[0]&1024&&d!==(d=t[63].title)&&J(a,"title",d),R[0]&1024&&s!==(s="fav-"+t[63].id)&&J(a,"id",s)},d(b){b&&Ft(a),L.d()}}}function l1(e){let t,a,n,d,s,k,C,L,b,R=e[0].searchLabel+"",h,M,w=e[0].searchDescription+"",o,F,H,V,c,A,N,E=e[0].skinToneDescription+"",O,l,x=[],y=new _r,m,f,p,u,v,_=[],I=new _r,G,U,z,i,g,K,W,ie,he=[],ue=new _r,de,Se,ve,ce,Re,He=[],Oe=new _r,De,Pe,Fe,Ze,pt,lt,rt=e[9];const vt=le=>le[72];for(let le=0;le<rt.length;le+=1){let ge=kn(e,rt,le),te=vt(ge);y.set(te,x[le]=Sn(te,ge))}let Et=e[12];const Bt=le=>le[69].id;for(let le=0;le<Et.length;le+=1){let ge=wn(e,Et,le),te=Bt(ge);I.set(te,_[le]=En(te,ge))}let it=e[15];const Ht=le=>le[66].category;for(let le=0;le<it.length;le+=1){let ge=yn(e,it,le),te=Ht(ge);ue.set(te,he[le]=Rn(te,ge))}let gt=e[10];const ct=le=>le[63].id;for(let le=0;le<gt.length;le+=1){let ge=bn(e,gt,le),te=ct(ge);Oe.set(te,He[le]=Tn(te,ge))}return{c(){t=qe("section"),a=qe("div"),n=qe("div"),d=qe("div"),s=qe("input"),b=qe("label"),h=Gt(R),M=qe("span"),o=Gt(w),F=qe("div"),H=qe("button"),V=Gt(e[21]),N=qe("span"),O=Gt(E),l=qe("div");for(let le=0;le<x.length;le+=1)x[le].c();v=qe("div");for(let le=0;le<_.length;le+=1)_[le].c();U=qe("div"),z=qe("div"),i=qe("div"),g=Gt(e[18]),W=qe("div"),ie=qe("div");for(let le=0;le<he.length;le+=1)he[le].c();Re=qe("div");for(let le=0;le<He.length;le+=1)He[le].c();Fe=qe("button"),Fe.textContent="\u{1F600}",J(a,"class","pad-top"),J(s,"id","search"),J(s,"class","search"),J(s,"type","search"),J(s,"role","combobox"),J(s,"enterkeyhint","search"),J(s,"placeholder",k=e[0].searchLabel),J(s,"autocapitalize","none"),J(s,"autocomplete","off"),J(s,"spellcheck","true"),J(s,"aria-expanded",C=!!(e[4]&&e[1].length)),J(s,"aria-controls","search-results"),J(s,"aria-describedby","search-description"),J(s,"aria-autocomplete","list"),J(s,"aria-activedescendant",L=e[26]?`emo-${e[26]}`:""),J(b,"class","sr-only"),J(b,"for","search"),J(M,"id","search-description"),J(M,"class","sr-only"),J(d,"class","search-wrapper"),J(H,"id","skintone-button"),J(H,"class",c="emoji "+(e[6]?"hide-focus":"")),J(H,"aria-label",e[23]),J(H,"title",e[23]),J(H,"aria-describedby","skintone-description"),J(H,"aria-haspopup","listbox"),J(H,"aria-expanded",e[6]),J(H,"aria-controls","skintone-list"),J(F,"class",A="skintone-button-wrapper "+(e[19]?"expanded":"")),J(N,"id","skintone-description"),J(N,"class","sr-only"),J(l,"id","skintone-list"),J(l,"class",m="skintone-list "+(e[6]?"":"hidden no-animate")),sa(l,"transform","translateY("+(e[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),J(l,"role","listbox"),J(l,"aria-label",f=e[0].skinTonesLabel),J(l,"aria-activedescendant",p="skintone-"+e[20]),J(l,"aria-hidden",u=!e[6]),J(n,"class","search-row"),J(v,"class","nav"),J(v,"role","tablist"),sa(v,"grid-template-columns","repeat("+e[12].length+", 1fr)"),J(v,"aria-label",G=e[0].categoriesLabel),J(z,"class","indicator"),sa(z,"transform","translateX("+(e[24]?-1:1)*e[11]*100+"%)"),J(U,"class","indicator-wrapper"),J(i,"class",K="message "+(e[18]?"":"gone")),J(i,"role","alert"),J(i,"aria-live","polite"),J(W,"class",de="tabpanel "+(!e[14]||e[18]?"gone":"")),J(W,"role",Se=e[4]?"region":"tabpanel"),J(W,"aria-label",ve=e[4]?e[0].searchResultsLabel:e[0].categories[e[13].name]),J(W,"id",ce=e[4]?"":`tab-${e[13].id}`),J(W,"tabindex","0"),J(Re,"class",De="favorites emoji-menu "+(e[18]?"gone":"")),J(Re,"role","menu"),J(Re,"aria-label",Pe=e[0].favoritesLabel),sa(Re,"padding-inline-end",e[25]+"px"),J(Fe,"aria-hidden","true"),J(Fe,"tabindex","-1"),J(Fe,"class","abs-pos hidden emoji"),J(t,"class","picker"),J(t,"aria-label",Ze=e[0].regionLabel),J(t,"style",e[22])},m(le,ge){Pt(le,t,ge),Ge(t,a),Ge(t,n),Ge(n,d),Ge(d,s),sn(s,e[2]),Ge(d,b),Ge(b,h),Ge(d,M),Ge(M,o),Ge(n,F),Ge(F,H),Ge(H,V),Ge(n,N),Ge(N,O),Ge(n,l);for(let te=0;te<x.length;te+=1)x[te].m(l,null);e[48](l),Ge(t,v);for(let te=0;te<_.length;te+=1)_[te].m(v,null);Ge(t,U),Ge(U,z),Ge(t,i),Ge(i,g),Ge(t,W),Ge(W,ie);for(let te=0;te<he.length;te+=1)he[te].m(ie,null);e[50](W),Ge(t,Re);for(let te=0;te<He.length;te+=1)He[te].m(Re,null);Ge(t,Fe),e[51](Fe),e[52](t),pt||(lt=[Ut(s,"input",e[47]),Ut(s,"keydown",e[30]),Ut(H,"click",e[35]),Ut(l,"focusout",e[38]),Ut(l,"click",e[34]),Ut(l,"keydown",e[36]),Ut(l,"keyup",e[37]),Ut(v,"keydown",e[32]),Ec(e[29].call(null,ie)),Ut(W,"click",e[33]),Ut(Re,"click",e[33])],pt=!0)},p(le,ge){ge[0]&1&&k!==(k=le[0].searchLabel)&&J(s,"placeholder",k),ge[0]&18&&C!==(C=!!(le[4]&&le[1].length))&&J(s,"aria-expanded",C),ge[0]&67108864&&L!==(L=le[26]?`emo-${le[26]}`:"")&&J(s,"aria-activedescendant",L),ge[0]&4&&sn(s,le[2]),ge[0]&1&&R!==(R=le[0].searchLabel+"")&&Kt(h,R),ge[0]&1&&w!==(w=le[0].searchDescription+"")&&Kt(o,w),ge[0]&2097152&&Kt(V,le[21]),ge[0]&64&&c!==(c="emoji "+(le[6]?"hide-focus":""))&&J(H,"class",c),ge[0]&8388608&&J(H,"aria-label",le[23]),ge[0]&8388608&&J(H,"title",le[23]),ge[0]&64&&J(H,"aria-expanded",le[6]),ge[0]&524288&&A!==(A="skintone-button-wrapper "+(le[19]?"expanded":""))&&J(F,"class",A),ge[0]&1&&E!==(E=le[0].skinToneDescription+"")&&Kt(O,E),ge[0]&1049089&&(rt=le[9],x=fr(x,ge,vt,1,le,rt,y,l,ur,Sn,null,kn)),ge[0]&64&&m!==(m="skintone-list "+(le[6]?"":"hidden no-animate"))&&J(l,"class",m),ge[0]&64&&sa(l,"transform","translateY("+(le[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),ge[0]&1&&f!==(f=le[0].skinTonesLabel)&&J(l,"aria-label",f),ge[0]&1048576&&p!==(p="skintone-"+le[20])&&J(l,"aria-activedescendant",p),ge[0]&64&&u!==(u=!le[6])&&J(l,"aria-hidden",u),ge[0]&12305|ge[1]&1&&(Et=le[12],_=fr(_,ge,Bt,1,le,Et,I,v,ur,En,null,wn)),ge[0]&4096&&sa(v,"grid-template-columns","repeat("+le[12].length+", 1fr)"),ge[0]&1&&G!==(G=le[0].categoriesLabel)&&J(v,"aria-label",G),ge[0]&16779264&&sa(z,"transform","translateX("+(le[24]?-1:1)*le[11]*100+"%)"),ge[0]&262144&&Kt(g,le[18]),ge[0]&262144&&K!==(K="message "+(le[18]?"":"gone"))&&J(i,"class",K),ge[0]&402694449&&(it=le[15],he=fr(he,ge,Ht,1,le,it,ue,ie,ur,Rn,null,yn)),ge[0]&278528&&de!==(de="tabpanel "+(!le[14]||le[18]?"gone":""))&&J(W,"class",de),ge[0]&16&&Se!==(Se=le[4]?"region":"tabpanel")&&J(W,"role",Se),ge[0]&8209&&ve!==(ve=le[4]?le[0].searchResultsLabel:le[0].categories[le[13].name])&&J(W,"aria-label",ve),ge[0]&8208&&ce!==(ce=le[4]?"":`tab-${le[13].id}`)&&J(W,"id",ce),ge[0]&402654464&&(gt=le[10],He=fr(He,ge,ct,1,le,gt,Oe,Re,ur,Tn,null,bn)),ge[0]&262144&&De!==(De="favorites emoji-menu "+(le[18]?"gone":""))&&J(Re,"class",De),ge[0]&1&&Pe!==(Pe=le[0].favoritesLabel)&&J(Re,"aria-label",Pe),ge[0]&33554432&&sa(Re,"padding-inline-end",le[25]+"px"),ge[0]&1&&Ze!==(Ze=le[0].regionLabel)&&J(t,"aria-label",Ze),ge[0]&4194304&&J(t,"style",le[22])},i:cr,o:cr,d(le){le&&Ft(t);for(let ge=0;ge<x.length;ge+=1)x[ge].d();e[48](null);for(let ge=0;ge<_.length;ge+=1)_[ge].d();for(let ge=0;ge<he.length;ge+=1)he[ge].d();e[50](null);for(let ge=0;ge<He.length;ge+=1)He[ge].d();e[51](null),e[52](null),pt=!1,dr(lt)}}}function c1(e,t,a){let{skinToneEmoji:n}=t,{i18n:d}=t,{database:s}=t,{customEmoji:k}=t,{customCategorySorting:C}=t,L=!0,b=[],R=[],h="",M="",w,o,F,H=!1,V=-1,c,A=!1,N=!1,E,O=0,l=0,x,y,m="",f=[],p=[],u,v=Uc,_=!1,I=0,G=0,U=Zr,z,i=!1,g;const K=te=>{w.getRootNode().getElementById(te).focus()},W=(te,ye)=>{w.dispatchEvent(new CustomEvent(te,{detail:ye,bubbles:!0,composed:!0}))},ie=(te,ye)=>ye&&te.skins&&te.skins[ye]||te.unicode,he=(te,ye)=>r1([te.name||ie(te,ye),...te.shortcodes||[]]).join(", "),ue=te=>/^skintone-/.test(te.id);Fo.then(te=>{te||a(18,c=d.emojiUnsupportedMessage)});function de(te){return t1(te,ye=>{{const S=getComputedStyle(w),B=parseInt(S.getPropertyValue("--num-columns"),10),P=S.getPropertyValue("direction")==="rtl",Y=te.parentElement.getBoundingClientRect().width-ye;a(46,v=B),a(25,I=Y),a(24,_=P)}})}function Se(te){const ye=w.getRootNode();a1(te,o,B=>ye.getElementById(`emo-${B.id}`)),a(1,b=b)}function ve(te){return!te.unicode||!fn(te)||Uo.get(te.unicode)}async function ce(te){const ye=await Fo;return te.filter(({version:S})=>!S||S<=ye)}async function Re(te){return $c(te,await Fo)}async function He(te){if(typeof te=="undefined")return[];const ye=te===-1?k:await s.getEmojiByGroup(te);return Re(await ce(ye))}async function Oe(te){return Re(await ce(await s.getEmojiBySearchQuery(te)))}function De(te){if(!H||!b.length)return;const ye=S=>{na(te),a(5,V=Do(S,V,b))};switch(te.key){case"ArrowDown":return ye(!1);case"ArrowUp":return ye(!0);case"Enter":if(V!==-1)return na(te),Ze(b[V].id);b.length&&a(5,V=0)}}function Pe(te){a(2,h=""),a(44,M=""),a(5,V=-1),a(11,G=U.findIndex(ye=>ye.id===te.id))}function Fe(te){const{target:ye,key:S}=te,B=P=>{P&&(na(te),P.focus())};switch(S){case"ArrowLeft":return B(ye.previousSibling);case"ArrowRight":return B(ye.nextSibling);case"Home":return B(ye.parentElement.firstChild);case"End":return B(ye.parentElement.lastChild)}}async function Ze(te){const ye=await s.getEmojiByUnicodeOrName(te),S=[...b,...p].find(P=>P.id===te),B=S.unicode&&ie(S,O);await s.incrementFavoriteEmojiCount(te),W("emoji-click",{emoji:ye,skinTone:O,...B&&{unicode:B},...S.name&&{name:S.name}})}async function pt(te){const{target:ye}=te;if(!ye.classList.contains("emoji"))return;na(te);const S=ye.id.substring(4);Ze(S)}async function lt(te){const{target:ye}=te;if(!ue(ye))return;na(te);const S=parseInt(ye.id.slice(9),10);a(8,O=S),a(6,A=!1),K("skintone-button"),W("skin-tone-change",{skinTone:S}),s.setPreferredSkinTone(S)}async function rt(te){a(6,A=!A),a(20,l=O),A&&(na(te),Wr(()=>K(`skintone-${l}`)))}function vt(te){if(!A)return;const ye=async S=>{na(te),a(20,l=S),await Mc(),K(`skintone-${l}`)};switch(te.key){case"ArrowUp":return ye(Do(!0,l,f));case"ArrowDown":return ye(Do(!1,l,f));case"Home":return ye(0);case"End":return ye(f.length-1);case"Enter":return lt(te);case"Escape":return na(te),a(6,A=!1),K("skintone-button")}}function Et(te){if(!!A)switch(te.key){case" ":return lt(te)}}async function Bt(te){const{relatedTarget:ye}=te;(!ye||!ue(ye))&&a(6,A=!1)}function it(){h=this.value,a(2,h)}function Ht(te){Ha[te?"unshift":"push"](()=>{E=te,a(7,E)})}const gt=te=>Pe(te);function ct(te){Ha[te?"unshift":"push"](()=>{F=te,a(3,F)})}function le(te){Ha[te?"unshift":"push"](()=>{o=te,a(17,o)})}function ge(te){Ha[te?"unshift":"push"](()=>{w=te,a(16,w)})}return e.$$set=te=>{"skinToneEmoji"in te&&a(40,n=te.skinToneEmoji),"i18n"in te&&a(0,d=te.i18n),"database"in te&&a(39,s=te.database),"customEmoji"in te&&a(41,k=te.customEmoji),"customCategorySorting"in te&&a(42,C=te.customCategorySorting)},e.$$.update=()=>{if(e.$$.dirty[1]&1280&&k&&s&&a(39,s.customEmoji=k,s),e.$$.dirty[0]&1|e.$$.dirty[1]&256){async function te(){let ye=!1;const S=setTimeout(()=>{ye=!0,a(18,c=d.loadingMessage)},Pc);try{await s.ready(),a(14,i=!0)}catch(B){console.error(B),a(18,c=d.networkErrorMessage)}finally{clearTimeout(S),ye&&(ye=!1,a(18,c=""))}}s&&te()}if(e.$$.dirty[0]&6144|e.$$.dirty[1]&1024&&(k&&k.length?a(12,U=[jc,...Zr]):U!==Zr&&(G&&a(11,G--,G),a(12,U=Zr))),e.$$.dirty[0]&4&&un(()=>{a(44,M=(h||"").trim()),a(5,V=-1)}),e.$$.dirty[0]&6144&&a(13,z=U[G]),e.$$.dirty[0]&24576|e.$$.dirty[1]&8192){async function te(){if(!i)a(1,b=[]),a(4,H=!1);else if(M.length>=Vc){const ye=M,S=await Oe(ye);ye===M&&(a(1,b=S),a(4,H=!0))}else if(z){const ye=z.id,S=await He(ye);ye===z.id&&(a(1,b=S),a(4,H=!1))}}te()}if(e.$$.dirty[0]&4112&&a(22,y=`
  --font-family: ${_n};
  --num-groups: ${U.length}; 
  --indicator-opacity: ${H?0:1}; 
  --num-skintones: ${hn};`),e.$$.dirty[0]&16384|e.$$.dirty[1]&256){async function te(){i&&a(8,O=await s.getPreferredSkinTone())}te()}if(e.$$.dirty[1]&512&&a(9,f=Array(hn).fill().map((te,ye)=>Jc(n,ye))),e.$$.dirty[0]&768&&a(21,x=f[O]),e.$$.dirty[0]&257&&a(23,m=d.skinToneLabel.replace("{skinTone}",d.skinTones[O])),e.$$.dirty[0]&16384|e.$$.dirty[1]&256){async function te(){a(45,u=(await Promise.all(Dc.map(ye=>s.getEmojiByUnicodeOrName(ye)))).filter(Boolean))}i&&te()}if(e.$$.dirty[0]&16384|e.$$.dirty[1]&49408){async function te(){const ye=await s.getTopFavoriteEmoji(v),S=await Re(vn([...ye,...u],B=>B.unicode||B.name).slice(0,v));a(10,p=S)}i&&u&&te()}if(e.$$.dirty[0]&10){const te=b.filter(ye=>ye.unicode).filter(ye=>fn(ye)&&!Uo.has(ye.unicode));te.length?Wr(()=>Se(te)):(a(1,b=b.filter(ve)),Wr(()=>{(F||{}).scrollTop=0}))}e.$$.dirty[0]&1026|e.$$.dirty[1]&4096,e.$$.dirty[0]&18|e.$$.dirty[1]&2048&&a(15,R=function(){if(H)return[{category:"",emojis:b}];const ye=new Map;for(const S of b){const B=S.category||"";let P=ye.get(B);P||(P=[],ye.set(B,P)),P.push(S)}return[...ye.entries()].map(([S,B])=>({category:S,emojis:B})).sort((S,B)=>C(S.category,B.category))}()),e.$$.dirty[0]&34&&a(26,g=V!==-1&&b[V].id),e.$$.dirty[0]&192&&(A?E.addEventListener("transitionend",()=>{a(19,N=!0)},{once:!0}):a(19,N=!1))},[d,b,h,F,H,V,A,E,O,f,p,G,U,z,i,R,w,o,c,N,l,x,y,m,_,I,g,ie,he,de,De,Pe,Fe,pt,lt,rt,vt,Et,Bt,s,n,k,C,L,M,u,v,it,Ht,gt,ct,le,ge]}class d1 extends Ic{constructor(t){super(),Lc(this,t,c1,l1,kc,{skinToneEmoji:40,i18n:0,database:39,customEmoji:41,customCategorySorting:42},null,[-1,-1,-1])}}const m1="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",h1="en";var u1={categoriesLabel:"Categories",emojiUnsupportedMessage:"Your browser does not support color emoji.",favoritesLabel:"Favorites",loadingMessage:"Loading\u2026",networkErrorMessage:"Could not load emoji.",regionLabel:"Emoji picker",searchDescription:"When search results are available, press up or down to select and enter to choose.",searchLabel:"Search",searchResultsLabel:"Search results",skinToneDescription:"When expanded, press up or down to select and enter to choose.",skinToneLabel:"Choose a skin tone (currently {skinTone})",skinTonesLabel:"Skin tones",skinTones:["Default","Light","Medium-Light","Medium","Medium-Dark","Dark"],categories:{custom:"Custom","smileys-emotion":"Smileys and emoticons","people-body":"People and body","animals-nature":"Animals and nature","food-drink":"Food and drink","travel-places":"Travel and places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"}};const An=["customEmoji","customCategorySorting","database","dataSource","i18n","locale","skinToneEmoji"];class Bn extends HTMLElement{constructor(t){super(),this.attachShadow({mode:"open"});const a=document.createElement("style");a.textContent=":host{--emoji-size:1.375rem;--emoji-padding:0.5rem;--category-emoji-size:var(--emoji-size);--category-emoji-padding:var(--emoji-padding);--indicator-height:3px;--input-border-radius:0.5rem;--input-border-size:1px;--input-font-size:1rem;--input-line-height:1.5;--input-padding:0.25rem;--num-columns:8;--outline-size:2px;--border-size:1px;--skintone-border-radius:1rem;--category-font-size:1rem;display:flex;width:min-content;height:400px}:host,:host(.light){--background:#fff;--border-color:#e0e0e0;--indicator-color:#385ac1;--input-border-color:#999;--input-font-color:#111;--input-placeholder-color:#999;--outline-color:#999;--category-font-color:#111;--button-active-background:#e6e6e6;--button-hover-background:#d9d9d9}:host(.dark){--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}@media (prefers-color-scheme:dark){:host{--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}}:host([hidden]){display:none}button{margin:0;padding:0;border:0;background:0 0;box-shadow:none;-webkit-tap-highlight-color:transparent}button::-moz-focus-inner{border:0}input{padding:0;margin:0;line-height:1.15;font-family:inherit}input[type=search]{-webkit-appearance:none}:focus{outline:var(--outline-color) solid var(--outline-size);outline-offset:calc(-1*var(--outline-size))}:host([data-js-focus-visible]) :focus:not([data-focus-visible-added]){outline:0}:focus:not(:focus-visible){outline:0}.hide-focus{outline:0}*{box-sizing:border-box}.picker{contain:content;display:flex;flex-direction:column;background:var(--background);border:var(--border-size) solid var(--border-color);width:100%;height:100%;overflow:hidden;--total-emoji-size:calc(var(--emoji-size) + (2 * var(--emoji-padding)));--total-category-emoji-size:calc(var(--category-emoji-size) + (2 * var(--category-emoji-padding)))}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.hidden{opacity:0;pointer-events:none}.abs-pos{position:absolute;left:0;top:0}.gone{display:none!important}.skintone-button-wrapper,.skintone-list{background:var(--background);z-index:3}.skintone-button-wrapper.expanded{z-index:1}.skintone-list{position:absolute;inset-inline-end:0;top:0;z-index:2;overflow:visible;border-bottom:var(--border-size) solid var(--border-color);border-radius:0 0 var(--skintone-border-radius) var(--skintone-border-radius);will-change:transform;transition:transform .2s ease-in-out;transform-origin:center 0}@media (prefers-reduced-motion:reduce){.skintone-list{transition-duration:.001s}}@supports not (inset-inline-end:0){.skintone-list{right:0}}.skintone-list.no-animate{transition:none}.tabpanel{overflow-y:auto;-webkit-overflow-scrolling:touch;will-change:transform;min-height:0;flex:1;contain:content}.emoji-menu{display:grid;grid-template-columns:repeat(var(--num-columns),var(--total-emoji-size));justify-content:space-around;align-items:flex-start;width:100%}.category{padding:var(--emoji-padding);font-size:var(--category-font-size);color:var(--category-font-color)}.custom-emoji,.emoji,button.emoji{height:var(--total-emoji-size);width:var(--total-emoji-size)}.emoji,button.emoji{font-size:var(--emoji-size);display:flex;align-items:center;justify-content:center;border-radius:100%;line-height:1;overflow:hidden;font-family:var(--font-family);cursor:pointer}@media (hover:hover) and (pointer:fine){.emoji:hover,button.emoji:hover{background:var(--button-hover-background)}}.emoji.active,.emoji:active,button.emoji.active,button.emoji:active{background:var(--button-active-background)}.custom-emoji{padding:var(--emoji-padding);object-fit:contain;pointer-events:none;background-repeat:no-repeat;background-position:center center;background-size:var(--emoji-size) var(--emoji-size)}.nav,.nav-button{align-items:center}.nav{display:grid;justify-content:space-between;contain:content}.nav-button{display:flex;justify-content:center}.nav-emoji{font-size:var(--category-emoji-size);width:var(--total-category-emoji-size);height:var(--total-category-emoji-size)}.indicator-wrapper{display:flex;border-bottom:1px solid var(--border-color)}.indicator{width:calc(100%/var(--num-groups));height:var(--indicator-height);opacity:var(--indicator-opacity);background-color:var(--indicator-color);will-change:transform,opacity;transition:opacity .1s linear,transform .25s ease-in-out}@media (prefers-reduced-motion:reduce){.indicator{will-change:opacity;transition:opacity .1s linear}}.pad-top,input.search{background:var(--background);width:100%}.pad-top{height:var(--emoji-padding);z-index:3}.search-row{display:flex;align-items:center;position:relative;padding-inline-start:var(--emoji-padding);padding-bottom:var(--emoji-padding)}.search-wrapper{flex:1;min-width:0}input.search{padding:var(--input-padding);border-radius:var(--input-border-radius);border:var(--input-border-size) solid var(--input-border-color);color:var(--input-font-color);font-size:var(--input-font-size);line-height:var(--input-line-height)}input.search::placeholder{color:var(--input-placeholder-color)}.favorites{display:flex;flex-direction:row;border-top:var(--border-size) solid var(--border-color);contain:content}.message{padding:var(--emoji-padding)}",this.shadowRoot.appendChild(a),this._ctx={locale:h1,dataSource:m1,skinToneEmoji:Fc,customCategorySorting:zc,customEmoji:null,i18n:u1,...t};for(const n of An)n!=="database"&&Object.prototype.hasOwnProperty.call(this,n)&&(this._ctx[n]=this[n],delete this[n]);this._dbFlush()}connectedCallback(){this._cmp=new d1({target:this.shadowRoot,props:this._ctx})}disconnectedCallback(){this._cmp.$destroy(),this._cmp=void 0;const{database:t}=this._ctx;t&&t.close().catch(a=>console.error(a))}static get observedAttributes(){return["locale","data-source","skin-tone-emoji"]}attributeChangedCallback(t,a,n){this._set(t.replace(/-([a-z])/g,(d,s)=>s.toUpperCase()),n)}_set(t,a){this._ctx[t]=a,this._cmp&&this._cmp.$set({[t]:a}),["locale","dataSource"].includes(t)&&this._dbFlush()}_dbCreate(){const{locale:t,dataSource:a,database:n}=this._ctx;(!n||n.locale!==t||n.dataSource!==a)&&this._set("database",new tn({locale:t,dataSource:a}))}_dbFlush(){Promise.resolve().then(()=>this._dbCreate())}}const Cn={};for(const e of An)Cn[e]={get(){return e==="database"&&this._dbCreate(),this._ctx[e]},set(t){if(e==="database")throw new Error("database is read-only");this._set(e,t)}};Object.defineProperties(Bn.prototype,Cn),customElements.get("emoji-picker")||customElements.define("emoji-picker",Bn);const f1={name:"EmojiPickerContainer",components:{SvgIcon:mt},props:{emojiOpened:{type:Boolean,default:!1},emojiReaction:{type:Boolean,default:!1},positionTop:{type:Boolean,default:!1},positionRight:{type:Boolean,default:!1}},emits:["add-emoji","open-emoji"],data(){return{emojiPickerHeight:320,emojiPickerTop:0,emojiPickerRight:""}},watch:{emojiOpened(e){e&&setTimeout(()=>{this.addCustomStyling(),this.$refs.emojiPicker.shadowRoot.addEventListener("emoji-click",({detail:t})=>{this.$emit("add-emoji",{unicode:t.unicode})})},0)}},methods:{addCustomStyling(){const e=`.picker {
				border: none;
			}`,t=`.nav {
				overflow-x: auto;
			}`,a=`.search-wrapper {
				padding-right: 2px;
				padding-left: 2px;
			}`,n=`input.search {
				height: 32px;
				font-size: 14px;
				border-radius: 10rem;
				border: var(--chat-border-style);
				padding: 5px 10px;
				outline: none;
				background: var(--chat-bg-color-input);
				color: var(--chat-color);
			}`,d=document.createElement("style");d.textContent=e+t+a+n,this.$refs.emojiPicker.shadowRoot.appendChild(d)},openEmoji(e){this.$emit("open-emoji",!this.emojiOpened),this.setEmojiPickerPosition(e.clientY,e.view.innerWidth,e.view.innerHeight)},setEmojiPickerPosition(e,t,a){const n=t<500||a<700,d=document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer");if(!d){n&&(this.emojiPickerRight="-50px");return}n?(this.emojiPickerRight=t/2-(this.positionTop?200:150)+"px",this.emojiPickerTop=100,this.emojiPickerHeight=a-200):(d.getBoundingClientRect().top-e>this.emojiPickerHeight-50?this.emojiPickerTop=e+10:this.emojiPickerTop=e-this.emojiPickerHeight-10,this.emojiPickerRight=this.positionTop?"0px":this.positionRight?"60px":"")}}},_1={class:"vac-emoji-wrapper"},p1={ref:"emojiPicker","v-if":"emojiOpened"};function v1(e,t,a,n,d,s){const k=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",_1,[r.createElementVNode("div",{class:r.normalizeClass(["vac-svg-button",{"vac-emoji-reaction":a.emojiReaction}]),onClick:t[0]||(t[0]=(...C)=>s.openEmoji&&s.openEmoji(...C))},[r.renderSlot(e.$slots,"emoji-picker-icon",{},()=>[r.createVNode(k,{name:"emoji",param:a.emojiReaction?"reaction":""},null,8,["param"])])],2),a.emojiOpened?(r.openBlock(),r.createBlock(r.Transition,{key:0,name:"vac-slide-up",appear:""},{default:r.withCtx(()=>[r.createElementVNode("div",{class:r.normalizeClass(["vac-emoji-picker",{"vac-picker-reaction":a.emojiReaction}]),style:r.normalizeStyle({height:`${d.emojiPickerHeight}px`,top:a.positionTop?d.emojiPickerHeight:`${d.emojiPickerTop}px`,right:d.emojiPickerRight,display:d.emojiPickerTop||!a.emojiReaction?"initial":"none"})},[r.createElementVNode("emoji-picker",p1,null,512)],6)]),_:1})):r.createCommentVNode("",!0)])}var On=Ye(f1,[["render",v1]]);const g1={name:"RoomFiles",components:{Loader:Rr,SvgIcon:mt},props:{file:{type:Object,required:!0},index:{type:Number,required:!0}},emits:["remove-file"],computed:{isImage(){return La(this.file)},isVideo(){return ir(this.file)}}},b1={class:"vac-room-file-container"},y1=["src"],x1={class:"vac-text-ellipsis"},w1={key:0,class:"vac-text-ellipsis vac-text-extension"};function k1(e,t,a,n,d,s){const k=r.resolveComponent("loader"),C=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",b1,[r.createVNode(k,{show:a.file.loading},r.createSlots({_:2},[r.renderList(e.$slots,(L,b)=>({name:b,fn:r.withCtx(R=>[r.renderSlot(e.$slots,b,r.normalizeProps(r.guardReactiveProps(R)))])}))]),1032,["show"]),r.createElementVNode("div",{class:"vac-svg-button vac-icon-remove",onClick:t[0]||(t[0]=L=>e.$emit("remove-file",a.index))},[r.renderSlot(e.$slots,"image-close-icon",{},()=>[r.createVNode(C,{name:"close",param:"image"})])]),s.isImage?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-message-image",{"vac-blur-loading":a.file.loading}]),style:r.normalizeStyle({"background-image":`url('${a.file.localUrl||a.file.url}')`})},null,6)):s.isVideo?(r.openBlock(),r.createElementBlock("video",{key:1,controls:"",class:r.normalizeClass({"vac-blur-loading":a.file.loading})},[r.createElementVNode("source",{src:a.file.localUrl||a.file.url},null,8,y1)],2)):(r.openBlock(),r.createElementBlock("div",{key:2,class:r.normalizeClass(["vac-file-container",{"vac-blur-loading":a.file.loading}])},[r.createElementVNode("div",null,[r.renderSlot(e.$slots,"file-icon",{},()=>[r.createVNode(C,{name:"file"})])]),r.createElementVNode("div",x1,r.toDisplayString(a.file.name),1),a.file.extension?(r.openBlock(),r.createElementBlock("div",w1,r.toDisplayString(a.file.extension),1)):r.createCommentVNode("",!0)],2))])}var S1=Ye(g1,[["render",k1]]);const E1={name:"RoomFiles",components:{SvgIcon:mt,RoomFile:S1},props:{files:{type:Array,required:!0}},emits:["remove-file","reset-message"],computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight}}},M1={class:"vac-files-box"},R1={class:"vac-icon-close"};function T1(e,t,a,n,d,s){const k=r.resolveComponent("room-file"),C=r.resolveComponent("svg-icon");return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.files.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-room-files-container",style:r.normalizeStyle({bottom:`${s.footerHeight}px`})},[r.createElementVNode("div",M1,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.files,(L,b)=>(r.openBlock(),r.createElementBlock("div",{key:b},[r.createVNode(k,{file:L,index:b,onRemoveFile:t[0]||(t[0]=R=>e.$emit("remove-file",R))},null,8,["file","index"])]))),128))]),r.createElementVNode("div",R1,[r.createElementVNode("div",{class:"vac-svg-button",onClick:t[1]||(t[1]=L=>e.$emit("reset-message"))},[r.renderSlot(e.$slots,"reply-close-icon",{},()=>[r.createVNode(C,{name:"close-outline"})])])])],4)):r.createCommentVNode("",!0)]),_:3})}var A1=Ye(E1,[["render",T1]]);const B1={props:{percentage:{type:Number,default:0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["hover-audio-progress","change-linehead"],data(){return{isMouseDown:!1}},methods:{onMouseDown(e){if(this.messageSelectionEnabled)return;this.isMouseDown=!0;const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)},onMouseUp(e){if(this.messageSelectionEnabled)return;this.isMouseDown=!1,document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove);const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t)},onMouseMove(e){if(this.messageSelectionEnabled)return;const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t)},calculateLineHeadPosition(e,t){const a=t.getBoundingClientRect().width,n=t.getBoundingClientRect().left;let d=(e.clientX-n)/a;return d=d<0?0:d,d=d>1?1:d,d}}},C1={class:"vac-player-progress"},O1={class:"vac-line-container"};function N1(e,t,a,n,d,s){return r.openBlock(),r.createElementBlock("div",{ref:"progress",class:"vac-player-bar",onMousedown:t[0]||(t[0]=(...k)=>s.onMouseDown&&s.onMouseDown(...k)),onMouseover:t[1]||(t[1]=k=>e.$emit("hover-audio-progress",!0)),onMouseout:t[2]||(t[2]=k=>e.$emit("hover-audio-progress",!1))},[r.createElementVNode("div",C1,[r.createElementVNode("div",O1,[r.createElementVNode("div",{class:"vac-line-progress",style:r.normalizeStyle({width:`${a.percentage}%`})},null,4),r.createElementVNode("div",{class:r.normalizeClass(["vac-line-dot",{"vac-line-dot__active":d.isMouseDown}]),style:r.normalizeStyle({left:`${a.percentage}%`})},null,6)])])],544)}var L1=Ye(B1,[["render",N1]]);const I1={name:"AudioPlayer",components:{SvgIcon:mt,AudioControl:L1},props:{messageId:{type:[String,Number],default:null},src:{type:String,default:null},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["hover-audio-progress","update-progress-time"],data(){return{isPlaying:!1,duration:this.convertTimeMMSS(0),playedTime:this.convertTimeMMSS(0),progress:0}},computed:{playerUniqId(){return`audio-player${this.messageId}`},audioSource(){return this.src?this.src:(this.resetProgress(),null)}},mounted(){this.player=document.querySelector("vue-advanced-chat").shadowRoot.getElementById(this.playerUniqId),this.player.addEventListener("ended",()=>{this.isPlaying=!1}),this.player.addEventListener("loadeddata",()=>{this.resetProgress(),this.duration=this.convertTimeMMSS(this.player.duration),this.updateProgressTime()}),this.player.addEventListener("timeupdate",this.onTimeUpdate)},methods:{convertTimeMMSS(e){return new Date(e*1e3).toISOString().substr(14,5)},playback(){this.messageSelectionEnabled||!this.audioSource||(this.isPlaying?this.player.pause():setTimeout(()=>this.player.play()),this.isPlaying=!this.isPlaying)},resetProgress(){this.isPlaying&&this.player.pause(),this.duration=this.convertTimeMMSS(0),this.playedTime=this.convertTimeMMSS(0),this.progress=0,this.isPlaying=!1,this.updateProgressTime()},onTimeUpdate(){this.playedTime=this.convertTimeMMSS(this.player.currentTime),this.progress=this.player.currentTime/this.player.duration*100,this.updateProgressTime()},onUpdateProgress(e){e&&(this.player.currentTime=e*this.player.duration)},updateProgressTime(){this.$emit("update-progress-time",this.progress>1?this.playedTime:this.duration)}}},j1={class:"vac-audio-player"},V1=["id","src"];function H1(e,t,a,n,d,s){const k=r.resolveComponent("svg-icon"),C=r.resolveComponent("audio-control");return r.openBlock(),r.createElementBlock("div",null,[r.createElementVNode("div",j1,[r.createElementVNode("div",{class:"vac-svg-button",onClick:t[0]||(t[0]=(...L)=>s.playback&&s.playback(...L))},[d.isPlaying?r.renderSlot(e.$slots,"audio-pause-icon",{key:0},()=>[r.createVNode(k,{name:"audio-pause"})]):r.renderSlot(e.$slots,"audio-play-icon",{key:1},()=>[r.createVNode(k,{name:"audio-play"})])]),r.createVNode(C,{percentage:d.progress,"message-selection-enabled":a.messageSelectionEnabled,onChangeLinehead:s.onUpdateProgress,onHoverAudioProgress:t[1]||(t[1]=L=>e.$emit("hover-audio-progress",L))},null,8,["percentage","message-selection-enabled","onChangeLinehead"]),r.createElementVNode("audio",{id:s.playerUniqId,src:s.audioSource},null,8,V1)])])}var qo=Ye(I1,[["render",H1]]);const P1={name:"RoomMessageReply",components:{SvgIcon:mt,FormatMessage:sr,AudioPlayer:qo},props:{room:{type:Object,required:!0},messageReply:{type:Object,default:null},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0}},emits:["reset-message"],computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight},firstFile(){var e,t;return(t=(e=this.messageReply)==null?void 0:e.files)!=null&&t.length?this.messageReply.files[0]:{}},isImage(){return La(this.firstFile)},isVideo(){return ir(this.firstFile)},isAudio(){return Hr(this.firstFile)},isOtherFile(){var e,t;return((t=(e=this.messageReply)==null?void 0:e.files)==null?void 0:t.length)&&!this.isAudio&&!this.isVideo&&!this.isImage}}},F1={class:"vac-reply-box"},U1={class:"vac-reply-info"},D1={class:"vac-reply-username"},z1={class:"vac-reply-content"},q1=["src"],Y1={key:1,controls:"",class:"vac-image-reply"},X1=["src"],G1={key:3,class:"vac-image-reply vac-file-container"},K1={class:"vac-text-ellipsis"},Z1={key:0,class:"vac-text-ellipsis vac-text-extension"},W1={class:"vac-icon-reply"};function Q1(e,t,a,n,d,s){const k=r.resolveComponent("format-message"),C=r.resolveComponent("audio-player"),L=r.resolveComponent("svg-icon");return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.messageReply?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-reply-container",style:r.normalizeStyle({bottom:`${s.footerHeight}px`})},[r.createElementVNode("div",F1,[r.createElementVNode("div",U1,[r.createElementVNode("div",D1,r.toDisplayString(a.messageReply.username),1),r.createElementVNode("div",z1,[r.createVNode(k,{content:a.messageReply.content,users:a.room.users,"text-formatting":a.textFormatting,"link-options":a.linkOptions,reply:!0},r.createSlots({_:2},[r.renderList(e.$slots,(b,R)=>({name:R,fn:r.withCtx(h=>[r.renderSlot(e.$slots,R,r.normalizeProps(r.guardReactiveProps(h)))])}))]),1032,["content","users","text-formatting","link-options"])])]),s.isImage?(r.openBlock(),r.createElementBlock("img",{key:0,src:s.firstFile.url,class:"vac-image-reply"},null,8,q1)):s.isVideo?(r.openBlock(),r.createElementBlock("video",Y1,[r.createElementVNode("source",{src:s.firstFile.url},null,8,X1)])):s.isAudio?(r.openBlock(),r.createBlock(C,{key:2,src:s.firstFile.url,class:"vac-audio-reply"},r.createSlots({_:2},[r.renderList(e.$slots,(b,R)=>({name:R,fn:r.withCtx(h=>[r.renderSlot(e.$slots,R,r.normalizeProps(r.guardReactiveProps(h)))])}))]),1032,["src"])):s.isOtherFile?(r.openBlock(),r.createElementBlock("div",G1,[r.createElementVNode("div",null,[r.renderSlot(e.$slots,"file-icon",{},()=>[r.createVNode(L,{name:"file"})])]),r.createElementVNode("div",K1,r.toDisplayString(s.firstFile.name),1),s.firstFile.extension?(r.openBlock(),r.createElementBlock("div",Z1,r.toDisplayString(s.firstFile.extension),1)):r.createCommentVNode("",!0)])):r.createCommentVNode("",!0)]),r.createElementVNode("div",W1,[r.createElementVNode("div",{class:"vac-svg-button",onClick:t[0]||(t[0]=b=>e.$emit("reset-message"))},[r.renderSlot(e.$slots,"reply-close-icon",{},()=>[r.createVNode(L,{name:"close-outline"})])])])],4)):r.createCommentVNode("",!0)]),_:3})}var J1=Ye(P1,[["render",Q1]]);const $1={name:"RoomUsersTag",props:{filteredUsersTag:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-user-tag","activate-item"],data(){return{activeItem:null}},computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight}},watch:{filteredUsersTag(e,t){(!t.length||e.length!==t.length)&&(this.activeItem=0)},selectItem(e){e&&this.$emit("select-user-tag",this.filteredUsersTag[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredUsersTag.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},ed=["onMouseover","onClick"],td={class:"vac-tags-info"},ad={class:"vac-tags-username"};function rd(e,t,a,n,d,s){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.filteredUsersTag.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-tags-container",style:r.normalizeStyle({bottom:`${s.footerHeight}px`})},[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.filteredUsersTag,(k,C)=>(r.openBlock(),r.createElementBlock("div",{key:k._id,class:r.normalizeClass(["vac-tags-box",{"vac-tags-box-active":C===d.activeItem}]),onMouseover:L=>d.activeItem=C,onClick:L=>e.$emit("select-user-tag",k)},[r.createElementVNode("div",td,[k.avatar?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-avatar vac-tags-avatar",style:r.normalizeStyle({"background-image":`url('${k.avatar}')`})},null,4)):r.createCommentVNode("",!0),r.createElementVNode("div",ad,r.toDisplayString(k.username),1)])],42,ed))),128))],4)):r.createCommentVNode("",!0)]),_:1})}var od=Ye($1,[["render",rd]]);const sd={name:"RoomEmojis",props:{filteredEmojis:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-emoji","activate-item"],data(){return{activeItem:null}},computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight}},watch:{filteredEmojis(e,t){(!t.length||e.length!==t.length)&&(this.activeItem=0)},selectItem(e){e&&this.$emit("select-emoji",this.filteredEmojis[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredEmojis.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},nd=["onMouseover","onClick"];function id(e,t,a,n,d,s){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.filteredEmojis.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-emojis-container",style:r.normalizeStyle({bottom:`${s.footerHeight}px`})},[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.filteredEmojis,(k,C)=>(r.openBlock(),r.createElementBlock("div",{key:k,class:r.normalizeClass(["vac-emoji-element",{"vac-emoji-element-active":C===d.activeItem}]),onMouseover:L=>d.activeItem=C,onClick:L=>e.$emit("select-emoji",k)},r.toDisplayString(k),43,nd))),128))],4)):r.createCommentVNode("",!0)]),_:1})}var ld=Ye(sd,[["render",id]]);const cd={name:"RoomTemplatesText",props:{filteredTemplatesText:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-template-text","activate-item"],data(){return{activeItem:null}},computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight}},watch:{filteredTemplatesText(e,t){(!t.length||e.length!==t.length)&&(this.activeItem=0)},selectItem(e){e&&this.$emit("select-template-text",this.filteredTemplatesText[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredTemplatesText.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},dd=["onMouseover","onClick"],md={class:"vac-template-info"},hd={class:"vac-template-tag"},ud={class:"vac-template-text"};function fd(e,t,a,n,d,s){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.filteredTemplatesText.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-template-container vac-app-box-shadow",style:r.normalizeStyle({bottom:`${s.footerHeight}px`})},[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.filteredTemplatesText,(k,C)=>(r.openBlock(),r.createElementBlock("div",{key:C,class:r.normalizeClass(["vac-template-box",{"vac-template-active":C===d.activeItem}]),onMouseover:L=>d.activeItem=C,onClick:L=>e.$emit("select-template-text",k)},[r.createElementVNode("div",md,[r.createElementVNode("div",hd," /"+r.toDisplayString(k.tag),1),r.createElementVNode("div",ud,r.toDisplayString(k.text),1)])],42,dd))),128))],4)):r.createCommentVNode("",!0)]),_:1})}var _d=Ye(cd,[["render",fd]]);function pd(e){return new Int8Array(e)}function Nn(e){return new Int16Array(e)}function Ln(e){return new Int32Array(e)}function In(e){return new Float32Array(e)}function vd(e){return new Float64Array(e)}function jn(e){if(e.length==1)return In(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(jn(e));return a}function Vn(e){if(e.length==1)return Ln(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(Vn(e));return a}function Hn(e){if(e.length==1)return Nn(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(Hn(e));return a}function Pn(e){if(e.length==1)return new Array(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(Pn(e));return a}var Fn={};Fn.fill=function(e,t,a,n){if(arguments.length==2)for(var d=0;d<e.length;d++)e[d]=arguments[1];else for(var d=t;d<a;d++)e[d]=n};var pr={};pr.arraycopy=function(e,t,a,n,d){for(var s=t+d;t<s;)a[n++]=e[t++]},pr.out={},pr.out.println=function(e){console.log(e)},pr.out.printf=function(){console.log.apply(console,arguments)};var Qr={};Qr.SQRT2=1.4142135623730951,Qr.FAST_LOG10=function(e){return Math.log10(e)},Qr.FAST_LOG10_X=function(e,t){return Math.log10(e)*t};function ta(e){this.ordinal=e}ta.short_block_allowed=new ta(0),ta.short_block_coupled=new ta(1),ta.short_block_dispensed=new ta(2),ta.short_block_forced=new ta(3);var Un={};Un.MAX_VALUE=34028235e31;function At(e){this.ordinal=e}At.vbr_off=new At(0),At.vbr_mt=new At(1),At.vbr_rh=new At(2),At.vbr_abr=new At(3),At.vbr_mtrh=new At(4),At.vbr_default=At.vbr_mtrh;var gd=function(e){},fe={System:pr,VbrMode:At,Float:Un,ShortBlock:ta,Util:Qr,Arrays:Fn,new_array_n:Pn,new_byte:pd,new_double:vd,new_float:In,new_float_n:jn,new_int:Ln,new_int_n:Vn,new_short:Nn,new_short_n:Hn,assert:gd},bd=fe.System,tt=fe.Util,yd=fe.Arrays,xd=fe.new_float;function wd(){var e=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*tt.SQRT2*.5/2384e-9,.017876148*tt.SQRT2*.5/2384e-9,.003134727*tt.SQRT2*.5/2384e-9,.002457142*tt.SQRT2*.5/2384e-9,971317e-9*tt.SQRT2*.5/2384e-9,218868e-9*tt.SQRT2*.5/2384e-9,101566e-9*tt.SQRT2*.5/2384e-9,13828e-9*tt.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],t=12,a=36,n=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],d=n[T.SHORT_TYPE],s=n[T.SHORT_TYPE],k=n[T.SHORT_TYPE],C=n[T.SHORT_TYPE],L=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function b(M,w,o){for(var F=10,H=w+238-14-286,V=-15;V<0;V++){var c,A,N;c=e[F+-10],A=M[H+-224]*c,N=M[w+224]*c,c=e[F+-9],A+=M[H+-160]*c,N+=M[w+160]*c,c=e[F+-8],A+=M[H+-96]*c,N+=M[w+96]*c,c=e[F+-7],A+=M[H+-32]*c,N+=M[w+32]*c,c=e[F+-6],A+=M[H+32]*c,N+=M[w+-32]*c,c=e[F+-5],A+=M[H+96]*c,N+=M[w+-96]*c,c=e[F+-4],A+=M[H+160]*c,N+=M[w+-160]*c,c=e[F+-3],A+=M[H+224]*c,N+=M[w+-224]*c,c=e[F+-2],A+=M[w+-256]*c,N-=M[H+256]*c,c=e[F+-1],A+=M[w+-192]*c,N-=M[H+192]*c,c=e[F+0],A+=M[w+-128]*c,N-=M[H+128]*c,c=e[F+1],A+=M[w+-64]*c,N-=M[H+64]*c,c=e[F+2],A+=M[w+0]*c,N-=M[H+0]*c,c=e[F+3],A+=M[w+64]*c,N-=M[H+-64]*c,c=e[F+4],A+=M[w+128]*c,N-=M[H+-128]*c,c=e[F+5],A+=M[w+192]*c,N-=M[H+-192]*c,A*=e[F+6],c=N-A,o[30+V*2]=N+A,o[31+V*2]=e[F+7]*c,F+=18,w--,H++}{var A,N,E,O;N=M[w+-16]*e[F+-10],A=M[w+-32]*e[F+-2],N+=(M[w+-48]-M[w+16])*e[F+-9],A+=M[w+-96]*e[F+-1],N+=(M[w+-80]+M[w+48])*e[F+-8],A+=M[w+-160]*e[F+0],N+=(M[w+-112]-M[w+80])*e[F+-7],A+=M[w+-224]*e[F+1],N+=(M[w+-144]+M[w+112])*e[F+-6],A-=M[w+32]*e[F+2],N+=(M[w+-176]-M[w+144])*e[F+-5],A-=M[w+96]*e[F+3],N+=(M[w+-208]+M[w+176])*e[F+-4],A-=M[w+160]*e[F+4],N+=(M[w+-240]-M[w+208])*e[F+-3],A-=M[w+224],E=A-N,O=A+N,N=o[14],A=o[15]-N,o[31]=O+N,o[30]=E+A,o[15]=E-A,o[14]=O-N}{var l;l=o[28]-o[0],o[0]+=o[28],o[28]=l*e[F+-2*18+7],l=o[29]-o[1],o[1]+=o[29],o[29]=l*e[F+-2*18+7],l=o[26]-o[2],o[2]+=o[26],o[26]=l*e[F+-4*18+7],l=o[27]-o[3],o[3]+=o[27],o[27]=l*e[F+-4*18+7],l=o[24]-o[4],o[4]+=o[24],o[24]=l*e[F+-6*18+7],l=o[25]-o[5],o[5]+=o[25],o[25]=l*e[F+-6*18+7],l=o[22]-o[6],o[6]+=o[22],o[22]=l*tt.SQRT2,l=o[23]-o[7],o[7]+=o[23],o[23]=l*tt.SQRT2-o[7],o[7]-=o[6],o[22]-=o[7],o[23]-=o[22],l=o[6],o[6]=o[31]-l,o[31]=o[31]+l,l=o[7],o[7]=o[30]-l,o[30]=o[30]+l,l=o[22],o[22]=o[15]-l,o[15]=o[15]+l,l=o[23],o[23]=o[14]-l,o[14]=o[14]+l,l=o[20]-o[8],o[8]+=o[20],o[20]=l*e[F+-10*18+7],l=o[21]-o[9],o[9]+=o[21],o[21]=l*e[F+-10*18+7],l=o[18]-o[10],o[10]+=o[18],o[18]=l*e[F+-12*18+7],l=o[19]-o[11],o[11]+=o[19],o[19]=l*e[F+-12*18+7],l=o[16]-o[12],o[12]+=o[16],o[16]=l*e[F+-14*18+7],l=o[17]-o[13],o[13]+=o[17],o[17]=l*e[F+-14*18+7],l=-o[20]+o[24],o[20]+=o[24],o[24]=l*e[F+-12*18+7],l=-o[21]+o[25],o[21]+=o[25],o[25]=l*e[F+-12*18+7],l=o[4]-o[8],o[4]+=o[8],o[8]=l*e[F+-12*18+7],l=o[5]-o[9],o[5]+=o[9],o[9]=l*e[F+-12*18+7],l=o[0]-o[12],o[0]+=o[12],o[12]=l*e[F+-4*18+7],l=o[1]-o[13],o[1]+=o[13],o[13]=l*e[F+-4*18+7],l=o[16]-o[28],o[16]+=o[28],o[28]=l*e[F+-4*18+7],l=-o[17]+o[29],o[17]+=o[29],o[29]=l*e[F+-4*18+7],l=tt.SQRT2*(o[2]-o[10]),o[2]+=o[10],o[10]=l,l=tt.SQRT2*(o[3]-o[11]),o[3]+=o[11],o[11]=l,l=tt.SQRT2*(-o[18]+o[26]),o[18]+=o[26],o[26]=l-o[18],l=tt.SQRT2*(-o[19]+o[27]),o[19]+=o[27],o[27]=l-o[19],l=o[2],o[19]-=o[3],o[3]-=l,o[2]=o[31]-l,o[31]+=l,l=o[3],o[11]-=o[19],o[18]-=l,o[3]=o[30]-l,o[30]+=l,l=o[18],o[27]-=o[11],o[19]-=l,o[18]=o[15]-l,o[15]+=l,l=o[19],o[10]-=l,o[19]=o[14]-l,o[14]+=l,l=o[10],o[11]-=l,o[10]=o[23]-l,o[23]+=l,l=o[11],o[26]-=l,o[11]=o[22]-l,o[22]+=l,l=o[26],o[27]-=l,o[26]=o[7]-l,o[7]+=l,l=o[27],o[27]=o[6]-l,o[6]+=l,l=tt.SQRT2*(o[0]-o[4]),o[0]+=o[4],o[4]=l,l=tt.SQRT2*(o[1]-o[5]),o[1]+=o[5],o[5]=l,l=tt.SQRT2*(o[16]-o[20]),o[16]+=o[20],o[20]=l,l=tt.SQRT2*(o[17]-o[21]),o[17]+=o[21],o[21]=l,l=-tt.SQRT2*(o[8]-o[12]),o[8]+=o[12],o[12]=l-o[8],l=-tt.SQRT2*(o[9]-o[13]),o[9]+=o[13],o[13]=l-o[9],l=-tt.SQRT2*(o[25]-o[29]),o[25]+=o[29],o[29]=l-o[25],l=-tt.SQRT2*(o[24]+o[28]),o[24]-=o[28],o[28]=l-o[24],l=o[24]-o[16],o[24]=l,l=o[20]-l,o[20]=l,l=o[28]-l,o[28]=l,l=o[25]-o[17],o[25]=l,l=o[21]-l,o[21]=l,l=o[29]-l,o[29]=l,l=o[17]-o[1],o[17]=l,l=o[9]-l,o[9]=l,l=o[25]-l,o[25]=l,l=o[5]-l,o[5]=l,l=o[21]-l,o[21]=l,l=o[13]-l,o[13]=l,l=o[29]-l,o[29]=l,l=o[1]-o[0],o[1]=l,l=o[16]-l,o[16]=l,l=o[17]-l,o[17]=l,l=o[8]-l,o[8]=l,l=o[9]-l,o[9]=l,l=o[24]-l,o[24]=l,l=o[25]-l,o[25]=l,l=o[4]-l,o[4]=l,l=o[5]-l,o[5]=l,l=o[20]-l,o[20]=l,l=o[21]-l,o[21]=l,l=o[12]-l,o[12]=l,l=o[13]-l,o[13]=l,l=o[28]-l,o[28]=l,l=o[29]-l,o[29]=l,l=o[0],o[0]+=o[31],o[31]-=l,l=o[1],o[1]+=o[30],o[30]-=l,l=o[16],o[16]+=o[15],o[15]-=l,l=o[17],o[17]+=o[14],o[14]-=l,l=o[8],o[8]+=o[23],o[23]-=l,l=o[9],o[9]+=o[22],o[22]-=l,l=o[24],o[24]+=o[7],o[7]-=l,l=o[25],o[25]+=o[6],o[6]-=l,l=o[4],o[4]+=o[27],o[27]-=l,l=o[5],o[5]+=o[26],o[26]-=l,l=o[20],o[20]+=o[11],o[11]-=l,l=o[21],o[21]+=o[10],o[10]-=l,l=o[12],o[12]+=o[19],o[19]-=l,l=o[13],o[13]+=o[18],o[18]-=l,l=o[28],o[28]+=o[3],o[3]-=l,l=o[29],o[29]+=o[2],o[2]-=l}}function R(M,w){for(var o=0;o<3;o++){var F,H,V,c,A,N;c=M[w+2*3]*n[T.SHORT_TYPE][0]-M[w+5*3],F=M[w+0*3]*n[T.SHORT_TYPE][2]-M[w+3*3],H=c+F,V=c-F,c=M[w+5*3]*n[T.SHORT_TYPE][0]+M[w+2*3],F=M[w+3*3]*n[T.SHORT_TYPE][2]+M[w+0*3],A=c+F,N=-c+F,F=(M[w+1*3]*n[T.SHORT_TYPE][1]-M[w+4*3])*2069978111953089e-26,c=(M[w+4*3]*n[T.SHORT_TYPE][1]+M[w+1*3])*2069978111953089e-26,M[w+3*0]=H*190752519173728e-25+F,M[w+3*5]=-A*190752519173728e-25+c,V=V*.8660254037844387*1907525191737281e-26,A=A*.5*1907525191737281e-26+c,M[w+3*1]=V-A,M[w+3*2]=V+A,H=H*.5*1907525191737281e-26-F,N=N*.8660254037844387*1907525191737281e-26,M[w+3*3]=H+N,M[w+3*4]=H-N,w++}}function h(M,w,o){var F,H;{var V,c,A,N,E,O,l,x;V=o[17]-o[9],A=o[15]-o[11],N=o[14]-o[12],E=o[0]+o[8],O=o[1]+o[7],l=o[2]+o[6],x=o[3]+o[5],M[w+17]=E+l-x-(O-o[4]),H=(E+l-x)*s[12+7]+(O-o[4]),F=(V-A-N)*s[12+6],M[w+5]=F+H,M[w+6]=F-H,c=(o[16]-o[10])*s[12+6],O=O*s[12+7]+o[4],F=V*s[12+0]+c+A*s[12+1]+N*s[12+2],H=-E*s[12+4]+O-l*s[12+5]+x*s[12+3],M[w+1]=F+H,M[w+2]=F-H,F=V*s[12+1]-c-A*s[12+2]+N*s[12+0],H=-E*s[12+5]+O-l*s[12+3]+x*s[12+4],M[w+9]=F+H,M[w+10]=F-H,F=V*s[12+2]-c+A*s[12+0]-N*s[12+1],H=E*s[12+3]-O+l*s[12+4]-x*s[12+5],M[w+13]=F+H,M[w+14]=F-H}{var y,m,f,p,u,v,_,I;y=o[8]-o[0],f=o[6]-o[2],p=o[5]-o[3],u=o[17]+o[9],v=o[16]+o[10],_=o[15]+o[11],I=o[14]+o[12],M[w+0]=u+_+I+(v+o[13]),F=(u+_+I)*s[12+7]-(v+o[13]),H=(y-f+p)*s[12+6],M[w+11]=F+H,M[w+12]=F-H,m=(o[7]-o[1])*s[12+6],v=o[13]-v*s[12+7],F=u*s[12+3]-v+_*s[12+4]+I*s[12+5],H=y*s[12+2]+m+f*s[12+0]+p*s[12+1],M[w+3]=F+H,M[w+4]=F-H,F=-u*s[12+5]+v-_*s[12+3]-I*s[12+4],H=y*s[12+1]+m-f*s[12+2]-p*s[12+0],M[w+7]=F+H,M[w+8]=F-H,F=-u*s[12+4]+v-_*s[12+5]-I*s[12+3],H=y*s[12+0]-m+f*s[12+1]-p*s[12+2],M[w+15]=F+H,M[w+16]=F-H}}this.mdct_sub48=function(M,w,o){for(var F=w,H=286,V=0;V<M.channels_out;V++){for(var c=0;c<M.mode_gr;c++){for(var A,N=M.l3_side.tt[c][V],E=N.xr,O=0,l=M.sb_sample[V][1-c],x=0,y=0;y<18/2;y++)for(b(F,H,l[x]),b(F,H+32,l[x+1]),x+=2,H+=64,A=1;A<32;A+=2)l[x-1][A]*=-1;for(A=0;A<32;A++,O+=18){var m=N.block_type,f=M.sb_sample[V][c],p=M.sb_sample[V][1-c];if(N.mixed_block_flag!=0&&A<2&&(m=0),M.amp_filter[A]<1e-12)yd.fill(E,O+0,O+18,0);else{if(M.amp_filter[A]<1)for(var y=0;y<18;y++)p[y][L[A]]*=M.amp_filter[A];if(m==T.SHORT_TYPE){for(var y=-t/4;y<0;y++){var u=n[T.SHORT_TYPE][y+3];E[O+y*3+9]=f[9+y][L[A]]*u-f[8-y][L[A]],E[O+y*3+18]=f[14-y][L[A]]*u+f[15+y][L[A]],E[O+y*3+10]=f[15+y][L[A]]*u-f[14-y][L[A]],E[O+y*3+19]=p[2-y][L[A]]*u+p[3+y][L[A]],E[O+y*3+11]=p[3+y][L[A]]*u-p[2-y][L[A]],E[O+y*3+20]=p[8-y][L[A]]*u+p[9+y][L[A]]}R(E,O)}else{for(var v=xd(18),y=-a/4;y<0;y++){var _,I;_=n[m][y+27]*p[y+9][L[A]]+n[m][y+36]*p[8-y][L[A]],I=n[m][y+9]*f[y+9][L[A]]-n[m][y+18]*f[8-y][L[A]],v[y+9]=_-I*d[3+y+9],v[y+18]=_*d[3+y+9]+I}h(E,O,v)}}if(m!=T.SHORT_TYPE&&A!=0)for(var y=7;y>=0;--y){var G,U;G=E[O+y]*k[20+y]+E[O+-1-y]*C[28+y],U=E[O+y]*C[28+y]-E[O+-1-y]*k[20+y],E[O+-1-y]=G,E[O+y]=U}}}if(F=o,H=286,M.mode_gr==1)for(var z=0;z<18;z++)bd.arraycopy(M.sb_sample[V][1][z],0,M.sb_sample[V][0][z],0,32)}}}var kd=fe.System,Sd=fe.new_float,Ed=fe.new_float_n;function Jr(){this.l=Sd(T.SBMAX_l),this.s=Ed([T.SBMAX_s,3]);var e=this;this.assign=function(t){kd.arraycopy(t.l,0,e.l,0,T.SBMAX_l);for(var a=0;a<T.SBMAX_s;a++)for(var n=0;n<3;n++)e.s[a][n]=t.s[a][n]}}function ia(){this.thm=new Jr,this.en=new Jr}function Ue(e){var t=e;this.ordinal=function(){return t}}Ue.STEREO=new Ue(0),Ue.JOINT_STEREO=new Ue(1),Ue.DUAL_CHANNEL=new Ue(2),Ue.MONO=new Ue(3),Ue.NOT_SET=new Ue(4);var Dn=fe.System,$r=fe.VbrMode,zn=fe.new_array_n,qn=fe.new_float,Md=fe.new_float_n,Rd=fe.new_int,eo=fe.assert;T.ENCDELAY=576,T.POSTDELAY=1152,T.MDCTDELAY=48,T.FFTOFFSET=224+T.MDCTDELAY,T.DECDELAY=528,T.SBLIMIT=32,T.CBANDS=64,T.SBPSY_l=21,T.SBPSY_s=12,T.SBMAX_l=22,T.SBMAX_s=13,T.PSFB21=6,T.PSFB12=6,T.BLKSIZE=1024,T.HBLKSIZE=T.BLKSIZE/2+1,T.BLKSIZE_s=256,T.HBLKSIZE_s=T.BLKSIZE_s/2+1,T.NORM_TYPE=0,T.START_TYPE=1,T.SHORT_TYPE=2,T.STOP_TYPE=3,T.MPG_MD_LR_LR=0,T.MPG_MD_LR_I=1,T.MPG_MD_MS_LR=2,T.MPG_MD_MS_I=3,T.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function T(){var e=T.FFTOFFSET,t=T.MPG_MD_MS_LR,a=null;this.psy=null;var n=null,d=null,s=null;this.setModules=function(R,h,M,w){a=R,this.psy=h,n=h,d=w,s=M};var k=new wd;function C(R){var h,M;if(R.ATH.useAdjust==0){R.ATH.adjust=1;return}if(M=R.loudness_sq[0][0],h=R.loudness_sq[1][0],R.channels_out==2?(M+=R.loudness_sq[0][1],h+=R.loudness_sq[1][1]):(M+=M,h+=h),R.mode_gr==2&&(M=Math.max(M,h)),M*=.5,M*=R.ATH.aaSensitivityP,M>.03125)R.ATH.adjust>=1?R.ATH.adjust=1:R.ATH.adjust<R.ATH.adjustLimit&&(R.ATH.adjust=R.ATH.adjustLimit),R.ATH.adjustLimit=1;else{var w=31.98*M+625e-6;R.ATH.adjust>=w?(R.ATH.adjust*=w*.075+.925,R.ATH.adjust<w&&(R.ATH.adjust=w)):R.ATH.adjustLimit>=w?R.ATH.adjust=w:R.ATH.adjust<R.ATH.adjustLimit&&(R.ATH.adjust=R.ATH.adjustLimit),R.ATH.adjustLimit=w}}function L(R){var h,M;for(eo(R.bitrate_index>=0&&R.bitrate_index<16),eo(R.mode_ext>=0&&R.mode_ext<4),R.bitrate_stereoMode_Hist[R.bitrate_index][4]++,R.bitrate_stereoMode_Hist[15][4]++,R.channels_out==2&&(R.bitrate_stereoMode_Hist[R.bitrate_index][R.mode_ext]++,R.bitrate_stereoMode_Hist[15][R.mode_ext]++),h=0;h<R.mode_gr;++h)for(M=0;M<R.channels_out;++M){var w=R.l3_side.tt[h][M].block_type|0;R.l3_side.tt[h][M].mixed_block_flag!=0&&(w=4),R.bitrate_blockType_Hist[R.bitrate_index][w]++,R.bitrate_blockType_Hist[R.bitrate_index][5]++,R.bitrate_blockType_Hist[15][w]++,R.bitrate_blockType_Hist[15][5]++}}function b(R,h){var M=R.internal_flags,w,o;if(M.lame_encode_frame_init==0){var F,H,V=qn(2014),c=qn(286+1152+576);for(M.lame_encode_frame_init=1,F=0,H=0;F<286+576*(1+M.mode_gr);++F)F<576*M.mode_gr?(V[F]=0,M.channels_out==2&&(c[F]=0)):(V[F]=h[0][H],M.channels_out==2&&(c[F]=h[1][H]),++H);for(o=0;o<M.mode_gr;o++)for(w=0;w<M.channels_out;w++)M.l3_side.tt[o][w].block_type=T.SHORT_TYPE;k.mdct_sub48(M,V,c),eo(M.mf_size>=T.BLKSIZE+R.framesize-T.FFTOFFSET),eo(M.mf_size>=512+R.framesize-32)}}this.lame_encode_mp3_frame=function(R,h,M,w,o,F){var H,V=zn([2,2]);V[0][0]=new ia,V[0][1]=new ia,V[1][0]=new ia,V[1][1]=new ia;var c=zn([2,2]);c[0][0]=new ia,c[0][1]=new ia,c[1][0]=new ia,c[1][1]=new ia;var A,N=[null,null],E=R.internal_flags,O=Md([2,4]),l=[.5,.5],x=[[0,0],[0,0]],y=[[0,0],[0,0]],m,f,p;if(N[0]=h,N[1]=M,E.lame_encode_frame_init==0&&b(R,N),E.padding=0,(E.slot_lag-=E.frac_SpF)<0&&(E.slot_lag+=R.out_samplerate,E.padding=1),E.psymodel!=0){var u,v=[null,null],_=0,I=Rd(2);for(p=0;p<E.mode_gr;p++){for(f=0;f<E.channels_out;f++)v[f]=N[f],_=576+p*576-T.FFTOFFSET;if(R.VBR==$r.vbr_mtrh||R.VBR==$r.vbr_mt?u=n.L3psycho_anal_vbr(R,v,_,p,V,c,x[p],y[p],O[p],I):u=n.L3psycho_anal_ns(R,v,_,p,V,c,x[p],y[p],O[p],I),u!=0)return-4;for(R.mode==Ue.JOINT_STEREO&&(l[p]=O[p][2]+O[p][3],l[p]>0&&(l[p]=O[p][3]/l[p])),f=0;f<E.channels_out;f++){var G=E.l3_side.tt[p][f];G.block_type=I[f],G.mixed_block_flag=0}}}else for(p=0;p<E.mode_gr;p++)for(f=0;f<E.channels_out;f++)E.l3_side.tt[p][f].block_type=T.NORM_TYPE,E.l3_side.tt[p][f].mixed_block_flag=0,y[p][f]=x[p][f]=700;if(C(E),k.mdct_sub48(E,N[0],N[1]),E.mode_ext=T.MPG_MD_LR_LR,R.force_ms)E.mode_ext=T.MPG_MD_MS_LR;else if(R.mode==Ue.JOINT_STEREO){var U=0,z=0;for(p=0;p<E.mode_gr;p++)for(f=0;f<E.channels_out;f++)U+=y[p][f],z+=x[p][f];if(U<=1*z){var i=E.l3_side.tt[0],g=E.l3_side.tt[E.mode_gr-1];i[0].block_type==i[1].block_type&&g[0].block_type==g[1].block_type&&(E.mode_ext=T.MPG_MD_MS_LR)}}if(E.mode_ext==t?(A=c,m=y):(A=V,m=x),R.analysis&&E.pinfo!=null)for(p=0;p<E.mode_gr;p++)for(f=0;f<E.channels_out;f++)E.pinfo.ms_ratio[p]=E.ms_ratio[p],E.pinfo.ms_ener_ratio[p]=l[p],E.pinfo.blocktype[p][f]=E.l3_side.tt[p][f].block_type,E.pinfo.pe[p][f]=m[p][f],Dn.arraycopy(E.l3_side.tt[p][f].xr,0,E.pinfo.xr[p][f],0,576),E.mode_ext==t&&(E.pinfo.ers[p][f]=E.pinfo.ers[p][f+2],Dn.arraycopy(E.pinfo.energy[p][f+2],0,E.pinfo.energy[p][f],0,E.pinfo.energy[p][f].length));if(R.VBR==$r.vbr_off||R.VBR==$r.vbr_abr){var K,W;for(K=0;K<18;K++)E.nsPsy.pefirbuf[K]=E.nsPsy.pefirbuf[K+1];for(W=0,p=0;p<E.mode_gr;p++)for(f=0;f<E.channels_out;f++)W+=m[p][f];for(E.nsPsy.pefirbuf[18]=W,W=E.nsPsy.pefirbuf[9],K=0;K<9;K++)W+=(E.nsPsy.pefirbuf[K]+E.nsPsy.pefirbuf[18-K])*T.fircoef[K];for(W=670*5*E.mode_gr*E.channels_out/W,p=0;p<E.mode_gr;p++)for(f=0;f<E.channels_out;f++)m[p][f]*=W}if(E.iteration_loop.iteration_loop(R,m,l,A),a.format_bitstream(R),H=a.copy_buffer(E,w,o,F,1),R.bWriteVbrTag&&d.addVbrFrame(R),R.analysis&&E.pinfo!=null){for(f=0;f<E.channels_out;f++){var ie;for(ie=0;ie<e;ie++)E.pinfo.pcmdata[f][ie]=E.pinfo.pcmdata[f][ie+R.framesize];for(ie=e;ie<1600;ie++)E.pinfo.pcmdata[f][ie]=N[f][ie-e]}s.set_frame_pinfo(R,A)}return L(E),H}}var Yn=fe.Util,Xn=fe.new_float;function Td(){var e=Xn(T.BLKSIZE),t=Xn(T.BLKSIZE_s/2),a=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function n(s,k,C){var L=0,b,R,h;C<<=1;var M=k+C;b=4;do{var w,o,F,H,V,c,A;A=b>>1,H=b,V=b<<1,c=V+H,b=V<<1,R=k,h=R+A;do{var N,E,O,l;E=s[R+0]-s[R+H],N=s[R+0]+s[R+H],l=s[R+V]-s[R+c],O=s[R+V]+s[R+c],s[R+V]=N-O,s[R+0]=N+O,s[R+c]=E-l,s[R+H]=E+l,E=s[h+0]-s[h+H],N=s[h+0]+s[h+H],l=Yn.SQRT2*s[h+c],O=Yn.SQRT2*s[h+V],s[h+V]=N-O,s[h+0]=N+O,s[h+c]=E-l,s[h+H]=E+l,h+=b,R+=b}while(R<M);for(o=a[L+0],w=a[L+1],F=1;F<A;F++){var x,y;x=1-2*w*w,y=2*w*o,R=k+F,h=k+H-F;do{var m,f,p,N,E,u,O,v,l,_;f=y*s[R+H]-x*s[h+H],m=x*s[R+H]+y*s[h+H],E=s[R+0]-m,N=s[R+0]+m,u=s[h+0]-f,p=s[h+0]+f,f=y*s[R+c]-x*s[h+c],m=x*s[R+c]+y*s[h+c],l=s[R+V]-m,O=s[R+V]+m,_=s[h+V]-f,v=s[h+V]+f,f=w*O-o*_,m=o*O+w*_,s[R+V]=N-m,s[R+0]=N+m,s[h+c]=u-f,s[h+H]=u+f,f=o*v-w*l,m=w*v+o*l,s[h+V]=p-m,s[h+0]=p+m,s[R+c]=E-f,s[R+H]=E+f,h+=b,R+=b}while(R<M);x=o,o=x*a[L+0]-w*a[L+1],w=x*a[L+1]+w*a[L+0]}L+=2}while(b<C)}var d=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(s,k,C,L,b){for(var R=0;R<3;R++){var h=T.BLKSIZE_s/2,M=65535&576/3*(R+1),w=T.BLKSIZE_s/8-1;do{var o,F,H,V,c,A=d[w<<2]&255;o=t[A]*L[C][b+A+M],c=t[127-A]*L[C][b+A+M+128],F=o-c,o=o+c,H=t[A+64]*L[C][b+A+M+64],c=t[63-A]*L[C][b+A+M+192],V=H-c,H=H+c,h-=4,k[R][h+0]=o+H,k[R][h+2]=o-H,k[R][h+1]=F+V,k[R][h+3]=F-V,o=t[A+1]*L[C][b+A+M+1],c=t[126-A]*L[C][b+A+M+129],F=o-c,o=o+c,H=t[A+65]*L[C][b+A+M+65],c=t[62-A]*L[C][b+A+M+193],V=H-c,H=H+c,k[R][h+T.BLKSIZE_s/2+0]=o+H,k[R][h+T.BLKSIZE_s/2+2]=o-H,k[R][h+T.BLKSIZE_s/2+1]=F+V,k[R][h+T.BLKSIZE_s/2+3]=F-V}while(--w>=0);n(k[R],h,T.BLKSIZE_s/2)}},this.fft_long=function(s,k,C,L,b){var R=T.BLKSIZE/8-1,h=T.BLKSIZE/2;do{var M,w,o,F,H,V=d[R]&255;M=e[V]*L[C][b+V],H=e[V+512]*L[C][b+V+512],w=M-H,M=M+H,o=e[V+256]*L[C][b+V+256],H=e[V+768]*L[C][b+V+768],F=o-H,o=o+H,h-=4,k[h+0]=M+o,k[h+2]=M-o,k[h+1]=w+F,k[h+3]=w-F,M=e[V+1]*L[C][b+V+1],H=e[V+513]*L[C][b+V+513],w=M-H,M=M+H,o=e[V+257]*L[C][b+V+257],H=e[V+769]*L[C][b+V+769],F=o-H,o=o+H,k[h+T.BLKSIZE/2+0]=M+o,k[h+T.BLKSIZE/2+2]=M-o,k[h+T.BLKSIZE/2+1]=w+F,k[h+T.BLKSIZE/2+3]=w-F}while(--R>=0);n(k,h,T.BLKSIZE/2)},this.init_fft=function(s){for(var k=0;k<T.BLKSIZE;k++)e[k]=.42-.5*Math.cos(2*Math.PI*(k+.5)/T.BLKSIZE)+.08*Math.cos(4*Math.PI*(k+.5)/T.BLKSIZE);for(var k=0;k<T.BLKSIZE_s/2;k++)t[k]=.5*(1-Math.cos(2*Math.PI*(k+.5)/T.BLKSIZE_s))}}var Pa=fe.VbrMode,Gn=fe.Float,Fa=fe.ShortBlock,kt=fe.Util,Ad=fe.Arrays,st=fe.new_float,It=fe.new_float_n,ya=fe.new_int,Ce=fe.assert;function Yo(){var e=new Td,t=2.302585092994046,a=2,n=16,d=2,s=16,k=.34,C=1/(14752*14752)/(T.BLKSIZE/2),L=.01,b=.8,R=.6,h=.3,M=3.5,w=21,o=.2302585093;function F(S){return S}function H(S,B){for(var P=0,D=0;D<T.BLKSIZE/2;++D)P+=S[D]*B.ATH.eql_w[D];return P*=C,P}function V(S,B,P,D,Y,j,X,Z,q,ae,Q){var re=S.internal_flags;if(q<2)e.fft_long(re,D[Y],q,ae,Q),e.fft_short(re,j[X],q,ae,Q);else if(q==2){for(var _e=T.BLKSIZE-1;_e>=0;--_e){var Ee=D[Y+0][_e],oe=D[Y+1][_e];D[Y+0][_e]=(Ee+oe)*kt.SQRT2*.5,D[Y+1][_e]=(Ee-oe)*kt.SQRT2*.5}for(var ke=2;ke>=0;--ke)for(var _e=T.BLKSIZE_s-1;_e>=0;--_e){var Ee=j[X+0][ke][_e],oe=j[X+1][ke][_e];j[X+0][ke][_e]=(Ee+oe)*kt.SQRT2*.5,j[X+1][ke][_e]=(Ee-oe)*kt.SQRT2*.5}}B[0]=D[Y+0][0],B[0]*=B[0];for(var _e=T.BLKSIZE/2-1;_e>=0;--_e){var $=D[Y+0][T.BLKSIZE/2-_e],be=D[Y+0][T.BLKSIZE/2+_e];B[T.BLKSIZE/2-_e]=($*$+be*be)*.5}for(var ke=2;ke>=0;--ke){P[ke][0]=j[X+0][ke][0],P[ke][0]*=P[ke][0];for(var _e=T.BLKSIZE_s/2-1;_e>=0;--_e){var $=j[X+0][ke][T.BLKSIZE_s/2-_e],be=j[X+0][ke][T.BLKSIZE_s/2+_e];P[ke][T.BLKSIZE_s/2-_e]=($*$+be*be)*.5}}{for(var Be=0,_e=11;_e<T.HBLKSIZE;_e++)Be+=B[_e];re.tot_ener[q]=Be}if(S.analysis){for(var _e=0;_e<T.HBLKSIZE;_e++)re.pinfo.energy[Z][q][_e]=re.pinfo.energy_save[q][_e],re.pinfo.energy_save[q][_e]=B[_e];re.pinfo.pe[Z][q]=re.pe[q]}S.athaa_loudapprox==2&&q<2&&(re.loudness_sq[Z][q]=re.loudness_sq_save[q],re.loudness_sq_save[q]=H(B,re))}var c=8,A=23,N=15,E,O,l,x=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function y(){E=Math.pow(10,(c+1)/16),O=Math.pow(10,(A+1)/16),l=Math.pow(10,N/10)}var m=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],f=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],p=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function u(S,B,P,D,Y,j){var X;if(B>S)if(B<S*O)X=B/S;else return S+B;else{if(S>=B*O)return S+B;X=S/B}if(S+=B,D+3<=3+3){if(X>=E)return S;var Z=0|kt.FAST_LOG10_X(X,16);return S*f[Z]}var Z=0|kt.FAST_LOG10_X(X,16);if(j!=0?B=Y.ATH.cb_s[P]*Y.ATH.adjust:B=Y.ATH.cb_l[P]*Y.ATH.adjust,S<l*B){if(S>B){var q,ae;return q=1,Z<=13&&(q=p[Z]),ae=kt.FAST_LOG10_X(S/B,10/15),S*((m[Z]-q)*ae+q)}return Z>13?S:S*p[Z]}return S*m[Z]}var v=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function _(S,B,P){var D;if(S<0&&(S=0),B<0&&(B=0),S<=0)return B;if(B<=0)return S;if(B>S?D=B/S:D=S/B,P>=-2&&P<=2){if(D>=E)return S+B;var Y=0|kt.FAST_LOG10_X(D,16);return(S+B)*v[Y]}return D<O?S+B:(S<B&&(S=B),S)}function I(S,B){var P=S.internal_flags;if(P.channels_out>1){for(var D=0;D<T.SBMAX_l;D++){var Y=P.thm[0].l[D],j=P.thm[1].l[D];P.thm[0].l[D]+=j*B,P.thm[1].l[D]+=Y*B}for(var D=0;D<T.SBMAX_s;D++)for(var X=0;X<3;X++){var Y=P.thm[0].s[D][X],j=P.thm[1].s[D][X];P.thm[0].s[D][X]+=j*B,P.thm[1].s[D][X]+=Y*B}}}function G(S){for(var B=0;B<T.SBMAX_l;B++)if(!(S.thm[0].l[B]>1.58*S.thm[1].l[B]||S.thm[1].l[B]>1.58*S.thm[0].l[B])){var P=S.mld_l[B]*S.en[3].l[B],D=Math.max(S.thm[2].l[B],Math.min(S.thm[3].l[B],P));P=S.mld_l[B]*S.en[2].l[B];var Y=Math.max(S.thm[3].l[B],Math.min(S.thm[2].l[B],P));S.thm[2].l[B]=D,S.thm[3].l[B]=Y}for(var B=0;B<T.SBMAX_s;B++)for(var j=0;j<3;j++)if(!(S.thm[0].s[B][j]>1.58*S.thm[1].s[B][j]||S.thm[1].s[B][j]>1.58*S.thm[0].s[B][j])){var P=S.mld_s[B]*S.en[3].s[B][j],D=Math.max(S.thm[2].s[B][j],Math.min(S.thm[3].s[B][j],P));P=S.mld_s[B]*S.en[2].s[B][j];var Y=Math.max(S.thm[3].s[B][j],Math.min(S.thm[2].s[B][j],P));S.thm[2].s[B][j]=D,S.thm[3].s[B][j]=Y}}function U(S,B,P){var D=B,Y=Math.pow(10,P);B*=2,D*=2;for(var j=0;j<T.SBMAX_l;j++){var X,Z,q,ae;if(ae=S.ATH.cb_l[S.bm_l[j]]*Y,X=Math.min(Math.max(S.thm[0].l[j],ae),Math.max(S.thm[1].l[j],ae)),Z=Math.max(S.thm[2].l[j],ae),q=Math.max(S.thm[3].l[j],ae),X*B<Z+q){var Q=X*D/(Z+q);Z*=Q,q*=Q}S.thm[2].l[j]=Math.min(Z,S.thm[2].l[j]),S.thm[3].l[j]=Math.min(q,S.thm[3].l[j])}Y*=T.BLKSIZE_s/T.BLKSIZE;for(var j=0;j<T.SBMAX_s;j++)for(var re=0;re<3;re++){var X,Z,q,ae;if(ae=S.ATH.cb_s[S.bm_s[j]]*Y,X=Math.min(Math.max(S.thm[0].s[j][re],ae),Math.max(S.thm[1].s[j][re],ae)),Z=Math.max(S.thm[2].s[j][re],ae),q=Math.max(S.thm[3].s[j][re],ae),X*B<Z+q){var Q=X*B/(Z+q);Z*=Q,q*=Q}S.thm[2].s[j][re]=Math.min(S.thm[2].s[j][re],Z),S.thm[3].s[j][re]=Math.min(S.thm[3].s[j][re],q)}}function z(S,B,P,D,Y){var j,X,Z=0,q=0;for(j=X=0;j<T.SBMAX_s;++X,++j){for(var ae=S.bo_s[j],Q=S.npart_s,re=ae<Q?ae:Q;X<re;)Ce(B[X]>=0),Ce(P[X]>=0),Z+=B[X],q+=P[X],X++;if(S.en[D].s[j][Y]=Z,S.thm[D].s[j][Y]=q,X>=Q){++j;break}Ce(B[X]>=0),Ce(P[X]>=0);{var _e=S.PSY.bo_s_weight[j],Ee=1-_e;Z=_e*B[X],q=_e*P[X],S.en[D].s[j][Y]+=Z,S.thm[D].s[j][Y]+=q,Z=Ee*B[X],q=Ee*P[X]}}for(;j<T.SBMAX_s;++j)S.en[D].s[j][Y]=0,S.thm[D].s[j][Y]=0}function i(S,B,P,D){var Y,j,X=0,Z=0;for(Y=j=0;Y<T.SBMAX_l;++j,++Y){for(var q=S.bo_l[Y],ae=S.npart_l,Q=q<ae?q:ae;j<Q;)Ce(B[j]>=0),Ce(P[j]>=0),X+=B[j],Z+=P[j],j++;if(S.en[D].l[Y]=X,S.thm[D].l[Y]=Z,j>=ae){++Y;break}Ce(B[j]>=0),Ce(P[j]>=0);{var re=S.PSY.bo_l_weight[Y],_e=1-re;X=re*B[j],Z=re*P[j],S.en[D].l[Y]+=X,S.thm[D].l[Y]+=Z,X=_e*B[j],Z=_e*P[j]}}for(;Y<T.SBMAX_l;++Y)S.en[D].l[Y]=0,S.thm[D].l[Y]=0}function g(S,B,P,D,Y,j){var X=S.internal_flags,Z,q;for(q=Z=0;q<X.npart_s;++q){for(var ae=0,Q=X.numlines_s[q],re=0;re<Q;++re,++Z){var _e=B[j][Z];ae+=_e}P[q]=ae}for(Ce(q==X.npart_s),Z=q=0;q<X.npart_s;q++){var Ee=X.s3ind_s[q][0],oe=X.s3_ss[Z++]*P[Ee];for(++Ee;Ee<=X.s3ind_s[q][1];)oe+=X.s3_ss[Z]*P[Ee],++Z,++Ee;{var ke=d*X.nb_s1[Y][q];D[q]=Math.min(oe,ke)}if(X.blocktype_old[Y&1]==T.SHORT_TYPE){var ke=s*X.nb_s2[Y][q],$=D[q];D[q]=Math.min(ke,$)}X.nb_s2[Y][q]=X.nb_s1[Y][q],X.nb_s1[Y][q]=oe,Ce(D[q]>=0)}for(;q<=T.CBANDS;++q)P[q]=0,D[q]=0}function K(S,B,P,D){var Y=S.internal_flags;S.short_blocks==Fa.short_block_coupled&&!(B[0]!=0&&B[1]!=0)&&(B[0]=B[1]=0);for(var j=0;j<Y.channels_out;j++)D[j]=T.NORM_TYPE,S.short_blocks==Fa.short_block_dispensed&&(B[j]=1),S.short_blocks==Fa.short_block_forced&&(B[j]=0),B[j]!=0?(Ce(Y.blocktype_old[j]!=T.START_TYPE),Y.blocktype_old[j]==T.SHORT_TYPE&&(D[j]=T.STOP_TYPE)):(D[j]=T.SHORT_TYPE,Y.blocktype_old[j]==T.NORM_TYPE&&(Y.blocktype_old[j]=T.START_TYPE),Y.blocktype_old[j]==T.STOP_TYPE&&(Y.blocktype_old[j]=T.SHORT_TYPE)),P[j]=Y.blocktype_old[j],Y.blocktype_old[j]=D[j]}function W(S,B,P){return P>=1?S:P<=0?B:B>0?Math.pow(S/B,P)*B:0}var ie=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function he(S,B){for(var P=309.07,D=0;D<T.SBMAX_s-1;D++)for(var Y=0;Y<3;Y++){var j=S.thm.s[D][Y];if(j>0){var X=j*B,Z=S.en.s[D][Y];Z>X&&(Z>X*1e10?P+=ie[D]*(10*t):P+=ie[D]*kt.FAST_LOG10(Z/X))}}return P}var ue=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function de(S,B){for(var P=281.0575,D=0;D<T.SBMAX_l-1;D++){var Y=S.thm.l[D];if(Y>0){var j=Y*B,X=S.en.l[D];X>j&&(X>j*1e10?P+=ue[D]*(10*t):P+=ue[D]*kt.FAST_LOG10(X/j))}}return P}function Se(S,B,P,D,Y){var j,X;for(j=X=0;j<S.npart_l;++j){var Z=0,q=0,ae;for(ae=0;ae<S.numlines_l[j];++ae,++X){var Q=B[X];Z+=Q,q<Q&&(q=Q)}P[j]=Z,D[j]=q,Y[j]=Z*S.rnumlines_l[j],Ce(S.rnumlines_l[j]>=0),Ce(P[j]>=0),Ce(D[j]>=0),Ce(Y[j]>=0)}}function ve(S,B,P,D){var Y=x.length-1,j=0,X=P[j]+P[j+1];if(X>0){var Z=B[j];Z<B[j+1]&&(Z=B[j+1]),Ce(S.numlines_l[j]+S.numlines_l[j+1]-1>0),X=20*(Z*2-X)/(X*(S.numlines_l[j]+S.numlines_l[j+1]-1));var q=0|X;q>Y&&(q=Y),D[j]=q}else D[j]=0;for(j=1;j<S.npart_l-1;j++)if(X=P[j-1]+P[j]+P[j+1],X>0){var Z=B[j-1];Z<B[j]&&(Z=B[j]),Z<B[j+1]&&(Z=B[j+1]),Ce(S.numlines_l[j-1]+S.numlines_l[j]+S.numlines_l[j+1]-1>0),X=20*(Z*3-X)/(X*(S.numlines_l[j-1]+S.numlines_l[j]+S.numlines_l[j+1]-1));var q=0|X;q>Y&&(q=Y),D[j]=q}else D[j]=0;if(Ce(j==S.npart_l-1),X=P[j-1]+P[j],X>0){var Z=B[j-1];Z<B[j]&&(Z=B[j]),Ce(S.numlines_l[j-1]+S.numlines_l[j]-1>0),X=20*(Z*2-X)/(X*(S.numlines_l[j-1]+S.numlines_l[j]-1));var q=0|X;q>Y&&(q=Y),D[j]=q}else D[j]=0;Ce(j==S.npart_l-1)}var ce=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(S,B,P,D,Y,j,X,Z,q,ae){var Q=S.internal_flags,re=It([2,T.BLKSIZE]),_e=It([2,3,T.BLKSIZE_s]),Ee=st(T.CBANDS+1),oe=st(T.CBANDS+1),ke=st(T.CBANDS+2),$=ya(2),be=ya(2),Be,se,xe,ne,Me,We,pe,Te,Ne=It([2,576]),Qe,Ct=ya(T.CBANDS+2),ot=ya(T.CBANDS+2);for(Ad.fill(ot,0),Be=Q.channels_out,S.mode==Ue.JOINT_STEREO&&(Be=4),S.VBR==Pa.vbr_off?Qe=Q.ResvMax==0?0:Q.ResvSize/Q.ResvMax*.5:S.VBR==Pa.vbr_rh||S.VBR==Pa.vbr_mtrh||S.VBR==Pa.vbr_mt?Qe=.6:Qe=1,se=0;se<Q.channels_out;se++){var Je=B[se],Mt=P+576-350-w+192;for(ne=0;ne<576;ne++){var Ot,Nt;for(Ot=Je[Mt+ne+10],Nt=0,Me=0;Me<(w-1)/2-1;Me+=2)Ot+=ce[Me]*(Je[Mt+ne+Me]+Je[Mt+ne+w-Me]),Nt+=ce[Me+1]*(Je[Mt+ne+Me+1]+Je[Mt+ne+w-Me-1]);Ne[se][ne]=Ot+Nt}Y[D][se].en.assign(Q.en[se]),Y[D][se].thm.assign(Q.thm[se]),Be>2&&(j[D][se].en.assign(Q.en[se+2]),j[D][se].thm.assign(Q.thm[se+2]))}for(se=0;se<Be;se++){var zt,qt,bt=st(12),Jt=[0,0,0,0],za=st(12),es=1,ci,di=st(T.CBANDS),mi=st(T.CBANDS),$e=[0,0,0,0],hi=st(T.HBLKSIZE),ui=It([3,T.HBLKSIZE_s]);for(Ce(Q.npart_s<=T.CBANDS),Ce(Q.npart_l<=T.CBANDS),ne=0;ne<3;ne++)bt[ne]=Q.nsPsy.last_en_subshort[se][ne+6],Ce(Q.nsPsy.last_en_subshort[se][ne+4]>0),za[ne]=bt[ne]/Q.nsPsy.last_en_subshort[se][ne+4],Jt[0]+=bt[ne];if(se==2)for(ne=0;ne<576;ne++){var ts,as;ts=Ne[0][ne],as=Ne[1][ne],Ne[0][ne]=ts+as,Ne[1][ne]=ts-as}{var fi=Ne[se&1],kr=0;for(ne=0;ne<9;ne++){for(var dh=kr+64,dt=1;kr<dh;kr++)dt<Math.abs(fi[kr])&&(dt=Math.abs(fi[kr]));Q.nsPsy.last_en_subshort[se][ne]=bt[ne+3]=dt,Jt[1+ne/3]+=dt,dt>bt[ne+3-2]?(Ce(bt[ne+3-2]>0),dt=dt/bt[ne+3-2]):bt[ne+3-2]>dt*10?dt=bt[ne+3-2]/(dt*10):dt=0,za[ne+3]=dt}}if(S.analysis){var rs=za[0];for(ne=1;ne<12;ne++)rs<za[ne]&&(rs=za[ne]);Q.pinfo.ers[D][se]=Q.pinfo.ers_save[se],Q.pinfo.ers_save[se]=rs}for(ci=se==3?Q.nsPsy.attackthre_s:Q.nsPsy.attackthre,ne=0;ne<12;ne++)$e[ne/3]==0&&za[ne]>ci&&($e[ne/3]=ne%3+1);for(ne=1;ne<4;ne++){var os;Jt[ne-1]>Jt[ne]?(Ce(Jt[ne]>0),os=Jt[ne-1]/Jt[ne]):(Ce(Jt[ne-1]>0),os=Jt[ne]/Jt[ne-1]),os<1.7&&($e[ne]=0,ne==1&&($e[0]=0))}for($e[0]!=0&&Q.nsPsy.lastAttacks[se]!=0&&($e[0]=0),(Q.nsPsy.lastAttacks[se]==3||$e[0]+$e[1]+$e[2]+$e[3]!=0)&&(es=0,$e[1]!=0&&$e[0]!=0&&($e[1]=0),$e[2]!=0&&$e[1]!=0&&($e[2]=0),$e[3]!=0&&$e[2]!=0&&($e[3]=0)),se<2?be[se]=es:es==0&&(be[0]=be[1]=0),q[se]=Q.tot_ener[se],qt=_e,zt=re,V(S,hi,ui,zt,se&1,qt,se&1,D,se,B,P),Se(Q,hi,Ee,di,mi),ve(Q,di,mi,Ct),Te=0;Te<3;Te++){var ss,Rt;for(g(S,ui,oe,ke,se,Te),z(Q,oe,ke,se,Te),pe=0;pe<T.SBMAX_s;pe++){if(Rt=Q.thm[se].s[pe][Te],Rt*=b,$e[Te]>=2||$e[Te+1]==1){var Sr=Te!=0?Te-1:2,dt=W(Q.thm[se].s[pe][Sr],Rt,R*Qe);Rt=Math.min(Rt,dt)}if($e[Te]==1){var Sr=Te!=0?Te-1:2,dt=W(Q.thm[se].s[pe][Sr],Rt,h*Qe);Rt=Math.min(Rt,dt)}else if(Te!=0&&$e[Te-1]==3||Te==0&&Q.nsPsy.lastAttacks[se]==3){var Sr=Te!=2?Te+1:0,dt=W(Q.thm[se].s[pe][Sr],Rt,h*Qe);Rt=Math.min(Rt,dt)}ss=bt[Te*3+3]+bt[Te*3+4]+bt[Te*3+5],bt[Te*3+5]*6<ss&&(Rt*=.5,bt[Te*3+4]*6<ss&&(Rt*=.5)),Q.thm[se].s[pe][Te]=Rt}}for(Q.nsPsy.lastAttacks[se]=$e[2],We=0,xe=0;xe<Q.npart_l;xe++){for(var Ra=Q.s3ind[xe][0],ns=Ee[Ra]*x[Ct[Ra]],Ta=Q.s3_ll[We++]*ns;++Ra<=Q.s3ind[xe][1];)ns=Ee[Ra]*x[Ct[Ra]],Ta=u(Ta,Q.s3_ll[We++]*ns,Ra,Ra-xe,Q,0);Ta*=.158489319246111,Q.blocktype_old[se&1]==T.SHORT_TYPE?ke[xe]=Ta:ke[xe]=W(Math.min(Ta,Math.min(a*Q.nb_1[se][xe],n*Q.nb_2[se][xe])),Ta,Qe),Q.nb_2[se][xe]=Q.nb_1[se][xe],Q.nb_1[se][xe]=Ta}for(;xe<=T.CBANDS;++xe)Ee[xe]=0,ke[xe]=0;i(Q,Ee,ke,se)}if((S.mode==Ue.STEREO||S.mode==Ue.JOINT_STEREO)&&S.interChRatio>0&&I(S,S.interChRatio),S.mode==Ue.JOINT_STEREO){var is;G(Q),is=S.msfix,Math.abs(is)>0&&U(Q,is,S.ATHlower*Q.ATH.adjust)}for(K(S,be,ae,$),se=0;se<Be;se++){var Er,Mr=0,lo,co;se>1?(Er=Z,Mr=-2,lo=T.NORM_TYPE,(ae[0]==T.SHORT_TYPE||ae[1]==T.SHORT_TYPE)&&(lo=T.SHORT_TYPE),co=j[D][se-2]):(Er=X,Mr=0,lo=ae[se],co=Y[D][se]),lo==T.SHORT_TYPE?Er[Mr+se]=he(co,Q.masking_lower):Er[Mr+se]=de(co,Q.masking_lower),S.analysis&&(Q.pinfo.pe[D][se]=Er[Mr+se])}return 0};function Re(S,B,P,D,Y,j,X,Z){var q=S.internal_flags;if(D<2)e.fft_long(q,X[Z],D,B,P);else if(D==2)for(var ae=T.BLKSIZE-1;ae>=0;--ae){var Q=X[Z+0][ae],re=X[Z+1][ae];X[Z+0][ae]=(Q+re)*kt.SQRT2*.5,X[Z+1][ae]=(Q-re)*kt.SQRT2*.5}j[0]=X[Z+0][0],j[0]*=j[0];for(var ae=T.BLKSIZE/2-1;ae>=0;--ae){var _e=X[Z+0][T.BLKSIZE/2-ae],Ee=X[Z+0][T.BLKSIZE/2+ae];j[T.BLKSIZE/2-ae]=(_e*_e+Ee*Ee)*.5}{for(var oe=0,ae=11;ae<T.HBLKSIZE;ae++)oe+=j[ae];q.tot_ener[D]=oe}if(S.analysis){for(var ae=0;ae<T.HBLKSIZE;ae++)q.pinfo.energy[Y][D][ae]=q.pinfo.energy_save[D][ae],q.pinfo.energy_save[D][ae]=j[ae];q.pinfo.pe[Y][D]=q.pe[D]}}function He(S,B,P,D,Y,j,X,Z){var q=S.internal_flags;if(Y==0&&D<2&&e.fft_short(q,X[Z],D,B,P),D==2)for(var ae=T.BLKSIZE_s-1;ae>=0;--ae){var Q=X[Z+0][Y][ae],re=X[Z+1][Y][ae];X[Z+0][Y][ae]=(Q+re)*kt.SQRT2*.5,X[Z+1][Y][ae]=(Q-re)*kt.SQRT2*.5}j[Y][0]=X[Z+0][Y][0],j[Y][0]*=j[Y][0];for(var ae=T.BLKSIZE_s/2-1;ae>=0;--ae){var _e=X[Z+0][Y][T.BLKSIZE_s/2-ae],Ee=X[Z+0][Y][T.BLKSIZE_s/2+ae];j[Y][T.BLKSIZE_s/2-ae]=(_e*_e+Ee*Ee)*.5}}function Oe(S,B,P,D){var Y=S.internal_flags;S.athaa_loudapprox==2&&P<2&&(Y.loudness_sq[B][P]=Y.loudness_sq_save[P],Y.loudness_sq_save[P]=H(D,Y))}var De=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function Pe(S,B,P,D,Y,j,X,Z,q,ae){for(var Q=It([2,576]),re=S.internal_flags,_e=re.channels_out,Ee=S.mode==Ue.JOINT_STEREO?4:_e,oe=0;oe<_e;oe++){firbuf=B[oe];for(var ke=P+576-350-w+192,$=0;$<576;$++){var be,Be;be=firbuf[ke+$+10],Be=0;for(var se=0;se<(w-1)/2-1;se+=2)be+=De[se]*(firbuf[ke+$+se]+firbuf[ke+$+w-se]),Be+=De[se+1]*(firbuf[ke+$+se+1]+firbuf[ke+$+w-se-1]);Q[oe][$]=be+Be}Y[D][oe].en.assign(re.en[oe]),Y[D][oe].thm.assign(re.thm[oe]),Ee>2&&(j[D][oe].en.assign(re.en[oe+2]),j[D][oe].thm.assign(re.thm[oe+2]))}for(var oe=0;oe<Ee;oe++){var xe=st(12),ne=st(12),Me=[0,0,0,0],We=Q[oe&1],pe=0,Te=oe==3?re.nsPsy.attackthre_s:re.nsPsy.attackthre,Ne=1;if(oe==2)for(var $=0,se=576;se>0;++$,--se){var Qe=Q[0][$],Ct=Q[1][$];Q[0][$]=Qe+Ct,Q[1][$]=Qe-Ct}for(var $=0;$<3;$++)ne[$]=re.nsPsy.last_en_subshort[oe][$+6],Ce(re.nsPsy.last_en_subshort[oe][$+4]>0),xe[$]=ne[$]/re.nsPsy.last_en_subshort[oe][$+4],Me[0]+=ne[$];for(var $=0;$<9;$++){for(var ot=pe+64,Je=1;pe<ot;pe++)Je<Math.abs(We[pe])&&(Je=Math.abs(We[pe]));re.nsPsy.last_en_subshort[oe][$]=ne[$+3]=Je,Me[1+$/3]+=Je,Je>ne[$+3-2]?(Ce(ne[$+3-2]>0),Je=Je/ne[$+3-2]):ne[$+3-2]>Je*10?Je=ne[$+3-2]/(Je*10):Je=0,xe[$+3]=Je}for(var $=0;$<3;++$){var Mt=ne[$*3+3]+ne[$*3+4]+ne[$*3+5],Ot=1;ne[$*3+5]*6<Mt&&(Ot*=.5,ne[$*3+4]*6<Mt&&(Ot*=.5)),Z[oe][$]=Ot}if(S.analysis){for(var Nt=xe[0],$=1;$<12;$++)Nt<xe[$]&&(Nt=xe[$]);re.pinfo.ers[D][oe]=re.pinfo.ers_save[oe],re.pinfo.ers_save[oe]=Nt}for(var $=0;$<12;$++)q[oe][$/3]==0&&xe[$]>Te&&(q[oe][$/3]=$%3+1);for(var $=1;$<4;$++){var zt=Me[$-1],qt=Me[$],bt=Math.max(zt,qt);bt<4e4&&zt<1.7*qt&&qt<1.7*zt&&($==1&&q[oe][0]<=q[oe][$]&&(q[oe][0]=0),q[oe][$]=0)}q[oe][0]<=re.nsPsy.lastAttacks[oe]&&(q[oe][0]=0),(re.nsPsy.lastAttacks[oe]==3||q[oe][0]+q[oe][1]+q[oe][2]+q[oe][3]!=0)&&(Ne=0,q[oe][1]!=0&&q[oe][0]!=0&&(q[oe][1]=0),q[oe][2]!=0&&q[oe][1]!=0&&(q[oe][2]=0),q[oe][3]!=0&&q[oe][2]!=0&&(q[oe][3]=0)),oe<2?ae[oe]=Ne:Ne==0&&(ae[0]=ae[1]=0),X[oe]=re.tot_ener[oe]}}function Fe(S,B,P){if(P==0)for(var D=0;D<S.npart_s;D++)S.nb_s2[B][D]=S.nb_s1[B][D],S.nb_s1[B][D]=0}function Ze(S,B){for(var P=0;P<S.npart_l;P++)S.nb_2[B][P]=S.nb_1[B][P],S.nb_1[B][P]=0}function pt(S,B,P,D){var Y=x.length-1,j=0,X=P[j]+P[j+1];if(X>0){var Z=B[j];Z<B[j+1]&&(Z=B[j+1]),Ce(S.numlines_s[j]+S.numlines_s[j+1]-1>0),X=20*(Z*2-X)/(X*(S.numlines_s[j]+S.numlines_s[j+1]-1));var q=0|X;q>Y&&(q=Y),D[j]=q}else D[j]=0;for(j=1;j<S.npart_s-1;j++)if(X=P[j-1]+P[j]+P[j+1],Ce(j+1<S.npart_s),X>0){var Z=B[j-1];Z<B[j]&&(Z=B[j]),Z<B[j+1]&&(Z=B[j+1]),Ce(S.numlines_s[j-1]+S.numlines_s[j]+S.numlines_s[j+1]-1>0),X=20*(Z*3-X)/(X*(S.numlines_s[j-1]+S.numlines_s[j]+S.numlines_s[j+1]-1));var q=0|X;q>Y&&(q=Y),D[j]=q}else D[j]=0;if(Ce(j==S.npart_s-1),X=P[j-1]+P[j],X>0){var Z=B[j-1];Z<B[j]&&(Z=B[j]),Ce(S.numlines_s[j-1]+S.numlines_s[j]-1>0),X=20*(Z*2-X)/(X*(S.numlines_s[j-1]+S.numlines_s[j]-1));var q=0|X;q>Y&&(q=Y),D[j]=q}else D[j]=0;Ce(j==S.npart_s-1)}function lt(S,B,P,D,Y,j){var X=S.internal_flags,Z=new float[T.CBANDS],q=st(T.CBANDS),ae,Q,re,_e=new int[T.CBANDS];for(re=Q=0;re<X.npart_s;++re){var Ee=0,oe=0,ke=X.numlines_s[re];for(ae=0;ae<ke;++ae,++Q){var $=B[j][Q];Ee+=$,oe<$&&(oe=$)}P[re]=Ee,Z[re]=oe,q[re]=Ee/ke,Ce(q[re]>=0)}for(Ce(re==X.npart_s);re<T.CBANDS;++re)Z[re]=0,q[re]=0;for(pt(X,Z,q,_e),Q=re=0;re<X.npart_s;re++){var be=X.s3ind_s[re][0],Be=X.s3ind_s[re][1],se,xe,ne,Me,We;for(se=_e[be],xe=1,Me=X.s3_ss[Q]*P[be]*x[_e[be]],++Q,++be;be<=Be;)se+=_e[be],xe+=1,ne=X.s3_ss[Q]*P[be]*x[_e[be]],Me=_(Me,ne,be-re),++Q,++be;se=(1+2*se)/(2*xe),We=x[se]*.5,Me*=We,D[re]=Me,X.nb_s2[Y][re]=X.nb_s1[Y][re],X.nb_s1[Y][re]=Me,ne=Z[re],ne*=X.minval_s[re],ne*=We,D[re]>ne&&(D[re]=ne),X.masking_lower>1&&(D[re]*=X.masking_lower),D[re]>P[re]&&(D[re]=P[re]),X.masking_lower<1&&(D[re]*=X.masking_lower),Ce(D[re]>=0)}for(;re<T.CBANDS;++re)P[re]=0,D[re]=0}function rt(S,B,P,D,Y){var j=st(T.CBANDS),X=st(T.CBANDS),Z=ya(T.CBANDS+2),q;Se(S,B,P,j,X),ve(S,j,X,Z);var ae=0;for(q=0;q<S.npart_l;q++){var Q,re,_e,Ee,oe=S.s3ind[q][0],ke=S.s3ind[q][1],$=0,be=0;for($=Z[oe],be+=1,re=S.s3_ll[ae]*P[oe]*x[Z[oe]],++ae,++oe;oe<=ke;)$+=Z[oe],be+=1,Q=S.s3_ll[ae]*P[oe]*x[Z[oe]],Ee=_(re,Q,oe-q),re=Ee,++ae,++oe;if($=(1+2*$)/(2*be),_e=x[$]*.5,re*=_e,S.blocktype_old[Y&1]==T.SHORT_TYPE){var Be=a*S.nb_1[Y][q];Be>0?D[q]=Math.min(re,Be):D[q]=Math.min(re,P[q]*h)}else{var se=n*S.nb_2[Y][q],xe=a*S.nb_1[Y][q],Be;se<=0&&(se=re),xe<=0&&(xe=re),S.blocktype_old[Y&1]==T.NORM_TYPE?Be=Math.min(xe,se):Be=xe,D[q]=Math.min(re,Be)}S.nb_2[Y][q]=S.nb_1[Y][q],S.nb_1[Y][q]=re,Q=j[q],Q*=S.minval_l[q],Q*=_e,D[q]>Q&&(D[q]=Q),S.masking_lower>1&&(D[q]*=S.masking_lower),D[q]>P[q]&&(D[q]=P[q]),S.masking_lower<1&&(D[q]*=S.masking_lower),Ce(D[q]>=0)}for(;q<T.CBANDS;++q)P[q]=0,D[q]=0}function vt(S,B){var P=S.internal_flags;S.short_blocks==Fa.short_block_coupled&&!(B[0]!=0&&B[1]!=0)&&(B[0]=B[1]=0);for(var D=0;D<P.channels_out;D++)S.short_blocks==Fa.short_block_dispensed&&(B[D]=1),S.short_blocks==Fa.short_block_forced&&(B[D]=0)}function Et(S,B,P){for(var D=S.internal_flags,Y=0;Y<D.channels_out;Y++){var j=T.NORM_TYPE;B[Y]!=0?(Ce(D.blocktype_old[Y]!=T.START_TYPE),D.blocktype_old[Y]==T.SHORT_TYPE&&(j=T.STOP_TYPE)):(j=T.SHORT_TYPE,D.blocktype_old[Y]==T.NORM_TYPE&&(D.blocktype_old[Y]=T.START_TYPE),D.blocktype_old[Y]==T.STOP_TYPE&&(D.blocktype_old[Y]=T.SHORT_TYPE)),P[Y]=D.blocktype_old[Y],D.blocktype_old[Y]=j}}function Bt(S,B,P,D,Y,j,X){for(var Z=j*2,q=j>0?Math.pow(10,Y):1,ae,Q,re=0;re<X;++re){var _e=S[2][re],Ee=S[3][re],oe=B[0][re],ke=B[1][re],$=B[2][re],be=B[3][re];if(oe<=1.58*ke&&ke<=1.58*oe){var Be=P[re]*Ee,se=P[re]*_e;Q=Math.max($,Math.min(be,Be)),ae=Math.max(be,Math.min($,se))}else Q=$,ae=be;if(j>0){var xe,ne,Me=D[re]*q;if(xe=Math.min(Math.max(oe,Me),Math.max(ke,Me)),$=Math.max(Q,Me),be=Math.max(ae,Me),ne=$+be,ne>0&&xe*Z<ne){var We=xe*Z/ne;$*=We,be*=We}Q=Math.min($,Q),ae=Math.min(be,ae)}Q>_e&&(Q=_e),ae>Ee&&(ae=Ee),B[2][re]=Q,B[3][re]=ae}}this.L3psycho_anal_vbr=function(S,B,P,D,Y,j,X,Z,q,ae){var Q=S.internal_flags,re,_e,Ee=st(T.HBLKSIZE),oe=It([3,T.HBLKSIZE_s]),ke=It([2,T.BLKSIZE]),$=It([2,3,T.BLKSIZE_s]),be=It([4,T.CBANDS]),Be=It([4,T.CBANDS]),se=It([4,3]),xe=.6,ne=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],Me=ya(2),We=S.mode==Ue.JOINT_STEREO?4:Q.channels_out;Pe(S,B,P,D,Y,j,q,se,ne,Me),vt(S,Me);{for(var pe=0;pe<We;pe++){var Te=pe&1;re=ke,Re(S,B,P,pe,D,Ee,re,Te),Oe(S,D,pe,Ee),Me[Te]!=0?rt(Q,Ee,be[pe],Be[pe],pe):Ze(Q,pe)}Me[0]+Me[1]==2&&S.mode==Ue.JOINT_STEREO&&Bt(be,Be,Q.mld_cb_l,Q.ATH.cb_l,S.ATHlower*Q.ATH.adjust,S.msfix,Q.npart_l);for(var pe=0;pe<We;pe++){var Te=pe&1;Me[Te]!=0&&i(Q,be[pe],Be[pe],pe)}}{for(var Ne=0;Ne<3;Ne++){for(var pe=0;pe<We;++pe){var Te=pe&1;Me[Te]!=0?Fe(Q,pe,Ne):(_e=$,He(S,B,P,pe,Ne,oe,_e,Te),lt(S,oe,be[pe],Be[pe],pe,Ne))}Me[0]+Me[1]==0&&S.mode==Ue.JOINT_STEREO&&Bt(be,Be,Q.mld_cb_s,Q.ATH.cb_s,S.ATHlower*Q.ATH.adjust,S.msfix,Q.npart_s);for(var pe=0;pe<We;++pe){var Te=pe&1;Me[Te]==0&&z(Q,be[pe],Be[pe],pe,Ne)}}for(var pe=0;pe<We;pe++){var Te=pe&1;if(Me[Te]==0)for(var Qe=0;Qe<T.SBMAX_s;Qe++){for(var Ct=st(3),Ne=0;Ne<3;Ne++){var ot=Q.thm[pe].s[Qe][Ne];if(ot*=b,ne[pe][Ne]>=2||ne[pe][Ne+1]==1){var Je=Ne!=0?Ne-1:2,Mt=W(Q.thm[pe].s[Qe][Je],ot,R*xe);ot=Math.min(ot,Mt)}else if(ne[pe][Ne]==1){var Je=Ne!=0?Ne-1:2,Mt=W(Q.thm[pe].s[Qe][Je],ot,h*xe);ot=Math.min(ot,Mt)}else if(Ne!=0&&ne[pe][Ne-1]==3||Ne==0&&Q.nsPsy.lastAttacks[pe]==3){var Je=Ne!=2?Ne+1:0,Mt=W(Q.thm[pe].s[Qe][Je],ot,h*xe);ot=Math.min(ot,Mt)}ot*=se[pe][Ne],Ct[Ne]=ot}for(var Ne=0;Ne<3;Ne++)Q.thm[pe].s[Qe][Ne]=Ct[Ne]}}}for(var pe=0;pe<We;pe++)Q.nsPsy.lastAttacks[pe]=ne[pe][2];Et(S,Me,ae);for(var pe=0;pe<We;pe++){var Ot,Nt,zt,qt;pe>1?(Ot=Z,Nt=-2,zt=T.NORM_TYPE,(ae[0]==T.SHORT_TYPE||ae[1]==T.SHORT_TYPE)&&(zt=T.SHORT_TYPE),qt=j[D][pe-2]):(Ot=X,Nt=0,zt=ae[pe],qt=Y[D][pe]),zt==T.SHORT_TYPE?Ot[Nt+pe]=he(qt,Q.masking_lower):Ot[Nt+pe]=de(qt,Q.masking_lower),S.analysis&&(Q.pinfo.pe[D][pe]=Ot[Nt+pe])}return 0};function it(S,B){var P=S,D;return P>=0?D=-P*27:D=P*B,D<=-72?0:Math.exp(D*o)}function Ht(S){var B=0,P=0;{var D=0,Y,j;for(D=0;it(D,S)>1e-20;D-=1);for(Y=D,j=0;Math.abs(j-Y)>1e-12;)D=(j+Y)/2,it(D,S)>0?j=D:Y=D;B=Y}{var D=0,Y,j;for(D=0;it(D,S)>1e-20;D+=1);for(Y=0,j=D;Math.abs(j-Y)>1e-12;)D=(j+Y)/2,it(D,S)>0?Y=D:j=D;P=j}{var X=0,Z=1e3,q;for(q=0;q<=Z;++q){var D=B+q*(P-B)/Z,ae=it(D,S);X+=ae}{var Q=(Z+1)/(X*(P-B));return Q}}}function gt(S){var B,P,D,Y;return B=S,B>=0?B*=3:B*=1.5,B>=.5&&B<=2.5?(Y=B-.5,P=8*(Y*Y-2*Y)):P=0,B+=.474,D=15.811389+7.5*B-17.5*Math.sqrt(1+B*B),D<=-60?0:(B=Math.exp((P+D)*o),B/=.6609193,B)}function ct(S){return S<0&&(S=0),S=S*.001,13*Math.atan(.76*S)+3.5*Math.atan(S*S/(7.5*7.5))}function le(S,B,P,D,Y,j,X,Z,q,ae,Q,re){var _e=st(T.CBANDS+1),Ee=Z/(re>15?2*576:2*192),oe=ya(T.HBLKSIZE),ke;Z/=q;var $=0,be=0;for(ke=0;ke<T.CBANDS;ke++){var Be,se;for(Be=ct(Z*$),_e[ke]=Z*$,se=$;ct(Z*se)-Be<k&&se<=q/2;se++);for(S[ke]=se-$,be=ke+1;$<se;)oe[$++]=ke;if($>q/2){$=q/2,++ke;break}}_e[ke]=Z*$;for(var xe=0;xe<re;xe++){var ne,Me,We,pe,Te;We=ae[xe],pe=ae[xe+1],ne=0|Math.floor(.5+Q*(We-.5)),ne<0&&(ne=0),Me=0|Math.floor(.5+Q*(pe-.5)),Me>q/2&&(Me=q/2),P[xe]=(oe[ne]+oe[Me])/2,B[xe]=oe[Me];var Ne=Ee*pe;X[xe]=(Ne-_e[B[xe]])/(_e[B[xe]+1]-_e[B[xe]]),X[xe]<0?X[xe]=0:X[xe]>1&&(X[xe]=1),Te=ct(Z*ae[xe]*Q),Te=Math.min(Te,15.5)/15.5,j[xe]=Math.pow(10,1.25*(1-Math.cos(Math.PI*Te))-2.5)}$=0;for(var Qe=0;Qe<be;Qe++){var Ct=S[Qe],Be,ot;Be=ct(Z*$),ot=ct(Z*($+Ct-1)),D[Qe]=.5*(Be+ot),Be=ct(Z*($-.5)),ot=ct(Z*($+Ct-.5)),Y[Qe]=ot-Be,$+=Ct}return be}function ge(S,B,P,D,Y,j){var X=It([T.CBANDS,T.CBANDS]),Z,q=0;if(j)for(var ae=0;ae<B;ae++)for(Z=0;Z<B;Z++){var Q=gt(P[ae]-P[Z])*D[Z];X[ae][Z]=Q*Y[ae]}else for(Z=0;Z<B;Z++)for(var re=15+Math.min(21/P[Z],12),_e=Ht(re),ae=0;ae<B;ae++){var Q=_e*it(P[ae]-P[Z],re)*D[Z];X[ae][Z]=Q*Y[ae]}for(var ae=0;ae<B;ae++){for(Z=0;Z<B&&!(X[ae][Z]>0);Z++);for(S[ae][0]=Z,Z=B-1;Z>0&&!(X[ae][Z]>0);Z--);S[ae][1]=Z,q+=S[ae][1]-S[ae][0]+1}for(var Ee=st(q),oe=0,ae=0;ae<B;ae++)for(Z=S[ae][0];Z<=S[ae][1];Z++)Ee[oe++]=X[ae][Z];return Ee}function te(S){var B=ct(S);return B=Math.min(B,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*B))-2.5)}this.psymodel_init=function(S){var B=S.internal_flags,P,D=!0,Y=13,j=24,X=0,Z=0,q=-8.25,ae=-4.5,Q=st(T.CBANDS),re=st(T.CBANDS),_e=st(T.CBANDS),Ee=S.out_samplerate;switch(S.experimentalZ){default:case 0:D=!0;break;case 1:D=!(S.VBR==Pa.vbr_mtrh||S.VBR==Pa.vbr_mt);break;case 2:D=!1;break;case 3:Y=8,X=-1.75,Z=-.0125,q=-8.25,ae=-2.25;break}for(B.ms_ener_ratio_old=.25,B.blocktype_old[0]=B.blocktype_old[1]=T.NORM_TYPE,P=0;P<4;++P){for(var $=0;$<T.CBANDS;++$)B.nb_1[P][$]=1e20,B.nb_2[P][$]=1e20,B.nb_s1[P][$]=B.nb_s2[P][$]=1;for(var oe=0;oe<T.SBMAX_l;oe++)B.en[P].l[oe]=1e20,B.thm[P].l[oe]=1e20;for(var $=0;$<3;++$){for(var oe=0;oe<T.SBMAX_s;oe++)B.en[P].s[oe][$]=1e20,B.thm[P].s[oe][$]=1e20;B.nsPsy.lastAttacks[P]=0}for(var $=0;$<9;$++)B.nsPsy.last_en_subshort[P][$]=10}for(B.loudness_sq_save[0]=B.loudness_sq_save[1]=0,B.npart_l=le(B.numlines_l,B.bo_l,B.bm_l,Q,re,B.mld_l,B.PSY.bo_l_weight,Ee,T.BLKSIZE,B.scalefac_band.l,T.BLKSIZE/(2*576),T.SBMAX_l),Ce(B.npart_l<T.CBANDS),P=0;P<B.npart_l;P++){var ke=X;Q[P]>=Y&&(ke=Z*(Q[P]-Y)/(j-Y)+X*(j-Q[P])/(j-Y)),_e[P]=Math.pow(10,ke/10),B.numlines_l[P]>0?B.rnumlines_l[P]=1/B.numlines_l[P]:B.rnumlines_l[P]=0}B.s3_ll=ge(B.s3ind,B.npart_l,Q,re,_e,D);var $=0;for(P=0;P<B.npart_l;P++){var be;be=Gn.MAX_VALUE;for(var Be=0;Be<B.numlines_l[P];Be++,$++){var se=Ee*$/(1e3*T.BLKSIZE),xe;xe=this.ATHformula(se*1e3,S)-20,xe=Math.pow(10,.1*xe),xe*=B.numlines_l[P],be>xe&&(be=xe)}B.ATH.cb_l[P]=be,be=-20+Q[P]*20/10,be>6&&(be=100),be<-15&&(be=-15),be-=8,B.minval_l[P]=Math.pow(10,be/10)*B.numlines_l[P]}for(B.npart_s=le(B.numlines_s,B.bo_s,B.bm_s,Q,re,B.mld_s,B.PSY.bo_s_weight,Ee,T.BLKSIZE_s,B.scalefac_band.s,T.BLKSIZE_s/(2*192),T.SBMAX_s),Ce(B.npart_s<T.CBANDS),$=0,P=0;P<B.npart_s;P++){var be,ke=q;Q[P]>=Y&&(ke=ae*(Q[P]-Y)/(j-Y)+q*(j-Q[P])/(j-Y)),_e[P]=Math.pow(10,ke/10),be=Gn.MAX_VALUE;for(var Be=0;Be<B.numlines_s[P];Be++,$++){var se=Ee*$/(1e3*T.BLKSIZE_s),xe;xe=this.ATHformula(se*1e3,S)-20,xe=Math.pow(10,.1*xe),xe*=B.numlines_s[P],be>xe&&(be=xe)}B.ATH.cb_s[P]=be,be=-7+Q[P]*7/12,Q[P]>12&&(be*=1+Math.log(1+be)*3.1),Q[P]<12&&(be*=1+Math.log(1-be)*2.3),be<-15&&(be=-15),be-=8,B.minval_s[P]=Math.pow(10,be/10)*B.numlines_s[P]}B.s3_ss=ge(B.s3ind_s,B.npart_s,Q,re,_e,D),y(),e.init_fft(B),B.decay=Math.exp(-1*t/(L*Ee/192));{var ne;ne=M,(S.exp_nspsytune&2)!=0&&(ne=1),Math.abs(S.msfix)>0&&(ne=S.msfix),S.msfix=ne;for(var Me=0;Me<B.npart_l;Me++)B.s3ind[Me][1]>B.npart_l-1&&(B.s3ind[Me][1]=B.npart_l-1)}var We=576*B.mode_gr/Ee;if(B.ATH.decay=Math.pow(10,-12/10*We),B.ATH.adjust=.01,B.ATH.adjustLimit=1,Ce(B.bo_l[T.SBMAX_l-1]<=B.npart_l),Ce(B.bo_s[T.SBMAX_s-1]<=B.npart_s),S.ATHtype!=-1){var se,pe=S.out_samplerate/T.BLKSIZE,Te=0;for(se=0,P=0;P<T.BLKSIZE/2;++P)se+=pe,B.ATH.eql_w[P]=1/Math.pow(10,this.ATHformula(se,S)/10),Te+=B.ATH.eql_w[P];for(Te=1/Te,P=T.BLKSIZE/2;--P>=0;)B.ATH.eql_w[P]*=Te}{for(var Me=$=0;Me<B.npart_s;++Me)for(P=0;P<B.numlines_s[Me];++P)++$;for(var Me=$=0;Me<B.npart_l;++Me)for(P=0;P<B.numlines_l[Me];++P)++$}for($=0,P=0;P<B.npart_l;P++){var se=Ee*($+B.numlines_l[P]/2)/(1*T.BLKSIZE);B.mld_cb_l[P]=te(se),$+=B.numlines_l[P]}for(;P<T.CBANDS;++P)B.mld_cb_l[P]=1;for($=0,P=0;P<B.npart_s;P++){var se=Ee*($+B.numlines_s[P]/2)/(1*T.BLKSIZE_s);B.mld_cb_s[P]=te(se),$+=B.numlines_s[P]}for(;P<T.CBANDS;++P)B.mld_cb_s[P]=1;return 0};function ye(S,B){S<-.3&&(S=3410),S/=1e3,S=Math.max(.1,S);var P=3.64*Math.pow(S,-.8)-6.8*Math.exp(-.6*Math.pow(S-3.4,2))+6*Math.exp(-.15*Math.pow(S-8.7,2))+(.6+.04*B)*.001*Math.pow(S,4);return P}this.ATHformula=function(S,B){var P;switch(B.ATHtype){case 0:P=ye(S,9);break;case 1:P=ye(S,-1);break;case 2:P=ye(S,0);break;case 3:P=ye(S,1)+6;break;case 4:P=ye(S,B.ATHcurve);break;default:P=ye(S,0);break}return P}}function Bd(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=Ue.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var la={};la.SFBMAX=T.SBMAX_s*3;var Cd=fe.new_float,xa=fe.new_int;function to(){this.xr=Cd(576),this.l3_enc=xa(576),this.scalefac=xa(la.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=xa(3),this.subblock_gain=xa(3+1),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=xa(la.SFBMAX),this.window=xa(la.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=xa(4),this.max_nonzero_coeff=0;var e=this;function t(n){return new Int32Array(n)}function a(n){return new Float32Array(n)}this.assign=function(n){e.xr=a(n.xr),e.l3_enc=t(n.l3_enc),e.scalefac=t(n.scalefac),e.xrpow_max=n.xrpow_max,e.part2_3_length=n.part2_3_length,e.big_values=n.big_values,e.count1=n.count1,e.global_gain=n.global_gain,e.scalefac_compress=n.scalefac_compress,e.block_type=n.block_type,e.mixed_block_flag=n.mixed_block_flag,e.table_select=t(n.table_select),e.subblock_gain=t(n.subblock_gain),e.region0_count=n.region0_count,e.region1_count=n.region1_count,e.preflag=n.preflag,e.scalefac_scale=n.scalefac_scale,e.count1table_select=n.count1table_select,e.part2_length=n.part2_length,e.sfb_lmax=n.sfb_lmax,e.sfb_smin=n.sfb_smin,e.psy_lmax=n.psy_lmax,e.sfbmax=n.sfbmax,e.psymax=n.psymax,e.sfbdivide=n.sfbdivide,e.width=t(n.width),e.window=t(n.window),e.count1bits=n.count1bits,e.sfb_partition_table=n.sfb_partition_table.slice(0),e.slen=t(n.slen),e.max_nonzero_coeff=n.max_nonzero_coeff}}var Kn=fe.new_int;function Od(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[Kn(4),Kn(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new to}var ao=fe.System,ro=fe.new_int;function Zt(e,t,a,n){this.l=ro(1+T.SBMAX_l),this.s=ro(1+T.SBMAX_s),this.psfb21=ro(1+T.PSFB21),this.psfb12=ro(1+T.PSFB12);var d=this.l,s=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],ao.arraycopy(this.arrL,0,d,0,Math.min(this.arrL.length,this.l.length)),ao.arraycopy(this.arrS,0,s,0,Math.min(this.arrS.length,this.s.length)),ao.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),ao.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var Xo=fe.new_float,Nd=fe.new_float_n,Ld=fe.new_int;function Id(){this.last_en_subshort=Nd([4,9]),this.lastAttacks=Ld(4),this.pefirbuf=Xo(19),this.longfact=Xo(T.SBMAX_l),this.shortfact=Xo(T.SBMAX_s),this.attackthre=0,this.attackthre_s=0}function jd(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var Vd=fe.new_byte,Hd=fe.new_double,jt=fe.new_float,wa=fe.new_float_n,Dt=fe.new_int,oo=fe.new_int_n;Ve.MFSIZE=3*1152+T.ENCDELAY-T.MDCTDELAY,Ve.MAX_HEADER_BUF=256,Ve.MAX_BITS_PER_CHANNEL=4095,Ve.MAX_BITS_PER_GRANULE=7680,Ve.BPC=320;function Ve(){var e=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=wa([2,Ve.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new Od,this.ms_ratio=jt(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=Dt(2),this.CurrentStep=Dt(2),this.masking_lower=0,this.bv_scf=Dt(576),this.pseudohalf=Dt(la.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*Ve.BPC+1),this.itime=Hd(2),this.sideinfo_len=0,this.sb_sample=wa([2,2,18,T.SBLIMIT]),this.amp_filter=jt(32);function t(){this.write_timing=0,this.ptr=0,this.buf=Vd(e)}this.header=new Array(Ve.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new Zt,this.minval_l=jt(T.CBANDS),this.minval_s=jt(T.CBANDS),this.nb_1=wa([4,T.CBANDS]),this.nb_2=wa([4,T.CBANDS]),this.nb_s1=wa([4,T.CBANDS]),this.nb_s2=wa([4,T.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=jt(4),this.loudness_sq=wa([2,2]),this.loudness_sq_save=jt(2),this.mld_l=jt(T.SBMAX_l),this.mld_s=jt(T.SBMAX_s),this.bm_l=Dt(T.SBMAX_l),this.bo_l=Dt(T.SBMAX_l),this.bm_s=Dt(T.SBMAX_s),this.bo_s=Dt(T.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=oo([T.CBANDS,2]),this.s3ind_s=oo([T.CBANDS,2]),this.numlines_s=Dt(T.CBANDS),this.numlines_l=Dt(T.CBANDS),this.rnumlines_l=jt(T.CBANDS),this.mld_cb_l=jt(T.CBANDS),this.mld_cb_s=jt(T.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=jt(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=Dt(2),this.nsPsy=new Id,this.VBR_seek_table=new jd,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=oo([16,4+1]),this.bitrate_blockType_Hist=oo([16,4+1+1]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var a=0;a<this.en.length;a++)this.en[a]=new Jr;for(var a=0;a<this.thm.length;a++)this.thm[a]=new Jr;for(var a=0;a<this.header.length;a++)this.header[a]=new t}var ka=fe.new_float;function Pd(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=ka(T.SBMAX_l),this.s=ka(T.SBMAX_s),this.psfb21=ka(T.PSFB21),this.psfb12=ka(T.PSFB12),this.cb_l=ka(T.CBANDS),this.cb_s=ka(T.CBANDS),this.eql_w=ka(T.BLKSIZE/2)}var St=fe.System,Zn=fe.Arrays;at.STEPS_per_dB=100,at.MAX_dB=120,at.GAIN_NOT_ENOUGH_SAMPLES=-24601,at.GAIN_ANALYSIS_ERROR=0,at.GAIN_ANALYSIS_OK=1,at.INIT_GAIN_ANALYSIS_ERROR=0,at.INIT_GAIN_ANALYSIS_OK=1,at.YULE_ORDER=10,at.MAX_ORDER=at.YULE_ORDER,at.MAX_SAMP_FREQ=48e3,at.RMS_WINDOW_TIME_NUMERATOR=1,at.RMS_WINDOW_TIME_DENOMINATOR=20,at.MAX_SAMPLES_PER_WINDOW=at.MAX_SAMP_FREQ*at.RMS_WINDOW_TIME_NUMERATOR/at.RMS_WINDOW_TIME_DENOMINATOR+1;function at(){var e=64.82,t=.95,a=at.RMS_WINDOW_TIME_NUMERATOR,n=at.RMS_WINDOW_TIME_DENOMINATOR,d=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],s=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function k(h,M,w,o,F,H){for(;F--!=0;)w[o]=1e-10+h[M+0]*H[0]-w[o-1]*H[1]+h[M-1]*H[2]-w[o-2]*H[3]+h[M-2]*H[4]-w[o-3]*H[5]+h[M-3]*H[6]-w[o-4]*H[7]+h[M-4]*H[8]-w[o-5]*H[9]+h[M-5]*H[10]-w[o-6]*H[11]+h[M-6]*H[12]-w[o-7]*H[13]+h[M-7]*H[14]-w[o-8]*H[15]+h[M-8]*H[16]-w[o-9]*H[17]+h[M-9]*H[18]-w[o-10]*H[19]+h[M-10]*H[20],++o,++M}function C(h,M,w,o,F,H){for(;F--!=0;)w[o]=h[M+0]*H[0]-w[o-1]*H[1]+h[M-1]*H[2]-w[o-2]*H[3]+h[M-2]*H[4],++o,++M}function L(h,M){for(var w=0;w<MAX_ORDER;w++)h.linprebuf[w]=h.lstepbuf[w]=h.loutbuf[w]=h.rinprebuf[w]=h.rstepbuf[w]=h.routbuf[w]=0;switch(0|M){case 48e3:h.reqindex=0;break;case 44100:h.reqindex=1;break;case 32e3:h.reqindex=2;break;case 24e3:h.reqindex=3;break;case 22050:h.reqindex=4;break;case 16e3:h.reqindex=5;break;case 12e3:h.reqindex=6;break;case 11025:h.reqindex=7;break;case 8e3:h.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return h.sampleWindow=0|(M*a+n-1)/n,h.lsum=0,h.rsum=0,h.totsamp=0,Zn.ill(h.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(h,M){return L(h,M)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(h.linpre=MAX_ORDER,h.rinpre=MAX_ORDER,h.lstep=MAX_ORDER,h.rstep=MAX_ORDER,h.lout=MAX_ORDER,h.rout=MAX_ORDER,Zn.fill(h.B,0),INIT_GAIN_ANALYSIS_OK)};function b(h){return h*h}this.AnalyzeSamples=function(h,M,w,o,F,H,V){var c,A,N,E,O,l,x;if(H==0)return GAIN_ANALYSIS_OK;switch(x=0,O=H,V){case 1:o=M,F=w;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(H<MAX_ORDER?(St.arraycopy(M,w,h.linprebuf,MAX_ORDER,H),St.arraycopy(o,F,h.rinprebuf,MAX_ORDER,H)):(St.arraycopy(M,w,h.linprebuf,MAX_ORDER,MAX_ORDER),St.arraycopy(o,F,h.rinprebuf,MAX_ORDER,MAX_ORDER));O>0;){l=O>h.sampleWindow-h.totsamp?h.sampleWindow-h.totsamp:O,x<MAX_ORDER?(c=h.linpre+x,A=h.linprebuf,N=h.rinpre+x,E=h.rinprebuf,l>MAX_ORDER-x&&(l=MAX_ORDER-x)):(c=w+x,A=M,N=F+x,E=o),k(A,c,h.lstepbuf,h.lstep+h.totsamp,l,d[h.reqindex]),k(E,N,h.rstepbuf,h.rstep+h.totsamp,l,d[h.reqindex]),C(h.lstepbuf,h.lstep+h.totsamp,h.loutbuf,h.lout+h.totsamp,l,s[h.reqindex]),C(h.rstepbuf,h.rstep+h.totsamp,h.routbuf,h.rout+h.totsamp,l,s[h.reqindex]),c=h.lout+h.totsamp,A=h.loutbuf,N=h.rout+h.totsamp,E=h.routbuf;for(var y=l%8;y--!=0;)h.lsum+=b(A[c++]),h.rsum+=b(E[N++]);for(y=l/8;y--!=0;)h.lsum+=b(A[c+0])+b(A[c+1])+b(A[c+2])+b(A[c+3])+b(A[c+4])+b(A[c+5])+b(A[c+6])+b(A[c+7]),c+=8,h.rsum+=b(E[N+0])+b(E[N+1])+b(E[N+2])+b(E[N+3])+b(E[N+4])+b(E[N+5])+b(E[N+6])+b(E[N+7]),N+=8;if(O-=l,x+=l,h.totsamp+=l,h.totsamp==h.sampleWindow){var m=at.STEPS_per_dB*10*Math.log10((h.lsum+h.rsum)/h.totsamp*.5+1e-37),f=m<=0?0:0|m;f>=h.A.length&&(f=h.A.length-1),h.A[f]++,h.lsum=h.rsum=0,St.arraycopy(h.loutbuf,h.totsamp,h.loutbuf,0,MAX_ORDER),St.arraycopy(h.routbuf,h.totsamp,h.routbuf,0,MAX_ORDER),St.arraycopy(h.lstepbuf,h.totsamp,h.lstepbuf,0,MAX_ORDER),St.arraycopy(h.rstepbuf,h.totsamp,h.rstepbuf,0,MAX_ORDER),h.totsamp=0}if(h.totsamp>h.sampleWindow)return GAIN_ANALYSIS_ERROR}return H<MAX_ORDER?(St.arraycopy(h.linprebuf,H,h.linprebuf,0,MAX_ORDER-H),St.arraycopy(h.rinprebuf,H,h.rinprebuf,0,MAX_ORDER-H),St.arraycopy(M,w,h.linprebuf,MAX_ORDER-H,H),St.arraycopy(o,F,h.rinprebuf,MAX_ORDER-H,H)):(St.arraycopy(M,w+H-MAX_ORDER,h.linprebuf,0,MAX_ORDER),St.arraycopy(o,F+H-MAX_ORDER,h.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function R(h,M){var w,o=0;for(w=0;w<M;w++)o+=h[w];if(o==0)return GAIN_NOT_ENOUGH_SAMPLES;var F=0|Math.ceil(o*(1-t));for(w=M;w-- >0&&!((F-=h[w])<=0););return e-w/at.STEPS_per_dB}this.GetTitleGain=function(h){for(var M=R(h.A,h.A.length),w=0;w<h.A.length;w++)h.B[w]+=h.A[w],h.A[w]=0;for(var w=0;w<MAX_ORDER;w++)h.linprebuf[w]=h.lstepbuf[w]=h.loutbuf[w]=h.rinprebuf[w]=h.rstepbuf[w]=h.routbuf[w]=0;return h.totsamp=0,h.lsum=h.rsum=0,M}}var Ua=fe.new_float,Wn=fe.new_int;function Fd(){this.linprebuf=Ua(void 0*2),this.linpre=0,this.lstepbuf=Ua(void 0+void 0),this.lstep=0,this.loutbuf=Ua(void 0+void 0),this.lout=0,this.rinprebuf=Ua(void 0*2),this.rinpre=0,this.rstepbuf=Ua(void 0+void 0),this.rstep=0,this.routbuf=Ua(void 0+void 0),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=Wn(0|void 0*void 0),this.B=Wn(0|void 0*void 0)}function Qn(e){this.bits=e}var Jn=fe.new_float,Ud=fe.new_int,$n=fe.assert;function Dd(e){var t=e;this.quantize=t,this.iteration_loop=function(a,n,d,s){var k=a.internal_flags,C=Jn(la.SFBMAX),L=Jn(576),b=Ud(2),R=0,h,M=k.l3_side,w=new Qn(R);this.quantize.rv.ResvFrameBegin(a,w),R=w.bits;for(var o=0;o<k.mode_gr;o++){h=this.quantize.qupvt.on_pe(a,n,b,R,o,o),k.mode_ext==T.MPG_MD_MS_LR&&(this.quantize.ms_convert(k.l3_side,o),this.quantize.qupvt.reduce_side(b,d[o],R,h));for(var F=0;F<k.channels_out;F++){var H,V,c=M.tt[o][F];c.block_type!=T.SHORT_TYPE?(H=0,V=k.PSY.mask_adjust-H):(H=0,V=k.PSY.mask_adjust_short-H),k.masking_lower=Math.pow(10,V*.1),this.quantize.init_outer_loop(k,c),this.quantize.init_xrpow(k,c,L)&&(this.quantize.qupvt.calc_xmin(a,s[o][F],c,C),this.quantize.outer_loop(a,c,C,L,F,b[F])),this.quantize.iteration_finish_one(k,o,F),$n(c.part2_3_length<=Ve.MAX_BITS_PER_CHANNEL),$n(c.part2_3_length<=b[F])}}this.quantize.rv.ResvFrameEnd(k,R)}}function je(e,t,a,n){this.xlen=e,this.linmax=t,this.table=a,this.hlen=n}var ee={};ee.t1HB=[1,1,1,0],ee.t2HB=[1,2,1,3,1,1,3,2,0],ee.t3HB=[3,2,1,1,1,1,3,2,0],ee.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],ee.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],ee.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],ee.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],ee.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],ee.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],ee.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],ee.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],ee.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],ee.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],ee.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],ee.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],ee.t32HB=[1<<0,5<<1,4<<1,5<<2,6<<1,5<<2,4<<2,4<<3,7<<1,3<<2,6<<2,0<<3,7<<2,2<<3,3<<3,1<<4],ee.t33HB=[15<<0,14<<1,13<<1,12<<2,11<<1,10<<2,9<<2,8<<3,7<<1,6<<2,5<<2,4<<3,3<<2,2<<3,1<<3,0<<4],ee.t1l=[1,4,3,5],ee.t2l=[1,4,7,4,5,7,6,7,8],ee.t3l=[2,3,7,4,4,7,6,7,8],ee.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],ee.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],ee.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],ee.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],ee.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],ee.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],ee.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],ee.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],ee.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],ee.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],ee.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],ee.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],ee.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],ee.t32l=[1+0,4+1,4+1,5+2,4+1,6+2,5+2,6+3,4+1,5+2,5+2,6+3,5+2,6+3,6+3,6+4],ee.t33l=[4+0,4+1,4+1,4+2,4+1,4+2,4+2,4+3,4+1,4+2,4+2,4+3,4+2,4+3,4+3,4+4],ee.ht=[new je(0,0,null,null),new je(2,0,ee.t1HB,ee.t1l),new je(3,0,ee.t2HB,ee.t2l),new je(3,0,ee.t3HB,ee.t3l),new je(0,0,null,null),new je(4,0,ee.t5HB,ee.t5l),new je(4,0,ee.t6HB,ee.t6l),new je(6,0,ee.t7HB,ee.t7l),new je(6,0,ee.t8HB,ee.t8l),new je(6,0,ee.t9HB,ee.t9l),new je(8,0,ee.t10HB,ee.t10l),new je(8,0,ee.t11HB,ee.t11l),new je(8,0,ee.t12HB,ee.t12l),new je(16,0,ee.t13HB,ee.t13l),new je(0,0,null,ee.t16_5l),new je(16,0,ee.t15HB,ee.t15l),new je(1,1,ee.t16HB,ee.t16l),new je(2,3,ee.t16HB,ee.t16l),new je(3,7,ee.t16HB,ee.t16l),new je(4,15,ee.t16HB,ee.t16l),new je(6,63,ee.t16HB,ee.t16l),new je(8,255,ee.t16HB,ee.t16l),new je(10,1023,ee.t16HB,ee.t16l),new je(13,8191,ee.t16HB,ee.t16l),new je(4,15,ee.t24HB,ee.t24l),new je(5,31,ee.t24HB,ee.t24l),new je(6,63,ee.t24HB,ee.t24l),new je(7,127,ee.t24HB,ee.t24l),new je(8,255,ee.t24HB,ee.t24l),new je(9,511,ee.t24HB,ee.t24l),new je(11,2047,ee.t24HB,ee.t24l),new je(13,8191,ee.t24HB,ee.t24l),new je(0,0,ee.t32HB,ee.t32l),new je(0,0,ee.t33HB,ee.t33l)],ee.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],ee.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],ee.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],ee.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],ee.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],ee.scfsi_band=[0,6,11,16,21];var Sa=fe.VbrMode,so=fe.Float,Go=fe.Util,Ea=fe.new_float,zd=fe.new_int,vr=fe.assert;_t.Q_MAX=256+1,_t.Q_MAX2=116,_t.LARGE_BITS=1e5,_t.IXMAX_VAL=8206;function _t(){var e=null,t=null,a=null;this.setModules=function(c,A,N){e=c,t=A,a=N};function n(c){return h[c+_t.Q_MAX2]}this.IPOW20=function(c){return M[c]};var d=2220446049250313e-31,s=_t.IXMAX_VAL,k=s+2,C=_t.Q_MAX,L=_t.Q_MAX2,b=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var R=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=R,this.sfBandIndex=[new Zt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Zt([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Zt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Zt([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Zt([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Zt([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Zt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Zt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Zt([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var h=Ea(C+L+1),M=Ea(C),w=Ea(k),o=Ea(k);this.adj43=o;function F(c,A){var N=a.ATHformula(A,c);return N-=b,N=Math.pow(10,N/10+c.ATHlower),N}function H(c){for(var A=c.internal_flags.ATH.l,N=c.internal_flags.ATH.psfb21,E=c.internal_flags.ATH.s,O=c.internal_flags.ATH.psfb12,l=c.internal_flags,x=c.out_samplerate,y=0;y<T.SBMAX_l;y++){var m=l.scalefac_band.l[y],f=l.scalefac_band.l[y+1];A[y]=so.MAX_VALUE;for(var p=m;p<f;p++){var u=p*x/1152,v=F(c,u);A[y]=Math.min(A[y],v)}}for(var y=0;y<T.PSFB21;y++){var m=l.scalefac_band.psfb21[y],f=l.scalefac_band.psfb21[y+1];N[y]=so.MAX_VALUE;for(var p=m;p<f;p++){var u=p*x/1152,v=F(c,u);N[y]=Math.min(N[y],v)}}for(var y=0;y<T.SBMAX_s;y++){var m=l.scalefac_band.s[y],f=l.scalefac_band.s[y+1];E[y]=so.MAX_VALUE;for(var p=m;p<f;p++){var u=p*x/384,v=F(c,u);E[y]=Math.min(E[y],v)}E[y]*=l.scalefac_band.s[y+1]-l.scalefac_band.s[y]}for(var y=0;y<T.PSFB12;y++){var m=l.scalefac_band.psfb12[y],f=l.scalefac_band.psfb12[y+1];O[y]=so.MAX_VALUE;for(var p=m;p<f;p++){var u=p*x/384,v=F(c,u);O[y]=Math.min(O[y],v)}O[y]*=l.scalefac_band.s[13]-l.scalefac_band.s[12]}if(c.noATH){for(var y=0;y<T.SBMAX_l;y++)A[y]=1e-20;for(var y=0;y<T.PSFB21;y++)N[y]=1e-20;for(var y=0;y<T.SBMAX_s;y++)E[y]=1e-20;for(var y=0;y<T.PSFB12;y++)O[y]=1e-20}l.ATH.floor=10*Math.log10(F(c,-1))}this.iteration_init=function(c){var A=c.internal_flags,N=A.l3_side,E;if(A.iteration_init_init==0){for(A.iteration_init_init=1,N.main_data_begin=0,H(c),w[0]=0,E=1;E<k;E++)w[E]=Math.pow(E,4/3);for(E=0;E<k-1;E++)o[E]=E+1-Math.pow(.5*(w[E]+w[E+1]),.75);for(o[E]=.5,E=0;E<C;E++)M[E]=Math.pow(2,(E-210)*-.1875);for(E=0;E<=C+L;E++)h[E]=Math.pow(2,(E-210-L)*.25);e.huffman_init(A);{var O,l,x,y;for(E=c.exp_nspsytune>>2&63,E>=32&&(E-=64),O=Math.pow(10,E/4/10),E=c.exp_nspsytune>>8&63,E>=32&&(E-=64),l=Math.pow(10,E/4/10),E=c.exp_nspsytune>>14&63,E>=32&&(E-=64),x=Math.pow(10,E/4/10),E=c.exp_nspsytune>>20&63,E>=32&&(E-=64),y=x*Math.pow(10,E/4/10),E=0;E<T.SBMAX_l;E++){var m;E<=6?m=O:E<=13?m=l:E<=20?m=x:m=y,A.nsPsy.longfact[E]=m}for(E=0;E<T.SBMAX_s;E++){var m;E<=5?m=O:E<=10?m=l:E<=11?m=x:m=y,A.nsPsy.shortfact[E]=m}}}},this.on_pe=function(c,A,N,E,O,l){var x=c.internal_flags,y=0,m,f=zd(2),p,u=new Qn(y),v=t.ResvMaxBits(c,E,u,l);y=u.bits;var _=y+v;for(_>Ve.MAX_BITS_PER_GRANULE&&(_=Ve.MAX_BITS_PER_GRANULE),m=0,p=0;p<x.channels_out;++p)N[p]=Math.min(Ve.MAX_BITS_PER_CHANNEL,y/x.channels_out),f[p]=0|N[p]*A[O][p]/700-N[p],f[p]>E*3/4&&(f[p]=E*3/4),f[p]<0&&(f[p]=0),f[p]+N[p]>Ve.MAX_BITS_PER_CHANNEL&&(f[p]=Math.max(0,Ve.MAX_BITS_PER_CHANNEL-N[p])),m+=f[p];if(m>v)for(p=0;p<x.channels_out;++p)f[p]=v*f[p]/m;for(p=0;p<x.channels_out;++p)N[p]+=f[p],v-=f[p];for(m=0,p=0;p<x.channels_out;++p)m+=N[p];if(m>Ve.MAX_BITS_PER_GRANULE){var I=0;for(p=0;p<x.channels_out;++p)N[p]*=Ve.MAX_BITS_PER_GRANULE,N[p]/=m,I+=N[p]}return _},this.reduce_side=function(c,A,N,E){vr(c[0]+c[1]<=Ve.MAX_BITS_PER_GRANULE);var O=.33*(.5-A)/.5;O<0&&(O=0),O>.5&&(O=.5);var l=0|O*.5*(c[0]+c[1]);l>Ve.MAX_BITS_PER_CHANNEL-c[0]&&(l=Ve.MAX_BITS_PER_CHANNEL-c[0]),l<0&&(l=0),c[1]>=125&&(c[1]-l>125?(c[0]<N&&(c[0]+=l),c[1]-=l):(c[0]+=c[1]-125,c[1]=125)),l=c[0]+c[1],l>E&&(c[0]=E*c[0]/l,c[1]=E*c[1]/l),vr(c[0]<=Ve.MAX_BITS_PER_CHANNEL),vr(c[1]<=Ve.MAX_BITS_PER_CHANNEL),vr(c[0]+c[1]<=Ve.MAX_BITS_PER_GRANULE)},this.athAdjust=function(c,A,N){var E=90.30873362,O=94.82444863,l=Go.FAST_LOG10_X(A,10),x=c*c,y=0;return l-=N,x>1e-20&&(y=1+Go.FAST_LOG10_X(x,10/E)),y<0&&(y=0),l*=y,l+=N+E-O,Math.pow(10,.1*l)},this.calc_xmin=function(c,A,N,E){var O=0,l=c.internal_flags,x,y=0,m=0,f=l.ATH,p=N.xr,u=c.VBR==Sa.vbr_mtrh?1:0,v=l.masking_lower;for((c.VBR==Sa.vbr_mtrh||c.VBR==Sa.vbr_mt)&&(v=1),x=0;x<N.psy_lmax;x++){var _,I,G,U,z,i;c.VBR==Sa.vbr_rh||c.VBR==Sa.vbr_mtrh?I=athAdjust(f.adjust,f.l[x],f.floor):I=f.adjust*f.l[x],z=N.width[x],G=I/z,U=d,i=z>>1,_=0;do{var g,K;g=p[y]*p[y],_+=g,U+=g<G?g:G,y++,K=p[y]*p[y],_+=K,U+=K<G?K:G,y++}while(--i>0);if(_>I&&m++,x==T.SBPSY_l){var W=I*l.nsPsy.longfact[x];U<W&&(U=W)}if(u!=0&&(I=U),!c.ATHonly){var ie=A.en.l[x];if(ie>0){var W;W=_*A.thm.l[x]*v/ie,u!=0&&(W*=l.nsPsy.longfact[x]),I<W&&(I=W)}}u!=0?E[O++]=I:E[O++]=I*l.nsPsy.longfact[x]}var he=575;if(N.block_type!=T.SHORT_TYPE)for(var ue=576;ue--!=0&&Vt.EQ(p[ue],0);)he=ue;N.max_nonzero_coeff=he;for(var de=N.sfb_smin;x<N.psymax;de++,x+=3){var z,Se,ve;for(c.VBR==Sa.vbr_rh||c.VBR==Sa.vbr_mtrh?ve=athAdjust(f.adjust,f.s[de],f.floor):ve=f.adjust*f.s[de],z=N.width[x],Se=0;Se<3;Se++){var _=0,I,G,U,i=z>>1;G=ve/z,U=d;do{var g,K;g=p[y]*p[y],_+=g,U+=g<G?g:G,y++,K=p[y]*p[y],_+=K,U+=K<G?K:G,y++}while(--i>0);if(_>ve&&m++,de==T.SBPSY_s){var W=ve*l.nsPsy.shortfact[de];U<W&&(U=W)}if(u!=0?I=U:I=ve,!c.ATHonly&&!c.ATHshort){var ie=A.en.s[de][Se];if(ie>0){var W;W=_*A.thm.s[de][Se]*v/ie,u!=0&&(W*=l.nsPsy.shortfact[de]),I<W&&(I=W)}}u!=0?E[O++]=I:E[O++]=I*l.nsPsy.shortfact[de]}c.useTemporal&&(E[O-3]>E[O-3+1]&&(E[O-3+1]+=(E[O-3]-E[O-3+1])*l.decay),E[O-3+1]>E[O-3+2]&&(E[O-3+2]+=(E[O-3+1]-E[O-3+2])*l.decay))}return m};function V(c){this.s=c}this.calc_noise_core=function(c,A,N,E){var O=0,l=A.s,x=c.l3_enc;if(l>c.count1)for(;N--!=0;){var y;y=c.xr[l],l++,O+=y*y,y=c.xr[l],l++,O+=y*y}else if(l>c.big_values){var m=Ea(2);for(m[0]=0,m[1]=E;N--!=0;){var y;y=Math.abs(c.xr[l])-m[x[l]],l++,O+=y*y,y=Math.abs(c.xr[l])-m[x[l]],l++,O+=y*y}}else for(;N--!=0;){var y;y=Math.abs(c.xr[l])-w[x[l]]*E,l++,O+=y*y,y=Math.abs(c.xr[l])-w[x[l]]*E,l++,O+=y*y}return A.s=l,O},this.calc_noise=function(c,A,N,E,O){var l=0,x=0,y,m,f=0,p=0,u=0,v=-20,_=0,I=c.scalefac,G=0;for(E.over_SSD=0,y=0;y<c.psymax;y++){var U=c.global_gain-(I[G++]+(c.preflag!=0?R[y]:0)<<c.scalefac_scale+1)-c.subblock_gain[c.window[y]]*8,z=0;if(O!=null&&O.step[y]==U)z=O.noise[y],_+=c.width[y],N[l++]=z/A[x++],z=O.noise_log[y];else{var i=n(U);if(m=c.width[y]>>1,_+c.width[y]>c.max_nonzero_coeff){var g;g=c.max_nonzero_coeff-_+1,g>0?m=g>>1:m=0}var K=new V(_);z=this.calc_noise_core(c,K,m,i),_=K.s,O!=null&&(O.step[y]=U,O.noise[y]=z),z=N[l++]=z/A[x++],z=Go.FAST_LOG10(Math.max(z,1e-20)),O!=null&&(O.noise_log[y]=z)}if(O!=null&&(O.global_gain=c.global_gain),u+=z,z>0){var W;W=Math.max(0|z*10+.5,1),E.over_SSD+=W*W,f++,p+=z}v=Math.max(v,z)}return E.over_count=f,E.tot_noise=u,E.over_noise=p,E.max_noise=v,f},this.set_pinfo=function(c,A,N,E,O){var l=c.internal_flags,x,y,m,f,p,u=A.scalefac_scale==0?.5:1,v=A.scalefac,_=Ea(L3Side.SFBMAX),I=Ea(L3Side.SFBMAX),G=new CalcNoiseResult;calc_xmin(c,N,A,_),calc_noise(A,_,I,G,null);var U=0;for(y=A.sfb_lmax,A.block_type!=T.SHORT_TYPE&&A.mixed_block_flag==0&&(y=22),x=0;x<y;x++){var z=l.scalefac_band.l[x],i=l.scalefac_band.l[x+1],g=i-z;for(f=0;U<i;U++)f+=A.xr[U]*A.xr[U];f/=g,p=1e15,l.pinfo.en[E][O][x]=p*f,l.pinfo.xfsf[E][O][x]=p*_[x]*I[x]/g,N.en.l[x]>0&&!c.ATHonly?f=f/N.en.l[x]:f=0,l.pinfo.thr[E][O][x]=p*Math.max(f*N.thm.l[x],l.ATH.l[x]),l.pinfo.LAMEsfb[E][O][x]=0,A.preflag!=0&&x>=11&&(l.pinfo.LAMEsfb[E][O][x]=-u*R[x]),x<T.SBPSY_l&&(vr(v[x]>=0),l.pinfo.LAMEsfb[E][O][x]-=u*v[x])}if(A.block_type==T.SHORT_TYPE)for(y=x,x=A.sfb_smin;x<T.SBMAX_s;x++)for(var z=l.scalefac_band.s[x],i=l.scalefac_band.s[x+1],g=i-z,K=0;K<3;K++){for(f=0,m=z;m<i;m++)f+=A.xr[U]*A.xr[U],U++;f=Math.max(f/g,1e-20),p=1e15,l.pinfo.en_s[E][O][3*x+K]=p*f,l.pinfo.xfsf_s[E][O][3*x+K]=p*_[y]*I[y]/g,N.en.s[x][K]>0?f=f/N.en.s[x][K]:f=0,(c.ATHonly||c.ATHshort)&&(f=0),l.pinfo.thr_s[E][O][3*x+K]=p*Math.max(f*N.thm.s[x][K],l.ATH.s[x]),l.pinfo.LAMEsfb_s[E][O][3*x+K]=-2*A.subblock_gain[K],x<T.SBPSY_s&&(l.pinfo.LAMEsfb_s[E][O][3*x+K]-=u*v[y]),y++}l.pinfo.LAMEqss[E][O]=A.global_gain,l.pinfo.LAMEmainbits[E][O]=A.part2_3_length+A.part2_length,l.pinfo.LAMEsfbits[E][O]=A.part2_length,l.pinfo.over[E][O]=G.over_count,l.pinfo.max_noise[E][O]=G.max_noise*10,l.pinfo.over_noise[E][O]=G.over_noise*10,l.pinfo.tot_noise[E][O]=G.tot_noise*10,l.pinfo.over_SSD[E][O]=G.over_SSD}}var qd=fe.System,Yd=fe.Arrays,gr=fe.new_int,Ko=fe.assert;function br(){var e=null;this.qupvt=null,this.setModules=function(m){this.qupvt=m,e=m};function t(m){this.bits=0|m}var a=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function n(m,f,p,u,v,_){var I=.5946/f;for(m=m>>1;m--!=0;)v[_++]=I>p[u++]?0:1,v[_++]=I>p[u++]?0:1}function d(m,f,p,u,v,_){m=m>>1;var I=m%2;for(m=m>>1;m--!=0;){var G,U,z,i,g,K,W,ie;G=p[u++]*f,U=p[u++]*f,g=0|G,z=p[u++]*f,K=0|U,i=p[u++]*f,W=0|z,G+=e.adj43[g],ie=0|i,U+=e.adj43[K],v[_++]=0|G,z+=e.adj43[W],v[_++]=0|U,i+=e.adj43[ie],v[_++]=0|z,v[_++]=0|i}if(I!=0){var G,U,g,K;G=p[u++]*f,U=p[u++]*f,g=0|G,K=0|U,G+=e.adj43[g],U+=e.adj43[K],v[_++]=0|G,v[_++]=0|U}}function s(m,f,p,u,v){var _,I,G=0,U,z=0,i=0,g=0,K=f,W=0,ie=K,he=0,ue=m,de=0;for(U=v!=null&&u.global_gain==v.global_gain,u.block_type==T.SHORT_TYPE?I=38:I=21,_=0;_<=I;_++){var Se=-1;if((U||u.block_type==T.NORM_TYPE)&&(Se=u.global_gain-(u.scalefac[_]+(u.preflag!=0?e.pretab[_]:0)<<u.scalefac_scale+1)-u.subblock_gain[u.window[_]]*8),Ko(u.width[_]>=0),U&&v.step[_]==Se)z!=0&&(d(z,p,ue,de,ie,he),z=0),i!=0&&(n(i,p,ue,de,ie,he),i=0);else{var ve=u.width[_];if(G+u.width[_]>u.max_nonzero_coeff){var ce;ce=u.max_nonzero_coeff-G+1,Yd.fill(f,u.max_nonzero_coeff,576,0),ve=ce,ve<0&&(ve=0),_=I+1}if(z==0&&i==0&&(ie=K,he=W,ue=m,de=g),v!=null&&v.sfb_count1>0&&_>=v.sfb_count1&&v.step[_]>0&&Se>=v.step[_]?(z!=0&&(d(z,p,ue,de,ie,he),z=0,ie=K,he=W,ue=m,de=g),i+=ve):(i!=0&&(n(i,p,ue,de,ie,he),i=0,ie=K,he=W,ue=m,de=g),z+=ve),ve<=0){i!=0&&(n(i,p,ue,de,ie,he),i=0),z!=0&&(d(z,p,ue,de,ie,he),z=0);break}}_<=I&&(W+=u.width[_],g+=u.width[_],G+=u.width[_])}z!=0&&(d(z,p,ue,de,ie,he),z=0),i!=0&&(n(i,p,ue,de,ie,he),i=0)}function k(m,f,p){var u=0,v=0;do{var _=m[f++],I=m[f++];u<_&&(u=_),v<I&&(v=I)}while(f<p);return u<v&&(u=v),u}function C(m,f,p,u,v,_){var I=ee.ht[u].xlen*65536+ee.ht[v].xlen,G=0,U;do{var z=m[f++],i=m[f++];z!=0&&(z>14&&(z=15,G+=I),z*=16),i!=0&&(i>14&&(i=15,G+=I),z+=i),G+=ee.largetbl[z]}while(f<p);return U=G&65535,G>>=16,G>U&&(G=U,u=v),_.bits+=G,u}function L(m,f,p,u){var v=0,_=ee.ht[1].hlen;do{var I=m[f+0]*2+m[f+1];f+=2,v+=_[I]}while(f<p);return u.bits+=v,1}function b(m,f,p,u,v){var _=0,I,G=ee.ht[u].xlen,U;u==2?U=ee.table23:U=ee.table56;do{var z=m[f+0]*G+m[f+1];f+=2,_+=U[z]}while(f<p);return I=_&65535,_>>=16,_>I&&(_=I,u++),v.bits+=_,u}function R(m,f,p,u,v){var _=0,I=0,G=0,U=ee.ht[u].xlen,z=ee.ht[u].hlen,i=ee.ht[u+1].hlen,g=ee.ht[u+2].hlen;do{var K=m[f+0]*U+m[f+1];f+=2,_+=z[K],I+=i[K],G+=g[K]}while(f<p);var W=u;return _>I&&(_=I,W++),_>G&&(_=G,W=u+2),v.bits+=_,W}var h=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function M(m,f,p,u){var v=k(m,f,p);switch(v){case 0:return v;case 1:return L(m,f,p,u);case 2:case 3:return b(m,f,p,h[v-1],u);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return R(m,f,p,h[v-1],u);default:if(v>_t.IXMAX_VAL)return u.bits=_t.LARGE_BITS,-1;v-=15;var _;for(_=24;_<32&&!(ee.ht[_].linmax>=v);_++);var I;for(I=_-8;I<24&&!(ee.ht[I].linmax>=v);I++);return C(m,f,p,I,_,u)}}this.noquant_count_bits=function(m,f,p){var u=f.l3_enc,v=Math.min(576,f.max_nonzero_coeff+2>>1<<1);for(p!=null&&(p.sfb_count1=0);v>1&&(u[v-1]|u[v-2])==0;v-=2);f.count1=v;for(var _=0,I=0;v>3;v-=4){var G;if(((u[v-1]|u[v-2]|u[v-3]|u[v-4])&2147483647)>1)break;G=((u[v-4]*2+u[v-3])*2+u[v-2])*2+u[v-1],_+=ee.t32l[G],I+=ee.t33l[G]}var U=_;if(f.count1table_select=0,_>I&&(U=I,f.count1table_select=1),f.count1bits=U,f.big_values=v,v==0)return U;if(f.block_type==T.SHORT_TYPE)_=3*m.scalefac_band.s[3],_>f.big_values&&(_=f.big_values),I=f.big_values;else if(f.block_type==T.NORM_TYPE){if(_=f.region0_count=m.bv_scf[v-2],I=f.region1_count=m.bv_scf[v-1],I=m.scalefac_band.l[_+I+2],_=m.scalefac_band.l[_+1],I<v){var z=new t(U);f.table_select[2]=M(u,I,v,z),U=z.bits}}else f.region0_count=7,f.region1_count=T.SBMAX_l-1-7-1,_=m.scalefac_band.l[7+1],I=v,_>I&&(_=I);if(_=Math.min(_,v),I=Math.min(I,v),_>0){var z=new t(U);f.table_select[0]=M(u,0,_,z),U=z.bits}if(_<I){var z=new t(U);f.table_select[1]=M(u,_,I,z),U=z.bits}if(m.use_best_huffman==2&&(f.part2_3_length=U,best_huffman_divide(m,f),U=f.part2_3_length),p!=null&&f.block_type==T.NORM_TYPE){for(var i=0;m.scalefac_band.l[i]<f.big_values;)i++;p.sfb_count1=i}return U},this.count_bits=function(m,f,p,u){var v=p.l3_enc,_=_t.IXMAX_VAL/e.IPOW20(p.global_gain);if(p.xrpow_max>_)return _t.LARGE_BITS;if(s(f,v,e.IPOW20(p.global_gain),p,u),(m.substep_shaping&2)!=0)for(var I=0,G=p.global_gain+p.scalefac_scale,U=.634521682242439/e.IPOW20(G),z=0;z<p.sfbmax;z++){var i=p.width[z];if(m.pseudohalf[z]==0)I+=i;else{var g;for(g=I,I+=i;g<I;++g)v[g]=f[g]>=U?v[g]:0}}return this.noquant_count_bits(m,p,u)};function w(m,f,p,u,v,_,I){for(var G=f.big_values,U=0;U<=7+15;U++)u[U]=_t.LARGE_BITS;for(var U=0;U<16;U++){var z=m.scalefac_band.l[U+1];if(z>=G)break;var i=0,g=new t(i),K=M(p,0,z,g);i=g.bits;for(var W=0;W<8;W++){var ie=m.scalefac_band.l[U+W+2];if(ie>=G)break;var he=i;g=new t(he);var ue=M(p,z,ie,g);he=g.bits,u[U+W]>he&&(u[U+W]=he,v[U+W]=U,_[U+W]=K,I[U+W]=ue)}}}function o(m,f,p,u,v,_,I,G){for(var U=f.big_values,z=2;z<T.SBMAX_l+1;z++){var i=m.scalefac_band.l[z];if(i>=U)break;var g=v[z-2]+f.count1bits;if(p.part2_3_length<=g)break;var K=new t(g),W=M(u,i,U,K);g=K.bits,!(p.part2_3_length<=g)&&(p.assign(f),p.part2_3_length=g,p.region0_count=_[z-2],p.region1_count=z-2-_[z-2],p.table_select[0]=I[z-2],p.table_select[1]=G[z-2],p.table_select[2]=W)}}this.best_huffman_divide=function(m,f){var p=new to,u=f.l3_enc,v=gr(7+15+1),_=gr(7+15+1),I=gr(7+15+1),G=gr(7+15+1);if(!(f.block_type==T.SHORT_TYPE&&m.mode_gr==1)){p.assign(f),f.block_type==T.NORM_TYPE&&(w(m,f,u,v,_,I,G),o(m,p,f,u,v,_,I,G));var U=p.big_values;if(!(U==0||(u[U-2]|u[U-1])>1)&&(U=f.count1+2,!(U>576))){p.assign(f),p.count1=U;for(var z=0,i=0;U>p.big_values;U-=4){var g=((u[U-4]*2+u[U-3])*2+u[U-2])*2+u[U-1];z+=ee.t32l[g],i+=ee.t33l[g]}if(p.big_values=U,p.count1table_select=0,z>i&&(z=i,p.count1table_select=1),p.count1bits=z,p.block_type==T.NORM_TYPE)o(m,p,f,u,v,_,I,G);else{if(p.part2_3_length=z,z=m.scalefac_band.l[7+1],z>U&&(z=U),z>0){var K=new t(p.part2_3_length);p.table_select[0]=M(u,0,z,K),p.part2_3_length=K.bits}if(U>z){var K=new t(p.part2_3_length);p.table_select[1]=M(u,z,U,K),p.part2_3_length=K.bits}f.part2_3_length>p.part2_3_length&&f.assign(p)}}}};var F=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],H=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],V=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],c=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];br.slen1_tab=V,br.slen2_tab=c;function A(m,f){for(var p,u=f.tt[1][m],v=f.tt[0][m],_=0;_<ee.scfsi_band.length-1;_++){for(p=ee.scfsi_band[_];p<ee.scfsi_band[_+1]&&!(v.scalefac[p]!=u.scalefac[p]&&u.scalefac[p]>=0);p++);if(p==ee.scfsi_band[_+1]){for(p=ee.scfsi_band[_];p<ee.scfsi_band[_+1];p++)u.scalefac[p]=-1;f.scfsi[m][_]=1}}var I=0,G=0;for(p=0;p<11;p++)u.scalefac[p]!=-1&&(G++,I<u.scalefac[p]&&(I=u.scalefac[p]));for(var U=0,z=0;p<T.SBPSY_l;p++)u.scalefac[p]!=-1&&(z++,U<u.scalefac[p]&&(U=u.scalefac[p]));for(var _=0;_<16;_++)if(I<F[_]&&U<H[_]){var i=V[_]*G+c[_]*z;u.part2_length>i&&(u.part2_length=i,u.scalefac_compress=_)}}this.best_scalefac_store=function(m,f,p,u){var v=u.tt[f][p],_,I,G,U,z=0;for(G=0,_=0;_<v.sfbmax;_++){var i=v.width[_];for(G+=i,U=-i;U<0&&v.l3_enc[U+G]==0;U++);U==0&&(v.scalefac[_]=z=-2)}if(v.scalefac_scale==0&&v.preflag==0){var g=0;for(_=0;_<v.sfbmax;_++)v.scalefac[_]>0&&(g|=v.scalefac[_]);if((g&1)==0&&g!=0){for(_=0;_<v.sfbmax;_++)v.scalefac[_]>0&&(v.scalefac[_]>>=1);v.scalefac_scale=z=1}}if(v.preflag==0&&v.block_type!=T.SHORT_TYPE&&m.mode_gr==2){for(_=11;_<T.SBPSY_l&&!(v.scalefac[_]<e.pretab[_]&&v.scalefac[_]!=-2);_++);if(_==T.SBPSY_l){for(_=11;_<T.SBPSY_l;_++)v.scalefac[_]>0&&(v.scalefac[_]-=e.pretab[_]);v.preflag=z=1}}for(I=0;I<4;I++)u.scfsi[p][I]=0;for(m.mode_gr==2&&f==1&&u.tt[0][p].block_type!=T.SHORT_TYPE&&u.tt[1][p].block_type!=T.SHORT_TYPE&&(A(p,u),z=0),_=0;_<v.sfbmax;_++)v.scalefac[_]==-2&&(v.scalefac[_]=0);z!=0&&(m.mode_gr==2?this.scale_bitcount(v):this.scale_bitcount_lsf(m,v))};function N(m,f){for(var p=0;p<f;++p)if(m[p]<0)return!1;return!0}var E=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],O=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],l=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(m){var f,p,u=0,v=0,_,I=m.scalefac;if(Ko(N(I,m.sfbmax)),m.block_type==T.SHORT_TYPE)_=E,m.mixed_block_flag!=0&&(_=O);else if(_=l,m.preflag==0){for(p=11;p<T.SBPSY_l&&!(I[p]<e.pretab[p]);p++);if(p==T.SBPSY_l)for(m.preflag=1,p=11;p<T.SBPSY_l;p++)I[p]-=e.pretab[p]}for(p=0;p<m.sfbdivide;p++)u<I[p]&&(u=I[p]);for(;p<m.sfbmax;p++)v<I[p]&&(v=I[p]);for(m.part2_length=_t.LARGE_BITS,f=0;f<16;f++)u<F[f]&&v<H[f]&&m.part2_length>_[f]&&(m.part2_length=_[f],m.scalefac_compress=f);return m.part2_length==_t.LARGE_BITS};var x=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(m,f){var p,u,v,_,I,G,U,z,i=gr(4),g=f.scalefac;for(f.preflag!=0?p=2:p=0,U=0;U<4;U++)i[U]=0;if(f.block_type==T.SHORT_TYPE){u=1;var K=e.nr_of_sfb_block[p][u];for(z=0,v=0;v<4;v++)for(_=K[v]/3,U=0;U<_;U++,z++)for(I=0;I<3;I++)g[z*3+I]>i[v]&&(i[v]=g[z*3+I])}else{u=0;var K=e.nr_of_sfb_block[p][u];for(z=0,v=0;v<4;v++)for(_=K[v],U=0;U<_;U++,z++)g[z]>i[v]&&(i[v]=g[z])}for(G=!1,v=0;v<4;v++)i[v]>x[p][v]&&(G=!0);if(!G){var W,ie,he,ue;for(f.sfb_partition_table=e.nr_of_sfb_block[p][u],v=0;v<4;v++)f.slen[v]=y[i[v]];switch(W=f.slen[0],ie=f.slen[1],he=f.slen[2],ue=f.slen[3],p){case 0:f.scalefac_compress=(W*5+ie<<4)+(he<<2)+ue;break;case 1:f.scalefac_compress=400+(W*5+ie<<2)+he;break;case 2:f.scalefac_compress=500+W*3+ie;break;default:qd.err.printf(`intensity stereo not implemented yet
`);break}}if(!G)for(Ko(f.sfb_partition_table!=null),f.part2_length=0,v=0;v<4;v++)f.part2_length+=f.slen[v]*f.sfb_partition_table[v];return G};var y=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(m){for(var f=2;f<=576;f+=2){for(var p=0,u;m.scalefac_band.l[++p]<f;);for(u=a[p][0];m.scalefac_band.l[u+1]>f;)u--;for(u<0&&(u=a[p][0]),m.bv_scf[f-2]=u,u=a[p][1];m.scalefac_band.l[u+m.bv_scf[f-2]+2]>f;)u--;u<0&&(u=a[p][1]),m.bv_scf[f-1]=u}}}var Wt=fe.System,Xd=fe.Arrays,Gd=fe.new_byte,Kd=fe.new_float_n,Zd=fe.new_int,nt=fe.assert;Vt.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=Math.abs(e)*1e-6:Math.abs(e-t)<=Math.abs(t)*1e-6},Vt.NEQ=function(e,t){return!Vt.EQ(e,t)};function Vt(){var e=this,t=32773,a=null,n=null,d=null,s=null;this.setModules=function(x,y,m,f){a=x,n=y,d=m,s=f};var k=null,C=0,L=0,b=0;this.getframebits=function(x){var y=x.internal_flags,m;y.bitrate_index!=0?m=ee.bitrate_table[x.version][y.bitrate_index]:m=x.brate;var f=0|(x.version+1)*72e3*m/x.out_samplerate+y.padding;return 8*f};function R(x){Wt.arraycopy(x.header[x.w_ptr].buf,0,k,L,x.sideinfo_len),L+=x.sideinfo_len,C+=x.sideinfo_len*8,x.w_ptr=x.w_ptr+1&Ve.MAX_HEADER_BUF-1}function h(x,y,m){for(;m>0;){var f;b==0&&(b=8,L++,nt(x.header[x.w_ptr].write_timing>=C),x.header[x.w_ptr].write_timing==C&&R(x),k[L]=0),f=Math.min(m,b),m-=f,b-=f,k[L]|=y>>m<<b,C+=f}}function M(x,y,m){for(;m>0;){var f;b==0&&(b=8,L++,k[L]=0),f=Math.min(m,b),m-=f,b-=f,k[L]|=y>>m<<b,C+=f}}function w(x,y){var m=x.internal_flags,f;if(y>=8&&(h(m,76,8),y-=8),y>=8&&(h(m,65,8),y-=8),y>=8&&(h(m,77,8),y-=8),y>=8&&(h(m,69,8),y-=8),y>=32){var p=d.getLameShortVersion();if(y>=32)for(f=0;f<p.length&&y>=8;++f)y-=8,h(m,p.charAt(f),8)}for(;y>=1;y-=1)h(m,m.ancillary_flag,1),m.ancillary_flag^=x.disable_reservoir?0:1}function o(x,y,m){for(var f=x.header[x.h_ptr].ptr;m>0;){var p=Math.min(m,8-(f&7));m-=p,x.header[x.h_ptr].buf[f>>3]|=y>>m<<8-(f&7)-p,f+=p}x.header[x.h_ptr].ptr=f}function F(x,y){x<<=8;for(var m=0;m<8;m++)x<<=1,y<<=1,((y^x)&65536)!=0&&(y^=t);return y}this.CRC_writeheader=function(x,y){var m=65535;m=F(y[2]&255,m),m=F(y[3]&255,m);for(var f=6;f<x.sideinfo_len;f++)m=F(y[f]&255,m);y[4]=byte(m>>8),y[5]=byte(m&255)};function H(x,y){var m=x.internal_flags,f,p,u;if(f=m.l3_side,m.header[m.h_ptr].ptr=0,Xd.fill(m.header[m.h_ptr].buf,0,m.sideinfo_len,0),x.out_samplerate<16e3?o(m,4094,12):o(m,4095,12),o(m,x.version,1),o(m,4-3,2),o(m,x.error_protection?0:1,1),o(m,m.bitrate_index,4),o(m,m.samplerate_index,2),o(m,m.padding,1),o(m,x.extension,1),o(m,x.mode.ordinal(),2),o(m,m.mode_ext,2),o(m,x.copyright,1),o(m,x.original,1),o(m,x.emphasis,2),x.error_protection&&o(m,0,16),x.version==1){for(nt(f.main_data_begin>=0),o(m,f.main_data_begin,9),m.channels_out==2?o(m,f.private_bits,3):o(m,f.private_bits,5),u=0;u<m.channels_out;u++){var v;for(v=0;v<4;v++)o(m,f.scfsi[u][v],1)}for(p=0;p<2;p++)for(u=0;u<m.channels_out;u++){var _=f.tt[p][u];o(m,_.part2_3_length+_.part2_length,12),o(m,_.big_values/2,9),o(m,_.global_gain,8),o(m,_.scalefac_compress,4),_.block_type!=T.NORM_TYPE?(o(m,1,1),o(m,_.block_type,2),o(m,_.mixed_block_flag,1),_.table_select[0]==14&&(_.table_select[0]=16),o(m,_.table_select[0],5),_.table_select[1]==14&&(_.table_select[1]=16),o(m,_.table_select[1],5),o(m,_.subblock_gain[0],3),o(m,_.subblock_gain[1],3),o(m,_.subblock_gain[2],3)):(o(m,0,1),_.table_select[0]==14&&(_.table_select[0]=16),o(m,_.table_select[0],5),_.table_select[1]==14&&(_.table_select[1]=16),o(m,_.table_select[1],5),_.table_select[2]==14&&(_.table_select[2]=16),o(m,_.table_select[2],5),nt(_.region0_count>=0&&_.region0_count<16),nt(_.region1_count>=0&&_.region1_count<8),o(m,_.region0_count,4),o(m,_.region1_count,3)),o(m,_.preflag,1),o(m,_.scalefac_scale,1),o(m,_.count1table_select,1)}}else for(nt(f.main_data_begin>=0),o(m,f.main_data_begin,8),o(m,f.private_bits,m.channels_out),p=0,u=0;u<m.channels_out;u++){var _=f.tt[p][u];o(m,_.part2_3_length+_.part2_length,12),o(m,_.big_values/2,9),o(m,_.global_gain,8),o(m,_.scalefac_compress,9),_.block_type!=T.NORM_TYPE?(o(m,1,1),o(m,_.block_type,2),o(m,_.mixed_block_flag,1),_.table_select[0]==14&&(_.table_select[0]=16),o(m,_.table_select[0],5),_.table_select[1]==14&&(_.table_select[1]=16),o(m,_.table_select[1],5),o(m,_.subblock_gain[0],3),o(m,_.subblock_gain[1],3),o(m,_.subblock_gain[2],3)):(o(m,0,1),_.table_select[0]==14&&(_.table_select[0]=16),o(m,_.table_select[0],5),_.table_select[1]==14&&(_.table_select[1]=16),o(m,_.table_select[1],5),_.table_select[2]==14&&(_.table_select[2]=16),o(m,_.table_select[2],5),nt(_.region0_count>=0&&_.region0_count<16),nt(_.region1_count>=0&&_.region1_count<8),o(m,_.region0_count,4),o(m,_.region1_count,3)),o(m,_.scalefac_scale,1),o(m,_.count1table_select,1)}x.error_protection&&CRC_writeheader(m,m.header[m.h_ptr].buf);{var I=m.h_ptr;nt(m.header[I].ptr==m.sideinfo_len*8),m.h_ptr=I+1&Ve.MAX_HEADER_BUF-1,m.header[m.h_ptr].write_timing=m.header[I].write_timing+y,m.h_ptr==m.w_ptr&&Wt.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function V(x,y){var m=ee.ht[y.count1table_select+32],f,p=0,u=y.big_values,v=y.big_values;for(nt(y.count1table_select<2),f=(y.count1-y.big_values)/4;f>0;--f){var _=0,I=0,G;G=y.l3_enc[u+0],G!=0&&(I+=8,y.xr[v+0]<0&&_++),G=y.l3_enc[u+1],G!=0&&(I+=4,_*=2,y.xr[v+1]<0&&_++),G=y.l3_enc[u+2],G!=0&&(I+=2,_*=2,y.xr[v+2]<0&&_++),G=y.l3_enc[u+3],G!=0&&(I++,_*=2,y.xr[v+3]<0&&_++),u+=4,v+=4,h(x,_+m.table[I],m.hlen[I]),p+=m.hlen[I]}return p}function c(x,y,m,f,p){var u=ee.ht[y],v=0;if(y==0)return v;for(var _=m;_<f;_+=2){var I=0,G=0,U=u.xlen,z=u.xlen,i=0,g=p.l3_enc[_],K=p.l3_enc[_+1];if(g!=0&&(p.xr[_]<0&&i++,I--),y>15){if(g>14){var W=g-15;nt(W<=u.linmax),i|=W<<1,G=U,g=15}if(K>14){var ie=K-15;nt(ie<=u.linmax),i<<=U,i|=ie,G+=U,K=15}z=16}K!=0&&(i<<=1,p.xr[_+1]<0&&i++,I--),g=g*z+K,G-=I,I+=u.hlen[g],h(x,u.table[g],I),h(x,i,G),v+=I+G}return v}function A(x,y){var m=3*x.scalefac_band.s[3];m>y.big_values&&(m=y.big_values);var f=c(x,y.table_select[0],0,m,y);return f+=c(x,y.table_select[1],m,y.big_values,y),f}function N(x,y){var m,f,p,u;m=y.big_values;var v=y.region0_count+1;return nt(v<x.scalefac_band.l.length),p=x.scalefac_band.l[v],v+=y.region1_count+1,nt(v<x.scalefac_band.l.length),u=x.scalefac_band.l[v],p>m&&(p=m),u>m&&(u=m),f=c(x,y.table_select[0],0,p,y),f+=c(x,y.table_select[1],p,u,y),f+=c(x,y.table_select[2],u,m,y),f}function E(x){var y,m,f,p,u=0,v=x.internal_flags,_=v.l3_side;if(x.version==1)for(y=0;y<2;y++)for(m=0;m<v.channels_out;m++){var I=_.tt[y][m],G=br.slen1_tab[I.scalefac_compress],U=br.slen2_tab[I.scalefac_compress];for(p=0,f=0;f<I.sfbdivide;f++)I.scalefac[f]!=-1&&(h(v,I.scalefac[f],G),p+=G);for(;f<I.sfbmax;f++)I.scalefac[f]!=-1&&(h(v,I.scalefac[f],U),p+=U);nt(p==I.part2_length),I.block_type==T.SHORT_TYPE?p+=A(v,I):p+=N(v,I),p+=V(v,I),nt(p==I.part2_3_length+I.part2_length),u+=p}else for(y=0,m=0;m<v.channels_out;m++){var I=_.tt[y][m],z,i,g=0;if(nt(I.sfb_partition_table!=null),p=0,f=0,i=0,I.block_type==T.SHORT_TYPE){for(;i<4;i++){var K=I.sfb_partition_table[i]/3,W=I.slen[i];for(z=0;z<K;z++,f++)h(v,Math.max(I.scalefac[f*3+0],0),W),h(v,Math.max(I.scalefac[f*3+1],0),W),h(v,Math.max(I.scalefac[f*3+2],0),W),g+=3*W}p+=A(v,I)}else{for(;i<4;i++){var K=I.sfb_partition_table[i],W=I.slen[i];for(z=0;z<K;z++,f++)h(v,Math.max(I.scalefac[f],0),W),g+=W}p+=N(v,I)}p+=V(v,I),nt(p==I.part2_3_length),nt(g==I.part2_length),u+=g+p}return u}function O(){this.total=0}function l(x,y){var m=x.internal_flags,f,p,u,v,_;return _=m.w_ptr,v=m.h_ptr-1,v==-1&&(v=Ve.MAX_HEADER_BUF-1),f=m.header[v].write_timing-C,y.total=f,f>=0&&(p=1+v-_,v<_&&(p=1+v-_+Ve.MAX_HEADER_BUF),f-=p*8*m.sideinfo_len),u=e.getframebits(x),f+=u,y.total+=u,y.total%8!=0?y.total=1+y.total/8:y.total=y.total/8,y.total+=L+1,f<0&&Wt.err.println(`strange error flushing buffer ... 
`),f}this.flush_bitstream=function(x){var y=x.internal_flags,m,f,p=y.h_ptr-1;if(p==-1&&(p=Ve.MAX_HEADER_BUF-1),m=y.l3_side,!((f=l(x,new O))<0)){if(w(x,f),nt(y.header[p].write_timing+this.getframebits(x)==C),y.ResvSize=0,m.main_data_begin=0,y.findReplayGain){var u=a.GetTitleGain(y.rgdata);nt(NEQ(u,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),y.RadioGain=Math.floor(u*10+.5)|0}y.findPeakSample&&(y.noclipGainChange=Math.ceil(Math.log10(y.PeakSample/32767)*20*10)|0,y.noclipGainChange>0&&(EQ(x.scale,1)||EQ(x.scale,0))?y.noclipScale=Math.floor(32767/y.PeakSample*100)/100:y.noclipScale=-1)}},this.add_dummy_byte=function(x,y,m){for(var f=x.internal_flags,p;m-- >0;)for(M(f,y,8),p=0;p<Ve.MAX_HEADER_BUF;++p)f.header[p].write_timing+=8},this.format_bitstream=function(x){var y=x.internal_flags,m;m=y.l3_side;var f=this.getframebits(x);w(x,m.resvDrain_pre),H(x,f);var p=8*y.sideinfo_len;if(p+=E(x),w(x,m.resvDrain_post),p+=m.resvDrain_post,m.main_data_begin+=(f-p)/8,l(x,new O)!=y.ResvSize&&Wt.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),m.main_data_begin*8!=y.ResvSize&&(Wt.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*m.main_data_begin,y.ResvSize,m.resvDrain_post,m.resvDrain_pre,8*y.sideinfo_len,p-m.resvDrain_post-8*y.sideinfo_len,p,p%8,f),Wt.err.println("This is a fatal error.  It has several possible causes:"),Wt.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),Wt.err.println(" 9%%  Your system is overclocked"),Wt.err.println(" 1%%  bug in LAME encoding library"),y.ResvSize=m.main_data_begin*8),C>1e9){var u;for(u=0;u<Ve.MAX_HEADER_BUF;++u)y.header[u].write_timing-=C;C=0}return 0},this.copy_buffer=function(x,y,m,f,p){var u=L+1;if(u<=0)return 0;if(f!=0&&u>f)return-1;if(Wt.arraycopy(k,0,y,m,u),L=-1,b=0,p!=0){var v=Zd(1);if(v[0]=x.nMusicCRC,s.updateMusicCRC(v,y,m,u),x.nMusicCRC=v[0],u>0&&(x.VBR_seek_table.nBytesWritten+=u),x.decode_on_the_fly){for(var _=Kd([2,1152]),I=u,G=-1,U;G!=0;)if(G=n.hip_decode1_unclipped(x.hip,y,m,I,_[0],_[1]),I=0,G==-1&&(G=0),G>0){if(x.findPeakSample){for(U=0;U<G;U++)_[0][U]>x.PeakSample?x.PeakSample=_[0][U]:-_[0][U]>x.PeakSample&&(x.PeakSample=-_[0][U]);if(x.channels_out>1)for(U=0;U<G;U++)_[1][U]>x.PeakSample?x.PeakSample=_[1][U]:-_[1][U]>x.PeakSample&&(x.PeakSample=-_[1][U])}if(x.findReplayGain&&a.AnalyzeSamples(x.rgdata,_[0],0,_[1],0,G,x.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return u},this.init_bit_stream_w=function(x){k=Gd(Ae.LAME_MAXMP3BUFFER),x.h_ptr=x.w_ptr=0,x.header[x.h_ptr].write_timing=0,L=-1,b=0,C=0}}var Wd=fe.System,Ke=fe.VbrMode,Zo=fe.ShortBlock,Ma=fe.new_float,ei=fe.new_int_n,Qd=fe.new_short_n,ca=fe.assert;function Ae(){var e=this,t=128*1024;Ae.V9=410,Ae.V8=420,Ae.V7=430,Ae.V6=440,Ae.V5=450,Ae.V4=460,Ae.V3=470,Ae.V2=480,Ae.V1=490,Ae.V0=500,Ae.R3MIX=1e3,Ae.STANDARD=1001,Ae.EXTREME=1002,Ae.INSANE=1003,Ae.STANDARD_FAST=1004,Ae.EXTREME_FAST=1005,Ae.MEDIUM=1006,Ae.MEDIUM_FAST=1007;var a=16384+t;Ae.LAME_MAXMP3BUFFER=a;var n,d,s,k,C,L=new Yo,b,R,h;this.enc=new T,this.setModules=function(i,g,K,W,ie,he,ue,de,Se){n=i,d=g,s=K,k=W,C=ie,b=he,R=de,h=Se,this.enc.setModules(d,L,k,b)};function M(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=Ma(T.SBMAX_l),this.bo_s_weight=Ma(T.SBMAX_s)}function w(){this.lowerlimit=0}function o(i,g){this.lowpass=g}var F=4294479419;function H(i){var g;return i.class_id=F,g=i.internal_flags=new Ve,i.mode=Ue.NOT_SET,i.original=1,i.in_samplerate=44100,i.num_channels=2,i.num_samples=-1,i.bWriteVbrTag=!0,i.quality=-1,i.short_blocks=null,g.subblock_gain=-1,i.lowpassfreq=0,i.highpassfreq=0,i.lowpasswidth=-1,i.highpasswidth=-1,i.VBR=Ke.vbr_off,i.VBR_q=4,i.ATHcurve=-1,i.VBR_mean_bitrate_kbps=128,i.VBR_min_bitrate_kbps=0,i.VBR_max_bitrate_kbps=0,i.VBR_hard_min=0,g.VBR_min_bitrate=1,g.VBR_max_bitrate=13,i.quant_comp=-1,i.quant_comp_short=-1,i.msfix=-1,g.resample_ratio=1,g.OldValue[0]=180,g.OldValue[1]=180,g.CurrentStep[0]=4,g.CurrentStep[1]=4,g.masking_lower=1,g.nsPsy.attackthre=-1,g.nsPsy.attackthre_s=-1,i.scale=-1,i.athaa_type=-1,i.ATHtype=-1,i.athaa_loudapprox=-1,i.athaa_sensitivity=0,i.useTemporal=null,i.interChRatio=-1,g.mf_samples_to_encode=T.ENCDELAY+T.POSTDELAY,i.encoder_padding=0,g.mf_size=T.ENCDELAY-T.MDCTDELAY,i.findReplayGain=!1,i.decode_on_the_fly=!1,g.decode_on_the_fly=!1,g.findReplayGain=!1,g.findPeakSample=!1,g.RadioGain=0,g.AudiophileGain=0,g.noclipGainChange=0,g.noclipScale=-1,i.preset=0,i.write_id3tag_automatic=!0,0}this.lame_init=function(){var i=new Bd;return H(i),i.lame_allocated_gfp=1,i};function V(i){return i>1?0:i<=0?1:Math.cos(Math.PI/2*i)}this.nearestBitrateFullIndex=function(i){var g=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],K=0,W=0,ie=0,he=0;he=g[16],ie=16,W=g[16],K=16;for(var ue=0;ue<16;ue++)if(Math.max(i,g[ue+1])!=i){he=g[ue+1],ie=ue+1,W=g[ue],K=ue;break}return he-i>i-W?K:ie};function c(i,g){var K=44100;return g>=48e3?K=48e3:g>=44100?K=44100:g>=32e3?K=32e3:g>=24e3?K=24e3:g>=22050?K=22050:g>=16e3?K=16e3:g>=12e3?K=12e3:g>=11025?K=11025:g>=8e3&&(K=8e3),i==-1?K:(i<=15960&&(K=44100),i<=15250&&(K=32e3),i<=11220&&(K=24e3),i<=9970&&(K=22050),i<=7230&&(K=16e3),i<=5420&&(K=12e3),i<=4510&&(K=11025),i<=3970&&(K=8e3),g<K?g>44100?48e3:g>32e3?44100:g>24e3?32e3:g>22050?24e3:g>16e3?22050:g>12e3?16e3:g>11025?12e3:g>8e3?11025:8e3:K)}function A(i,g){switch(i){case 44100:return g.version=1,0;case 48e3:return g.version=1,1;case 32e3:return g.version=1,2;case 22050:return g.version=0,0;case 24e3:return g.version=0,1;case 16e3:return g.version=0,2;case 11025:return g.version=0,0;case 12e3:return g.version=0,1;case 8e3:return g.version=0,2;default:return g.version=0,-1}}function N(i,g,K){K<16e3&&(g=2);for(var W=ee.bitrate_table[g][1],ie=2;ie<=14;ie++)ee.bitrate_table[g][ie]>0&&Math.abs(ee.bitrate_table[g][ie]-i)<Math.abs(W-i)&&(W=ee.bitrate_table[g][ie]);return W}function E(i,g,K){K<16e3&&(g=2);for(var W=0;W<=14;W++)if(ee.bitrate_table[g][W]>0&&ee.bitrate_table[g][W]==i)return W;return-1}function O(i,g){var K=[new o(8,2e3),new o(16,3700),new o(24,3900),new o(32,5500),new o(40,7e3),new o(48,7500),new o(56,1e4),new o(64,11e3),new o(80,13500),new o(96,15100),new o(112,15600),new o(128,17e3),new o(160,17500),new o(192,18600),new o(224,19400),new o(256,19700),new o(320,20500)],W=e.nearestBitrateFullIndex(g);i.lowerlimit=K[W].lowpass}function l(i){var g=i.internal_flags,K=32,W=-1;if(g.lowpass1>0){for(var ie=999,he=0;he<=31;he++){var ue=he/31;ue>=g.lowpass2&&(K=Math.min(K,he)),g.lowpass1<ue&&ue<g.lowpass2&&(ie=Math.min(ie,he))}ie==999?g.lowpass1=(K-.75)/31:g.lowpass1=(ie-.75)/31,g.lowpass2=K/31}if(g.highpass2>0&&g.highpass2<.9*(.75/31)&&(g.highpass1=0,g.highpass2=0,Wd.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),g.highpass2>0){for(var de=-1,he=0;he<=31;he++){var ue=he/31;ue<=g.highpass1&&(W=Math.max(W,he)),g.highpass1<ue&&ue<g.highpass2&&(de=Math.max(de,he))}g.highpass1=W/31,de==-1?g.highpass2=(W+.75)/31:g.highpass2=(de+.75)/31}for(var he=0;he<32;he++){var Se,ve,ue=he/31;g.highpass2>g.highpass1?Se=V((g.highpass2-ue)/(g.highpass2-g.highpass1+1e-20)):Se=1,g.lowpass2>g.lowpass1?ve=V((ue-g.lowpass1)/(g.lowpass2-g.lowpass1+1e-20)):ve=1,g.amp_filter[he]=Se*ve}}function x(i){var g=i.internal_flags;switch(i.quality){default:case 9:g.psymodel=0,g.noise_shaping=0,g.noise_shaping_amp=0,g.noise_shaping_stop=0,g.use_best_huffman=0,g.full_outer_loop=0;break;case 8:i.quality=7;case 7:g.psymodel=1,g.noise_shaping=0,g.noise_shaping_amp=0,g.noise_shaping_stop=0,g.use_best_huffman=0,g.full_outer_loop=0;break;case 6:g.psymodel=1,g.noise_shaping==0&&(g.noise_shaping=1),g.noise_shaping_amp=0,g.noise_shaping_stop=0,g.subblock_gain==-1&&(g.subblock_gain=1),g.use_best_huffman=0,g.full_outer_loop=0;break;case 5:g.psymodel=1,g.noise_shaping==0&&(g.noise_shaping=1),g.noise_shaping_amp=0,g.noise_shaping_stop=0,g.subblock_gain==-1&&(g.subblock_gain=1),g.use_best_huffman=0,g.full_outer_loop=0;break;case 4:g.psymodel=1,g.noise_shaping==0&&(g.noise_shaping=1),g.noise_shaping_amp=0,g.noise_shaping_stop=0,g.subblock_gain==-1&&(g.subblock_gain=1),g.use_best_huffman=1,g.full_outer_loop=0;break;case 3:g.psymodel=1,g.noise_shaping==0&&(g.noise_shaping=1),g.noise_shaping_amp=1,g.noise_shaping_stop=1,g.subblock_gain==-1&&(g.subblock_gain=1),g.use_best_huffman=1,g.full_outer_loop=0;break;case 2:g.psymodel=1,g.noise_shaping==0&&(g.noise_shaping=1),g.substep_shaping==0&&(g.substep_shaping=2),g.noise_shaping_amp=1,g.noise_shaping_stop=1,g.subblock_gain==-1&&(g.subblock_gain=1),g.use_best_huffman=1,g.full_outer_loop=0;break;case 1:g.psymodel=1,g.noise_shaping==0&&(g.noise_shaping=1),g.substep_shaping==0&&(g.substep_shaping=2),g.noise_shaping_amp=2,g.noise_shaping_stop=1,g.subblock_gain==-1&&(g.subblock_gain=1),g.use_best_huffman=1,g.full_outer_loop=0;break;case 0:g.psymodel=1,g.noise_shaping==0&&(g.noise_shaping=1),g.substep_shaping==0&&(g.substep_shaping=2),g.noise_shaping_amp=2,g.noise_shaping_stop=1,g.subblock_gain==-1&&(g.subblock_gain=1),g.use_best_huffman=1,g.full_outer_loop=0;break}}function y(i){var g=i.internal_flags;i.frameNum=0,i.write_id3tag_automatic&&R.id3tag_write_v2(i),g.bitrate_stereoMode_Hist=ei([16,4+1]),g.bitrate_blockType_Hist=ei([16,4+1+1]),g.PeakSample=0,i.bWriteVbrTag&&b.InitVbrTag(i)}this.lame_init_params=function(i){var g=i.internal_flags;if(g.Class_ID=0,g.ATH==null&&(g.ATH=new Pd),g.PSY==null&&(g.PSY=new M),g.rgdata==null&&(g.rgdata=new Fd),g.channels_in=i.num_channels,g.channels_in==1&&(i.mode=Ue.MONO),g.channels_out=i.mode==Ue.MONO?1:2,g.mode_ext=T.MPG_MD_MS_LR,i.mode==Ue.MONO&&(i.force_ms=!1),i.VBR==Ke.vbr_off&&i.VBR_mean_bitrate_kbps!=128&&i.brate==0&&(i.brate=i.VBR_mean_bitrate_kbps),i.VBR==Ke.vbr_off||i.VBR==Ke.vbr_mtrh||i.VBR==Ke.vbr_mt||(i.free_format=!1),i.VBR==Ke.vbr_off&&i.brate==0&&Vt.EQ(i.compression_ratio,0)&&(i.compression_ratio=11.025),i.VBR==Ke.vbr_off&&i.compression_ratio>0&&(i.out_samplerate==0&&(i.out_samplerate=map2MP3Frequency(int(.97*i.in_samplerate))),i.brate=0|i.out_samplerate*16*g.channels_out/(1e3*i.compression_ratio),g.samplerate_index=A(i.out_samplerate,i),i.free_format||(i.brate=N(i.brate,i.version,i.out_samplerate))),i.out_samplerate!=0&&(i.out_samplerate<16e3?(i.VBR_mean_bitrate_kbps=Math.max(i.VBR_mean_bitrate_kbps,8),i.VBR_mean_bitrate_kbps=Math.min(i.VBR_mean_bitrate_kbps,64)):i.out_samplerate<32e3?(i.VBR_mean_bitrate_kbps=Math.max(i.VBR_mean_bitrate_kbps,8),i.VBR_mean_bitrate_kbps=Math.min(i.VBR_mean_bitrate_kbps,160)):(i.VBR_mean_bitrate_kbps=Math.max(i.VBR_mean_bitrate_kbps,32),i.VBR_mean_bitrate_kbps=Math.min(i.VBR_mean_bitrate_kbps,320))),i.lowpassfreq==0){var K=16e3;switch(i.VBR){case Ke.vbr_off:{var W=new w;O(W,i.brate),K=W.lowerlimit;break}case Ke.vbr_abr:{var W=new w;O(W,i.VBR_mean_bitrate_kbps),K=W.lowerlimit;break}case Ke.vbr_rh:{var ie=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(i.VBR_q>=0&&i.VBR_q<=9){var he=ie[i.VBR_q],ue=ie[i.VBR_q+1],de=i.VBR_q_frac;K=linear_int(he,ue,de)}else K=19500;break}default:{var ie=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(i.VBR_q>=0&&i.VBR_q<=9){var he=ie[i.VBR_q],ue=ie[i.VBR_q+1],de=i.VBR_q_frac;K=linear_int(he,ue,de)}else K=19500}}i.mode==Ue.MONO&&(i.VBR==Ke.vbr_off||i.VBR==Ke.vbr_abr)&&(K*=1.5),i.lowpassfreq=K|0}if(i.out_samplerate==0&&(2*i.lowpassfreq>i.in_samplerate&&(i.lowpassfreq=i.in_samplerate/2),i.out_samplerate=c(i.lowpassfreq|0,i.in_samplerate)),i.lowpassfreq=Math.min(20500,i.lowpassfreq),i.lowpassfreq=Math.min(i.out_samplerate/2,i.lowpassfreq),i.VBR==Ke.vbr_off&&(i.compression_ratio=i.out_samplerate*16*g.channels_out/(1e3*i.brate)),i.VBR==Ke.vbr_abr&&(i.compression_ratio=i.out_samplerate*16*g.channels_out/(1e3*i.VBR_mean_bitrate_kbps)),i.bWriteVbrTag||(i.findReplayGain=!1,i.decode_on_the_fly=!1,g.findPeakSample=!1),g.findReplayGain=i.findReplayGain,g.decode_on_the_fly=i.decode_on_the_fly,g.decode_on_the_fly&&(g.findPeakSample=!0),g.findReplayGain&&n.InitGainAnalysis(g.rgdata,i.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return i.internal_flags=null,-6;switch(g.decode_on_the_fly&&!i.decode_only&&(g.hip!=null&&h.hip_decode_exit(g.hip),g.hip=h.hip_decode_init()),g.mode_gr=i.out_samplerate<=24e3?1:2,i.framesize=576*g.mode_gr,i.encoder_delay=T.ENCDELAY,g.resample_ratio=i.in_samplerate/i.out_samplerate,i.VBR){case Ke.vbr_mt:case Ke.vbr_rh:case Ke.vbr_mtrh:{var Se=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];i.compression_ratio=Se[i.VBR_q]}break;case Ke.vbr_abr:i.compression_ratio=i.out_samplerate*16*g.channels_out/(1e3*i.VBR_mean_bitrate_kbps);break;default:i.compression_ratio=i.out_samplerate*16*g.channels_out/(1e3*i.brate);break}if(i.mode==Ue.NOT_SET&&(i.mode=Ue.JOINT_STEREO),i.highpassfreq>0?(g.highpass1=2*i.highpassfreq,i.highpasswidth>=0?g.highpass2=2*(i.highpassfreq+i.highpasswidth):g.highpass2=(1+0)*2*i.highpassfreq,g.highpass1/=i.out_samplerate,g.highpass2/=i.out_samplerate):(g.highpass1=0,g.highpass2=0),i.lowpassfreq>0?(g.lowpass2=2*i.lowpassfreq,i.lowpasswidth>=0?(g.lowpass1=2*(i.lowpassfreq-i.lowpasswidth),g.lowpass1<0&&(g.lowpass1=0)):g.lowpass1=(1-0)*2*i.lowpassfreq,g.lowpass1/=i.out_samplerate,g.lowpass2/=i.out_samplerate):(g.lowpass1=0,g.lowpass2=0),l(i),g.samplerate_index=A(i.out_samplerate,i),g.samplerate_index<0)return i.internal_flags=null,-1;if(i.VBR==Ke.vbr_off){if(i.free_format)g.bitrate_index=0;else if(i.brate=N(i.brate,i.version,i.out_samplerate),g.bitrate_index=E(i.brate,i.version,i.out_samplerate),g.bitrate_index<=0)return i.internal_flags=null,-1}else g.bitrate_index=1;i.analysis&&(i.bWriteVbrTag=!1),g.pinfo!=null&&(i.bWriteVbrTag=!1),d.init_bit_stream_w(g);for(var ve=g.samplerate_index+3*i.version+6*(i.out_samplerate<16e3?1:0),ce=0;ce<T.SBMAX_l+1;ce++)g.scalefac_band.l[ce]=k.sfBandIndex[ve].l[ce];for(var ce=0;ce<T.PSFB21+1;ce++){var Re=(g.scalefac_band.l[22]-g.scalefac_band.l[21])/T.PSFB21,He=g.scalefac_band.l[21]+ce*Re;g.scalefac_band.psfb21[ce]=He}g.scalefac_band.psfb21[T.PSFB21]=576;for(var ce=0;ce<T.SBMAX_s+1;ce++)g.scalefac_band.s[ce]=k.sfBandIndex[ve].s[ce];for(var ce=0;ce<T.PSFB12+1;ce++){var Re=(g.scalefac_band.s[13]-g.scalefac_band.s[12])/T.PSFB12,He=g.scalefac_band.s[12]+ce*Re;g.scalefac_band.psfb12[ce]=He}g.scalefac_band.psfb12[T.PSFB12]=192,i.version==1?g.sideinfo_len=g.channels_out==1?4+17:4+32:g.sideinfo_len=g.channels_out==1?4+9:4+17,i.error_protection&&(g.sideinfo_len+=2),y(i),g.Class_ID=F;{var Oe;for(Oe=0;Oe<19;Oe++)g.nsPsy.pefirbuf[Oe]=700*g.mode_gr*g.channels_out;i.ATHtype==-1&&(i.ATHtype=4)}switch(ca(i.VBR_q<=9),ca(i.VBR_q>=0),i.VBR){case Ke.vbr_mt:i.VBR=Ke.vbr_mtrh;case Ke.vbr_mtrh:{i.useTemporal==null&&(i.useTemporal=!1),s.apply_preset(i,500-i.VBR_q*10,0),i.quality<0&&(i.quality=LAME_DEFAULT_QUALITY),i.quality<5&&(i.quality=0),i.quality>5&&(i.quality=5),g.PSY.mask_adjust=i.maskingadjust,g.PSY.mask_adjust_short=i.maskingadjust_short,i.experimentalY?g.sfb21_extra=!1:g.sfb21_extra=i.out_samplerate>44e3,g.iteration_loop=new VBRNewIterationLoop(C);break}case Ke.vbr_rh:{s.apply_preset(i,500-i.VBR_q*10,0),g.PSY.mask_adjust=i.maskingadjust,g.PSY.mask_adjust_short=i.maskingadjust_short,i.experimentalY?g.sfb21_extra=!1:g.sfb21_extra=i.out_samplerate>44e3,i.quality>6&&(i.quality=6),i.quality<0&&(i.quality=LAME_DEFAULT_QUALITY),g.iteration_loop=new VBROldIterationLoop(C);break}default:{var De;g.sfb21_extra=!1,i.quality<0&&(i.quality=LAME_DEFAULT_QUALITY),De=i.VBR,De==Ke.vbr_off&&(i.VBR_mean_bitrate_kbps=i.brate),s.apply_preset(i,i.VBR_mean_bitrate_kbps,0),i.VBR=De,g.PSY.mask_adjust=i.maskingadjust,g.PSY.mask_adjust_short=i.maskingadjust_short,De==Ke.vbr_off?g.iteration_loop=new Dd(C):g.iteration_loop=new ABRIterationLoop(C);break}}if(ca(i.scale>=0),i.VBR!=Ke.vbr_off){if(g.VBR_min_bitrate=1,g.VBR_max_bitrate=14,i.out_samplerate<16e3&&(g.VBR_max_bitrate=8),i.VBR_min_bitrate_kbps!=0&&(i.VBR_min_bitrate_kbps=N(i.VBR_min_bitrate_kbps,i.version,i.out_samplerate),g.VBR_min_bitrate=E(i.VBR_min_bitrate_kbps,i.version,i.out_samplerate),g.VBR_min_bitrate<0)||i.VBR_max_bitrate_kbps!=0&&(i.VBR_max_bitrate_kbps=N(i.VBR_max_bitrate_kbps,i.version,i.out_samplerate),g.VBR_max_bitrate=E(i.VBR_max_bitrate_kbps,i.version,i.out_samplerate),g.VBR_max_bitrate<0))return-1;i.VBR_min_bitrate_kbps=ee.bitrate_table[i.version][g.VBR_min_bitrate],i.VBR_max_bitrate_kbps=ee.bitrate_table[i.version][g.VBR_max_bitrate],i.VBR_mean_bitrate_kbps=Math.min(ee.bitrate_table[i.version][g.VBR_max_bitrate],i.VBR_mean_bitrate_kbps),i.VBR_mean_bitrate_kbps=Math.max(ee.bitrate_table[i.version][g.VBR_min_bitrate],i.VBR_mean_bitrate_kbps)}return i.tune&&(g.PSY.mask_adjust+=i.tune_value_a,g.PSY.mask_adjust_short+=i.tune_value_a),x(i),ca(i.scale>=0),i.athaa_type<0?g.ATH.useAdjust=3:g.ATH.useAdjust=i.athaa_type,g.ATH.aaSensitivityP=Math.pow(10,i.athaa_sensitivity/-10),i.short_blocks==null&&(i.short_blocks=Zo.short_block_allowed),i.short_blocks==Zo.short_block_allowed&&(i.mode==Ue.JOINT_STEREO||i.mode==Ue.STEREO)&&(i.short_blocks=Zo.short_block_coupled),i.quant_comp<0&&(i.quant_comp=1),i.quant_comp_short<0&&(i.quant_comp_short=0),i.msfix<0&&(i.msfix=0),i.exp_nspsytune=i.exp_nspsytune|1,i.internal_flags.nsPsy.attackthre<0&&(i.internal_flags.nsPsy.attackthre=Yo.NSATTACKTHRE),i.internal_flags.nsPsy.attackthre_s<0&&(i.internal_flags.nsPsy.attackthre_s=Yo.NSATTACKTHRE_S),ca(i.scale>=0),i.scale<0&&(i.scale=1),i.ATHtype<0&&(i.ATHtype=4),i.ATHcurve<0&&(i.ATHcurve=4),i.athaa_loudapprox<0&&(i.athaa_loudapprox=2),i.interChRatio<0&&(i.interChRatio=0),i.useTemporal==null&&(i.useTemporal=!0),g.slot_lag=g.frac_SpF=0,i.VBR==Ke.vbr_off&&(g.slot_lag=g.frac_SpF=(i.version+1)*72e3*i.brate%i.out_samplerate|0),k.iteration_init(i),L.psymodel_init(i),ca(i.scale>=0),0};function m(i,g){(i.in_buffer_0==null||i.in_buffer_nsamples<g)&&(i.in_buffer_0=Ma(g),i.in_buffer_1=Ma(g),i.in_buffer_nsamples=g)}this.lame_encode_flush=function(i,g,K,W){var ie=i.internal_flags,he=Qd([2,1152]),ue=0,de,Se,ve,ce,Re=ie.mf_samples_to_encode-T.POSTDELAY,He=f(i);if(ie.mf_samples_to_encode<1)return 0;for(de=0,i.in_samplerate!=i.out_samplerate&&(Re+=16*i.out_samplerate/i.in_samplerate),ve=i.framesize-Re%i.framesize,ve<576&&(ve+=i.framesize),i.encoder_padding=ve,ce=(Re+ve)/i.framesize;ce>0&&ue>=0;){var Oe=He-ie.mf_size,De=i.frameNum;Oe*=i.in_samplerate,Oe/=i.out_samplerate,Oe>1152&&(Oe=1152),Oe<1&&(Oe=1),Se=W-de,W==0&&(Se=0),ue=this.lame_encode_buffer(i,he[0],he[1],Oe,g,K,Se),K+=ue,de+=ue,ce-=De!=i.frameNum?1:0}if(ie.mf_samples_to_encode=0,ue<0||(Se=W-de,W==0&&(Se=0),d.flush_bitstream(i),ue=d.copy_buffer(ie,g,K,Se,1),ue<0))return ue;if(K+=ue,de+=ue,Se=W-de,W==0&&(Se=0),i.write_id3tag_automatic){if(R.id3tag_write_v1(i),ue=d.copy_buffer(ie,g,K,Se,0),ue<0)return ue;de+=ue}return de},this.lame_encode_buffer=function(i,g,K,W,ie,he,ue){var de=i.internal_flags,Se=[null,null];if(de.Class_ID!=F)return-3;if(W==0)return 0;m(de,W),Se[0]=de.in_buffer_0,Se[1]=de.in_buffer_1;for(var ve=0;ve<W;ve++)Se[0][ve]=g[ve],de.channels_in>1&&(Se[1][ve]=K[ve]);return p(i,Se[0],Se[1],W,ie,he,ue)};function f(i){var g=T.BLKSIZE+i.framesize-T.FFTOFFSET;return g=Math.max(g,512+i.framesize-32),g}function p(i,g,K,W,ie,he,ue){var de=i.internal_flags,Se=0,ve,ce,Re,He,Oe,De=[null,null],Pe=[null,null];if(de.Class_ID!=F)return-3;if(W==0)return 0;if(Oe=d.copy_buffer(de,ie,he,ue,0),Oe<0)return Oe;if(he+=Oe,Se+=Oe,Pe[0]=g,Pe[1]=K,Vt.NEQ(i.scale,0)&&Vt.NEQ(i.scale,1))for(ce=0;ce<W;++ce)Pe[0][ce]*=i.scale,de.channels_out==2&&(Pe[1][ce]*=i.scale);if(Vt.NEQ(i.scale_left,0)&&Vt.NEQ(i.scale_left,1))for(ce=0;ce<W;++ce)Pe[0][ce]*=i.scale_left;if(Vt.NEQ(i.scale_right,0)&&Vt.NEQ(i.scale_right,1))for(ce=0;ce<W;++ce)Pe[1][ce]*=i.scale_right;if(i.num_channels==2&&de.channels_out==1)for(ce=0;ce<W;++ce)Pe[0][ce]=.5*(Pe[0][ce]+Pe[1][ce]),Pe[1][ce]=0;He=f(i),De[0]=de.mfbuf[0],De[1]=de.mfbuf[1];for(var Fe=0;W>0;){var Ze=[null,null],pt=0,lt=0;Ze[0]=Pe[0],Ze[1]=Pe[1];var rt=new v;if(z(i,De,Ze,Fe,W,rt),pt=rt.n_in,lt=rt.n_out,de.findReplayGain&&!de.decode_on_the_fly&&n.AnalyzeSamples(de.rgdata,De[0],de.mf_size,De[1],de.mf_size,lt,de.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(W-=pt,Fe+=pt,de.channels_out==2,de.mf_size+=lt,ca(de.mf_size<=Ve.MFSIZE),de.mf_samples_to_encode<1&&(de.mf_samples_to_encode=T.ENCDELAY+T.POSTDELAY),de.mf_samples_to_encode+=lt,de.mf_size>=He){var vt=ue-Se;if(ue==0&&(vt=0),ve=u(i,De[0],De[1],ie,he,vt),ve<0)return ve;for(he+=ve,Se+=ve,de.mf_size-=i.framesize,de.mf_samples_to_encode-=i.framesize,Re=0;Re<de.channels_out;Re++)for(ce=0;ce<de.mf_size;ce++)De[Re][ce]=De[Re][ce+i.framesize]}}return Se}function u(i,g,K,W,ie,he){var ue=e.enc.lame_encode_mp3_frame(i,g,K,W,ie,he);return i.frameNum++,ue}function v(){this.n_in=0,this.n_out=0}function _(){this.num_used=0}function I(i,g){return g!=0?I(g,i%g):i}function G(i,g,K){var W=Math.PI*g;i/=K,i<0&&(i=0),i>1&&(i=1);var ie=i-.5,he=.42-.5*Math.cos(2*i*Math.PI)+.08*Math.cos(4*i*Math.PI);return Math.abs(ie)<1e-9?W/Math.PI:he*Math.sin(K*W*ie)/(Math.PI*K*ie)}function U(i,g,K,W,ie,he,ue,de,Se){var ve=i.internal_flags,ce,Re=0,He,Oe=i.out_samplerate/I(i.out_samplerate,i.in_samplerate);Oe>Ve.BPC&&(Oe=Ve.BPC);var De=Math.abs(ve.resample_ratio-Math.floor(.5+ve.resample_ratio))<1e-4?1:0,Pe=1/ve.resample_ratio;Pe>1&&(Pe=1);var Fe=31;Fe%2==0&&--Fe,Fe+=De;var Ze=Fe+1;if(ve.fill_buffer_resample_init==0){for(ve.inbuf_old[0]=Ma(Ze),ve.inbuf_old[1]=Ma(Ze),ce=0;ce<=2*Oe;++ce)ve.blackfilt[ce]=Ma(Ze);for(ve.itime[0]=0,ve.itime[1]=0,Re=0;Re<=2*Oe;Re++){var pt=0,lt=(Re-Oe)/(2*Oe);for(ce=0;ce<=Fe;ce++)pt+=ve.blackfilt[Re][ce]=G(ce-lt,Pe,Fe);for(ce=0;ce<=Fe;ce++)ve.blackfilt[Re][ce]/=pt}ve.fill_buffer_resample_init=1}var rt=ve.inbuf_old[Se];for(He=0;He<W;He++){var vt,Et;if(vt=He*ve.resample_ratio,Re=0|Math.floor(vt-ve.itime[Se]),Fe+Re-Fe/2>=ue)break;var lt=vt-ve.itime[Se]-(Re+.5*(Fe%2));Et=0|Math.floor(lt*2*Oe+Oe+.5);var Bt=0;for(ce=0;ce<=Fe;++ce){var it=0|ce+Re-Fe/2,Ht;Ht=it<0?rt[Ze+it]:ie[he+it],Bt+=Ht*ve.blackfilt[Et][ce]}g[K+He]=Bt}if(de.num_used=Math.min(ue,Fe+Re-Fe/2),ve.itime[Se]+=de.num_used-He*ve.resample_ratio,de.num_used>=Ze)for(ce=0;ce<Ze;ce++)rt[ce]=ie[he+de.num_used+ce-Ze];else{var gt=Ze-de.num_used;for(ce=0;ce<gt;++ce)rt[ce]=rt[ce+de.num_used];for(Re=0;ce<Ze;++ce,++Re)rt[ce]=ie[he+Re];ca(Re==de.num_used)}return He}function z(i,g,K,W,ie,he){var ue=i.internal_flags;if(ue.resample_ratio<.9999||ue.resample_ratio>1.0001)for(var de=0;de<ue.channels_out;de++){var Se=new _;he.n_out=U(i,g[de],ue.mf_size,i.framesize,K[de],W,ie,Se,de),he.n_in=Se.num_used}else{he.n_out=Math.min(i.framesize,ie),he.n_in=he.n_out;for(var ve=0;ve<he.n_out;++ve)g[0][ue.mf_size+ve]=K[0][W+ve],ue.channels_out==2&&(g[1][ue.mf_size+ve]=K[1][W+ve])}}}var Qt=fe.VbrMode;function Jd(){function e(b,R,h,M,w,o,F,H,V,c,A,N,E,O,l){this.vbr_q=b,this.quant_comp=R,this.quant_comp_s=h,this.expY=M,this.st_lrm=w,this.st_s=o,this.masking_adj=F,this.masking_adj_short=H,this.ath_lower=V,this.ath_curve=c,this.ath_sensitivity=A,this.interch=N,this.safejoint=E,this.sfb21mod=O,this.msfix=l}function t(b,R,h,M,w,o,F,H,V,c,A,N,E,O){this.quant_comp=R,this.quant_comp_s=h,this.safejoint=M,this.nsmsfix=w,this.st_lrm=o,this.st_s=F,this.nsbass=H,this.scale=V,this.masking_adj=c,this.ath_lower=A,this.ath_curve=N,this.interch=E,this.sfscale=O}var a;this.setModules=function(b){a=b};var n=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],d=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function s(b,R,h){var M=b.VBR==Qt.vbr_rh?n:d,w=b.VBR_q_frac,o=M[R],F=M[R+1],H=o;o.st_lrm=o.st_lrm+w*(F.st_lrm-o.st_lrm),o.st_s=o.st_s+w*(F.st_s-o.st_s),o.masking_adj=o.masking_adj+w*(F.masking_adj-o.masking_adj),o.masking_adj_short=o.masking_adj_short+w*(F.masking_adj_short-o.masking_adj_short),o.ath_lower=o.ath_lower+w*(F.ath_lower-o.ath_lower),o.ath_curve=o.ath_curve+w*(F.ath_curve-o.ath_curve),o.ath_sensitivity=o.ath_sensitivity+w*(F.ath_sensitivity-o.ath_sensitivity),o.interch=o.interch+w*(F.interch-o.interch),o.msfix=o.msfix+w*(F.msfix-o.msfix),L(b,H.vbr_q),h!=0?b.quant_comp=H.quant_comp:Math.abs(b.quant_comp- -1)>0||(b.quant_comp=H.quant_comp),h!=0?b.quant_comp_short=H.quant_comp_s:Math.abs(b.quant_comp_short- -1)>0||(b.quant_comp_short=H.quant_comp_s),H.expY!=0&&(b.experimentalY=H.expY!=0),h!=0?b.internal_flags.nsPsy.attackthre=H.st_lrm:Math.abs(b.internal_flags.nsPsy.attackthre- -1)>0||(b.internal_flags.nsPsy.attackthre=H.st_lrm),h!=0?b.internal_flags.nsPsy.attackthre_s=H.st_s:Math.abs(b.internal_flags.nsPsy.attackthre_s- -1)>0||(b.internal_flags.nsPsy.attackthre_s=H.st_s),h!=0?b.maskingadjust=H.masking_adj:Math.abs(b.maskingadjust-0)>0||(b.maskingadjust=H.masking_adj),h!=0?b.maskingadjust_short=H.masking_adj_short:Math.abs(b.maskingadjust_short-0)>0||(b.maskingadjust_short=H.masking_adj_short),h!=0?b.ATHlower=-H.ath_lower/10:Math.abs(-b.ATHlower*10-0)>0||(b.ATHlower=-H.ath_lower/10),h!=0?b.ATHcurve=H.ath_curve:Math.abs(b.ATHcurve- -1)>0||(b.ATHcurve=H.ath_curve),h!=0?b.athaa_sensitivity=H.ath_sensitivity:Math.abs(b.athaa_sensitivity- -1)>0||(b.athaa_sensitivity=H.ath_sensitivity),H.interch>0&&(h!=0?b.interChRatio=H.interch:Math.abs(b.interChRatio- -1)>0||(b.interChRatio=H.interch)),H.safejoint>0&&(b.exp_nspsytune=b.exp_nspsytune|H.safejoint),H.sfb21mod>0&&(b.exp_nspsytune=b.exp_nspsytune|H.sfb21mod<<20),h!=0?b.msfix=H.msfix:Math.abs(b.msfix- -1)>0||(b.msfix=H.msfix),h==0&&(b.VBR_q=R,b.VBR_q_frac=w)}var k=[new t(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new t(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new t(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new t(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new t(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new t(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new t(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new t(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new t(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new t(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new t(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new t(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new t(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new t(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new t(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function C(b,R,h){var M=R,w=a.nearestBitrateFullIndex(R);if(b.VBR=Qt.vbr_abr,b.VBR_mean_bitrate_kbps=M,b.VBR_mean_bitrate_kbps=Math.min(b.VBR_mean_bitrate_kbps,320),b.VBR_mean_bitrate_kbps=Math.max(b.VBR_mean_bitrate_kbps,8),b.brate=b.VBR_mean_bitrate_kbps,b.VBR_mean_bitrate_kbps>320&&(b.disable_reservoir=!0),k[w].safejoint>0&&(b.exp_nspsytune=b.exp_nspsytune|2),k[w].sfscale>0&&(b.internal_flags.noise_shaping=2),Math.abs(k[w].nsbass)>0){var o=int(k[w].nsbass*4);o<0&&(o+=64),b.exp_nspsytune=b.exp_nspsytune|o<<2}return h!=0?b.quant_comp=k[w].quant_comp:Math.abs(b.quant_comp- -1)>0||(b.quant_comp=k[w].quant_comp),h!=0?b.quant_comp_short=k[w].quant_comp_s:Math.abs(b.quant_comp_short- -1)>0||(b.quant_comp_short=k[w].quant_comp_s),h!=0?b.msfix=k[w].nsmsfix:Math.abs(b.msfix- -1)>0||(b.msfix=k[w].nsmsfix),h!=0?b.internal_flags.nsPsy.attackthre=k[w].st_lrm:Math.abs(b.internal_flags.nsPsy.attackthre- -1)>0||(b.internal_flags.nsPsy.attackthre=k[w].st_lrm),h!=0?b.internal_flags.nsPsy.attackthre_s=k[w].st_s:Math.abs(b.internal_flags.nsPsy.attackthre_s- -1)>0||(b.internal_flags.nsPsy.attackthre_s=k[w].st_s),h!=0?b.scale=k[w].scale:Math.abs(b.scale- -1)>0||(b.scale=k[w].scale),h!=0?b.maskingadjust=k[w].masking_adj:Math.abs(b.maskingadjust-0)>0||(b.maskingadjust=k[w].masking_adj),k[w].masking_adj>0?h!=0?b.maskingadjust_short=k[w].masking_adj*.9:Math.abs(b.maskingadjust_short-0)>0||(b.maskingadjust_short=k[w].masking_adj*.9):h!=0?b.maskingadjust_short=k[w].masking_adj*1.1:Math.abs(b.maskingadjust_short-0)>0||(b.maskingadjust_short=k[w].masking_adj*1.1),h!=0?b.ATHlower=-k[w].ath_lower/10:Math.abs(-b.ATHlower*10-0)>0||(b.ATHlower=-k[w].ath_lower/10),h!=0?b.ATHcurve=k[w].ath_curve:Math.abs(b.ATHcurve- -1)>0||(b.ATHcurve=k[w].ath_curve),h!=0?b.interChRatio=k[w].interch:Math.abs(b.interChRatio- -1)>0||(b.interChRatio=k[w].interch),R}this.apply_preset=function(b,R,h){switch(R){case Ae.R3MIX:{R=Ae.V3,b.VBR=Qt.vbr_mtrh;break}case Ae.MEDIUM:{R=Ae.V4,b.VBR=Qt.vbr_rh;break}case Ae.MEDIUM_FAST:{R=Ae.V4,b.VBR=Qt.vbr_mtrh;break}case Ae.STANDARD:{R=Ae.V2,b.VBR=Qt.vbr_rh;break}case Ae.STANDARD_FAST:{R=Ae.V2,b.VBR=Qt.vbr_mtrh;break}case Ae.EXTREME:{R=Ae.V0,b.VBR=Qt.vbr_rh;break}case Ae.EXTREME_FAST:{R=Ae.V0,b.VBR=Qt.vbr_mtrh;break}case Ae.INSANE:return R=320,b.preset=R,C(b,R,h),b.VBR=Qt.vbr_off,R}switch(b.preset=R,R){case Ae.V9:return s(b,9,h),R;case Ae.V8:return s(b,8,h),R;case Ae.V7:return s(b,7,h),R;case Ae.V6:return s(b,6,h),R;case Ae.V5:return s(b,5,h),R;case Ae.V4:return s(b,4,h),R;case Ae.V3:return s(b,3,h),R;case Ae.V2:return s(b,2,h),R;case Ae.V1:return s(b,1,h),R;case Ae.V0:return s(b,0,h),R}return R>=8&&R<=320?C(b,R,h):(b.preset=0,R)};function L(b,R){var h=0;return R<0&&(h=-1,R=0),R>9&&(h=-1,R=9),b.VBR_q=R,b.VBR_q_frac=0,h}}function $d(){this.setModules=function(e,t){}}function Wo(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var ti=fe.new_float,em=fe.new_int;function tm(){this.global_gain=0,this.sfb_count1=0,this.step=em(39),this.noise=ti(39),this.noise_log=ti(39)}var da=fe.System,ai=fe.VbrMode,Qo=fe.Util,Da=fe.Arrays,yr=fe.new_float,xr=fe.assert;function am(){var e;this.rv=null;var t;this.qupvt=null;var a,n=new $d,d;this.setModules=function(V,c,A,N){e=V,t=c,this.rv=c,a=A,this.qupvt=A,d=N,n.setModules(a,d)},this.ms_convert=function(V,c){for(var A=0;A<576;++A){var N=V.tt[c][0].xr[A],E=V.tt[c][1].xr[A];V.tt[c][0].xr[A]=(N+E)*(Qo.SQRT2*.5),V.tt[c][1].xr[A]=(N-E)*(Qo.SQRT2*.5)}};function s(V,c,A,N){N=0;for(var E=0;E<=A;++E){var O=Math.abs(V.xr[E]);N+=O,c[E]=Math.sqrt(O*Math.sqrt(O)),c[E]>V.xrpow_max&&(V.xrpow_max=c[E])}return N}this.init_xrpow=function(V,c,A){var N=0,E=0|c.max_nonzero_coeff;if(c.xrpow_max=0,Da.fill(A,E,576,0),N=s(c,A,E,N),N>1e-20){var O=0;(V.substep_shaping&2)!=0&&(O=1);for(var l=0;l<c.psymax;l++)V.pseudohalf[l]=O;return!0}return Da.fill(c.l3_enc,0,576,0),!1};function k(V,c){var A=V.ATH,N=c.xr;if(c.block_type!=T.SHORT_TYPE)for(var E=!1,O=T.PSFB21-1;O>=0&&!E;O--){var l=V.scalefac_band.psfb21[O],x=V.scalefac_band.psfb21[O+1],y=a.athAdjust(A.adjust,A.psfb21[O],A.floor);V.nsPsy.longfact[21]>1e-12&&(y*=V.nsPsy.longfact[21]);for(var m=x-1;m>=l;m--)if(Math.abs(N[m])<y)N[m]=0;else{E=!0;break}}else for(var f=0;f<3;f++)for(var E=!1,O=T.PSFB12-1;O>=0&&!E;O--){var l=V.scalefac_band.s[12]*3+(V.scalefac_band.s[13]-V.scalefac_band.s[12])*f+(V.scalefac_band.psfb12[O]-V.scalefac_band.psfb12[0]),x=l+(V.scalefac_band.psfb12[O+1]-V.scalefac_band.psfb12[O]),p=a.athAdjust(A.adjust,A.psfb12[O],A.floor);V.nsPsy.shortfact[12]>1e-12&&(p*=V.nsPsy.shortfact[12]);for(var m=x-1;m>=l;m--)if(Math.abs(N[m])<p)N[m]=0;else{E=!0;break}}}this.init_outer_loop=function(V,c){c.part2_3_length=0,c.big_values=0,c.count1=0,c.global_gain=210,c.scalefac_compress=0,c.table_select[0]=0,c.table_select[1]=0,c.table_select[2]=0,c.subblock_gain[0]=0,c.subblock_gain[1]=0,c.subblock_gain[2]=0,c.subblock_gain[3]=0,c.region0_count=0,c.region1_count=0,c.preflag=0,c.scalefac_scale=0,c.count1table_select=0,c.part2_length=0,c.sfb_lmax=T.SBPSY_l,c.sfb_smin=T.SBPSY_s,c.psy_lmax=V.sfb21_extra?T.SBMAX_l:T.SBPSY_l,c.psymax=c.psy_lmax,c.sfbmax=c.sfb_lmax,c.sfbdivide=11;for(var A=0;A<T.SBMAX_l;A++)c.width[A]=V.scalefac_band.l[A+1]-V.scalefac_band.l[A],c.window[A]=3;if(c.block_type==T.SHORT_TYPE){var N=yr(576);c.sfb_smin=0,c.sfb_lmax=0,c.mixed_block_flag!=0&&(c.sfb_smin=3,c.sfb_lmax=V.mode_gr*2+4),c.psymax=c.sfb_lmax+3*((V.sfb21_extra?T.SBMAX_s:T.SBPSY_s)-c.sfb_smin),c.sfbmax=c.sfb_lmax+3*(T.SBPSY_s-c.sfb_smin),c.sfbdivide=c.sfbmax-18,c.psy_lmax=c.sfb_lmax;var E=V.scalefac_band.l[c.sfb_lmax];da.arraycopy(c.xr,0,N,0,576);for(var A=c.sfb_smin;A<T.SBMAX_s;A++)for(var O=V.scalefac_band.s[A],l=V.scalefac_band.s[A+1],x=0;x<3;x++)for(var y=O;y<l;y++)c.xr[E++]=N[3*y+x];for(var m=c.sfb_lmax,A=c.sfb_smin;A<T.SBMAX_s;A++)c.width[m]=c.width[m+1]=c.width[m+2]=V.scalefac_band.s[A+1]-V.scalefac_band.s[A],c.window[m]=0,c.window[m+1]=1,c.window[m+2]=2,m+=3}c.count1bits=0,c.sfb_partition_table=a.nr_of_sfb_block[0][0],c.slen[0]=0,c.slen[1]=0,c.slen[2]=0,c.slen[3]=0,c.max_nonzero_coeff=575,Da.fill(c.scalefac,0),k(V,c)};function C(V){this.ordinal=V}C.BINSEARCH_NONE=new C(0),C.BINSEARCH_UP=new C(1),C.BINSEARCH_DOWN=new C(2);function L(V,c,A,N,E){var O,l=V.CurrentStep[N],x=!1,y=V.OldValue[N],m=C.BINSEARCH_NONE;for(c.global_gain=y,A-=c.part2_length;;){var f;if(O=d.count_bits(V,E,c,null),l==1||O==A)break;O>A?(m==C.BINSEARCH_DOWN&&(x=!0),x&&(l/=2),m=C.BINSEARCH_UP,f=l):(m==C.BINSEARCH_UP&&(x=!0),x&&(l/=2),m=C.BINSEARCH_DOWN,f=-l),c.global_gain+=f,c.global_gain<0&&(c.global_gain=0,x=!0),c.global_gain>255&&(c.global_gain=255,x=!0)}for(xr(c.global_gain>=0),xr(c.global_gain<256);O>A&&c.global_gain<255;)c.global_gain++,O=d.count_bits(V,E,c,null);return V.CurrentStep[N]=y-c.global_gain>=4?4:2,V.OldValue[N]=c.global_gain,c.part2_3_length=O,O}this.trancate_smallspectrums=function(V,c,A,N){var E=yr(la.SFBMAX);if(!((V.substep_shaping&4)==0&&c.block_type==T.SHORT_TYPE||(V.substep_shaping&128)!=0)){a.calc_noise(c,A,E,new Wo,null);for(var l=0;l<576;l++){var O=0;c.l3_enc[l]!=0&&(O=Math.abs(c.xr[l])),N[l]=O}var l=0,x=8;c.block_type==T.SHORT_TYPE&&(x=6);do{var y,m,f,p,u=c.width[x];if(l+=u,!(E[x]>=1)&&(Da.sort(N,l-u,u),!BitStream.EQ(N[l-1],0))){y=(1-E[x])*A[x],m=0,p=0;do{var v;for(f=1;p+f<u&&!BitStream.NEQ(N[p+l-u],N[p+l+f-u]);f++);if(v=N[p+l-u]*N[p+l-u]*f,y<v){p!=0&&(m=N[p+l-u-1]);break}y-=v,p+=f}while(p<u);if(!BitStream.EQ(m,0))do Math.abs(c.xr[l-u])<=m&&(c.l3_enc[l-u]=0);while(--u>0)}}while(++x<c.psymax);c.part2_3_length=d.noquant_count_bits(V,c,null)}};function b(V){for(var c=0;c<V.sfbmax;c++)if(V.scalefac[c]+V.subblock_gain[V.window[c]]==0)return!1;return!0}function R(V){return Qo.FAST_LOG10(.368+.632*V*V*V)}function h(V,c){for(var A=1e-37,N=0;N<c.psymax;N++)A+=R(V[N]);return Math.max(1e-20,A)}function M(V,c,A,N,E){var O;switch(V){default:case 9:{c.over_count>0?(O=A.over_SSD<=c.over_SSD,A.over_SSD==c.over_SSD&&(O=A.bits<c.bits)):O=A.max_noise<0&&A.max_noise*10+A.bits<=c.max_noise*10+c.bits;break}case 0:O=A.over_count<c.over_count||A.over_count==c.over_count&&A.over_noise<c.over_noise||A.over_count==c.over_count&&BitStream.EQ(A.over_noise,c.over_noise)&&A.tot_noise<c.tot_noise;break;case 8:A.max_noise=h(E,N);case 1:O=A.max_noise<c.max_noise;break;case 2:O=A.tot_noise<c.tot_noise;break;case 3:O=A.tot_noise<c.tot_noise&&A.max_noise<c.max_noise;break;case 4:O=A.max_noise<=0&&c.max_noise>.2||A.max_noise<=0&&c.max_noise<0&&c.max_noise>A.max_noise-.2&&A.tot_noise<c.tot_noise||A.max_noise<=0&&c.max_noise>0&&c.max_noise>A.max_noise-.2&&A.tot_noise<c.tot_noise+c.over_noise||A.max_noise>0&&c.max_noise>-.05&&c.max_noise>A.max_noise-.1&&A.tot_noise+A.over_noise<c.tot_noise+c.over_noise||A.max_noise>0&&c.max_noise>-.1&&c.max_noise>A.max_noise-.15&&A.tot_noise+A.over_noise+A.over_noise<c.tot_noise+c.over_noise+c.over_noise;break;case 5:O=A.over_noise<c.over_noise||BitStream.EQ(A.over_noise,c.over_noise)&&A.tot_noise<c.tot_noise;break;case 6:O=A.over_noise<c.over_noise||BitStream.EQ(A.over_noise,c.over_noise)&&(A.max_noise<c.max_noise||BitStream.EQ(A.max_noise,c.max_noise)&&A.tot_noise<=c.tot_noise);break;case 7:O=A.over_count<c.over_count||A.over_noise<c.over_noise;break}return c.over_count==0&&(O=O&&A.bits<c.bits),O}function w(V,c,A,N,E){var O=V.internal_flags,l;c.scalefac_scale==0?l=1.2968395546510096:l=1.6817928305074292;for(var x=0,y=0;y<c.sfbmax;y++)x<A[y]&&(x=A[y]);var m=O.noise_shaping_amp;switch(m==3&&(E?m=2:m=1),m){case 2:break;case 1:x>1?x=Math.pow(x,.5):x*=.95;break;case 0:default:x>1?x=1:x*=.95;break}for(var f=0,y=0;y<c.sfbmax;y++){var p=c.width[y],u;if(f+=p,!(A[y]<x)){if((O.substep_shaping&2)!=0&&(O.pseudohalf[y]=O.pseudohalf[y]==0?1:0,O.pseudohalf[y]==0&&O.noise_shaping_amp==2))return;for(c.scalefac[y]++,u=-p;u<0;u++)N[f+u]*=l,N[f+u]>c.xrpow_max&&(c.xrpow_max=N[f+u]);if(O.noise_shaping_amp==2)return}}}function o(V,c){for(var A=1.2968395546510096,N=0,E=0;E<V.sfbmax;E++){var O=V.width[E],l=V.scalefac[E];if(V.preflag!=0&&(l+=a.pretab[E]),N+=O,(l&1)!=0){l++;for(var x=-O;x<0;x++)c[N+x]*=A,c[N+x]>V.xrpow_max&&(V.xrpow_max=c[N+x])}V.scalefac[E]=l>>1}V.preflag=0,V.scalefac_scale=1}function F(V,c,A){var N,E=c.scalefac;for(N=0;N<c.sfb_lmax;N++)if(E[N]>=16)return!0;for(var O=0;O<3;O++){var l=0,x=0;for(N=c.sfb_lmax+O;N<c.sfbdivide;N+=3)l<E[N]&&(l=E[N]);for(;N<c.sfbmax;N+=3)x<E[N]&&(x=E[N]);if(!(l<16&&x<8)){if(c.subblock_gain[O]>=7)return!0;c.subblock_gain[O]++;var y=V.scalefac_band.l[c.sfb_lmax];for(N=c.sfb_lmax+O;N<c.sfbmax;N+=3){var m,f=c.width[N],p=E[N];if(p=p-(4>>c.scalefac_scale),p>=0){E[N]=p,y+=f*3;continue}E[N]=0;{var u=210+(p<<c.scalefac_scale+1);m=a.IPOW20(u)}y+=f*(O+1);for(var v=-f;v<0;v++)A[y+v]*=m,A[y+v]>c.xrpow_max&&(c.xrpow_max=A[y+v]);y+=f*(3-O-1)}{var m=a.IPOW20(202);y+=c.width[N]*(O+1);for(var v=-c.width[N];v<0;v++)A[y+v]*=m,A[y+v]>c.xrpow_max&&(c.xrpow_max=A[y+v])}}}return!1}function H(V,c,A,N,E){var O=V.internal_flags;w(V,c,A,N,E);var l=b(c);return l?!1:(O.mode_gr==2?l=d.scale_bitcount(c):l=d.scale_bitcount_lsf(O,c),l?(O.noise_shaping>1&&(Da.fill(O.pseudohalf,0),c.scalefac_scale==0?(o(c,N),l=!1):c.block_type==T.SHORT_TYPE&&O.subblock_gain>0&&(l=F(O,c,N)||b(c))),l||(O.mode_gr==2?l=d.scale_bitcount(c):l=d.scale_bitcount_lsf(O,c)),!l):!0)}this.outer_loop=function(V,c,A,N,E,O){var l=V.internal_flags,x=new to,y=yr(576),m=yr(la.SFBMAX),f=new Wo,p,u=new tm,v=9999999,_=!1,I=!1,G=0;if(L(l,c,O,E,N),l.noise_shaping==0)return 100;a.calc_noise(c,A,m,f,u),f.bits=c.part2_3_length,x.assign(c);var U=0;for(da.arraycopy(N,0,y,0,576);!_;){do{var z=new Wo,i,g=255;if((l.substep_shaping&2)!=0?i=20:i=3,l.sfb21_extra&&(m[x.sfbmax]>1||x.block_type==T.SHORT_TYPE&&(m[x.sfbmax+1]>1||m[x.sfbmax+2]>1))||!H(V,x,m,N,I))break;x.scalefac_scale!=0&&(g=254);var K=O-x.part2_length;if(K<=0)break;for(;(x.part2_3_length=d.count_bits(l,N,x,u))>K&&x.global_gain<=g;)x.global_gain++;if(x.global_gain>g)break;if(f.over_count==0){for(;(x.part2_3_length=d.count_bits(l,N,x,u))>v&&x.global_gain<=g;)x.global_gain++;if(x.global_gain>g)break}if(a.calc_noise(x,A,m,z,u),z.bits=x.part2_3_length,c.block_type!=T.SHORT_TYPE?p=V.quant_comp:p=V.quant_comp_short,p=M(p,f,z,x,m)?1:0,p!=0)v=c.part2_3_length,f=z,c.assign(x),U=0,da.arraycopy(N,0,y,0,576);else if(l.full_outer_loop==0&&(++U>i&&f.over_count==0||l.noise_shaping_amp==3&&I&&U>30||l.noise_shaping_amp==3&&I&&x.global_gain-G>15))break}while(x.global_gain+x.scalefac_scale<255);l.noise_shaping_amp==3?I?_=!0:(x.assign(c),da.arraycopy(y,0,N,0,576),U=0,G=x.global_gain,I=!0):_=!0}return xr(c.global_gain+c.scalefac_scale<=255),V.VBR==ai.vbr_rh||V.VBR==ai.vbr_mtrh?da.arraycopy(y,0,N,0,576):(l.substep_shaping&1)!=0&&trancate_smallspectrums(l,c,A,N),f.over_count},this.iteration_finish_one=function(V,c,A){var N=V.l3_side,E=N.tt[c][A];d.best_scalefac_store(V,c,A,N),V.use_best_huffman==1&&d.best_huffman_divide(V,E),t.ResvAdjust(V,E)},this.VBR_encode_granule=function(V,c,A,N,E,O,l){var x=V.internal_flags,y=new to,m=yr(576),f=l,p=l+1,u=(l+O)/2,v,_,I=0,G=x.sfb21_extra;xr(f<=LameInternalFlags.MAX_BITS_PER_CHANNEL),Da.fill(y.l3_enc,0);do u>f-42?x.sfb21_extra=!1:x.sfb21_extra=G,_=outer_loop(V,c,A,N,E,u),_<=0?(I=1,p=c.part2_3_length,y.assign(c),da.arraycopy(N,0,m,0,576),l=p-32,v=l-O,u=(l+O)/2):(O=u+32,v=l-O,u=(l+O)/2,I!=0&&(I=2,c.assign(y),da.arraycopy(m,0,N,0,576)));while(v>12);x.sfb21_extra=G,I==2&&da.arraycopy(y.l3_enc,0,c.l3_enc,0,576),xr(c.part2_3_length<=f)},this.get_framebits=function(V,c){var A=V.internal_flags;A.bitrate_index=A.VBR_min_bitrate;var N=e.getframebits(V);A.bitrate_index=1,N=e.getframebits(V);for(var E=1;E<=A.VBR_max_bitrate;E++){A.bitrate_index=E;var O=new MeanBits(N);c[E]=t.ResvFrameBegin(V,O),N=O.bits}},this.VBR_old_prepare=function(V,c,A,N,E,O,l,x,y){var m=V.internal_flags,f,p=0,u=1,v=0;m.bitrate_index=m.VBR_max_bitrate;var _=t.ResvFrameBegin(V,new MeanBits(0))/m.mode_gr;get_framebits(V,O);for(var I=0;I<m.mode_gr;I++){var G=a.on_pe(V,c,x[I],_,I,0);m.mode_ext==T.MPG_MD_MS_LR&&(ms_convert(m.l3_side,I),a.reduce_side(x[I],A[I],_,G));for(var U=0;U<m.channels_out;++U){var z=m.l3_side.tt[I][U];z.block_type!=T.SHORT_TYPE?(p=1.28/(1+Math.exp(3.5-c[I][U]/300))-.05,f=m.PSY.mask_adjust-p):(p=2.56/(1+Math.exp(3.5-c[I][U]/300))-.14,f=m.PSY.mask_adjust_short-p),m.masking_lower=Math.pow(10,f*.1),init_outer_loop(m,z),y[I][U]=a.calc_xmin(V,N[I][U],z,E[I][U]),y[I][U]!=0&&(u=0),l[I][U]=126,v+=x[I][U]}}for(var I=0;I<m.mode_gr;I++)for(var U=0;U<m.channels_out;U++)v>O[m.VBR_max_bitrate]&&(x[I][U]*=O[m.VBR_max_bitrate],x[I][U]/=v),l[I][U]>x[I][U]&&(l[I][U]=x[I][U]);return u},this.bitpressure_strategy=function(V,c,A,N){for(var E=0;E<V.mode_gr;E++)for(var O=0;O<V.channels_out;O++){for(var l=V.l3_side.tt[E][O],x=c[E][O],y=0,m=0;m<l.psy_lmax;m++)x[y++]*=1+.029*m*m/T.SBMAX_l/T.SBMAX_l;if(l.block_type==T.SHORT_TYPE)for(var m=l.sfb_smin;m<T.SBMAX_s;m++)x[y++]*=1+.029*m*m/T.SBMAX_s/T.SBMAX_s,x[y++]*=1+.029*m*m/T.SBMAX_s/T.SBMAX_s,x[y++]*=1+.029*m*m/T.SBMAX_s/T.SBMAX_s;N[E][O]=0|Math.max(A[E][O],.9*N[E][O])}},this.VBR_new_prepare=function(V,c,A,N,E,O){var l=V.internal_flags,x=1,y=0,m=0,f;if(V.free_format){l.bitrate_index=0;var p=new MeanBits(y);f=t.ResvFrameBegin(V,p),y=p.bits,E[0]=f}else{l.bitrate_index=l.VBR_max_bitrate;var p=new MeanBits(y);t.ResvFrameBegin(V,p),y=p.bits,get_framebits(V,E),f=E[l.VBR_max_bitrate]}for(var u=0;u<l.mode_gr;u++){a.on_pe(V,c,O[u],y,u,0),l.mode_ext==T.MPG_MD_MS_LR&&ms_convert(l.l3_side,u);for(var v=0;v<l.channels_out;++v){var _=l.l3_side.tt[u][v];l.masking_lower=Math.pow(10,l.PSY.mask_adjust*.1),init_outer_loop(l,_),a.calc_xmin(V,A[u][v],_,N[u][v])!=0&&(x=0),m+=O[u][v]}}for(var u=0;u<l.mode_gr;u++)for(var v=0;v<l.channels_out;v++)m>f&&(O[u][v]*=f,O[u][v]/=m);return x},this.calc_target_bits=function(V,c,A,N,E,O){var l=V.internal_flags,x=l.l3_side,y,m,f,p,u=0;l.bitrate_index=l.VBR_max_bitrate;var v=new MeanBits(u);for(O[0]=t.ResvFrameBegin(V,v),u=v.bits,l.bitrate_index=1,u=e.getframebits(V)-l.sideinfo_len*8,E[0]=u/(l.mode_gr*l.channels_out),u=V.VBR_mean_bitrate_kbps*V.framesize*1e3,(l.substep_shaping&1)!=0&&(u*=1.09),u/=V.out_samplerate,u-=l.sideinfo_len*8,u/=l.mode_gr*l.channels_out,y=.93+.07*(11-V.compression_ratio)/(11-5.5),y<.9&&(y=.9),y>1&&(y=1),m=0;m<l.mode_gr;m++){var _=0;for(f=0;f<l.channels_out;f++){if(N[m][f]=int(y*u),c[m][f]>700){var I=int((c[m][f]-700)/1.4),G=x.tt[m][f];N[m][f]=int(y*u),G.block_type==T.SHORT_TYPE&&I<u/2&&(I=u/2),I>u*3/2?I=u*3/2:I<0&&(I=0),N[m][f]+=I}N[m][f]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(N[m][f]=LameInternalFlags.MAX_BITS_PER_CHANNEL),_+=N[m][f]}if(_>LameInternalFlags.MAX_BITS_PER_GRANULE)for(f=0;f<l.channels_out;++f)N[m][f]*=LameInternalFlags.MAX_BITS_PER_GRANULE,N[m][f]/=_}if(l.mode_ext==T.MPG_MD_MS_LR)for(m=0;m<l.mode_gr;m++)a.reduce_side(N[m],A[m],u*l.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(p=0,m=0;m<l.mode_gr;m++)for(f=0;f<l.channels_out;f++)N[m][f]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(N[m][f]=LameInternalFlags.MAX_BITS_PER_CHANNEL),p+=N[m][f];if(p>O[0])for(m=0;m<l.mode_gr;m++)for(f=0;f<l.channels_out;f++)N[m][f]*=O[0],N[m][f]/=p}}var ri=fe.assert;function rm(){var e;this.setModules=function(t){e=t},this.ResvFrameBegin=function(t,a){var n=t.internal_flags,d,s=n.l3_side,k=e.getframebits(t);a.bits=(k-n.sideinfo_len*8)/n.mode_gr;var C=8*256*n.mode_gr-8;t.brate>320?d=8*int(t.brate*1e3/(t.out_samplerate/1152)/8+.5):(d=8*1440,t.strict_ISO&&(d=8*int(32e4/(t.out_samplerate/1152)/8+.5))),n.ResvMax=d-k,n.ResvMax>C&&(n.ResvMax=C),(n.ResvMax<0||t.disable_reservoir)&&(n.ResvMax=0);var L=a.bits*n.mode_gr+Math.min(n.ResvSize,n.ResvMax);return L>d&&(L=d),ri(n.ResvMax%8==0),ri(n.ResvMax>=0),s.resvDrain_pre=0,n.pinfo!=null&&(n.pinfo.mean_bits=a.bits/2,n.pinfo.resvsize=n.ResvSize),L},this.ResvMaxBits=function(t,a,n,d){var s=t.internal_flags,k,C=s.ResvSize,L=s.ResvMax;d!=0&&(C+=a),(s.substep_shaping&1)!=0&&(L*=.9),n.bits=a,C*10>L*9?(k=C-L*9/10,n.bits+=k,s.substep_shaping|=128):(k=0,s.substep_shaping&=127,!t.disable_reservoir&&(s.substep_shaping&1)==0&&(n.bits-=.1*a));var b=C<s.ResvMax*6/10?C:s.ResvMax*6/10;return b-=k,b<0&&(b=0),b},this.ResvAdjust=function(t,a){t.ResvSize-=a.part2_3_length+a.part2_length},this.ResvFrameEnd=function(t,a){var n,d=t.l3_side;t.ResvSize+=a*t.mode_gr;var s=0;d.resvDrain_post=0,d.resvDrain_pre=0,(n=t.ResvSize%8)!=0&&(s+=n),n=t.ResvSize-s-t.ResvMax,n>0&&(s+=n);{var k=Math.min(d.main_data_begin*8,s)/8;d.resvDrain_pre+=8*k,s-=8*k,t.ResvSize-=8*k,d.main_data_begin-=k}d.resvDrain_post+=s,t.ResvSize-=s}}function om(){var e="http://www.mp3dev.org/",t=3,a=98,n=4,d=0,s=93;this.getLameVersion=function(){return t+"."+a+"."+n},this.getLameShortVersion=function(){return t+"."+a+"."+n},this.getLameVeryShortVersion=function(){return"LAME"+t+"."+a+"r"},this.getPsyVersion=function(){return d+"."+s},this.getLameUrl=function(){return e},this.getLameOsBitness=function(){return"32bits"}}var sm=fe.System,Jo=fe.VbrMode,oi=fe.ShortBlock,nm=fe.Arrays,no=fe.new_byte,im=fe.assert;wr.NUMTOCENTRIES=100,wr.MAXFRAMESIZE=2880;function wr(){var e,t,a;this.setModules=function(u,v,_){e=u,t=v,a=_};var n=1,d=2,s=4,k=8,C=wr.NUMTOCENTRIES,L=wr.MAXFRAMESIZE,b=C+4+4+4+4+4,R=b+9+1+1+8+1+1+3+1+1+2+4+2+2,h=128,M=64,w=32,o=null,F="Xing",H="Info",V=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function c(u,v){if(u.nVbrNumFrames++,u.sum+=v,u.seen++,!(u.seen<u.want)&&(u.pos<u.size&&(u.bag[u.pos]=u.sum,u.pos++,u.seen=0),u.pos==u.size)){for(var _=1;_<u.size;_+=2)u.bag[_/2]=u.bag[_];u.want*=2,u.pos/=2}}function A(u,v){if(!(u.pos<=0))for(var _=1;_<C;++_){var I=_/C,G,U,z=0|Math.floor(I*u.pos);z>u.pos-1&&(z=u.pos-1),G=u.bag[z],U=u.sum;var i=0|256*G/U;i>255&&(i=255),v[_]=255&i}}this.addVbrFrame=function(u){var v=u.internal_flags,_=Tables.bitrate_table[u.version][v.bitrate_index];im(v.VBR_seek_table.bag!=null),c(v.VBR_seek_table,_)};function N(u,v){var _=u[v+0]&255;return _<<=8,_|=u[v+1]&255,_<<=8,_|=u[v+2]&255,_<<=8,_|=u[v+3]&255,_}function E(u,v,_){u[v+0]=255&(_>>24&255),u[v+1]=255&(_>>16&255),u[v+2]=255&(_>>8&255),u[v+3]=255&(_&255)}function O(u,v,_){u[v+0]=255&(_>>8&255),u[v+1]=255&(_&255)}function l(u,v){return new String(u,v,F.length(),o).equals(F)||new String(u,v,H.length(),o).equals(H)}function x(u,v,_){return 255&(u<<v|_&~(-1<<v))}function y(u,v){var _=u.internal_flags;v[0]=x(v[0],8,255),v[1]=x(v[1],3,7),v[1]=x(v[1],1,u.out_samplerate<16e3?0:1),v[1]=x(v[1],1,u.version),v[1]=x(v[1],2,4-3),v[1]=x(v[1],1,u.error_protection?0:1),v[2]=x(v[2],4,_.bitrate_index),v[2]=x(v[2],2,_.samplerate_index),v[2]=x(v[2],1,0),v[2]=x(v[2],1,u.extension),v[3]=x(v[3],2,u.mode.ordinal()),v[3]=x(v[3],2,_.mode_ext),v[3]=x(v[3],1,u.copyright),v[3]=x(v[3],1,u.original),v[3]=x(v[3],2,u.emphasis),v[0]=255;var I=255&(v[1]&241),G;u.version==1?G=h:u.out_samplerate<16e3?G=w:G=M,u.VBR==Jo.vbr_off&&(G=u.brate);var U;u.free_format?U=0:U=255&16*e.BitrateIndex(G,u.version,u.out_samplerate),u.version==1?(v[1]=255&(I|10),I=255&(v[2]&13),v[2]=255&(U|I)):(v[1]=255&(I|2),I=255&(v[2]&13),v[2]=255&(U|I))}this.getVbrTag=function(u){var v=new VBRTagData,_=0;v.flags=0;var I=u[_+1]>>3&1,G=u[_+2]>>2&3,U=u[_+3]>>6&3,z=u[_+2]>>4&15;if(z=Tables.bitrate_table[I][z],u[_+1]>>4==14?v.samprate=Tables.samplerate_table[2][G]:v.samprate=Tables.samplerate_table[I][G],I!=0?U!=3?_+=32+4:_+=17+4:U!=3?_+=17+4:_+=9+4,!l(u,_))return null;_+=4,v.hId=I;var i=v.flags=N(u,_);if(_+=4,(i&n)!=0&&(v.frames=N(u,_),_+=4),(i&d)!=0&&(v.bytes=N(u,_),_+=4),(i&s)!=0){if(v.toc!=null)for(var g=0;g<C;g++)v.toc[g]=u[_+g];_+=C}v.vbrScale=-1,(i&k)!=0&&(v.vbrScale=N(u,_),_+=4),v.headersize=(I+1)*72e3*z/v.samprate,_+=21;var K=u[_+0]<<4;K+=u[_+1]>>4;var W=(u[_+1]&15)<<8;return W+=u[_+2]&255,(K<0||K>3e3)&&(K=-1),(W<0||W>3e3)&&(W=-1),v.encDelay=K,v.encPadding=W,v},this.InitVbrTag=function(u){var v=u.internal_flags,_;u.version==1?_=h:u.out_samplerate<16e3?_=w:_=M,u.VBR==Jo.vbr_off&&(_=u.brate);var I=(u.version+1)*72e3*_/u.out_samplerate,G=v.sideinfo_len+R;if(v.VBR_seek_table.TotalFrameSize=I,I<G||I>L){u.bWriteVbrTag=!1;return}v.VBR_seek_table.nVbrNumFrames=0,v.VBR_seek_table.nBytesWritten=0,v.VBR_seek_table.sum=0,v.VBR_seek_table.seen=0,v.VBR_seek_table.want=1,v.VBR_seek_table.pos=0,v.VBR_seek_table.bag==null&&(v.VBR_seek_table.bag=new int[400],v.VBR_seek_table.size=400);var U=no(L);y(u,U);for(var z=v.VBR_seek_table.TotalFrameSize,i=0;i<z;++i)t.add_dummy_byte(u,U[i]&255,1)};function m(u,v){var _=v^u;return v=v>>8^V[_&255],v}this.updateMusicCRC=function(u,v,_,I){for(var G=0;G<I;++G)u[0]=m(v[_+G],u[0])};function f(u,v,_,I,G){var U=u.internal_flags,z=0,i=u.encoder_delay,g=u.encoder_padding,K=100-10*u.VBR_q-u.quality,W=a.getLameVeryShortVersion(),ie,he=0,ue,de=[1,5,3,2,4,0,3],Se=0|(u.lowpassfreq/100+.5>255?255:u.lowpassfreq/100+.5),ve=0,ce=0,Re=0,He=u.internal_flags.noise_shaping,Oe=0,De=0,Pe=0,Fe=0,Ze=0,pt=(u.exp_nspsytune&1)!=0,lt=(u.exp_nspsytune&2)!=0,rt=!1,vt=!1,Et=u.internal_flags.nogap_total,Bt=u.internal_flags.nogap_current,it=u.ATHtype,Ht=0,gt;switch(u.VBR){case vbr_abr:gt=u.VBR_mean_bitrate_kbps;break;case vbr_off:gt=u.brate;break;default:gt=u.VBR_min_bitrate_kbps}switch(u.VBR.ordinal()<de.length?ie=de[u.VBR.ordinal()]:ie=0,ue=16*he+ie,U.findReplayGain&&(U.RadioGain>510&&(U.RadioGain=510),U.RadioGain<-510&&(U.RadioGain=-510),ce=8192,ce|=3072,U.RadioGain>=0?ce|=U.RadioGain:(ce|=512,ce|=-U.RadioGain)),U.findPeakSample&&(ve=Math.abs(0|U.PeakSample/32767*Math.pow(2,23)+.5)),Et!=-1&&(Bt>0&&(vt=!0),Bt<Et-1&&(rt=!0)),Ht=it+((pt?1:0)<<4)+((lt?1:0)<<5)+((rt?1:0)<<6)+((vt?1:0)<<7),K<0&&(K=0),u.mode){case MONO:Oe=0;break;case STEREO:Oe=1;break;case DUAL_CHANNEL:Oe=2;break;case JOINT_STEREO:u.force_ms?Oe=4:Oe=3;break;case NOT_SET:default:Oe=7;break}u.in_samplerate<=32e3?Pe=0:u.in_samplerate==48e3?Pe=2:u.in_samplerate>48e3?Pe=3:Pe=1,(u.short_blocks==oi.short_block_forced||u.short_blocks==oi.short_block_dispensed||u.lowpassfreq==-1&&u.highpassfreq==-1||u.scale_left<u.scale_right||u.scale_left>u.scale_right||u.disable_reservoir&&u.brate<320||u.noATH||u.ATHonly||it==0||u.in_samplerate<=32e3)&&(De=1),Fe=He+(Oe<<2)+(De<<5)+(Pe<<6),Ze=U.nMusicCRC,E(_,I+z,K),z+=4;for(var ct=0;ct<9;ct++)_[I+z+ct]=255&W.charAt(ct);z+=9,_[I+z]=255&ue,z++,_[I+z]=255&Se,z++,E(_,I+z,ve),z+=4,O(_,I+z,ce),z+=2,O(_,I+z,Re),z+=2,_[I+z]=255&Ht,z++,gt>=255?_[I+z]=255:_[I+z]=255&gt,z++,_[I+z]=255&i>>4,_[I+z+1]=255&(i<<4)+(g>>8),_[I+z+2]=255&g,z+=3,_[I+z]=255&Fe,z++,_[I+z++]=0,O(_,I+z,u.preset),z+=2,E(_,I+z,v),z+=4,O(_,I+z,Ze),z+=2;for(var le=0;le<z;le++)G=m(_[I+le],G);return O(_,I+z,G),z+=2,z}function p(u){u.seek(0);var v=no(10);u.readFully(v);var _;return new String(v,"ISO-8859-1").startsWith("ID3")?_=0:_=((v[6]&127)<<21|(v[7]&127)<<14|(v[8]&127)<<7|v[9]&127)+v.length,_}this.getLameTagFrame=function(u,v){var _=u.internal_flags;if(!u.bWriteVbrTag||_.Class_ID!=Lame.LAME_ID||_.VBR_seek_table.pos<=0)return 0;if(v.length<_.VBR_seek_table.TotalFrameSize)return _.VBR_seek_table.TotalFrameSize;nm.fill(v,0,_.VBR_seek_table.TotalFrameSize,0),y(u,v);var I=no(C);if(u.free_format)for(var G=1;G<C;++G)I[G]=255&255*G/100;else A(_.VBR_seek_table,I);var U=_.sideinfo_len;u.error_protection&&(U-=2),u.VBR==Jo.vbr_off?(v[U++]=255&H.charAt(0),v[U++]=255&H.charAt(1),v[U++]=255&H.charAt(2),v[U++]=255&H.charAt(3)):(v[U++]=255&F.charAt(0),v[U++]=255&F.charAt(1),v[U++]=255&F.charAt(2),v[U++]=255&F.charAt(3)),E(v,U,n+d+s+k),U+=4,E(v,U,_.VBR_seek_table.nVbrNumFrames),U+=4;var z=_.VBR_seek_table.nBytesWritten+_.VBR_seek_table.TotalFrameSize;E(v,U,0|z),U+=4,sm.arraycopy(I,0,v,U,I.length),U+=I.length,u.error_protection&&t.CRC_writeheader(_,v);for(var i=0,G=0;G<U;G++)i=m(v[G],i);return U+=f(u,z,v,U,i),_.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(u,v){var _=u.internal_flags;if(_.VBR_seek_table.pos<=0||(v.seek(v.length()),v.length()==0))return-1;var I=p(v);v.seek(I);var G=no(L),U=getLameTagFrame(u,G);return U>G.length?-1:(U<1||v.write(G,0,U),0)}}var si=fe.new_byte,lm=fe.assert;function cm(){this.setModules=function(e,t){}}function dm(){this.setModules=function(e,t,a){}}function mm(){}function hm(){this.setModules=function(e,t){}}function um(e,t,a){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,t=44100,a=128);var n=new Ae,d=new cm,s=new at,k=new Vt,C=new Jd,L=new _t,b=new am,R=new wr,h=new om,M=new hm,w=new rm,o=new br,F=new dm,H=new mm;n.setModules(s,k,C,L,b,R,h,M,H),k.setModules(s,H,h,R),M.setModules(k,h),C.setModules(n),b.setModules(k,w,L,o),L.setModules(o,w,n.enc.psy),w.setModules(k),o.setModules(L),R.setModules(n,k,h),d.setModules(F,H),F.setModules(h,M,C);var V=n.lame_init();V.num_channels=e,V.in_samplerate=t,V.brate=a,V.mode=Ue.STEREO,V.quality=3,V.bWriteVbrTag=!1,V.disable_reservoir=!0,V.write_id3tag_automatic=!1,n.lame_init_params(V);var c=1152,A=0|1.25*c+7200,N=si(A);this.encodeBuffer=function(E,O){e==1&&(O=E),lm(E.length==O.length),E.length>c&&(c=E.length,A=0|1.25*c+7200,N=si(A));var l=n.lame_encode_buffer(V,E,O,E.length,N,0,A);return new Int8Array(N.subarray(0,l))},this.flush=function(){var E=n.lame_encode_flush(V,N,0,A);return new Int8Array(N.subarray(0,E))}}function io(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}io("RIFF"),io("WAVE"),io("fmt "),io("data");class fm{constructor(t){this.bitRate=t.bitRate,this.sampleRate=t.sampleRate,this.dataBuffer=[],this.encoder=new um(1,this.sampleRate,this.bitRate)}encode(t){const n=this._convertBuffer(t);let d=n.length;for(let s=0;d>=0;s+=1152){const k=n.subarray(s,s+1152),C=this.encoder.encodeBuffer(k);this.dataBuffer.push(new Int8Array(C)),d-=1152}}finish(){this.dataBuffer.push(this.encoder.flush());const t=new Blob(this.dataBuffer,{type:"audio/mp3"});return this.dataBuffer=[],{id:Date.now(),blob:t,url:URL.createObjectURL(t)}}_floatTo16BitPCM(t,a){for(let n=0;n<t.length;n++){const d=Math.max(-1,Math.min(1,t[n]));a[n]=d<0?d*32768:d*32767}}_convertBuffer(t){const a=new Float32Array(t),n=new Int16Array(t.length);return this._floatTo16BitPCM(a,n),n}}class _m{constructor(t={}){this.beforeRecording=t.beforeRecording,this.pauseRecording=t.pauseRecording,this.afterRecording=t.afterRecording,this.micFailed=t.micFailed,this.encoderOptions={bitRate:t.bitRate,sampleRate:t.sampleRate},this.bufferSize=4096,this.records=[],this.isPause=!1,this.isRecording=!1,this.duration=0,this.volume=0,this._duration=0}start(){const t={video:!1,audio:{channelCount:1,echoCancellation:!1}};this.beforeRecording&&this.beforeRecording("start recording"),navigator.mediaDevices.getUserMedia(t).then(this._micCaptured.bind(this)).catch(this._micError.bind(this)),this.isPause=!1,this.isRecording=!0,this.lameEncoder||(this.lameEncoder=new fm(this.encoderOptions))}stop(){this.stream.getTracks().forEach(a=>a.stop()),this.input.disconnect(),this.processor.disconnect(),this.context.close();let t=null;t=this.lameEncoder.finish(),t.duration=this.duration,this.records.push(t),this._duration=0,this.duration=0,this.isPause=!1,this.isRecording=!1,this.afterRecording&&this.afterRecording(t)}pause(){this.stream.getTracks().forEach(t=>t.stop()),this.input.disconnect(),this.processor.disconnect(),this._duration=this.duration,this.isPause=!0,this.pauseRecording&&this.pauseRecording("pause recording")}_micCaptured(t){this.context=new(window.AudioContext||window.webkitAudioContext),this.duration=this._duration,this.input=this.context.createMediaStreamSource(t),this.processor=this.context.createScriptProcessor(this.bufferSize,1,1),this.stream=t,this.processor.onaudioprocess=a=>{const n=a.inputBuffer.getChannelData(0);let d=0;this.lameEncoder&&this.lameEncoder.encode(n);for(let s=0;s<n.length;++s)d+=n[s]*n[s];this.duration=parseFloat(this._duration)+parseFloat(this.context.currentTime.toFixed(2)),this.volume=Math.sqrt(d/n.length).toFixed(2)},this.input.connect(this.processor),this.processor.connect(this.context.destination)}_micError(t){this.micFailed&&this.micFailed(t)}}function ni(){var e=pm(),t=e.substr(0,4);return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw(n|u)|c55\/|capi|ccwa|cdm|cell|chtm|cldc|cmd|co(mp|nd)|craw|da(it|ll|ng)|dbte|dcs|devi|dica|dmob|do(c|p)o|ds(12|d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(|_)|g1 u|g560|gene|gf5|gmo|go(\.w|od)|gr(ad|un)|haie|hcit|hd(m|p|t)|hei|hi(pt|ta)|hp( i|ip)|hsc|ht(c(| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i(20|go|ma)|i230|iac( ||\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|[a-w])|libw|lynx|m1w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|mcr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|([1-8]|c))|phil|pire|pl(ay|uc)|pn2|po(ck|rt|se)|prox|psio|ptg|qaa|qc(07|12|21|32|60|[2-7]|i)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h|oo|p)|sdk\/|se(c(|0|1)|47|mc|nd|ri)|sgh|shar|sie(|m)|sk0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h|v|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl|tdg|tel(i|m)|tim|tmo|to(pl|sh)|ts(70|m|m3|m5)|tx9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas|your|zeto|zte/i.test(t)}function pm(){var e=navigator.userAgent||navigator.vendor||window.opera||null;if(!e)throw new Error("Failed to look for user agent information.");return e}const vm={name:"RoomFooter",components:{SvgIcon:mt,EmojiPickerContainer:On,RoomFiles:A1,RoomMessageReply:J1,RoomUsersTag:od,RoomEmojis:ld,RoomTemplatesText:_d},directives:{clickOutside:Vr},props:{room:{type:Object,required:!0},roomId:{type:[String,Number],required:!0},roomMessage:{type:String,default:null},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},textMessages:{type:Object,required:!0},showSendIcon:{type:Boolean,required:!0},showFiles:{type:Boolean,required:!0},showAudio:{type:Boolean,required:!0},showEmojis:{type:Boolean,required:!0},showFooter:{type:Boolean,required:!0},acceptedFiles:{type:String,required:!0},textareaActionEnabled:{type:Boolean,required:!0},textareaAutoFocus:{type:Boolean,required:!0},userTagsEnabled:{type:Boolean,required:!0},emojisSuggestionEnabled:{type:Boolean,required:!0},templatesText:{type:Array,default:null},audioBitRate:{type:Number,required:!0},audioSampleRate:{type:Number,required:!0},initReplyMessage:{type:Object,default:null},initEditMessage:{type:Object,default:null}},emits:["edit-message","send-message","update-edited-message-id","textarea-action-handler","typing-message"],data(){return{message:"",editedMessage:{},messageReply:null,cursorRangePosition:null,files:[],fileDialog:!1,selectUsersTagItem:null,selectEmojiItem:null,selectTemplatesTextItem:null,format:"mp3",activeUpOrDownEmojis:null,activeUpOrDownUsersTag:null,activeUpOrDownTemplatesText:null,emojisDB:new tn,emojiOpened:!1,keepKeyboardOpen:!1,filteredEmojis:[],filteredUsersTag:[],selectedUsersTag:[],filteredTemplatesText:[],recorder:this.initRecorder(),isRecording:!1}},computed:{isMessageEmpty(){return!this.files.length&&!this.message.trim()},isFileLoading(){return this.files.some(e=>e.loading)},recordedTime(){return new Date(this.recorder.duration*1e3).toISOString().substr(14,5)},shadowFooter(){return!!this.filteredEmojis.length||!!this.filteredUsersTag.length||!!this.filteredTemplatesText.length||!!this.files.length||!!this.messageReply}},watch:{roomId(){this.resetMessage(!0,!0),this.roomMessage&&(this.message=this.roomMessage,setTimeout(()=>this.onChangeInput()))},message(e){this.getTextareaRef().value=e},roomMessage:{immediate:!0,handler(e){e&&(this.message=this.roomMessage)}},editedMessage(e){this.$emit("update-edited-message-id",e._id)},initReplyMessage(e){this.replyMessage(e)},initEditMessage(e){this.editMessage(e)}},mounted(){const e=ni();let t=!0;this.getTextareaRef().addEventListener("keyup",a=>{a.key==="Enter"&&!a.shiftKey&&!this.fileDialog&&(e?(this.message=this.message+`
`,setTimeout(()=>this.onChangeInput())):t&&!this.filteredEmojis.length&&!this.filteredUsersTag.length&&!this.filteredTemplatesText.length&&this.sendMessage()),t=!a.isComposing,setTimeout(()=>{this.updateFooterLists()},60)}),this.getTextareaRef().addEventListener("click",()=>{e&&(this.keepKeyboardOpen=!0),this.updateFooterLists()}),this.getTextareaRef().addEventListener("blur",()=>{this.resetFooterList(),e&&setTimeout(()=>this.keepKeyboardOpen=!1)})},beforeUnmount(){this.stopRecorder()},methods:{getTextareaRef(){return this.$refs.roomTextarea},focusTextarea(e){ni()&&e||!this.getTextareaRef()||(this.getTextareaRef().focus(),this.cursorRangePosition&&setTimeout(()=>{this.getTextareaRef().setSelectionRange(this.cursorRangePosition,this.cursorRangePosition),this.cursorRangePosition=null}))},onChangeInput(){var e,t,a;(((e=this.getTextareaRef())==null?void 0:e.value)||((t=this.getTextareaRef())==null?void 0:t.value)==="")&&(this.message=(a=this.getTextareaRef())==null?void 0:a.value),this.keepKeyboardOpen=!0,this.resizeTextarea(),this.$emit("typing-message",this.message)},resizeTextarea(){const e=this.getTextareaRef();if(!e)return;const t=window.getComputedStyle(e,null).getPropertyValue("padding-top").replace("px","");e.style.height=0,e.style.height=e.scrollHeight-t*2+"px"},escapeTextarea(){this.filteredEmojis.length?this.filteredEmojis=[]:this.filteredUsersTag.length?this.filteredUsersTag=[]:this.filteredTemplatesText.length?this.filteredTemplatesText=[]:this.resetMessage()},onPasteImage(e){var a;const t=(a=e.clipboardData)==null?void 0:a.items;t&&Array.from(t).forEach(n=>{if(n.type.includes("image")){const d=n.getAsFile();this.onFileChange([d])}})},updateActiveUpOrDown(e){this.filteredEmojis.length?this.activeUpOrDownEmojis=e:this.filteredUsersTag.length?this.activeUpOrDownUsersTag=e:this.filteredTemplatesText.length&&(this.activeUpOrDownTemplatesText=e)},selectItem(){this.filteredEmojis.length?this.selectEmojiItem=!0:this.filteredUsersTag.length?this.selectUsersTagItem=!0:this.filteredTemplatesText.length&&(this.selectTemplatesTextItem=!0)},selectEmoji(e){if(this.selectEmojiItem=!1,!e)return;const{position:t,endPosition:a}=this.getCharPosition(":");this.message=this.message.substr(0,t-1)+e+this.message.substr(a,this.message.length-1),this.cursorRangePosition=t,this.focusTextarea()},selectTemplateText(e){if(this.selectTemplatesTextItem=!1,!e)return;const{position:t,endPosition:a}=this.getCharPosition("/"),n=this.message.substr(a,a).length?"":" ";this.message=this.message.substr(0,t-1)+e.text+n+this.message.substr(a,this.message.length-1),this.cursorRangePosition=t+e.text.length+n.length+1,this.focusTextarea()},addEmoji(e){this.message+=e.unicode,this.focusTextarea(!0)},launchFilePicker(){this.$refs.file.value="",this.$refs.file.click()},async onFileChange(e){this.fileDialog=!0,this.focusTextarea(),Array.from(e).forEach(async t=>{const a=URL.createObjectURL(t),n=t.name.lastIndexOf(".");this.files.push({loading:!0,name:t.name.substring(0,n),size:t.size,type:t.type,extension:t.name.substring(n+1),localUrl:a});const d=await fetch(a).then(k=>k.blob());let s=this.files.find(k=>k.localUrl===a);s&&(s.blob=d,s.loading=!1,delete s.loading)}),setTimeout(()=>this.fileDialog=!1,500)},removeFile(e){this.files.splice(e,1),this.focusTextarea()},toggleRecorder(e){if(this.isRecording=e,!this.recorder.isRecording)setTimeout(()=>this.recorder.start(),200);else try{this.recorder.stop();const t=this.recorder.records[0];this.files.push({blob:t.blob,name:`audio.${this.format}`,size:t.blob.size,duration:t.duration,type:t.blob.type,audio:!0,localUrl:URL.createObjectURL(t.blob)}),this.recorder=this.initRecorder(),this.sendMessage()}catch{setTimeout(()=>this.stopRecorder(),100)}},stopRecorder(){if(this.recorder.isRecording)try{this.recorder.stop(),this.recorder=this.initRecorder()}catch{setTimeout(()=>this.stopRecorder(),100)}},textareaActionHandler(){this.$emit("textarea-action-handler",this.message)},sendMessage(){var a;let e=this.message.trim();if(!this.files.length&&!e||this.isFileLoading)return;this.selectedUsersTag.forEach(n=>{e=e.replace(`@${n.username}`,`<usertag>${n._id}</usertag>`)});const t=this.files.length?this.files:null;this.editedMessage._id?(this.editedMessage.content!==e||((a=this.editedMessage.files)==null?void 0:a.length)||this.files.length)&&this.$emit("edit-message",{messageId:this.editedMessage._id,newContent:e,files:t,replyMessage:this.messageReply,usersTag:this.selectedUsersTag}):this.$emit("send-message",{content:e,files:t,replyMessage:this.messageReply,usersTag:this.selectedUsersTag}),this.resetMessage(!0)},editMessage(e){this.resetMessage(),this.editedMessage={...e};let t=e.content;const a=t,n="<usertag>",d="</usertag>";[...t.matchAll(new RegExp(n,"gi"))].map(k=>k.index).forEach(k=>{const C=a.substring(k+n.length,a.indexOf(d,k)),L=this.room.users.find(b=>b._id===C);t=t.replace(`${n}${C}${d}`,`@${(L==null?void 0:L.username)||"unknown"}`),this.selectUserTag(L,!0)}),this.message=t,e.files&&(this.files=[...e.files]),setTimeout(()=>this.resizeTextarea())},replyMessage(e){this.editedMessage={},this.messageReply=e,this.focusTextarea()},updateFooterLists(){this.updateFooterList("@"),this.updateFooterList(":"),this.updateFooterList("/")},updateFooterList(e){if(!this.getTextareaRef()||e===":"&&!this.emojisSuggestionEnabled||e==="@"&&(!this.userTagsEnabled||!this.room.users)||e==="/"&&!this.templatesText)return;const t=this.getTextareaRef().selectionStart;let a=t;for(;a>0&&this.message.charAt(a-1)!==e&&(this.message.charAt(a-1)!==" "||e!==":");)a--;const n=this.message.charAt(a-2),d=!n.match(/^[0-9a-zA-Z]+$/);if(this.message.charAt(a-1)===e&&(!n||n===" "||d)){const s=this.message.substring(a,t);e===":"?this.updateEmojis(s):e==="@"?this.updateShowUsersTag(s):e==="/"&&this.updateShowTemplatesText(s)}else this.resetFooterList(e)},updateShowUsersTag(e){this.filteredUsersTag=Mo(this.room.users,"username",e,!0).filter(t=>t._id!==this.currentUserId)},selectUserTag(e,t=!1){if(this.selectUsersTagItem=!1,!e)return;const{position:a,endPosition:n}=this.getCharPosition("@"),d=this.message.substr(n,n).length?"":" ";this.message=this.message.substr(0,a)+e.username+d+this.message.substr(n,this.message.length-1),this.selectedUsersTag=[...this.selectedUsersTag,{...e}],t||(this.cursorRangePosition=a+e.username.length+d.length+1),this.focusTextarea()},updateShowTemplatesText(e){this.filteredTemplatesText=Mo(this.templatesText,"tag",e,!0)},getCharPosition(e){let a=this.getTextareaRef().selectionStart;for(;a>0&&this.message.charAt(a-1)!==e;)a--;const n=this.getTextareaRef().selectionEnd;return{position:a,endPosition:n}},async updateEmojis(e){if(!e)return;const t=await this.emojisDB.getEmojiBySearchQuery(e);this.filteredEmojis=t.map(a=>a.unicode)},resetFooterList(e=null){e===":"?this.filteredEmojis=[]:e==="@"?this.filteredUsersTag=[]:e==="/"?this.filteredTemplatesText=[]:(this.filteredEmojis=[],this.filteredUsersTag=[],this.filteredTemplatesText=[])},resetMessage(e=!1,t=!1){t||this.$emit("typing-message",null),this.selectedUsersTag=[],this.resetFooterList(),this.resetTextareaSize(),this.message="",this.editedMessage={},this.messageReply=null,this.files=[],this.emojiOpened=!1,this.preventKeyboardFromClosing(),(this.textareaAutoFocus||!t)&&setTimeout(()=>this.focusTextarea(e))},resetTextareaSize(){this.getTextareaRef()&&(this.getTextareaRef().style.height="20px")},preventKeyboardFromClosing(){this.keepKeyboardOpen&&this.getTextareaRef().focus()},initRecorder(){return this.isRecording=!1,new _m({bitRate:Number(this.audioBitRate),sampleRate:Number(this.audioSampleRate),beforeRecording:null,afterRecording:null,pauseRecording:null,micFailed:this.micFailed})},micFailed(){this.isRecording=!1,this.recorder=this.initRecorder()}}},gm={key:0,class:"vac-icon-textarea-left"},bm=r.createElementVNode("div",{class:"vac-dot-audio-record"},null,-1),ym={class:"vac-dot-audio-record-time"},xm=["placeholder"],wm={class:"vac-icon-textarea"},km={key:1},Sm=["accept"];function Em(e,t,a,n,d,s){const k=r.resolveComponent("room-emojis"),C=r.resolveComponent("room-users-tag"),L=r.resolveComponent("room-templates-text"),b=r.resolveComponent("room-message-reply"),R=r.resolveComponent("room-files"),h=r.resolveComponent("svg-icon"),M=r.resolveComponent("emoji-picker-container"),w=r.resolveDirective("click-outside");return r.withDirectives((r.openBlock(),r.createElementBlock("div",{id:"room-footer",class:r.normalizeClass(["vac-room-footer",{"vac-app-box-shadow":s.shadowFooter}])},[r.createVNode(k,{"filtered-emojis":d.filteredEmojis,"select-item":d.selectEmojiItem,"active-up-or-down":d.activeUpOrDownEmojis,onSelectEmoji:t[0]||(t[0]=o=>s.selectEmoji(o)),onActivateItem:t[1]||(t[1]=o=>d.activeUpOrDownEmojis=0)},null,8,["filtered-emojis","select-item","active-up-or-down"]),r.createVNode(C,{"filtered-users-tag":d.filteredUsersTag,"select-item":d.selectUsersTagItem,"active-up-or-down":d.activeUpOrDownUsersTag,onSelectUserTag:t[2]||(t[2]=o=>s.selectUserTag(o)),onActivateItem:t[3]||(t[3]=o=>d.activeUpOrDownUsersTag=0)},null,8,["filtered-users-tag","select-item","active-up-or-down"]),r.createVNode(L,{"filtered-templates-text":d.filteredTemplatesText,"select-item":d.selectTemplatesTextItem,"active-up-or-down":d.activeUpOrDownTemplatesText,onSelectTemplateText:t[4]||(t[4]=o=>s.selectTemplateText(o)),onActivateItem:t[5]||(t[5]=o=>d.activeUpOrDownTemplatesText=0)},null,8,["filtered-templates-text","select-item","active-up-or-down"]),r.createVNode(b,{room:a.room,"message-reply":d.messageReply,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onResetMessage:s.resetMessage},r.createSlots({_:2},[r.renderList(e.$slots,(o,F)=>({name:F,fn:r.withCtx(H=>[r.renderSlot(e.$slots,F,r.normalizeProps(r.guardReactiveProps(H)))])}))]),1032,["room","message-reply","text-formatting","link-options","onResetMessage"]),r.createVNode(R,{files:d.files,onRemoveFile:s.removeFile,onResetMessage:s.resetMessage},r.createSlots({_:2},[r.renderList(e.$slots,(o,F)=>({name:F,fn:r.withCtx(H=>[r.renderSlot(e.$slots,F,r.normalizeProps(r.guardReactiveProps(H)))])}))]),1032,["files","onRemoveFile","onResetMessage"]),r.createElementVNode("div",{class:r.normalizeClass(["vac-box-footer",{"vac-box-footer-border":!d.files.length}])},[a.showAudio&&!d.files.length?(r.openBlock(),r.createElementBlock("div",gm,[d.isRecording?(r.openBlock(),r.createElementBlock(r.Fragment,{key:0},[r.createElementVNode("div",{class:"vac-svg-button vac-icon-audio-stop",onClick:t[6]||(t[6]=(...o)=>s.stopRecorder&&s.stopRecorder(...o))},[r.renderSlot(e.$slots,"audio-stop-icon",{},()=>[r.createVNode(h,{name:"close-outline"})])]),bm,r.createElementVNode("div",ym,r.toDisplayString(s.recordedTime),1),r.createElementVNode("div",{class:"vac-svg-button vac-icon-audio-confirm",onClick:t[7]||(t[7]=o=>s.toggleRecorder(!1))},[r.renderSlot(e.$slots,"audio-stop-icon",{},()=>[r.createVNode(h,{name:"checkmark"})])])],64)):(r.openBlock(),r.createElementBlock("div",{key:1,class:"vac-svg-button",onClick:t[8]||(t[8]=o=>s.toggleRecorder(!0))},[r.renderSlot(e.$slots,"microphone-icon",{},()=>[r.createVNode(h,{name:"microphone",class:"vac-icon-microphone"})])]))])):r.createCommentVNode("",!0),r.createElementVNode("textarea",{id:"roomTextarea",ref:"roomTextarea",placeholder:a.textMessages.TYPE_MESSAGE,class:r.normalizeClass(["vac-textarea",{"vac-textarea-outline":d.editedMessage._id}]),style:{"min-height":"20px","padding-left":"12px"},onInput:t[9]||(t[9]=(...o)=>s.onChangeInput&&s.onChangeInput(...o)),onKeydown:[t[10]||(t[10]=r.withKeys((...o)=>s.escapeTextarea&&s.escapeTextarea(...o),["esc"])),t[11]||(t[11]=r.withKeys(r.withModifiers((...o)=>s.selectItem&&s.selectItem(...o),["exact","prevent"]),["enter"])),t[13]||(t[13]=r.withKeys(r.withModifiers(()=>{},["exact","prevent"]),["tab"])),t[14]||(t[14]=r.withKeys((...o)=>s.selectItem&&s.selectItem(...o),["tab"])),t[15]||(t[15]=r.withKeys(r.withModifiers(()=>{},["exact","prevent"]),["up"])),t[16]||(t[16]=r.withKeys(o=>s.updateActiveUpOrDown(-1),["up"])),t[17]||(t[17]=r.withKeys(r.withModifiers(()=>{},["exact","prevent"]),["down"])),t[18]||(t[18]=r.withKeys(o=>s.updateActiveUpOrDown(1),["down"]))],onPaste:t[12]||(t[12]=(...o)=>s.onPasteImage&&s.onPasteImage(...o))},null,42,xm),r.createElementVNode("div",wm,[d.editedMessage._id?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-svg-button",onClick:t[19]||(t[19]=(...o)=>s.resetMessage&&s.resetMessage(...o))},[r.renderSlot(e.$slots,"edit-close-icon",{},()=>[r.createVNode(h,{name:"close-outline"})])])):r.createCommentVNode("",!0),a.showEmojis?r.withDirectives((r.openBlock(),r.createElementBlock("div",km,[r.renderSlot(e.$slots,"emoji-picker",r.mergeProps({emojiOpened:d.emojiOpened},{addEmoji:s.addEmoji}),()=>[r.createVNode(M,{"emoji-opened":d.emojiOpened,"position-top":!0,onAddEmoji:s.addEmoji,onOpenEmoji:t[20]||(t[20]=o=>d.emojiOpened=o)},{"emoji-picker-icon":r.withCtx(()=>[r.renderSlot(e.$slots,"emoji-picker-icon")]),_:3},8,["emoji-opened","onAddEmoji"])])])),[[w,()=>d.emojiOpened=!1]]):r.createCommentVNode("",!0),a.showFiles?(r.openBlock(),r.createElementBlock("div",{key:2,class:"vac-svg-button",onClick:t[21]||(t[21]=(...o)=>s.launchFilePicker&&s.launchFilePicker(...o))},[r.renderSlot(e.$slots,"paperclip-icon",{},()=>[r.createVNode(h,{name:"paperclip"})])])):r.createCommentVNode("",!0),a.textareaActionEnabled?(r.openBlock(),r.createElementBlock("div",{key:3,class:"vac-svg-button",onClick:t[22]||(t[22]=(...o)=>s.textareaActionHandler&&s.textareaActionHandler(...o))},[r.renderSlot(e.$slots,"custom-action-icon",{},()=>[r.createVNode(h,{name:"deleted"})])])):r.createCommentVNode("",!0),a.showFiles?(r.openBlock(),r.createElementBlock("input",{key:4,ref:"file",type:"file",multiple:"",accept:a.acceptedFiles,style:{display:"none"},onChange:t[23]||(t[23]=o=>s.onFileChange(o.target.files))},null,40,Sm)):r.createCommentVNode("",!0),a.showSendIcon?(r.openBlock(),r.createElementBlock("div",{key:5,class:r.normalizeClass(["vac-svg-button",{"vac-send-disabled":s.isMessageEmpty}]),onClick:t[24]||(t[24]=(...o)=>s.sendMessage&&s.sendMessage(...o))},[r.renderSlot(e.$slots,"send-icon",{},()=>[r.createVNode(h,{name:"send",param:s.isMessageEmpty||s.isFileLoading?"disabled":""},null,8,["param"])])],2)):r.createCommentVNode("",!0)])],2)],2)),[[r.vShow,Object.keys(a.room).length&&a.showFooter]])}var Mm=Ye(vm,[["render",Em]]);const Rm={name:"MessageReply",components:{AudioPlayer:qo,SvgIcon:mt,FormatMessage:sr},props:{message:{type:Object,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},roomUsers:{type:Array,required:!0}},computed:{replyUsername(){const{senderId:e}=this.message.replyMessage,t=this.roomUsers.find(a=>a._id===e);return t?t.username:""},firstFile(){var e,t;return(t=(e=this.message.replyMessage)==null?void 0:e.files)!=null&&t.length?this.message.replyMessage.files[0]:{}},isAudio(){return Hr(this.firstFile)},isImage(){return La(this.firstFile)},isVideo(){return ir(this.firstFile)},isOtherFile(){var e;return((e=this.message.replyMessage.files)==null?void 0:e.length)&&!this.isAudio&&!this.isVideo&&!this.isImage}}},Tm={class:"vac-reply-message"},Am={class:"vac-reply-username"},Bm={key:0,class:"vac-image-reply-container"},Cm={key:1,class:"vac-video-reply-container"},Om={width:"100%",height:"100%",controls:""},Nm=["src"],Lm={key:3,class:"vac-file-container"},Im={class:"vac-text-ellipsis"},jm={key:0,class:"vac-text-ellipsis vac-text-extension"},Vm={class:"vac-reply-content"};function Hm(e,t,a,n,d,s){const k=r.resolveComponent("audio-player"),C=r.resolveComponent("svg-icon"),L=r.resolveComponent("format-message");return r.openBlock(),r.createElementBlock("div",Tm,[r.createElementVNode("div",Am,r.toDisplayString(s.replyUsername),1),s.isImage?(r.openBlock(),r.createElementBlock("div",Bm,[r.createElementVNode("div",{class:"vac-message-image vac-message-image-reply",style:r.normalizeStyle({"background-image":`url('${s.firstFile.url}')`})},null,4)])):s.isVideo?(r.openBlock(),r.createElementBlock("div",Cm,[r.createElementVNode("video",Om,[r.createElementVNode("source",{src:s.firstFile.url},null,8,Nm)])])):s.isAudio?(r.openBlock(),r.createBlock(k,{key:2,src:s.firstFile.url,onUpdateProgressTime:t[0]||(t[0]=b=>e.progressTime=b),onHoverAudioProgress:t[1]||(t[1]=b=>e.hoverAudioProgress=b)},r.createSlots({_:2},[r.renderList(e.$slots,(b,R)=>({name:R,fn:r.withCtx(h=>[r.renderSlot(e.$slots,R,r.normalizeProps(r.guardReactiveProps(h)))])}))]),1032,["src"])):s.isOtherFile?(r.openBlock(),r.createElementBlock("div",Lm,[r.createElementVNode("div",null,[r.renderSlot(e.$slots,"file-icon",{},()=>[r.createVNode(C,{name:"file"})])]),r.createElementVNode("div",Im,r.toDisplayString(s.firstFile.name),1),s.firstFile.extension?(r.openBlock(),r.createElementBlock("div",jm,r.toDisplayString(s.firstFile.extension),1)):r.createCommentVNode("",!0)])):r.createCommentVNode("",!0),r.createElementVNode("div",Vm,[r.createVNode(L,{content:a.message.replyMessage.content,users:a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,reply:!0},r.createSlots({_:2},[r.renderList(e.$slots,(b,R)=>({name:R,fn:r.withCtx(h=>[r.renderSlot(e.$slots,R,r.normalizeProps(r.guardReactiveProps(h)))])}))]),1032,["content","users","text-formatting","link-options"])])])}var Pm=Ye(Rm,[["render",Hm]]);const Fm={name:"ProgressBar",props:{progress:{type:Number,default:0}},data(){const n=54*Math.PI;return{radius:35,stroke:4,normalizedRadius:27,circumference:n}},computed:{strokeDashoffset(){return this.circumference-this.progress/100*this.circumference}}},Um={ref:"progress",class:"vac-progress-wrapper"},Dm=["height","width"],zm=["stroke-dasharray","stroke-width","r","cx","cy"],qm={class:"vac-progress-text"},Ym=r.createElementVNode("span",{class:"vac-progress-pourcent"},"%",-1);function Xm(e,t,a,n,d,s){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-fade-spinner",appear:""},{default:r.withCtx(()=>[r.createElementVNode("div",Um,[(r.openBlock(),r.createElementBlock("svg",{height:d.radius*2,width:d.radius*2},[r.createElementVNode("circle",{stroke:"rgba(255, 255, 255, 0.7)","stroke-dasharray":d.circumference+" "+d.circumference,style:r.normalizeStyle({strokeDashoffset:s.strokeDashoffset,strokeLinecap:"round"}),"stroke-width":d.stroke,fill:"transparent",r:d.normalizedRadius,cx:d.radius,cy:d.radius},null,12,zm)],8,Dm)),r.createElementVNode("div",{class:"vac-progress-content",style:r.normalizeStyle({height:d.radius*2-19+"px",width:d.radius*2-19+"px"})},[r.createElementVNode("div",qm,[r.createTextVNode(r.toDisplayString(a.progress),1),Ym])],4)],512)]),_:1})}var ii=Ye(Fm,[["render",Xm]]);const Gm={name:"MessageFile",components:{SvgIcon:mt,Loader:Rr,ProgressBar:ii},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},file:{type:Object,required:!0},index:{type:Number,required:!0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["open-file"],data(){return{imageResponsive:"",imageLoading:!1,imageHover:!1}},computed:{isImageLoading(){return this.file.url.indexOf("blob:http")!==-1||this.imageLoading},isImage(){return La(this.file)},isVideo(){return ir(this.file)}},watch:{file:{immediate:!0,handler(){this.checkImgLoad()}}},mounted(){const e=this.$refs["imageRef"+this.index];e&&(this.imageResponsive={maxHeight:e.clientWidth-18,loaderTop:e.clientHeight/2-9})},methods:{checkImgLoad(){if(!La(this.file))return;this.imageLoading=!0;const e=new Image;e.src=this.file.url,e.addEventListener("load",()=>this.imageLoading=!1)},openFile(e,t){this.messageSelectionEnabled||(e.stopPropagation(),this.$emit("open-file",{file:this.file,action:t}))}}},Km={class:"vac-message-file-container"},Zm={key:0,class:"vac-image-buttons"},Wm={width:"100%",height:"100%",controls:""},Qm=["src"];function Jm(e,t,a,n,d,s){const k=r.resolveComponent("progress-bar"),C=r.resolveComponent("loader"),L=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",Km,[s.isImage?(r.openBlock(),r.createElementBlock("div",{key:0,ref:"imageRef"+a.index,class:"vac-message-image-container",onMouseover:t[2]||(t[2]=b=>d.imageHover=!0),onMouseleave:t[3]||(t[3]=b=>d.imageHover=!1),onClick:t[4]||(t[4]=b=>s.openFile(b,"preview"))},[a.file.progress>=0?(r.openBlock(),r.createBlock(k,{key:0,progress:a.file.progress,style:r.normalizeStyle({top:`${d.imageResponsive.loaderTop}px`})},null,8,["progress","style"])):(r.openBlock(),r.createBlock(C,{key:1,show:s.isImageLoading,style:r.normalizeStyle({top:`${d.imageResponsive.loaderTop}px`})},r.createSlots({_:2},[r.renderList(e.$slots,(b,R)=>({name:R,fn:r.withCtx(h=>[r.renderSlot(e.$slots,R,r.normalizeProps(r.guardReactiveProps(h)))])}))]),1032,["show","style"])),r.createElementVNode("div",{class:r.normalizeClass(["vac-message-image",{"vac-blur-loading":s.isImageLoading&&a.message.senderId===a.currentUserId}]),style:r.normalizeStyle({"background-image":`url('${s.isImageLoading&&a.file.preview||a.file.url}')`,"max-height":`${d.imageResponsive.maxHeight}px`})},[r.createVNode(r.Transition,{name:"vac-fade-image"},{default:r.withCtx(()=>[!a.messageSelectionEnabled&&d.imageHover&&!s.isImageLoading?(r.openBlock(),r.createElementBlock("div",Zm,[r.createElementVNode("div",{class:"vac-svg-button vac-button-view",onClick:t[0]||(t[0]=b=>s.openFile(b,"preview"))},[r.renderSlot(e.$slots,"eye-icon",{},()=>[r.createVNode(L,{name:"eye"})])]),r.createElementVNode("div",{class:"vac-svg-button vac-button-download",onClick:t[1]||(t[1]=b=>s.openFile(b,"download"))},[r.renderSlot(e.$slots,"document-icon",{},()=>[r.createVNode(L,{name:"document"})])])])):r.createCommentVNode("",!0)]),_:3})],6)],544)):s.isVideo?(r.openBlock(),r.createElementBlock("div",{key:1,class:"vac-video-container",onClick:t[5]||(t[5]=r.withModifiers(b=>s.openFile("preview"),["prevent"]))},[a.file.progress>=0?(r.openBlock(),r.createBlock(k,{key:0,progress:a.file.progress},null,8,["progress"])):r.createCommentVNode("",!0),r.createElementVNode("video",Wm,[r.createElementVNode("source",{src:a.file.url},null,8,Qm)])])):r.createCommentVNode("",!0)])}var $m=Ye(Gm,[["render",Jm]]);const e2={name:"MessageFiles",components:{SvgIcon:mt,FormatMessage:sr,ProgressBar:ii,MessageFile:$m},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},roomUsers:{type:Array,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["open-file","open-user-tag"],computed:{imageVideoFiles(){return this.message.files.filter(e=>Vs(e))},otherFiles(){return this.message.files.filter(e=>!Vs(e))}},methods:{openFile(e,t,a){this.messageSelectionEnabled||(e.stopPropagation(),this.$emit("open-file",{file:t,action:a}))}}},t2={class:"vac-message-files-container"},a2=["onClick"],r2={class:"vac-svg-button"},o2={class:"vac-text-ellipsis"},s2={key:0,class:"vac-text-ellipsis vac-text-extension"};function n2(e,t,a,n,d,s){const k=r.resolveComponent("message-file"),C=r.resolveComponent("progress-bar"),L=r.resolveComponent("svg-icon"),b=r.resolveComponent("format-message");return r.openBlock(),r.createElementBlock("div",t2,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(s.imageVideoFiles,(R,h)=>(r.openBlock(),r.createElementBlock("div",{key:h+"iv"},[r.createVNode(k,{file:R,"current-user-id":a.currentUserId,message:a.message,index:h,"message-selection-enabled":a.messageSelectionEnabled,onOpenFile:t[0]||(t[0]=M=>e.$emit("open-file",M))},r.createSlots({_:2},[r.renderList(e.$slots,(M,w)=>({name:w,fn:r.withCtx(o=>[r.renderSlot(e.$slots,w,r.normalizeProps(r.guardReactiveProps(o)))])}))]),1032,["file","current-user-id","message","index","message-selection-enabled"])]))),128)),(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(s.otherFiles,(R,h)=>(r.openBlock(),r.createElementBlock("div",{key:h+"a",class:"vac-file-wrapper"},[R.progress>=0?(r.openBlock(),r.createBlock(C,{key:0,progress:R.progress,style:{top:"44px"}},null,8,["progress"])):r.createCommentVNode("",!0),r.createElementVNode("div",{class:r.normalizeClass(["vac-file-container",{"vac-file-container-progress":R.progress>=0}]),onClick:M=>s.openFile(M,R,"download")},[r.createElementVNode("div",r2,[r.renderSlot(e.$slots,"document-icon",{},()=>[r.createVNode(L,{name:"document"})])]),r.createElementVNode("div",o2,r.toDisplayString(R.name),1),R.extension?(r.openBlock(),r.createElementBlock("div",s2,r.toDisplayString(R.extension),1)):r.createCommentVNode("",!0)],10,a2)]))),128)),r.createVNode(b,{content:a.message.content,users:a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onOpenUserTag:t[1]||(t[1]=R=>e.$emit("open-user-tag",R))},r.createSlots({_:2},[r.renderList(e.$slots,(R,h)=>({name:h,fn:r.withCtx(M=>[r.renderSlot(e.$slots,h,r.normalizeProps(r.guardReactiveProps(M)))])}))]),1032,["content","users","text-formatting","link-options"])])}var i2=Ye(e2,[["render",n2]]);const l2={name:"MessageActions",components:{SvgIcon:mt,EmojiPickerContainer:On},directives:{clickOutside:Vr},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},messageActions:{type:Array,required:!0},showReactionEmojis:{type:Boolean,required:!0},messageHover:{type:Boolean,required:!0},hoverMessageId:{type:[String,Number],default:null},hoverAudioProgress:{type:Boolean,required:!0}},emits:["update-emoji-opened","update-options-opened","update-message-hover","message-action-handler","send-message-reaction"],data(){return{menuOptionsTop:0,optionsOpened:!1,optionsClosing:!1,emojiOpened:!1}},computed:{isMessageActions(){return this.filteredMessageActions.length&&this.messageHover&&!this.message.deleted&&!this.message.disableActions&&!this.hoverAudioProgress},isMessageReactions(){return this.showReactionEmojis&&this.messageHover&&!this.message.deleted&&!this.message.disableReactions&&!this.hoverAudioProgress},filteredMessageActions(){return this.message.senderId===this.currentUserId?this.messageActions:this.messageActions.filter(e=>!e.onlyMe)}},watch:{emojiOpened(e){this.$emit("update-emoji-opened",e),e&&(this.optionsOpened=!1)},optionsOpened(e){this.$emit("update-options-opened",e)}},methods:{openOptions(){this.optionsClosing||(this.optionsOpened=!this.optionsOpened,this.optionsOpened&&setTimeout(()=>{const e=document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer");if(!e||!this.$refs.menuOptions||!this.$refs.actionIcon)return;const t=this.$refs.menuOptions.getBoundingClientRect().height,a=this.$refs.actionIcon.getBoundingClientRect().top;e.getBoundingClientRect().top-a>t+50?this.menuOptionsTop=30:this.menuOptionsTop=-t}))},closeOptions(){this.optionsOpened=!1,this.optionsClosing=!0,this.updateMessageHover(),setTimeout(()=>this.optionsClosing=!1,100)},openEmoji(){this.emojiOpened=!this.emojiOpened},closeEmoji(){this.emojiOpened=!1,this.updateMessageHover()},updateMessageHover(){this.hoverMessageId!==this.message._id&&this.$emit("update-message-hover",!1)},messageActionHandler(e){this.closeOptions(),this.$emit("message-action-handler",e)},sendMessageReaction(e,t){this.$emit("send-message-reaction",{emoji:e,reaction:t}),this.closeEmoji()}}},c2={class:"vac-message-actions-wrapper"},d2={key:"3"},m2={class:"vac-menu-list"},h2=["onClick"];function u2(e,t,a,n,d,s){const k=r.resolveComponent("svg-icon"),C=r.resolveComponent("emoji-picker-container"),L=r.resolveDirective("click-outside");return r.openBlock(),r.createElementBlock("div",c2,[r.createElementVNode("div",{class:"vac-options-container",style:r.normalizeStyle({display:a.hoverAudioProgress?"none":"initial",width:s.filteredMessageActions.length&&a.showReactionEmojis?"70px":"45px"})},[r.createVNode(r.TransitionGroup,{name:"vac-slide-left",tag:"span"},{default:r.withCtx(()=>[s.isMessageActions||s.isMessageReactions?(r.openBlock(),r.createElementBlock("div",{key:"1",class:r.normalizeClass(["vac-blur-container",{"vac-options-me":a.message.senderId===a.currentUserId}])},null,2)):r.createCommentVNode("",!0),s.isMessageActions?(r.openBlock(),r.createElementBlock("div",{ref:"actionIcon",key:"2",class:"vac-svg-button vac-message-options",onClick:t[0]||(t[0]=(...b)=>s.openOptions&&s.openOptions(...b))},[r.renderSlot(e.$slots,"dropdown-icon",{},()=>[r.createVNode(k,{name:"dropdown",param:"message"})])],512)):r.createCommentVNode("",!0),s.isMessageReactions?r.withDirectives((r.openBlock(),r.createElementBlock("div",d2,[r.renderSlot(e.$slots,"emoji-picker",r.mergeProps({emojiOpened:d.emojiOpened},{addEmoji:s.sendMessageReaction}),()=>[r.createVNode(C,{class:"vac-message-emojis",style:r.normalizeStyle({right:s.isMessageActions?"30px":"5px"}),"emoji-opened":d.emojiOpened,"emoji-reaction":!0,"position-right":a.message.senderId===a.currentUserId,onAddEmoji:s.sendMessageReaction,onOpenEmoji:s.openEmoji},{"emoji-picker-icon":r.withCtx(()=>[r.renderSlot(e.$slots,"emoji-picker-reaction-icon")]),_:3},8,["style","emoji-opened","position-right","onAddEmoji","onOpenEmoji"])])])),[[L,s.closeEmoji]]):r.createCommentVNode("",!0)]),_:3})],4),s.filteredMessageActions.length?(r.openBlock(),r.createBlock(r.Transition,{key:0,name:a.message.senderId===a.currentUserId?"vac-slide-left":"vac-slide-right"},{default:r.withCtx(()=>[d.optionsOpened?r.withDirectives((r.openBlock(),r.createElementBlock("div",{key:0,ref:"menuOptions",class:r.normalizeClass(["vac-menu-options",{"vac-menu-left":a.message.senderId!==a.currentUserId}]),style:r.normalizeStyle({top:`${d.menuOptionsTop}px`})},[r.createElementVNode("div",m2,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(s.filteredMessageActions,b=>(r.openBlock(),r.createElementBlock("div",{key:b.name},[r.createElementVNode("div",{class:"vac-menu-item",onClick:R=>s.messageActionHandler(b)},r.toDisplayString(b.title),9,h2)]))),128))])],6)),[[L,s.closeOptions]]):r.createCommentVNode("",!0)]),_:1},8,["name"])):r.createCommentVNode("",!0)])}var f2=Ye(l2,[["render",u2]]);const _2={name:"MessageReactions",props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0}},emits:["send-message-reaction"],methods:{sendMessageReaction(e,t){this.$emit("send-message-reaction",{emoji:e,reaction:t})}}},p2=["onClick"];function v2(e,t,a,n,d,s){return a.message.deleted?r.createCommentVNode("",!0):(r.openBlock(),r.createBlock(r.TransitionGroup,{key:0,name:"vac-slide-left",tag:"span"},{default:r.withCtx(()=>[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.message.reactions,(k,C)=>r.withDirectives((r.openBlock(),r.createElementBlock("button",{key:C+0,class:r.normalizeClass(["vac-button-reaction",{"vac-reaction-me":k.indexOf(a.currentUserId)!==-1}]),style:r.normalizeStyle({float:a.message.senderId===a.currentUserId?"right":"left"}),onClick:L=>s.sendMessageReaction({unicode:C},k)},[r.createTextVNode(r.toDisplayString(C),1),r.createElementVNode("span",null,r.toDisplayString(k.length),1)],14,p2)),[[r.vShow,k.length]])),128))]),_:1}))}var g2=Ye(_2,[["render",v2]]);function b2(e){if(!((n,d)=>d.every(s=>{let k=!1;return(s.type[0]==="array"&&Array.isArray(n[s.key])||s.type.find(C=>C===typeof n[s.key]))&&(k=!0),k&&$o(n,s.key)}))(e,[{key:"roomId",type:["string","number"]},{key:"roomName",type:["string"]},{key:"users",type:["array"]}]))throw new Error("Rooms object is not valid! Must contain roomId[String, Number], roomName[String] and users[Array]")}function y2(e){if(!((n,d)=>d.every(s=>s.type.find(C=>C===typeof n[s.key])&&$o(n,s.key)))(e,[{key:"_id",type:["string","number"]},{key:"username",type:["string"]}]))throw new Error("Participants object is not valid! Must contain _id[String, Number] and username[String]")}function x2(e){if(!((n,d)=>d.every(s=>s.type.find(C=>C===typeof n[s.key])&&$o(n,s.key)))(e,[{key:"_id",type:["string","number"]},{key:"content",type:["string","number"]},{key:"senderId",type:["string","number"]}]))throw new Error("Messages object is not valid! Must contain _id[String, Number], content[String, Number] and senderId[String, Number]")}function $o(e,t){return Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==null&&e[t]!==void 0}const w2={name:"RoomMessage",components:{SvgIcon:mt,FormatMessage:sr,AudioPlayer:qo,MessageReply:Pm,MessageFiles:i2,MessageActions:f2,MessageReactions:g2},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},index:{type:Number,required:!0},message:{type:Object,required:!0},messages:{type:Array,required:!0},editedMessageId:{type:[String,Number],default:null},roomUsers:{type:Array,default:()=>[]},messageActions:{type:Array,required:!0},newMessages:{type:Array,default:()=>[]},showReactionEmojis:{type:Boolean,required:!0},showNewMessagesDivider:{type:Boolean,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},usernameOptions:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0},selectedMessages:{type:Array,default:()=>[]}},emits:["message-added","open-file","open-user-tag","open-failed-message","message-action-handler","send-message-reaction","select-message","unselect-message"],data(){return{hoverMessageId:null,messageHover:!1,optionsOpened:!1,emojiOpened:!1,newMessage:{},progressTime:"- : -",hoverAudioProgress:!1}},computed:{showUsername(){return!this.usernameOptions.currentUser&&this.message.senderId===this.currentUserId?!1:this.roomUsers.length>=this.usernameOptions.minUsers},showDate(){return this.index>0&&this.message.date!==this.messages[this.index-1].date},messageOffset(){return this.index>0&&this.message.senderId!==this.messages[this.index-1].senderId},isMessageHover(){return this.editedMessageId===this.message._id||this.hoverMessageId===this.message._id},isAudio(){var e;return(e=this.message.files)==null?void 0:e.some(t=>Hr(t))},isCheckmarkVisible(){return this.message.senderId===this.currentUserId&&!this.message.deleted&&(this.message.saved||this.message.distributed||this.message.seen)},hasCurrentUserAvatar(){return this.messages.some(e=>e.senderId===this.currentUserId&&e.avatar)},hasSenderUserAvatar(){return this.messages.some(e=>e.senderId!==this.currentUserId&&e.avatar)},isMessageSelected(){return this.messageSelectionEnabled&&!!this.selectedMessages.find(e=>e._id===this.message._id)}},watch:{newMessages:{immediate:!0,deep:!0,handler(e){if(!e.length||!this.showNewMessagesDivider){this.newMessage={};return}this.newMessage=e.reduce((t,a)=>a.index<t.index?a:t)}},messageSelectionEnabled(){this.resetMessageHover()}},mounted(){x2(this.message),this.$emit("message-added",{message:this.message,index:this.index,ref:this.$refs.message})},methods:{onHoverMessage(){this.messageSelectionEnabled||(this.messageHover=!0,this.canEditMessage()&&(this.hoverMessageId=this.message._id))},canEditMessage(){return!this.message.deleted},onLeaveMessage(){this.messageSelectionEnabled||(!this.optionsOpened&&!this.emojiOpened&&(this.messageHover=!1),this.hoverMessageId=null)},resetMessageHover(){this.messageHover=!1,this.hoverMessageId=null},openFile(e){this.$emit("open-file",{message:this.message,file:e})},openUserTag(e){this.$emit("open-user-tag",{user:e})},messageActionHandler(e){this.resetMessageHover(),setTimeout(()=>{this.$emit("message-action-handler",{action:e,message:this.message})},300)},sendMessageReaction({emoji:e,reaction:t}){this.$emit("send-message-reaction",{messageId:this.message._id,reaction:e,remove:t&&t.indexOf(this.currentUserId)!==-1}),this.messageHover=!1},selectMessage(){this.messageSelectionEnabled&&(this.isMessageSelected?this.$emit("unselect-message",this.message._id):this.$emit("select-message",this.message))}}},k2=["id"],S2={key:0,class:"vac-card-info vac-card-date"},E2={key:1,class:"vac-line-new"},M2={key:2,class:"vac-card-info vac-card-system"},R2={key:1,class:"vac-avatar-offset"},T2={key:2},A2={key:0,class:"vac-progress-time"},B2={class:"vac-text-timestamp"},C2={key:0,class:"vac-icon-edited"},O2={key:1},N2=[r.createElementVNode("div",{class:"vac-failure-text"}," ! ",-1)],L2={key:3,class:"vac-avatar-current-offset"};function I2(e,t,a,n,d,s){const k=r.resolveComponent("format-message"),C=r.resolveComponent("message-reply"),L=r.resolveComponent("svg-icon"),b=r.resolveComponent("message-files"),R=r.resolveComponent("audio-player"),h=r.resolveComponent("message-actions"),M=r.resolveComponent("message-reactions");return r.openBlock(),r.createElementBlock("div",{id:a.message._id,ref:"message",class:"vac-message-wrapper"},[s.showDate?(r.openBlock(),r.createElementBlock("div",S2,r.toDisplayString(a.message.date),1)):r.createCommentVNode("",!0),d.newMessage._id===a.message._id?(r.openBlock(),r.createElementBlock("div",E2,r.toDisplayString(a.textMessages.NEW_MESSAGES),1)):r.createCommentVNode("",!0),a.message.system?(r.openBlock(),r.createElementBlock("div",M2,[r.renderSlot(e.$slots,"system-message",r.normalizeProps(r.guardReactiveProps({message:a.message})),()=>[r.createVNode(k,{content:a.message.content,users:a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onOpenUserTag:s.openUserTag},r.createSlots({_:2},[r.renderList(e.$slots,(w,o)=>({name:o,fn:r.withCtx(F=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(F)))])}))]),1032,["content","users","text-formatting","link-options","onOpenUserTag"])])])):(r.openBlock(),r.createElementBlock("div",{key:3,class:r.normalizeClass(["vac-message-box",{"vac-offset-current":a.message.senderId===a.currentUserId}]),onClick:t[8]||(t[8]=(...w)=>s.selectMessage&&s.selectMessage(...w))},[r.renderSlot(e.$slots,"message",r.normalizeProps(r.guardReactiveProps({message:a.message})),()=>[a.message.avatar&&a.message.senderId!==a.currentUserId?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-avatar",style:r.normalizeStyle({"background-image":`url('${a.message.avatar}')`})},null,4)):r.createCommentVNode("",!0),s.hasSenderUserAvatar&&!a.message.avatar?(r.openBlock(),r.createElementBlock("div",R2)):r.createCommentVNode("",!0),r.createElementVNode("div",{class:r.normalizeClass(["vac-message-container",{"vac-message-container-offset":s.messageOffset}])},[r.createElementVNode("div",{class:r.normalizeClass(["vac-message-card",{"vac-message-highlight":s.isMessageHover,"vac-message-current":a.message.senderId===a.currentUserId,"vac-message-deleted":a.message.deleted,"vac-item-clickable":a.messageSelectionEnabled,"vac-message-selected":s.isMessageSelected}]),onMouseover:t[5]||(t[5]=(...w)=>s.onHoverMessage&&s.onHoverMessage(...w)),onMouseleave:t[6]||(t[6]=(...w)=>s.onLeaveMessage&&s.onLeaveMessage(...w))},[s.showUsername?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-text-username",{"vac-username-reply":!a.message.deleted&&a.message.replyMessage}])},[r.createElementVNode("span",null,r.toDisplayString(a.message.username),1)],2)):r.createCommentVNode("",!0),!a.message.deleted&&a.message.replyMessage?(r.openBlock(),r.createBlock(C,{key:1,message:a.message,"room-users":a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions},r.createSlots({_:2},[r.renderList(e.$slots,(w,o)=>({name:o,fn:r.withCtx(F=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(F)))])}))]),1032,["message","room-users","text-formatting","link-options"])):r.createCommentVNode("",!0),a.message.deleted?(r.openBlock(),r.createElementBlock("div",T2,[r.renderSlot(e.$slots,"deleted-icon",{},()=>[r.createVNode(L,{name:"deleted",class:"vac-icon-deleted"})]),r.createElementVNode("span",null,r.toDisplayString(a.textMessages.MESSAGE_DELETED),1)])):!a.message.files||!a.message.files.length?(r.openBlock(),r.createBlock(k,{key:3,content:a.message.content,users:a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onOpenUserTag:s.openUserTag},r.createSlots({_:2},[r.renderList(e.$slots,(w,o)=>({name:o,fn:r.withCtx(F=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(F)))])}))]),1032,["content","users","text-formatting","link-options","onOpenUserTag"])):!s.isAudio||a.message.files.length>1?(r.openBlock(),r.createBlock(b,{key:4,"current-user-id":a.currentUserId,message:a.message,"room-users":a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"message-selection-enabled":a.messageSelectionEnabled,onOpenFile:s.openFile,onOpenUserTag:s.openUserTag},r.createSlots({_:2},[r.renderList(e.$slots,(w,o)=>({name:o,fn:r.withCtx(F=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(F)))])}))]),1032,["current-user-id","message","room-users","text-formatting","link-options","message-selection-enabled","onOpenFile","onOpenUserTag"])):(r.openBlock(),r.createElementBlock(r.Fragment,{key:5},[r.createVNode(R,{"message-id":a.message._id,src:a.message.files[0].url,"message-selection-enabled":a.messageSelectionEnabled,onUpdateProgressTime:t[0]||(t[0]=w=>d.progressTime=w),onHoverAudioProgress:t[1]||(t[1]=w=>d.hoverAudioProgress=w)},r.createSlots({_:2},[r.renderList(e.$slots,(w,o)=>({name:o,fn:r.withCtx(F=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(F)))])}))]),1032,["message-id","src","message-selection-enabled"]),a.message.deleted?r.createCommentVNode("",!0):(r.openBlock(),r.createElementBlock("div",A2,r.toDisplayString(d.progressTime),1))],64)),r.createElementVNode("div",B2,[a.message.edited&&!a.message.deleted?(r.openBlock(),r.createElementBlock("div",C2,[r.renderSlot(e.$slots,"pencil-icon",{},()=>[r.createVNode(L,{name:"pencil"})])])):r.createCommentVNode("",!0),r.createElementVNode("span",null,r.toDisplayString(a.message.timestamp),1),s.isCheckmarkVisible?(r.openBlock(),r.createElementBlock("span",O2,[r.renderSlot(e.$slots,"checkmark-icon",r.normalizeProps(r.guardReactiveProps({message:a.message})),()=>[r.createVNode(L,{name:a.message.distributed?"double-checkmark":"checkmark",param:a.message.seen?"seen":"",class:"vac-icon-check"},null,8,["name","param"])])])):r.createCommentVNode("",!0)]),r.createVNode(h,{"current-user-id":a.currentUserId,message:a.message,"message-actions":a.messageActions,"show-reaction-emojis":a.showReactionEmojis,"message-hover":d.messageHover,"hover-message-id":d.hoverMessageId,"hover-audio-progress":d.hoverAudioProgress,onUpdateMessageHover:t[2]||(t[2]=w=>d.messageHover=w),onUpdateOptionsOpened:t[3]||(t[3]=w=>d.optionsOpened=w),onUpdateEmojiOpened:t[4]||(t[4]=w=>d.emojiOpened=w),onMessageActionHandler:s.messageActionHandler,onSendMessageReaction:s.sendMessageReaction},r.createSlots({_:2},[r.renderList(e.$slots,(w,o)=>({name:o,fn:r.withCtx(F=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(F)))])}))]),1032,["current-user-id","message","message-actions","show-reaction-emojis","message-hover","hover-message-id","hover-audio-progress","onMessageActionHandler","onSendMessageReaction"])],34),r.createVNode(M,{"current-user-id":a.currentUserId,message:a.message,onSendMessageReaction:s.sendMessageReaction},null,8,["current-user-id","message","onSendMessageReaction"])],2),r.renderSlot(e.$slots,"message-failure",r.normalizeProps(r.guardReactiveProps({message:a.message})),()=>[a.message.failure&&a.message.senderId===a.currentUserId?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-failure-container vac-svg-button",{"vac-failure-container-avatar":a.message.avatar&&a.message.senderId===a.currentUserId}]),onClick:t[7]||(t[7]=w=>e.$emit("open-failed-message",{message:a.message}))},N2,2)):r.createCommentVNode("",!0)]),a.message.avatar&&a.message.senderId===a.currentUserId?(r.openBlock(),r.createElementBlock("div",{key:2,class:"vac-avatar vac-avatar-current",style:r.normalizeStyle({"background-image":`url('${a.message.avatar}')`})},null,4)):r.createCommentVNode("",!0),s.hasCurrentUserAvatar&&!a.message.avatar?(r.openBlock(),r.createElementBlock("div",L2)):r.createCommentVNode("",!0)])],2))],8,k2)}var j2=Ye(w2,[["render",I2]]);const V2={name:"ChatRoom",components:{Loader:Rr,SvgIcon:mt,RoomHeader:H0,RoomFooter:Mm,RoomMessage:j2},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},singleRoom:{type:Boolean,required:!0},showRoomsList:{type:Boolean,required:!0},isMobile:{type:Boolean,required:!0},rooms:{type:Array,required:!0},roomId:{type:[String,Number],required:!0},loadFirstRoom:{type:Boolean,required:!0},messages:{type:Array,required:!0},roomMessage:{type:String,default:null},messagesLoaded:{type:Boolean,required:!0},menuActions:{type:Array,required:!0},messageActions:{type:Array,required:!0},messageSelectionActions:{type:Array,required:!0},autoScroll:{type:Object,required:!0},showSendIcon:{type:Boolean,required:!0},showFiles:{type:Boolean,required:!0},showAudio:{type:Boolean,required:!0},audioBitRate:{type:Number,required:!0},audioSampleRate:{type:Number,required:!0},showEmojis:{type:Boolean,required:!0},showReactionEmojis:{type:Boolean,required:!0},showNewMessagesDivider:{type:Boolean,required:!0},showFooter:{type:Boolean,required:!0},acceptedFiles:{type:String,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},loadingRooms:{type:Boolean,required:!0},roomInfoEnabled:{type:Boolean,required:!0},textareaActionEnabled:{type:Boolean,required:!0},textareaAutoFocus:{type:Boolean,required:!0},userTagsEnabled:{type:Boolean,required:!0},emojisSuggestionEnabled:{type:Boolean,required:!0},scrollDistance:{type:Number,required:!0},templatesText:{type:Array,default:null},usernameOptions:{type:Object,required:!0}},emits:["toggle-rooms-list","room-info","menu-action-handler","message-selection-action-handler","edit-message","send-message","delete-message","message-action-handler","fetch-messages","send-message-reaction","typing-message","open-file","open-user-tag","open-failed-message","textarea-action-handler"],data(){return{editedMessageId:null,initReplyMessage:null,initEditMessage:null,infiniteState:null,loadingMessages:!1,observer:null,showLoader:!0,loadingMoreMessages:!1,scrollIcon:!1,scrollMessagesCount:0,newMessages:[],messageSelectionEnabled:!1,selectedMessages:[]}},computed:{room(){return this.rooms.find(e=>e.roomId===this.roomId)||{}},showNoMessages(){return this.roomId&&!this.messages.length&&!this.loadingMessages&&!this.loadingRooms},showNoRoom(){const e=!this.rooms.length&&!this.loadingRooms||!this.roomId&&!this.loadFirstRoom;return e&&this.updateLoadingMessages(!1),e},showMessagesStarted(){return this.messages.length&&this.messagesLoaded}},watch:{roomId(){this.onRoomChanged()},messages:{deep:!0,handler(e,t){e.forEach((a,n)=>{this.showNewMessagesDivider&&!a.seen&&a.senderId!==this.currentUserId&&this.newMessages.push({_id:a._id,index:n})}),(t==null?void 0:t.length)===(e==null?void 0:e.length)-1&&(this.newMessages=[]),this.infiniteState&&this.infiniteState.loaded(),setTimeout(()=>this.loadingMoreMessages=!1)}},messagesLoaded(e){e&&this.updateLoadingMessages(!1),this.infiniteState&&this.infiniteState.complete()}},mounted(){this.newMessages=[]},methods:{updateLoadingMessages(e){this.loadingMessages=e,e?this.infiniteState=null:(this.infiniteState&&this.infiniteState.loaded(),setTimeout(()=>this.initIntersectionObserver()))},initIntersectionObserver(){this.observer&&(this.showLoader=!0,this.observer.disconnect());const e=document.querySelector("vue-advanced-chat").shadowRoot.getElementById("infinite-loader-messages");if(e){const t={root:document.querySelector("vue-advanced-chat").shadowRoot.getElementById("messages-list"),rootMargin:`${this.scrollDistance}px`,threshold:0};this.observer=new IntersectionObserver(a=>{a[0].isIntersecting&&this.loadMoreMessages()},t),this.observer.observe(e)}},preventTopScroll(){const e=this.$refs.scrollContainer,t=e.scrollHeight,a=new ResizeObserver(d=>{e.scrollHeight!==t&&this.$refs.scrollContainer&&(this.$refs.scrollContainer.scrollTo({top:e.scrollHeight-t}),a.disconnect())});for(var n=0;n<e.children.length;n++)a.observe(e.children[n])},touchStart(e){if(!this.singleRoom&&e.changedTouches.length===1){const t=e.changedTouches[0].clientX,a=e.changedTouches[0].clientY;addEventListener("touchend",n=>this.touchEnd(n,t,a),{once:!0})}},touchEnd(e,t,a){if(e.changedTouches.length===1){const n=e.changedTouches[0].clientX,d=e.changedTouches[0].clientY,s=n-t>100,k=Math.abs(d-a)>50;s&&!k&&this.$emit("toggle-rooms-list")}},onRoomChanged(){this.updateLoadingMessages(!0),this.scrollIcon=!1,this.scrollMessagesCount=0,this.resetMessageSelection();const e=this.$watch(()=>this.messages,t=>{if(!t||!t.length)return;const a=this.$refs.scrollContainer;!a||(e(),setTimeout(()=>{a.scrollTo({top:a.scrollHeight}),this.updateLoadingMessages(!1)}))})},resetMessageSelection(){this.messageSelectionEnabled=!1,this.selectedMessages=[]},selectMessage(e){this.selectedMessages.push(e)},unselectMessage(e){this.selectedMessages=this.selectedMessages.filter(t=>t._id!==e)},onMessageAdded({message:e,index:t,ref:a}){if(t!==this.messages.length-1)return;const n=a.offsetHeight+60;setTimeout(()=>{const d=this.getBottomScroll(this.$refs.scrollContainer)>n;e.senderId===this.currentUserId?d?this.autoScroll.send.newAfterScrollUp&&this.scrollToBottom():this.autoScroll.send.new&&this.scrollToBottom():d?this.autoScroll.receive.newAfterScrollUp?this.scrollToBottom():(this.scrollIcon=!0,this.scrollMessagesCount++):this.autoScroll.receive.new?this.scrollToBottom():(this.scrollIcon=!0,this.scrollMessagesCount++)})},onContainerScroll(e){if(!e.target)return;const t=this.getBottomScroll(e.target);t<60&&(this.scrollMessagesCount=0),this.scrollIcon=t>500||this.scrollMessagesCount},loadMoreMessages(){this.loadingMessages||setTimeout(()=>{if(!this.loadingMoreMessages){if(this.messagesLoaded||!this.roomId){this.loadingMoreMessages=!1,this.showLoader=!1;return}this.preventTopScroll(),this.$emit("fetch-messages"),this.loadingMoreMessages=!0}},500)},messageActionHandler({action:e,message:t}){switch(e.name){case"replyMessage":this.initReplyMessage=t;return;case"editMessage":this.initEditMessage=t;return;case"deleteMessage":return this.$emit("delete-message",t);case"selectMessages":this.selectedMessages=[t],this.messageSelectionEnabled=!0;return;default:return this.$emit("message-action-handler",{action:e,message:t})}},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",{action:e,messages:this.selectedMessages}),this.resetMessageSelection()},sendMessageReaction(e){this.$emit("send-message-reaction",e)},getBottomScroll(e){const{scrollHeight:t,clientHeight:a,scrollTop:n}=e;return t-a-n},scrollToBottom(){setTimeout(()=>{const e=this.$refs.scrollContainer;e.classList.add("vac-scroll-smooth"),e.scrollTo({top:e.scrollHeight,behavior:"smooth"}),setTimeout(()=>e.classList.remove("vac-scroll-smooth"))},50)},openFile({message:e,file:t}){this.$emit("open-file",{message:e,file:t})},openUserTag(e){this.$emit("open-user-tag",e)}}},H2={class:"vac-container-center vac-room-empty"},P2={class:"vac-messages-container"},F2={key:0,class:"vac-text-started"},U2={key:1,class:"vac-text-started"},D2={key:0,id:"infinite-loader-messages"},z2={key:2},q2={key:0,class:"vac-badge-counter vac-messages-count"};function Y2(e,t,a,n,d,s){const k=r.resolveComponent("room-header"),C=r.resolveComponent("loader"),L=r.resolveComponent("room-message"),b=r.resolveComponent("svg-icon"),R=r.resolveComponent("room-footer");return r.withDirectives((r.openBlock(),r.createElementBlock("div",{class:"vac-col-messages",onTouchstart:t[12]||(t[12]=(...h)=>s.touchStart&&s.touchStart(...h))},[s.showNoRoom?r.renderSlot(e.$slots,"no-room-selected",{key:0},()=>[r.createElementVNode("div",H2,[r.createElementVNode("div",null,r.toDisplayString(a.textMessages.ROOM_EMPTY),1)])]):(r.openBlock(),r.createBlock(k,{key:1,"current-user-id":a.currentUserId,"text-messages":a.textMessages,"single-room":a.singleRoom,"show-rooms-list":a.showRoomsList,"is-mobile":a.isMobile,"room-info-enabled":a.roomInfoEnabled,"menu-actions":a.menuActions,room:s.room,"message-selection-enabled":d.messageSelectionEnabled,"message-selection-actions":a.messageSelectionActions,"selected-messages-total":d.selectedMessages.length,onToggleRoomsList:t[0]||(t[0]=h=>e.$emit("toggle-rooms-list")),onRoomInfo:t[1]||(t[1]=h=>e.$emit("room-info")),onMenuActionHandler:t[2]||(t[2]=h=>e.$emit("menu-action-handler",h)),onMessageSelectionActionHandler:s.messageSelectionActionHandler,onCancelMessageSelection:t[3]||(t[3]=h=>d.messageSelectionEnabled=!1)},r.createSlots({_:2},[r.renderList(e.$slots,(h,M)=>({name:M,fn:r.withCtx(w=>[r.renderSlot(e.$slots,M,r.normalizeProps(r.guardReactiveProps(w)))])}))]),1032,["current-user-id","text-messages","single-room","show-rooms-list","is-mobile","room-info-enabled","menu-actions","room","message-selection-enabled","message-selection-actions","selected-messages-total","onMessageSelectionActionHandler"])),r.createElementVNode("div",{id:"messages-list",ref:"scrollContainer",class:"vac-container-scroll",onScroll:t[5]||(t[5]=(...h)=>s.onContainerScroll&&s.onContainerScroll(...h))},[r.createVNode(C,{show:d.loadingMessages},r.createSlots({_:2},[r.renderList(e.$slots,(h,M)=>({name:M,fn:r.withCtx(w=>[r.renderSlot(e.$slots,M,r.normalizeProps(r.guardReactiveProps(w)))])}))]),1032,["show"]),r.createElementVNode("div",P2,[r.createElementVNode("div",{class:r.normalizeClass({"vac-messages-hidden":d.loadingMessages})},[r.createVNode(r.Transition,{name:"vac-fade-message"},{default:r.withCtx(()=>[r.createElementVNode("div",null,[s.showNoMessages?(r.openBlock(),r.createElementBlock("div",F2,[r.renderSlot(e.$slots,"messages-empty",{},()=>[r.createTextVNode(r.toDisplayString(a.textMessages.MESSAGES_EMPTY),1)])])):r.createCommentVNode("",!0),s.showMessagesStarted?(r.openBlock(),r.createElementBlock("div",U2,r.toDisplayString(a.textMessages.CONVERSATION_STARTED)+" "+r.toDisplayString(a.messages[0].date),1)):r.createCommentVNode("",!0)])]),_:3}),a.messages.length&&!a.messagesLoaded?(r.openBlock(),r.createElementBlock("div",D2,[r.createVNode(C,{show:!0,infinite:!0},r.createSlots({_:2},[r.renderList(e.$slots,(h,M)=>({name:M,fn:r.withCtx(w=>[r.renderSlot(e.$slots,M,r.normalizeProps(r.guardReactiveProps(w)))])}))]),1024)])):r.createCommentVNode("",!0),(r.openBlock(),r.createBlock(r.TransitionGroup,{key:a.roomId,name:"vac-fade-message",tag:"span"},{default:r.withCtx(()=>[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.messages,(h,M)=>(r.openBlock(),r.createElementBlock("div",{key:h.indexId||h._id},[r.createVNode(L,{"current-user-id":a.currentUserId,message:h,index:M,messages:a.messages,"edited-message-id":d.editedMessageId,"message-actions":a.messageActions,"room-users":s.room.users,"text-messages":a.textMessages,"new-messages":d.newMessages,"show-reaction-emojis":a.showReactionEmojis,"show-new-messages-divider":a.showNewMessagesDivider,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"username-options":a.usernameOptions,"message-selection-enabled":d.messageSelectionEnabled,"selected-messages":d.selectedMessages,onMessageAdded:s.onMessageAdded,onMessageActionHandler:s.messageActionHandler,onOpenFile:s.openFile,onOpenUserTag:s.openUserTag,onOpenFailedMessage:t[4]||(t[4]=w=>e.$emit("open-failed-message",w)),onSendMessageReaction:s.sendMessageReaction,onSelectMessage:s.selectMessage,onUnselectMessage:s.unselectMessage},r.createSlots({_:2},[r.renderList(e.$slots,(w,o)=>({name:o,fn:r.withCtx(F=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(F)))])}))]),1032,["current-user-id","message","index","messages","edited-message-id","message-actions","room-users","text-messages","new-messages","show-reaction-emojis","show-new-messages-divider","text-formatting","link-options","username-options","message-selection-enabled","selected-messages","onMessageAdded","onMessageActionHandler","onOpenFile","onOpenUserTag","onSendMessageReaction","onSelectMessage","onUnselectMessage"])]))),128))]),_:3}))],2)])],544),d.loadingMessages?r.createCommentVNode("",!0):(r.openBlock(),r.createElementBlock("div",z2,[r.createVNode(r.Transition,{name:"vac-bounce"},{default:r.withCtx(()=>[d.scrollIcon?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-icon-scroll",onClick:t[6]||(t[6]=(...h)=>s.scrollToBottom&&s.scrollToBottom(...h))},[r.createVNode(r.Transition,{name:"vac-bounce"},{default:r.withCtx(()=>[d.scrollMessagesCount?(r.openBlock(),r.createElementBlock("div",q2,r.toDisplayString(d.scrollMessagesCount),1)):r.createCommentVNode("",!0)]),_:1}),r.renderSlot(e.$slots,"scroll-icon",{},()=>[r.createVNode(b,{name:"dropdown",param:"scroll"})])])):r.createCommentVNode("",!0)]),_:3})])),r.createVNode(R,{room:s.room,"room-id":a.roomId,"room-message":a.roomMessage,"text-messages":a.textMessages,"show-send-icon":a.showSendIcon,"show-files":a.showFiles,"show-audio":a.showAudio,"show-emojis":a.showEmojis,"show-footer":a.showFooter,"accepted-files":a.acceptedFiles,"textarea-action-enabled":a.textareaActionEnabled,"textarea-auto-focus":a.textareaAutoFocus,"user-tags-enabled":a.userTagsEnabled,"emojis-suggestion-enabled":a.emojisSuggestionEnabled,"templates-text":a.templatesText,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"audio-bit-rate":a.audioBitRate,"audio-sample-rate":a.audioSampleRate,"init-reply-message":d.initReplyMessage,"init-edit-message":d.initEditMessage,onUpdateEditedMessageId:t[7]||(t[7]=h=>d.editedMessageId=h),onEditMessage:t[8]||(t[8]=h=>e.$emit("edit-message",h)),onSendMessage:t[9]||(t[9]=h=>e.$emit("send-message",h)),onTypingMessage:t[10]||(t[10]=h=>e.$emit("typing-message",h)),onTextareaActionHandler:t[11]||(t[11]=h=>e.$emit("textarea-action-handler",h))},r.createSlots({_:2},[r.renderList(e.$slots,(h,M)=>({name:M,fn:r.withCtx(w=>[r.renderSlot(e.$slots,M,r.normalizeProps(r.guardReactiveProps(w)))])}))]),1032,["room","room-id","room-message","text-messages","show-send-icon","show-files","show-audio","show-emojis","show-footer","accepted-files","textarea-action-enabled","textarea-auto-focus","user-tags-enabled","emojis-suggestion-enabled","templates-text","text-formatting","link-options","audio-bit-rate","audio-sample-rate","init-reply-message","init-edit-message"])],544)),[[r.vShow,a.isMobile&&!a.showRoomsList||!a.isMobile||a.singleRoom]])}var X2=Ye(V2,[["render",Y2]]);const G2={name:"MediaPreview",components:{SvgIcon:mt},props:{file:{type:Object,required:!0}},emits:["close-media-preview"],computed:{isImage(){return La(this.file)},isVideo(){return ir(this.file)}},mounted(){this.$refs.modal.focus()},methods:{closeModal(){this.$emit("close-media-preview")}}},K2={key:0,class:"vac-media-preview-container"},Z2={key:1,class:"vac-media-preview-container"},W2={width:"100%",height:"100%",controls:"",autoplay:""},Q2=["src"],J2={class:"vac-svg-button"};function $2(e,t,a,n,d,s){const k=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",{ref:"modal",tabindex:"0",class:"vac-media-preview",onClick:t[0]||(t[0]=r.withModifiers((...C)=>s.closeModal&&s.closeModal(...C),["stop"])),onKeydown:t[1]||(t[1]=r.withKeys((...C)=>s.closeModal&&s.closeModal(...C),["esc"]))},[r.createVNode(r.Transition,{name:"vac-bounce-preview",appear:""},{default:r.withCtx(()=>[s.isImage?(r.openBlock(),r.createElementBlock("div",K2,[r.createElementVNode("div",{class:"vac-image-preview",style:r.normalizeStyle({"background-image":`url('${a.file.url}')`})},null,4)])):s.isVideo?(r.openBlock(),r.createElementBlock("div",Z2,[r.createElementVNode("video",W2,[r.createElementVNode("source",{src:a.file.url},null,8,Q2)])])):r.createCommentVNode("",!0)]),_:1}),r.createElementVNode("div",J2,[r.renderSlot(e.$slots,"preview-close-icon",{},()=>[r.createVNode(k,{name:"close-outline",param:"preview"})])])],544)}var eh=Ye(G2,[["render",$2]]),th={ROOMS_EMPTY:"No rooms",ROOM_EMPTY:"No room selected",NEW_MESSAGES:"New Messages",MESSAGE_DELETED:"This message was deleted",MESSAGES_EMPTY:"No messages",CONVERSATION_STARTED:"Conversation started on:",TYPE_MESSAGE:"Type message",SEARCH:"Search",IS_ONLINE:"is online",LAST_SEEN:"last seen ",IS_TYPING:"is writing...",CANCEL_SELECT_MESSAGE:"Cancel"};const ah={light:{general:{color:"#0a0a0a",colorButtonClear:"#1976d2",colorButton:"#fff",backgroundColorButton:"#1976d2",backgroundInput:"#fff",colorPlaceholder:"#9ca6af",colorCaret:"#1976d2",colorSpinner:"#333",borderStyle:"1px solid #e1e4e8",backgroundScrollIcon:"#fff"},container:{border:"none",borderRadius:"4px",boxShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)"},header:{background:"#fff",colorRoomName:"#0a0a0a",colorRoomInfo:"#9ca6af"},footer:{background:"#f8f9fa",borderStyleInput:"1px solid #e1e4e8",borderInputSelected:"#1976d2",backgroundReply:"#e5e5e6",backgroundTagActive:"#e5e5e6",backgroundTag:"#f8f9fa"},content:{background:"#f8f9fa"},sidemenu:{background:"#fff",backgroundHover:"#f6f6f6",backgroundActive:"#e5effa",colorActive:"#1976d2",borderColorSearch:"#e1e5e8"},dropdown:{background:"#fff",backgroundHover:"#f6f6f6"},message:{background:"#fff",backgroundMe:"#ccf2cf",color:"#0a0a0a",colorStarted:"#9ca6af",backgroundDeleted:"#dadfe2",backgroundSelected:"#c2dcf2",colorDeleted:"#757e85",colorUsername:"#9ca6af",colorTimestamp:"#828c94",backgroundDate:"#e5effa",colorDate:"#505a62",backgroundSystem:"#e5effa",colorSystem:"#505a62",backgroundMedia:"rgba(0, 0, 0, 0.15)",backgroundReply:"rgba(0, 0, 0, 0.08)",colorReplyUsername:"#0a0a0a",colorReply:"#6e6e6e",colorTag:"#0d579c",backgroundImage:"#ddd",colorNewMessages:"#1976d2",backgroundScrollCounter:"#0696c7",colorScrollCounter:"#fff",backgroundReaction:"#eee",borderStyleReaction:"1px solid #eee",backgroundReactionHover:"#fff",borderStyleReactionHover:"1px solid #ddd",colorReactionCounter:"#0a0a0a",backgroundReactionMe:"#cfecf5",borderStyleReactionMe:"1px solid #3b98b8",backgroundReactionHoverMe:"#cfecf5",borderStyleReactionHoverMe:"1px solid #3b98b8",colorReactionCounterMe:"#0b59b3",backgroundAudioRecord:"#eb4034",backgroundAudioLine:"rgba(0, 0, 0, 0.15)",backgroundAudioProgress:"#455247",backgroundAudioProgressSelector:"#455247",colorFileExtension:"#757e85"},markdown:{background:"rgba(239, 239, 239, 0.7)",border:"rgba(212, 212, 212, 0.9)",color:"#e01e5a",colorMulti:"#0a0a0a"},room:{colorUsername:"#0a0a0a",colorMessage:"#67717a",colorTimestamp:"#a2aeb8",colorStateOnline:"#4caf50",colorStateOffline:"#9ca6af",backgroundCounterBadge:"#0696c7",colorCounterBadge:"#fff"},emoji:{background:"#fff"},icons:{search:"#9ca6af",add:"#1976d2",toggle:"#0a0a0a",menu:"#0a0a0a",close:"#9ca6af",closeImage:"#fff",file:"#1976d2",paperclip:"#1976d2",closeOutline:"#000",closePreview:"#fff",send:"#1976d2",sendDisabled:"#9ca6af",emoji:"#1976d2",emojiReaction:"rgba(0, 0, 0, 0.3)",document:"#1976d2",pencil:"#9e9e9e",checkmark:"#9e9e9e",checkmarkSeen:"#0696c7",eye:"#fff",dropdownMessage:"#fff",dropdownMessageBackground:"rgba(0, 0, 0, 0.25)",dropdownRoom:"#9e9e9e",dropdownScroll:"#0a0a0a",microphone:"#1976d2",audioPlay:"#455247",audioPause:"#455247",audioCancel:"#eb4034",audioConfirm:"#1ba65b"}},dark:{general:{color:"#fff",colorButtonClear:"#fff",colorButton:"#fff",backgroundColorButton:"#1976d2",backgroundInput:"#202223",colorPlaceholder:"#596269",colorCaret:"#fff",colorSpinner:"#fff",borderStyle:"none",backgroundScrollIcon:"#fff"},container:{border:"none",borderRadius:"4px",boxShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)"},header:{background:"#181a1b",colorRoomName:"#fff",colorRoomInfo:"#9ca6af"},footer:{background:"#131415",borderStyleInput:"none",borderInputSelected:"#1976d2",backgroundReply:"#1b1c1c",backgroundTagActive:"#1b1c1c",backgroundTag:"#131415"},content:{background:"#131415"},sidemenu:{background:"#181a1b",backgroundHover:"#202224",backgroundActive:"#151617",colorActive:"#fff",borderColorSearch:"#181a1b"},dropdown:{background:"#2a2c33",backgroundHover:"#26282e"},message:{background:"#22242a",backgroundMe:"#1f7e80",color:"#fff",colorStarted:"#9ca6af",backgroundDeleted:"#1b1c21",backgroundSelected:"#c2dcf2",colorDeleted:"#a2a5a8",colorUsername:"#b3bac9",colorTimestamp:"#ebedf2",backgroundDate:"rgba(0, 0, 0, 0.3)",colorDate:"#bec5cc",backgroundSystem:"rgba(0, 0, 0, 0.3)",colorSystem:"#bec5cc",backgroundMedia:"rgba(0, 0, 0, 0.18)",backgroundReply:"rgba(0, 0, 0, 0.18)",colorReplyUsername:"#fff",colorReply:"#d6d6d6",colorTag:"#f0c60a",backgroundImage:"#ddd",colorNewMessages:"#fff",backgroundScrollCounter:"#1976d2",colorScrollCounter:"#fff",backgroundReaction:"none",borderStyleReaction:"none",backgroundReactionHover:"#202223",borderStyleReactionHover:"none",colorReactionCounter:"#fff",backgroundReactionMe:"#4e9ad1",borderStyleReactionMe:"none",backgroundReactionHoverMe:"#4e9ad1",borderStyleReactionHoverMe:"none",colorReactionCounterMe:"#fff",backgroundAudioRecord:"#eb4034",backgroundAudioLine:"rgba(255, 255, 255, 0.15)",backgroundAudioProgress:"#b7d4d3",backgroundAudioProgressSelector:"#b7d4d3",colorFileExtension:"#a2a5a8"},markdown:{background:"rgba(239, 239, 239, 0.7)",border:"rgba(212, 212, 212, 0.9)",color:"#e01e5a",colorMulti:"#0a0a0a"},room:{colorUsername:"#fff",colorMessage:"#6c7278",colorTimestamp:"#6c7278",colorStateOnline:"#4caf50",colorStateOffline:"#596269",backgroundCounterBadge:"#1976d2",colorCounterBadge:"#fff"},emoji:{background:"#343740"},icons:{search:"#596269",add:"#fff",toggle:"#fff",menu:"#fff",close:"#9ca6af",closeImage:"#fff",file:"#1976d2",paperclip:"#fff",closeOutline:"#fff",closePreview:"#fff",send:"#fff",sendDisabled:"#646a70",emoji:"#fff",emojiReaction:"#fff",document:"#1976d2",pencil:"#ebedf2",checkmark:"#ebedf2",checkmarkSeen:"#f0d90a",eye:"#fff",dropdownMessage:"#fff",dropdownMessageBackground:"rgba(0, 0, 0, 0.25)",dropdownRoom:"#fff",dropdownScroll:"#0a0a0a",microphone:"#fff",audioPlay:"#b7d4d3",audioPause:"#b7d4d3",audioCancel:"#eb4034",audioConfirm:"#1ba65b"}}},rh=({general:e,container:t,header:a,footer:n,sidemenu:d,content:s,dropdown:k,message:C,markdown:L,room:b,emoji:R,icons:h})=>({"--chat-color":e.color,"--chat-color-button-clear":e.colorButtonClear,"--chat-color-button":e.colorButton,"--chat-bg-color-button":e.backgroundColorButton,"--chat-bg-color-input":e.backgroundInput,"--chat-color-spinner":e.colorSpinner,"--chat-color-placeholder":e.colorPlaceholder,"--chat-color-caret":e.colorCaret,"--chat-border-style":e.borderStyle,"--chat-bg-scroll-icon":e.backgroundScrollIcon,"--chat-container-border":t.border,"--chat-container-border-radius":t.borderRadius,"--chat-container-box-shadow":t.boxShadow,"--chat-header-bg-color":a.background,"--chat-header-color-name":a.colorRoomName,"--chat-header-color-info":a.colorRoomInfo,"--chat-footer-bg-color":n.background,"--chat-border-style-input":n.borderStyleInput,"--chat-border-color-input-selected":n.borderInputSelected,"--chat-footer-bg-color-reply":n.backgroundReply,"--chat-footer-bg-color-tag-active":n.backgroundTagActive,"--chat-footer-bg-color-tag":n.backgroundTag,"--chat-content-bg-color":s.background,"--chat-sidemenu-bg-color":d.background,"--chat-sidemenu-bg-color-hover":d.backgroundHover,"--chat-sidemenu-bg-color-active":d.backgroundActive,"--chat-sidemenu-color-active":d.colorActive,"--chat-sidemenu-border-color-search":d.borderColorSearch,"--chat-dropdown-bg-color":k.background,"--chat-dropdown-bg-color-hover":k.backgroundHover,"--chat-message-bg-color":C.background,"--chat-message-bg-color-me":C.backgroundMe,"--chat-message-color-started":C.colorStarted,"--chat-message-bg-color-deleted":C.backgroundDeleted,"--chat-message-bg-color-selected":C.backgroundSelected,"--chat-message-color-deleted":C.colorDeleted,"--chat-message-color-username":C.colorUsername,"--chat-message-color-timestamp":C.colorTimestamp,"--chat-message-bg-color-date":C.backgroundDate,"--chat-message-color-date":C.colorDate,"--chat-message-bg-color-system":C.backgroundSystem,"--chat-message-color-system":C.colorSystem,"--chat-message-color":C.color,"--chat-message-bg-color-media":C.backgroundMedia,"--chat-message-bg-color-reply":C.backgroundReply,"--chat-message-color-reply-username":C.colorReplyUsername,"--chat-message-color-reply-content":C.colorReply,"--chat-message-color-tag":C.colorTag,"--chat-message-bg-color-image":C.backgroundImage,"--chat-message-color-new-messages":C.colorNewMessages,"--chat-message-bg-color-scroll-counter":C.backgroundScrollCounter,"--chat-message-color-scroll-counter":C.colorScrollCounter,"--chat-message-bg-color-reaction":C.backgroundReaction,"--chat-message-border-style-reaction":C.borderStyleReaction,"--chat-message-bg-color-reaction-hover":C.backgroundReactionHover,"--chat-message-border-style-reaction-hover":C.borderStyleReactionHover,"--chat-message-color-reaction-counter":C.colorReactionCounter,"--chat-message-bg-color-reaction-me":C.backgroundReactionMe,"--chat-message-border-style-reaction-me":C.borderStyleReactionMe,"--chat-message-bg-color-reaction-hover-me":C.backgroundReactionHoverMe,"--chat-message-border-style-reaction-hover-me":C.borderStyleReactionHoverMe,"--chat-message-color-reaction-counter-me":C.colorReactionCounterMe,"--chat-message-bg-color-audio-record":C.backgroundAudioRecord,"--chat-message-bg-color-audio-line":C.backgroundAudioLine,"--chat-message-bg-color-audio-progress":C.backgroundAudioProgress,"--chat-message-bg-color-audio-progress-selector":C.backgroundAudioProgressSelector,"--chat-message-color-file-extension":C.colorFileExtension,"--chat-markdown-bg":L.background,"--chat-markdown-border":L.border,"--chat-markdown-color":L.color,"--chat-markdown-color-multi":L.colorMulti,"--chat-room-color-username":b.colorUsername,"--chat-room-color-message":b.colorMessage,"--chat-room-color-timestamp":b.colorTimestamp,"--chat-room-color-online":b.colorStateOnline,"--chat-room-color-offline":b.colorStateOffline,"--chat-room-bg-color-badge":b.backgroundCounterBadge,"--chat-room-color-badge":b.colorCounterBadge,"--chat-emoji-bg-color":R.background,"--chat-icon-color-search":h.search,"--chat-icon-color-add":h.add,"--chat-icon-color-toggle":h.toggle,"--chat-icon-color-menu":h.menu,"--chat-icon-color-close":h.close,"--chat-icon-color-close-image":h.closeImage,"--chat-icon-color-file":h.file,"--chat-icon-color-paperclip":h.paperclip,"--chat-icon-color-close-outline":h.closeOutline,"--chat-icon-color-close-preview":h.closePreview,"--chat-icon-color-send":h.send,"--chat-icon-color-send-disabled":h.sendDisabled,"--chat-icon-color-emoji":h.emoji,"--chat-icon-color-emoji-reaction":h.emojiReaction,"--chat-icon-color-document":h.document,"--chat-icon-color-pencil":h.pencil,"--chat-icon-color-checkmark":h.checkmark,"--chat-icon-color-checkmark-seen":h.checkmarkSeen,"--chat-icon-color-eye":h.eye,"--chat-icon-color-dropdown-message":h.dropdownMessage,"--chat-icon-bg-dropdown-message":h.dropdownMessageBackground,"--chat-icon-color-dropdown-room":h.dropdownRoom,"--chat-icon-color-dropdown-scroll":h.dropdownScroll,"--chat-icon-color-microphone":h.microphone,"--chat-icon-color-audio-play":h.audioPlay,"--chat-icon-color-audio-pause":h.audioPause,"--chat-icon-color-audio-cancel":h.audioCancel,"--chat-icon-color-audio-confirm":h.audioConfirm});var oh=`.vac-fade-spinner-enter-from{opacity:0}.vac-fade-spinner-enter-active{transition:opacity .8s}.vac-fade-spinner-leave-active{transition:opacity .2s;opacity:0}.vac-fade-image-enter-from{opacity:0}.vac-fade-image-enter-active{transition:opacity 1s}.vac-fade-image-leave-active{transition:opacity .5s;opacity:0}.vac-fade-message-enter-from{opacity:0}.vac-fade-message-enter-active{transition:opacity .5s}.vac-fade-message-leave-active{transition:opacity .2s;opacity:0}.vac-slide-left-enter-active,.vac-slide-right-enter-active{transition:all .3s ease;transition-property:transform,opacity}.vac-slide-left-leave-active,.vac-slide-right-leave-active{transition:all .2s cubic-bezier(1,.5,.8,1)!important;transition-property:transform,opacity}.vac-slide-left-enter-from,.vac-slide-left-leave-to{transform:translate(10px);opacity:0}.vac-slide-right-enter-from,.vac-slide-right-leave-to{transform:translate(-10px);opacity:0}.vac-slide-up-enter-active{transition:all .3s ease}.vac-slide-up-leave-active{transition:all .2s cubic-bezier(1,.5,.8,1)}.vac-slide-up-enter-from,.vac-slide-up-leave-to{transform:translateY(10px);opacity:0}.vac-bounce-enter-active{animation:vac-bounce-in .5s}.vac-bounce-leave-active{animation:vac-bounce-in .3s reverse}@keyframes vac-bounce-in{0%{transform:scale(0)}50%{transform:scale(1.05)}to{transform:scale(1)}}.vac-fade-preview-enter{opacity:0}.vac-fade-preview-enter-active{transition:opacity .1s}.vac-fade-preview-leave-active{transition:opacity .2s;opacity:0}.vac-bounce-preview-enter-active{animation:vac-bounce-image-in .4s}.vac-bounce-preview-leave-active{animation:vac-bounce-image-in .3s reverse}@keyframes vac-bounce-image-in{0%{transform:scale(.6)}to{transform:scale(1)}}.vac-menu-list{border-radius:4px;display:block;cursor:pointer;background:var(--chat-dropdown-bg-color);padding:6px 0}.vac-menu-list :hover{background:var(--chat-dropdown-bg-color-hover);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-menu-list :not(:hover){transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-menu-item{-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-ms-flex:1 1 100%;flex:1 1 100%;min-height:30px;padding:5px 16px;position:relative;white-space:nowrap;line-height:30px}.vac-menu-options{position:absolute;right:10px;top:20px;z-index:9999;min-width:150px;display:inline-block;border-radius:4px;font-size:14px;color:var(--chat-color);overflow-y:auto;overflow-x:hidden;contain:content;box-shadow:0 2px 2px -4px #0000001a,0 2px 2px 1px #0000001f,0 1px 8px 1px #0000001f}.vac-app-border{border:var(--chat-border-style)}.vac-app-border-t{border-top:var(--chat-border-style)}.vac-app-border-r{border-right:var(--chat-border-style)}.vac-app-border-b{border-bottom:var(--chat-border-style)}.vac-app-box-shadow{transition:all .5s;box-shadow:0 2px 2px -4px #0000001a,0 2px 2px 1px #0000001f,0 1px 8px 1px #0000001f}.vac-item-clickable{cursor:pointer}.vac-vertical-center{display:flex;align-items:center;height:100%}.vac-vertical-center .vac-vertical-container{width:100%;text-align:center}.vac-svg-button{max-height:30px;display:flex;cursor:pointer;transition:all .2s}.vac-svg-button:hover{transform:scale(1.1);opacity:.7}.vac-avatar{background-size:cover;background-position:center center;background-repeat:no-repeat;background-color:#ddd;height:42px;width:42px;min-height:42px;min-width:42px;margin-right:15px;border-radius:50%}.vac-blur-loading{filter:blur(3px)}.vac-badge-counter{height:13px;width:auto;min-width:13px;border-radius:50%;display:flex;align-items:center;justify-content:center;padding:3px;font-size:11px;font-weight:500}.vac-text-ellipsis{width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.vac-text-bold{font-weight:700}.vac-text-italic{font-style:italic}.vac-text-strike{text-decoration:line-through}.vac-text-underline{text-decoration:underline}.vac-text-inline-code{display:inline-block;font-size:12px;color:var(--chat-markdown-color);background:var(--chat-markdown-bg);border:1px solid var(--chat-markdown-border);border-radius:3px;margin:2px 0;padding:2px 3px}.vac-text-multiline-code{display:block;font-size:12px;color:var(--chat-markdown-color-multi);background:var(--chat-markdown-bg);border:1px solid var(--chat-markdown-border);border-radius:3px;margin:4px 0;padding:7px}.vac-text-tag{color:var(--chat-message-color-tag);cursor:pointer}.vac-file-container{display:flex;align-content:center;justify-content:center;flex-wrap:wrap;text-align:center;background:var(--chat-bg-color-input);border:var(--chat-border-style-input);border-radius:4px;padding:10px}.vac-file-container svg{height:28px;width:28px}.vac-file-container .vac-text-extension{font-size:12px;color:var(--chat-message-color-file-extension);margin-top:-2px}.vac-card-window{width:100%;display:block;max-width:100%;background:var(--chat-content-bg-color);color:var(--chat-color);overflow-wrap:break-word;white-space:normal;border:var(--chat-container-border);border-radius:var(--chat-container-border-radius);box-shadow:var(--chat-container-box-shadow);-webkit-tap-highlight-color:transparent}.vac-card-window *{font-family:inherit}.vac-card-window a{color:#0d579c;font-weight:500}.vac-card-window .vac-chat-container{height:100%;display:flex}.vac-card-window .vac-chat-container input{min-width:10px}.vac-card-window .vac-chat-container textarea,.vac-card-window .vac-chat-container input[type=text],.vac-card-window .vac-chat-container input[type=search]{-webkit-appearance:none}.vac-media-preview{position:fixed;top:0;left:0;z-index:99;width:100vw;height:100vh;display:flex;align-items:center;background-color:#000c;outline:none}.vac-media-preview .vac-media-preview-container{height:calc(100% - 140px);width:calc(100% - 80px);padding:70px 40px;margin:0 auto}.vac-media-preview .vac-image-preview{width:100%;height:100%;background-size:contain;background-repeat:no-repeat;background-position:center}.vac-media-preview .vac-svg-button{position:absolute;top:30px;right:30px;transform:scale(1.4)}@media only screen and (max-width: 768px){.vac-media-preview .vac-svg-button{top:20px;right:20px;transform:scale(1.2)}.vac-media-preview .vac-media-preview-container{width:calc(100% - 40px);padding:70px 20px}}.vac-col-messages{position:relative;height:100%;flex:1;overflow:hidden;display:flex;flex-flow:column}.vac-col-messages .vac-container-center{height:100%;width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}.vac-col-messages .vac-room-empty{font-size:14px;color:#9ca6af;font-style:italic;line-height:20px;white-space:pre-line}.vac-col-messages .vac-room-empty div{padding:0 10%}.vac-col-messages .vac-container-scroll{background:var(--chat-content-bg-color);flex:1;overflow-y:auto;margin-right:1px;margin-top:60px;-webkit-overflow-scrolling:touch}.vac-col-messages .vac-container-scroll.vac-scroll-smooth{scroll-behavior:smooth}.vac-col-messages .vac-messages-container{padding:0 5px 5px}.vac-col-messages .vac-text-started{font-size:14px;color:var(--chat-message-color-started);font-style:italic;text-align:center;margin-top:30px;margin-bottom:20px}.vac-col-messages .vac-icon-scroll{position:absolute;bottom:80px;right:20px;padding:8px;background:var(--chat-bg-scroll-icon);border-radius:50%;box-shadow:0 1px 1px -1px #0003,0 1px 1px #00000024,0 1px 2px #0000001f;display:flex;cursor:pointer;z-index:10}.vac-col-messages .vac-icon-scroll svg{height:25px;width:25px}.vac-col-messages .vac-messages-count{position:absolute;top:-8px;left:11px;background-color:var(--chat-message-bg-color-scroll-counter);color:var(--chat-message-color-scroll-counter)}.vac-col-messages .vac-messages-hidden{opacity:0}@media only screen and (max-width: 768px){.vac-col-messages .vac-container-scroll{margin-top:50px}.vac-col-messages .vac-text-started{margin-top:20px}.vac-col-messages .vac-icon-scroll{bottom:70px}}.vac-room-header{position:absolute;display:flex;align-items:center;height:64px;width:100%;z-index:10;margin-right:1px;background:var(--chat-header-bg-color);border-top-right-radius:var(--chat-container-border-radius)}.vac-room-header .vac-room-wrapper{display:flex;align-items:center;min-width:0;height:100%;width:100%;padding:0 16px}.vac-room-header .vac-toggle-button{margin-right:15px}.vac-room-header .vac-toggle-button svg{height:26px;width:26px}.vac-room-header .vac-rotate-icon{transform:rotate(180deg)!important}.vac-room-header .vac-rotate-icon-init{transform:rotate(360deg)}.vac-room-header .vac-info-wrapper,.vac-room-header .vac-room-selection{display:flex;align-items:center;min-width:0;width:100%;height:100%}.vac-room-header .vac-room-selection .vac-selection-button{padding:8px 16px;color:var(--chat-color-button);background-color:var(--chat-bg-color-button);border-radius:4px;margin-right:10px;cursor:pointer;transition:all .2s}.vac-room-header .vac-room-selection .vac-selection-button:hover{opacity:.7}.vac-room-header .vac-room-selection .vac-selection-button:active{opacity:.9}.vac-room-header .vac-room-selection .vac-selection-button .vac-selection-button-count{margin-left:6px;opacity:.9}.vac-room-header .vac-room-selection .vac-selection-cancel{display:flex;align-items:center;margin-left:auto;white-space:nowrap;color:var(--chat-color-button-clear);transition:all .2s}.vac-room-header .vac-room-selection .vac-selection-cancel:hover{opacity:.7}.vac-room-header .vac-room-name{font-size:17px;font-weight:500;line-height:22px;color:var(--chat-header-color-name)}.vac-room-header .vac-room-info{font-size:13px;line-height:18px;color:var(--chat-header-color-info)}.vac-room-header .vac-room-options{margin-left:auto}@media only screen and (max-width: 768px){.vac-room-header{height:50px}.vac-room-header .vac-room-wrapper{padding:0 10px}.vac-room-header .vac-room-name{font-size:16px;line-height:22px}.vac-room-header .vac-room-info{font-size:12px;line-height:16px}.vac-room-header .vac-avatar{height:37px;width:37px;min-height:37px;min-width:37px}}.vac-room-footer{width:100%;border-bottom-right-radius:4px;z-index:10}.vac-box-footer{display:flex;position:relative;background:var(--chat-footer-bg-color);padding:10px 8px}.vac-textarea{height:20px;width:100%;line-height:20px;overflow:hidden;outline:0;resize:none;border-radius:20px;padding:12px 16px;box-sizing:content-box;font-size:16px;background:var(--chat-bg-color-input);color:var(--chat-color);caret-color:var(--chat-color-caret);border:var(--chat-border-style-input)}.vac-textarea::placeholder{color:var(--chat-color-placeholder);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.vac-textarea-outline{border:1px solid var(--chat-border-color-input-selected);box-shadow:inset 0 0 0 1px var(--chat-border-color-input-selected)}.vac-icon-textarea,.vac-icon-textarea-left{display:flex;align-items:center}.vac-icon-textarea svg,.vac-icon-textarea .vac-wrapper,.vac-icon-textarea-left svg,.vac-icon-textarea-left .vac-wrapper{margin:0 7px}.vac-icon-textarea{margin-left:5px}.vac-icon-textarea-left{display:flex;align-items:center;margin-right:5px}.vac-icon-textarea-left svg,.vac-icon-textarea-left .vac-wrapper{margin:0 7px}.vac-icon-textarea-left .vac-icon-microphone{fill:var(--chat-icon-color-microphone);margin:0 7px}.vac-icon-textarea-left .vac-dot-audio-record{height:15px;width:15px;border-radius:50%;background-color:var(--chat-message-bg-color-audio-record);animation:vac-scaling .8s ease-in-out infinite alternate}@keyframes vac-scaling{0%{transform:scale(1);opacity:.4}to{transform:scale(1.1);opacity:1}}.vac-icon-textarea-left .vac-dot-audio-record-time{font-size:16px;color:var(--chat-color);margin-left:8px;width:45px}.vac-icon-textarea-left .vac-icon-audio-stop,.vac-icon-textarea-left .vac-icon-audio-confirm{min-height:28px;min-width:28px}.vac-icon-textarea-left .vac-icon-audio-stop svg,.vac-icon-textarea-left .vac-icon-audio-confirm svg{min-height:28px;min-width:28px}.vac-icon-textarea-left .vac-icon-audio-stop{margin-right:20px}.vac-icon-textarea-left .vac-icon-audio-stop #vac-icon-close-outline{fill:var(--chat-icon-color-audio-cancel)}.vac-icon-textarea-left .vac-icon-audio-confirm{margin-right:3px;margin-left:12px}.vac-icon-textarea-left .vac-icon-audio-confirm #vac-icon-checkmark{fill:var(--chat-icon-color-audio-confirm)}.vac-send-disabled,.vac-send-disabled svg{cursor:none!important;pointer-events:none!important;transform:none!important}@media only screen and (max-width: 768px){.vac-room-footer{width:100%}.vac-box-footer{padding:7px 2px 7px 7px}.vac-box-footer.vac-box-footer-border{border-top:var(--chat-border-style-input)}.vac-textarea{padding:7px;line-height:18px}.vac-textarea::placeholder{color:transparent}.vac-icon-textarea svg,.vac-icon-textarea .vac-wrapper,.vac-icon-textarea-left svg,.vac-icon-textarea-left .vac-wrapper{margin:0 5px!important}}.vac-emojis-container{width:calc(100% - 16px);padding:10px 8px;background:var(--chat-footer-bg-color);display:flex;align-items:center;overflow:auto}.vac-emojis-container .vac-emoji-element{padding:0 8px;font-size:30px;border-radius:4px;cursor:pointer;background:var(--chat-footer-bg-color-tag);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-emojis-container .vac-emoji-element-active{background:var(--chat-footer-bg-color-tag-active)}@media only screen and (max-width: 768px){.vac-emojis-container{width:calc(100% - 10px);padding:7px 5px}.vac-emojis-container .vac-emoji-element{padding:0 7px;font-size:26px}}.vac-reply-container{display:flex;padding:10px 10px 0;background:var(--chat-footer-bg-color);align-items:center;width:calc(100% - 20px)}.vac-reply-container .vac-reply-box{width:100%;overflow:hidden;background:var(--chat-footer-bg-color-reply);border-radius:4px;padding:8px 10px}.vac-reply-container .vac-reply-info{overflow:hidden}.vac-reply-container .vac-reply-username{color:var(--chat-message-color-reply-username);font-size:12px;line-height:15px;margin-bottom:2px}.vac-reply-container .vac-reply-content{font-size:12px;color:var(--chat-message-color-reply-content);white-space:pre-line}.vac-reply-container .vac-icon-reply{margin-left:10px}.vac-reply-container .vac-icon-reply svg{height:20px;width:20px}.vac-reply-container .vac-image-reply{max-height:100px;max-width:200px;margin:4px 10px 0 0;border-radius:4px}.vac-reply-container .vac-audio-reply{margin-right:10px}.vac-reply-container .vac-file-container{max-width:80px}@media only screen and (max-width: 768px){.vac-reply-container{padding:5px 8px;width:calc(100% - 16px)}}.vac-room-files-container{display:flex;align-items:center;padding:10px 6px 0;background:var(--chat-footer-bg-color)}.vac-room-files-container .vac-files-box{display:flex;overflow:auto;width:calc(100% - 30px)}.vac-room-files-container video{height:100px;border:var(--chat-border-style-input);border-radius:4px}.vac-room-files-container .vac-icon-close{margin-left:auto}.vac-room-files-container .vac-icon-close svg{height:20px;width:20px}@media only screen and (max-width: 768px){.vac-files-container{padding:6px 4px 4px 2px}}.vac-room-file-container{display:flex;position:relative;margin:0 4px}.vac-room-file-container .vac-message-image{position:relative;background-color:var(--chat-message-bg-color-image)!important;background-size:cover!important;background-position:center center!important;background-repeat:no-repeat!important;height:100px;width:100px;border:var(--chat-border-style-input);border-radius:4px}.vac-room-file-container .vac-file-container{height:80px;width:80px}.vac-room-file-container .vac-icon-remove{position:absolute;top:6px;left:6px;z-index:10}.vac-room-file-container .vac-icon-remove svg{height:20px;width:20px;border-radius:50%}.vac-room-file-container .vac-icon-remove:before{content:" ";position:absolute;width:100%;height:100%;background:rgba(0,0,0,.5);border-radius:50%;z-index:-1}.vac-tags-container{display:flex;flex-direction:column;align-items:center;width:100%}.vac-tags-container .vac-tags-box{display:flex;width:100%;height:54px;overflow:hidden;cursor:pointer;background:var(--chat-footer-bg-color-tag);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-tags-container .vac-tags-box-active{background:var(--chat-footer-bg-color-tag-active)}.vac-tags-container .vac-tags-info{display:flex;overflow:hidden;padding:0 20px;align-items:center}.vac-tags-container .vac-tags-avatar{height:34px;width:34px;min-height:34px;min-width:34px}.vac-tags-container .vac-tags-username{font-size:14px}@media only screen and (max-width: 768px){.vac-tags-container .vac-tags-box{height:50px}.vac-tags-container .vac-tags-info{padding:0 12px}}.vac-template-container{display:flex;flex-direction:column;align-items:center;width:100%}.vac-template-container .vac-template-box{display:flex;width:100%;height:54px;overflow:hidden;cursor:pointer;background:var(--chat-footer-bg-color-tag);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-template-container .vac-template-active{background:var(--chat-footer-bg-color-tag-active)}.vac-template-container .vac-template-info{display:flex;overflow:hidden;padding:0 20px;align-items:center}.vac-template-container .vac-template-tag{font-size:14px;font-weight:700;margin-right:10px}.vac-template-container .vac-template-text{font-size:14px}@media only screen and (max-width: 768px){.vac-template-container .vac-template-box{height:50px}.vac-template-container .vac-template-info{padding:0 12px}}.vac-rooms-container{display:flex;flex-flow:column;flex:0 0 25%;min-width:260px;max-width:500px;position:relative;background:var(--chat-sidemenu-bg-color);height:100%;border-top-left-radius:var(--chat-container-border-radius);border-bottom-left-radius:var(--chat-container-border-radius)}.vac-rooms-container.vac-rooms-container-full{flex:0 0 100%;max-width:100%}.vac-rooms-container .vac-rooms-empty{font-size:14px;color:#9ca6af;font-style:italic;text-align:center;margin:40px 0;line-height:20px;white-space:pre-line}.vac-rooms-container .vac-room-list{flex:1;position:relative;max-width:100%;cursor:pointer;padding:0 10px 5px;overflow-y:auto}.vac-rooms-container .vac-room-item{border-radius:8px;align-items:center;display:flex;flex:1 1 100%;margin-bottom:5px;padding:0 14px;position:relative;min-height:71px;transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-rooms-container .vac-room-item:hover{background:var(--chat-sidemenu-bg-color-hover)}.vac-rooms-container .vac-room-selected{color:var(--chat-sidemenu-color-active)!important;background:var(--chat-sidemenu-bg-color-active)!important}.vac-rooms-container .vac-room-selected:hover{background:var(--chat-sidemenu-bg-color-active)!important}@media only screen and (max-width: 768px){.vac-rooms-container .vac-room-list{padding:0 7px 5px}.vac-rooms-container .vac-room-item{min-height:60px;padding:0 8px}}.vac-room-container{display:flex;flex:1;align-items:center;width:100%}.vac-room-container .vac-name-container{flex:1}.vac-room-container .vac-title-container{display:flex;align-items:center;line-height:25px}.vac-room-container .vac-state-circle{width:9px;height:9px;border-radius:50%;background-color:var(--chat-room-color-offline);margin-right:6px;transition:.3s}.vac-room-container .vac-state-online{background-color:var(--chat-room-color-online)}.vac-room-container .vac-room-name{flex:1;color:var(--chat-room-color-username);font-weight:500}.vac-room-container .vac-text-date{margin-left:5px;font-size:11px;color:var(--chat-room-color-timestamp)}.vac-room-container .vac-text-last{display:flex;align-items:center;font-size:12px;line-height:19px;color:var(--chat-room-color-message)}.vac-room-container .vac-message-new{color:var(--chat-room-color-username);font-weight:500}.vac-room-container .vac-icon-check{display:flex;vertical-align:middle;height:14px;width:14px;margin-top:-2px;margin-right:2px}.vac-room-container .vac-icon-microphone{height:15px;width:15px;vertical-align:middle;margin:-3px 1px 0 -2px;fill:var(--chat-room-color-message)}.vac-room-container .vac-room-options-container{display:flex;margin-left:auto}.vac-room-container .vac-room-badge{background-color:var(--chat-room-bg-color-badge);color:var(--chat-room-color-badge);margin-left:5px}.vac-room-container .vac-list-room-options{height:19px;width:19px;align-items:center;margin-left:5px}.vac-box-empty{margin-top:10px}@media only screen and (max-width: 768px){.vac-box-empty{margin-top:7px}}.vac-box-search{position:sticky;display:flex;align-items:center;height:64px;padding:0 15px}.vac-box-search .vac-icon-search{display:flex;position:absolute;left:30px}.vac-box-search .vac-icon-search svg{width:18px;height:18px}.vac-box-search .vac-input{height:38px;width:100%;background:var(--chat-bg-color-input);color:var(--chat-color);font-size:15px;outline:0;caret-color:var(--chat-color-caret);padding:10px 10px 10px 40px;border:1px solid var(--chat-sidemenu-border-color-search);border-radius:20px}.vac-box-search .vac-input::placeholder{color:var(--chat-color-placeholder)}.vac-box-search .vac-add-icon{margin-left:auto;padding-left:10px}@media only screen and (max-width: 768px){.vac-box-search{height:58px}}.vac-message-wrapper .vac-card-info{border-radius:4px;text-align:center;margin:10px auto;font-size:12px;padding:4px;display:block;overflow-wrap:break-word;position:relative;white-space:normal;box-shadow:0 1px 1px -1px #0000001a,0 1px 1px -1px #0000001c,0 1px 2px -1px #0000001c}.vac-message-wrapper .vac-card-date{max-width:150px;font-weight:500;text-transform:uppercase;color:var(--chat-message-color-date);background-color:var(--chat-message-bg-color-date)}.vac-message-wrapper .vac-card-system{max-width:250px;padding:8px 4px;color:var(--chat-message-color-system);background-color:var(--chat-message-bg-color-system)}.vac-message-wrapper .vac-line-new{color:var(--chat-message-color-new-messages);position:relative;text-align:center;font-size:13px;padding:10px 0}.vac-message-wrapper .vac-line-new:after,.vac-message-wrapper .vac-line-new:before{border-top:1px solid var(--chat-message-color-new-messages);content:"";left:0;position:absolute;top:50%;width:calc(50% - 60px)}.vac-message-wrapper .vac-line-new:before{left:auto;right:0}.vac-message-wrapper .vac-message-box{display:flex;flex:0 0 50%;max-width:50%;justify-content:flex-start;line-height:1.4}.vac-message-wrapper .vac-avatar{height:28px;width:28px;min-height:28px;min-width:28px;margin:0 0 2px;align-self:flex-end}.vac-message-wrapper .vac-avatar-current-offset{margin-right:28px}.vac-message-wrapper .vac-avatar-offset{margin-left:28px}.vac-message-wrapper .vac-failure-container{position:relative;align-self:flex-end;height:20px;width:20px;margin:0 0 2px -4px;border-radius:50%;background-color:#f44336}.vac-message-wrapper .vac-failure-container.vac-failure-container-avatar{margin-right:6px}.vac-message-wrapper .vac-failure-container .vac-failure-text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:15px;font-weight:700}.vac-message-wrapper .vac-message-container{position:relative;padding:2px 10px;align-items:end;min-width:100px;box-sizing:content-box}.vac-message-wrapper .vac-message-container-offset{margin-top:10px}.vac-message-wrapper .vac-offset-current{margin-left:50%;justify-content:flex-end}.vac-message-wrapper .vac-message-card{background-color:var(--chat-message-bg-color);color:var(--chat-message-color);border-radius:8px;font-size:14px;padding:6px 9px 3px;white-space:pre-line;max-width:100%;-webkit-transition-property:box-shadow,opacity;transition-property:box-shadow,opacity;transition:box-shadow .28s cubic-bezier(.4,0,.2,1);will-change:box-shadow;box-shadow:0 1px 1px -1px #0000001a,0 1px 1px -1px #0000001c,0 1px 2px -1px #0000001c}.vac-message-wrapper .vac-message-highlight{box-shadow:0 1px 2px -1px #0000001a,0 1px 2px -1px #0000001c,0 1px 5px -1px #0000001c}.vac-message-wrapper .vac-message-current{background-color:var(--chat-message-bg-color-me)!important}.vac-message-wrapper .vac-message-deleted{color:var(--chat-message-color-deleted)!important;font-size:13px!important;font-style:italic!important;background-color:var(--chat-message-bg-color-deleted)!important}.vac-message-wrapper .vac-message-selected{background-color:var(--chat-message-bg-color-selected)!important;transition:background-color .2s}.vac-message-wrapper .vac-icon-deleted{height:14px;width:14px;vertical-align:middle;margin:-2px 2px 0 0;fill:var(--chat-message-color-deleted)}.vac-message-wrapper .vac-message-image{position:relative;background-color:var(--chat-message-bg-color-image)!important;background-size:cover!important;background-position:center center!important;background-repeat:no-repeat!important;height:250px;width:250px;max-width:100%;border-radius:4px;margin:4px auto 5px;transition:.4s filter linear}.vac-message-wrapper .vac-text-username{font-size:13px;color:var(--chat-message-color-username);margin-bottom:2px}.vac-message-wrapper .vac-username-reply{margin-bottom:5px}.vac-message-wrapper .vac-text-timestamp{font-size:10px;color:var(--chat-message-color-timestamp);text-align:right}.vac-message-wrapper .vac-progress-time{float:left;margin:-2px 0 0 40px;color:var(--chat-color);font-size:12px}.vac-message-wrapper .vac-icon-edited{-webkit-box-align:center;align-items:center;display:-webkit-inline-box;display:inline-flex;justify-content:center;letter-spacing:normal;line-height:1;text-indent:0;vertical-align:middle;margin:0 4px 2px}.vac-message-wrapper .vac-icon-edited svg{height:12px;width:12px}.vac-message-wrapper .vac-icon-check{height:14px;width:14px;vertical-align:middle;margin:-3px -3px 0 3px}@media only screen and (max-width: 768px){.vac-message-wrapper .vac-message-container{padding:2px 3px 1px}.vac-message-wrapper .vac-message-container-offset{margin-top:10px}.vac-message-wrapper .vac-message-box{flex:0 0 80%;max-width:80%}.vac-message-wrapper .vac-avatar{height:25px;width:25px;min-height:25px;min-width:25px;margin:0 6px 1px 0}.vac-message-wrapper .vac-avatar.vac-avatar-current{margin:0 0 1px 6px}.vac-message-wrapper .vac-avatar-current-offset{margin-right:31px}.vac-message-wrapper .vac-avatar-offset{margin-left:31px}.vac-message-wrapper .vac-failure-container{margin-left:2px}.vac-message-wrapper .vac-failure-container.vac-failure-container-avatar{margin-right:0}.vac-message-wrapper .vac-offset-current{margin-left:20%}.vac-message-wrapper .vac-progress-time{margin-left:37px}}.vac-audio-player{display:flex;margin:8px 0 5px}.vac-audio-player .vac-svg-button{max-width:18px;margin-left:7px}@media only screen and (max-width: 768px){.vac-audio-player{margin:4px 0 0}.vac-audio-player .vac-svg-button{max-width:16px;margin-left:5px}}.vac-player-bar{display:flex;align-items:center;max-width:calc(100% - 18px);margin-right:7px;margin-left:20px}.vac-player-bar .vac-player-progress{width:190px}.vac-player-bar .vac-player-progress .vac-line-container{position:relative;height:4px;border-radius:5px;background-color:var(--chat-message-bg-color-audio-line)}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-progress{position:absolute;height:inherit;background-color:var(--chat-message-bg-color-audio-progress);border-radius:inherit}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot{position:absolute;top:-5px;margin-left:-7px;height:14px;width:14px;border-radius:50%;background-color:var(--chat-message-bg-color-audio-progress-selector);transition:transform .25s}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot__active{transform:scale(1.2)}@media only screen and (max-width: 768px){.vac-player-bar{margin-right:5px}.vac-player-bar .vac-player-progress .vac-line-container{height:3px}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot{height:12px;width:12px;top:-5px;margin-left:-5px}}.vac-message-actions-wrapper .vac-options-container{position:absolute;top:2px;right:10px;height:40px;width:70px;overflow:hidden;border-top-right-radius:8px}.vac-message-actions-wrapper .vac-blur-container{position:absolute;height:100%;width:100%;left:8px;bottom:10px;background:var(--chat-message-bg-color);filter:blur(3px);border-bottom-left-radius:8px}.vac-message-actions-wrapper .vac-options-me{background:var(--chat-message-bg-color-me)}.vac-message-actions-wrapper .vac-message-options{background:var(--chat-icon-bg-dropdown-message);border-radius:50%;position:absolute;top:7px;right:7px}.vac-message-actions-wrapper .vac-message-options svg{height:17px;width:17px;padding:5px;margin:-5px}.vac-message-actions-wrapper .vac-message-emojis{position:absolute;top:6px;right:30px}.vac-message-actions-wrapper .vac-menu-options{right:15px}.vac-message-actions-wrapper .vac-menu-left{right:-118px}@media only screen and (max-width: 768px){.vac-message-actions-wrapper .vac-options-container{right:3px}.vac-message-actions-wrapper .vac-menu-left{right:-50px}}.vac-message-files-container .vac-file-wrapper{position:relative;width:fit-content}.vac-message-files-container .vac-file-wrapper .vac-file-container{height:60px;width:60px;margin:3px 0 5px;cursor:pointer;transition:all .6s}.vac-message-files-container .vac-file-wrapper .vac-file-container:hover{opacity:.85}.vac-message-files-container .vac-file-wrapper .vac-file-container svg{height:30px;width:30px}.vac-message-files-container .vac-file-wrapper .vac-file-container.vac-file-container-progress{background-color:#0000004d}.vac-message-file-container{position:relative;z-index:0}.vac-message-file-container .vac-message-image-container{cursor:pointer}.vac-message-file-container .vac-image-buttons{position:absolute;width:100%;height:100%;border-radius:4px;background:linear-gradient(to bottom,rgba(0,0,0,0) 55%,rgba(0,0,0,.02) 60%,rgba(0,0,0,.05) 65%,rgba(0,0,0,.1) 70%,rgba(0,0,0,.2) 75%,rgba(0,0,0,.3) 80%,rgba(0,0,0,.5) 85%,rgba(0,0,0,.6) 90%,rgba(0,0,0,.7) 95%,rgba(0,0,0,.8) 100%)}.vac-message-file-container .vac-image-buttons svg{height:26px;width:26px}.vac-message-file-container .vac-image-buttons .vac-button-view,.vac-message-file-container .vac-image-buttons .vac-button-download{position:absolute;bottom:6px;left:7px}.vac-message-file-container .vac-image-buttons :first-child{left:40px}.vac-message-file-container .vac-image-buttons .vac-button-view{max-width:18px;bottom:8px}.vac-message-file-container .vac-video-container{width:350px;max-width:100%;margin:4px auto 5px;cursor:pointer}.vac-message-file-container .vac-video-container video{border-radius:4px}.vac-button-reaction{display:inline-flex;align-items:center;border:var(--chat-message-border-style-reaction);outline:none;background:var(--chat-message-bg-color-reaction);border-radius:4px;margin:4px 2px 0;transition:.3s;padding:0 5px;font-size:18px;line-height:23px}.vac-button-reaction span{font-size:11px;font-weight:500;min-width:7px;color:var(--chat-message-color-reaction-counter)}.vac-button-reaction:hover{border:var(--chat-message-border-style-reaction-hover);background:var(--chat-message-bg-color-reaction-hover);cursor:pointer}.vac-button-reaction.vac-reaction-me{border:var(--chat-message-border-style-reaction-me);background:var(--chat-message-bg-color-reaction-me)}.vac-button-reaction.vac-reaction-me span{color:var(--chat-message-color-reaction-counter-me)}.vac-button-reaction.vac-reaction-me:hover{border:var(--chat-message-border-style-reaction-hover-me);background:var(--chat-message-bg-color-reaction-hover-me)}.vac-reply-message{background:var(--chat-message-bg-color-reply);border-radius:4px;margin:-1px -5px 8px;padding:8px 10px}.vac-reply-message .vac-reply-username{color:var(--chat-message-color-reply-username);font-size:12px;line-height:15px;margin-bottom:2px}.vac-reply-message .vac-image-reply-container{width:70px}.vac-reply-message .vac-image-reply-container .vac-message-image-reply{height:70px;width:70px;margin:4px auto 3px}.vac-reply-message .vac-video-reply-container{width:200px;max-width:100%}.vac-reply-message .vac-video-reply-container video{border-radius:4px}.vac-reply-message .vac-reply-content{font-size:12px;color:var(--chat-message-color-reply-content)}.vac-reply-message .vac-file-container{height:60px;width:60px}.vac-emoji-wrapper{position:relative;display:flex}.vac-emoji-wrapper .vac-emoji-reaction svg{height:19px;width:19px}.vac-emoji-wrapper .vac-emoji-picker{position:absolute;z-index:9999;bottom:32px;right:10px;width:300px;padding-top:4px;overflow:scroll;box-sizing:border-box;border-radius:.5rem;background:var(--chat-emoji-bg-color);box-shadow:0 1px 2px -2px #0000001a,0 1px 2px -1px #0000001a,0 1px 2px 1px #0000001a;scrollbar-width:none}.vac-emoji-wrapper .vac-emoji-picker::-webkit-scrollbar{display:none}.vac-emoji-wrapper .vac-emoji-picker.vac-picker-reaction{position:fixed;top:initial;right:initial}.vac-emoji-wrapper .vac-emoji-picker emoji-picker{height:100%;width:100%;--emoji-size: 1.2rem;--background: var(--chat-emoji-bg-color);--emoji-padding: .4rem;--border-color: var(--chat-sidemenu-border-color-search);--button-hover-background: var(--chat-sidemenu-bg-color-hover);--button-active-background: var(--chat-sidemenu-bg-color-hover)}.vac-format-message-wrapper .vac-format-container{display:inline}.vac-format-message-wrapper .vac-icon-deleted{height:14px;width:14px;vertical-align:middle;margin:-3px 1px 0 0;fill:var(--chat-room-color-message)}.vac-format-message-wrapper .vac-image-link-container{background-color:var(--chat-message-bg-color-media);padding:8px;margin:2px auto;border-radius:4px}.vac-format-message-wrapper .vac-image-link{position:relative;background-color:var(--chat-message-bg-color-image)!important;background-size:contain;background-position:center center!important;background-repeat:no-repeat!important;height:150px;width:150px;max-width:100%;border-radius:4px;margin:0 auto}.vac-format-message-wrapper .vac-image-link-message{max-width:166px;font-size:12px}.vac-loader-wrapper.vac-container-center{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:9}.vac-loader-wrapper.vac-container-top{padding:21px}.vac-loader-wrapper.vac-container-top #vac-circle{height:20px;width:20px}.vac-loader-wrapper #vac-circle{margin:auto;height:28px;width:28px;border:3px rgba(0,0,0,.25) solid;border-top:3px var(--chat-color-spinner) solid;border-right:3px var(--chat-color-spinner) solid;border-bottom:3px var(--chat-color-spinner) solid;border-radius:50%;-webkit-animation:vac-spin 1s infinite linear;animation:vac-spin 1s infinite linear}@media only screen and (max-width: 768px){.vac-loader-wrapper #vac-circle{height:24px;width:24px}.vac-loader-wrapper.vac-container-top{padding:18px}.vac-loader-wrapper.vac-container-top #vac-circle{height:16px;width:16px}}@-webkit-keyframes vac-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@keyframes vac-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}#vac-icon-search{fill:var(--chat-icon-color-search)}#vac-icon-add{fill:var(--chat-icon-color-add)}#vac-icon-toggle{fill:var(--chat-icon-color-toggle)}#vac-icon-menu{fill:var(--chat-icon-color-menu)}#vac-icon-close{fill:var(--chat-icon-color-close)}#vac-icon-close-image{fill:var(--chat-icon-color-close-image)}#vac-icon-file{fill:var(--chat-icon-color-file)}#vac-icon-paperclip{fill:var(--chat-icon-color-paperclip)}#vac-icon-close-outline{fill:var(--chat-icon-color-close-outline)}#vac-icon-close-outline-preview{fill:var(--chat-icon-color-close-preview)}#vac-icon-send{fill:var(--chat-icon-color-send)}#vac-icon-send-disabled{fill:var(--chat-icon-color-send-disabled)}#vac-icon-emoji{fill:var(--chat-icon-color-emoji)}#vac-icon-emoji-reaction{fill:var(--chat-icon-color-emoji-reaction)}#vac-icon-document{fill:var(--chat-icon-color-document)}#vac-icon-pencil{fill:var(--chat-icon-color-pencil)}#vac-icon-checkmark,#vac-icon-double-checkmark{fill:var(--chat-icon-color-checkmark)}#vac-icon-checkmark-seen,#vac-icon-double-checkmark-seen{fill:var(--chat-icon-color-checkmark-seen)}#vac-icon-eye{fill:var(--chat-icon-color-eye)}#vac-icon-dropdown-message{fill:var(--chat-icon-color-dropdown-message)}#vac-icon-dropdown-room{fill:var(--chat-icon-color-dropdown-room)}#vac-icon-dropdown-scroll{fill:var(--chat-icon-color-dropdown-scroll)}#vac-icon-audio-play{fill:var(--chat-icon-color-audio-play)}#vac-icon-audio-pause{fill:var(--chat-icon-color-audio-pause)}.vac-progress-wrapper{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:9}.vac-progress-wrapper circle{transition:stroke-dashoffset .35s;transform:rotate(-90deg);transform-origin:50% 50%}.vac-progress-wrapper .vac-progress-content{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:-1;margin-top:-2px;background-color:#000000b3;border-radius:50%}.vac-progress-wrapper .vac-progress-content .vac-progress-text{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-weight:700;color:#fff}.vac-progress-wrapper .vac-progress-content .vac-progress-text .vac-progress-pourcent{font-size:9px;font-weight:400}
`;const sh={name:"ChatContainer",components:{RoomsList:w0,Room:X2,MediaPreview:eh},props:{height:{type:String,default:"600px"},theme:{type:String,default:"light"},styles:{type:[Object,String],default:()=>({})},responsiveBreakpoint:{type:Number,default:900},singleRoom:{type:[Boolean,String],default:!1},roomsListOpened:{type:[Boolean,String],default:!0},textMessages:{type:[Object,String],default:null},currentUserId:{type:String,default:""},rooms:{type:[Array,String],default:null},roomsOrder:{type:String,default:"desc"},loadingRooms:{type:[Boolean,String],default:!1},roomsLoaded:{type:[Boolean,String],default:!1},roomId:{type:String,default:null},loadFirstRoom:{type:[Boolean,String],default:!0},messages:{type:[Array,String],default:null},messagesLoaded:{type:[Boolean,String],default:!1},roomActions:{type:Array,default:()=>[]},menuActions:{type:Array,default:()=>[]},messageActions:{type:Array,default:()=>[{name:"replyMessage",title:"Reply"},{name:"editMessage",title:"Edit Message",onlyMe:!0},{name:"deleteMessage",title:"Delete Message",onlyMe:!0},{name:"selectMessages",title:"Select"}]},messageSelectionActions:{type:Array,default:()=>[]},autoScroll:{type:Object,default:()=>({send:{new:!0,newAfterScrollUp:!0},receive:{new:!0,newAfterScrollUp:!1}})},showSearch:{type:[Boolean,String],default:!0},showAddRoom:{type:[Boolean,String],default:!0},showSendIcon:{type:[Boolean,String],default:!0},showFiles:{type:[Boolean,String],default:!0},showAudio:{type:[Boolean,String],default:!0},audioBitRate:{type:Number,default:128},audioSampleRate:{type:Number,default:44100},showEmojis:{type:[Boolean,String],default:!0},showReactionEmojis:{type:[Boolean,String],default:!0},showNewMessagesDivider:{type:[Boolean,String],default:!0},showFooter:{type:[Boolean,String],default:!0},textFormatting:{type:Object,default:()=>({disabled:!1,italic:"_",bold:"*",strike:"~",underline:"\xB0",multilineCode:"```",inlineCode:"`"})},linkOptions:{type:Object,default:()=>({disabled:!1,target:"_blank",rel:null})},roomInfoEnabled:{type:[Boolean,String],default:!1},textareaActionEnabled:{type:[Boolean,String],default:!1},textareaAutoFocus:{type:[Boolean,String],default:!0},userTagsEnabled:{type:[Boolean,String],default:!0},emojisSuggestionEnabled:{type:[Boolean,String],default:!0},roomMessage:{type:String,default:""},scrollDistance:{type:Number,default:60},acceptedFiles:{type:String,default:"*"},templatesText:{type:[Array,String],default:null},mediaPreviewEnabled:{type:[Boolean,String],default:!0},usernameOptions:{type:Object,default:()=>({minUsers:3,currentUser:!1})}},emits:["toggle-rooms-list","room-info","fetch-messages","send-message","edit-message","delete-message","open-file","open-user-tag","open-failed-message","menu-action-handler","message-action-handler","send-message-reaction","typing-message","textarea-action-handler","fetch-more-rooms","add-room","room-action-handler","message-selection-action-handler"],data(){return{room:{},loadingMoreRooms:!1,showRoomsList:!0,isMobile:!1,showMediaPreview:!1,previewFile:{}}},computed:{t(){return{...th,...this.textMessages}},cssVars(){const e=ah[this.theme],t={};return Object.keys(e).map(a=>{t[a]={...e[a],...this.styles[a]||{}}}),rh(t)},orderedRooms(){return this.roomsCasted.slice().sort((e,t)=>{const a=e.index||0,n=t.index||0;return this.roomsOrder==="asc"?a<n?-1:n<a?1:0:a>n?-1:n>a?1:0})},roomsCasted(){return this.rooms||[]},messagesCasted(){return this.messages||[]},singleRoomCasted(){return this.castBooleanToString(this.singleRoom)},roomsListOpenedCasted(){return this.castBooleanToString(this.roomsListOpened)},loadingRoomsCasted(){return this.castBooleanToString(this.loadingRooms)},roomsLoadedCasted(){return this.castBooleanToString(this.roomsLoaded)},loadFirstRoomCasted(){return this.castBooleanToString(this.loadFirstRoom)},messagesLoadedCasted(){return this.castBooleanToString(this.messagesLoaded)},showSearchCasted(){return this.castBooleanToString(this.showSearch)},showAddRoomCasted(){return this.castBooleanToString(this.showAddRoom)},showSendIconCasted(){return this.castBooleanToString(this.showSendIcon)},showFilesCasted(){return this.castBooleanToString(this.showFiles)},showAudioCasted(){return this.castBooleanToString(this.showAudio)},showEmojisCasted(){return this.castBooleanToString(this.showEmojis)},showReactionEmojisCasted(){return this.castBooleanToString(this.showReactionEmojis)},showNewMessagesDividerCasted(){return this.castBooleanToString(this.showNewMessagesDivider)},showFooterCasted(){return this.castBooleanToString(this.showFooter)},roomInfoEnabledCasted(){return this.castBooleanToString(this.roomInfoEnabled)},textareaActionEnabledCasted(){return this.castBooleanToString(this.textareaActionEnabled)},textareaAutoFocusCasted(){return this.castBooleanToString(this.textareaAutoFocus)},userTagsEnabledCasted(){return this.castBooleanToString(this.userTagsEnabled)},emojisSuggestionEnabledCasted(){return this.castBooleanToString(this.emojisSuggestionEnabled)},mediaPreviewEnabledCasted(){return this.castBooleanToString(this.mediaPreviewEnabled)}},watch:{rooms:{immediate:!0,deep:!0,handler(e,t){if((!e[0]||!e.find(a=>a.roomId===this.room.roomId))&&(this.showRoomsList=!0),!this.loadingMoreRooms&&this.loadFirstRoomCasted&&e[0]&&(!t||e.length!==t.length))if(this.roomId){const a=e.find(n=>n.roomId===this.roomId)||{};this.fetchRoom({room:a})}else!this.isMobile||this.singleRoomCasted?this.fetchRoom({room:this.orderedRooms[0]}):this.showRoomsList=!0}},loadingRoomsCasted(e){e&&(this.room={})},roomId:{immediate:!0,handler(e,t){if(e&&!this.loadingRoomsCasted&&this.roomsCasted.length){const a=this.roomsCasted.find(n=>n.roomId===e);this.fetchRoom({room:a})}else t&&!e&&(this.room={})}},room(e){!e||Object.entries(e).length===0||(b2(e),e.users.forEach(t=>{y2(t)}))},roomsListOpenedCasted(e){this.showRoomsList=e}},created(){this.updateResponsive(),window.addEventListener("resize",e=>{e.isTrusted&&this.updateResponsive()})},methods:{castBooleanToString(e){return e==="true"||e===!0},updateResponsive(){this.isMobile=window.innerWidth<Number(this.responsiveBreakpoint)},toggleRoomsList(){this.showRoomsList=!this.showRoomsList,this.isMobile&&(this.room={}),this.$emit("toggle-rooms-list",{opened:this.showRoomsList})},fetchRoom({room:e}){this.room=e,this.fetchMessages({reset:!0}),this.isMobile&&(this.showRoomsList=!1)},fetchMoreRooms(){this.$emit("fetch-more-rooms")},roomInfo(){this.$emit("room-info",this.room)},addRoom(){this.$emit("add-room")},fetchMessages(e){this.$emit("fetch-messages",{room:this.room,options:e})},sendMessage(e){this.$emit("send-message",{...e,roomId:this.room.roomId})},editMessage(e){this.$emit("edit-message",{...e,roomId:this.room.roomId})},deleteMessage(e){this.$emit("delete-message",{message:e,roomId:this.room.roomId})},openFile({message:e,file:t}){this.mediaPreviewEnabledCasted&&t.action==="preview"?(this.previewFile=t.file,this.showMediaPreview=!0):this.$emit("open-file",{message:e,file:t})},openUserTag({user:e}){this.$emit("open-user-tag",{user:e})},openFailedMessage({message:e}){this.$emit("open-failed-message",{message:e,roomId:this.room.roomId})},menuActionHandler(e){this.$emit("menu-action-handler",{action:e,roomId:this.room.roomId})},roomActionHandler({action:e,roomId:t}){this.$emit("room-action-handler",{action:e,roomId:t})},messageActionHandler(e){this.$emit("message-action-handler",{...e,roomId:this.room.roomId})},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",{...e,roomId:this.room.roomId})},sendMessageReaction(e){this.$emit("send-message-reaction",{...e,roomId:this.room.roomId})},typingMessage(e){this.$emit("typing-message",{message:e,roomId:this.room.roomId})},textareaActionHandler(e){this.$emit("textarea-action-handler",{message:e,roomId:this.room.roomId})}}},nh={class:"vac-chat-container"};function ih(e,t,a,n,d,s){const k=r.resolveComponent("rooms-list"),C=r.resolveComponent("room"),L=r.resolveComponent("media-preview");return r.openBlock(),r.createElementBlock("div",{class:"vac-card-window",style:r.normalizeStyle([{height:a.height},s.cssVars])},[r.createElementVNode("div",nh,[s.singleRoomCasted?r.createCommentVNode("",!0):(r.openBlock(),r.createBlock(k,{key:0,"current-user-id":a.currentUserId,rooms:s.orderedRooms,"loading-rooms":s.loadingRoomsCasted,"rooms-loaded":s.roomsLoadedCasted,room:d.room,"room-actions":a.roomActions,"text-messages":s.t,"show-search":s.showSearchCasted,"show-add-room":s.showAddRoomCasted,"show-rooms-list":d.showRoomsList,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"is-mobile":d.isMobile,"scroll-distance":a.scrollDistance,onFetchRoom:s.fetchRoom,onFetchMoreRooms:s.fetchMoreRooms,onLoadingMoreRooms:t[0]||(t[0]=b=>d.loadingMoreRooms=b),onAddRoom:s.addRoom,onRoomActionHandler:s.roomActionHandler},r.createSlots({_:2},[r.renderList(e.$slots,(b,R)=>({name:R,fn:r.withCtx(h=>[r.renderSlot(e.$slots,R,r.normalizeProps(r.guardReactiveProps(h)))])}))]),1032,["current-user-id","rooms","loading-rooms","rooms-loaded","room","room-actions","text-messages","show-search","show-add-room","show-rooms-list","text-formatting","link-options","is-mobile","scroll-distance","onFetchRoom","onFetchMoreRooms","onAddRoom","onRoomActionHandler"])),r.createVNode(C,{"current-user-id":a.currentUserId,rooms:s.roomsCasted,"room-id":d.room.roomId||"","load-first-room":s.loadFirstRoomCasted,messages:s.messagesCasted,"room-message":a.roomMessage,"messages-loaded":s.messagesLoadedCasted,"menu-actions":a.menuActions,"message-actions":a.messageActions,"message-selection-actions":a.messageSelectionActions,"auto-scroll":a.autoScroll,"show-send-icon":s.showSendIconCasted,"show-files":s.showFilesCasted,"show-audio":s.showAudioCasted,"audio-bit-rate":a.audioBitRate,"audio-sample-rate":a.audioSampleRate,"show-emojis":s.showEmojisCasted,"show-reaction-emojis":s.showReactionEmojisCasted,"show-new-messages-divider":s.showNewMessagesDividerCasted,"show-footer":s.showFooterCasted,"text-messages":s.t,"single-room":s.singleRoomCasted,"show-rooms-list":d.showRoomsList,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"is-mobile":d.isMobile,"loading-rooms":s.loadingRoomsCasted,"room-info-enabled":s.roomInfoEnabledCasted,"textarea-action-enabled":s.textareaActionEnabledCasted,"textarea-auto-focus":s.textareaAutoFocusCasted,"user-tags-enabled":s.userTagsEnabledCasted,"emojis-suggestion-enabled":s.emojisSuggestionEnabledCasted,"scroll-distance":a.scrollDistance,"accepted-files":a.acceptedFiles,"templates-text":a.templatesText,"username-options":a.usernameOptions,onToggleRoomsList:s.toggleRoomsList,onRoomInfo:s.roomInfo,onFetchMessages:s.fetchMessages,onSendMessage:s.sendMessage,onEditMessage:s.editMessage,onDeleteMessage:s.deleteMessage,onOpenFile:s.openFile,onOpenUserTag:s.openUserTag,onOpenFailedMessage:s.openFailedMessage,onMenuActionHandler:s.menuActionHandler,onMessageActionHandler:s.messageActionHandler,onMessageSelectionActionHandler:s.messageSelectionActionHandler,onSendMessageReaction:s.sendMessageReaction,onTypingMessage:s.typingMessage,onTextareaActionHandler:s.textareaActionHandler},r.createSlots({_:2},[r.renderList(e.$slots,(b,R)=>({name:R,fn:r.withCtx(h=>[r.renderSlot(e.$slots,R,r.normalizeProps(r.guardReactiveProps(h)))])}))]),1032,["current-user-id","rooms","room-id","load-first-room","messages","room-message","messages-loaded","menu-actions","message-actions","message-selection-actions","auto-scroll","show-send-icon","show-files","show-audio","audio-bit-rate","audio-sample-rate","show-emojis","show-reaction-emojis","show-new-messages-divider","show-footer","text-messages","single-room","show-rooms-list","text-formatting","link-options","is-mobile","loading-rooms","room-info-enabled","textarea-action-enabled","textarea-auto-focus","user-tags-enabled","emojis-suggestion-enabled","scroll-distance","accepted-files","templates-text","username-options","onToggleRoomsList","onRoomInfo","onFetchMessages","onSendMessage","onEditMessage","onDeleteMessage","onOpenFile","onOpenUserTag","onOpenFailedMessage","onMenuActionHandler","onMessageActionHandler","onMessageSelectionActionHandler","onSendMessageReaction","onTypingMessage","onTextareaActionHandler"])]),r.createVNode(r.Transition,{name:"vac-fade-preview",appear:""},{default:r.withCtx(()=>[d.showMediaPreview?(r.openBlock(),r.createBlock(L,{key:0,file:d.previewFile,onCloseMediaPreview:t[1]||(t[1]=b=>d.showMediaPreview=!1)},null,8,["file"])):r.createCommentVNode("",!0)]),_:1})],4)}var lh=Ye(sh,[["render",ih],["styles",[oh]]]);const li=r.defineCustomElement(lh);function ch(){customElements.define("vue-advanced-chat",li)}aa.VueAdvancedChat=li,aa.register=ch,Object.defineProperties(aa,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
