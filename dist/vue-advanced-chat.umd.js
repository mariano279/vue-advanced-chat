(function(r,Kr){typeof exports=="object"&&typeof module!="undefined"?Kr(require("vue")):typeof define=="function"&&define.amd?define(["vue"],Kr):(r=typeof globalThis!="undefined"?globalThis:r||self,Kr(r.Vue))})(this,function(r){"use strict";var Kr="",ze=(e,t)=>{const a=e.__vccOpts||e;for(const[n,m]of t)a[n]=m;return a};const b0={name:"AppLoader",props:{show:{type:Boolean,default:!1},infinite:{type:Boolean,default:!1}}},y0=r.createElementVNode("div",{id:"vac-circle"},null,-1);function x0(e,t,a,n,m,s){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-fade-spinner",appear:""},{default:r.withCtx(()=>[a.show?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-loader-wrapper",{"vac-container-center":!a.infinite,"vac-container-top":a.infinite}])},[r.renderSlot(e.$slots,"spinner-icon",r.normalizeProps(r.guardReactiveProps({show:a.show,infinite:a.infinite})),()=>[y0])],2)):r.createCommentVNode("",!0)]),_:3})}var Zr=ze(b0,[["render",x0]]);const w0={name:"SvgIcon",props:{name:{type:String,default:null},param:{type:String,default:null}},data(){return{svgItem:{search:{path:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"},add:{path:"M17,13H13V17H11V13H7V11H11V7H13V11H17M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"},toggle:{path:"M5,13L9,17L7.6,18.42L1.18,12L7.6,5.58L9,7L5,11H21V13H5M21,6V8H11V6H21M21,16V18H11V16H21Z"},menu:{path:"M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z"},close:{path:"M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z"},file:{path:"M14,17H7V15H14M17,13H7V11H17M17,9H7V7H17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z"},paperclip:{path:"M16.5,6V17.5A4,4 0 0,1 12.5,21.5A4,4 0 0,1 8.5,17.5V5A2.5,2.5 0 0,1 11,2.5A2.5,2.5 0 0,1 13.5,5V15.5A1,1 0 0,1 12.5,16.5A1,1 0 0,1 11.5,15.5V6H10V15.5A2.5,2.5 0 0,0 12.5,18A2.5,2.5 0 0,0 15,15.5V5A4,4 0 0,0 11,1A4,4 0 0,0 7,5V17.5A5.5,5.5 0 0,0 12.5,23A5.5,5.5 0 0,0 18,17.5V6H16.5Z"},"close-outline":{path:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},send:{path:"M2,21L23,12L2,3V10L17,12L2,14V21Z"},emoji:{path:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"},document:{path:"M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"},pencil:{path:"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"},checkmark:{path:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"},"double-checkmark":{path:"M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z"},eye:{path:"M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"},dropdown:{path:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"},deleted:{path:"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12C4,13.85 4.63,15.55 5.68,16.91L16.91,5.68C15.55,4.63 13.85,4 12,4M12,20A8,8 0 0,0 20,12C20,10.15 19.37,8.45 18.32,7.09L7.09,18.32C8.45,19.37 10.15,20 12,20Z"},microphone:{size:"large",path:"M432.8,216.4v39.2c0,45.2-15.3,84.3-45.2,118.4c-29.8,33.2-67.3,52.8-111.6,57.9v40.9h78.4c5.1,0,10.2,1.7,13.6,6c4.3,4.3,6,8.5,6,13.6c0,5.1-1.7,10.2-6,13.6c-4.3,4.3-8.5,6-13.6,6H157.6c-5.1,0-10.2-1.7-13.6-6c-4.3-4.3-6-8.5-6-13.6c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6H236v-40.9c-44.3-5.1-81.8-23.9-111.6-57.9s-45.2-73.3-45.2-118.4v-39.2c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6s10.2,1.7,13.6,6c4.3,4.3,6,8.5,6,13.6v39.2c0,37.5,13.6,70.7,40,97.1s59.6,40,97.1,40s70.7-13.6,97.1-40c26.4-26.4,40-59.6,40-97.1v-39.2c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6c5.1,0,10.2,1.7,13.6,6C430.2,206.2,432.8,211.3,432.8,216.4z M353.5,98v157.6c0,27.3-9.4,50.3-29,69c-19.6,19.6-42.6,29-69,29s-50.3-9.4-69-29c-19.6-19.6-29-42.6-29-69V98c0-27.3,9.4-50.3,29-69c19.6-19.6,42.6-29,69-29s50.3,9.4,69,29C344.2,47.7,353.5,71.6,353.5,98z"},"audio-play":{size:"medium",path:"M43.331,21.237L7.233,0.397c-0.917-0.529-2.044-0.529-2.96,0c-0.916,0.528-1.48,1.505-1.48,2.563v41.684   c0,1.058,0.564,2.035,1.48,2.563c0.458,0.268,0.969,0.397,1.48,0.397c0.511,0,1.022-0.133,1.48-0.397l36.098-20.84   c0.918-0.529,1.479-1.506,1.479-2.564S44.247,21.767,43.331,21.237z"},"audio-pause":{size:"medium",path:"M17.991,40.976c0,3.662-2.969,6.631-6.631,6.631l0,0c-3.662,0-6.631-2.969-6.631-6.631V6.631C4.729,2.969,7.698,0,11.36,0l0,0c3.662,0,6.631,2.969,6.631,6.631V40.976z",path2:"M42.877,40.976c0,3.662-2.969,6.631-6.631,6.631l0,0c-3.662,0-6.631-2.969-6.631-6.631V6.631C29.616,2.969,32.585,0,36.246,0l0,0c3.662,0,6.631,2.969,6.631,6.631V40.976z"}}}},computed:{svgId(){const e=this.param?"-"+this.param:"";return`vac-icon-${this.name}${e}`},size(){const e=this.svgItem[this.name];return e.size==="large"?512:e.size==="medium"?48:24}}},k0=["viewBox"],S0=["id","d"],E0=["id","d"];function M0(e,t,a,n,m,s){return r.openBlock(),r.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",width:"24",height:"24",viewBox:`0 0 ${s.size} ${s.size}`},[r.createElementVNode("path",{id:s.svgId,d:m.svgItem[a.name].path},null,8,S0),m.svgItem[a.name].path2?(r.openBlock(),r.createElementBlock("path",{key:0,id:s.svgId,d:m.svgItem[a.name].path2},null,8,E0)):r.createCommentVNode("",!0)],8,k0)}var vt=ze(w0,[["render",M0]]);const R0={name:"RoomsSearch",components:{SvgIcon:vt},props:{textMessages:{type:Object,required:!0},showSearch:{type:Boolean,required:!0},showAddRoom:{type:Boolean,required:!0},rooms:{type:Array,required:!0},loadingRooms:{type:Boolean,required:!0}},emits:["search-room","add-room"],computed:{showSearchBar(){return this.showSearch||this.showAddRoom}}},A0={key:0,class:"vac-icon-search"},T0=["placeholder"];function B0(e,t,a,n,m,s){const S=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",{class:r.normalizeClass({"vac-box-search":s.showSearchBar,"vac-box-empty":!s.showSearchBar})},[a.showSearch?(r.openBlock(),r.createElementBlock(r.Fragment,{key:0},[!a.loadingRooms&&a.rooms.length?(r.openBlock(),r.createElementBlock("div",A0,[r.renderSlot(e.$slots,"search-icon",{},()=>[r.createVNode(S,{name:"search"})])])):r.createCommentVNode("",!0),!a.loadingRooms&&a.rooms.length?(r.openBlock(),r.createElementBlock("input",{key:1,type:"search",placeholder:a.textMessages.SEARCH,autocomplete:"off",class:"vac-input",onInput:t[0]||(t[0]=A=>e.$emit("search-room",A))},null,40,T0)):r.createCommentVNode("",!0)],64)):r.createCommentVNode("",!0),a.showAddRoom?(r.openBlock(),r.createElementBlock("div",{key:1,class:"vac-svg-button vac-add-icon",onClick:t[1]||(t[1]=A=>e.$emit("add-room"))},[r.renderSlot(e.$slots,"add-icon",{},()=>[r.createVNode(S,{name:"add"})])])):r.createCommentVNode("",!0)],2)}var C0=ze(R0,[["render",B0]]),gt={},Ya={};Ya.__esModule=!0,Ya.inherits=O0;function O0(e,t){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=Object.create(e.prototype);for(var m in a)n[m]=a[m];return n.constructor=t,t.prototype=n,t}var hr={};hr.__esModule=!0;var L0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},It={defaultProtocol:"http",events:null,format:Ys,formatHref:Ys,nl2br:!1,tagName:"a",target:I0,validate:!0,ignoreTags:[],attributes:null,className:"linkified"};hr.defaults=It,hr.Options=Xs,hr.contains=N0;function Xs(e){e=e||{},this.defaultProtocol=e.hasOwnProperty("defaultProtocol")?e.defaultProtocol:It.defaultProtocol,this.events=e.hasOwnProperty("events")?e.events:It.events,this.format=e.hasOwnProperty("format")?e.format:It.format,this.formatHref=e.hasOwnProperty("formatHref")?e.formatHref:It.formatHref,this.nl2br=e.hasOwnProperty("nl2br")?e.nl2br:It.nl2br,this.tagName=e.hasOwnProperty("tagName")?e.tagName:It.tagName,this.target=e.hasOwnProperty("target")?e.target:It.target,this.validate=e.hasOwnProperty("validate")?e.validate:It.validate,this.ignoreTags=[],this.attributes=e.attributes||e.linkAttributes||It.attributes,this.className=e.hasOwnProperty("className")?e.className:e.linkClass||It.className;for(var t=e.hasOwnProperty("ignoreTags")?e.ignoreTags:It.ignoreTags,a=0;a<t.length;a++)this.ignoreTags.push(t[a].toUpperCase())}Xs.prototype={resolve:function(t){var a=t.toHref(this.defaultProtocol);return{formatted:this.get("format",t.toString(),t),formattedHref:this.get("formatHref",a,t),tagName:this.get("tagName",a,t),className:this.get("className",a,t),target:this.get("target",a,t),events:this.getObject("events",a,t),attributes:this.getObject("attributes",a,t)}},check:function(t){return this.get("validate",t.toString(),t)},get:function(t,a,n){var m=void 0,s=this[t];if(!s)return s;switch(typeof s=="undefined"?"undefined":L0(s)){case"function":return s(a,n.type);case"object":return m=s.hasOwnProperty(n.type)?s[n.type]:It[t],typeof m=="function"?m(a,n.type):m}return s},getObject:function(t,a,n){var m=this[t];return typeof m=="function"?m(a,n.type):m}};function N0(e,t){for(var a=0;a<e.length;a++)if(e[a]===t)return!0;return!1}function Ys(e){return e}function I0(e,t){return t==="url"?"_blank":null}var ea={},ca={};ca.__esModule=!0,ca.stateify=ca.TokenState=ca.CharacterState=void 0;var Gs=Ya;function Fo(){return function(e){this.j=[],this.T=e||null}}var Do=Fo();Do.prototype={defaultTransition:!1,on:function(t,a){if(t instanceof Array){for(var n=0;n<t.length;n++)this.j.push([t[n],a]);return this}return this.j.push([t,a]),this},next:function(t){for(var a=0;a<this.j.length;a++){var n=this.j[a],m=n[0],s=n[1];if(this.test(t,m))return s}return this.defaultTransition},accepts:function(){return!!this.T},test:function(t,a){return t===a},emit:function(){return this.T}};var Uo=(0,Gs.inherits)(Do,Fo(),{test:function(t,a){return t===a||a instanceof RegExp&&a.test(t)}}),V0=(0,Gs.inherits)(Do,Fo(),{jump:function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=this.next(new t(""));return n===this.defaultTransition?(n=new this.constructor(a),this.on(t,n)):a&&(n.T=a),n},test:function(t,a){return t instanceof a}});function j0(e,t,a,n){for(var m=0,s=e.length,S=t,A=[],O=void 0;m<s&&(O=S.next(e[m]));)S=O,m++;if(m>=s)return[];for(;m<s-1;)O=new Uo(n),A.push(O),S.on(e[m],O),S=O,m++;return O=new Uo(a),A.push(O),S.on(e[s-1],O),A}ca.CharacterState=Uo,ca.TokenState=V0,ca.stateify=j0;var xe={},Wr={};Wr.__esModule=!0;function H0(){return function(e){e&&(this.v=e)}}Wr.createTokenClass=H0,xe.__esModule=!0,xe.AMPERSAND=xe.CLOSEPAREN=xe.CLOSEANGLEBRACKET=xe.CLOSEBRACKET=xe.CLOSEBRACE=xe.OPENPAREN=xe.OPENANGLEBRACKET=xe.OPENBRACKET=xe.OPENBRACE=xe.WS=xe.TLD=xe.SYM=xe.UNDERSCORE=xe.SLASH=xe.MAILTO=xe.PROTOCOL=xe.QUERY=xe.POUND=xe.PLUS=xe.NUM=xe.NL=xe.LOCALHOST=xe.PUNCTUATION=xe.DOT=xe.COLON=xe.AT=xe.DOMAIN=xe.Base=void 0;var Ks=Wr,P0=Ya,zo=(0,Ks.createTokenClass)();zo.prototype={toString:function(){return this.v+""}};function qe(e){var t=e?{v:e}:{};return(0,P0.inherits)(zo,(0,Ks.createTokenClass)(),t)}var F0=qe(),D0=qe("@"),U0=qe(":"),z0=qe("."),q0=qe(),X0=qe(),Y0=qe(`
`),G0=qe(),K0=qe("+"),Z0=qe("#"),W0=qe(),Q0=qe("mailto:"),$0=qe("?"),J0=qe("/"),el=qe("_"),tl=qe(),al=qe(),rl=qe(),ol=qe("{"),sl=qe("["),nl=qe("<"),il=qe("("),ll=qe("}"),cl=qe("]"),dl=qe(">"),ml=qe(")"),hl=qe("&");xe.Base=zo,xe.DOMAIN=F0,xe.AT=D0,xe.COLON=U0,xe.DOT=z0,xe.PUNCTUATION=q0,xe.LOCALHOST=X0,xe.NL=Y0,xe.NUM=G0,xe.PLUS=K0,xe.POUND=Z0,xe.QUERY=$0,xe.PROTOCOL=W0,xe.MAILTO=Q0,xe.SLASH=J0,xe.UNDERSCORE=el,xe.SYM=tl,xe.TLD=al,xe.WS=rl,xe.OPENBRACE=ol,xe.OPENBRACKET=sl,xe.OPENANGLEBRACKET=nl,xe.OPENPAREN=il,xe.CLOSEBRACE=ll,xe.CLOSEBRACKET=cl,xe.CLOSEANGLEBRACKET=dl,xe.CLOSEPAREN=ml,xe.AMPERSAND=hl,ea.__esModule=!0,ea.start=ea.run=ea.TOKENS=ea.State=void 0;var pa=ca,Le=xe,ul=fl(Le);function fl(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}var Zs="aaa|aarp|abarth|abb|abbott|abbvie|abc|able|abogado|abudhabi|ac|academy|accenture|accountant|accountants|aco|active|actor|ad|adac|ads|adult|ae|aeg|aero|aetna|af|afamilycompany|afl|africa|ag|agakhan|agency|ai|aig|aigo|airbus|airforce|airtel|akdn|al|alfaromeo|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|am|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|ao|aol|apartments|app|apple|aq|aquarelle|ar|arab|aramco|archi|army|arpa|art|arte|as|asda|asia|associates|at|athleta|attorney|au|auction|audi|audible|audio|auspost|author|auto|autos|avianca|aw|aws|ax|axa|az|azure|ba|baby|baidu|banamex|bananarepublic|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bb|bbc|bbt|bbva|bcg|bcn|bd|be|beats|beauty|beer|bentley|berlin|best|bestbuy|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|blanco|blockbuster|blog|bloomberg|blue|bm|bms|bmw|bn|bnl|bnpparibas|bo|boats|boehringer|bofa|bom|bond|boo|book|booking|boots|bosch|bostik|boston|bot|boutique|box|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|budapest|bugatti|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|calvinklein|cam|camera|camp|cancerresearch|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|cartier|casa|case|caseih|cash|casino|cat|catering|catholic|cba|cbn|cbre|cbs|cc|cd|ceb|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|chase|chat|cheap|chintai|chloe|christmas|chrome|chrysler|church|ci|cipriani|circle|cisco|citadel|citi|citic|city|cityeats|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|comcast|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cookingchannel|cool|coop|corsica|country|coupon|coupons|courses|cr|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|csc|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|data|date|dating|datsun|day|dclk|dds|de|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dj|dk|dm|dnp|do|docs|doctor|dodge|dog|doha|domains|dot|download|drive|dtv|dubai|duck|dunlop|duns|dupont|durban|dvag|dvr|dz|earth|eat|ec|eco|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epost|epson|equipment|er|ericsson|erni|es|esq|estate|esurance|et|etisalat|eu|eurovision|eus|events|everbank|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fi|fiat|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|flir|florist|flowers|fly|fm|fo|foo|food|foodnetwork|football|ford|forex|forsale|forum|foundation|fox|fr|free|fresenius|frl|frogans|frontdoor|frontier|ftr|fujitsu|fujixerox|fun|fund|furniture|futbol|fyi|ga|gal|gallery|gallo|gallup|game|games|gap|garden|gb|gbiz|gd|gdn|ge|gea|gent|genting|george|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glade|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|godaddy|gold|goldpoint|golf|goo|goodhands|goodyear|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|grocery|group|gs|gt|gu|guardian|gucci|guge|guide|guitars|guru|gw|gy|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hgtv|hiphop|hisamitsu|hitachi|hiv|hk|hkt|hm|hn|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|honeywell|horse|hospital|host|hosting|hot|hoteles|hotels|hotmail|house|how|hr|hsbc|ht|htc|hu|hughes|hyatt|hyundai|ibm|icbc|ice|icu|id|ie|ieee|ifm|ikano|il|im|imamat|imdb|immo|immobilien|in|industries|infiniti|info|ing|ink|institute|insurance|insure|int|intel|international|intuit|investments|io|ipiranga|iq|ir|irish|is|iselect|ismaili|ist|istanbul|it|itau|itv|iveco|iwc|jaguar|java|jcb|jcp|je|jeep|jetzt|jewelry|jio|jlc|jll|jm|jmp|jnj|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|juniper|kaufen|kddi|ke|kerryhotels|kerrylogistics|kerryproperties|kfh|kg|kh|ki|kia|kim|kinder|kindle|kitchen|kiwi|km|kn|koeln|komatsu|kosher|kp|kpmg|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|ladbrokes|lamborghini|lamer|lancaster|lancia|lancome|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|li|liaison|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|linde|link|lipsy|live|living|lixil|lk|loan|loans|locker|locus|loft|lol|london|lotte|lotto|love|lpl|lplfinancial|lr|ls|lt|ltd|ltda|lu|lundbeck|lupin|luxe|luxury|lv|ly|ma|macys|madrid|maif|maison|makeup|man|management|mango|map|market|marketing|markets|marriott|marshalls|maserati|mattel|mba|mc|mckinsey|md|me|med|media|meet|melbourne|meme|memorial|men|menu|meo|merckmsd|metlife|mg|mh|miami|microsoft|mil|mini|mint|mit|mitsubishi|mk|ml|mlb|mls|mm|mma|mn|mo|mobi|mobile|mobily|moda|moe|moi|mom|monash|money|monster|mopar|mormon|mortgage|moscow|moto|motorcycles|mov|movie|movistar|mp|mq|mr|ms|msd|mt|mtn|mtr|mu|museum|mutual|mv|mw|mx|my|mz|na|nab|nadex|nagoya|name|nationwide|natura|navy|nba|nc|ne|nec|net|netbank|netflix|network|neustar|new|newholland|news|next|nextdirect|nexus|nf|nfl|ng|ngo|nhk|ni|nico|nike|nikon|ninja|nissan|nissay|nl|no|nokia|northwesternmutual|norton|now|nowruz|nowtv|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|observer|off|office|okinawa|olayan|olayangroup|oldnavy|ollo|om|omega|one|ong|onl|online|onyourside|ooo|open|oracle|orange|org|organic|origins|osaka|otsuka|ott|ovh|pa|page|panasonic|panerai|paris|pars|partners|parts|party|passagens|pay|pccw|pe|pet|pf|pfizer|pg|ph|pharmacy|phd|philips|phone|photo|photography|photos|physio|piaget|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pnc|pohl|poker|politie|porn|post|pr|pramerica|praxi|press|prime|pro|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|qvc|racing|radio|raid|re|read|realestate|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|rightathome|ril|rio|rip|rmit|ro|rocher|rocks|rodeo|rogers|room|rs|rsvp|ru|rugby|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sapo|sarl|sas|save|saxo|sb|sbi|sbs|sc|sca|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scjohnson|scor|scot|sd|se|search|seat|secure|security|seek|select|sener|services|ses|seven|sew|sex|sexy|sfr|sg|sh|shangrila|sharp|shaw|shell|shia|shiksha|shoes|shop|shopping|shouji|show|showtime|shriram|si|silk|sina|singles|site|sj|sk|ski|skin|sky|skype|sl|sling|sm|smart|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|space|spiegel|spot|spreadbetting|sr|srl|srt|st|stada|staples|star|starhub|statebank|statefarm|statoil|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiftcover|swiss|sx|sy|sydney|symantec|systems|sz|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|tdk|team|tech|technology|tel|telecity|telefonica|temasek|tennis|teva|tf|tg|th|thd|theater|theatre|tiaa|tickets|tienda|tiffany|tips|tires|tirol|tj|tjmaxx|tjx|tk|tkmaxx|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tr|trade|trading|training|travel|travelchannel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubank|ubs|uconnect|ug|uk|unicom|university|uno|uol|ups|us|uy|uz|va|vacations|vana|vanguard|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|vista|vistaprint|viva|vivo|vlaanderen|vn|vodka|volkswagen|volvo|vote|voting|voto|voyage|vu|vuelos|wales|walmart|walter|wang|wanggou|warman|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|ws|wtc|wtf|xbox|xerox|xfinity|xihuan|xin|xn--11b4c3d|xn--1ck2e1b|xn--1qqw23a|xn--2scrj9c|xn--30rr7y|xn--3bst00m|xn--3ds443g|xn--3e0b707e|xn--3hcrj9c|xn--3oq18vl8pn36a|xn--3pxu8k|xn--42c2d9a|xn--45br5cyl|xn--45brj9c|xn--45q11c|xn--4gbrim|xn--54b7fta0cc|xn--55qw42g|xn--55qx5d|xn--5su34j936bgsg|xn--5tzm5g|xn--6frz82g|xn--6qq986b3xl|xn--80adxhks|xn--80ao21a|xn--80aqecdr1a|xn--80asehdb|xn--80aswg|xn--8y0a063a|xn--90a3ac|xn--90ae|xn--90ais|xn--9dbq2a|xn--9et52u|xn--9krt00a|xn--b4w605ferd|xn--bck1b9a5dre4c|xn--c1avg|xn--c2br7g|xn--cck2b3b|xn--cg4bki|xn--clchc0ea0b2g2a9gcd|xn--czr694b|xn--czrs0t|xn--czru2d|xn--d1acj3b|xn--d1alf|xn--e1a4c|xn--eckvdtc9d|xn--efvy88h|xn--estv75g|xn--fct429k|xn--fhbei|xn--fiq228c5hs|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--fjq720a|xn--flw351e|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--fzys8d69uvgm|xn--g2xx48c|xn--gckr3f0f|xn--gecrj9c|xn--gk3at1e|xn--h2breg3eve|xn--h2brj9c|xn--h2brj9c8c|xn--hxt814e|xn--i1b6b1a6a2e|xn--imr513n|xn--io0a7i|xn--j1aef|xn--j1amh|xn--j6w193g|xn--jlq61u9w7b|xn--jvr189m|xn--kcrx77d1x4a|xn--kprw13d|xn--kpry57d|xn--kpu716f|xn--kput3i|xn--l1acc|xn--lgbbat1ad8j|xn--mgb9awbf|xn--mgba3a3ejt|xn--mgba3a4f16a|xn--mgba7c0bbn0a|xn--mgbaakc7dvf|xn--mgbaam7a8h|xn--mgbab2bd|xn--mgbai9azgqp6j|xn--mgbayh7gpa|xn--mgbb9fbpob|xn--mgbbh1a|xn--mgbbh1a71e|xn--mgbc0a9azcg|xn--mgbca7dzdo|xn--mgberp4a5d4ar|xn--mgbgu82a|xn--mgbi4ecexp|xn--mgbpl2fh|xn--mgbt3dhd|xn--mgbtx2b|xn--mgbx4cd0ab|xn--mix891f|xn--mk1bu44c|xn--mxtq1m|xn--ngbc5azd|xn--ngbe9e0a|xn--ngbrx|xn--node|xn--nqv7f|xn--nqv7fs00ema|xn--nyqy26a|xn--o3cw4h|xn--ogbpf8fl|xn--p1acf|xn--p1ai|xn--pbt977c|xn--pgbs0dh|xn--pssy2u|xn--q9jyb4c|xn--qcka1pmc|xn--qxam|xn--rhqv96g|xn--rovu88b|xn--rvc1e0am3e|xn--s9brj9c|xn--ses554g|xn--t60b56a|xn--tckwe|xn--tiq49xqyj|xn--unup4y|xn--vermgensberater-ctb|xn--vermgensberatung-pwb|xn--vhquv|xn--vuq861b|xn--w4r85el8fhu5dnra|xn--w4rs40l|xn--wgbh1c|xn--wgbl6a|xn--xhq521b|xn--xkc2al3hye2a|xn--xkc2dl3a5ee0h|xn--y9a3aq|xn--yfro4i67o|xn--ygbi2ammx|xn--zfr164b|xperia|xxx|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|you|youtube|yt|yun|za|zappos|zara|zero|zip|zippo|zm|zone|zuerich|zw".split("|"),qo="0123456789".split(""),Qr="0123456789abcdefghijklmnopqrstuvwxyz".split(""),Ws=[" ","\f","\r","	","\v","\xA0","\u1680","\u180E"],Et=[],De=function(t){return new pa.CharacterState(t)},zt=De(),Xo=De(Le.NUM),Ga=De(Le.DOMAIN),ur=De(),Yo=De(Le.WS);zt.on("@",De(Le.AT)).on(".",De(Le.DOT)).on("+",De(Le.PLUS)).on("#",De(Le.POUND)).on("?",De(Le.QUERY)).on("/",De(Le.SLASH)).on("_",De(Le.UNDERSCORE)).on(":",De(Le.COLON)).on("{",De(Le.OPENBRACE)).on("[",De(Le.OPENBRACKET)).on("<",De(Le.OPENANGLEBRACKET)).on("(",De(Le.OPENPAREN)).on("}",De(Le.CLOSEBRACE)).on("]",De(Le.CLOSEBRACKET)).on(">",De(Le.CLOSEANGLEBRACKET)).on(")",De(Le.CLOSEPAREN)).on("&",De(Le.AMPERSAND)).on([",",";","!",'"',"'"],De(Le.PUNCTUATION)),zt.on(`
`,De(Le.NL)).on(Ws,Yo),Yo.on(Ws,Yo);for(var Go=0;Go<Zs.length;Go++){var _l=(0,pa.stateify)(Zs[Go],zt,Le.TLD,Le.DOMAIN);Et.push.apply(Et,_l)}var Qs=(0,pa.stateify)("file",zt,Le.DOMAIN,Le.DOMAIN),$s=(0,pa.stateify)("ftp",zt,Le.DOMAIN,Le.DOMAIN),Js=(0,pa.stateify)("http",zt,Le.DOMAIN,Le.DOMAIN),en=(0,pa.stateify)("mailto",zt,Le.DOMAIN,Le.DOMAIN);Et.push.apply(Et,Qs),Et.push.apply(Et,$s),Et.push.apply(Et,Js),Et.push.apply(Et,en);var pl=Qs.pop(),vl=$s.pop(),gl=Js.pop(),bl=en.pop(),$r=De(Le.DOMAIN),Jr=De(Le.PROTOCOL),yl=De(Le.MAILTO);vl.on("s",$r).on(":",Jr),gl.on("s",$r).on(":",Jr),Et.push($r),pl.on(":",Jr),$r.on(":",Jr),bl.on(":",yl);var xl=(0,pa.stateify)("localhost",zt,Le.LOCALHOST,Le.DOMAIN);Et.push.apply(Et,xl),zt.on(qo,Xo),Xo.on("-",ur).on(qo,Xo).on(Qr,Ga),Ga.on("-",ur).on(Qr,Ga);for(var Ko=0;Ko<Et.length;Ko++)Et[Ko].on("-",ur).on(Qr,Ga);ur.on("-",ur).on(qo,Ga).on(Qr,Ga),zt.defaultTransition=De(Le.SYM);var wl=function(t){for(var a=t.replace(/[A-Z]/g,function(y){return y.toLowerCase()}),n=t.length,m=[],s=0;s<n;){for(var S=zt,A=null,O=0,v=null,N=-1;s<n&&(A=S.next(a[s]));)S=A,S.accepts()?(N=0,v=S):N>=0&&N++,O++,s++;if(!(N<0)){s-=N,O-=N;var f=v.emit();m.push(new f(t.substr(s-O,O)))}}return m},kl=zt;ea.State=pa.CharacterState,ea.TOKENS=ul,ea.run=wl,ea.start=kl;var ta={},Rt={};Rt.__esModule=!0,Rt.URL=Rt.TEXT=Rt.NL=Rt.EMAIL=Rt.MAILTOEMAIL=Rt.Base=void 0;var Ka=Wr,fr=Ya,_r=xe;function Sl(e){return e instanceof _r.DOMAIN||e instanceof _r.TLD}var wa=(0,Ka.createTokenClass)();wa.prototype={type:"token",isLink:!1,toString:function(){for(var t=[],a=0;a<this.v.length;a++)t.push(this.v[a].toString());return t.join("")},toHref:function(){return this.toString()},toObject:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http";return{type:this.type,value:this.toString(),href:this.toHref(t)}}};var El=(0,fr.inherits)(wa,(0,Ka.createTokenClass)(),{type:"email",isLink:!0}),Ml=(0,fr.inherits)(wa,(0,Ka.createTokenClass)(),{type:"email",isLink:!0,toHref:function(){return"mailto:"+this.toString()}}),Rl=(0,fr.inherits)(wa,(0,Ka.createTokenClass)(),{type:"text"}),Al=(0,fr.inherits)(wa,(0,Ka.createTokenClass)(),{type:"nl"}),Tl=(0,fr.inherits)(wa,(0,Ka.createTokenClass)(),{type:"url",isLink:!0,toHref:function(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http",a=!1,n=!1,m=this.v,s=[],S=0;m[S]instanceof _r.PROTOCOL;)a=!0,s.push(m[S].toString().toLowerCase()),S++;for(;m[S]instanceof _r.SLASH;)n=!0,s.push(m[S].toString()),S++;for(;Sl(m[S]);)s.push(m[S].toString().toLowerCase()),S++;for(;S<m.length;S++)s.push(m[S].toString());return s=s.join(""),a||n||(s=t+"://"+s),s},hasProtocol:function(){return this.v[0]instanceof _r.PROTOCOL}});Rt.Base=wa,Rt.MAILTOEMAIL=El,Rt.EMAIL=Ml,Rt.NL=Al,Rt.TEXT=Rl,Rt.URL=Tl,ta.__esModule=!0,ta.start=ta.run=ta.TOKENS=ta.State=void 0;var tn=ca,At=Rt,Bl=Cl(At),ue=xe;function Cl(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}var Ne=function(t){return new tn.TokenState(t)},eo=Ne(),an=Ne(),rn=Ne(),Zo=Ne(),on=Ne(),va=Ne(),to=Ne(),pr=Ne(At.URL),sn=Ne(),nn=Ne(At.URL),Je=Ne(At.URL),vr=Ne(),gr=Ne(),br=Ne(),yr=Ne(),xr=Ne(),ka=Ne(At.URL),Sa=Ne(At.URL),Ea=Ne(At.URL),Ma=Ne(At.URL),wr=Ne(),kr=Ne(),Sr=Ne(),Er=Ne(),Za=Ne(),Wo=Ne(),ao=Ne(At.EMAIL),ln=Ne(),Ol=Ne(At.EMAIL),Ra=Ne(At.MAILTOEMAIL),Qo=Ne(),Wa=Ne(),ro=Ne(),cn=Ne(),Ll=Ne(At.NL);eo.on(ue.NL,Ll).on(ue.PROTOCOL,an).on(ue.MAILTO,rn).on(ue.SLASH,Zo),an.on(ue.SLASH,Zo),Zo.on(ue.SLASH,on),eo.on(ue.TLD,va).on(ue.DOMAIN,va).on(ue.LOCALHOST,pr).on(ue.NUM,va),on.on(ue.TLD,Je).on(ue.DOMAIN,Je).on(ue.NUM,Je).on(ue.LOCALHOST,Je),va.on(ue.DOT,to),Za.on(ue.DOT,Wo),to.on(ue.TLD,pr).on(ue.DOMAIN,va).on(ue.NUM,va).on(ue.LOCALHOST,va),Wo.on(ue.TLD,ao).on(ue.DOMAIN,Za).on(ue.NUM,Za).on(ue.LOCALHOST,Za),pr.on(ue.DOT,to),ao.on(ue.DOT,Wo),pr.on(ue.COLON,sn).on(ue.SLASH,Je),sn.on(ue.NUM,nn),nn.on(ue.SLASH,Je),ao.on(ue.COLON,ln),ln.on(ue.NUM,Ol);var bt=[ue.DOMAIN,ue.AT,ue.LOCALHOST,ue.NUM,ue.PLUS,ue.POUND,ue.PROTOCOL,ue.SLASH,ue.TLD,ue.UNDERSCORE,ue.SYM,ue.AMPERSAND],yt=[ue.COLON,ue.DOT,ue.QUERY,ue.PUNCTUATION,ue.CLOSEBRACE,ue.CLOSEBRACKET,ue.CLOSEANGLEBRACKET,ue.CLOSEPAREN,ue.OPENBRACE,ue.OPENBRACKET,ue.OPENANGLEBRACKET,ue.OPENPAREN];Je.on(ue.OPENBRACE,gr).on(ue.OPENBRACKET,br).on(ue.OPENANGLEBRACKET,yr).on(ue.OPENPAREN,xr),vr.on(ue.OPENBRACE,gr).on(ue.OPENBRACKET,br).on(ue.OPENANGLEBRACKET,yr).on(ue.OPENPAREN,xr),gr.on(ue.CLOSEBRACE,Je),br.on(ue.CLOSEBRACKET,Je),yr.on(ue.CLOSEANGLEBRACKET,Je),xr.on(ue.CLOSEPAREN,Je),ka.on(ue.CLOSEBRACE,Je),Sa.on(ue.CLOSEBRACKET,Je),Ea.on(ue.CLOSEANGLEBRACKET,Je),Ma.on(ue.CLOSEPAREN,Je),wr.on(ue.CLOSEBRACE,Je),kr.on(ue.CLOSEBRACKET,Je),Sr.on(ue.CLOSEANGLEBRACKET,Je),Er.on(ue.CLOSEPAREN,Je),gr.on(bt,ka),br.on(bt,Sa),yr.on(bt,Ea),xr.on(bt,Ma),gr.on(yt,wr),br.on(yt,kr),yr.on(yt,Sr),xr.on(yt,Er),ka.on(bt,ka),Sa.on(bt,Sa),Ea.on(bt,Ea),Ma.on(bt,Ma),ka.on(yt,ka),Sa.on(yt,Sa),Ea.on(yt,Ea),Ma.on(yt,Ma),wr.on(bt,ka),kr.on(bt,Sa),Sr.on(bt,Ea),Er.on(bt,Ma),wr.on(yt,wr),kr.on(yt,kr),Sr.on(yt,Sr),Er.on(yt,Er),Je.on(bt,Je),vr.on(bt,Je),Je.on(yt,vr),vr.on(yt,vr),rn.on(ue.TLD,Ra).on(ue.DOMAIN,Ra).on(ue.NUM,Ra).on(ue.LOCALHOST,Ra),Ra.on(bt,Ra).on(yt,Qo),Qo.on(bt,Ra).on(yt,Qo);var Mr=[ue.DOMAIN,ue.NUM,ue.PLUS,ue.POUND,ue.QUERY,ue.UNDERSCORE,ue.SYM,ue.AMPERSAND,ue.TLD];va.on(Mr,Wa).on(ue.AT,ro),pr.on(Mr,Wa).on(ue.AT,ro),to.on(Mr,Wa),Wa.on(Mr,Wa).on(ue.AT,ro).on(ue.DOT,cn),cn.on(Mr,Wa),ro.on(ue.TLD,Za).on(ue.DOMAIN,Za).on(ue.LOCALHOST,ao);var Nl=function(t){for(var a=t.length,n=0,m=[],s=[];n<a;){for(var S=eo,A=null,O=null,v=0,N=null,f=-1;n<a&&!(A=S.next(t[n]));)s.push(t[n++]);for(;n<a&&(O=A||S.next(t[n]));)A=null,S=O,S.accepts()?(f=0,N=S):f>=0&&f++,n++,v++;if(f<0)for(var y=n-v;y<n;y++)s.push(t[y]);else{s.length>0&&(m.push(new At.TEXT(s)),s=[]),n-=f,v-=f;var k=N.emit();m.push(new k(t.slice(n-v,n)))}}return s.length>0&&m.push(new At.TEXT(s)),m};ta.State=tn.TokenState,ta.TOKENS=Bl,ta.run=Nl,ta.start=eo,gt.__esModule=!0,gt.tokenize=gt.test=gt.scanner=gt.parser=gt.options=gt.inherits=gt.find=void 0;var Il=Ya,Vl=hr,jl=$o(Vl),Hl=ea,dn=$o(Hl),Pl=ta,mn=$o(Pl);function $o(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"});var Jo=function(t){return mn.run(dn.run(t))},Fl=function(t){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=Jo(t),m=[],s=0;s<n.length;s++){var S=n[s];S.isLink&&(!a||S.type===a)&&m.push(S.toObject())}return m},Dl=function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=Jo(t);return n.length===1&&n[0].isLink&&(!a||n[0].type===a)};gt.find=Fl,gt.inherits=Il.inherits,gt.options=jl,gt.parser=mn,gt.scanner=dn,gt.test=Dl,gt.tokenize=Jo;var hn=gt,Ul=(e,t,a)=>{const n={bold:a.bold,italic:a.italic,strike:a.strike,underline:a.underline,multilineCode:a.multilineCode,inlineCode:a.inlineCode},m={[n.bold]:{end:"\\"+n.bold,allowed_chars:".",type:"bold"},[n.italic]:{end:n.italic,allowed_chars:".",type:"italic"},[n.strike]:{end:n.strike,allowed_chars:".",type:"strike"},[n.underline]:{end:n.underline,allowed_chars:".",type:"underline"},[n.multilineCode]:{end:n.multilineCode,allowed_chars:`(.|
)`,type:"multiline-code"},[n.inlineCode]:{end:n.inlineCode,allowed_chars:".",type:"inline-code"},"<usertag>":{allowed_chars:".",end:"</usertag>",type:"tag"}},s=oo(e,m),S=zl(s,m),A=[].concat.apply([],S);return t&&Xl(A),A};function oo(e,t){let a=[],n=-1,m=null,s=hn.find(e),S=!1;if(s.length>0&&(n=e.indexOf(s[0].value),S=!0),Object.keys(t).forEach(A=>{const O=e.indexOf(A);O>=0&&(n<0||O<n)&&(n=O,m=A,S=!1)}),S&&m!==-1){let A=e.substr(0,n),O=e.substr(n,s[0].value.length),v=e.substr(n+s[0].value.length);return a.push(A),a.push(O),a=a.concat(oo(v,t)),a}if(m){let A=e.substr(0,n);const O=m;let v=e.substr(n+O.length);if(e.replace(/\s/g,"").length===O.length*2)return[e];const N=v.match(new RegExp("^("+(t[O].allowed_chars||".")+"*"+(t[O].end?"?":"")+")"+(t[O].end?"("+t[O].end+")":""),"m"));if(!N||!N[1])A=A+O,a.push(A);else{A&&a.push(A);const f={start:O,content:oo(N[1],t),end:N[2],type:t[O].type};a.push(f),v=v.substr(N[0].length)}return a=a.concat(oo(v,t)),a}else return e?[e]:[]}function zl(e,t){const a=[];return e.forEach(n=>{typeof n=="string"?a.push({types:[],value:n}):t[n.start]&&a.push(ql(n))}),a}function ql(e){const t=[];return un(e,t,[]),t}function un(e,t,a){e.content.forEach(n=>{typeof n=="string"?t.push({types:fn(a.concat([e.type])),value:n}):un(n,t,fn([n.type].concat([e.type]).concat(a)))})}function fn(e){return[...new Set(e)]}function Xl(e){const t=[];return e.forEach(a=>{const n=hn.find(a.value);if(n.length){const m=a.value.replace(n[0].value,"");t.push({types:a.types,value:m}),a.types=["url"].concat(a.types),a.href=n[0].href,a.value=n[0].value}t.push(a)}),t}const es=["png","jpg","jpeg","webp","svg","gif"],_n=["mp4","video/ogg","webm","quicktime"],Yl=["mp3","audio/ogg","wav","mpeg"],Gl={name:"FormatMessage",components:{SvgIcon:vt},props:{content:{type:[String,Number],required:!0},deleted:{type:Boolean,default:!1},users:{type:Array,default:()=>[]},linkify:{type:Boolean,default:!0},singleLine:{type:Boolean,default:!1},reply:{type:Boolean,default:!1},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0}},emits:["open-user-tag"],computed:{linkifiedMessage(){const e=Ul(this.formatTags(this.content),this.linkify&&!this.linkOptions.disabled,this.textFormatting);return e.forEach(t=>{t.url=this.checkType(t,"url"),t.bold=this.checkType(t,"bold"),t.italic=this.checkType(t,"italic"),t.strike=this.checkType(t,"strike"),t.underline=this.checkType(t,"underline"),t.inline=this.checkType(t,"inline-code"),t.multiline=this.checkType(t,"multiline-code"),t.tag=this.checkType(t,"tag"),t.image=this.checkImageType(t),t.value=this.replaceEmojiByElement(t.value)}),e},formattedContent(){return this.formatTags(this.content)}},methods:{checkType(e,t){return e.types.indexOf(t)!==-1},checkImageType(e){let t=e.value.lastIndexOf(".");e.value.lastIndexOf("/")>t&&(t=-1);const n=e.value.substring(t+1,e.value.length),m=t>0&&es.some(s=>n.toLowerCase().includes(s));return m&&this.setImageSize(e),m},setImageSize(e){const t=new Image;t.src=e.value,t.addEventListener("load",a);function a(n){const m=n.path[0].width/150;e.height=Math.round(n.path[0].height/m)+"px",t.removeEventListener("load",a)}},formatTags(e){const t="<usertag>",a="</usertag>",n=[...e.matchAll(new RegExp(t,"gi"))].map(s=>s.index),m=e;return n.forEach(s=>{const S=m.substring(s+t.length,m.indexOf(a,s)),A=this.users.find(O=>O._id===S);e=e.replaceAll(S,`@${(A==null?void 0:A.username)||"unknown"}`)}),e},openTag(e){if(!this.singleLine&&this.checkType(e,"tag")){const t=this.users.find(a=>e.value.indexOf(a.username)!==-1);this.$emit("open-user-tag",t)}},replaceEmojiByElement(e){let t;return this.singleLine?t=16:t=this.containsOnlyEmojis()?28:20,e.replaceAll(/[\p{Extended_Pictographic}\u{1F3FB}-\u{1F3FF}\u{1F9B0}-\u{1F9B3}]/gu,a=>`<span style="font-size: ${t}px">${a}</span>`)},containsOnlyEmojis(){const e=this.content.replace(new RegExp("[\0-\u1EEFf]","g"),""),t=this.content.replace(new RegExp(`[
\rs]+|( )+`,"g"),"");return e.length===t.length}}},Kl={class:"vac-image-link-container"},Zl={class:"vac-image-link-message"},Wl=["innerHTML"],Ql=["innerHTML"];function $l(e,t,a,n,m,s){const S=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",{class:r.normalizeClass(["vac-format-message-wrapper",{"vac-text-ellipsis":a.singleLine}])},[a.textFormatting.disabled?(r.openBlock(),r.createElementBlock("div",{key:1,innerHTML:s.formattedContent},null,8,Ql)):(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass({"vac-text-ellipsis":a.singleLine})},[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(s.linkifiedMessage,(A,O)=>(r.openBlock(),r.createElementBlock("div",{key:O,class:"vac-format-container"},[(r.openBlock(),r.createBlock(r.resolveDynamicComponent(A.url?"a":"span"),{class:r.normalizeClass({"vac-text-ellipsis":a.singleLine,"vac-text-bold":A.bold,"vac-text-italic":a.deleted||A.italic,"vac-text-strike":A.strike,"vac-text-underline":A.underline,"vac-text-inline-code":!a.singleLine&&A.inline,"vac-text-multiline-code":!a.singleLine&&A.multiline,"vac-text-tag":!a.singleLine&&!a.reply&&A.tag}),href:A.href,target:A.href?a.linkOptions.target:null,rel:A.href?a.linkOptions.rel:null,onClick:v=>s.openTag(A)},{default:r.withCtx(()=>[r.renderSlot(e.$slots,"deleted-icon",r.normalizeProps(r.guardReactiveProps({deleted:a.deleted})),()=>[a.deleted?(r.openBlock(),r.createBlock(S,{key:0,name:"deleted",class:"vac-icon-deleted"})):r.createCommentVNode("",!0)]),A.url&&A.image?(r.openBlock(),r.createElementBlock(r.Fragment,{key:0},[r.createElementVNode("div",Kl,[r.createElementVNode("div",{class:"vac-image-link",style:r.normalizeStyle({"background-image":`url('${A.value}')`,height:A.height})},null,4)]),r.createElementVNode("div",Zl,[r.createElementVNode("span",null,r.toDisplayString(A.value),1)])],64)):(r.openBlock(),r.createElementBlock("span",{key:1,innerHTML:A.value},null,8,Wl))]),_:2},1032,["class","href","target","rel","onClick"]))]))),128))],2))],2)}var Rr=ze(Gl,[["render",$l]]);const Aa="__v-click-outside",pn=typeof window!="undefined",Jl=typeof navigator!="undefined",ec=pn&&("ontouchstart"in window||Jl&&navigator.msMaxTouchPoints>0)?["touchstart"]:["click"],tc=e=>{const t=typeof e=="function";if(!t&&typeof e!="object")throw new Error("v-click-outside: Binding value must be a function or an object");return{handler:t?e:e.handler,middleware:e.middleware||(a=>a),events:e.events||ec,isActive:e.isActive!==!1,detectIframe:e.detectIframe!==!1,capture:Boolean(e.capture)}},vn=({event:e,handler:t,middleware:a})=>{a(e)&&t(e)},ac=({el:e,event:t,handler:a,middleware:n})=>{setTimeout(()=>{const{activeElement:m}=document;m&&m.tagName==="IFRAME"&&!e.contains(m)&&vn({event:t,handler:a,middleware:n})},0)},rc=({el:e,event:t,handler:a,middleware:n})=>{const m=t.path||t.composedPath&&t.composedPath();(m?m.indexOf(e)<0:!e.contains(t.target))&&vn({event:t,handler:a,middleware:n})},gn=(e,{value:t})=>{const{events:a,handler:n,middleware:m,isActive:s,detectIframe:S,capture:A}=tc(t);if(!!s){if(e[Aa]=a.map(O=>({event:O,srcTarget:document.documentElement,handler:v=>rc({el:e,event:v,handler:n,middleware:m}),capture:A})),S){const O={event:"blur",srcTarget:window,handler:v=>ac({el:e,event:v,handler:n,middleware:m}),capture:A};e[Aa]=[...e[Aa],O]}e[Aa].forEach(({event:O,srcTarget:v,handler:N})=>setTimeout(()=>{!e[Aa]||v.addEventListener(O,N,A)},0))}},bn=e=>{(e[Aa]||[]).forEach(({event:a,srcTarget:n,handler:m,capture:s})=>n.removeEventListener(a,m,s)),delete e[Aa]};var so=pn?{beforeMount:gn,updated:(e,{value:t,oldValue:a})=>{JSON.stringify(t)!==JSON.stringify(a)&&(bn(e),gn(e,{value:t}))},unmounted:bn}:{},yn=(e,t,a)=>{if(e.typingUsers&&e.typingUsers.length){const n=e.users.filter(m=>{if(m._id!==t&&e.typingUsers.indexOf(m._id)!==-1&&!(m.status&&m.status.state==="offline"))return!0});return n.length?e.users.length===2?a.IS_TYPING:n.map(m=>m.username).join(", ")+" "+a.IS_TYPING:void 0}};function Ar(e,t){if(!(!t||!t.type))return e.some(a=>t.type.toLowerCase().includes(a))}function Qa(e){return Ar(es,e)}function Tr(e){return Ar(_n,e)}function xn(e){return Ar(es,e)||Ar(_n,e)}function no(e){return Ar(Yl,e)}const oc={name:"RoomsContent",components:{SvgIcon:vt,FormatMessage:Rr},directives:{clickOutside:so},props:{currentUserId:{type:[String,Number],required:!0},room:{type:Object,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},textMessages:{type:Object,required:!0},roomActions:{type:Array,required:!0}},emits:["room-action-handler"],data(){return{roomMenuOpened:null}},computed:{getLastMessage(){const e=this.typingUsers;if(e)return e;const t=this.room.lastMessage.deleted?this.textMessages.MESSAGE_DELETED:this.room.lastMessage.content;if(this.room.users.length<=2)return t;const a=this.room.users.find(n=>n._id===this.room.lastMessage.senderId);return this.room.lastMessage.username?`${this.room.lastMessage.username} - ${t}`:!a||a._id===this.currentUserId?t:`${a.username} - ${t}`},userStatus(){if(!this.room.users||this.room.users.length!==2)return;const e=this.room.users.find(t=>t._id!==this.currentUserId);return e&&e.status?e.status.state:null},typingUsers(){return yn(this.room,this.currentUserId,this.textMessages)},isMessageCheckmarkVisible(){return!this.typingUsers&&this.room.lastMessage&&!this.room.lastMessage.deleted&&this.room.lastMessage.senderId===this.currentUserId&&(this.room.lastMessage.saved||this.room.lastMessage.distributed||this.room.lastMessage.seen)},formattedDuration(){var t,a;const e=(a=(t=this.room.lastMessage)==null?void 0:t.files)==null?void 0:a[0];if(e){if(!e.duration)return`${e.name}.${e.extension}`;let n=Math.floor(e.duration);return(n-(n%=60))/60+(n>9?":":":0")+n}return""},isAudio(){return this.room.lastMessage.files?no(this.room.lastMessage.files[0]):!1}},methods:{roomActionHandler(e){this.closeRoomMenu(),this.$emit("room-action-handler",{action:e,roomId:this.room.roomId})},closeRoomMenu(){this.roomMenuOpened=null}}},sc={class:"vac-room-container"},nc={class:"vac-name-container vac-text-ellipsis"},ic={class:"vac-title-container"},lc={class:"vac-room-name vac-text-ellipsis"},cc={key:1,class:"vac-text-date"},dc={key:0},mc={key:1,class:"vac-text-ellipsis"},hc={key:3,class:"vac-text-ellipsis"},uc={class:"vac-room-options-container"},fc={key:0,class:"vac-badge-counter vac-room-badge"},_c={key:0,class:"vac-menu-options"},pc={class:"vac-menu-list"},vc=["onClick"];function gc(e,t,a,n,m,s){const S=r.resolveComponent("svg-icon"),A=r.resolveComponent("format-message"),O=r.resolveDirective("click-outside");return r.openBlock(),r.createElementBlock("div",sc,[r.renderSlot(e.$slots,"room-list-item",r.normalizeProps(r.guardReactiveProps({room:a.room})),()=>[r.renderSlot(e.$slots,"room-list-avatar",r.normalizeProps(r.guardReactiveProps({room:a.room})),()=>[a.room.avatar?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-avatar",style:r.normalizeStyle({"background-image":`url('${a.room.avatar}')`})},null,4)):r.createCommentVNode("",!0)]),r.createElementVNode("div",nc,[r.createElementVNode("div",ic,[s.userStatus?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-state-circle",{"vac-state-online":s.userStatus==="online"}])},null,2)):r.createCommentVNode("",!0),r.createElementVNode("div",lc,r.toDisplayString(a.room.roomName),1),a.room.lastMessage?(r.openBlock(),r.createElementBlock("div",cc,r.toDisplayString(a.room.lastMessage.timestamp),1)):r.createCommentVNode("",!0)]),r.createElementVNode("div",{class:r.normalizeClass(["vac-text-last",{"vac-message-new":a.room.lastMessage&&a.room.lastMessage.new&&!s.typingUsers}])},[s.isMessageCheckmarkVisible?(r.openBlock(),r.createElementBlock("span",dc,[r.renderSlot(e.$slots,"checkmark-icon",r.normalizeProps(r.guardReactiveProps({message:a.room.lastMessage})),()=>[r.createVNode(S,{name:a.room.lastMessage.distributed?"double-checkmark":"checkmark",param:a.room.lastMessage.seen?"seen":"",class:"vac-icon-check"},null,8,["name","param"])])])):r.createCommentVNode("",!0),a.room.lastMessage&&!a.room.lastMessage.deleted&&s.isAudio?(r.openBlock(),r.createElementBlock("div",mc,[r.renderSlot(e.$slots,"microphone-icon",{},()=>[r.createVNode(S,{name:"microphone",class:"vac-icon-microphone"})]),r.createTextVNode(" "+r.toDisplayString(s.formattedDuration),1)])):a.room.lastMessage?(r.openBlock(),r.createBlock(A,{key:2,content:s.getLastMessage,deleted:!!a.room.lastMessage.deleted&&!s.typingUsers,users:a.room.users,linkify:!1,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"single-line":!0},{"deleted-icon":r.withCtx(v=>[r.renderSlot(e.$slots,"deleted-icon",r.normalizeProps(r.guardReactiveProps(v)))]),_:3},8,["content","deleted","users","text-formatting","link-options"])):r.createCommentVNode("",!0),!a.room.lastMessage&&s.typingUsers?(r.openBlock(),r.createElementBlock("div",hc,r.toDisplayString(s.typingUsers),1)):r.createCommentVNode("",!0),r.createElementVNode("div",uc,[a.room.unreadCount?(r.openBlock(),r.createElementBlock("div",fc,r.toDisplayString(a.room.unreadCount),1)):r.createCommentVNode("",!0),r.renderSlot(e.$slots,"room-list-options",r.normalizeProps(r.guardReactiveProps({room:a.room})),()=>[a.roomActions.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-svg-button vac-list-room-options",onClick:t[0]||(t[0]=r.withModifiers(v=>m.roomMenuOpened=a.room.roomId,["stop"]))},[r.renderSlot(e.$slots,"room-list-options-icon",{},()=>[r.createVNode(S,{name:"dropdown",param:"room"})])])):r.createCommentVNode("",!0),a.roomActions.length?(r.openBlock(),r.createBlock(r.Transition,{key:1,name:"vac-slide-left"},{default:r.withCtx(()=>[m.roomMenuOpened===a.room.roomId?r.withDirectives((r.openBlock(),r.createElementBlock("div",_c,[r.createElementVNode("div",pc,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.roomActions,v=>(r.openBlock(),r.createElementBlock("div",{key:v.name},[r.createElementVNode("div",{class:"vac-menu-item",onClick:r.withModifiers(N=>s.roomActionHandler(v),["stop"])},r.toDisplayString(v.title),9,vc)]))),128))])])),[[O,s.closeRoomMenu]]):r.createCommentVNode("",!0)]),_:1})):r.createCommentVNode("",!0)])])],2)])])])}var bc=ze(oc,[["render",gc]]),ts=(e,t,a,n=!1)=>!a||a===""?e:e.filter(m=>n?io(m[t]).startsWith(io(a)):io(m[t]).includes(io(a)));function io(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}const yc={name:"RoomsList",components:{Loader:Zr,RoomsSearch:C0,RoomContent:bc},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},showRoomsList:{type:Boolean,required:!0},showSearch:{type:Boolean,required:!0},showAddRoom:{type:Boolean,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},isMobile:{type:Boolean,required:!0},rooms:{type:Array,required:!0},loadingRooms:{type:Boolean,required:!0},roomsLoaded:{type:Boolean,required:!0},room:{type:Object,required:!0},roomActions:{type:Array,required:!0},scrollDistance:{type:Number,required:!0}},emits:["add-room","room-action-handler","loading-more-rooms","fetch-room","fetch-more-rooms"],data(){return{filteredRooms:this.rooms||[],observer:null,showLoader:!0,loadingMoreRooms:!1,selectedRoomId:""}},watch:{rooms:{deep:!0,handler(e,t){this.filteredRooms=e,(e.length!==t.length||this.roomsLoaded)&&(this.loadingMoreRooms=!1)}},loadingRooms(e){e||setTimeout(()=>this.initIntersectionObserver())},loadingMoreRooms(e){this.$emit("loading-more-rooms",e)},roomsLoaded:{immediate:!0,handler(e){e&&(this.loadingMoreRooms=!1,this.loadingRooms||(this.showLoader=!1))}},room:{immediate:!0,handler(e){e&&!this.isMobile&&(this.selectedRoomId=e.roomId)}}},methods:{initIntersectionObserver(){this.observer&&(this.showLoader=!0,this.observer.disconnect());const e=document.getElementById("infinite-loader-rooms");if(e){const t={root:document.getElementById("rooms-list"),rootMargin:`${this.scrollDistance}px`,threshold:0};this.observer=new IntersectionObserver(a=>{a[0].isIntersecting&&this.loadMoreRooms()},t),this.observer.observe(e)}},searchRoom(e){this.filteredRooms=ts(this.rooms,"roomName",e.target.value)},openRoom(e){e.roomId===this.room.roomId&&!this.isMobile||(this.isMobile||(this.selectedRoomId=e.roomId),this.$emit("fetch-room",{room:e}))},loadMoreRooms(){if(!this.loadingMoreRooms){if(this.roomsLoaded){this.loadingMoreRooms=!1,this.showLoader=!1;return}this.$emit("fetch-more-rooms"),this.loadingMoreRooms=!0}}}},xc={key:0,class:"vac-rooms-empty"},wc={key:1,id:"rooms-list",class:"vac-room-list"},kc=["id","onClick"],Sc={key:0,id:"infinite-loader-rooms"};function Ec(e,t,a,n,m,s){const S=r.resolveComponent("rooms-search"),A=r.resolveComponent("loader"),O=r.resolveComponent("room-content");return r.withDirectives((r.openBlock(),r.createElementBlock("div",{class:r.normalizeClass(["vac-rooms-container",{"vac-rooms-container-full":a.isMobile,"vac-app-border-r":!a.isMobile}])},[r.renderSlot(e.$slots,"rooms-header"),r.renderSlot(e.$slots,"rooms-list-search",{},()=>[r.createVNode(S,{rooms:a.rooms,"loading-rooms":a.loadingRooms,"text-messages":a.textMessages,"show-search":a.showSearch,"show-add-room":a.showAddRoom,onSearchRoom:s.searchRoom,onAddRoom:t[0]||(t[0]=v=>e.$emit("add-room"))},r.createSlots({_:2},[r.renderList(e.$slots,(v,N)=>({name:N,fn:r.withCtx(f=>[r.renderSlot(e.$slots,N,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["rooms","loading-rooms","text-messages","show-search","show-add-room","onSearchRoom"])]),r.createVNode(A,{show:a.loadingRooms},r.createSlots({_:2},[r.renderList(e.$slots,(v,N)=>({name:N,fn:r.withCtx(f=>[r.renderSlot(e.$slots,N,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["show"]),!a.loadingRooms&&!a.rooms.length?(r.openBlock(),r.createElementBlock("div",xc,[r.renderSlot(e.$slots,"rooms-empty",{},()=>[r.createTextVNode(r.toDisplayString(a.textMessages.ROOMS_EMPTY),1)])])):r.createCommentVNode("",!0),a.loadingRooms?r.createCommentVNode("",!0):(r.openBlock(),r.createElementBlock("div",wc,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(m.filteredRooms,v=>(r.openBlock(),r.createElementBlock("div",{id:v.roomId,key:v.roomId,class:r.normalizeClass(["vac-room-item",{"vac-room-selected":m.selectedRoomId===v.roomId}]),onClick:N=>s.openRoom(v)},[r.createVNode(O,{"current-user-id":a.currentUserId,room:v,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"text-messages":a.textMessages,"room-actions":a.roomActions,onRoomActionHandler:t[1]||(t[1]=N=>e.$emit("room-action-handler",N))},r.createSlots({_:2},[r.renderList(e.$slots,(N,f)=>({name:f,fn:r.withCtx(y=>[r.renderSlot(e.$slots,f,r.normalizeProps(r.guardReactiveProps(y)))])}))]),1032,["current-user-id","room","text-formatting","link-options","text-messages","room-actions"])],10,kc))),128)),r.createVNode(r.Transition,{name:"vac-fade-message"},{default:r.withCtx(()=>[a.rooms.length&&!a.loadingRooms?(r.openBlock(),r.createElementBlock("div",Sc,[r.createVNode(A,{show:m.showLoader,infinite:!0},r.createSlots({_:2},[r.renderList(e.$slots,(v,N)=>({name:N,fn:r.withCtx(f=>[r.renderSlot(e.$slots,N,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["show"])])):r.createCommentVNode("",!0)]),_:3})]))],2)),[[r.vShow,a.showRoomsList]])}var Mc=ze(yc,[["render",Ec]]);const Rc={name:"RoomHeader",components:{SvgIcon:vt},directives:{clickOutside:so},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},singleRoom:{type:Boolean,required:!0},showRoomsList:{type:Boolean,required:!0},isMobile:{type:Boolean,required:!0},roomInfoEnabled:{type:Boolean,required:!0},menuActions:{type:Array,required:!0},room:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0},messageSelectionActions:{type:Array,required:!0},selectedMessagesTotal:{type:Number,required:!0}},emits:["toggle-rooms-list","room-info","menu-action-handler","cancel-message-selection","message-selection-action-handler"],data(){return{menuOpened:!1,messageSelectionAnimationEnded:!0}},computed:{typingUsers(){return yn(this.room,this.currentUserId,this.textMessages)},userStatus(){if(!this.room.users||this.room.users.length!==2)return;const e=this.room.users.find(a=>a._id!==this.currentUserId);if(!e.status)return;let t="";return e.status.state==="online"?t=this.textMessages.IS_ONLINE:e.status.lastChanged&&(t=this.textMessages.LAST_SEEN+e.status.lastChanged),t}},watch:{messageSelectionEnabled(e){e?this.messageSelectionAnimationEnded=!1:setTimeout(()=>{this.messageSelectionAnimationEnded=!0},300)}},methods:{menuActionHandler(e){this.closeMenu(),this.$emit("menu-action-handler",e)},closeMenu(){this.menuOpened=!1},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",e)}}},Ac={class:"vac-room-header vac-app-border-b"},Tc={class:"vac-room-wrapper"},Bc={key:0,class:"vac-room-selection"},Cc=["id"],Oc=["onClick"],Lc={class:"vac-selection-button-count"},Nc={class:"vac-text-ellipsis"},Ic={class:"vac-room-name vac-text-ellipsis"},Vc={key:0,class:"vac-room-info vac-text-ellipsis"},jc={key:1,class:"vac-room-info vac-text-ellipsis"},Hc={key:0,class:"vac-menu-options"},Pc={class:"vac-menu-list"},Fc=["onClick"];function Dc(e,t,a,n,m,s){const S=r.resolveComponent("svg-icon"),A=r.resolveDirective("click-outside");return r.openBlock(),r.createElementBlock("div",Ac,[r.renderSlot(e.$slots,"room-header",r.normalizeProps(r.guardReactiveProps({room:a.room,typingUsers:s.typingUsers,userStatus:s.userStatus})),()=>[r.createElementVNode("div",Tc,[r.createVNode(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.messageSelectionEnabled?(r.openBlock(),r.createElementBlock("div",Bc,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.messageSelectionActions,O=>(r.openBlock(),r.createElementBlock("div",{id:O.name,key:O.name},[r.createElementVNode("div",{class:"vac-selection-button",onClick:v=>s.messageSelectionActionHandler(O)},[r.createTextVNode(r.toDisplayString(O.title)+" ",1),r.createElementVNode("span",Lc,r.toDisplayString(a.selectedMessagesTotal),1)],8,Oc)],8,Cc))),128)),r.createElementVNode("div",{class:"vac-selection-cancel vac-item-clickable",onClick:t[0]||(t[0]=O=>e.$emit("cancel-message-selection"))},r.toDisplayString(a.textMessages.CANCEL_SELECT_MESSAGE),1)])):r.createCommentVNode("",!0)]),_:1}),!a.messageSelectionEnabled&&m.messageSelectionAnimationEnded?(r.openBlock(),r.createElementBlock(r.Fragment,{key:0},[a.singleRoom?r.createCommentVNode("",!0):(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-svg-button vac-toggle-button",{"vac-rotate-icon-init":!a.isMobile,"vac-rotate-icon":!a.showRoomsList&&!a.isMobile}]),onClick:t[1]||(t[1]=O=>e.$emit("toggle-rooms-list"))},[r.renderSlot(e.$slots,"toggle-icon",{},()=>[r.createVNode(S,{name:"toggle"})])],2)),r.createElementVNode("div",{class:r.normalizeClass(["vac-info-wrapper",{"vac-item-clickable":a.roomInfoEnabled}]),onClick:t[2]||(t[2]=O=>e.$emit("room-info"))},[r.renderSlot(e.$slots,"room-header-avatar",r.normalizeProps(r.guardReactiveProps({room:a.room})),()=>[a.room.avatar?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-avatar",style:r.normalizeStyle({"background-image":`url('${a.room.avatar}')`})},null,4)):r.createCommentVNode("",!0)]),r.renderSlot(e.$slots,"room-header-info",r.normalizeProps(r.guardReactiveProps({room:a.room,typingUsers:s.typingUsers,userStatus:s.userStatus})),()=>[r.createElementVNode("div",Nc,[r.createElementVNode("div",Ic,r.toDisplayString(a.room.roomName),1),s.typingUsers?(r.openBlock(),r.createElementBlock("div",Vc,r.toDisplayString(s.typingUsers),1)):(r.openBlock(),r.createElementBlock("div",jc,r.toDisplayString(s.userStatus),1))])])],2),a.room.roomId?r.renderSlot(e.$slots,"room-options",{key:1},()=>[a.menuActions.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-svg-button vac-room-options",onClick:t[3]||(t[3]=O=>m.menuOpened=!m.menuOpened)},[r.renderSlot(e.$slots,"menu-icon",{},()=>[r.createVNode(S,{name:"menu"})])])):r.createCommentVNode("",!0),a.menuActions.length?(r.openBlock(),r.createBlock(r.Transition,{key:1,name:"vac-slide-left"},{default:r.withCtx(()=>[m.menuOpened?r.withDirectives((r.openBlock(),r.createElementBlock("div",Hc,[r.createElementVNode("div",Pc,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.menuActions,O=>(r.openBlock(),r.createElementBlock("div",{key:O.name},[r.createElementVNode("div",{class:"vac-menu-item",onClick:v=>s.menuActionHandler(O)},r.toDisplayString(O.title),9,Fc)]))),128))])])),[[A,s.closeMenu]]):r.createCommentVNode("",!0)]),_:1})):r.createCommentVNode("",!0)]):r.createCommentVNode("",!0)],64)):r.createCommentVNode("",!0)])])])}var Uc=ze(Rc,[["render",Dc]]);function lo(e){if(typeof e!="string"||!e)throw new Error("expected a non-empty string, got: "+e)}function as(e){if(typeof e!="number")throw new Error("expected a number, got: "+e)}const zc=1,qc=1,Ta="emoji",$a="keyvalue",rs="favorites",Xc="tokens",wn="tokens",Yc="unicode",kn="count",Gc="group",Kc="order",Sn="group-order",os="eTag",co="url",En="skinTone",Ja="readonly",ss="readwrite",Mn="skinUnicodes",Zc="skinUnicodes",Wc="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",Qc="en";function $c(e,t){const a=new Set,n=[];for(const m of e){const s=t(m);a.has(s)||(a.add(s),n.push(m))}return n}function Rn(e){return $c(e,t=>t.unicode)}function Jc(e){function t(a,n,m){const s=n?e.createObjectStore(a,{keyPath:n}):e.createObjectStore(a);if(m)for(const[S,[A,O]]of Object.entries(m))s.createIndex(S,A,{multiEntry:O});return s}t($a),t(Ta,Yc,{[wn]:[Xc,!0],[Sn]:[[Gc,Kc]],[Mn]:[Zc,!0]}),t(rs,void 0,{[kn]:[""]})}const ns={},mo={},ho={};function An(e,t,a){a.onerror=()=>t(a.error),a.onblocked=()=>t(new Error("IDB blocked")),a.onsuccess=()=>e(a.result)}async function e1(e){const t=await new Promise((a,n)=>{const m=indexedDB.open(e,zc);ns[e]=m,m.onupgradeneeded=s=>{s.oldVersion<qc&&Jc(m.result)},An(a,n,m)});return t.onclose=()=>is(e),t}function t1(e){return mo[e]||(mo[e]=e1(e)),mo[e]}function da(e,t,a,n){return new Promise((m,s)=>{const S=e.transaction(t,a,{durability:"relaxed"}),A=typeof t=="string"?S.objectStore(t):t.map(v=>S.objectStore(v));let O;n(A,S,v=>{O=v}),S.oncomplete=()=>m(O),S.onerror=()=>s(S.error)})}function is(e){const t=ns[e],a=t&&t.result;if(a){a.close();const n=ho[e];if(n)for(const m of n)m()}delete ns[e],delete mo[e],delete ho[e]}function a1(e){return new Promise((t,a)=>{is(e);const n=indexedDB.deleteDatabase(e);An(t,a,n)})}function r1(e,t){let a=ho[e];a||(a=ho[e]=[]),a.push(t)}const o1=new Set([":D","XD",":'D","O:)",":X",":P",";P","XP",":L",":Z",":j","8D","XO","8)",":B",":O",":S",":'o","Dx","X(","D:",":C",">0)",":3","</3","<3","\\M/",":E","8#"]);function er(e){return e.split(/[\s_]+/).map(t=>!t.match(/\w/)||o1.has(t)?t.toLowerCase():t.replace(/[)(:,]/g,"").replace(/’/g,"'").toLowerCase()).filter(Boolean)}const s1=2;function Tn(e){return e.filter(Boolean).map(t=>t.toLowerCase()).filter(t=>t.length>=s1)}function n1(e){return e.map(({annotation:a,emoticon:n,group:m,order:s,shortcodes:S,skins:A,tags:O,emoji:v,version:N})=>{const f=[...new Set(Tn([...(S||[]).map(er).flat(),...O.map(er).flat(),...er(a),n]))].sort(),y={annotation:a,group:m,order:s,tags:O,tokens:f,unicode:v,version:N};if(n&&(y.emoticon=n),S&&(y.shortcodes=S),A){y.skinTones=[],y.skinUnicodes=[],y.skinVersions=[];for(const{tone:k,emoji:o,version:H}of A)y.skinTones.push(k),y.skinUnicodes.push(o),y.skinVersions.push(H)}return y})}function Bn(e,t,a,n){e[t](a).onsuccess=m=>n&&n(m.target.result)}function Ba(e,t,a){Bn(e,"get",t,a)}function Cn(e,t,a){Bn(e,"getAll",t,a)}function ls(e){e.commit&&e.commit()}function i1(e,t){let a=e[0];for(let n=1;n<e.length;n++){const m=e[n];t(a)>t(m)&&(a=m)}return a}function On(e,t){const a=i1(e,m=>m.length),n=[];for(const m of a)e.some(s=>s.findIndex(S=>t(S)===t(m))===-1)||n.push(m);return n}async function l1(e){return!await cs(e,$a,co)}async function c1(e,t,a){const[n,m]=await Promise.all([os,co].map(s=>cs(e,$a,s)));return n===a&&m===t}async function d1(e,t){return da(e,Ta,Ja,(n,m,s)=>{let S;const A=()=>{n.getAll(S&&IDBKeyRange.lowerBound(S,!0),50).onsuccess=O=>{const v=O.target.result;for(const N of v)if(S=N.unicode,t(N))return s(N);if(v.length<50)return s();A()}};A()})}async function Ln(e,t,a,n){try{const m=n1(t);await da(e,[Ta,$a],ss,([s,S],A)=>{let O,v,N=0;function f(){++N===2&&y()}function y(){if(!(O===n&&v===a)){s.clear();for(const k of m)s.put(k);S.put(n,os),S.put(a,co),ls(A)}}Ba(S,os,k=>{O=k,f()}),Ba(S,co,k=>{v=k,f()})})}finally{}}async function m1(e,t){return da(e,Ta,Ja,(a,n,m)=>{const s=IDBKeyRange.bound([t,0],[t+1,0],!1,!0);Cn(a.index(Sn),s,m)})}async function Nn(e,t){const a=Tn(er(t));return a.length?da(e,Ta,Ja,(n,m,s)=>{const S=[],A=()=>{S.length===a.length&&O()},O=()=>{const v=On(S,N=>N.unicode);s(v.sort((N,f)=>N.order<f.order?-1:1))};for(let v=0;v<a.length;v++){const N=a[v],f=v===a.length-1?IDBKeyRange.bound(N,N+"\uFFFF",!1,!0):IDBKeyRange.only(N);Cn(n.index(wn),f,y=>{S.push(y),A()})}}):[]}async function h1(e,t){const a=await Nn(e,t);return a.length?a.filter(n=>(n.shortcodes||[]).map(s=>s.toLowerCase()).includes(t.toLowerCase()))[0]||null:await d1(e,m=>(m.shortcodes||[]).includes(t.toLowerCase()))||null}async function u1(e,t){return da(e,Ta,Ja,(a,n,m)=>Ba(a,t,s=>{if(s)return m(s);Ba(a.index(Mn),t,S=>m(S||null))}))}function cs(e,t,a){return da(e,t,Ja,(n,m,s)=>Ba(n,a,s))}function f1(e,t,a,n){return da(e,t,ss,(m,s)=>{m.put(n,a),ls(s)})}function _1(e,t){return da(e,rs,ss,(a,n)=>Ba(a,t,m=>{a.put((m||0)+1,t),ls(n)}))}function p1(e,t,a){return a===0?[]:da(e,[rs,Ta],Ja,([n,m],s,S)=>{const A=[];n.index(kn).openCursor(void 0,"prev").onsuccess=O=>{const v=O.target.result;if(!v)return S(A);function N(k){if(A.push(k),A.length===a)return S(A);v.continue()}const f=v.primaryKey,y=t.byName(f);if(y)return N(y);Ba(m,f,k=>{if(k)return N(k);v.continue()})}})}const uo="";function v1(e,t){const a=new Map;for(const m of e){const s=t(m);for(const S of s){let A=a;for(let v=0;v<S.length;v++){const N=S.charAt(v);let f=A.get(N);f||(f=new Map,A.set(N,f)),A=f}let O=A.get(uo);O||(O=[],A.set(uo,O)),O.push(m)}}return(m,s)=>{let S=a;for(let v=0;v<m.length;v++){const N=m.charAt(v),f=S.get(N);if(f)S=f;else return[]}if(s)return S.get(uo)||[];const A=[],O=[S];for(;O.length;){const N=[...O.shift().entries()].sort((f,y)=>f[0]<y[0]?-1:1);for(const[f,y]of N)f===uo?A.push(...y):O.push(y)}return A}}const g1=["name","url"];function b1(e){const t=e&&Array.isArray(e),a=t&&e.length&&(!e[0]||g1.some(n=>!(n in e[0])));if(!t||a)throw new Error("Custom emojis are in the wrong format")}function In(e){b1(e);const t=(y,k)=>y.name.toLowerCase()<k.name.toLowerCase()?-1:1,a=e.sort(t),m=v1(e,y=>[...new Set((y.shortcodes||[]).map(k=>er(k)).flat())]),s=y=>m(y,!0),S=y=>m(y,!1),A=y=>{const k=er(y),o=k.map((H,j)=>(j<k.length-1?s:S)(H));return On(o,H=>H.name).sort(t)},O=new Map,v=new Map;for(const y of e){v.set(y.name.toLowerCase(),y);for(const k of y.shortcodes||[])O.set(k.toLowerCase(),y)}return{all:a,search:A,byShortcode:y=>O.get(y.toLowerCase()),byName:y=>v.get(y.toLowerCase())}}function Br(e){if(!e)return e;if(delete e.tokens,e.skinTones){const t=e.skinTones.length;e.skins=Array(t);for(let a=0;a<t;a++)e.skins[a]={tone:e.skinTones[a],unicode:e.skinUnicodes[a],version:e.skinVersions[a]};delete e.skinTones,delete e.skinUnicodes,delete e.skinVersions}return e}function Vn(e){e||console.warn("emoji-picker-element is more efficient if the dataSource server exposes an ETag header.")}const y1=["annotation","emoji","group","order","tags","version"];function x1(e){if(!e||!Array.isArray(e)||!e[0]||typeof e[0]!="object"||y1.some(t=>!(t in e[0])))throw new Error("Emoji data is in the wrong format")}function jn(e,t){if(Math.floor(e.status/100)!==2)throw new Error("Failed to fetch: "+t+":  "+e.status)}async function w1(e){const t=await fetch(e,{method:"HEAD"});jn(t,e);const a=t.headers.get("etag");return Vn(a),a}async function ds(e){const t=await fetch(e);jn(t,e);const a=t.headers.get("etag");Vn(a);const n=await t.json();return x1(n),[a,n]}function k1(e){for(var t="",a=new Uint8Array(e),n=a.byteLength,m=-1;++m<n;)t+=String.fromCharCode(a[m]);return t}function S1(e){for(var t=e.length,a=new ArrayBuffer(t),n=new Uint8Array(a),m=-1;++m<t;)n[m]=e.charCodeAt(m);return a}async function Hn(e){const t=JSON.stringify(e),a=S1(t),n=await crypto.subtle.digest("SHA-1",a),m=k1(n);return btoa(m)}async function E1(e,t){let a,n=await w1(t);if(!n){const m=await ds(t);n=m[0],a=m[1],n||(n=await Hn(a))}await c1(e,t,n)||(a||(a=(await ds(t))[1]),await Ln(e,a,t,n))}async function M1(e,t){let[a,n]=await ds(t);a||(a=await Hn(n)),await Ln(e,n,t,a)}class Pn{constructor({dataSource:t=Wc,locale:a=Qc,customEmoji:n=[]}={}){this.dataSource=t,this.locale=a,this._dbName=`emoji-picker-element-${this.locale}`,this._db=void 0,this._lazyUpdate=void 0,this._custom=In(n),this._clear=this._clear.bind(this),this._ready=this._init()}async _init(){const t=this._db=await t1(this._dbName);r1(this._dbName,this._clear);const a=this.dataSource;await l1(t)?await M1(t,a):this._lazyUpdate=E1(t,a)}async ready(){const t=async()=>(this._ready||(this._ready=this._init()),this._ready);await t(),this._db||await t()}async getEmojiByGroup(t){return as(t),await this.ready(),Rn(await m1(this._db,t)).map(Br)}async getEmojiBySearchQuery(t){lo(t),await this.ready();const a=this._custom.search(t),n=Rn(await Nn(this._db,t)).map(Br);return[...a,...n]}async getEmojiByShortcode(t){lo(t),await this.ready();const a=this._custom.byShortcode(t);return a||Br(await h1(this._db,t))}async getEmojiByUnicodeOrName(t){lo(t),await this.ready();const a=this._custom.byName(t);return a||Br(await u1(this._db,t))}async getPreferredSkinTone(){return await this.ready(),await cs(this._db,$a,En)||0}async setPreferredSkinTone(t){return as(t),await this.ready(),f1(this._db,$a,En,t)}async incrementFavoriteEmojiCount(t){return lo(t),await this.ready(),_1(this._db,t)}async getTopFavoriteEmoji(t){return as(t),await this.ready(),(await p1(this._db,this._custom,t)).map(Br)}set customEmoji(t){this._custom=In(t)}get customEmoji(){return this._custom.all}async _shutdown(){await this.ready();try{await this._lazyUpdate}catch{}}_clear(){this._db=this._ready=this._lazyUpdate=void 0}async close(){await this._shutdown(),await is(this._dbName)}async delete(){await this._shutdown(),await a1(this._dbName)}}function Cr(){}function Fn(e){return e()}function Dn(){return Object.create(null)}function Or(e){e.forEach(Fn)}function Un(e){return typeof e=="function"}function R1(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let fo;function _o(e,t){return fo||(fo=document.createElement("a")),fo.href=t,e===fo.href}function A1(e){return Object.keys(e).length===0}function T1(e){return e&&Un(e.destroy)?e.destroy:Cr}function Xe(e,t){e.appendChild(t)}function Gt(e,t,a){e.insertBefore(t,a||null)}function Kt(e){e.parentNode.removeChild(e)}function Ue(e){return document.createElement(e)}function aa(e){return document.createTextNode(e)}function Zt(e,t,a,n){return e.addEventListener(t,a,n),()=>e.removeEventListener(t,a,n)}function Q(e,t,a){a==null?e.removeAttribute(t):e.getAttribute(t)!==a&&e.setAttribute(t,a)}function ra(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function zn(e,t){e.value=t==null?"":t}function ga(e,t,a,n){a===null?e.style.removeProperty(t):e.style.setProperty(t,a,n?"important":"")}let ms;function Lr(e){ms=e}const Nr=[],tr=[],po=[],qn=[],Xn=Promise.resolve();let hs=!1;function Yn(){hs||(hs=!0,Xn.then(Gn))}function B1(){return Yn(),Xn}function us(e){po.push(e)}const fs=new Set;let vo=0;function Gn(){const e=ms;do{for(;vo<Nr.length;){const t=Nr[vo];vo++,Lr(t),C1(t.$$)}for(Lr(null),Nr.length=0,vo=0;tr.length;)tr.pop()();for(let t=0;t<po.length;t+=1){const a=po[t];fs.has(a)||(fs.add(a),a())}po.length=0}while(Nr.length);for(;qn.length;)qn.pop()();hs=!1,fs.clear(),Lr(e)}function C1(e){if(e.fragment!==null){e.update(),Or(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(us)}}const O1=new Set;function L1(e,t){e&&e.i&&(O1.delete(e),e.i(t))}const N1=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;function Ir(e,t){e.d(1),t.delete(e.key)}function Vr(e,t,a,n,m,s,S,A,O,v,N,f){let y=e.length,k=s.length,o=y;const H={};for(;o--;)H[e[o].key]=o;const j=[],V=new Map,d=new Map;for(o=k;o--;){const B=f(m,s,o),i=a(B);let w=S.get(i);w?n&&w.p(B,t):(w=v(i,B),w.c()),V.set(i,j[o]=w),i in H&&d.set(i,Math.abs(o-H[i]))}const M=new Set,T=new Set;function C(B){L1(B,1),B.m(A,N),S.set(B.key,B),N=B.first,k--}for(;y&&k;){const B=j[k-1],i=e[y-1],w=B.key,g=i.key;B===i?(N=B.first,y--,k--):V.has(g)?!S.has(w)||M.has(w)?C(B):T.has(g)?y--:d.get(w)>d.get(g)?(T.add(w),C(B)):(M.add(g),y--):(O(i,S),y--)}for(;y--;){const B=e[y];V.has(B.key)||O(B,S)}for(;k;)C(j[k-1]);return j}function I1(e,t,a,n){const{fragment:m,on_mount:s,on_destroy:S,after_update:A}=e.$$;m&&m.m(t,a),n||us(()=>{const O=s.map(Fn).filter(Un);S?S.push(...O):Or(O),e.$$.on_mount=[]}),A.forEach(us)}function V1(e,t){const a=e.$$;a.fragment!==null&&(Or(a.on_destroy),a.fragment&&a.fragment.d(t),a.on_destroy=a.fragment=null,a.ctx=[])}function j1(e,t){e.$$.dirty[0]===-1&&(Nr.push(e),Yn(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function H1(e,t,a,n,m,s,S,A=[-1]){const O=ms;Lr(e);const v=e.$$={fragment:null,ctx:null,props:s,update:Cr,not_equal:m,bound:Dn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(O?O.$$.context:[]),callbacks:Dn(),dirty:A,skip_bound:!1,root:t.target||O.$$.root};S&&S(v.root);let N=!1;v.ctx=a?a(e,t.props||{},(f,y,...k)=>{const o=k.length?k[0]:y;return v.ctx&&m(v.ctx[f],v.ctx[f]=o)&&(!v.skip_bound&&v.bound[f]&&v.bound[f](o),N&&j1(e,f)),y}):[],v.update(),N=!0,Or(v.before_update),v.fragment=n?n(v.ctx):!1,t.target&&(v.fragment&&v.fragment.c(),I1(e,t.target,void 0,void 0),Gn()),Lr(O)}class P1{$destroy(){V1(this,1),this.$destroy=Cr}$on(t,a){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(a),()=>{const m=n.indexOf(a);m!==-1&&n.splice(m,1)}}$set(t){this.$$set&&!A1(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Kn=[[-1,"\u2728","custom"],[0,"\u{1F600}","smileys-emotion"],[1,"\u{1F44B}","people-body"],[3,"\u{1F431}","animals-nature"],[4,"\u{1F34E}","food-drink"],[5,"\u{1F3E0}\uFE0F","travel-places"],[6,"\u26BD","activities"],[7,"\u{1F4DD}","objects"],[8,"\u26D4\uFE0F","symbols"],[9,"\u{1F3C1}","flags"]].map(([e,t,a])=>({id:e,emoji:t,name:a})),go=Kn.slice(1),F1=Kn[0],D1=2,Zn=6,Wn=typeof requestIdleCallback=="function"?requestIdleCallback:setTimeout;function Qn(e){return e.unicode.includes("\u200D")}const U1={"\u{1FAE0}":14,"\u{1F972}":13.1,"\u{1F97B}":12.1,"\u{1F970}":11,"\u{1F929}":5,"\u{1F471}\u200D\u2640\uFE0F":4,"\u{1F923}":3,"\u{1F441}\uFE0F\u200D\u{1F5E8}\uFE0F":2,"\u{1F600}":1,"\u{1F610}\uFE0F":.7,"\u{1F603}":.6},z1=1e3,q1="\u{1F590}\uFE0F",X1=8,Y1=["\u{1F60A}","\u{1F612}","\u2665\uFE0F","\u{1F44D}\uFE0F","\u{1F60D}","\u{1F602}","\u{1F62D}","\u263A\uFE0F","\u{1F614}","\u{1F629}","\u{1F60F}","\u{1F495}","\u{1F64C}","\u{1F618}"],$n='"Twemoji Mozilla","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji","EmojiOne Color","Android Emoji",sans-serif',G1=(e,t)=>e<t?-1:e>t?1:0,Jn=(e,t)=>{const a=document.createElement("canvas");a.width=a.height=1;const n=a.getContext("2d");return n.textBaseline="top",n.font=`100px ${$n}`,n.fillStyle=t,n.scale(.01,.01),n.fillText(e,0,0),n.getImageData(0,0,1,1).data},K1=(e,t)=>{const a=[...e].join(","),n=[...t].join(",");return a===n&&!a.startsWith("0,0,0,")};function Z1(e){const t=Jn(e,"#000"),a=Jn(e,"#fff");return t&&a&&K1(t,a)}function W1(){const e=Object.entries(U1);try{for(const[t,a]of e)if(Z1(t))return a}catch{}finally{}return e[0][1]}const _s=new Promise(e=>Wn(()=>e(W1()))),ps=new Map,Q1="\uFE0F",$1="\uD83C",J1="\u200D",ed=127995,td=57339;function ad(e,t){if(t===0)return e;const a=e.indexOf(J1);return a!==-1?e.substring(0,a)+String.fromCodePoint(ed+t-1)+e.substring(a):(e.endsWith(Q1)&&(e=e.substring(0,e.length-1)),e+$1+String.fromCodePoint(td+t-1))}function ba(e){e.preventDefault(),e.stopPropagation()}function vs(e,t,a){return t+=e?-1:1,t<0?t=a.length-1:t>=a.length&&(t=0),t}function ei(e,t){const a=new Set,n=[];for(const m of e){const s=t(m);a.has(s)||(a.add(s),n.push(m))}return n}function rd(e,t){const a=n=>{const m={};for(const s of n)typeof s.tone=="number"&&s.version<=t&&(m[s.tone]=s.unicode);return m};return e.map(({unicode:n,skins:m,shortcodes:s,url:S,name:A,category:O})=>({unicode:n,name:A,shortcodes:s,url:S,category:O,id:n||A,skins:m&&a(m),title:(s||[]).join(", ")}))}const bo=requestAnimationFrame;let od=typeof ResizeObserver=="function";function sd(e,t){let a;return od?(a=new ResizeObserver(n=>t(n[0].contentRect.width)),a.observe(e)):bo(()=>t(e.getBoundingClientRect().width)),{destroy(){a&&a.disconnect()}}}function ti(e){{const t=document.createRange();return t.selectNode(e.firstChild),t.getBoundingClientRect().width}}let gs;function nd(e,t,a){for(const n of e){const m=a(n),s=ti(m);typeof gs=="undefined"&&(gs=ti(t));const S=s/1.8<gs;ps.set(n.unicode,S)}}function id(e){return ei(e,t=>t)}const{Map:jr}=N1;function ai(e,t,a){const n=e.slice();return n[63]=t[a],n[65]=a,n}function ri(e,t,a){const n=e.slice();return n[66]=t[a],n[65]=a,n}function oi(e,t,a){const n=e.slice();return n[63]=t[a],n[65]=a,n}function si(e,t,a){const n=e.slice();return n[69]=t[a],n}function ni(e,t,a){const n=e.slice();return n[72]=t[a],n[65]=a,n}function ii(e,t){let a,n=t[72]+"",m,s,S,A,O,v;return{key:e,first:null,c(){a=Ue("div"),m=aa(n),Q(a,"id",s="skintone-"+t[65]),Q(a,"class",S="emoji hide-focus "+(t[65]===t[20]?"active":"")),Q(a,"aria-selected",A=t[65]===t[20]),Q(a,"role","option"),Q(a,"title",O=t[0].skinTones[t[65]]),Q(a,"tabindex","-1"),Q(a,"aria-label",v=t[0].skinTones[t[65]]),this.first=a},m(N,f){Gt(N,a,f),Xe(a,m)},p(N,f){t=N,f[0]&512&&n!==(n=t[72]+"")&&ra(m,n),f[0]&512&&s!==(s="skintone-"+t[65])&&Q(a,"id",s),f[0]&1049088&&S!==(S="emoji hide-focus "+(t[65]===t[20]?"active":""))&&Q(a,"class",S),f[0]&1049088&&A!==(A=t[65]===t[20])&&Q(a,"aria-selected",A),f[0]&513&&O!==(O=t[0].skinTones[t[65]])&&Q(a,"title",O),f[0]&513&&v!==(v=t[0].skinTones[t[65]])&&Q(a,"aria-label",v)},d(N){N&&Kt(a)}}}function li(e,t){let a,n,m=t[69].emoji+"",s,S,A,O,v,N,f;function y(){return t[49](t[69])}return{key:e,first:null,c(){a=Ue("button"),n=Ue("div"),s=aa(m),Q(n,"class","nav-emoji emoji"),Q(a,"role","tab"),Q(a,"class","nav-button"),Q(a,"aria-controls",S="tab-"+t[69].id),Q(a,"aria-label",A=t[0].categories[t[69].name]),Q(a,"aria-selected",O=!t[4]&&t[13].id===t[69].id),Q(a,"title",v=t[0].categories[t[69].name]),this.first=a},m(k,o){Gt(k,a,o),Xe(a,n),Xe(n,s),N||(f=Zt(a,"click",y),N=!0)},p(k,o){t=k,o[0]&4096&&m!==(m=t[69].emoji+"")&&ra(s,m),o[0]&4096&&S!==(S="tab-"+t[69].id)&&Q(a,"aria-controls",S),o[0]&4097&&A!==(A=t[0].categories[t[69].name])&&Q(a,"aria-label",A),o[0]&12304&&O!==(O=!t[4]&&t[13].id===t[69].id)&&Q(a,"aria-selected",O),o[0]&4097&&v!==(v=t[0].categories[t[69].name])&&Q(a,"title",v)},d(k){k&&Kt(a),N=!1,f()}}}function ld(e){let t,a;return{c(){t=Ue("img"),Q(t,"class","custom-emoji"),_o(t.src,a=e[63].url)||Q(t,"src",a),Q(t,"alt",""),Q(t,"loading","lazy")},m(n,m){Gt(n,t,m)},p(n,m){m[0]&32768&&!_o(t.src,a=n[63].url)&&Q(t,"src",a)},d(n){n&&Kt(t)}}}function cd(e){let t=e[27](e[63],e[8])+"",a;return{c(){a=aa(t)},m(n,m){Gt(n,a,m)},p(n,m){m[0]&33024&&t!==(t=n[27](n[63],n[8])+"")&&ra(a,t)},d(n){n&&Kt(a)}}}function ci(e,t){let a,n,m,s,S,A,O;function v(y,k){return y[63].unicode?cd:ld}let N=v(t),f=N(t);return{key:e,first:null,c(){a=Ue("button"),f.c(),Q(a,"role",n=t[4]?"option":"menuitem"),Q(a,"aria-selected",m=t[4]?t[65]==t[5]:""),Q(a,"aria-label",s=t[28](t[63],t[8])),Q(a,"title",S=t[63].title),Q(a,"class",A="emoji "+(t[4]&&t[65]===t[5]?"active":"")),Q(a,"id",O="emo-"+t[63].id),this.first=a},m(y,k){Gt(y,a,k),f.m(a,null)},p(y,k){t=y,N===(N=v(t))&&f?f.p(t,k):(f.d(1),f=N(t),f&&(f.c(),f.m(a,null))),k[0]&16&&n!==(n=t[4]?"option":"menuitem")&&Q(a,"role",n),k[0]&32816&&m!==(m=t[4]?t[65]==t[5]:"")&&Q(a,"aria-selected",m),k[0]&33024&&s!==(s=t[28](t[63],t[8]))&&Q(a,"aria-label",s),k[0]&32768&&S!==(S=t[63].title)&&Q(a,"title",S),k[0]&32816&&A!==(A="emoji "+(t[4]&&t[65]===t[5]?"active":""))&&Q(a,"class",A),k[0]&32768&&O!==(O="emo-"+t[63].id)&&Q(a,"id",O)},d(y){y&&Kt(a),f.d()}}}function di(e,t){let a,n=(t[4]?t[0].searchResultsLabel:t[66].category?t[66].category:t[15].length>1?t[0].categories.custom:t[0].categories[t[13].name])+"",m,s,S,A,O=[],v=new jr,N,f,y,k=t[66].emojis;const o=H=>H[63].id;for(let H=0;H<k.length;H+=1){let j=oi(t,k,H),V=o(j);v.set(V,O[H]=ci(V,j))}return{key:e,first:null,c(){a=Ue("div"),m=aa(n),A=Ue("div");for(let H=0;H<O.length;H+=1)O[H].c();Q(a,"id",s="menu-label-"+t[65]),Q(a,"class",S="category "+(t[15].length===1&&t[15][0].category===""?"gone":"")),Q(a,"aria-hidden","true"),Q(A,"class","emoji-menu"),Q(A,"role",N=t[4]?"listbox":"menu"),Q(A,"aria-labelledby",f="menu-label-"+t[65]),Q(A,"id",y=t[4]?"search-results":""),this.first=a},m(H,j){Gt(H,a,j),Xe(a,m),Gt(H,A,j);for(let V=0;V<O.length;V+=1)O[V].m(A,null)},p(H,j){t=H,j[0]&40977&&n!==(n=(t[4]?t[0].searchResultsLabel:t[66].category?t[66].category:t[15].length>1?t[0].categories.custom:t[0].categories[t[13].name])+"")&&ra(m,n),j[0]&32768&&s!==(s="menu-label-"+t[65])&&Q(a,"id",s),j[0]&32768&&S!==(S="category "+(t[15].length===1&&t[15][0].category===""?"gone":""))&&Q(a,"class",S),j[0]&402686256&&(k=t[66].emojis,O=Vr(O,j,o,1,t,k,v,A,Ir,ci,null,oi)),j[0]&16&&N!==(N=t[4]?"listbox":"menu")&&Q(A,"role",N),j[0]&32768&&f!==(f="menu-label-"+t[65])&&Q(A,"aria-labelledby",f),j[0]&16&&y!==(y=t[4]?"search-results":"")&&Q(A,"id",y)},d(H){H&&Kt(a),H&&Kt(A);for(let j=0;j<O.length;j+=1)O[j].d()}}}function dd(e){let t,a;return{c(){t=Ue("img"),Q(t,"class","custom-emoji"),_o(t.src,a=e[63].url)||Q(t,"src",a),Q(t,"alt",""),Q(t,"loading","lazy")},m(n,m){Gt(n,t,m)},p(n,m){m[0]&1024&&!_o(t.src,a=n[63].url)&&Q(t,"src",a)},d(n){n&&Kt(t)}}}function md(e){let t=e[27](e[63],e[8])+"",a;return{c(){a=aa(t)},m(n,m){Gt(n,a,m)},p(n,m){m[0]&1280&&t!==(t=n[27](n[63],n[8])+"")&&ra(a,t)},d(n){n&&Kt(a)}}}function mi(e,t){let a,n,m,s;function S(v,N){return v[63].unicode?md:dd}let A=S(t),O=A(t);return{key:e,first:null,c(){a=Ue("button"),O.c(),Q(a,"role","menuitem"),Q(a,"aria-label",n=t[28](t[63],t[8])),Q(a,"title",m=t[63].title),Q(a,"class","emoji"),Q(a,"id",s="fav-"+t[63].id),this.first=a},m(v,N){Gt(v,a,N),O.m(a,null)},p(v,N){t=v,A===(A=S(t))&&O?O.p(t,N):(O.d(1),O=A(t),O&&(O.c(),O.m(a,null))),N[0]&1280&&n!==(n=t[28](t[63],t[8]))&&Q(a,"aria-label",n),N[0]&1024&&m!==(m=t[63].title)&&Q(a,"title",m),N[0]&1024&&s!==(s="fav-"+t[63].id)&&Q(a,"id",s)},d(v){v&&Kt(a),O.d()}}}function hd(e){let t,a,n,m,s,S,A,O,v,N=e[0].searchLabel+"",f,y,k=e[0].searchDescription+"",o,H,j,V,d,M,T,C=e[0].skinToneDescription+"",B,i,w=[],g=new jr,h,b,x,c,u,_=[],L=new jr,Y,F,U,l,p,Z,W,re,me=[],ce=new jr,he,ke,pe,de,Me,je=[],Be=new jr,Fe,He,Pe,Ge,xt,ut,lt=e[9];const wt=le=>le[72];for(let le=0;le<lt.length;le+=1){let ve=ni(e,lt,le),J=wt(ve);g.set(J,w[le]=ii(J,ve))}let Ot=e[12];const Pt=le=>le[69].id;for(let le=0;le<Ot.length;le+=1){let ve=si(e,Ot,le),J=Pt(ve);L.set(J,_[le]=li(J,ve))}let ht=e[15];const Yt=le=>le[66].category;for(let le=0;le<ht.length;le+=1){let ve=ri(e,ht,le),J=Yt(ve);ce.set(J,me[le]=di(J,ve))}let kt=e[10];const _t=le=>le[63].id;for(let le=0;le<kt.length;le+=1){let ve=ai(e,kt,le),J=_t(ve);Be.set(J,je[le]=mi(J,ve))}return{c(){t=Ue("section"),a=Ue("div"),n=Ue("div"),m=Ue("div"),s=Ue("input"),v=Ue("label"),f=aa(N),y=Ue("span"),o=aa(k),H=Ue("div"),j=Ue("button"),V=aa(e[21]),T=Ue("span"),B=aa(C),i=Ue("div");for(let le=0;le<w.length;le+=1)w[le].c();u=Ue("div");for(let le=0;le<_.length;le+=1)_[le].c();F=Ue("div"),U=Ue("div"),l=Ue("div"),p=aa(e[18]),W=Ue("div"),re=Ue("div");for(let le=0;le<me.length;le+=1)me[le].c();Me=Ue("div");for(let le=0;le<je.length;le+=1)je[le].c();Pe=Ue("button"),Pe.textContent="\u{1F600}",Q(a,"class","pad-top"),Q(s,"id","search"),Q(s,"class","search"),Q(s,"type","search"),Q(s,"role","combobox"),Q(s,"enterkeyhint","search"),Q(s,"placeholder",S=e[0].searchLabel),Q(s,"autocapitalize","none"),Q(s,"autocomplete","off"),Q(s,"spellcheck","true"),Q(s,"aria-expanded",A=!!(e[4]&&e[1].length)),Q(s,"aria-controls","search-results"),Q(s,"aria-describedby","search-description"),Q(s,"aria-autocomplete","list"),Q(s,"aria-activedescendant",O=e[26]?`emo-${e[26]}`:""),Q(v,"class","sr-only"),Q(v,"for","search"),Q(y,"id","search-description"),Q(y,"class","sr-only"),Q(m,"class","search-wrapper"),Q(j,"id","skintone-button"),Q(j,"class",d="emoji "+(e[6]?"hide-focus":"")),Q(j,"aria-label",e[23]),Q(j,"title",e[23]),Q(j,"aria-describedby","skintone-description"),Q(j,"aria-haspopup","listbox"),Q(j,"aria-expanded",e[6]),Q(j,"aria-controls","skintone-list"),Q(H,"class",M="skintone-button-wrapper "+(e[19]?"expanded":"")),Q(T,"id","skintone-description"),Q(T,"class","sr-only"),Q(i,"id","skintone-list"),Q(i,"class",h="skintone-list "+(e[6]?"":"hidden no-animate")),ga(i,"transform","translateY("+(e[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),Q(i,"role","listbox"),Q(i,"aria-label",b=e[0].skinTonesLabel),Q(i,"aria-activedescendant",x="skintone-"+e[20]),Q(i,"aria-hidden",c=!e[6]),Q(n,"class","search-row"),Q(u,"class","nav"),Q(u,"role","tablist"),ga(u,"grid-template-columns","repeat("+e[12].length+", 1fr)"),Q(u,"aria-label",Y=e[0].categoriesLabel),Q(U,"class","indicator"),ga(U,"transform","translateX("+(e[24]?-1:1)*e[11]*100+"%)"),Q(F,"class","indicator-wrapper"),Q(l,"class",Z="message "+(e[18]?"":"gone")),Q(l,"role","alert"),Q(l,"aria-live","polite"),Q(W,"class",he="tabpanel "+(!e[14]||e[18]?"gone":"")),Q(W,"role",ke=e[4]?"region":"tabpanel"),Q(W,"aria-label",pe=e[4]?e[0].searchResultsLabel:e[0].categories[e[13].name]),Q(W,"id",de=e[4]?"":`tab-${e[13].id}`),Q(W,"tabindex","0"),Q(Me,"class",Fe="favorites emoji-menu "+(e[18]?"gone":"")),Q(Me,"role","menu"),Q(Me,"aria-label",He=e[0].favoritesLabel),ga(Me,"padding-inline-end",e[25]+"px"),Q(Pe,"aria-hidden","true"),Q(Pe,"tabindex","-1"),Q(Pe,"class","abs-pos hidden emoji"),Q(t,"class","picker"),Q(t,"aria-label",Ge=e[0].regionLabel),Q(t,"style",e[22])},m(le,ve){Gt(le,t,ve),Xe(t,a),Xe(t,n),Xe(n,m),Xe(m,s),zn(s,e[2]),Xe(m,v),Xe(v,f),Xe(m,y),Xe(y,o),Xe(n,H),Xe(H,j),Xe(j,V),Xe(n,T),Xe(T,B),Xe(n,i);for(let J=0;J<w.length;J+=1)w[J].m(i,null);e[48](i),Xe(t,u);for(let J=0;J<_.length;J+=1)_[J].m(u,null);Xe(t,F),Xe(F,U),Xe(t,l),Xe(l,p),Xe(t,W),Xe(W,re);for(let J=0;J<me.length;J+=1)me[J].m(re,null);e[50](W),Xe(t,Me);for(let J=0;J<je.length;J+=1)je[J].m(Me,null);Xe(t,Pe),e[51](Pe),e[52](t),xt||(ut=[Zt(s,"input",e[47]),Zt(s,"keydown",e[30]),Zt(j,"click",e[35]),Zt(i,"focusout",e[38]),Zt(i,"click",e[34]),Zt(i,"keydown",e[36]),Zt(i,"keyup",e[37]),Zt(u,"keydown",e[32]),T1(e[29].call(null,re)),Zt(W,"click",e[33]),Zt(Me,"click",e[33])],xt=!0)},p(le,ve){ve[0]&1&&S!==(S=le[0].searchLabel)&&Q(s,"placeholder",S),ve[0]&18&&A!==(A=!!(le[4]&&le[1].length))&&Q(s,"aria-expanded",A),ve[0]&67108864&&O!==(O=le[26]?`emo-${le[26]}`:"")&&Q(s,"aria-activedescendant",O),ve[0]&4&&zn(s,le[2]),ve[0]&1&&N!==(N=le[0].searchLabel+"")&&ra(f,N),ve[0]&1&&k!==(k=le[0].searchDescription+"")&&ra(o,k),ve[0]&2097152&&ra(V,le[21]),ve[0]&64&&d!==(d="emoji "+(le[6]?"hide-focus":""))&&Q(j,"class",d),ve[0]&8388608&&Q(j,"aria-label",le[23]),ve[0]&8388608&&Q(j,"title",le[23]),ve[0]&64&&Q(j,"aria-expanded",le[6]),ve[0]&524288&&M!==(M="skintone-button-wrapper "+(le[19]?"expanded":""))&&Q(H,"class",M),ve[0]&1&&C!==(C=le[0].skinToneDescription+"")&&ra(B,C),ve[0]&1049089&&(lt=le[9],w=Vr(w,ve,wt,1,le,lt,g,i,Ir,ii,null,ni)),ve[0]&64&&h!==(h="skintone-list "+(le[6]?"":"hidden no-animate"))&&Q(i,"class",h),ve[0]&64&&ga(i,"transform","translateY("+(le[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),ve[0]&1&&b!==(b=le[0].skinTonesLabel)&&Q(i,"aria-label",b),ve[0]&1048576&&x!==(x="skintone-"+le[20])&&Q(i,"aria-activedescendant",x),ve[0]&64&&c!==(c=!le[6])&&Q(i,"aria-hidden",c),ve[0]&12305|ve[1]&1&&(Ot=le[12],_=Vr(_,ve,Pt,1,le,Ot,L,u,Ir,li,null,si)),ve[0]&4096&&ga(u,"grid-template-columns","repeat("+le[12].length+", 1fr)"),ve[0]&1&&Y!==(Y=le[0].categoriesLabel)&&Q(u,"aria-label",Y),ve[0]&16779264&&ga(U,"transform","translateX("+(le[24]?-1:1)*le[11]*100+"%)"),ve[0]&262144&&ra(p,le[18]),ve[0]&262144&&Z!==(Z="message "+(le[18]?"":"gone"))&&Q(l,"class",Z),ve[0]&402694449&&(ht=le[15],me=Vr(me,ve,Yt,1,le,ht,ce,re,Ir,di,null,ri)),ve[0]&278528&&he!==(he="tabpanel "+(!le[14]||le[18]?"gone":""))&&Q(W,"class",he),ve[0]&16&&ke!==(ke=le[4]?"region":"tabpanel")&&Q(W,"role",ke),ve[0]&8209&&pe!==(pe=le[4]?le[0].searchResultsLabel:le[0].categories[le[13].name])&&Q(W,"aria-label",pe),ve[0]&8208&&de!==(de=le[4]?"":`tab-${le[13].id}`)&&Q(W,"id",de),ve[0]&402654464&&(kt=le[10],je=Vr(je,ve,_t,1,le,kt,Be,Me,Ir,mi,null,ai)),ve[0]&262144&&Fe!==(Fe="favorites emoji-menu "+(le[18]?"gone":""))&&Q(Me,"class",Fe),ve[0]&1&&He!==(He=le[0].favoritesLabel)&&Q(Me,"aria-label",He),ve[0]&33554432&&ga(Me,"padding-inline-end",le[25]+"px"),ve[0]&1&&Ge!==(Ge=le[0].regionLabel)&&Q(t,"aria-label",Ge),ve[0]&4194304&&Q(t,"style",le[22])},i:Cr,o:Cr,d(le){le&&Kt(t);for(let ve=0;ve<w.length;ve+=1)w[ve].d();e[48](null);for(let ve=0;ve<_.length;ve+=1)_[ve].d();for(let ve=0;ve<me.length;ve+=1)me[ve].d();e[50](null);for(let ve=0;ve<je.length;ve+=1)je[ve].d();e[51](null),e[52](null),xt=!1,Or(ut)}}}function ud(e,t,a){let{skinToneEmoji:n}=t,{i18n:m}=t,{database:s}=t,{customEmoji:S}=t,{customCategorySorting:A}=t,O=!0,v=[],N=[],f="",y="",k,o,H,j=!1,V=-1,d,M=!1,T=!1,C,B=0,i=0,w,g,h="",b=[],x=[],c,u=X1,_=!1,L=0,Y=0,F=go,U,l=!1,p;const Z=J=>{k.getRootNode().getElementById(J).focus()},W=(J,be)=>{k.dispatchEvent(new CustomEvent(J,{detail:be,bubbles:!0,composed:!0}))},re=(J,be)=>be&&J.skins&&J.skins[be]||J.unicode,me=(J,be)=>id([J.name||re(J,be),...J.shortcodes||[]]).join(", "),ce=J=>/^skintone-/.test(J.id);_s.then(J=>{J||a(18,d=m.emojiUnsupportedMessage)});function he(J){return sd(J,be=>{{const E=getComputedStyle(k),R=parseInt(E.getPropertyValue("--num-columns"),10),P=E.getPropertyValue("direction")==="rtl",q=J.parentElement.getBoundingClientRect().width-be;a(46,u=R),a(25,L=q),a(24,_=P)}})}function ke(J){const be=k.getRootNode();nd(J,o,R=>be.getElementById(`emo-${R.id}`)),a(1,v=v)}function pe(J){return!J.unicode||!Qn(J)||ps.get(J.unicode)}async function de(J){const be=await _s;return J.filter(({version:E})=>!E||E<=be)}async function Me(J){return rd(J,await _s)}async function je(J){if(typeof J=="undefined")return[];const be=J===-1?S:await s.getEmojiByGroup(J);return Me(await de(be))}async function Be(J){return Me(await de(await s.getEmojiBySearchQuery(J)))}function Fe(J){if(!j||!v.length)return;const be=E=>{ba(J),a(5,V=vs(E,V,v))};switch(J.key){case"ArrowDown":return be(!1);case"ArrowUp":return be(!0);case"Enter":if(V!==-1)return ba(J),Ge(v[V].id);v.length&&a(5,V=0)}}function He(J){a(2,f=""),a(44,y=""),a(5,V=-1),a(11,Y=F.findIndex(be=>be.id===J.id))}function Pe(J){const{target:be,key:E}=J,R=P=>{P&&(ba(J),P.focus())};switch(E){case"ArrowLeft":return R(be.previousSibling);case"ArrowRight":return R(be.nextSibling);case"Home":return R(be.parentElement.firstChild);case"End":return R(be.parentElement.lastChild)}}async function Ge(J){const be=await s.getEmojiByUnicodeOrName(J),E=[...v,...x].find(P=>P.id===J),R=E.unicode&&re(E,B);await s.incrementFavoriteEmojiCount(J),W("emoji-click",{emoji:be,skinTone:B,...R&&{unicode:R},...E.name&&{name:E.name}})}async function xt(J){const{target:be}=J;if(!be.classList.contains("emoji"))return;ba(J);const E=be.id.substring(4);Ge(E)}async function ut(J){const{target:be}=J;if(!ce(be))return;ba(J);const E=parseInt(be.id.slice(9),10);a(8,B=E),a(6,M=!1),Z("skintone-button"),W("skin-tone-change",{skinTone:E}),s.setPreferredSkinTone(E)}async function lt(J){a(6,M=!M),a(20,i=B),M&&(ba(J),bo(()=>Z(`skintone-${i}`)))}function wt(J){if(!M)return;const be=async E=>{ba(J),a(20,i=E),await B1(),Z(`skintone-${i}`)};switch(J.key){case"ArrowUp":return be(vs(!0,i,b));case"ArrowDown":return be(vs(!1,i,b));case"Home":return be(0);case"End":return be(b.length-1);case"Enter":return ut(J);case"Escape":return ba(J),a(6,M=!1),Z("skintone-button")}}function Ot(J){if(!!M)switch(J.key){case" ":return ut(J)}}async function Pt(J){const{relatedTarget:be}=J;(!be||!ce(be))&&a(6,M=!1)}function ht(){f=this.value,a(2,f)}function Yt(J){tr[J?"unshift":"push"](()=>{C=J,a(7,C)})}const kt=J=>He(J);function _t(J){tr[J?"unshift":"push"](()=>{H=J,a(3,H)})}function le(J){tr[J?"unshift":"push"](()=>{o=J,a(17,o)})}function ve(J){tr[J?"unshift":"push"](()=>{k=J,a(16,k)})}return e.$$set=J=>{"skinToneEmoji"in J&&a(40,n=J.skinToneEmoji),"i18n"in J&&a(0,m=J.i18n),"database"in J&&a(39,s=J.database),"customEmoji"in J&&a(41,S=J.customEmoji),"customCategorySorting"in J&&a(42,A=J.customCategorySorting)},e.$$.update=()=>{if(e.$$.dirty[1]&1280&&S&&s&&a(39,s.customEmoji=S,s),e.$$.dirty[0]&1|e.$$.dirty[1]&256){async function J(){let be=!1;const E=setTimeout(()=>{be=!0,a(18,d=m.loadingMessage)},z1);try{await s.ready(),a(14,l=!0)}catch(R){console.error(R),a(18,d=m.networkErrorMessage)}finally{clearTimeout(E),be&&(be=!1,a(18,d=""))}}s&&J()}if(e.$$.dirty[0]&6144|e.$$.dirty[1]&1024&&(S&&S.length?a(12,F=[F1,...go]):F!==go&&(Y&&a(11,Y--,Y),a(12,F=go))),e.$$.dirty[0]&4&&Wn(()=>{a(44,y=(f||"").trim()),a(5,V=-1)}),e.$$.dirty[0]&6144&&a(13,U=F[Y]),e.$$.dirty[0]&24576|e.$$.dirty[1]&8192){async function J(){if(!l)a(1,v=[]),a(4,j=!1);else if(y.length>=D1){const be=y,E=await Be(be);be===y&&(a(1,v=E),a(4,j=!0))}else if(U){const be=U.id,E=await je(be);be===U.id&&(a(1,v=E),a(4,j=!1))}}J()}if(e.$$.dirty[0]&4112&&a(22,g=`
  --font-family: ${$n};
  --num-groups: ${F.length}; 
  --indicator-opacity: ${j?0:1}; 
  --num-skintones: ${Zn};`),e.$$.dirty[0]&16384|e.$$.dirty[1]&256){async function J(){l&&a(8,B=await s.getPreferredSkinTone())}J()}if(e.$$.dirty[1]&512&&a(9,b=Array(Zn).fill().map((J,be)=>ad(n,be))),e.$$.dirty[0]&768&&a(21,w=b[B]),e.$$.dirty[0]&257&&a(23,h=m.skinToneLabel.replace("{skinTone}",m.skinTones[B])),e.$$.dirty[0]&16384|e.$$.dirty[1]&256){async function J(){a(45,c=(await Promise.all(Y1.map(be=>s.getEmojiByUnicodeOrName(be)))).filter(Boolean))}l&&J()}if(e.$$.dirty[0]&16384|e.$$.dirty[1]&49408){async function J(){const be=await s.getTopFavoriteEmoji(u),E=await Me(ei([...be,...c],R=>R.unicode||R.name).slice(0,u));a(10,x=E)}l&&c&&J()}if(e.$$.dirty[0]&10){const J=v.filter(be=>be.unicode).filter(be=>Qn(be)&&!ps.has(be.unicode));J.length?bo(()=>ke(J)):(a(1,v=v.filter(pe)),bo(()=>{(H||{}).scrollTop=0}))}e.$$.dirty[0]&1026|e.$$.dirty[1]&4096,e.$$.dirty[0]&18|e.$$.dirty[1]&2048&&a(15,N=function(){if(j)return[{category:"",emojis:v}];const be=new Map;for(const E of v){const R=E.category||"";let P=be.get(R);P||(P=[],be.set(R,P)),P.push(E)}return[...be.entries()].map(([E,R])=>({category:E,emojis:R})).sort((E,R)=>A(E.category,R.category))}()),e.$$.dirty[0]&34&&a(26,p=V!==-1&&v[V].id),e.$$.dirty[0]&192&&(M?C.addEventListener("transitionend",()=>{a(19,T=!0)},{once:!0}):a(19,T=!1))},[m,v,f,H,j,V,M,C,B,b,x,Y,F,U,l,N,k,o,d,T,i,w,g,h,_,L,p,re,me,he,Fe,He,Pe,xt,ut,lt,wt,Ot,Pt,s,n,S,A,O,y,c,u,ht,Yt,kt,_t,le,ve]}class fd extends P1{constructor(t){super(),H1(this,t,ud,hd,R1,{skinToneEmoji:40,i18n:0,database:39,customEmoji:41,customCategorySorting:42},null,[-1,-1,-1])}}const _d="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",pd="en";var vd={categoriesLabel:"Categories",emojiUnsupportedMessage:"Your browser does not support color emoji.",favoritesLabel:"Favorites",loadingMessage:"Loading\u2026",networkErrorMessage:"Could not load emoji.",regionLabel:"Emoji picker",searchDescription:"When search results are available, press up or down to select and enter to choose.",searchLabel:"Search",searchResultsLabel:"Search results",skinToneDescription:"When expanded, press up or down to select and enter to choose.",skinToneLabel:"Choose a skin tone (currently {skinTone})",skinTonesLabel:"Skin tones",skinTones:["Default","Light","Medium-Light","Medium","Medium-Dark","Dark"],categories:{custom:"Custom","smileys-emotion":"Smileys and emoticons","people-body":"People and body","animals-nature":"Animals and nature","food-drink":"Food and drink","travel-places":"Travel and places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"}};const hi=["customEmoji","customCategorySorting","database","dataSource","i18n","locale","skinToneEmoji"];class ui extends HTMLElement{constructor(t){super(),this.attachShadow({mode:"open"});const a=document.createElement("style");a.textContent=":host{--emoji-size:1.375rem;--emoji-padding:0.5rem;--category-emoji-size:var(--emoji-size);--category-emoji-padding:var(--emoji-padding);--indicator-height:3px;--input-border-radius:0.5rem;--input-border-size:1px;--input-font-size:1rem;--input-line-height:1.5;--input-padding:0.25rem;--num-columns:8;--outline-size:2px;--border-size:1px;--skintone-border-radius:1rem;--category-font-size:1rem;display:flex;width:min-content;height:400px}:host,:host(.light){--background:#fff;--border-color:#e0e0e0;--indicator-color:#385ac1;--input-border-color:#999;--input-font-color:#111;--input-placeholder-color:#999;--outline-color:#999;--category-font-color:#111;--button-active-background:#e6e6e6;--button-hover-background:#d9d9d9}:host(.dark){--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}@media (prefers-color-scheme:dark){:host{--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}}:host([hidden]){display:none}button{margin:0;padding:0;border:0;background:0 0;box-shadow:none;-webkit-tap-highlight-color:transparent}button::-moz-focus-inner{border:0}input{padding:0;margin:0;line-height:1.15;font-family:inherit}input[type=search]{-webkit-appearance:none}:focus{outline:var(--outline-color) solid var(--outline-size);outline-offset:calc(-1*var(--outline-size))}:host([data-js-focus-visible]) :focus:not([data-focus-visible-added]){outline:0}:focus:not(:focus-visible){outline:0}.hide-focus{outline:0}*{box-sizing:border-box}.picker{contain:content;display:flex;flex-direction:column;background:var(--background);border:var(--border-size) solid var(--border-color);width:100%;height:100%;overflow:hidden;--total-emoji-size:calc(var(--emoji-size) + (2 * var(--emoji-padding)));--total-category-emoji-size:calc(var(--category-emoji-size) + (2 * var(--category-emoji-padding)))}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.hidden{opacity:0;pointer-events:none}.abs-pos{position:absolute;left:0;top:0}.gone{display:none!important}.skintone-button-wrapper,.skintone-list{background:var(--background);z-index:3}.skintone-button-wrapper.expanded{z-index:1}.skintone-list{position:absolute;inset-inline-end:0;top:0;z-index:2;overflow:visible;border-bottom:var(--border-size) solid var(--border-color);border-radius:0 0 var(--skintone-border-radius) var(--skintone-border-radius);will-change:transform;transition:transform .2s ease-in-out;transform-origin:center 0}@media (prefers-reduced-motion:reduce){.skintone-list{transition-duration:.001s}}@supports not (inset-inline-end:0){.skintone-list{right:0}}.skintone-list.no-animate{transition:none}.tabpanel{overflow-y:auto;-webkit-overflow-scrolling:touch;will-change:transform;min-height:0;flex:1;contain:content}.emoji-menu{display:grid;grid-template-columns:repeat(var(--num-columns),var(--total-emoji-size));justify-content:space-around;align-items:flex-start;width:100%}.category{padding:var(--emoji-padding);font-size:var(--category-font-size);color:var(--category-font-color)}.custom-emoji,.emoji,button.emoji{height:var(--total-emoji-size);width:var(--total-emoji-size)}.emoji,button.emoji{font-size:var(--emoji-size);display:flex;align-items:center;justify-content:center;border-radius:100%;line-height:1;overflow:hidden;font-family:var(--font-family);cursor:pointer}@media (hover:hover) and (pointer:fine){.emoji:hover,button.emoji:hover{background:var(--button-hover-background)}}.emoji.active,.emoji:active,button.emoji.active,button.emoji:active{background:var(--button-active-background)}.custom-emoji{padding:var(--emoji-padding);object-fit:contain;pointer-events:none;background-repeat:no-repeat;background-position:center center;background-size:var(--emoji-size) var(--emoji-size)}.nav,.nav-button{align-items:center}.nav{display:grid;justify-content:space-between;contain:content}.nav-button{display:flex;justify-content:center}.nav-emoji{font-size:var(--category-emoji-size);width:var(--total-category-emoji-size);height:var(--total-category-emoji-size)}.indicator-wrapper{display:flex;border-bottom:1px solid var(--border-color)}.indicator{width:calc(100%/var(--num-groups));height:var(--indicator-height);opacity:var(--indicator-opacity);background-color:var(--indicator-color);will-change:transform,opacity;transition:opacity .1s linear,transform .25s ease-in-out}@media (prefers-reduced-motion:reduce){.indicator{will-change:opacity;transition:opacity .1s linear}}.pad-top,input.search{background:var(--background);width:100%}.pad-top{height:var(--emoji-padding);z-index:3}.search-row{display:flex;align-items:center;position:relative;padding-inline-start:var(--emoji-padding);padding-bottom:var(--emoji-padding)}.search-wrapper{flex:1;min-width:0}input.search{padding:var(--input-padding);border-radius:var(--input-border-radius);border:var(--input-border-size) solid var(--input-border-color);color:var(--input-font-color);font-size:var(--input-font-size);line-height:var(--input-line-height)}input.search::placeholder{color:var(--input-placeholder-color)}.favorites{display:flex;flex-direction:row;border-top:var(--border-size) solid var(--border-color);contain:content}.message{padding:var(--emoji-padding)}",this.shadowRoot.appendChild(a),this._ctx={locale:pd,dataSource:_d,skinToneEmoji:q1,customCategorySorting:G1,customEmoji:null,i18n:vd,...t};for(const n of hi)n!=="database"&&Object.prototype.hasOwnProperty.call(this,n)&&(this._ctx[n]=this[n],delete this[n]);this._dbFlush()}connectedCallback(){this._cmp=new fd({target:this.shadowRoot,props:this._ctx})}disconnectedCallback(){this._cmp.$destroy(),this._cmp=void 0;const{database:t}=this._ctx;t&&t.close().catch(a=>console.error(a))}static get observedAttributes(){return["locale","data-source","skin-tone-emoji"]}attributeChangedCallback(t,a,n){this._set(t.replace(/-([a-z])/g,(m,s)=>s.toUpperCase()),n)}_set(t,a){this._ctx[t]=a,this._cmp&&this._cmp.$set({[t]:a}),["locale","dataSource"].includes(t)&&this._dbFlush()}_dbCreate(){const{locale:t,dataSource:a,database:n}=this._ctx;(!n||n.locale!==t||n.dataSource!==a)&&this._set("database",new Pn({locale:t,dataSource:a}))}_dbFlush(){Promise.resolve().then(()=>this._dbCreate())}}const fi={};for(const e of hi)fi[e]={get(){return e==="database"&&this._dbCreate(),this._ctx[e]},set(t){if(e==="database")throw new Error("database is read-only");this._set(e,t)}};Object.defineProperties(ui.prototype,fi),customElements.get("emoji-picker")||customElements.define("emoji-picker",ui);const gd={name:"EmojiPickerContainer",components:{SvgIcon:vt},props:{emojiOpened:{type:Boolean,default:!1},emojiReaction:{type:Boolean,default:!1},positionTop:{type:Boolean,default:!1},positionRight:{type:Boolean,default:!1}},emits:["add-emoji","open-emoji"],data(){return{emojiPickerHeight:320,emojiPickerTop:0,emojiPickerRight:""}},watch:{emojiOpened(e){e&&setTimeout(()=>{this.addCustomStyling(),this.$refs.emojiPicker.shadowRoot.addEventListener("emoji-click",({detail:t})=>{this.$emit("add-emoji",{unicode:t.unicode})})},0)}},methods:{addCustomStyling(){const e=`.picker {
				border: none;
			}`,t=`.nav {
				overflow-x: auto;
			}`,a=`.search-wrapper {
				padding-right: 2px;
				padding-left: 2px;
			}`,n=`input.search {
				height: 32px;
				font-size: 14px;
				border-radius: 10rem;
				border: var(--chat-border-style);
				padding: 5px 10px;
				outline: none;
				background: var(--chat-bg-color-input);
				color: var(--chat-color);
			}`,m=document.createElement("style");m.textContent=e+t+a+n,this.$refs.emojiPicker.shadowRoot.appendChild(m)},openEmoji(e){this.$emit("open-emoji",!this.emojiOpened),this.setEmojiPickerPosition(e.clientY,e.view.innerWidth,e.view.innerHeight)},setEmojiPickerPosition(e,t,a){const n=t<500||a<700,m=document.getElementById("room-footer");if(!m){n&&(this.emojiPickerRight="-50px");return}n?(this.emojiPickerRight=t/2-(this.positionTop?200:150)+"px",this.emojiPickerTop=100,this.emojiPickerHeight=a-200):(m.getBoundingClientRect().top-e>this.emojiPickerHeight-50?this.emojiPickerTop=e+10:this.emojiPickerTop=e-this.emojiPickerHeight-10,this.emojiPickerRight=this.positionTop?"0px":this.positionRight?"60px":"")}}},bd={class:"vac-emoji-wrapper"},yd={ref:"emojiPicker","v-if":"emojiOpened"};function xd(e,t,a,n,m,s){const S=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",bd,[r.createElementVNode("div",{class:r.normalizeClass(["vac-svg-button",{"vac-emoji-reaction":a.emojiReaction}]),onClick:t[0]||(t[0]=(...A)=>s.openEmoji&&s.openEmoji(...A))},[r.renderSlot(e.$slots,"emoji-picker-icon",{},()=>[r.createVNode(S,{name:"emoji",param:a.emojiReaction?"reaction":""},null,8,["param"])])],2),a.emojiOpened?(r.openBlock(),r.createBlock(r.Transition,{key:0,name:"vac-slide-up",appear:""},{default:r.withCtx(()=>[r.createElementVNode("div",{class:r.normalizeClass(["vac-emoji-picker",{"vac-picker-reaction":a.emojiReaction}]),style:r.normalizeStyle({height:`${m.emojiPickerHeight}px`,top:a.positionTop?m.emojiPickerHeight:`${m.emojiPickerTop}px`,right:m.emojiPickerRight,display:m.emojiPickerTop||!a.emojiReaction?"initial":"none"})},[r.createElementVNode("emoji-picker",yd,null,512)],6)]),_:1})):r.createCommentVNode("",!0)])}var _i=ze(gd,[["render",xd]]);const wd={name:"RoomFiles",components:{Loader:Zr,SvgIcon:vt},props:{file:{type:Object,required:!0},index:{type:Number,required:!0}},emits:["remove-file"],computed:{isImage(){return Qa(this.file)},isVideo(){return Tr(this.file)}}},kd={class:"vac-room-file-container"},Sd=["src"],Ed={class:"vac-text-ellipsis"},Md={key:0,class:"vac-text-ellipsis vac-text-extension"};function Rd(e,t,a,n,m,s){const S=r.resolveComponent("loader"),A=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",kd,[r.createVNode(S,{show:a.file.loading},r.createSlots({_:2},[r.renderList(e.$slots,(O,v)=>({name:v,fn:r.withCtx(N=>[r.renderSlot(e.$slots,v,r.normalizeProps(r.guardReactiveProps(N)))])}))]),1032,["show"]),r.createElementVNode("div",{class:"vac-svg-button vac-icon-remove",onClick:t[0]||(t[0]=O=>e.$emit("remove-file",a.index))},[r.renderSlot(e.$slots,"image-close-icon",{},()=>[r.createVNode(A,{name:"close",param:"image"})])]),s.isImage?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-message-image",{"vac-blur-loading":a.file.loading}]),style:r.normalizeStyle({"background-image":`url('${a.file.localUrl||a.file.url}')`})},null,6)):s.isVideo?(r.openBlock(),r.createElementBlock("video",{key:1,controls:"",class:r.normalizeClass({"vac-blur-loading":a.file.loading})},[r.createElementVNode("source",{src:a.file.localUrl||a.file.url},null,8,Sd)],2)):(r.openBlock(),r.createElementBlock("div",{key:2,class:r.normalizeClass(["vac-file-container",{"vac-blur-loading":a.file.loading}])},[r.createElementVNode("div",null,[r.renderSlot(e.$slots,"file-icon",{},()=>[r.createVNode(A,{name:"file"})])]),r.createElementVNode("div",Ed,r.toDisplayString(a.file.name),1),a.file.extension?(r.openBlock(),r.createElementBlock("div",Md,r.toDisplayString(a.file.extension),1)):r.createCommentVNode("",!0)],2))])}var Ad=ze(wd,[["render",Rd]]);const Td={name:"RoomFiles",components:{SvgIcon:vt,RoomFile:Ad},props:{files:{type:Array,required:!0}},emits:["remove-file","reset-message"],computed:{footerHeight(){return document.getElementById("room-footer").clientHeight}}},Bd={class:"vac-files-box"},Cd={class:"vac-icon-close"};function Od(e,t,a,n,m,s){const S=r.resolveComponent("room-file"),A=r.resolveComponent("svg-icon");return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.files.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-room-files-container",style:r.normalizeStyle({bottom:`${s.footerHeight}px`})},[r.createElementVNode("div",Bd,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.files,(O,v)=>(r.openBlock(),r.createElementBlock("div",{key:v},[r.createVNode(S,{file:O,index:v,onRemoveFile:t[0]||(t[0]=N=>e.$emit("remove-file",N))},null,8,["file","index"])]))),128))]),r.createElementVNode("div",Cd,[r.createElementVNode("div",{class:"vac-svg-button",onClick:t[1]||(t[1]=O=>e.$emit("reset-message"))},[r.renderSlot(e.$slots,"reply-close-icon",{},()=>[r.createVNode(A,{name:"close-outline"})])])])],4)):r.createCommentVNode("",!0)]),_:3})}var Ld=ze(Td,[["render",Od]]);const Nd={props:{percentage:{type:Number,default:0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["hover-audio-progress","change-linehead"],data(){return{isMouseDown:!1}},methods:{onMouseDown(e){if(this.messageSelectionEnabled)return;this.isMouseDown=!0;const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)},onMouseUp(e){if(this.messageSelectionEnabled)return;this.isMouseDown=!1,document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove);const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t)},onMouseMove(e){if(this.messageSelectionEnabled)return;const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t)},calculateLineHeadPosition(e,t){const a=t.getBoundingClientRect().width,n=t.getBoundingClientRect().left;let m=(e.clientX-n)/a;return m=m<0?0:m,m=m>1?1:m,m}}},Id={class:"vac-player-progress"},Vd={class:"vac-line-container"};function jd(e,t,a,n,m,s){return r.openBlock(),r.createElementBlock("div",{ref:"progress",class:"vac-player-bar",onMousedown:t[0]||(t[0]=(...S)=>s.onMouseDown&&s.onMouseDown(...S)),onMouseover:t[1]||(t[1]=S=>e.$emit("hover-audio-progress",!0)),onMouseout:t[2]||(t[2]=S=>e.$emit("hover-audio-progress",!1))},[r.createElementVNode("div",Id,[r.createElementVNode("div",Vd,[r.createElementVNode("div",{class:"vac-line-progress",style:r.normalizeStyle({width:`${a.percentage}%`})},null,4),r.createElementVNode("div",{class:r.normalizeClass(["vac-line-dot",{"vac-line-dot__active":m.isMouseDown}]),style:r.normalizeStyle({left:`${a.percentage}%`})},null,6)])])],544)}var Hd=ze(Nd,[["render",jd]]);const Pd={name:"AudioPlayer",components:{SvgIcon:vt,AudioControl:Hd},props:{messageId:{type:[String,Number],default:null},src:{type:String,default:null},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["hover-audio-progress","update-progress-time"],data(){return{isPlaying:!1,duration:this.convertTimeMMSS(0),playedTime:this.convertTimeMMSS(0),progress:0}},computed:{playerUniqId(){return`audio-player${this.messageId}`},audioSource(){return this.src?this.src:(this.resetProgress(),null)}},mounted(){this.player=document.getElementById(this.playerUniqId),this.player.addEventListener("ended",()=>{this.isPlaying=!1}),this.player.addEventListener("loadeddata",()=>{this.resetProgress(),this.duration=this.convertTimeMMSS(this.player.duration),this.updateProgressTime()}),this.player.addEventListener("timeupdate",this.onTimeUpdate)},methods:{convertTimeMMSS(e){return new Date(e*1e3).toISOString().substr(14,5)},playback(){this.messageSelectionEnabled||!this.audioSource||(this.isPlaying?this.player.pause():setTimeout(()=>this.player.play()),this.isPlaying=!this.isPlaying)},resetProgress(){this.isPlaying&&this.player.pause(),this.duration=this.convertTimeMMSS(0),this.playedTime=this.convertTimeMMSS(0),this.progress=0,this.isPlaying=!1,this.updateProgressTime()},onTimeUpdate(){this.playedTime=this.convertTimeMMSS(this.player.currentTime),this.progress=this.player.currentTime/this.player.duration*100,this.updateProgressTime()},onUpdateProgress(e){e&&(this.player.currentTime=e*this.player.duration)},updateProgressTime(){this.$emit("update-progress-time",this.progress>1?this.playedTime:this.duration)}}},Fd={class:"vac-audio-player"},Dd=["id","src"];function Ud(e,t,a,n,m,s){const S=r.resolveComponent("svg-icon"),A=r.resolveComponent("audio-control");return r.openBlock(),r.createElementBlock("div",null,[r.createElementVNode("div",Fd,[r.createElementVNode("div",{class:"vac-svg-button",onClick:t[0]||(t[0]=(...O)=>s.playback&&s.playback(...O))},[m.isPlaying?r.renderSlot(e.$slots,"audio-pause-icon",{key:0},()=>[r.createVNode(S,{name:"audio-pause"})]):r.renderSlot(e.$slots,"audio-play-icon",{key:1},()=>[r.createVNode(S,{name:"audio-play"})])]),r.createVNode(A,{percentage:m.progress,"message-selection-enabled":a.messageSelectionEnabled,onChangeLinehead:s.onUpdateProgress,onHoverAudioProgress:t[1]||(t[1]=O=>e.$emit("hover-audio-progress",O))},null,8,["percentage","message-selection-enabled","onChangeLinehead"]),r.createElementVNode("audio",{id:s.playerUniqId,src:s.audioSource},null,8,Dd)])])}var bs=ze(Pd,[["render",Ud]]);const zd={name:"RoomMessageReply",components:{SvgIcon:vt,FormatMessage:Rr,AudioPlayer:bs},props:{room:{type:Object,required:!0},messageReply:{type:Object,default:null},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0}},emits:["reset-message"],computed:{footerHeight(){return document.getElementById("room-footer").clientHeight},firstFile(){var e,t;return(t=(e=this.messageReply)==null?void 0:e.files)!=null&&t.length?this.messageReply.files[0]:{}},isImage(){return Qa(this.firstFile)},isVideo(){return Tr(this.firstFile)},isAudio(){return no(this.firstFile)},isOtherFile(){var e,t;return((t=(e=this.messageReply)==null?void 0:e.files)==null?void 0:t.length)&&!this.isAudio&&!this.isVideo&&!this.isImage}}},qd={class:"vac-reply-box"},Xd={class:"vac-reply-info"},Yd={class:"vac-reply-username"},Gd={class:"vac-reply-content"},Kd=["src"],Zd={key:1,controls:"",class:"vac-image-reply"},Wd=["src"],Qd={key:3,class:"vac-image-reply vac-file-container"},$d={class:"vac-text-ellipsis"},Jd={key:0,class:"vac-text-ellipsis vac-text-extension"},em={class:"vac-icon-reply"};function tm(e,t,a,n,m,s){const S=r.resolveComponent("format-message"),A=r.resolveComponent("audio-player"),O=r.resolveComponent("svg-icon");return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.messageReply?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-reply-container",style:r.normalizeStyle({bottom:`${s.footerHeight}px`})},[r.createElementVNode("div",qd,[r.createElementVNode("div",Xd,[r.createElementVNode("div",Yd,r.toDisplayString(a.messageReply.username),1),r.createElementVNode("div",Gd,[r.createVNode(S,{content:a.messageReply.content,users:a.room.users,"text-formatting":a.textFormatting,"link-options":a.linkOptions,reply:!0},r.createSlots({_:2},[r.renderList(e.$slots,(v,N)=>({name:N,fn:r.withCtx(f=>[r.renderSlot(e.$slots,N,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["content","users","text-formatting","link-options"])])]),s.isImage?(r.openBlock(),r.createElementBlock("img",{key:0,src:s.firstFile.url,class:"vac-image-reply"},null,8,Kd)):s.isVideo?(r.openBlock(),r.createElementBlock("video",Zd,[r.createElementVNode("source",{src:s.firstFile.url},null,8,Wd)])):s.isAudio?(r.openBlock(),r.createBlock(A,{key:2,src:s.firstFile.url,class:"vac-audio-reply"},r.createSlots({_:2},[r.renderList(e.$slots,(v,N)=>({name:N,fn:r.withCtx(f=>[r.renderSlot(e.$slots,N,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["src"])):s.isOtherFile?(r.openBlock(),r.createElementBlock("div",Qd,[r.createElementVNode("div",null,[r.renderSlot(e.$slots,"file-icon",{},()=>[r.createVNode(O,{name:"file"})])]),r.createElementVNode("div",$d,r.toDisplayString(s.firstFile.name),1),s.firstFile.extension?(r.openBlock(),r.createElementBlock("div",Jd,r.toDisplayString(s.firstFile.extension),1)):r.createCommentVNode("",!0)])):r.createCommentVNode("",!0)]),r.createElementVNode("div",em,[r.createElementVNode("div",{class:"vac-svg-button",onClick:t[0]||(t[0]=v=>e.$emit("reset-message"))},[r.renderSlot(e.$slots,"reply-close-icon",{},()=>[r.createVNode(O,{name:"close-outline"})])])])],4)):r.createCommentVNode("",!0)]),_:3})}var am=ze(zd,[["render",tm]]);const rm={name:"RoomUsersTag",props:{filteredUsersTag:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-user-tag","activate-item"],data(){return{activeItem:null}},computed:{footerHeight(){return document.getElementById("room-footer").clientHeight}},watch:{filteredUsersTag(e,t){(!t.length||e.length!==t.length)&&(this.activeItem=0)},selectItem(e){e&&this.$emit("select-user-tag",this.filteredUsersTag[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredUsersTag.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},om=["onMouseover","onClick"],sm={class:"vac-tags-info"},nm={class:"vac-tags-username"};function im(e,t,a,n,m,s){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.filteredUsersTag.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-tags-container",style:r.normalizeStyle({bottom:`${s.footerHeight}px`})},[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.filteredUsersTag,(S,A)=>(r.openBlock(),r.createElementBlock("div",{key:S._id,class:r.normalizeClass(["vac-tags-box",{"vac-tags-box-active":A===m.activeItem}]),onMouseover:O=>m.activeItem=A,onClick:O=>e.$emit("select-user-tag",S)},[r.createElementVNode("div",sm,[S.avatar?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-avatar vac-tags-avatar",style:r.normalizeStyle({"background-image":`url('${S.avatar}')`})},null,4)):r.createCommentVNode("",!0),r.createElementVNode("div",nm,r.toDisplayString(S.username),1)])],42,om))),128))],4)):r.createCommentVNode("",!0)]),_:1})}var lm=ze(rm,[["render",im]]);const cm={name:"RoomEmojis",props:{filteredEmojis:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-emoji","activate-item"],data(){return{activeItem:null}},computed:{footerHeight(){return document.getElementById("room-footer").clientHeight}},watch:{filteredEmojis(e,t){(!t.length||e.length!==t.length)&&(this.activeItem=0)},selectItem(e){e&&this.$emit("select-emoji",this.filteredEmojis[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredEmojis.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},dm=["onMouseover","onClick"];function mm(e,t,a,n,m,s){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.filteredEmojis.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-emojis-container",style:r.normalizeStyle({bottom:`${s.footerHeight}px`})},[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.filteredEmojis,(S,A)=>(r.openBlock(),r.createElementBlock("div",{key:S,class:r.normalizeClass(["vac-emoji-element",{"vac-emoji-element-active":A===m.activeItem}]),onMouseover:O=>m.activeItem=A,onClick:O=>e.$emit("select-emoji",S)},r.toDisplayString(S),43,dm))),128))],4)):r.createCommentVNode("",!0)]),_:1})}var hm=ze(cm,[["render",mm]]);const um={name:"RoomTemplatesText",props:{filteredTemplatesText:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-template-text","activate-item"],data(){return{activeItem:null}},computed:{footerHeight(){return document.getElementById("room-footer").clientHeight}},watch:{filteredTemplatesText(e,t){(!t.length||e.length!==t.length)&&(this.activeItem=0)},selectItem(e){e&&this.$emit("select-template-text",this.filteredTemplatesText[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredTemplatesText.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},fm=["onMouseover","onClick"],_m={class:"vac-template-info"},pm={class:"vac-template-tag"},vm={class:"vac-template-text"};function gm(e,t,a,n,m,s){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.filteredTemplatesText.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-template-container vac-app-box-shadow",style:r.normalizeStyle({bottom:`${s.footerHeight}px`})},[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.filteredTemplatesText,(S,A)=>(r.openBlock(),r.createElementBlock("div",{key:A,class:r.normalizeClass(["vac-template-box",{"vac-template-active":A===m.activeItem}]),onMouseover:O=>m.activeItem=A,onClick:O=>e.$emit("select-template-text",S)},[r.createElementVNode("div",_m,[r.createElementVNode("div",pm," /"+r.toDisplayString(S.tag),1),r.createElementVNode("div",vm,r.toDisplayString(S.text),1)])],42,fm))),128))],4)):r.createCommentVNode("",!0)]),_:1})}var bm=ze(um,[["render",gm]]);function ym(e){return new Int8Array(e)}function pi(e){return new Int16Array(e)}function vi(e){return new Int32Array(e)}function gi(e){return new Float32Array(e)}function xm(e){return new Float64Array(e)}function bi(e){if(e.length==1)return gi(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(bi(e));return a}function yi(e){if(e.length==1)return vi(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(yi(e));return a}function xi(e){if(e.length==1)return pi(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(xi(e));return a}function wi(e){if(e.length==1)return new Array(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(wi(e));return a}var ki={};ki.fill=function(e,t,a,n){if(arguments.length==2)for(var m=0;m<e.length;m++)e[m]=arguments[1];else for(var m=t;m<a;m++)e[m]=n};var Hr={};Hr.arraycopy=function(e,t,a,n,m){for(var s=t+m;t<s;)a[n++]=e[t++]},Hr.out={},Hr.out.println=function(e){console.log(e)},Hr.out.printf=function(){console.log.apply(console,arguments)};var yo={};yo.SQRT2=1.4142135623730951,yo.FAST_LOG10=function(e){return Math.log10(e)},yo.FAST_LOG10_X=function(e,t){return Math.log10(e)*t};function ma(e){this.ordinal=e}ma.short_block_allowed=new ma(0),ma.short_block_coupled=new ma(1),ma.short_block_dispensed=new ma(2),ma.short_block_forced=new ma(3);var Si={};Si.MAX_VALUE=34028235e31;function Vt(e){this.ordinal=e}Vt.vbr_off=new Vt(0),Vt.vbr_mt=new Vt(1),Vt.vbr_rh=new Vt(2),Vt.vbr_abr=new Vt(3),Vt.vbr_mtrh=new Vt(4),Vt.vbr_default=Vt.vbr_mtrh;var wm=function(e){},Ze={System:Hr,VbrMode:Vt,Float:Si,ShortBlock:ma,Util:yo,Arrays:ki,new_array_n:wi,new_byte:ym,new_double:xm,new_float:gi,new_float_n:bi,new_int:vi,new_int_n:yi,new_short:pi,new_short_n:xi,assert:wm},xo=Ze,km=xo.System,tt=xo.Util,Sm=xo.Arrays,Em=xo.new_float,jt=Mt;function Mm(){var e=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*tt.SQRT2*.5/2384e-9,.017876148*tt.SQRT2*.5/2384e-9,.003134727*tt.SQRT2*.5/2384e-9,.002457142*tt.SQRT2*.5/2384e-9,971317e-9*tt.SQRT2*.5/2384e-9,218868e-9*tt.SQRT2*.5/2384e-9,101566e-9*tt.SQRT2*.5/2384e-9,13828e-9*tt.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],t=12,a=36,n=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],m=n[jt.SHORT_TYPE],s=n[jt.SHORT_TYPE],S=n[jt.SHORT_TYPE],A=n[jt.SHORT_TYPE],O=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function v(y,k,o){for(var H=10,j=k+238-14-286,V=-15;V<0;V++){var d,M,T;d=e[H+-10],M=y[j+-224]*d,T=y[k+224]*d,d=e[H+-9],M+=y[j+-160]*d,T+=y[k+160]*d,d=e[H+-8],M+=y[j+-96]*d,T+=y[k+96]*d,d=e[H+-7],M+=y[j+-32]*d,T+=y[k+32]*d,d=e[H+-6],M+=y[j+32]*d,T+=y[k+-32]*d,d=e[H+-5],M+=y[j+96]*d,T+=y[k+-96]*d,d=e[H+-4],M+=y[j+160]*d,T+=y[k+-160]*d,d=e[H+-3],M+=y[j+224]*d,T+=y[k+-224]*d,d=e[H+-2],M+=y[k+-256]*d,T-=y[j+256]*d,d=e[H+-1],M+=y[k+-192]*d,T-=y[j+192]*d,d=e[H+0],M+=y[k+-128]*d,T-=y[j+128]*d,d=e[H+1],M+=y[k+-64]*d,T-=y[j+64]*d,d=e[H+2],M+=y[k+0]*d,T-=y[j+0]*d,d=e[H+3],M+=y[k+64]*d,T-=y[j+-64]*d,d=e[H+4],M+=y[k+128]*d,T-=y[j+-128]*d,d=e[H+5],M+=y[k+192]*d,T-=y[j+-192]*d,M*=e[H+6],d=T-M,o[30+V*2]=T+M,o[31+V*2]=e[H+7]*d,H+=18,k--,j++}{var M,T,C,B;T=y[k+-16]*e[H+-10],M=y[k+-32]*e[H+-2],T+=(y[k+-48]-y[k+16])*e[H+-9],M+=y[k+-96]*e[H+-1],T+=(y[k+-80]+y[k+48])*e[H+-8],M+=y[k+-160]*e[H+0],T+=(y[k+-112]-y[k+80])*e[H+-7],M+=y[k+-224]*e[H+1],T+=(y[k+-144]+y[k+112])*e[H+-6],M-=y[k+32]*e[H+2],T+=(y[k+-176]-y[k+144])*e[H+-5],M-=y[k+96]*e[H+3],T+=(y[k+-208]+y[k+176])*e[H+-4],M-=y[k+160]*e[H+4],T+=(y[k+-240]-y[k+208])*e[H+-3],M-=y[k+224],C=M-T,B=M+T,T=o[14],M=o[15]-T,o[31]=B+T,o[30]=C+M,o[15]=C-M,o[14]=B-T}{var i;i=o[28]-o[0],o[0]+=o[28],o[28]=i*e[H+-2*18+7],i=o[29]-o[1],o[1]+=o[29],o[29]=i*e[H+-2*18+7],i=o[26]-o[2],o[2]+=o[26],o[26]=i*e[H+-4*18+7],i=o[27]-o[3],o[3]+=o[27],o[27]=i*e[H+-4*18+7],i=o[24]-o[4],o[4]+=o[24],o[24]=i*e[H+-6*18+7],i=o[25]-o[5],o[5]+=o[25],o[25]=i*e[H+-6*18+7],i=o[22]-o[6],o[6]+=o[22],o[22]=i*tt.SQRT2,i=o[23]-o[7],o[7]+=o[23],o[23]=i*tt.SQRT2-o[7],o[7]-=o[6],o[22]-=o[7],o[23]-=o[22],i=o[6],o[6]=o[31]-i,o[31]=o[31]+i,i=o[7],o[7]=o[30]-i,o[30]=o[30]+i,i=o[22],o[22]=o[15]-i,o[15]=o[15]+i,i=o[23],o[23]=o[14]-i,o[14]=o[14]+i,i=o[20]-o[8],o[8]+=o[20],o[20]=i*e[H+-10*18+7],i=o[21]-o[9],o[9]+=o[21],o[21]=i*e[H+-10*18+7],i=o[18]-o[10],o[10]+=o[18],o[18]=i*e[H+-12*18+7],i=o[19]-o[11],o[11]+=o[19],o[19]=i*e[H+-12*18+7],i=o[16]-o[12],o[12]+=o[16],o[16]=i*e[H+-14*18+7],i=o[17]-o[13],o[13]+=o[17],o[17]=i*e[H+-14*18+7],i=-o[20]+o[24],o[20]+=o[24],o[24]=i*e[H+-12*18+7],i=-o[21]+o[25],o[21]+=o[25],o[25]=i*e[H+-12*18+7],i=o[4]-o[8],o[4]+=o[8],o[8]=i*e[H+-12*18+7],i=o[5]-o[9],o[5]+=o[9],o[9]=i*e[H+-12*18+7],i=o[0]-o[12],o[0]+=o[12],o[12]=i*e[H+-4*18+7],i=o[1]-o[13],o[1]+=o[13],o[13]=i*e[H+-4*18+7],i=o[16]-o[28],o[16]+=o[28],o[28]=i*e[H+-4*18+7],i=-o[17]+o[29],o[17]+=o[29],o[29]=i*e[H+-4*18+7],i=tt.SQRT2*(o[2]-o[10]),o[2]+=o[10],o[10]=i,i=tt.SQRT2*(o[3]-o[11]),o[3]+=o[11],o[11]=i,i=tt.SQRT2*(-o[18]+o[26]),o[18]+=o[26],o[26]=i-o[18],i=tt.SQRT2*(-o[19]+o[27]),o[19]+=o[27],o[27]=i-o[19],i=o[2],o[19]-=o[3],o[3]-=i,o[2]=o[31]-i,o[31]+=i,i=o[3],o[11]-=o[19],o[18]-=i,o[3]=o[30]-i,o[30]+=i,i=o[18],o[27]-=o[11],o[19]-=i,o[18]=o[15]-i,o[15]+=i,i=o[19],o[10]-=i,o[19]=o[14]-i,o[14]+=i,i=o[10],o[11]-=i,o[10]=o[23]-i,o[23]+=i,i=o[11],o[26]-=i,o[11]=o[22]-i,o[22]+=i,i=o[26],o[27]-=i,o[26]=o[7]-i,o[7]+=i,i=o[27],o[27]=o[6]-i,o[6]+=i,i=tt.SQRT2*(o[0]-o[4]),o[0]+=o[4],o[4]=i,i=tt.SQRT2*(o[1]-o[5]),o[1]+=o[5],o[5]=i,i=tt.SQRT2*(o[16]-o[20]),o[16]+=o[20],o[20]=i,i=tt.SQRT2*(o[17]-o[21]),o[17]+=o[21],o[21]=i,i=-tt.SQRT2*(o[8]-o[12]),o[8]+=o[12],o[12]=i-o[8],i=-tt.SQRT2*(o[9]-o[13]),o[9]+=o[13],o[13]=i-o[9],i=-tt.SQRT2*(o[25]-o[29]),o[25]+=o[29],o[29]=i-o[25],i=-tt.SQRT2*(o[24]+o[28]),o[24]-=o[28],o[28]=i-o[24],i=o[24]-o[16],o[24]=i,i=o[20]-i,o[20]=i,i=o[28]-i,o[28]=i,i=o[25]-o[17],o[25]=i,i=o[21]-i,o[21]=i,i=o[29]-i,o[29]=i,i=o[17]-o[1],o[17]=i,i=o[9]-i,o[9]=i,i=o[25]-i,o[25]=i,i=o[5]-i,o[5]=i,i=o[21]-i,o[21]=i,i=o[13]-i,o[13]=i,i=o[29]-i,o[29]=i,i=o[1]-o[0],o[1]=i,i=o[16]-i,o[16]=i,i=o[17]-i,o[17]=i,i=o[8]-i,o[8]=i,i=o[9]-i,o[9]=i,i=o[24]-i,o[24]=i,i=o[25]-i,o[25]=i,i=o[4]-i,o[4]=i,i=o[5]-i,o[5]=i,i=o[20]-i,o[20]=i,i=o[21]-i,o[21]=i,i=o[12]-i,o[12]=i,i=o[13]-i,o[13]=i,i=o[28]-i,o[28]=i,i=o[29]-i,o[29]=i,i=o[0],o[0]+=o[31],o[31]-=i,i=o[1],o[1]+=o[30],o[30]-=i,i=o[16],o[16]+=o[15],o[15]-=i,i=o[17],o[17]+=o[14],o[14]-=i,i=o[8],o[8]+=o[23],o[23]-=i,i=o[9],o[9]+=o[22],o[22]-=i,i=o[24],o[24]+=o[7],o[7]-=i,i=o[25],o[25]+=o[6],o[6]-=i,i=o[4],o[4]+=o[27],o[27]-=i,i=o[5],o[5]+=o[26],o[26]-=i,i=o[20],o[20]+=o[11],o[11]-=i,i=o[21],o[21]+=o[10],o[10]-=i,i=o[12],o[12]+=o[19],o[19]-=i,i=o[13],o[13]+=o[18],o[18]-=i,i=o[28],o[28]+=o[3],o[3]-=i,i=o[29],o[29]+=o[2],o[2]-=i}}function N(y,k){for(var o=0;o<3;o++){var H,j,V,d,M,T;d=y[k+2*3]*n[jt.SHORT_TYPE][0]-y[k+5*3],H=y[k+0*3]*n[jt.SHORT_TYPE][2]-y[k+3*3],j=d+H,V=d-H,d=y[k+5*3]*n[jt.SHORT_TYPE][0]+y[k+2*3],H=y[k+3*3]*n[jt.SHORT_TYPE][2]+y[k+0*3],M=d+H,T=-d+H,H=(y[k+1*3]*n[jt.SHORT_TYPE][1]-y[k+4*3])*2069978111953089e-26,d=(y[k+4*3]*n[jt.SHORT_TYPE][1]+y[k+1*3])*2069978111953089e-26,y[k+3*0]=j*190752519173728e-25+H,y[k+3*5]=-M*190752519173728e-25+d,V=V*.8660254037844387*1907525191737281e-26,M=M*.5*1907525191737281e-26+d,y[k+3*1]=V-M,y[k+3*2]=V+M,j=j*.5*1907525191737281e-26-H,T=T*.8660254037844387*1907525191737281e-26,y[k+3*3]=j+T,y[k+3*4]=j-T,k++}}function f(y,k,o){var H,j;{var V,d,M,T,C,B,i,w;V=o[17]-o[9],M=o[15]-o[11],T=o[14]-o[12],C=o[0]+o[8],B=o[1]+o[7],i=o[2]+o[6],w=o[3]+o[5],y[k+17]=C+i-w-(B-o[4]),j=(C+i-w)*s[12+7]+(B-o[4]),H=(V-M-T)*s[12+6],y[k+5]=H+j,y[k+6]=H-j,d=(o[16]-o[10])*s[12+6],B=B*s[12+7]+o[4],H=V*s[12+0]+d+M*s[12+1]+T*s[12+2],j=-C*s[12+4]+B-i*s[12+5]+w*s[12+3],y[k+1]=H+j,y[k+2]=H-j,H=V*s[12+1]-d-M*s[12+2]+T*s[12+0],j=-C*s[12+5]+B-i*s[12+3]+w*s[12+4],y[k+9]=H+j,y[k+10]=H-j,H=V*s[12+2]-d+M*s[12+0]-T*s[12+1],j=C*s[12+3]-B+i*s[12+4]-w*s[12+5],y[k+13]=H+j,y[k+14]=H-j}{var g,h,b,x,c,u,_,L;g=o[8]-o[0],b=o[6]-o[2],x=o[5]-o[3],c=o[17]+o[9],u=o[16]+o[10],_=o[15]+o[11],L=o[14]+o[12],y[k+0]=c+_+L+(u+o[13]),H=(c+_+L)*s[12+7]-(u+o[13]),j=(g-b+x)*s[12+6],y[k+11]=H+j,y[k+12]=H-j,h=(o[7]-o[1])*s[12+6],u=o[13]-u*s[12+7],H=c*s[12+3]-u+_*s[12+4]+L*s[12+5],j=g*s[12+2]+h+b*s[12+0]+x*s[12+1],y[k+3]=H+j,y[k+4]=H-j,H=-c*s[12+5]+u-_*s[12+3]-L*s[12+4],j=g*s[12+1]+h-b*s[12+2]-x*s[12+0],y[k+7]=H+j,y[k+8]=H-j,H=-c*s[12+4]+u-_*s[12+5]-L*s[12+3],j=g*s[12+0]-h+b*s[12+1]-x*s[12+2],y[k+15]=H+j,y[k+16]=H-j}}this.mdct_sub48=function(y,k,o){for(var H=k,j=286,V=0;V<y.channels_out;V++){for(var d=0;d<y.mode_gr;d++){for(var M,T=y.l3_side.tt[d][V],C=T.xr,B=0,i=y.sb_sample[V][1-d],w=0,g=0;g<18/2;g++)for(v(H,j,i[w]),v(H,j+32,i[w+1]),w+=2,j+=64,M=1;M<32;M+=2)i[w-1][M]*=-1;for(M=0;M<32;M++,B+=18){var h=T.block_type,b=y.sb_sample[V][d],x=y.sb_sample[V][1-d];if(T.mixed_block_flag!=0&&M<2&&(h=0),y.amp_filter[M]<1e-12)Sm.fill(C,B+0,B+18,0);else{if(y.amp_filter[M]<1)for(var g=0;g<18;g++)x[g][O[M]]*=y.amp_filter[M];if(h==jt.SHORT_TYPE){for(var g=-t/4;g<0;g++){var c=n[jt.SHORT_TYPE][g+3];C[B+g*3+9]=b[9+g][O[M]]*c-b[8-g][O[M]],C[B+g*3+18]=b[14-g][O[M]]*c+b[15+g][O[M]],C[B+g*3+10]=b[15+g][O[M]]*c-b[14-g][O[M]],C[B+g*3+19]=x[2-g][O[M]]*c+x[3+g][O[M]],C[B+g*3+11]=x[3+g][O[M]]*c-x[2-g][O[M]],C[B+g*3+20]=x[8-g][O[M]]*c+x[9+g][O[M]]}N(C,B)}else{for(var u=Em(18),g=-a/4;g<0;g++){var _,L;_=n[h][g+27]*x[g+9][O[M]]+n[h][g+36]*x[8-g][O[M]],L=n[h][g+9]*b[g+9][O[M]]-n[h][g+18]*b[8-g][O[M]],u[g+9]=_-L*m[3+g+9],u[g+18]=_*m[3+g+9]+L}f(C,B,u)}}if(h!=jt.SHORT_TYPE&&M!=0)for(var g=7;g>=0;--g){var Y,F;Y=C[B+g]*S[20+g]+C[B+-1-g]*A[28+g],F=C[B+g]*A[28+g]-C[B+-1-g]*S[20+g],C[B+-1-g]=Y,C[B+g]=F}}}if(H=o,j=286,y.mode_gr==1)for(var U=0;U<18;U++)km.arraycopy(y.sb_sample[V][1][U],0,y.sb_sample[V][0][U],0,32)}}}var Rm=Mm,wo=Mt,ys=Ze,Am=ys.System,Tm=ys.new_float,Bm=ys.new_float_n;function Cm(){this.l=Tm(wo.SBMAX_l),this.s=Bm([wo.SBMAX_s,3]);var e=this;this.assign=function(t){Am.arraycopy(t.l,0,e.l,0,wo.SBMAX_l);for(var a=0;a<wo.SBMAX_s;a++)for(var n=0;n<3;n++)e.s[a][n]=t.s[a][n]}}var Ei=Cm,Mi=Ei;function Om(){this.thm=new Mi,this.en=new Mi}var Lm=Om,Ca=Ze,Ri=Ca.System,ko=Ca.VbrMode,Ai=Ca.new_array_n,Ti=Ca.new_float,Nm=Ca.new_float_n,Im=Ca.new_int,So=Ca.assert;Oe.ENCDELAY=576,Oe.POSTDELAY=1152,Oe.MDCTDELAY=48,Oe.FFTOFFSET=224+Oe.MDCTDELAY,Oe.DECDELAY=528,Oe.SBLIMIT=32,Oe.CBANDS=64,Oe.SBPSY_l=21,Oe.SBPSY_s=12,Oe.SBMAX_l=22,Oe.SBMAX_s=13,Oe.PSFB21=6,Oe.PSFB12=6,Oe.BLKSIZE=1024,Oe.HBLKSIZE=Oe.BLKSIZE/2+1,Oe.BLKSIZE_s=256,Oe.HBLKSIZE_s=Oe.BLKSIZE_s/2+1,Oe.NORM_TYPE=0,Oe.START_TYPE=1,Oe.SHORT_TYPE=2,Oe.STOP_TYPE=3,Oe.MPG_MD_LR_LR=0,Oe.MPG_MD_LR_I=1,Oe.MPG_MD_MS_LR=2,Oe.MPG_MD_MS_I=3,Oe.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function Oe(){var e=Rm,t=Lm,a=Oe.FFTOFFSET,n=Oe.MPG_MD_MS_LR,m=null;this.psy=null;var s=null,S=null,A=null;this.setModules=function(y,k,o,H){m=y,this.psy=k,s=k,S=H,A=o};var O=new e;function v(y){var k,o;if(y.ATH.useAdjust==0){y.ATH.adjust=1;return}if(o=y.loudness_sq[0][0],k=y.loudness_sq[1][0],y.channels_out==2?(o+=y.loudness_sq[0][1],k+=y.loudness_sq[1][1]):(o+=o,k+=k),y.mode_gr==2&&(o=Math.max(o,k)),o*=.5,o*=y.ATH.aaSensitivityP,o>.03125)y.ATH.adjust>=1?y.ATH.adjust=1:y.ATH.adjust<y.ATH.adjustLimit&&(y.ATH.adjust=y.ATH.adjustLimit),y.ATH.adjustLimit=1;else{var H=31.98*o+625e-6;y.ATH.adjust>=H?(y.ATH.adjust*=H*.075+.925,y.ATH.adjust<H&&(y.ATH.adjust=H)):y.ATH.adjustLimit>=H?y.ATH.adjust=H:y.ATH.adjust<y.ATH.adjustLimit&&(y.ATH.adjust=y.ATH.adjustLimit),y.ATH.adjustLimit=H}}function N(y){var k,o;for(So(0<=y.bitrate_index&&y.bitrate_index<16),So(0<=y.mode_ext&&y.mode_ext<4),y.bitrate_stereoMode_Hist[y.bitrate_index][4]++,y.bitrate_stereoMode_Hist[15][4]++,y.channels_out==2&&(y.bitrate_stereoMode_Hist[y.bitrate_index][y.mode_ext]++,y.bitrate_stereoMode_Hist[15][y.mode_ext]++),k=0;k<y.mode_gr;++k)for(o=0;o<y.channels_out;++o){var H=y.l3_side.tt[k][o].block_type|0;y.l3_side.tt[k][o].mixed_block_flag!=0&&(H=4),y.bitrate_blockType_Hist[y.bitrate_index][H]++,y.bitrate_blockType_Hist[y.bitrate_index][5]++,y.bitrate_blockType_Hist[15][H]++,y.bitrate_blockType_Hist[15][5]++}}function f(y,k){var o=y.internal_flags,H,j;if(o.lame_encode_frame_init==0){var V,d,M=Ti(2014),T=Ti(286+1152+576);for(o.lame_encode_frame_init=1,V=0,d=0;V<286+576*(1+o.mode_gr);++V)V<576*o.mode_gr?(M[V]=0,o.channels_out==2&&(T[V]=0)):(M[V]=k[0][d],o.channels_out==2&&(T[V]=k[1][d]),++d);for(j=0;j<o.mode_gr;j++)for(H=0;H<o.channels_out;H++)o.l3_side.tt[j][H].block_type=Oe.SHORT_TYPE;O.mdct_sub48(o,M,T),So(o.mf_size>=Oe.BLKSIZE+y.framesize-Oe.FFTOFFSET),So(o.mf_size>=512+y.framesize-32)}}this.lame_encode_mp3_frame=function(y,k,o,H,j,V){var d,M=Ai([2,2]);M[0][0]=new t,M[0][1]=new t,M[1][0]=new t,M[1][1]=new t;var T=Ai([2,2]);T[0][0]=new t,T[0][1]=new t,T[1][0]=new t,T[1][1]=new t;var C,B=[null,null],i=y.internal_flags,w=Nm([2,4]),g=[.5,.5],h=[[0,0],[0,0]],b=[[0,0],[0,0]],x,c,u;if(B[0]=k,B[1]=o,i.lame_encode_frame_init==0&&f(y,B),i.padding=0,(i.slot_lag-=i.frac_SpF)<0&&(i.slot_lag+=y.out_samplerate,i.padding=1),i.psymodel!=0){var _,L=[null,null],Y=0,F=Im(2);for(u=0;u<i.mode_gr;u++){for(c=0;c<i.channels_out;c++)L[c]=B[c],Y=576+u*576-Oe.FFTOFFSET;if(y.VBR==ko.vbr_mtrh||y.VBR==ko.vbr_mt?_=s.L3psycho_anal_vbr(y,L,Y,u,M,T,h[u],b[u],w[u],F):_=s.L3psycho_anal_ns(y,L,Y,u,M,T,h[u],b[u],w[u],F),_!=0)return-4;for(y.mode==MPEGMode.JOINT_STEREO&&(g[u]=w[u][2]+w[u][3],g[u]>0&&(g[u]=w[u][3]/g[u])),c=0;c<i.channels_out;c++){var U=i.l3_side.tt[u][c];U.block_type=F[c],U.mixed_block_flag=0}}}else for(u=0;u<i.mode_gr;u++)for(c=0;c<i.channels_out;c++)i.l3_side.tt[u][c].block_type=Oe.NORM_TYPE,i.l3_side.tt[u][c].mixed_block_flag=0,b[u][c]=h[u][c]=700;if(v(i),O.mdct_sub48(i,B[0],B[1]),i.mode_ext=Oe.MPG_MD_LR_LR,y.force_ms)i.mode_ext=Oe.MPG_MD_MS_LR;else if(y.mode==MPEGMode.JOINT_STEREO){var l=0,p=0;for(u=0;u<i.mode_gr;u++)for(c=0;c<i.channels_out;c++)l+=b[u][c],p+=h[u][c];if(l<=1*p){var Z=i.l3_side.tt[0],W=i.l3_side.tt[i.mode_gr-1];Z[0].block_type==Z[1].block_type&&W[0].block_type==W[1].block_type&&(i.mode_ext=Oe.MPG_MD_MS_LR)}}if(i.mode_ext==n?(C=T,x=b):(C=M,x=h),y.analysis&&i.pinfo!=null)for(u=0;u<i.mode_gr;u++)for(c=0;c<i.channels_out;c++)i.pinfo.ms_ratio[u]=i.ms_ratio[u],i.pinfo.ms_ener_ratio[u]=g[u],i.pinfo.blocktype[u][c]=i.l3_side.tt[u][c].block_type,i.pinfo.pe[u][c]=x[u][c],Ri.arraycopy(i.l3_side.tt[u][c].xr,0,i.pinfo.xr[u][c],0,576),i.mode_ext==n&&(i.pinfo.ers[u][c]=i.pinfo.ers[u][c+2],Ri.arraycopy(i.pinfo.energy[u][c+2],0,i.pinfo.energy[u][c],0,i.pinfo.energy[u][c].length));if(y.VBR==ko.vbr_off||y.VBR==ko.vbr_abr){var re,me;for(re=0;re<18;re++)i.nsPsy.pefirbuf[re]=i.nsPsy.pefirbuf[re+1];for(me=0,u=0;u<i.mode_gr;u++)for(c=0;c<i.channels_out;c++)me+=x[u][c];for(i.nsPsy.pefirbuf[18]=me,me=i.nsPsy.pefirbuf[9],re=0;re<9;re++)me+=(i.nsPsy.pefirbuf[re]+i.nsPsy.pefirbuf[18-re])*Oe.fircoef[re];for(me=670*5*i.mode_gr*i.channels_out/me,u=0;u<i.mode_gr;u++)for(c=0;c<i.channels_out;c++)x[u][c]*=me}if(i.iteration_loop.iteration_loop(y,x,g,C),m.format_bitstream(y),d=m.copy_buffer(i,H,j,V,1),y.bWriteVbrTag&&S.addVbrFrame(y),y.analysis&&i.pinfo!=null){for(c=0;c<i.channels_out;c++){var ce;for(ce=0;ce<a;ce++)i.pinfo.pcmdata[c][ce]=i.pinfo.pcmdata[c][ce+y.framesize];for(ce=a;ce<1600;ce++)i.pinfo.pcmdata[c][ce]=B[c][ce-a]}A.set_frame_pinfo(y,C)}return N(i),d}}var Mt=Oe,Bi=Ze,Ci=Bi.Util,Oi=Bi.new_float,it=Mt;function Vm(){var e=Oi(it.BLKSIZE),t=Oi(it.BLKSIZE_s/2),a=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function n(s,S,A){var O=0,v,N,f;A<<=1;var y=S+A;v=4;do{var k,o,H,j,V,d,M;M=v>>1,j=v,V=v<<1,d=V+j,v=V<<1,N=S,f=N+M;do{var T,C,B,i;C=s[N+0]-s[N+j],T=s[N+0]+s[N+j],i=s[N+V]-s[N+d],B=s[N+V]+s[N+d],s[N+V]=T-B,s[N+0]=T+B,s[N+d]=C-i,s[N+j]=C+i,C=s[f+0]-s[f+j],T=s[f+0]+s[f+j],i=Ci.SQRT2*s[f+d],B=Ci.SQRT2*s[f+V],s[f+V]=T-B,s[f+0]=T+B,s[f+d]=C-i,s[f+j]=C+i,f+=v,N+=v}while(N<y);for(o=a[O+0],k=a[O+1],H=1;H<M;H++){var w,g;w=1-2*k*k,g=2*k*o,N=S+H,f=S+j-H;do{var h,b,x,T,C,c,B,u,i,_;b=g*s[N+j]-w*s[f+j],h=w*s[N+j]+g*s[f+j],C=s[N+0]-h,T=s[N+0]+h,c=s[f+0]-b,x=s[f+0]+b,b=g*s[N+d]-w*s[f+d],h=w*s[N+d]+g*s[f+d],i=s[N+V]-h,B=s[N+V]+h,_=s[f+V]-b,u=s[f+V]+b,b=k*B-o*_,h=o*B+k*_,s[N+V]=T-h,s[N+0]=T+h,s[f+d]=c-b,s[f+j]=c+b,b=o*u-k*i,h=k*u+o*i,s[f+V]=x-h,s[f+0]=x+h,s[N+d]=C-b,s[N+j]=C+b,f+=v,N+=v}while(N<y);w=o,o=w*a[O+0]-k*a[O+1],k=w*a[O+1]+k*a[O+0]}O+=2}while(v<A)}var m=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(s,S,A,O,v){for(var N=0;N<3;N++){var f=it.BLKSIZE_s/2,y=65535&576/3*(N+1),k=it.BLKSIZE_s/8-1;do{var o,H,j,V,d,M=m[k<<2]&255;o=t[M]*O[A][v+M+y],d=t[127-M]*O[A][v+M+y+128],H=o-d,o=o+d,j=t[M+64]*O[A][v+M+y+64],d=t[63-M]*O[A][v+M+y+192],V=j-d,j=j+d,f-=4,S[N][f+0]=o+j,S[N][f+2]=o-j,S[N][f+1]=H+V,S[N][f+3]=H-V,o=t[M+1]*O[A][v+M+y+1],d=t[126-M]*O[A][v+M+y+129],H=o-d,o=o+d,j=t[M+65]*O[A][v+M+y+65],d=t[62-M]*O[A][v+M+y+193],V=j-d,j=j+d,S[N][f+it.BLKSIZE_s/2+0]=o+j,S[N][f+it.BLKSIZE_s/2+2]=o-j,S[N][f+it.BLKSIZE_s/2+1]=H+V,S[N][f+it.BLKSIZE_s/2+3]=H-V}while(--k>=0);n(S[N],f,it.BLKSIZE_s/2)}},this.fft_long=function(s,S,A,O,v){var N=it.BLKSIZE/8-1,f=it.BLKSIZE/2;do{var y,k,o,H,j,V=m[N]&255;y=e[V]*O[A][v+V],j=e[V+512]*O[A][v+V+512],k=y-j,y=y+j,o=e[V+256]*O[A][v+V+256],j=e[V+768]*O[A][v+V+768],H=o-j,o=o+j,f-=4,S[f+0]=y+o,S[f+2]=y-o,S[f+1]=k+H,S[f+3]=k-H,y=e[V+1]*O[A][v+V+1],j=e[V+513]*O[A][v+V+513],k=y-j,y=y+j,o=e[V+257]*O[A][v+V+257],j=e[V+769]*O[A][v+V+769],H=o-j,o=o+j,S[f+it.BLKSIZE/2+0]=y+o,S[f+it.BLKSIZE/2+2]=y-o,S[f+it.BLKSIZE/2+1]=k+H,S[f+it.BLKSIZE/2+3]=k-H}while(--N>=0);n(S,f,it.BLKSIZE/2)},this.init_fft=function(s){for(var S=0;S<it.BLKSIZE;S++)e[S]=.42-.5*Math.cos(2*Math.PI*(S+.5)/it.BLKSIZE)+.08*Math.cos(4*Math.PI*(S+.5)/it.BLKSIZE);for(var S=0;S<it.BLKSIZE_s/2;S++)t[S]=.5*(1-Math.cos(2*Math.PI*(S+.5)/it.BLKSIZE_s))}}var jm=Vm,ha=Ze,ar=ha.VbrMode,Li=ha.Float,rr=ha.ShortBlock,Tt=ha.Util,Hm=ha.Arrays,dt=ha.new_float,qt=ha.new_float_n,Oa=ha.new_int,Te=ha.assert,Pm=jm,ae=Mt;function Fm(){var e=new Pm,t=2.302585092994046,a=2,n=16,m=2,s=16,S=.34,A=1/(14752*14752)/(ae.BLKSIZE/2),O=.01,v=.8,N=.6,f=.3,y=3.5,k=21,o=.2302585093;function H(E){return E}function j(E,R){for(var P=0,D=0;D<ae.BLKSIZE/2;++D)P+=E[D]*R.ATH.eql_w[D];return P*=A,P}function V(E,R,P,D,q,I,X,G,z,ee,K){var te=E.internal_flags;if(z<2)e.fft_long(te,D[q],z,ee,K),e.fft_short(te,I[X],z,ee,K);else if(z==2){for(var fe=ae.BLKSIZE-1;fe>=0;--fe){var Se=D[q+0][fe],oe=D[q+1][fe];D[q+0][fe]=(Se+oe)*Tt.SQRT2*.5,D[q+1][fe]=(Se-oe)*Tt.SQRT2*.5}for(var we=2;we>=0;--we)for(var fe=ae.BLKSIZE_s-1;fe>=0;--fe){var Se=I[X+0][we][fe],oe=I[X+1][we][fe];I[X+0][we][fe]=(Se+oe)*Tt.SQRT2*.5,I[X+1][we][fe]=(Se-oe)*Tt.SQRT2*.5}}R[0]=D[q+0][0],R[0]*=R[0];for(var fe=ae.BLKSIZE/2-1;fe>=0;--fe){var $=D[q+0][ae.BLKSIZE/2-fe],ge=D[q+0][ae.BLKSIZE/2+fe];R[ae.BLKSIZE/2-fe]=($*$+ge*ge)*.5}for(var we=2;we>=0;--we){P[we][0]=I[X+0][we][0],P[we][0]*=P[we][0];for(var fe=ae.BLKSIZE_s/2-1;fe>=0;--fe){var $=I[X+0][we][ae.BLKSIZE_s/2-fe],ge=I[X+0][we][ae.BLKSIZE_s/2+fe];P[we][ae.BLKSIZE_s/2-fe]=($*$+ge*ge)*.5}}{for(var Ae=0,fe=11;fe<ae.HBLKSIZE;fe++)Ae+=R[fe];te.tot_ener[z]=Ae}if(E.analysis){for(var fe=0;fe<ae.HBLKSIZE;fe++)te.pinfo.energy[G][z][fe]=te.pinfo.energy_save[z][fe],te.pinfo.energy_save[z][fe]=R[fe];te.pinfo.pe[G][z]=te.pe[z]}E.athaa_loudapprox==2&&z<2&&(te.loudness_sq[G][z]=te.loudness_sq_save[z],te.loudness_sq_save[z]=j(R,te))}var d=8,M=23,T=15,C,B,i,w=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function g(){C=Math.pow(10,(d+1)/16),B=Math.pow(10,(M+1)/16),i=Math.pow(10,T/10)}var h=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],b=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],x=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function c(E,R,P,D,q,I){var X;if(R>E)if(R<E*B)X=R/E;else return E+R;else{if(E>=R*B)return E+R;X=E/R}if(E+=R,D+3<=3+3){if(X>=C)return E;var G=0|Tt.FAST_LOG10_X(X,16);return E*b[G]}var G=0|Tt.FAST_LOG10_X(X,16);if(I!=0?R=q.ATH.cb_s[P]*q.ATH.adjust:R=q.ATH.cb_l[P]*q.ATH.adjust,E<i*R){if(E>R){var z,ee;return z=1,G<=13&&(z=x[G]),ee=Tt.FAST_LOG10_X(E/R,10/15),E*((h[G]-z)*ee+z)}return G>13?E:E*x[G]}return E*h[G]}var u=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function _(E,R,P){var D;if(E<0&&(E=0),R<0&&(R=0),E<=0)return R;if(R<=0)return E;if(R>E?D=R/E:D=E/R,-2<=P&&P<=2){if(D>=C)return E+R;var q=0|Tt.FAST_LOG10_X(D,16);return(E+R)*u[q]}return D<B?E+R:(E<R&&(E=R),E)}function L(E,R){var P=E.internal_flags;if(P.channels_out>1){for(var D=0;D<ae.SBMAX_l;D++){var q=P.thm[0].l[D],I=P.thm[1].l[D];P.thm[0].l[D]+=I*R,P.thm[1].l[D]+=q*R}for(var D=0;D<ae.SBMAX_s;D++)for(var X=0;X<3;X++){var q=P.thm[0].s[D][X],I=P.thm[1].s[D][X];P.thm[0].s[D][X]+=I*R,P.thm[1].s[D][X]+=q*R}}}function Y(E){for(var R=0;R<ae.SBMAX_l;R++)if(!(E.thm[0].l[R]>1.58*E.thm[1].l[R]||E.thm[1].l[R]>1.58*E.thm[0].l[R])){var P=E.mld_l[R]*E.en[3].l[R],D=Math.max(E.thm[2].l[R],Math.min(E.thm[3].l[R],P));P=E.mld_l[R]*E.en[2].l[R];var q=Math.max(E.thm[3].l[R],Math.min(E.thm[2].l[R],P));E.thm[2].l[R]=D,E.thm[3].l[R]=q}for(var R=0;R<ae.SBMAX_s;R++)for(var I=0;I<3;I++)if(!(E.thm[0].s[R][I]>1.58*E.thm[1].s[R][I]||E.thm[1].s[R][I]>1.58*E.thm[0].s[R][I])){var P=E.mld_s[R]*E.en[3].s[R][I],D=Math.max(E.thm[2].s[R][I],Math.min(E.thm[3].s[R][I],P));P=E.mld_s[R]*E.en[2].s[R][I];var q=Math.max(E.thm[3].s[R][I],Math.min(E.thm[2].s[R][I],P));E.thm[2].s[R][I]=D,E.thm[3].s[R][I]=q}}function F(E,R,P){var D=R,q=Math.pow(10,P);R*=2,D*=2;for(var I=0;I<ae.SBMAX_l;I++){var X,G,z,ee;if(ee=E.ATH.cb_l[E.bm_l[I]]*q,X=Math.min(Math.max(E.thm[0].l[I],ee),Math.max(E.thm[1].l[I],ee)),G=Math.max(E.thm[2].l[I],ee),z=Math.max(E.thm[3].l[I],ee),X*R<G+z){var K=X*D/(G+z);G*=K,z*=K}E.thm[2].l[I]=Math.min(G,E.thm[2].l[I]),E.thm[3].l[I]=Math.min(z,E.thm[3].l[I])}q*=ae.BLKSIZE_s/ae.BLKSIZE;for(var I=0;I<ae.SBMAX_s;I++)for(var te=0;te<3;te++){var X,G,z,ee;if(ee=E.ATH.cb_s[E.bm_s[I]]*q,X=Math.min(Math.max(E.thm[0].s[I][te],ee),Math.max(E.thm[1].s[I][te],ee)),G=Math.max(E.thm[2].s[I][te],ee),z=Math.max(E.thm[3].s[I][te],ee),X*R<G+z){var K=X*R/(G+z);G*=K,z*=K}E.thm[2].s[I][te]=Math.min(E.thm[2].s[I][te],G),E.thm[3].s[I][te]=Math.min(E.thm[3].s[I][te],z)}}function U(E,R,P,D,q){var I,X,G=0,z=0;for(I=X=0;I<ae.SBMAX_s;++X,++I){for(var ee=E.bo_s[I],K=E.npart_s,te=ee<K?ee:K;X<te;)Te(R[X]>=0),Te(P[X]>=0),G+=R[X],z+=P[X],X++;if(E.en[D].s[I][q]=G,E.thm[D].s[I][q]=z,X>=K){++I;break}Te(R[X]>=0),Te(P[X]>=0);{var fe=E.PSY.bo_s_weight[I],Se=1-fe;G=fe*R[X],z=fe*P[X],E.en[D].s[I][q]+=G,E.thm[D].s[I][q]+=z,G=Se*R[X],z=Se*P[X]}}for(;I<ae.SBMAX_s;++I)E.en[D].s[I][q]=0,E.thm[D].s[I][q]=0}function l(E,R,P,D){var q,I,X=0,G=0;for(q=I=0;q<ae.SBMAX_l;++I,++q){for(var z=E.bo_l[q],ee=E.npart_l,K=z<ee?z:ee;I<K;)Te(R[I]>=0),Te(P[I]>=0),X+=R[I],G+=P[I],I++;if(E.en[D].l[q]=X,E.thm[D].l[q]=G,I>=ee){++q;break}Te(R[I]>=0),Te(P[I]>=0);{var te=E.PSY.bo_l_weight[q],fe=1-te;X=te*R[I],G=te*P[I],E.en[D].l[q]+=X,E.thm[D].l[q]+=G,X=fe*R[I],G=fe*P[I]}}for(;q<ae.SBMAX_l;++q)E.en[D].l[q]=0,E.thm[D].l[q]=0}function p(E,R,P,D,q,I){var X=E.internal_flags,G,z;for(z=G=0;z<X.npart_s;++z){for(var ee=0,K=X.numlines_s[z],te=0;te<K;++te,++G){var fe=R[I][G];ee+=fe}P[z]=ee}for(Te(z==X.npart_s),G=z=0;z<X.npart_s;z++){var Se=X.s3ind_s[z][0],oe=X.s3_ss[G++]*P[Se];for(++Se;Se<=X.s3ind_s[z][1];)oe+=X.s3_ss[G]*P[Se],++G,++Se;{var we=m*X.nb_s1[q][z];D[z]=Math.min(oe,we)}if(X.blocktype_old[q&1]==ae.SHORT_TYPE){var we=s*X.nb_s2[q][z],$=D[z];D[z]=Math.min(we,$)}X.nb_s2[q][z]=X.nb_s1[q][z],X.nb_s1[q][z]=oe,Te(D[z]>=0)}for(;z<=ae.CBANDS;++z)P[z]=0,D[z]=0}function Z(E,R,P,D){var q=E.internal_flags;E.short_blocks==rr.short_block_coupled&&!(R[0]!=0&&R[1]!=0)&&(R[0]=R[1]=0);for(var I=0;I<q.channels_out;I++)D[I]=ae.NORM_TYPE,E.short_blocks==rr.short_block_dispensed&&(R[I]=1),E.short_blocks==rr.short_block_forced&&(R[I]=0),R[I]!=0?(Te(q.blocktype_old[I]!=ae.START_TYPE),q.blocktype_old[I]==ae.SHORT_TYPE&&(D[I]=ae.STOP_TYPE)):(D[I]=ae.SHORT_TYPE,q.blocktype_old[I]==ae.NORM_TYPE&&(q.blocktype_old[I]=ae.START_TYPE),q.blocktype_old[I]==ae.STOP_TYPE&&(q.blocktype_old[I]=ae.SHORT_TYPE)),P[I]=q.blocktype_old[I],q.blocktype_old[I]=D[I]}function W(E,R,P){return P>=1?E:P<=0?R:R>0?Math.pow(E/R,P)*R:0}var re=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function me(E,R){for(var P=309.07,D=0;D<ae.SBMAX_s-1;D++)for(var q=0;q<3;q++){var I=E.thm.s[D][q];if(I>0){var X=I*R,G=E.en.s[D][q];G>X&&(G>X*1e10?P+=re[D]*(10*t):P+=re[D]*Tt.FAST_LOG10(G/X))}}return P}var ce=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function he(E,R){for(var P=281.0575,D=0;D<ae.SBMAX_l-1;D++){var q=E.thm.l[D];if(q>0){var I=q*R,X=E.en.l[D];X>I&&(X>I*1e10?P+=ce[D]*(10*t):P+=ce[D]*Tt.FAST_LOG10(X/I))}}return P}function ke(E,R,P,D,q){var I,X;for(I=X=0;I<E.npart_l;++I){var G=0,z=0,ee;for(ee=0;ee<E.numlines_l[I];++ee,++X){var K=R[X];G+=K,z<K&&(z=K)}P[I]=G,D[I]=z,q[I]=G*E.rnumlines_l[I],Te(E.rnumlines_l[I]>=0),Te(P[I]>=0),Te(D[I]>=0),Te(q[I]>=0)}}function pe(E,R,P,D){var q=w.length-1,I=0,X=P[I]+P[I+1];if(X>0){var G=R[I];G<R[I+1]&&(G=R[I+1]),Te(E.numlines_l[I]+E.numlines_l[I+1]-1>0),X=20*(G*2-X)/(X*(E.numlines_l[I]+E.numlines_l[I+1]-1));var z=0|X;z>q&&(z=q),D[I]=z}else D[I]=0;for(I=1;I<E.npart_l-1;I++)if(X=P[I-1]+P[I]+P[I+1],X>0){var G=R[I-1];G<R[I]&&(G=R[I]),G<R[I+1]&&(G=R[I+1]),Te(E.numlines_l[I-1]+E.numlines_l[I]+E.numlines_l[I+1]-1>0),X=20*(G*3-X)/(X*(E.numlines_l[I-1]+E.numlines_l[I]+E.numlines_l[I+1]-1));var z=0|X;z>q&&(z=q),D[I]=z}else D[I]=0;if(Te(I==E.npart_l-1),X=P[I-1]+P[I],X>0){var G=R[I-1];G<R[I]&&(G=R[I]),Te(E.numlines_l[I-1]+E.numlines_l[I]-1>0),X=20*(G*2-X)/(X*(E.numlines_l[I-1]+E.numlines_l[I]-1));var z=0|X;z>q&&(z=q),D[I]=z}else D[I]=0;Te(I==E.npart_l-1)}var de=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(E,R,P,D,q,I,X,G,z,ee){var K=E.internal_flags,te=qt([2,ae.BLKSIZE]),fe=qt([2,3,ae.BLKSIZE_s]),Se=dt(ae.CBANDS+1),oe=dt(ae.CBANDS+1),we=dt(ae.CBANDS+2),$=Oa(2),ge=Oa(2),Ae,se,ye,ne,Ee,Ke,_e,Re,Ce=qt([2,576]),We,Ft=Oa(ae.CBANDS+2),ct=Oa(ae.CBANDS+2);for(Hm.fill(ct,0),Ae=K.channels_out,E.mode==MPEGMode.JOINT_STEREO&&(Ae=4),E.VBR==ar.vbr_off?We=K.ResvMax==0?0:K.ResvSize/K.ResvMax*.5:E.VBR==ar.vbr_rh||E.VBR==ar.vbr_mtrh||E.VBR==ar.vbr_mt?We=.6:We=1,se=0;se<K.channels_out;se++){var Qe=R[se],Lt=P+576-350-k+192;for(ne=0;ne<576;ne++){var Dt,Ut;for(Dt=Qe[Lt+ne+10],Ut=0,Ee=0;Ee<(k-1)/2-1;Ee+=2)Dt+=de[Ee]*(Qe[Lt+ne+Ee]+Qe[Lt+ne+k-Ee]),Ut+=de[Ee+1]*(Qe[Lt+ne+Ee+1]+Qe[Lt+ne+k-Ee-1]);Ce[se][ne]=Dt+Ut}q[D][se].en.assign(K.en[se]),q[D][se].thm.assign(K.thm[se]),Ae>2&&(I[D][se].en.assign(K.en[se+2]),I[D][se].thm.assign(K.thm[se+2]))}for(se=0;se<Ae;se++){var $t,Jt,St=dt(12),la=[0,0,0,0],mr=dt(12),js=1,u0,f0=dt(ae.CBANDS),_0=dt(ae.CBANDS),$e=[0,0,0,0],p0=dt(ae.HBLKSIZE),v0=qt([3,ae.HBLKSIZE_s]);for(Te(K.npart_s<=ae.CBANDS),Te(K.npart_l<=ae.CBANDS),ne=0;ne<3;ne++)St[ne]=K.nsPsy.last_en_subshort[se][ne+6],Te(K.nsPsy.last_en_subshort[se][ne+4]>0),mr[ne]=St[ne]/K.nsPsy.last_en_subshort[se][ne+4],la[0]+=St[ne];if(se==2)for(ne=0;ne<576;ne++){var Hs,Ps;Hs=Ce[0][ne],Ps=Ce[1][ne],Ce[0][ne]=Hs+Ps,Ce[1][ne]=Hs-Ps}{var g0=Ce[se&1],qr=0;for(ne=0;ne<9;ne++){for(var Sf=qr+64,pt=1;qr<Sf;qr++)pt<Math.abs(g0[qr])&&(pt=Math.abs(g0[qr]));K.nsPsy.last_en_subshort[se][ne]=St[ne+3]=pt,la[1+ne/3]+=pt,pt>St[ne+3-2]?(Te(St[ne+3-2]>0),pt=pt/St[ne+3-2]):St[ne+3-2]>pt*10?pt=St[ne+3-2]/(pt*10):pt=0,mr[ne+3]=pt}}if(E.analysis){var Fs=mr[0];for(ne=1;ne<12;ne++)Fs<mr[ne]&&(Fs=mr[ne]);K.pinfo.ers[D][se]=K.pinfo.ers_save[se],K.pinfo.ers_save[se]=Fs}for(u0=se==3?K.nsPsy.attackthre_s:K.nsPsy.attackthre,ne=0;ne<12;ne++)$e[ne/3]==0&&mr[ne]>u0&&($e[ne/3]=ne%3+1);for(ne=1;ne<4;ne++){var Ds;la[ne-1]>la[ne]?(Te(la[ne]>0),Ds=la[ne-1]/la[ne]):(Te(la[ne-1]>0),Ds=la[ne]/la[ne-1]),Ds<1.7&&($e[ne]=0,ne==1&&($e[0]=0))}for($e[0]!=0&&K.nsPsy.lastAttacks[se]!=0&&($e[0]=0),(K.nsPsy.lastAttacks[se]==3||$e[0]+$e[1]+$e[2]+$e[3]!=0)&&(js=0,$e[1]!=0&&$e[0]!=0&&($e[1]=0),$e[2]!=0&&$e[1]!=0&&($e[2]=0),$e[3]!=0&&$e[2]!=0&&($e[3]=0)),se<2?ge[se]=js:js==0&&(ge[0]=ge[1]=0),z[se]=K.tot_ener[se],Jt=fe,$t=te,V(E,p0,v0,$t,se&1,Jt,se&1,D,se,R,P),ke(K,p0,Se,f0,_0),pe(K,f0,_0,Ft),Re=0;Re<3;Re++){var Us,Nt;for(p(E,v0,oe,we,se,Re),U(K,oe,we,se,Re),_e=0;_e<ae.SBMAX_s;_e++){if(Nt=K.thm[se].s[_e][Re],Nt*=v,$e[Re]>=2||$e[Re+1]==1){var Xr=Re!=0?Re-1:2,pt=W(K.thm[se].s[_e][Xr],Nt,N*We);Nt=Math.min(Nt,pt)}if($e[Re]==1){var Xr=Re!=0?Re-1:2,pt=W(K.thm[se].s[_e][Xr],Nt,f*We);Nt=Math.min(Nt,pt)}else if(Re!=0&&$e[Re-1]==3||Re==0&&K.nsPsy.lastAttacks[se]==3){var Xr=Re!=2?Re+1:0,pt=W(K.thm[se].s[_e][Xr],Nt,f*We);Nt=Math.min(Nt,pt)}Us=St[Re*3+3]+St[Re*3+4]+St[Re*3+5],St[Re*3+5]*6<Us&&(Nt*=.5,St[Re*3+4]*6<Us&&(Nt*=.5)),K.thm[se].s[_e][Re]=Nt}}for(K.nsPsy.lastAttacks[se]=$e[2],Ke=0,ye=0;ye<K.npart_l;ye++){for(var qa=K.s3ind[ye][0],zs=Se[qa]*w[Ft[qa]],Xa=K.s3_ll[Ke++]*zs;++qa<=K.s3ind[ye][1];)zs=Se[qa]*w[Ft[qa]],Xa=c(Xa,K.s3_ll[Ke++]*zs,qa,qa-ye,K,0);Xa*=.158489319246111,K.blocktype_old[se&1]==ae.SHORT_TYPE?we[ye]=Xa:we[ye]=W(Math.min(Xa,Math.min(a*K.nb_1[se][ye],n*K.nb_2[se][ye])),Xa,We),K.nb_2[se][ye]=K.nb_1[se][ye],K.nb_1[se][ye]=Xa}for(;ye<=ae.CBANDS;++ye)Se[ye]=0,we[ye]=0;l(K,Se,we,se)}if((E.mode==MPEGMode.STEREO||E.mode==MPEGMode.JOINT_STEREO)&&E.interChRatio>0&&L(E,E.interChRatio),E.mode==MPEGMode.JOINT_STEREO){var qs;Y(K),qs=E.msfix,Math.abs(qs)>0&&F(K,qs,E.ATHlower*K.ATH.adjust)}for(Z(E,ge,ee,$),se=0;se<Ae;se++){var Yr,Gr=0,Ho,Po;se>1?(Yr=G,Gr=-2,Ho=ae.NORM_TYPE,(ee[0]==ae.SHORT_TYPE||ee[1]==ae.SHORT_TYPE)&&(Ho=ae.SHORT_TYPE),Po=I[D][se-2]):(Yr=X,Gr=0,Ho=ee[se],Po=q[D][se]),Ho==ae.SHORT_TYPE?Yr[Gr+se]=me(Po,K.masking_lower):Yr[Gr+se]=he(Po,K.masking_lower),E.analysis&&(K.pinfo.pe[D][se]=Yr[Gr+se])}return 0};function Me(E,R,P,D,q,I,X,G){var z=E.internal_flags;if(D<2)e.fft_long(z,X[G],D,R,P);else if(D==2)for(var ee=ae.BLKSIZE-1;ee>=0;--ee){var K=X[G+0][ee],te=X[G+1][ee];X[G+0][ee]=(K+te)*Tt.SQRT2*.5,X[G+1][ee]=(K-te)*Tt.SQRT2*.5}I[0]=X[G+0][0],I[0]*=I[0];for(var ee=ae.BLKSIZE/2-1;ee>=0;--ee){var fe=X[G+0][ae.BLKSIZE/2-ee],Se=X[G+0][ae.BLKSIZE/2+ee];I[ae.BLKSIZE/2-ee]=(fe*fe+Se*Se)*.5}{for(var oe=0,ee=11;ee<ae.HBLKSIZE;ee++)oe+=I[ee];z.tot_ener[D]=oe}if(E.analysis){for(var ee=0;ee<ae.HBLKSIZE;ee++)z.pinfo.energy[q][D][ee]=z.pinfo.energy_save[D][ee],z.pinfo.energy_save[D][ee]=I[ee];z.pinfo.pe[q][D]=z.pe[D]}}function je(E,R,P,D,q,I,X,G){var z=E.internal_flags;if(q==0&&D<2&&e.fft_short(z,X[G],D,R,P),D==2)for(var ee=ae.BLKSIZE_s-1;ee>=0;--ee){var K=X[G+0][q][ee],te=X[G+1][q][ee];X[G+0][q][ee]=(K+te)*Tt.SQRT2*.5,X[G+1][q][ee]=(K-te)*Tt.SQRT2*.5}I[q][0]=X[G+0][q][0],I[q][0]*=I[q][0];for(var ee=ae.BLKSIZE_s/2-1;ee>=0;--ee){var fe=X[G+0][q][ae.BLKSIZE_s/2-ee],Se=X[G+0][q][ae.BLKSIZE_s/2+ee];I[q][ae.BLKSIZE_s/2-ee]=(fe*fe+Se*Se)*.5}}function Be(E,R,P,D){var q=E.internal_flags;E.athaa_loudapprox==2&&P<2&&(q.loudness_sq[R][P]=q.loudness_sq_save[P],q.loudness_sq_save[P]=j(D,q))}var Fe=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function He(E,R,P,D,q,I,X,G,z,ee){for(var K=qt([2,576]),te=E.internal_flags,fe=te.channels_out,Se=E.mode==MPEGMode.JOINT_STEREO?4:fe,oe=0;oe<fe;oe++){firbuf=R[oe];for(var we=P+576-350-k+192,$=0;$<576;$++){var ge,Ae;ge=firbuf[we+$+10],Ae=0;for(var se=0;se<(k-1)/2-1;se+=2)ge+=Fe[se]*(firbuf[we+$+se]+firbuf[we+$+k-se]),Ae+=Fe[se+1]*(firbuf[we+$+se+1]+firbuf[we+$+k-se-1]);K[oe][$]=ge+Ae}q[D][oe].en.assign(te.en[oe]),q[D][oe].thm.assign(te.thm[oe]),Se>2&&(I[D][oe].en.assign(te.en[oe+2]),I[D][oe].thm.assign(te.thm[oe+2]))}for(var oe=0;oe<Se;oe++){var ye=dt(12),ne=dt(12),Ee=[0,0,0,0],Ke=K[oe&1],_e=0,Re=oe==3?te.nsPsy.attackthre_s:te.nsPsy.attackthre,Ce=1;if(oe==2)for(var $=0,se=576;se>0;++$,--se){var We=K[0][$],Ft=K[1][$];K[0][$]=We+Ft,K[1][$]=We-Ft}for(var $=0;$<3;$++)ne[$]=te.nsPsy.last_en_subshort[oe][$+6],Te(te.nsPsy.last_en_subshort[oe][$+4]>0),ye[$]=ne[$]/te.nsPsy.last_en_subshort[oe][$+4],Ee[0]+=ne[$];for(var $=0;$<9;$++){for(var ct=_e+64,Qe=1;_e<ct;_e++)Qe<Math.abs(Ke[_e])&&(Qe=Math.abs(Ke[_e]));te.nsPsy.last_en_subshort[oe][$]=ne[$+3]=Qe,Ee[1+$/3]+=Qe,Qe>ne[$+3-2]?(Te(ne[$+3-2]>0),Qe=Qe/ne[$+3-2]):ne[$+3-2]>Qe*10?Qe=ne[$+3-2]/(Qe*10):Qe=0,ye[$+3]=Qe}for(var $=0;$<3;++$){var Lt=ne[$*3+3]+ne[$*3+4]+ne[$*3+5],Dt=1;ne[$*3+5]*6<Lt&&(Dt*=.5,ne[$*3+4]*6<Lt&&(Dt*=.5)),G[oe][$]=Dt}if(E.analysis){for(var Ut=ye[0],$=1;$<12;$++)Ut<ye[$]&&(Ut=ye[$]);te.pinfo.ers[D][oe]=te.pinfo.ers_save[oe],te.pinfo.ers_save[oe]=Ut}for(var $=0;$<12;$++)z[oe][$/3]==0&&ye[$]>Re&&(z[oe][$/3]=$%3+1);for(var $=1;$<4;$++){var $t=Ee[$-1],Jt=Ee[$],St=Math.max($t,Jt);St<4e4&&$t<1.7*Jt&&Jt<1.7*$t&&($==1&&z[oe][0]<=z[oe][$]&&(z[oe][0]=0),z[oe][$]=0)}z[oe][0]<=te.nsPsy.lastAttacks[oe]&&(z[oe][0]=0),(te.nsPsy.lastAttacks[oe]==3||z[oe][0]+z[oe][1]+z[oe][2]+z[oe][3]!=0)&&(Ce=0,z[oe][1]!=0&&z[oe][0]!=0&&(z[oe][1]=0),z[oe][2]!=0&&z[oe][1]!=0&&(z[oe][2]=0),z[oe][3]!=0&&z[oe][2]!=0&&(z[oe][3]=0)),oe<2?ee[oe]=Ce:Ce==0&&(ee[0]=ee[1]=0),X[oe]=te.tot_ener[oe]}}function Pe(E,R,P){if(P==0)for(var D=0;D<E.npart_s;D++)E.nb_s2[R][D]=E.nb_s1[R][D],E.nb_s1[R][D]=0}function Ge(E,R){for(var P=0;P<E.npart_l;P++)E.nb_2[R][P]=E.nb_1[R][P],E.nb_1[R][P]=0}function xt(E,R,P,D){var q=w.length-1,I=0,X=P[I]+P[I+1];if(X>0){var G=R[I];G<R[I+1]&&(G=R[I+1]),Te(E.numlines_s[I]+E.numlines_s[I+1]-1>0),X=20*(G*2-X)/(X*(E.numlines_s[I]+E.numlines_s[I+1]-1));var z=0|X;z>q&&(z=q),D[I]=z}else D[I]=0;for(I=1;I<E.npart_s-1;I++)if(X=P[I-1]+P[I]+P[I+1],Te(I+1<E.npart_s),X>0){var G=R[I-1];G<R[I]&&(G=R[I]),G<R[I+1]&&(G=R[I+1]),Te(E.numlines_s[I-1]+E.numlines_s[I]+E.numlines_s[I+1]-1>0),X=20*(G*3-X)/(X*(E.numlines_s[I-1]+E.numlines_s[I]+E.numlines_s[I+1]-1));var z=0|X;z>q&&(z=q),D[I]=z}else D[I]=0;if(Te(I==E.npart_s-1),X=P[I-1]+P[I],X>0){var G=R[I-1];G<R[I]&&(G=R[I]),Te(E.numlines_s[I-1]+E.numlines_s[I]-1>0),X=20*(G*2-X)/(X*(E.numlines_s[I-1]+E.numlines_s[I]-1));var z=0|X;z>q&&(z=q),D[I]=z}else D[I]=0;Te(I==E.npart_s-1)}function ut(E,R,P,D,q,I){var X=E.internal_flags,G=new float[ae.CBANDS],z=dt(ae.CBANDS),ee,K,te,fe=new int[ae.CBANDS];for(te=K=0;te<X.npart_s;++te){var Se=0,oe=0,we=X.numlines_s[te];for(ee=0;ee<we;++ee,++K){var $=R[I][K];Se+=$,oe<$&&(oe=$)}P[te]=Se,G[te]=oe,z[te]=Se/we,Te(z[te]>=0)}for(Te(te==X.npart_s);te<ae.CBANDS;++te)G[te]=0,z[te]=0;for(xt(X,G,z,fe),K=te=0;te<X.npart_s;te++){var ge=X.s3ind_s[te][0],Ae=X.s3ind_s[te][1],se,ye,ne,Ee,Ke;for(se=fe[ge],ye=1,Ee=X.s3_ss[K]*P[ge]*w[fe[ge]],++K,++ge;ge<=Ae;)se+=fe[ge],ye+=1,ne=X.s3_ss[K]*P[ge]*w[fe[ge]],Ee=_(Ee,ne,ge-te),++K,++ge;se=(1+2*se)/(2*ye),Ke=w[se]*.5,Ee*=Ke,D[te]=Ee,X.nb_s2[q][te]=X.nb_s1[q][te],X.nb_s1[q][te]=Ee,ne=G[te],ne*=X.minval_s[te],ne*=Ke,D[te]>ne&&(D[te]=ne),X.masking_lower>1&&(D[te]*=X.masking_lower),D[te]>P[te]&&(D[te]=P[te]),X.masking_lower<1&&(D[te]*=X.masking_lower),Te(D[te]>=0)}for(;te<ae.CBANDS;++te)P[te]=0,D[te]=0}function lt(E,R,P,D,q){var I=dt(ae.CBANDS),X=dt(ae.CBANDS),G=Oa(ae.CBANDS+2),z;ke(E,R,P,I,X),pe(E,I,X,G);var ee=0;for(z=0;z<E.npart_l;z++){var K,te,fe,Se,oe=E.s3ind[z][0],we=E.s3ind[z][1],$=0,ge=0;for($=G[oe],ge+=1,te=E.s3_ll[ee]*P[oe]*w[G[oe]],++ee,++oe;oe<=we;)$+=G[oe],ge+=1,K=E.s3_ll[ee]*P[oe]*w[G[oe]],Se=_(te,K,oe-z),te=Se,++ee,++oe;if($=(1+2*$)/(2*ge),fe=w[$]*.5,te*=fe,E.blocktype_old[q&1]==ae.SHORT_TYPE){var Ae=a*E.nb_1[q][z];Ae>0?D[z]=Math.min(te,Ae):D[z]=Math.min(te,P[z]*f)}else{var se=n*E.nb_2[q][z],ye=a*E.nb_1[q][z],Ae;se<=0&&(se=te),ye<=0&&(ye=te),E.blocktype_old[q&1]==ae.NORM_TYPE?Ae=Math.min(ye,se):Ae=ye,D[z]=Math.min(te,Ae)}E.nb_2[q][z]=E.nb_1[q][z],E.nb_1[q][z]=te,K=I[z],K*=E.minval_l[z],K*=fe,D[z]>K&&(D[z]=K),E.masking_lower>1&&(D[z]*=E.masking_lower),D[z]>P[z]&&(D[z]=P[z]),E.masking_lower<1&&(D[z]*=E.masking_lower),Te(D[z]>=0)}for(;z<ae.CBANDS;++z)P[z]=0,D[z]=0}function wt(E,R){var P=E.internal_flags;E.short_blocks==rr.short_block_coupled&&!(R[0]!=0&&R[1]!=0)&&(R[0]=R[1]=0);for(var D=0;D<P.channels_out;D++)E.short_blocks==rr.short_block_dispensed&&(R[D]=1),E.short_blocks==rr.short_block_forced&&(R[D]=0)}function Ot(E,R,P){for(var D=E.internal_flags,q=0;q<D.channels_out;q++){var I=ae.NORM_TYPE;R[q]!=0?(Te(D.blocktype_old[q]!=ae.START_TYPE),D.blocktype_old[q]==ae.SHORT_TYPE&&(I=ae.STOP_TYPE)):(I=ae.SHORT_TYPE,D.blocktype_old[q]==ae.NORM_TYPE&&(D.blocktype_old[q]=ae.START_TYPE),D.blocktype_old[q]==ae.STOP_TYPE&&(D.blocktype_old[q]=ae.SHORT_TYPE)),P[q]=D.blocktype_old[q],D.blocktype_old[q]=I}}function Pt(E,R,P,D,q,I,X){for(var G=I*2,z=I>0?Math.pow(10,q):1,ee,K,te=0;te<X;++te){var fe=E[2][te],Se=E[3][te],oe=R[0][te],we=R[1][te],$=R[2][te],ge=R[3][te];if(oe<=1.58*we&&we<=1.58*oe){var Ae=P[te]*Se,se=P[te]*fe;K=Math.max($,Math.min(ge,Ae)),ee=Math.max(ge,Math.min($,se))}else K=$,ee=ge;if(I>0){var ye,ne,Ee=D[te]*z;if(ye=Math.min(Math.max(oe,Ee),Math.max(we,Ee)),$=Math.max(K,Ee),ge=Math.max(ee,Ee),ne=$+ge,ne>0&&ye*G<ne){var Ke=ye*G/ne;$*=Ke,ge*=Ke}K=Math.min($,K),ee=Math.min(ge,ee)}K>fe&&(K=fe),ee>Se&&(ee=Se),R[2][te]=K,R[3][te]=ee}}this.L3psycho_anal_vbr=function(E,R,P,D,q,I,X,G,z,ee){var K=E.internal_flags,te,fe,Se=dt(ae.HBLKSIZE),oe=qt([3,ae.HBLKSIZE_s]),we=qt([2,ae.BLKSIZE]),$=qt([2,3,ae.BLKSIZE_s]),ge=qt([4,ae.CBANDS]),Ae=qt([4,ae.CBANDS]),se=qt([4,3]),ye=.6,ne=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],Ee=Oa(2),Ke=E.mode==MPEGMode.JOINT_STEREO?4:K.channels_out;He(E,R,P,D,q,I,z,se,ne,Ee),wt(E,Ee);{for(var _e=0;_e<Ke;_e++){var Re=_e&1;te=we,Me(E,R,P,_e,D,Se,te,Re),Be(E,D,_e,Se),Ee[Re]!=0?lt(K,Se,ge[_e],Ae[_e],_e):Ge(K,_e)}Ee[0]+Ee[1]==2&&E.mode==MPEGMode.JOINT_STEREO&&Pt(ge,Ae,K.mld_cb_l,K.ATH.cb_l,E.ATHlower*K.ATH.adjust,E.msfix,K.npart_l);for(var _e=0;_e<Ke;_e++){var Re=_e&1;Ee[Re]!=0&&l(K,ge[_e],Ae[_e],_e)}}{for(var Ce=0;Ce<3;Ce++){for(var _e=0;_e<Ke;++_e){var Re=_e&1;Ee[Re]!=0?Pe(K,_e,Ce):(fe=$,je(E,R,P,_e,Ce,oe,fe,Re),ut(E,oe,ge[_e],Ae[_e],_e,Ce))}Ee[0]+Ee[1]==0&&E.mode==MPEGMode.JOINT_STEREO&&Pt(ge,Ae,K.mld_cb_s,K.ATH.cb_s,E.ATHlower*K.ATH.adjust,E.msfix,K.npart_s);for(var _e=0;_e<Ke;++_e){var Re=_e&1;Ee[Re]==0&&U(K,ge[_e],Ae[_e],_e,Ce)}}for(var _e=0;_e<Ke;_e++){var Re=_e&1;if(Ee[Re]==0)for(var We=0;We<ae.SBMAX_s;We++){for(var Ft=dt(3),Ce=0;Ce<3;Ce++){var ct=K.thm[_e].s[We][Ce];if(ct*=v,ne[_e][Ce]>=2||ne[_e][Ce+1]==1){var Qe=Ce!=0?Ce-1:2,Lt=W(K.thm[_e].s[We][Qe],ct,N*ye);ct=Math.min(ct,Lt)}else if(ne[_e][Ce]==1){var Qe=Ce!=0?Ce-1:2,Lt=W(K.thm[_e].s[We][Qe],ct,f*ye);ct=Math.min(ct,Lt)}else if(Ce!=0&&ne[_e][Ce-1]==3||Ce==0&&K.nsPsy.lastAttacks[_e]==3){var Qe=Ce!=2?Ce+1:0,Lt=W(K.thm[_e].s[We][Qe],ct,f*ye);ct=Math.min(ct,Lt)}ct*=se[_e][Ce],Ft[Ce]=ct}for(var Ce=0;Ce<3;Ce++)K.thm[_e].s[We][Ce]=Ft[Ce]}}}for(var _e=0;_e<Ke;_e++)K.nsPsy.lastAttacks[_e]=ne[_e][2];Ot(E,Ee,ee);for(var _e=0;_e<Ke;_e++){var Dt,Ut,$t,Jt;_e>1?(Dt=G,Ut=-2,$t=ae.NORM_TYPE,(ee[0]==ae.SHORT_TYPE||ee[1]==ae.SHORT_TYPE)&&($t=ae.SHORT_TYPE),Jt=I[D][_e-2]):(Dt=X,Ut=0,$t=ee[_e],Jt=q[D][_e]),$t==ae.SHORT_TYPE?Dt[Ut+_e]=me(Jt,K.masking_lower):Dt[Ut+_e]=he(Jt,K.masking_lower),E.analysis&&(K.pinfo.pe[D][_e]=Dt[Ut+_e])}return 0};function ht(E,R){var P=E,D;return P>=0?D=-P*27:D=P*R,D<=-72?0:Math.exp(D*o)}function Yt(E){var R=0,P=0;{var D=0,q,I;for(D=0;ht(D,E)>1e-20;D-=1);for(q=D,I=0;Math.abs(I-q)>1e-12;)D=(I+q)/2,ht(D,E)>0?I=D:q=D;R=q}{var D=0,q,I;for(D=0;ht(D,E)>1e-20;D+=1);for(q=0,I=D;Math.abs(I-q)>1e-12;)D=(I+q)/2,ht(D,E)>0?q=D:I=D;P=I}{var X=0,G=1e3,z;for(z=0;z<=G;++z){var D=R+z*(P-R)/G,ee=ht(D,E);X+=ee}{var K=(G+1)/(X*(P-R));return K}}}function kt(E){var R,P,D,q;return R=E,R>=0?R*=3:R*=1.5,R>=.5&&R<=2.5?(q=R-.5,P=8*(q*q-2*q)):P=0,R+=.474,D=15.811389+7.5*R-17.5*Math.sqrt(1+R*R),D<=-60?0:(R=Math.exp((P+D)*o),R/=.6609193,R)}function _t(E){return E<0&&(E=0),E=E*.001,13*Math.atan(.76*E)+3.5*Math.atan(E*E/(7.5*7.5))}function le(E,R,P,D,q,I,X,G,z,ee,K,te){var fe=dt(ae.CBANDS+1),Se=G/(te>15?2*576:2*192),oe=Oa(ae.HBLKSIZE),we;G/=z;var $=0,ge=0;for(we=0;we<ae.CBANDS;we++){var Ae,se;for(Ae=_t(G*$),fe[we]=G*$,se=$;_t(G*se)-Ae<S&&se<=z/2;se++);for(E[we]=se-$,ge=we+1;$<se;)oe[$++]=we;if($>z/2){$=z/2,++we;break}}fe[we]=G*$;for(var ye=0;ye<te;ye++){var ne,Ee,Ke,_e,Re;Ke=ee[ye],_e=ee[ye+1],ne=0|Math.floor(.5+K*(Ke-.5)),ne<0&&(ne=0),Ee=0|Math.floor(.5+K*(_e-.5)),Ee>z/2&&(Ee=z/2),P[ye]=(oe[ne]+oe[Ee])/2,R[ye]=oe[Ee];var Ce=Se*_e;X[ye]=(Ce-fe[R[ye]])/(fe[R[ye]+1]-fe[R[ye]]),X[ye]<0?X[ye]=0:X[ye]>1&&(X[ye]=1),Re=_t(G*ee[ye]*K),Re=Math.min(Re,15.5)/15.5,I[ye]=Math.pow(10,1.25*(1-Math.cos(Math.PI*Re))-2.5)}$=0;for(var We=0;We<ge;We++){var Ft=E[We],Ae,ct;Ae=_t(G*$),ct=_t(G*($+Ft-1)),D[We]=.5*(Ae+ct),Ae=_t(G*($-.5)),ct=_t(G*($+Ft-.5)),q[We]=ct-Ae,$+=Ft}return ge}function ve(E,R,P,D,q,I){var X=qt([ae.CBANDS,ae.CBANDS]),G,z=0;if(I)for(var ee=0;ee<R;ee++)for(G=0;G<R;G++){var K=kt(P[ee]-P[G])*D[G];X[ee][G]=K*q[ee]}else for(G=0;G<R;G++)for(var te=15+Math.min(21/P[G],12),fe=Yt(te),ee=0;ee<R;ee++){var K=fe*ht(P[ee]-P[G],te)*D[G];X[ee][G]=K*q[ee]}for(var ee=0;ee<R;ee++){for(G=0;G<R&&!(X[ee][G]>0);G++);for(E[ee][0]=G,G=R-1;G>0&&!(X[ee][G]>0);G--);E[ee][1]=G,z+=E[ee][1]-E[ee][0]+1}for(var Se=dt(z),oe=0,ee=0;ee<R;ee++)for(G=E[ee][0];G<=E[ee][1];G++)Se[oe++]=X[ee][G];return Se}function J(E){var R=_t(E);return R=Math.min(R,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*R))-2.5)}this.psymodel_init=function(E){var R=E.internal_flags,P,D=!0,q=13,I=24,X=0,G=0,z=-8.25,ee=-4.5,K=dt(ae.CBANDS),te=dt(ae.CBANDS),fe=dt(ae.CBANDS),Se=E.out_samplerate;switch(E.experimentalZ){default:case 0:D=!0;break;case 1:D=!(E.VBR==ar.vbr_mtrh||E.VBR==ar.vbr_mt);break;case 2:D=!1;break;case 3:q=8,X=-1.75,G=-.0125,z=-8.25,ee=-2.25;break}for(R.ms_ener_ratio_old=.25,R.blocktype_old[0]=R.blocktype_old[1]=ae.NORM_TYPE,P=0;P<4;++P){for(var $=0;$<ae.CBANDS;++$)R.nb_1[P][$]=1e20,R.nb_2[P][$]=1e20,R.nb_s1[P][$]=R.nb_s2[P][$]=1;for(var oe=0;oe<ae.SBMAX_l;oe++)R.en[P].l[oe]=1e20,R.thm[P].l[oe]=1e20;for(var $=0;$<3;++$){for(var oe=0;oe<ae.SBMAX_s;oe++)R.en[P].s[oe][$]=1e20,R.thm[P].s[oe][$]=1e20;R.nsPsy.lastAttacks[P]=0}for(var $=0;$<9;$++)R.nsPsy.last_en_subshort[P][$]=10}for(R.loudness_sq_save[0]=R.loudness_sq_save[1]=0,R.npart_l=le(R.numlines_l,R.bo_l,R.bm_l,K,te,R.mld_l,R.PSY.bo_l_weight,Se,ae.BLKSIZE,R.scalefac_band.l,ae.BLKSIZE/(2*576),ae.SBMAX_l),Te(R.npart_l<ae.CBANDS),P=0;P<R.npart_l;P++){var we=X;K[P]>=q&&(we=G*(K[P]-q)/(I-q)+X*(I-K[P])/(I-q)),fe[P]=Math.pow(10,we/10),R.numlines_l[P]>0?R.rnumlines_l[P]=1/R.numlines_l[P]:R.rnumlines_l[P]=0}R.s3_ll=ve(R.s3ind,R.npart_l,K,te,fe,D);var $=0;for(P=0;P<R.npart_l;P++){var ge;ge=Li.MAX_VALUE;for(var Ae=0;Ae<R.numlines_l[P];Ae++,$++){var se=Se*$/(1e3*ae.BLKSIZE),ye;ye=this.ATHformula(se*1e3,E)-20,ye=Math.pow(10,.1*ye),ye*=R.numlines_l[P],ge>ye&&(ge=ye)}R.ATH.cb_l[P]=ge,ge=-20+K[P]*20/10,ge>6&&(ge=100),ge<-15&&(ge=-15),ge-=8,R.minval_l[P]=Math.pow(10,ge/10)*R.numlines_l[P]}for(R.npart_s=le(R.numlines_s,R.bo_s,R.bm_s,K,te,R.mld_s,R.PSY.bo_s_weight,Se,ae.BLKSIZE_s,R.scalefac_band.s,ae.BLKSIZE_s/(2*192),ae.SBMAX_s),Te(R.npart_s<ae.CBANDS),$=0,P=0;P<R.npart_s;P++){var ge,we=z;K[P]>=q&&(we=ee*(K[P]-q)/(I-q)+z*(I-K[P])/(I-q)),fe[P]=Math.pow(10,we/10),ge=Li.MAX_VALUE;for(var Ae=0;Ae<R.numlines_s[P];Ae++,$++){var se=Se*$/(1e3*ae.BLKSIZE_s),ye;ye=this.ATHformula(se*1e3,E)-20,ye=Math.pow(10,.1*ye),ye*=R.numlines_s[P],ge>ye&&(ge=ye)}R.ATH.cb_s[P]=ge,ge=-7+K[P]*7/12,K[P]>12&&(ge*=1+Math.log(1+ge)*3.1),K[P]<12&&(ge*=1+Math.log(1-ge)*2.3),ge<-15&&(ge=-15),ge-=8,R.minval_s[P]=Math.pow(10,ge/10)*R.numlines_s[P]}R.s3_ss=ve(R.s3ind_s,R.npart_s,K,te,fe,D),g(),e.init_fft(R),R.decay=Math.exp(-1*t/(O*Se/192));{var ne;ne=y,(E.exp_nspsytune&2)!=0&&(ne=1),Math.abs(E.msfix)>0&&(ne=E.msfix),E.msfix=ne;for(var Ee=0;Ee<R.npart_l;Ee++)R.s3ind[Ee][1]>R.npart_l-1&&(R.s3ind[Ee][1]=R.npart_l-1)}var Ke=576*R.mode_gr/Se;if(R.ATH.decay=Math.pow(10,-12/10*Ke),R.ATH.adjust=.01,R.ATH.adjustLimit=1,Te(R.bo_l[ae.SBMAX_l-1]<=R.npart_l),Te(R.bo_s[ae.SBMAX_s-1]<=R.npart_s),E.ATHtype!=-1){var se,_e=E.out_samplerate/ae.BLKSIZE,Re=0;for(se=0,P=0;P<ae.BLKSIZE/2;++P)se+=_e,R.ATH.eql_w[P]=1/Math.pow(10,this.ATHformula(se,E)/10),Re+=R.ATH.eql_w[P];for(Re=1/Re,P=ae.BLKSIZE/2;--P>=0;)R.ATH.eql_w[P]*=Re}{for(var Ee=$=0;Ee<R.npart_s;++Ee)for(P=0;P<R.numlines_s[Ee];++P)++$;for(var Ee=$=0;Ee<R.npart_l;++Ee)for(P=0;P<R.numlines_l[Ee];++P)++$}for($=0,P=0;P<R.npart_l;P++){var se=Se*($+R.numlines_l[P]/2)/(1*ae.BLKSIZE);R.mld_cb_l[P]=J(se),$+=R.numlines_l[P]}for(;P<ae.CBANDS;++P)R.mld_cb_l[P]=1;for($=0,P=0;P<R.npart_s;P++){var se=Se*($+R.numlines_s[P]/2)/(1*ae.BLKSIZE_s);R.mld_cb_s[P]=J(se),$+=R.numlines_s[P]}for(;P<ae.CBANDS;++P)R.mld_cb_s[P]=1;return 0};function be(E,R){E<-.3&&(E=3410),E/=1e3,E=Math.max(.1,E);var P=3.64*Math.pow(E,-.8)-6.8*Math.exp(-.6*Math.pow(E-3.4,2))+6*Math.exp(-.15*Math.pow(E-8.7,2))+(.6+.04*R)*.001*Math.pow(E,4);return P}this.ATHformula=function(E,R){var P;switch(R.ATHtype){case 0:P=be(E,9);break;case 1:P=be(E,-1);break;case 2:P=be(E,0);break;case 3:P=be(E,1)+6;break;case 4:P=be(E,R.ATHcurve);break;default:P=be(E,0);break}return P}}var Dm=Fm;function Wt(e){var t=e;this.ordinal=function(){return t}}Wt.STEREO=new Wt(0),Wt.JOINT_STEREO=new Wt(1),Wt.DUAL_CHANNEL=new Wt(2),Wt.MONO=new Wt(3),Wt.NOT_SET=new Wt(4);var Ni=Wt,Um=Ni;function zm(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=Um.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var qm=zm,Xm=Mt,Ii={};Ii.SFBMAX=Xm.SBMAX_s*3;var Eo=Ii,Vi=Ze,Ym=Vi.new_float,La=Vi.new_int,xs=Eo;function Gm(){this.xr=Ym(576),this.l3_enc=La(576),this.scalefac=La(xs.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=La(3),this.subblock_gain=La(3+1),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=La(xs.SFBMAX),this.window=La(xs.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=La(4),this.max_nonzero_coeff=0;var e=this;function t(n){return new Int32Array(n)}function a(n){return new Float32Array(n)}this.assign=function(n){e.xr=a(n.xr),e.l3_enc=t(n.l3_enc),e.scalefac=t(n.scalefac),e.xrpow_max=n.xrpow_max,e.part2_3_length=n.part2_3_length,e.big_values=n.big_values,e.count1=n.count1,e.global_gain=n.global_gain,e.scalefac_compress=n.scalefac_compress,e.block_type=n.block_type,e.mixed_block_flag=n.mixed_block_flag,e.table_select=t(n.table_select),e.subblock_gain=t(n.subblock_gain),e.region0_count=n.region0_count,e.region1_count=n.region1_count,e.preflag=n.preflag,e.scalefac_scale=n.scalefac_scale,e.count1table_select=n.count1table_select,e.part2_length=n.part2_length,e.sfb_lmax=n.sfb_lmax,e.sfb_smin=n.sfb_smin,e.psy_lmax=n.psy_lmax,e.sfbmax=n.sfbmax,e.psymax=n.psymax,e.sfbdivide=n.sfbdivide,e.width=t(n.width),e.window=t(n.window),e.count1bits=n.count1bits,e.sfb_partition_table=n.sfb_partition_table.slice(0),e.slen=t(n.slen),e.max_nonzero_coeff=n.max_nonzero_coeff}}var ws=Gm,Km=Ze,ji=Km.new_int,Zm=ws;function Wm(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[ji(4),ji(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new Zm}var Qm=Wm,Hi=Ze,Mo=Hi.System,Ro=Hi.new_int,Ao=Mt;function $m(e,t,a,n){this.l=Ro(1+Ao.SBMAX_l),this.s=Ro(1+Ao.SBMAX_s),this.psfb21=Ro(1+Ao.PSFB21),this.psfb12=Ro(1+Ao.PSFB12);var m=this.l,s=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],Mo.arraycopy(this.arrL,0,m,0,Math.min(this.arrL.length,this.l.length)),Mo.arraycopy(this.arrS,0,s,0,Math.min(this.arrS.length,this.s.length)),Mo.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),Mo.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var Pi=$m,ks=Ze,Ss=ks.new_float,Jm=ks.new_float_n,e2=ks.new_int,Fi=Mt;function t2(){this.last_en_subshort=Jm([4,9]),this.lastAttacks=e2(4),this.pefirbuf=Ss(19),this.longfact=Ss(Fi.SBMAX_l),this.shortfact=Ss(Fi.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var a2=t2;function r2(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var o2=r2,or=Ze,s2=or.new_byte,n2=or.new_double,Xt=or.new_float,Na=or.new_float_n,Qt=or.new_int,To=or.new_int_n,i2=Qm,l2=Pi,c2=a2,d2=o2,Di=Ei,at=Mt,m2=Eo;ua.MFSIZE=3*1152+at.ENCDELAY-at.MDCTDELAY,ua.MAX_HEADER_BUF=256,ua.MAX_BITS_PER_CHANNEL=4095,ua.MAX_BITS_PER_GRANULE=7680,ua.BPC=320;function ua(){var e=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=Na([2,ua.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new i2,this.ms_ratio=Xt(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=Qt(2),this.CurrentStep=Qt(2),this.masking_lower=0,this.bv_scf=Qt(576),this.pseudohalf=Qt(m2.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*ua.BPC+1),this.itime=n2(2),this.sideinfo_len=0,this.sb_sample=Na([2,2,18,at.SBLIMIT]),this.amp_filter=Xt(32);function t(){this.write_timing=0,this.ptr=0,this.buf=s2(e)}this.header=new Array(ua.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new l2,this.minval_l=Xt(at.CBANDS),this.minval_s=Xt(at.CBANDS),this.nb_1=Na([4,at.CBANDS]),this.nb_2=Na([4,at.CBANDS]),this.nb_s1=Na([4,at.CBANDS]),this.nb_s2=Na([4,at.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=Xt(4),this.loudness_sq=Na([2,2]),this.loudness_sq_save=Xt(2),this.mld_l=Xt(at.SBMAX_l),this.mld_s=Xt(at.SBMAX_s),this.bm_l=Qt(at.SBMAX_l),this.bo_l=Qt(at.SBMAX_l),this.bm_s=Qt(at.SBMAX_s),this.bo_s=Qt(at.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=To([at.CBANDS,2]),this.s3ind_s=To([at.CBANDS,2]),this.numlines_s=Qt(at.CBANDS),this.numlines_l=Qt(at.CBANDS),this.rnumlines_l=Xt(at.CBANDS),this.mld_cb_l=Xt(at.CBANDS),this.mld_cb_s=Xt(at.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Xt(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=Qt(2),this.nsPsy=new c2,this.VBR_seek_table=new d2,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=To([16,4+1]),this.bitrate_blockType_Hist=To([16,4+1+1]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var a=0;a<this.en.length;a++)this.en[a]=new Di;for(var a=0;a<this.thm.length;a++)this.thm[a]=new Di;for(var a=0;a<this.header.length;a++)this.header[a]=new t}var Bo=ua,h2=Ze,Ia=h2.new_float,Va=Mt;function u2(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=Ia(Va.SBMAX_l),this.s=Ia(Va.SBMAX_s),this.psfb21=Ia(Va.PSFB21),this.psfb12=Ia(Va.PSFB12),this.cb_l=Ia(Va.CBANDS),this.cb_s=Ia(Va.CBANDS),this.eql_w=Ia(Va.BLKSIZE/2)}var f2=u2,Ui=Ze,Bt=Ui.System,zi=Ui.Arrays;rt.STEPS_per_dB=100,rt.MAX_dB=120,rt.GAIN_NOT_ENOUGH_SAMPLES=-24601,rt.GAIN_ANALYSIS_ERROR=0,rt.GAIN_ANALYSIS_OK=1,rt.INIT_GAIN_ANALYSIS_ERROR=0,rt.INIT_GAIN_ANALYSIS_OK=1,rt.YULE_ORDER=10,rt.MAX_ORDER=rt.YULE_ORDER,rt.MAX_SAMP_FREQ=48e3,rt.RMS_WINDOW_TIME_NUMERATOR=1,rt.RMS_WINDOW_TIME_DENOMINATOR=20,rt.MAX_SAMPLES_PER_WINDOW=rt.MAX_SAMP_FREQ*rt.RMS_WINDOW_TIME_NUMERATOR/rt.RMS_WINDOW_TIME_DENOMINATOR+1;function rt(){var e=64.82,t=.95,a=rt.RMS_WINDOW_TIME_NUMERATOR,n=rt.RMS_WINDOW_TIME_DENOMINATOR,m=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],s=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function S(f,y,k,o,H,j){for(;H--!=0;)k[o]=1e-10+f[y+0]*j[0]-k[o-1]*j[1]+f[y-1]*j[2]-k[o-2]*j[3]+f[y-2]*j[4]-k[o-3]*j[5]+f[y-3]*j[6]-k[o-4]*j[7]+f[y-4]*j[8]-k[o-5]*j[9]+f[y-5]*j[10]-k[o-6]*j[11]+f[y-6]*j[12]-k[o-7]*j[13]+f[y-7]*j[14]-k[o-8]*j[15]+f[y-8]*j[16]-k[o-9]*j[17]+f[y-9]*j[18]-k[o-10]*j[19]+f[y-10]*j[20],++o,++y}function A(f,y,k,o,H,j){for(;H--!=0;)k[o]=f[y+0]*j[0]-k[o-1]*j[1]+f[y-1]*j[2]-k[o-2]*j[3]+f[y-2]*j[4],++o,++y}function O(f,y){for(var k=0;k<MAX_ORDER;k++)f.linprebuf[k]=f.lstepbuf[k]=f.loutbuf[k]=f.rinprebuf[k]=f.rstepbuf[k]=f.routbuf[k]=0;switch(0|y){case 48e3:f.reqindex=0;break;case 44100:f.reqindex=1;break;case 32e3:f.reqindex=2;break;case 24e3:f.reqindex=3;break;case 22050:f.reqindex=4;break;case 16e3:f.reqindex=5;break;case 12e3:f.reqindex=6;break;case 11025:f.reqindex=7;break;case 8e3:f.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return f.sampleWindow=0|(y*a+n-1)/n,f.lsum=0,f.rsum=0,f.totsamp=0,zi.ill(f.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(f,y){return O(f,y)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(f.linpre=MAX_ORDER,f.rinpre=MAX_ORDER,f.lstep=MAX_ORDER,f.rstep=MAX_ORDER,f.lout=MAX_ORDER,f.rout=MAX_ORDER,zi.fill(f.B,0),INIT_GAIN_ANALYSIS_OK)};function v(f){return f*f}this.AnalyzeSamples=function(f,y,k,o,H,j,V){var d,M,T,C,B,i,w;if(j==0)return GAIN_ANALYSIS_OK;switch(w=0,B=j,V){case 1:o=y,H=k;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(j<MAX_ORDER?(Bt.arraycopy(y,k,f.linprebuf,MAX_ORDER,j),Bt.arraycopy(o,H,f.rinprebuf,MAX_ORDER,j)):(Bt.arraycopy(y,k,f.linprebuf,MAX_ORDER,MAX_ORDER),Bt.arraycopy(o,H,f.rinprebuf,MAX_ORDER,MAX_ORDER));B>0;){i=B>f.sampleWindow-f.totsamp?f.sampleWindow-f.totsamp:B,w<MAX_ORDER?(d=f.linpre+w,M=f.linprebuf,T=f.rinpre+w,C=f.rinprebuf,i>MAX_ORDER-w&&(i=MAX_ORDER-w)):(d=k+w,M=y,T=H+w,C=o),S(M,d,f.lstepbuf,f.lstep+f.totsamp,i,m[f.reqindex]),S(C,T,f.rstepbuf,f.rstep+f.totsamp,i,m[f.reqindex]),A(f.lstepbuf,f.lstep+f.totsamp,f.loutbuf,f.lout+f.totsamp,i,s[f.reqindex]),A(f.rstepbuf,f.rstep+f.totsamp,f.routbuf,f.rout+f.totsamp,i,s[f.reqindex]),d=f.lout+f.totsamp,M=f.loutbuf,T=f.rout+f.totsamp,C=f.routbuf;for(var g=i%8;g--!=0;)f.lsum+=v(M[d++]),f.rsum+=v(C[T++]);for(g=i/8;g--!=0;)f.lsum+=v(M[d+0])+v(M[d+1])+v(M[d+2])+v(M[d+3])+v(M[d+4])+v(M[d+5])+v(M[d+6])+v(M[d+7]),d+=8,f.rsum+=v(C[T+0])+v(C[T+1])+v(C[T+2])+v(C[T+3])+v(C[T+4])+v(C[T+5])+v(C[T+6])+v(C[T+7]),T+=8;if(B-=i,w+=i,f.totsamp+=i,f.totsamp==f.sampleWindow){var h=rt.STEPS_per_dB*10*Math.log10((f.lsum+f.rsum)/f.totsamp*.5+1e-37),b=h<=0?0:0|h;b>=f.A.length&&(b=f.A.length-1),f.A[b]++,f.lsum=f.rsum=0,Bt.arraycopy(f.loutbuf,f.totsamp,f.loutbuf,0,MAX_ORDER),Bt.arraycopy(f.routbuf,f.totsamp,f.routbuf,0,MAX_ORDER),Bt.arraycopy(f.lstepbuf,f.totsamp,f.lstepbuf,0,MAX_ORDER),Bt.arraycopy(f.rstepbuf,f.totsamp,f.rstepbuf,0,MAX_ORDER),f.totsamp=0}if(f.totsamp>f.sampleWindow)return GAIN_ANALYSIS_ERROR}return j<MAX_ORDER?(Bt.arraycopy(f.linprebuf,j,f.linprebuf,0,MAX_ORDER-j),Bt.arraycopy(f.rinprebuf,j,f.rinprebuf,0,MAX_ORDER-j),Bt.arraycopy(y,k,f.linprebuf,MAX_ORDER-j,j),Bt.arraycopy(o,H,f.rinprebuf,MAX_ORDER-j,j)):(Bt.arraycopy(y,k+j-MAX_ORDER,f.linprebuf,0,MAX_ORDER),Bt.arraycopy(o,H+j-MAX_ORDER,f.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function N(f,y){var k,o=0;for(k=0;k<y;k++)o+=f[k];if(o==0)return GAIN_NOT_ENOUGH_SAMPLES;var H=0|Math.ceil(o*(1-t));for(k=y;k-- >0&&!((H-=f[k])<=0););return e-k/rt.STEPS_per_dB}this.GetTitleGain=function(f){for(var y=N(f.A,f.A.length),k=0;k<f.A.length;k++)f.B[k]+=f.A[k],f.A[k]=0;for(var k=0;k<MAX_ORDER;k++)f.linprebuf[k]=f.lstepbuf[k]=f.loutbuf[k]=f.rinprebuf[k]=f.rstepbuf[k]=f.routbuf[k]=0;return f.totsamp=0,f.lsum=f.rsum=0,y}}var qi=rt,Xi=Ze,sr=Xi.new_float,Yi=Xi.new_int,Ct=qi;function _2(){this.linprebuf=sr(Ct.MAX_ORDER*2),this.linpre=0,this.lstepbuf=sr(Ct.MAX_SAMPLES_PER_WINDOW+Ct.MAX_ORDER),this.lstep=0,this.loutbuf=sr(Ct.MAX_SAMPLES_PER_WINDOW+Ct.MAX_ORDER),this.lout=0,this.rinprebuf=sr(Ct.MAX_ORDER*2),this.rinpre=0,this.rstepbuf=sr(Ct.MAX_SAMPLES_PER_WINDOW+Ct.MAX_ORDER),this.rstep=0,this.routbuf=sr(Ct.MAX_SAMPLES_PER_WINDOW+Ct.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=Yi(0|Ct.STEPS_per_dB*Ct.MAX_dB),this.B=Yi(0|Ct.STEPS_per_dB*Ct.MAX_dB)}var p2=_2;function v2(e){this.bits=e}var Gi=v2,Es=Ze,Ki=Es.new_float,g2=Es.new_int,Zi=Es.assert,b2=Gi,Wi=Mt,y2=Eo,x2=Bo;function w2(e){var t=e;this.quantize=t,this.iteration_loop=function(a,n,m,s){var S=a.internal_flags,A=Ki(y2.SFBMAX),O=Ki(576),v=g2(2),N=0,f,y=S.l3_side,k=new b2(N);this.quantize.rv.ResvFrameBegin(a,k),N=k.bits;for(var o=0;o<S.mode_gr;o++){f=this.quantize.qupvt.on_pe(a,n,v,N,o,o),S.mode_ext==Wi.MPG_MD_MS_LR&&(this.quantize.ms_convert(S.l3_side,o),this.quantize.qupvt.reduce_side(v,m[o],N,f));for(var H=0;H<S.channels_out;H++){var j,V,d=y.tt[o][H];d.block_type!=Wi.SHORT_TYPE?(j=0,V=S.PSY.mask_adjust-j):(j=0,V=S.PSY.mask_adjust_short-j),S.masking_lower=Math.pow(10,V*.1),this.quantize.init_outer_loop(S,d),this.quantize.init_xrpow(S,d,O)&&(this.quantize.qupvt.calc_xmin(a,s[o][H],d,A),this.quantize.outer_loop(a,d,A,O,H,v[H])),this.quantize.iteration_finish_one(S,o,H),Zi(d.part2_3_length<=x2.MAX_BITS_PER_CHANNEL),Zi(d.part2_3_length<=v[H])}}this.quantize.rv.ResvFrameEnd(S,N)}}var k2=w2;function Ie(e,t,a,n){this.xlen=e,this.linmax=t,this.table=a,this.hlen=n}var ie={};ie.t1HB=[1,1,1,0],ie.t2HB=[1,2,1,3,1,1,3,2,0],ie.t3HB=[3,2,1,1,1,1,3,2,0],ie.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],ie.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],ie.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],ie.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],ie.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],ie.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],ie.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],ie.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],ie.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],ie.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],ie.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],ie.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],ie.t32HB=[1<<0,5<<1,4<<1,5<<2,6<<1,5<<2,4<<2,4<<3,7<<1,3<<2,6<<2,0<<3,7<<2,2<<3,3<<3,1<<4],ie.t33HB=[15<<0,14<<1,13<<1,12<<2,11<<1,10<<2,9<<2,8<<3,7<<1,6<<2,5<<2,4<<3,3<<2,2<<3,1<<3,0<<4],ie.t1l=[1,4,3,5],ie.t2l=[1,4,7,4,5,7,6,7,8],ie.t3l=[2,3,7,4,4,7,6,7,8],ie.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],ie.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],ie.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],ie.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],ie.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],ie.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],ie.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],ie.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],ie.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],ie.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],ie.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],ie.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],ie.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],ie.t32l=[1+0,4+1,4+1,5+2,4+1,6+2,5+2,6+3,4+1,5+2,5+2,6+3,5+2,6+3,6+3,6+4],ie.t33l=[4+0,4+1,4+1,4+2,4+1,4+2,4+2,4+3,4+1,4+2,4+2,4+3,4+2,4+3,4+3,4+4],ie.ht=[new Ie(0,0,null,null),new Ie(2,0,ie.t1HB,ie.t1l),new Ie(3,0,ie.t2HB,ie.t2l),new Ie(3,0,ie.t3HB,ie.t3l),new Ie(0,0,null,null),new Ie(4,0,ie.t5HB,ie.t5l),new Ie(4,0,ie.t6HB,ie.t6l),new Ie(6,0,ie.t7HB,ie.t7l),new Ie(6,0,ie.t8HB,ie.t8l),new Ie(6,0,ie.t9HB,ie.t9l),new Ie(8,0,ie.t10HB,ie.t10l),new Ie(8,0,ie.t11HB,ie.t11l),new Ie(8,0,ie.t12HB,ie.t12l),new Ie(16,0,ie.t13HB,ie.t13l),new Ie(0,0,null,ie.t16_5l),new Ie(16,0,ie.t15HB,ie.t15l),new Ie(1,1,ie.t16HB,ie.t16l),new Ie(2,3,ie.t16HB,ie.t16l),new Ie(3,7,ie.t16HB,ie.t16l),new Ie(4,15,ie.t16HB,ie.t16l),new Ie(6,63,ie.t16HB,ie.t16l),new Ie(8,255,ie.t16HB,ie.t16l),new Ie(10,1023,ie.t16HB,ie.t16l),new Ie(13,8191,ie.t16HB,ie.t16l),new Ie(4,15,ie.t24HB,ie.t24l),new Ie(5,31,ie.t24HB,ie.t24l),new Ie(6,63,ie.t24HB,ie.t24l),new Ie(7,127,ie.t24HB,ie.t24l),new Ie(8,255,ie.t24HB,ie.t24l),new Ie(9,511,ie.t24HB,ie.t24l),new Ie(11,2047,ie.t24HB,ie.t24l),new Ie(13,8191,ie.t24HB,ie.t24l),new Ie(0,0,ie.t32HB,ie.t32l),new Ie(0,0,ie.t33HB,ie.t33l)],ie.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],ie.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],ie.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],ie.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],ie.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],ie.scfsi_band=[0,6,11,16,21];var Ms=ie,fa=Pi,nr=Ze,ja=nr.VbrMode,Co=nr.Float,Rs=nr.Util,Ha=nr.new_float,S2=nr.new_int,Pr=nr.assert,ft=Mt,E2=Gi,Ht=Bo;_a.Q_MAX=256+1,_a.Q_MAX2=116,_a.LARGE_BITS=1e5,_a.IXMAX_VAL=8206;function _a(){var e=null,t=null,a=null;this.setModules=function(d,M,T){e=d,t=M,a=T};function n(d){return f[d+_a.Q_MAX2]}this.IPOW20=function(d){return y[d]};var m=2220446049250313e-31,s=_a.IXMAX_VAL,S=s+2,A=_a.Q_MAX,O=_a.Q_MAX2,v=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var N=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=N,this.sfBandIndex=[new fa([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new fa([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new fa([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new fa([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new fa([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new fa([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new fa([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new fa([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new fa([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var f=Ha(A+O+1),y=Ha(A),k=Ha(S),o=Ha(S);this.adj43=o;function H(d,M){var T=a.ATHformula(M,d);return T-=v,T=Math.pow(10,T/10+d.ATHlower),T}function j(d){for(var M=d.internal_flags.ATH.l,T=d.internal_flags.ATH.psfb21,C=d.internal_flags.ATH.s,B=d.internal_flags.ATH.psfb12,i=d.internal_flags,w=d.out_samplerate,g=0;g<ft.SBMAX_l;g++){var h=i.scalefac_band.l[g],b=i.scalefac_band.l[g+1];M[g]=Co.MAX_VALUE;for(var x=h;x<b;x++){var c=x*w/1152,u=H(d,c);M[g]=Math.min(M[g],u)}}for(var g=0;g<ft.PSFB21;g++){var h=i.scalefac_band.psfb21[g],b=i.scalefac_band.psfb21[g+1];T[g]=Co.MAX_VALUE;for(var x=h;x<b;x++){var c=x*w/1152,u=H(d,c);T[g]=Math.min(T[g],u)}}for(var g=0;g<ft.SBMAX_s;g++){var h=i.scalefac_band.s[g],b=i.scalefac_band.s[g+1];C[g]=Co.MAX_VALUE;for(var x=h;x<b;x++){var c=x*w/384,u=H(d,c);C[g]=Math.min(C[g],u)}C[g]*=i.scalefac_band.s[g+1]-i.scalefac_band.s[g]}for(var g=0;g<ft.PSFB12;g++){var h=i.scalefac_band.psfb12[g],b=i.scalefac_band.psfb12[g+1];B[g]=Co.MAX_VALUE;for(var x=h;x<b;x++){var c=x*w/384,u=H(d,c);B[g]=Math.min(B[g],u)}B[g]*=i.scalefac_band.s[13]-i.scalefac_band.s[12]}if(d.noATH){for(var g=0;g<ft.SBMAX_l;g++)M[g]=1e-20;for(var g=0;g<ft.PSFB21;g++)T[g]=1e-20;for(var g=0;g<ft.SBMAX_s;g++)C[g]=1e-20;for(var g=0;g<ft.PSFB12;g++)B[g]=1e-20}i.ATH.floor=10*Math.log10(H(d,-1))}this.iteration_init=function(d){var M=d.internal_flags,T=M.l3_side,C;if(M.iteration_init_init==0){for(M.iteration_init_init=1,T.main_data_begin=0,j(d),k[0]=0,C=1;C<S;C++)k[C]=Math.pow(C,4/3);for(C=0;C<S-1;C++)o[C]=C+1-Math.pow(.5*(k[C]+k[C+1]),.75);for(o[C]=.5,C=0;C<A;C++)y[C]=Math.pow(2,(C-210)*-.1875);for(C=0;C<=A+O;C++)f[C]=Math.pow(2,(C-210-O)*.25);e.huffman_init(M);{var B,i,w,g;for(C=d.exp_nspsytune>>2&63,C>=32&&(C-=64),B=Math.pow(10,C/4/10),C=d.exp_nspsytune>>8&63,C>=32&&(C-=64),i=Math.pow(10,C/4/10),C=d.exp_nspsytune>>14&63,C>=32&&(C-=64),w=Math.pow(10,C/4/10),C=d.exp_nspsytune>>20&63,C>=32&&(C-=64),g=w*Math.pow(10,C/4/10),C=0;C<ft.SBMAX_l;C++){var h;C<=6?h=B:C<=13?h=i:C<=20?h=w:h=g,M.nsPsy.longfact[C]=h}for(C=0;C<ft.SBMAX_s;C++){var h;C<=5?h=B:C<=10?h=i:C<=11?h=w:h=g,M.nsPsy.shortfact[C]=h}}}},this.on_pe=function(d,M,T,C,B,i){var w=d.internal_flags,g=0,h,b=S2(2),x,c=new E2(g),u=t.ResvMaxBits(d,C,c,i);g=c.bits;var _=g+u;for(_>Ht.MAX_BITS_PER_GRANULE&&(_=Ht.MAX_BITS_PER_GRANULE),h=0,x=0;x<w.channels_out;++x)T[x]=Math.min(Ht.MAX_BITS_PER_CHANNEL,g/w.channels_out),b[x]=0|T[x]*M[B][x]/700-T[x],b[x]>C*3/4&&(b[x]=C*3/4),b[x]<0&&(b[x]=0),b[x]+T[x]>Ht.MAX_BITS_PER_CHANNEL&&(b[x]=Math.max(0,Ht.MAX_BITS_PER_CHANNEL-T[x])),h+=b[x];if(h>u)for(x=0;x<w.channels_out;++x)b[x]=u*b[x]/h;for(x=0;x<w.channels_out;++x)T[x]+=b[x],u-=b[x];for(h=0,x=0;x<w.channels_out;++x)h+=T[x];if(h>Ht.MAX_BITS_PER_GRANULE){var L=0;for(x=0;x<w.channels_out;++x)T[x]*=Ht.MAX_BITS_PER_GRANULE,T[x]/=h,L+=T[x]}return _},this.reduce_side=function(d,M,T,C){Pr(d[0]+d[1]<=Ht.MAX_BITS_PER_GRANULE);var B=.33*(.5-M)/.5;B<0&&(B=0),B>.5&&(B=.5);var i=0|B*.5*(d[0]+d[1]);i>Ht.MAX_BITS_PER_CHANNEL-d[0]&&(i=Ht.MAX_BITS_PER_CHANNEL-d[0]),i<0&&(i=0),d[1]>=125&&(d[1]-i>125?(d[0]<T&&(d[0]+=i),d[1]-=i):(d[0]+=d[1]-125,d[1]=125)),i=d[0]+d[1],i>C&&(d[0]=C*d[0]/i,d[1]=C*d[1]/i),Pr(d[0]<=Ht.MAX_BITS_PER_CHANNEL),Pr(d[1]<=Ht.MAX_BITS_PER_CHANNEL),Pr(d[0]+d[1]<=Ht.MAX_BITS_PER_GRANULE)},this.athAdjust=function(d,M,T){var C=90.30873362,B=94.82444863,i=Rs.FAST_LOG10_X(M,10),w=d*d,g=0;return i-=T,w>1e-20&&(g=1+Rs.FAST_LOG10_X(w,10/C)),g<0&&(g=0),i*=g,i+=T+C-B,Math.pow(10,.1*i)},this.calc_xmin=function(d,M,T,C){var B=0,i=d.internal_flags,w,g=0,h=0,b=i.ATH,x=T.xr,c=d.VBR==ja.vbr_mtrh?1:0,u=i.masking_lower;for((d.VBR==ja.vbr_mtrh||d.VBR==ja.vbr_mt)&&(u=1),w=0;w<T.psy_lmax;w++){var _,L,Y,F,U,l;d.VBR==ja.vbr_rh||d.VBR==ja.vbr_mtrh?L=athAdjust(b.adjust,b.l[w],b.floor):L=b.adjust*b.l[w],U=T.width[w],Y=L/U,F=m,l=U>>1,_=0;do{var p,Z;p=x[g]*x[g],_+=p,F+=p<Y?p:Y,g++,Z=x[g]*x[g],_+=Z,F+=Z<Y?Z:Y,g++}while(--l>0);if(_>L&&h++,w==ft.SBPSY_l){var W=L*i.nsPsy.longfact[w];F<W&&(F=W)}if(c!=0&&(L=F),!d.ATHonly){var re=M.en.l[w];if(re>0){var W;W=_*M.thm.l[w]*u/re,c!=0&&(W*=i.nsPsy.longfact[w]),L<W&&(L=W)}}c!=0?C[B++]=L:C[B++]=L*i.nsPsy.longfact[w]}var me=575;if(T.block_type!=ft.SHORT_TYPE)for(var ce=576;ce--!=0&&BitStream.EQ(x[ce],0);)me=ce;T.max_nonzero_coeff=me;for(var he=T.sfb_smin;w<T.psymax;he++,w+=3){var U,ke,pe;for(d.VBR==ja.vbr_rh||d.VBR==ja.vbr_mtrh?pe=athAdjust(b.adjust,b.s[he],b.floor):pe=b.adjust*b.s[he],U=T.width[w],ke=0;ke<3;ke++){var _=0,L,Y,F,l=U>>1;Y=pe/U,F=m;do{var p,Z;p=x[g]*x[g],_+=p,F+=p<Y?p:Y,g++,Z=x[g]*x[g],_+=Z,F+=Z<Y?Z:Y,g++}while(--l>0);if(_>pe&&h++,he==ft.SBPSY_s){var W=pe*i.nsPsy.shortfact[he];F<W&&(F=W)}if(c!=0?L=F:L=pe,!d.ATHonly&&!d.ATHshort){var re=M.en.s[he][ke];if(re>0){var W;W=_*M.thm.s[he][ke]*u/re,c!=0&&(W*=i.nsPsy.shortfact[he]),L<W&&(L=W)}}c!=0?C[B++]=L:C[B++]=L*i.nsPsy.shortfact[he]}d.useTemporal&&(C[B-3]>C[B-3+1]&&(C[B-3+1]+=(C[B-3]-C[B-3+1])*i.decay),C[B-3+1]>C[B-3+2]&&(C[B-3+2]+=(C[B-3+1]-C[B-3+2])*i.decay))}return h};function V(d){this.s=d}this.calc_noise_core=function(d,M,T,C){var B=0,i=M.s,w=d.l3_enc;if(i>d.count1)for(;T--!=0;){var g;g=d.xr[i],i++,B+=g*g,g=d.xr[i],i++,B+=g*g}else if(i>d.big_values){var h=Ha(2);for(h[0]=0,h[1]=C;T--!=0;){var g;g=Math.abs(d.xr[i])-h[w[i]],i++,B+=g*g,g=Math.abs(d.xr[i])-h[w[i]],i++,B+=g*g}}else for(;T--!=0;){var g;g=Math.abs(d.xr[i])-k[w[i]]*C,i++,B+=g*g,g=Math.abs(d.xr[i])-k[w[i]]*C,i++,B+=g*g}return M.s=i,B},this.calc_noise=function(d,M,T,C,B){var i=0,w=0,g,h,b=0,x=0,c=0,u=-20,_=0,L=d.scalefac,Y=0;for(C.over_SSD=0,g=0;g<d.psymax;g++){var F=d.global_gain-(L[Y++]+(d.preflag!=0?N[g]:0)<<d.scalefac_scale+1)-d.subblock_gain[d.window[g]]*8,U=0;if(B!=null&&B.step[g]==F)U=B.noise[g],_+=d.width[g],T[i++]=U/M[w++],U=B.noise_log[g];else{var l=n(F);if(h=d.width[g]>>1,_+d.width[g]>d.max_nonzero_coeff){var p;p=d.max_nonzero_coeff-_+1,p>0?h=p>>1:h=0}var Z=new V(_);U=this.calc_noise_core(d,Z,h,l),_=Z.s,B!=null&&(B.step[g]=F,B.noise[g]=U),U=T[i++]=U/M[w++],U=Rs.FAST_LOG10(Math.max(U,1e-20)),B!=null&&(B.noise_log[g]=U)}if(B!=null&&(B.global_gain=d.global_gain),c+=U,U>0){var W;W=Math.max(0|U*10+.5,1),C.over_SSD+=W*W,b++,x+=U}u=Math.max(u,U)}return C.over_count=b,C.tot_noise=c,C.over_noise=x,C.max_noise=u,b},this.set_pinfo=function(d,M,T,C,B){var i=d.internal_flags,w,g,h,b,x,c=M.scalefac_scale==0?.5:1,u=M.scalefac,_=Ha(L3Side.SFBMAX),L=Ha(L3Side.SFBMAX),Y=new CalcNoiseResult;calc_xmin(d,T,M,_),calc_noise(M,_,L,Y,null);var F=0;for(g=M.sfb_lmax,M.block_type!=ft.SHORT_TYPE&&M.mixed_block_flag==0&&(g=22),w=0;w<g;w++){var U=i.scalefac_band.l[w],l=i.scalefac_band.l[w+1],p=l-U;for(b=0;F<l;F++)b+=M.xr[F]*M.xr[F];b/=p,x=1e15,i.pinfo.en[C][B][w]=x*b,i.pinfo.xfsf[C][B][w]=x*_[w]*L[w]/p,T.en.l[w]>0&&!d.ATHonly?b=b/T.en.l[w]:b=0,i.pinfo.thr[C][B][w]=x*Math.max(b*T.thm.l[w],i.ATH.l[w]),i.pinfo.LAMEsfb[C][B][w]=0,M.preflag!=0&&w>=11&&(i.pinfo.LAMEsfb[C][B][w]=-c*N[w]),w<ft.SBPSY_l&&(Pr(u[w]>=0),i.pinfo.LAMEsfb[C][B][w]-=c*u[w])}if(M.block_type==ft.SHORT_TYPE)for(g=w,w=M.sfb_smin;w<ft.SBMAX_s;w++)for(var U=i.scalefac_band.s[w],l=i.scalefac_band.s[w+1],p=l-U,Z=0;Z<3;Z++){for(b=0,h=U;h<l;h++)b+=M.xr[F]*M.xr[F],F++;b=Math.max(b/p,1e-20),x=1e15,i.pinfo.en_s[C][B][3*w+Z]=x*b,i.pinfo.xfsf_s[C][B][3*w+Z]=x*_[g]*L[g]/p,T.en.s[w][Z]>0?b=b/T.en.s[w][Z]:b=0,(d.ATHonly||d.ATHshort)&&(b=0),i.pinfo.thr_s[C][B][3*w+Z]=x*Math.max(b*T.thm.s[w][Z],i.ATH.s[w]),i.pinfo.LAMEsfb_s[C][B][3*w+Z]=-2*M.subblock_gain[Z],w<ft.SBPSY_s&&(i.pinfo.LAMEsfb_s[C][B][3*w+Z]-=c*u[g]),g++}i.pinfo.LAMEqss[C][B]=M.global_gain,i.pinfo.LAMEmainbits[C][B]=M.part2_3_length+M.part2_length,i.pinfo.LAMEsfbits[C][B]=M.part2_length,i.pinfo.over[C][B]=Y.over_count,i.pinfo.max_noise[C][B]=Y.max_noise*10,i.pinfo.over_noise[C][B]=Y.over_noise*10,i.pinfo.tot_noise[C][B]=Y.tot_noise*10,i.pinfo.over_SSD[C][B]=Y.over_SSD}}var Qi=_a,Oo=Ze,M2=Oo.System,R2=Oo.Arrays,Fr=Oo.new_int,As=Oo.assert,ot=Mt,et=Ms,A2=ws,Pa=Qi;function Ts(){var e=null;this.qupvt=null,this.setModules=function(h){this.qupvt=h,e=h};function t(h){this.bits=0|h}var a=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function n(h,b,x,c,u,_){var L=.5946/b;for(h=h>>1;h--!=0;)u[_++]=L>x[c++]?0:1,u[_++]=L>x[c++]?0:1}function m(h,b,x,c,u,_){h=h>>1;var L=h%2;for(h=h>>1;h--!=0;){var Y,F,U,l,p,Z,W,re;Y=x[c++]*b,F=x[c++]*b,p=0|Y,U=x[c++]*b,Z=0|F,l=x[c++]*b,W=0|U,Y+=e.adj43[p],re=0|l,F+=e.adj43[Z],u[_++]=0|Y,U+=e.adj43[W],u[_++]=0|F,l+=e.adj43[re],u[_++]=0|U,u[_++]=0|l}if(L!=0){var Y,F,p,Z;Y=x[c++]*b,F=x[c++]*b,p=0|Y,Z=0|F,Y+=e.adj43[p],F+=e.adj43[Z],u[_++]=0|Y,u[_++]=0|F}}function s(h,b,x,c,u){var _,L,Y=0,F,U=0,l=0,p=0,Z=b,W=0,re=Z,me=0,ce=h,he=0;for(F=u!=null&&c.global_gain==u.global_gain,c.block_type==ot.SHORT_TYPE?L=38:L=21,_=0;_<=L;_++){var ke=-1;if((F||c.block_type==ot.NORM_TYPE)&&(ke=c.global_gain-(c.scalefac[_]+(c.preflag!=0?e.pretab[_]:0)<<c.scalefac_scale+1)-c.subblock_gain[c.window[_]]*8),As(c.width[_]>=0),F&&u.step[_]==ke)U!=0&&(m(U,x,ce,he,re,me),U=0),l!=0&&(n(l,x,ce,he,re,me),l=0);else{var pe=c.width[_];if(Y+c.width[_]>c.max_nonzero_coeff){var de;de=c.max_nonzero_coeff-Y+1,R2.fill(b,c.max_nonzero_coeff,576,0),pe=de,pe<0&&(pe=0),_=L+1}if(U==0&&l==0&&(re=Z,me=W,ce=h,he=p),u!=null&&u.sfb_count1>0&&_>=u.sfb_count1&&u.step[_]>0&&ke>=u.step[_]?(U!=0&&(m(U,x,ce,he,re,me),U=0,re=Z,me=W,ce=h,he=p),l+=pe):(l!=0&&(n(l,x,ce,he,re,me),l=0,re=Z,me=W,ce=h,he=p),U+=pe),pe<=0){l!=0&&(n(l,x,ce,he,re,me),l=0),U!=0&&(m(U,x,ce,he,re,me),U=0);break}}_<=L&&(W+=c.width[_],p+=c.width[_],Y+=c.width[_])}U!=0&&(m(U,x,ce,he,re,me),U=0),l!=0&&(n(l,x,ce,he,re,me),l=0)}function S(h,b,x){var c=0,u=0;do{var _=h[b++],L=h[b++];c<_&&(c=_),u<L&&(u=L)}while(b<x);return c<u&&(c=u),c}function A(h,b,x,c,u,_){var L=et.ht[c].xlen*65536+et.ht[u].xlen,Y=0,F;do{var U=h[b++],l=h[b++];U!=0&&(U>14&&(U=15,Y+=L),U*=16),l!=0&&(l>14&&(l=15,Y+=L),U+=l),Y+=et.largetbl[U]}while(b<x);return F=Y&65535,Y>>=16,Y>F&&(Y=F,c=u),_.bits+=Y,c}function O(h,b,x,c){var u=0,_=et.ht[1].hlen;do{var L=h[b+0]*2+h[b+1];b+=2,u+=_[L]}while(b<x);return c.bits+=u,1}function v(h,b,x,c,u){var _=0,L,Y=et.ht[c].xlen,F;c==2?F=et.table23:F=et.table56;do{var U=h[b+0]*Y+h[b+1];b+=2,_+=F[U]}while(b<x);return L=_&65535,_>>=16,_>L&&(_=L,c++),u.bits+=_,c}function N(h,b,x,c,u){var _=0,L=0,Y=0,F=et.ht[c].xlen,U=et.ht[c].hlen,l=et.ht[c+1].hlen,p=et.ht[c+2].hlen;do{var Z=h[b+0]*F+h[b+1];b+=2,_+=U[Z],L+=l[Z],Y+=p[Z]}while(b<x);var W=c;return _>L&&(_=L,W++),_>Y&&(_=Y,W=c+2),u.bits+=_,W}var f=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function y(h,b,x,c){var u=S(h,b,x);switch(u){case 0:return u;case 1:return O(h,b,x,c);case 2:case 3:return v(h,b,x,f[u-1],c);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return N(h,b,x,f[u-1],c);default:if(u>Pa.IXMAX_VAL)return c.bits=Pa.LARGE_BITS,-1;u-=15;var _;for(_=24;_<32&&!(et.ht[_].linmax>=u);_++);var L;for(L=_-8;L<24&&!(et.ht[L].linmax>=u);L++);return A(h,b,x,L,_,c)}}this.noquant_count_bits=function(h,b,x){var c=b.l3_enc,u=Math.min(576,b.max_nonzero_coeff+2>>1<<1);for(x!=null&&(x.sfb_count1=0);u>1&&(c[u-1]|c[u-2])==0;u-=2);b.count1=u;for(var _=0,L=0;u>3;u-=4){var Y;if(((c[u-1]|c[u-2]|c[u-3]|c[u-4])&2147483647)>1)break;Y=((c[u-4]*2+c[u-3])*2+c[u-2])*2+c[u-1],_+=et.t32l[Y],L+=et.t33l[Y]}var F=_;if(b.count1table_select=0,_>L&&(F=L,b.count1table_select=1),b.count1bits=F,b.big_values=u,u==0)return F;if(b.block_type==ot.SHORT_TYPE)_=3*h.scalefac_band.s[3],_>b.big_values&&(_=b.big_values),L=b.big_values;else if(b.block_type==ot.NORM_TYPE){if(_=b.region0_count=h.bv_scf[u-2],L=b.region1_count=h.bv_scf[u-1],L=h.scalefac_band.l[_+L+2],_=h.scalefac_band.l[_+1],L<u){var U=new t(F);b.table_select[2]=y(c,L,u,U),F=U.bits}}else b.region0_count=7,b.region1_count=ot.SBMAX_l-1-7-1,_=h.scalefac_band.l[7+1],L=u,_>L&&(_=L);if(_=Math.min(_,u),L=Math.min(L,u),0<_){var U=new t(F);b.table_select[0]=y(c,0,_,U),F=U.bits}if(_<L){var U=new t(F);b.table_select[1]=y(c,_,L,U),F=U.bits}if(h.use_best_huffman==2&&(b.part2_3_length=F,best_huffman_divide(h,b),F=b.part2_3_length),x!=null&&b.block_type==ot.NORM_TYPE){for(var l=0;h.scalefac_band.l[l]<b.big_values;)l++;x.sfb_count1=l}return F},this.count_bits=function(h,b,x,c){var u=x.l3_enc,_=Pa.IXMAX_VAL/e.IPOW20(x.global_gain);if(x.xrpow_max>_)return Pa.LARGE_BITS;if(s(b,u,e.IPOW20(x.global_gain),x,c),(h.substep_shaping&2)!=0)for(var L=0,Y=x.global_gain+x.scalefac_scale,F=.634521682242439/e.IPOW20(Y),U=0;U<x.sfbmax;U++){var l=x.width[U];if(h.pseudohalf[U]==0)L+=l;else{var p;for(p=L,L+=l;p<L;++p)u[p]=b[p]>=F?u[p]:0}}return this.noquant_count_bits(h,x,c)};function k(h,b,x,c,u,_,L){for(var Y=b.big_values,F=0;F<=7+15;F++)c[F]=Pa.LARGE_BITS;for(var F=0;F<16;F++){var U=h.scalefac_band.l[F+1];if(U>=Y)break;var l=0,p=new t(l),Z=y(x,0,U,p);l=p.bits;for(var W=0;W<8;W++){var re=h.scalefac_band.l[F+W+2];if(re>=Y)break;var me=l;p=new t(me);var ce=y(x,U,re,p);me=p.bits,c[F+W]>me&&(c[F+W]=me,u[F+W]=F,_[F+W]=Z,L[F+W]=ce)}}}function o(h,b,x,c,u,_,L,Y){for(var F=b.big_values,U=2;U<ot.SBMAX_l+1;U++){var l=h.scalefac_band.l[U];if(l>=F)break;var p=u[U-2]+b.count1bits;if(x.part2_3_length<=p)break;var Z=new t(p),W=y(c,l,F,Z);p=Z.bits,!(x.part2_3_length<=p)&&(x.assign(b),x.part2_3_length=p,x.region0_count=_[U-2],x.region1_count=U-2-_[U-2],x.table_select[0]=L[U-2],x.table_select[1]=Y[U-2],x.table_select[2]=W)}}this.best_huffman_divide=function(h,b){var x=new A2,c=b.l3_enc,u=Fr(7+15+1),_=Fr(7+15+1),L=Fr(7+15+1),Y=Fr(7+15+1);if(!(b.block_type==ot.SHORT_TYPE&&h.mode_gr==1)){x.assign(b),b.block_type==ot.NORM_TYPE&&(k(h,b,c,u,_,L,Y),o(h,x,b,c,u,_,L,Y));var F=x.big_values;if(!(F==0||(c[F-2]|c[F-1])>1)&&(F=b.count1+2,!(F>576))){x.assign(b),x.count1=F;for(var U=0,l=0;F>x.big_values;F-=4){var p=((c[F-4]*2+c[F-3])*2+c[F-2])*2+c[F-1];U+=et.t32l[p],l+=et.t33l[p]}if(x.big_values=F,x.count1table_select=0,U>l&&(U=l,x.count1table_select=1),x.count1bits=U,x.block_type==ot.NORM_TYPE)o(h,x,b,c,u,_,L,Y);else{if(x.part2_3_length=U,U=h.scalefac_band.l[7+1],U>F&&(U=F),U>0){var Z=new t(x.part2_3_length);x.table_select[0]=y(c,0,U,Z),x.part2_3_length=Z.bits}if(F>U){var Z=new t(x.part2_3_length);x.table_select[1]=y(c,U,F,Z),x.part2_3_length=Z.bits}b.part2_3_length>x.part2_3_length&&b.assign(x)}}}};var H=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],j=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],V=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],d=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];Ts.slen1_tab=V,Ts.slen2_tab=d;function M(h,b){for(var x,c=b.tt[1][h],u=b.tt[0][h],_=0;_<et.scfsi_band.length-1;_++){for(x=et.scfsi_band[_];x<et.scfsi_band[_+1]&&!(u.scalefac[x]!=c.scalefac[x]&&c.scalefac[x]>=0);x++);if(x==et.scfsi_band[_+1]){for(x=et.scfsi_band[_];x<et.scfsi_band[_+1];x++)c.scalefac[x]=-1;b.scfsi[h][_]=1}}var L=0,Y=0;for(x=0;x<11;x++)c.scalefac[x]!=-1&&(Y++,L<c.scalefac[x]&&(L=c.scalefac[x]));for(var F=0,U=0;x<ot.SBPSY_l;x++)c.scalefac[x]!=-1&&(U++,F<c.scalefac[x]&&(F=c.scalefac[x]));for(var _=0;_<16;_++)if(L<H[_]&&F<j[_]){var l=V[_]*Y+d[_]*U;c.part2_length>l&&(c.part2_length=l,c.scalefac_compress=_)}}this.best_scalefac_store=function(h,b,x,c){var u=c.tt[b][x],_,L,Y,F,U=0;for(Y=0,_=0;_<u.sfbmax;_++){var l=u.width[_];for(Y+=l,F=-l;F<0&&u.l3_enc[F+Y]==0;F++);F==0&&(u.scalefac[_]=U=-2)}if(u.scalefac_scale==0&&u.preflag==0){var p=0;for(_=0;_<u.sfbmax;_++)u.scalefac[_]>0&&(p|=u.scalefac[_]);if((p&1)==0&&p!=0){for(_=0;_<u.sfbmax;_++)u.scalefac[_]>0&&(u.scalefac[_]>>=1);u.scalefac_scale=U=1}}if(u.preflag==0&&u.block_type!=ot.SHORT_TYPE&&h.mode_gr==2){for(_=11;_<ot.SBPSY_l&&!(u.scalefac[_]<e.pretab[_]&&u.scalefac[_]!=-2);_++);if(_==ot.SBPSY_l){for(_=11;_<ot.SBPSY_l;_++)u.scalefac[_]>0&&(u.scalefac[_]-=e.pretab[_]);u.preflag=U=1}}for(L=0;L<4;L++)c.scfsi[x][L]=0;for(h.mode_gr==2&&b==1&&c.tt[0][x].block_type!=ot.SHORT_TYPE&&c.tt[1][x].block_type!=ot.SHORT_TYPE&&(M(x,c),U=0),_=0;_<u.sfbmax;_++)u.scalefac[_]==-2&&(u.scalefac[_]=0);U!=0&&(h.mode_gr==2?this.scale_bitcount(u):this.scale_bitcount_lsf(h,u))};function T(h,b){for(var x=0;x<b;++x)if(h[x]<0)return!1;return!0}var C=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],B=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],i=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(h){var b,x,c=0,u=0,_,L=h.scalefac;if(As(T(L,h.sfbmax)),h.block_type==ot.SHORT_TYPE)_=C,h.mixed_block_flag!=0&&(_=B);else if(_=i,h.preflag==0){for(x=11;x<ot.SBPSY_l&&!(L[x]<e.pretab[x]);x++);if(x==ot.SBPSY_l)for(h.preflag=1,x=11;x<ot.SBPSY_l;x++)L[x]-=e.pretab[x]}for(x=0;x<h.sfbdivide;x++)c<L[x]&&(c=L[x]);for(;x<h.sfbmax;x++)u<L[x]&&(u=L[x]);for(h.part2_length=Pa.LARGE_BITS,b=0;b<16;b++)c<H[b]&&u<j[b]&&h.part2_length>_[b]&&(h.part2_length=_[b],h.scalefac_compress=b);return h.part2_length==Pa.LARGE_BITS};var w=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(h,b){var x,c,u,_,L,Y,F,U,l=Fr(4),p=b.scalefac;for(b.preflag!=0?x=2:x=0,F=0;F<4;F++)l[F]=0;if(b.block_type==ot.SHORT_TYPE){c=1;var Z=e.nr_of_sfb_block[x][c];for(U=0,u=0;u<4;u++)for(_=Z[u]/3,F=0;F<_;F++,U++)for(L=0;L<3;L++)p[U*3+L]>l[u]&&(l[u]=p[U*3+L])}else{c=0;var Z=e.nr_of_sfb_block[x][c];for(U=0,u=0;u<4;u++)for(_=Z[u],F=0;F<_;F++,U++)p[U]>l[u]&&(l[u]=p[U])}for(Y=!1,u=0;u<4;u++)l[u]>w[x][u]&&(Y=!0);if(!Y){var W,re,me,ce;for(b.sfb_partition_table=e.nr_of_sfb_block[x][c],u=0;u<4;u++)b.slen[u]=g[l[u]];switch(W=b.slen[0],re=b.slen[1],me=b.slen[2],ce=b.slen[3],x){case 0:b.scalefac_compress=(W*5+re<<4)+(me<<2)+ce;break;case 1:b.scalefac_compress=400+(W*5+re<<2)+me;break;case 2:b.scalefac_compress=500+W*3+re;break;default:M2.err.printf(`intensity stereo not implemented yet
`);break}}if(!Y)for(As(b.sfb_partition_table!=null),b.part2_length=0,u=0;u<4;u++)b.part2_length+=b.slen[u]*b.sfb_partition_table[u];return Y};var g=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(h){for(var b=2;b<=576;b+=2){for(var x=0,c;h.scalefac_band.l[++x]<b;);for(c=a[x][0];h.scalefac_band.l[c+1]>b;)c--;for(c<0&&(c=a[x][0]),h.bv_scf[b-2]=c,c=a[x][1];h.scalefac_band.l[c+h.bv_scf[b-2]+2]>b;)c--;c<0&&(c=a[x][1]),h.bv_scf[b-1]=c}}}var $i=Ts,ir=Ze,oa=ir.System,T2=ir.Arrays,B2=ir.new_byte,C2=ir.new_float_n,O2=ir.new_int,st=ir.assert,Ji=$i,Bs=Ms,Lo=Mt,Fa=Bo;No.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=Math.abs(e)*1e-6:Math.abs(e-t)<=Math.abs(t)*1e-6},No.NEQ=function(e,t){return!No.EQ(e,t)};function No(){var e=this,t=32773,a=null,n=null,m=null,s=null;this.setModules=function(w,g,h,b){a=w,n=g,m=h,s=b};var S=null,A=0,O=0,v=0;this.getframebits=function(w){var g=w.internal_flags,h;g.bitrate_index!=0?h=Bs.bitrate_table[w.version][g.bitrate_index]:h=w.brate;var b=0|(w.version+1)*72e3*h/w.out_samplerate+g.padding;return 8*b};function N(w){oa.arraycopy(w.header[w.w_ptr].buf,0,S,O,w.sideinfo_len),O+=w.sideinfo_len,A+=w.sideinfo_len*8,w.w_ptr=w.w_ptr+1&Fa.MAX_HEADER_BUF-1}function f(w,g,h){for(;h>0;){var b;v==0&&(v=8,O++,st(O<Lame.LAME_MAXMP3BUFFER),st(w.header[w.w_ptr].write_timing>=A),w.header[w.w_ptr].write_timing==A&&N(w),S[O]=0),b=Math.min(h,v),h-=b,v-=b,S[O]|=g>>h<<v,A+=b}}function y(w,g,h){for(;h>0;){var b;v==0&&(v=8,O++,st(O<Lame.LAME_MAXMP3BUFFER),S[O]=0),b=Math.min(h,v),h-=b,v-=b,S[O]|=g>>h<<v,A+=b}}function k(w,g){var h=w.internal_flags,b;if(g>=8&&(f(h,76,8),g-=8),g>=8&&(f(h,65,8),g-=8),g>=8&&(f(h,77,8),g-=8),g>=8&&(f(h,69,8),g-=8),g>=32){var x=m.getLameShortVersion();if(g>=32)for(b=0;b<x.length&&g>=8;++b)g-=8,f(h,x.charAt(b),8)}for(;g>=1;g-=1)f(h,h.ancillary_flag,1),h.ancillary_flag^=w.disable_reservoir?0:1}function o(w,g,h){for(var b=w.header[w.h_ptr].ptr;h>0;){var x=Math.min(h,8-(b&7));h-=x,w.header[w.h_ptr].buf[b>>3]|=g>>h<<8-(b&7)-x,b+=x}w.header[w.h_ptr].ptr=b}function H(w,g){w<<=8;for(var h=0;h<8;h++)w<<=1,g<<=1,((g^w)&65536)!=0&&(g^=t);return g}this.CRC_writeheader=function(w,g){var h=65535;h=H(g[2]&255,h),h=H(g[3]&255,h);for(var b=6;b<w.sideinfo_len;b++)h=H(g[b]&255,h);g[4]=byte(h>>8),g[5]=byte(h&255)};function j(w,g){var h=w.internal_flags,b,x,c;if(b=h.l3_side,h.header[h.h_ptr].ptr=0,T2.fill(h.header[h.h_ptr].buf,0,h.sideinfo_len,0),w.out_samplerate<16e3?o(h,4094,12):o(h,4095,12),o(h,w.version,1),o(h,4-3,2),o(h,w.error_protection?0:1,1),o(h,h.bitrate_index,4),o(h,h.samplerate_index,2),o(h,h.padding,1),o(h,w.extension,1),o(h,w.mode.ordinal(),2),o(h,h.mode_ext,2),o(h,w.copyright,1),o(h,w.original,1),o(h,w.emphasis,2),w.error_protection&&o(h,0,16),w.version==1){for(st(b.main_data_begin>=0),o(h,b.main_data_begin,9),h.channels_out==2?o(h,b.private_bits,3):o(h,b.private_bits,5),c=0;c<h.channels_out;c++){var u;for(u=0;u<4;u++)o(h,b.scfsi[c][u],1)}for(x=0;x<2;x++)for(c=0;c<h.channels_out;c++){var _=b.tt[x][c];o(h,_.part2_3_length+_.part2_length,12),o(h,_.big_values/2,9),o(h,_.global_gain,8),o(h,_.scalefac_compress,4),_.block_type!=Lo.NORM_TYPE?(o(h,1,1),o(h,_.block_type,2),o(h,_.mixed_block_flag,1),_.table_select[0]==14&&(_.table_select[0]=16),o(h,_.table_select[0],5),_.table_select[1]==14&&(_.table_select[1]=16),o(h,_.table_select[1],5),o(h,_.subblock_gain[0],3),o(h,_.subblock_gain[1],3),o(h,_.subblock_gain[2],3)):(o(h,0,1),_.table_select[0]==14&&(_.table_select[0]=16),o(h,_.table_select[0],5),_.table_select[1]==14&&(_.table_select[1]=16),o(h,_.table_select[1],5),_.table_select[2]==14&&(_.table_select[2]=16),o(h,_.table_select[2],5),st(0<=_.region0_count&&_.region0_count<16),st(0<=_.region1_count&&_.region1_count<8),o(h,_.region0_count,4),o(h,_.region1_count,3)),o(h,_.preflag,1),o(h,_.scalefac_scale,1),o(h,_.count1table_select,1)}}else for(st(b.main_data_begin>=0),o(h,b.main_data_begin,8),o(h,b.private_bits,h.channels_out),x=0,c=0;c<h.channels_out;c++){var _=b.tt[x][c];o(h,_.part2_3_length+_.part2_length,12),o(h,_.big_values/2,9),o(h,_.global_gain,8),o(h,_.scalefac_compress,9),_.block_type!=Lo.NORM_TYPE?(o(h,1,1),o(h,_.block_type,2),o(h,_.mixed_block_flag,1),_.table_select[0]==14&&(_.table_select[0]=16),o(h,_.table_select[0],5),_.table_select[1]==14&&(_.table_select[1]=16),o(h,_.table_select[1],5),o(h,_.subblock_gain[0],3),o(h,_.subblock_gain[1],3),o(h,_.subblock_gain[2],3)):(o(h,0,1),_.table_select[0]==14&&(_.table_select[0]=16),o(h,_.table_select[0],5),_.table_select[1]==14&&(_.table_select[1]=16),o(h,_.table_select[1],5),_.table_select[2]==14&&(_.table_select[2]=16),o(h,_.table_select[2],5),st(0<=_.region0_count&&_.region0_count<16),st(0<=_.region1_count&&_.region1_count<8),o(h,_.region0_count,4),o(h,_.region1_count,3)),o(h,_.scalefac_scale,1),o(h,_.count1table_select,1)}w.error_protection&&CRC_writeheader(h,h.header[h.h_ptr].buf);{var L=h.h_ptr;st(h.header[L].ptr==h.sideinfo_len*8),h.h_ptr=L+1&Fa.MAX_HEADER_BUF-1,h.header[h.h_ptr].write_timing=h.header[L].write_timing+g,h.h_ptr==h.w_ptr&&oa.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function V(w,g){var h=Bs.ht[g.count1table_select+32],b,x=0,c=g.big_values,u=g.big_values;for(st(g.count1table_select<2),b=(g.count1-g.big_values)/4;b>0;--b){var _=0,L=0,Y;Y=g.l3_enc[c+0],Y!=0&&(L+=8,g.xr[u+0]<0&&_++),Y=g.l3_enc[c+1],Y!=0&&(L+=4,_*=2,g.xr[u+1]<0&&_++),Y=g.l3_enc[c+2],Y!=0&&(L+=2,_*=2,g.xr[u+2]<0&&_++),Y=g.l3_enc[c+3],Y!=0&&(L++,_*=2,g.xr[u+3]<0&&_++),c+=4,u+=4,f(w,_+h.table[L],h.hlen[L]),x+=h.hlen[L]}return x}function d(w,g,h,b,x){var c=Bs.ht[g],u=0;if(g==0)return u;for(var _=h;_<b;_+=2){var L=0,Y=0,F=c.xlen,U=c.xlen,l=0,p=x.l3_enc[_],Z=x.l3_enc[_+1];if(p!=0&&(x.xr[_]<0&&l++,L--),g>15){if(p>14){var W=p-15;st(W<=c.linmax),l|=W<<1,Y=F,p=15}if(Z>14){var re=Z-15;st(re<=c.linmax),l<<=F,l|=re,Y+=F,Z=15}U=16}Z!=0&&(l<<=1,x.xr[_+1]<0&&l++,L--),p=p*U+Z,Y-=L,L+=c.hlen[p],f(w,c.table[p],L),f(w,l,Y),u+=L+Y}return u}function M(w,g){var h=3*w.scalefac_band.s[3];h>g.big_values&&(h=g.big_values);var b=d(w,g.table_select[0],0,h,g);return b+=d(w,g.table_select[1],h,g.big_values,g),b}function T(w,g){var h,b,x,c;h=g.big_values;var u=g.region0_count+1;return st(u<w.scalefac_band.l.length),x=w.scalefac_band.l[u],u+=g.region1_count+1,st(u<w.scalefac_band.l.length),c=w.scalefac_band.l[u],x>h&&(x=h),c>h&&(c=h),b=d(w,g.table_select[0],0,x,g),b+=d(w,g.table_select[1],x,c,g),b+=d(w,g.table_select[2],c,h,g),b}function C(w){var g,h,b,x,c=0,u=w.internal_flags,_=u.l3_side;if(w.version==1)for(g=0;g<2;g++)for(h=0;h<u.channels_out;h++){var L=_.tt[g][h],Y=Ji.slen1_tab[L.scalefac_compress],F=Ji.slen2_tab[L.scalefac_compress];for(x=0,b=0;b<L.sfbdivide;b++)L.scalefac[b]!=-1&&(f(u,L.scalefac[b],Y),x+=Y);for(;b<L.sfbmax;b++)L.scalefac[b]!=-1&&(f(u,L.scalefac[b],F),x+=F);st(x==L.part2_length),L.block_type==Lo.SHORT_TYPE?x+=M(u,L):x+=T(u,L),x+=V(u,L),st(x==L.part2_3_length+L.part2_length),c+=x}else for(g=0,h=0;h<u.channels_out;h++){var L=_.tt[g][h],U,l,p=0;if(st(L.sfb_partition_table!=null),x=0,b=0,l=0,L.block_type==Lo.SHORT_TYPE){for(;l<4;l++){var Z=L.sfb_partition_table[l]/3,W=L.slen[l];for(U=0;U<Z;U++,b++)f(u,Math.max(L.scalefac[b*3+0],0),W),f(u,Math.max(L.scalefac[b*3+1],0),W),f(u,Math.max(L.scalefac[b*3+2],0),W),p+=3*W}x+=M(u,L)}else{for(;l<4;l++){var Z=L.sfb_partition_table[l],W=L.slen[l];for(U=0;U<Z;U++,b++)f(u,Math.max(L.scalefac[b],0),W),p+=W}x+=T(u,L)}x+=V(u,L),st(x==L.part2_3_length),st(p==L.part2_length),c+=p+x}return c}function B(){this.total=0}function i(w,g){var h=w.internal_flags,b,x,c,u,_;return _=h.w_ptr,u=h.h_ptr-1,u==-1&&(u=Fa.MAX_HEADER_BUF-1),b=h.header[u].write_timing-A,g.total=b,b>=0&&(x=1+u-_,u<_&&(x=1+u-_+Fa.MAX_HEADER_BUF),b-=x*8*h.sideinfo_len),c=e.getframebits(w),b+=c,g.total+=c,g.total%8!=0?g.total=1+g.total/8:g.total=g.total/8,g.total+=O+1,b<0&&oa.err.println(`strange error flushing buffer ... 
`),b}this.flush_bitstream=function(w){var g=w.internal_flags,h,b,x=g.h_ptr-1;if(x==-1&&(x=Fa.MAX_HEADER_BUF-1),h=g.l3_side,!((b=i(w,new B))<0)){if(k(w,b),st(g.header[x].write_timing+this.getframebits(w)==A),g.ResvSize=0,h.main_data_begin=0,g.findReplayGain){var c=a.GetTitleGain(g.rgdata);st(NEQ(c,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),g.RadioGain=Math.floor(c*10+.5)|0}g.findPeakSample&&(g.noclipGainChange=Math.ceil(Math.log10(g.PeakSample/32767)*20*10)|0,g.noclipGainChange>0&&(EQ(w.scale,1)||EQ(w.scale,0))?g.noclipScale=Math.floor(32767/g.PeakSample*100)/100:g.noclipScale=-1)}},this.add_dummy_byte=function(w,g,h){for(var b=w.internal_flags,x;h-- >0;)for(y(b,g,8),x=0;x<Fa.MAX_HEADER_BUF;++x)b.header[x].write_timing+=8},this.format_bitstream=function(w){var g=w.internal_flags,h;h=g.l3_side;var b=this.getframebits(w);k(w,h.resvDrain_pre),j(w,b);var x=8*g.sideinfo_len;if(x+=C(w),k(w,h.resvDrain_post),x+=h.resvDrain_post,h.main_data_begin+=(b-x)/8,i(w,new B)!=g.ResvSize&&oa.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),h.main_data_begin*8!=g.ResvSize&&(oa.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*h.main_data_begin,g.ResvSize,h.resvDrain_post,h.resvDrain_pre,8*g.sideinfo_len,x-h.resvDrain_post-8*g.sideinfo_len,x,x%8,b),oa.err.println("This is a fatal error.  It has several possible causes:"),oa.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),oa.err.println(" 9%%  Your system is overclocked"),oa.err.println(" 1%%  bug in LAME encoding library"),g.ResvSize=h.main_data_begin*8),A>1e9){var c;for(c=0;c<Fa.MAX_HEADER_BUF;++c)g.header[c].write_timing-=A;A=0}return 0},this.copy_buffer=function(w,g,h,b,x){var c=O+1;if(c<=0)return 0;if(b!=0&&c>b)return-1;if(oa.arraycopy(S,0,g,h,c),O=-1,v=0,x!=0){var u=O2(1);if(u[0]=w.nMusicCRC,s.updateMusicCRC(u,g,h,c),w.nMusicCRC=u[0],c>0&&(w.VBR_seek_table.nBytesWritten+=c),w.decode_on_the_fly){for(var _=C2([2,1152]),L=c,Y=-1,F;Y!=0;)if(Y=n.hip_decode1_unclipped(w.hip,g,h,L,_[0],_[1]),L=0,Y==-1&&(Y=0),Y>0){if(w.findPeakSample){for(F=0;F<Y;F++)_[0][F]>w.PeakSample?w.PeakSample=_[0][F]:-_[0][F]>w.PeakSample&&(w.PeakSample=-_[0][F]);if(w.channels_out>1)for(F=0;F<Y;F++)_[1][F]>w.PeakSample?w.PeakSample=_[1][F]:-_[1][F]>w.PeakSample&&(w.PeakSample=-_[1][F])}if(w.findReplayGain&&a.AnalyzeSamples(w.rgdata,_[0],0,_[1],0,Y,w.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return c},this.init_bit_stream_w=function(w){S=B2(Lame.LAME_MAXMP3BUFFER),w.h_ptr=w.w_ptr=0,w.header[w.h_ptr].write_timing=0,O=-1,v=0,A=0}}var e0=No,Da=Ze,L2=Da.System,Ye=Da.VbrMode,Cs=Da.ShortBlock,Ua=Da.new_float,t0=Da.new_int_n,N2=Da.new_short_n,ya=Da.assert,Os=Dm,I2=qm,Io=Bo,V2=f2,j2=p2,H2=k2,za=e0,sa=Ms,nt=Mt;function mt(){var e=this,t=128*1024;mt.V9=410,mt.V8=420,mt.V7=430,mt.V6=440,mt.V5=450,mt.V4=460,mt.V3=470,mt.V2=480,mt.V1=490,mt.V0=500,mt.R3MIX=1e3,mt.STANDARD=1001,mt.EXTREME=1002,mt.INSANE=1003,mt.STANDARD_FAST=1004,mt.EXTREME_FAST=1005,mt.MEDIUM=1006,mt.MEDIUM_FAST=1007;var a=16384+t;mt.LAME_MAXMP3BUFFER=a;var n,m,s,S,A,O=new Os,v,N,f;this.enc=new nt,this.setModules=function(l,p,Z,W,re,me,ce,he,ke){n=l,m=p,s=Z,S=W,A=re,v=me,N=he,f=ke,this.enc.setModules(m,O,S,v)};function y(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=Ua(nt.SBMAX_l),this.bo_s_weight=Ua(nt.SBMAX_s)}function k(){this.lowerlimit=0}function o(l,p){this.lowpass=p}var H=4294479419;function j(l){var p;return l.class_id=H,p=l.internal_flags=new Io,l.mode=MPEGMode.NOT_SET,l.original=1,l.in_samplerate=44100,l.num_channels=2,l.num_samples=-1,l.bWriteVbrTag=!0,l.quality=-1,l.short_blocks=null,p.subblock_gain=-1,l.lowpassfreq=0,l.highpassfreq=0,l.lowpasswidth=-1,l.highpasswidth=-1,l.VBR=Ye.vbr_off,l.VBR_q=4,l.ATHcurve=-1,l.VBR_mean_bitrate_kbps=128,l.VBR_min_bitrate_kbps=0,l.VBR_max_bitrate_kbps=0,l.VBR_hard_min=0,p.VBR_min_bitrate=1,p.VBR_max_bitrate=13,l.quant_comp=-1,l.quant_comp_short=-1,l.msfix=-1,p.resample_ratio=1,p.OldValue[0]=180,p.OldValue[1]=180,p.CurrentStep[0]=4,p.CurrentStep[1]=4,p.masking_lower=1,p.nsPsy.attackthre=-1,p.nsPsy.attackthre_s=-1,l.scale=-1,l.athaa_type=-1,l.ATHtype=-1,l.athaa_loudapprox=-1,l.athaa_sensitivity=0,l.useTemporal=null,l.interChRatio=-1,p.mf_samples_to_encode=nt.ENCDELAY+nt.POSTDELAY,l.encoder_padding=0,p.mf_size=nt.ENCDELAY-nt.MDCTDELAY,l.findReplayGain=!1,l.decode_on_the_fly=!1,p.decode_on_the_fly=!1,p.findReplayGain=!1,p.findPeakSample=!1,p.RadioGain=0,p.AudiophileGain=0,p.noclipGainChange=0,p.noclipScale=-1,l.preset=0,l.write_id3tag_automatic=!0,0}this.lame_init=function(){var l=new I2;return j(l),l.lame_allocated_gfp=1,l};function V(l){return l>1?0:l<=0?1:Math.cos(Math.PI/2*l)}this.nearestBitrateFullIndex=function(l){var p=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],Z=0,W=0,re=0,me=0;me=p[16],re=16,W=p[16],Z=16;for(var ce=0;ce<16;ce++)if(Math.max(l,p[ce+1])!=l){me=p[ce+1],re=ce+1,W=p[ce],Z=ce;break}return me-l>l-W?Z:re};function d(l,p){var Z=44100;return p>=48e3?Z=48e3:p>=44100?Z=44100:p>=32e3?Z=32e3:p>=24e3?Z=24e3:p>=22050?Z=22050:p>=16e3?Z=16e3:p>=12e3?Z=12e3:p>=11025?Z=11025:p>=8e3&&(Z=8e3),l==-1?Z:(l<=15960&&(Z=44100),l<=15250&&(Z=32e3),l<=11220&&(Z=24e3),l<=9970&&(Z=22050),l<=7230&&(Z=16e3),l<=5420&&(Z=12e3),l<=4510&&(Z=11025),l<=3970&&(Z=8e3),p<Z?p>44100?48e3:p>32e3?44100:p>24e3?32e3:p>22050?24e3:p>16e3?22050:p>12e3?16e3:p>11025?12e3:p>8e3?11025:8e3:Z)}function M(l,p){switch(l){case 44100:return p.version=1,0;case 48e3:return p.version=1,1;case 32e3:return p.version=1,2;case 22050:return p.version=0,0;case 24e3:return p.version=0,1;case 16e3:return p.version=0,2;case 11025:return p.version=0,0;case 12e3:return p.version=0,1;case 8e3:return p.version=0,2;default:return p.version=0,-1}}function T(l,p,Z){Z<16e3&&(p=2);for(var W=sa.bitrate_table[p][1],re=2;re<=14;re++)sa.bitrate_table[p][re]>0&&Math.abs(sa.bitrate_table[p][re]-l)<Math.abs(W-l)&&(W=sa.bitrate_table[p][re]);return W}function C(l,p,Z){Z<16e3&&(p=2);for(var W=0;W<=14;W++)if(sa.bitrate_table[p][W]>0&&sa.bitrate_table[p][W]==l)return W;return-1}function B(l,p){var Z=[new o(8,2e3),new o(16,3700),new o(24,3900),new o(32,5500),new o(40,7e3),new o(48,7500),new o(56,1e4),new o(64,11e3),new o(80,13500),new o(96,15100),new o(112,15600),new o(128,17e3),new o(160,17500),new o(192,18600),new o(224,19400),new o(256,19700),new o(320,20500)],W=e.nearestBitrateFullIndex(p);l.lowerlimit=Z[W].lowpass}function i(l){var p=l.internal_flags,Z=32,W=-1;if(p.lowpass1>0){for(var re=999,me=0;me<=31;me++){var ce=me/31;ce>=p.lowpass2&&(Z=Math.min(Z,me)),p.lowpass1<ce&&ce<p.lowpass2&&(re=Math.min(re,me))}re==999?p.lowpass1=(Z-.75)/31:p.lowpass1=(re-.75)/31,p.lowpass2=Z/31}if(p.highpass2>0&&p.highpass2<.9*(.75/31)&&(p.highpass1=0,p.highpass2=0,L2.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),p.highpass2>0){for(var he=-1,me=0;me<=31;me++){var ce=me/31;ce<=p.highpass1&&(W=Math.max(W,me)),p.highpass1<ce&&ce<p.highpass2&&(he=Math.max(he,me))}p.highpass1=W/31,he==-1?p.highpass2=(W+.75)/31:p.highpass2=(he+.75)/31}for(var me=0;me<32;me++){var ke,pe,ce=me/31;p.highpass2>p.highpass1?ke=V((p.highpass2-ce)/(p.highpass2-p.highpass1+1e-20)):ke=1,p.lowpass2>p.lowpass1?pe=V((ce-p.lowpass1)/(p.lowpass2-p.lowpass1+1e-20)):pe=1,p.amp_filter[me]=ke*pe}}function w(l){var p=l.internal_flags;switch(l.quality){default:case 9:p.psymodel=0,p.noise_shaping=0,p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.use_best_huffman=0,p.full_outer_loop=0;break;case 8:l.quality=7;case 7:p.psymodel=1,p.noise_shaping=0,p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.use_best_huffman=0,p.full_outer_loop=0;break;case 6:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=0,p.full_outer_loop=0;break;case 5:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=0,p.full_outer_loop=0;break;case 4:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 3:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=1,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 2:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.substep_shaping==0&&(p.substep_shaping=2),p.noise_shaping_amp=1,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 1:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.substep_shaping==0&&(p.substep_shaping=2),p.noise_shaping_amp=2,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 0:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.substep_shaping==0&&(p.substep_shaping=2),p.noise_shaping_amp=2,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break}}function g(l){var p=l.internal_flags;l.frameNum=0,l.write_id3tag_automatic&&N.id3tag_write_v2(l),p.bitrate_stereoMode_Hist=t0([16,4+1]),p.bitrate_blockType_Hist=t0([16,4+1+1]),p.PeakSample=0,l.bWriteVbrTag&&v.InitVbrTag(l)}this.lame_init_params=function(l){var p=l.internal_flags;if(p.Class_ID=0,p.ATH==null&&(p.ATH=new V2),p.PSY==null&&(p.PSY=new y),p.rgdata==null&&(p.rgdata=new j2),p.channels_in=l.num_channels,p.channels_in==1&&(l.mode=MPEGMode.MONO),p.channels_out=l.mode==MPEGMode.MONO?1:2,p.mode_ext=nt.MPG_MD_MS_LR,l.mode==MPEGMode.MONO&&(l.force_ms=!1),l.VBR==Ye.vbr_off&&l.VBR_mean_bitrate_kbps!=128&&l.brate==0&&(l.brate=l.VBR_mean_bitrate_kbps),l.VBR==Ye.vbr_off||l.VBR==Ye.vbr_mtrh||l.VBR==Ye.vbr_mt||(l.free_format=!1),l.VBR==Ye.vbr_off&&l.brate==0&&za.EQ(l.compression_ratio,0)&&(l.compression_ratio=11.025),l.VBR==Ye.vbr_off&&l.compression_ratio>0&&(l.out_samplerate==0&&(l.out_samplerate=map2MP3Frequency(int(.97*l.in_samplerate))),l.brate=0|l.out_samplerate*16*p.channels_out/(1e3*l.compression_ratio),p.samplerate_index=M(l.out_samplerate,l),l.free_format||(l.brate=T(l.brate,l.version,l.out_samplerate))),l.out_samplerate!=0&&(l.out_samplerate<16e3?(l.VBR_mean_bitrate_kbps=Math.max(l.VBR_mean_bitrate_kbps,8),l.VBR_mean_bitrate_kbps=Math.min(l.VBR_mean_bitrate_kbps,64)):l.out_samplerate<32e3?(l.VBR_mean_bitrate_kbps=Math.max(l.VBR_mean_bitrate_kbps,8),l.VBR_mean_bitrate_kbps=Math.min(l.VBR_mean_bitrate_kbps,160)):(l.VBR_mean_bitrate_kbps=Math.max(l.VBR_mean_bitrate_kbps,32),l.VBR_mean_bitrate_kbps=Math.min(l.VBR_mean_bitrate_kbps,320))),l.lowpassfreq==0){var Z=16e3;switch(l.VBR){case Ye.vbr_off:{var W=new k;B(W,l.brate),Z=W.lowerlimit;break}case Ye.vbr_abr:{var W=new k;B(W,l.VBR_mean_bitrate_kbps),Z=W.lowerlimit;break}case Ye.vbr_rh:{var re=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=l.VBR_q&&l.VBR_q<=9){var me=re[l.VBR_q],ce=re[l.VBR_q+1],he=l.VBR_q_frac;Z=linear_int(me,ce,he)}else Z=19500;break}default:{var re=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=l.VBR_q&&l.VBR_q<=9){var me=re[l.VBR_q],ce=re[l.VBR_q+1],he=l.VBR_q_frac;Z=linear_int(me,ce,he)}else Z=19500}}l.mode==MPEGMode.MONO&&(l.VBR==Ye.vbr_off||l.VBR==Ye.vbr_abr)&&(Z*=1.5),l.lowpassfreq=Z|0}if(l.out_samplerate==0&&(2*l.lowpassfreq>l.in_samplerate&&(l.lowpassfreq=l.in_samplerate/2),l.out_samplerate=d(l.lowpassfreq|0,l.in_samplerate)),l.lowpassfreq=Math.min(20500,l.lowpassfreq),l.lowpassfreq=Math.min(l.out_samplerate/2,l.lowpassfreq),l.VBR==Ye.vbr_off&&(l.compression_ratio=l.out_samplerate*16*p.channels_out/(1e3*l.brate)),l.VBR==Ye.vbr_abr&&(l.compression_ratio=l.out_samplerate*16*p.channels_out/(1e3*l.VBR_mean_bitrate_kbps)),l.bWriteVbrTag||(l.findReplayGain=!1,l.decode_on_the_fly=!1,p.findPeakSample=!1),p.findReplayGain=l.findReplayGain,p.decode_on_the_fly=l.decode_on_the_fly,p.decode_on_the_fly&&(p.findPeakSample=!0),p.findReplayGain&&n.InitGainAnalysis(p.rgdata,l.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return l.internal_flags=null,-6;switch(p.decode_on_the_fly&&!l.decode_only&&(p.hip!=null&&f.hip_decode_exit(p.hip),p.hip=f.hip_decode_init()),p.mode_gr=l.out_samplerate<=24e3?1:2,l.framesize=576*p.mode_gr,l.encoder_delay=nt.ENCDELAY,p.resample_ratio=l.in_samplerate/l.out_samplerate,l.VBR){case Ye.vbr_mt:case Ye.vbr_rh:case Ye.vbr_mtrh:{var ke=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];l.compression_ratio=ke[l.VBR_q]}break;case Ye.vbr_abr:l.compression_ratio=l.out_samplerate*16*p.channels_out/(1e3*l.VBR_mean_bitrate_kbps);break;default:l.compression_ratio=l.out_samplerate*16*p.channels_out/(1e3*l.brate);break}if(l.mode==MPEGMode.NOT_SET&&(l.mode=MPEGMode.JOINT_STEREO),l.highpassfreq>0?(p.highpass1=2*l.highpassfreq,l.highpasswidth>=0?p.highpass2=2*(l.highpassfreq+l.highpasswidth):p.highpass2=(1+0)*2*l.highpassfreq,p.highpass1/=l.out_samplerate,p.highpass2/=l.out_samplerate):(p.highpass1=0,p.highpass2=0),l.lowpassfreq>0?(p.lowpass2=2*l.lowpassfreq,l.lowpasswidth>=0?(p.lowpass1=2*(l.lowpassfreq-l.lowpasswidth),p.lowpass1<0&&(p.lowpass1=0)):p.lowpass1=(1-0)*2*l.lowpassfreq,p.lowpass1/=l.out_samplerate,p.lowpass2/=l.out_samplerate):(p.lowpass1=0,p.lowpass2=0),i(l),p.samplerate_index=M(l.out_samplerate,l),p.samplerate_index<0)return l.internal_flags=null,-1;if(l.VBR==Ye.vbr_off){if(l.free_format)p.bitrate_index=0;else if(l.brate=T(l.brate,l.version,l.out_samplerate),p.bitrate_index=C(l.brate,l.version,l.out_samplerate),p.bitrate_index<=0)return l.internal_flags=null,-1}else p.bitrate_index=1;l.analysis&&(l.bWriteVbrTag=!1),p.pinfo!=null&&(l.bWriteVbrTag=!1),m.init_bit_stream_w(p);for(var pe=p.samplerate_index+3*l.version+6*(l.out_samplerate<16e3?1:0),de=0;de<nt.SBMAX_l+1;de++)p.scalefac_band.l[de]=S.sfBandIndex[pe].l[de];for(var de=0;de<nt.PSFB21+1;de++){var Me=(p.scalefac_band.l[22]-p.scalefac_band.l[21])/nt.PSFB21,je=p.scalefac_band.l[21]+de*Me;p.scalefac_band.psfb21[de]=je}p.scalefac_band.psfb21[nt.PSFB21]=576;for(var de=0;de<nt.SBMAX_s+1;de++)p.scalefac_band.s[de]=S.sfBandIndex[pe].s[de];for(var de=0;de<nt.PSFB12+1;de++){var Me=(p.scalefac_band.s[13]-p.scalefac_band.s[12])/nt.PSFB12,je=p.scalefac_band.s[12]+de*Me;p.scalefac_band.psfb12[de]=je}p.scalefac_band.psfb12[nt.PSFB12]=192,l.version==1?p.sideinfo_len=p.channels_out==1?4+17:4+32:p.sideinfo_len=p.channels_out==1?4+9:4+17,l.error_protection&&(p.sideinfo_len+=2),g(l),p.Class_ID=H;{var Be;for(Be=0;Be<19;Be++)p.nsPsy.pefirbuf[Be]=700*p.mode_gr*p.channels_out;l.ATHtype==-1&&(l.ATHtype=4)}switch(ya(l.VBR_q<=9),ya(l.VBR_q>=0),l.VBR){case Ye.vbr_mt:l.VBR=Ye.vbr_mtrh;case Ye.vbr_mtrh:{l.useTemporal==null&&(l.useTemporal=!1),s.apply_preset(l,500-l.VBR_q*10,0),l.quality<0&&(l.quality=LAME_DEFAULT_QUALITY),l.quality<5&&(l.quality=0),l.quality>5&&(l.quality=5),p.PSY.mask_adjust=l.maskingadjust,p.PSY.mask_adjust_short=l.maskingadjust_short,l.experimentalY?p.sfb21_extra=!1:p.sfb21_extra=l.out_samplerate>44e3,p.iteration_loop=new VBRNewIterationLoop(A);break}case Ye.vbr_rh:{s.apply_preset(l,500-l.VBR_q*10,0),p.PSY.mask_adjust=l.maskingadjust,p.PSY.mask_adjust_short=l.maskingadjust_short,l.experimentalY?p.sfb21_extra=!1:p.sfb21_extra=l.out_samplerate>44e3,l.quality>6&&(l.quality=6),l.quality<0&&(l.quality=LAME_DEFAULT_QUALITY),p.iteration_loop=new VBROldIterationLoop(A);break}default:{var Fe;p.sfb21_extra=!1,l.quality<0&&(l.quality=LAME_DEFAULT_QUALITY),Fe=l.VBR,Fe==Ye.vbr_off&&(l.VBR_mean_bitrate_kbps=l.brate),s.apply_preset(l,l.VBR_mean_bitrate_kbps,0),l.VBR=Fe,p.PSY.mask_adjust=l.maskingadjust,p.PSY.mask_adjust_short=l.maskingadjust_short,Fe==Ye.vbr_off?p.iteration_loop=new H2(A):p.iteration_loop=new ABRIterationLoop(A);break}}if(ya(l.scale>=0),l.VBR!=Ye.vbr_off){if(p.VBR_min_bitrate=1,p.VBR_max_bitrate=14,l.out_samplerate<16e3&&(p.VBR_max_bitrate=8),l.VBR_min_bitrate_kbps!=0&&(l.VBR_min_bitrate_kbps=T(l.VBR_min_bitrate_kbps,l.version,l.out_samplerate),p.VBR_min_bitrate=C(l.VBR_min_bitrate_kbps,l.version,l.out_samplerate),p.VBR_min_bitrate<0)||l.VBR_max_bitrate_kbps!=0&&(l.VBR_max_bitrate_kbps=T(l.VBR_max_bitrate_kbps,l.version,l.out_samplerate),p.VBR_max_bitrate=C(l.VBR_max_bitrate_kbps,l.version,l.out_samplerate),p.VBR_max_bitrate<0))return-1;l.VBR_min_bitrate_kbps=sa.bitrate_table[l.version][p.VBR_min_bitrate],l.VBR_max_bitrate_kbps=sa.bitrate_table[l.version][p.VBR_max_bitrate],l.VBR_mean_bitrate_kbps=Math.min(sa.bitrate_table[l.version][p.VBR_max_bitrate],l.VBR_mean_bitrate_kbps),l.VBR_mean_bitrate_kbps=Math.max(sa.bitrate_table[l.version][p.VBR_min_bitrate],l.VBR_mean_bitrate_kbps)}return l.tune&&(p.PSY.mask_adjust+=l.tune_value_a,p.PSY.mask_adjust_short+=l.tune_value_a),w(l),ya(l.scale>=0),l.athaa_type<0?p.ATH.useAdjust=3:p.ATH.useAdjust=l.athaa_type,p.ATH.aaSensitivityP=Math.pow(10,l.athaa_sensitivity/-10),l.short_blocks==null&&(l.short_blocks=Cs.short_block_allowed),l.short_blocks==Cs.short_block_allowed&&(l.mode==MPEGMode.JOINT_STEREO||l.mode==MPEGMode.STEREO)&&(l.short_blocks=Cs.short_block_coupled),l.quant_comp<0&&(l.quant_comp=1),l.quant_comp_short<0&&(l.quant_comp_short=0),l.msfix<0&&(l.msfix=0),l.exp_nspsytune=l.exp_nspsytune|1,l.internal_flags.nsPsy.attackthre<0&&(l.internal_flags.nsPsy.attackthre=Os.NSATTACKTHRE),l.internal_flags.nsPsy.attackthre_s<0&&(l.internal_flags.nsPsy.attackthre_s=Os.NSATTACKTHRE_S),ya(l.scale>=0),l.scale<0&&(l.scale=1),l.ATHtype<0&&(l.ATHtype=4),l.ATHcurve<0&&(l.ATHcurve=4),l.athaa_loudapprox<0&&(l.athaa_loudapprox=2),l.interChRatio<0&&(l.interChRatio=0),l.useTemporal==null&&(l.useTemporal=!0),p.slot_lag=p.frac_SpF=0,l.VBR==Ye.vbr_off&&(p.slot_lag=p.frac_SpF=(l.version+1)*72e3*l.brate%l.out_samplerate|0),S.iteration_init(l),O.psymodel_init(l),ya(l.scale>=0),0};function h(l,p){(l.in_buffer_0==null||l.in_buffer_nsamples<p)&&(l.in_buffer_0=Ua(p),l.in_buffer_1=Ua(p),l.in_buffer_nsamples=p)}this.lame_encode_flush=function(l,p,Z,W){var re=l.internal_flags,me=N2([2,1152]),ce=0,he,ke,pe,de,Me=re.mf_samples_to_encode-nt.POSTDELAY,je=b(l);if(re.mf_samples_to_encode<1)return 0;for(he=0,l.in_samplerate!=l.out_samplerate&&(Me+=16*l.out_samplerate/l.in_samplerate),pe=l.framesize-Me%l.framesize,pe<576&&(pe+=l.framesize),l.encoder_padding=pe,de=(Me+pe)/l.framesize;de>0&&ce>=0;){var Be=je-re.mf_size,Fe=l.frameNum;Be*=l.in_samplerate,Be/=l.out_samplerate,Be>1152&&(Be=1152),Be<1&&(Be=1),ke=W-he,W==0&&(ke=0),ce=this.lame_encode_buffer(l,me[0],me[1],Be,p,Z,ke),Z+=ce,he+=ce,de-=Fe!=l.frameNum?1:0}if(re.mf_samples_to_encode=0,ce<0||(ke=W-he,W==0&&(ke=0),m.flush_bitstream(l),ce=m.copy_buffer(re,p,Z,ke,1),ce<0))return ce;if(Z+=ce,he+=ce,ke=W-he,W==0&&(ke=0),l.write_id3tag_automatic){if(N.id3tag_write_v1(l),ce=m.copy_buffer(re,p,Z,ke,0),ce<0)return ce;he+=ce}return he},this.lame_encode_buffer=function(l,p,Z,W,re,me,ce){var he=l.internal_flags,ke=[null,null];if(he.Class_ID!=H)return-3;if(W==0)return 0;h(he,W),ke[0]=he.in_buffer_0,ke[1]=he.in_buffer_1;for(var pe=0;pe<W;pe++)ke[0][pe]=p[pe],he.channels_in>1&&(ke[1][pe]=Z[pe]);return x(l,ke[0],ke[1],W,re,me,ce)};function b(l){var p=nt.BLKSIZE+l.framesize-nt.FFTOFFSET;return p=Math.max(p,512+l.framesize-32),p}function x(l,p,Z,W,re,me,ce){var he=l.internal_flags,ke=0,pe,de,Me,je,Be,Fe=[null,null],He=[null,null];if(he.Class_ID!=H)return-3;if(W==0)return 0;if(Be=m.copy_buffer(he,re,me,ce,0),Be<0)return Be;if(me+=Be,ke+=Be,He[0]=p,He[1]=Z,za.NEQ(l.scale,0)&&za.NEQ(l.scale,1))for(de=0;de<W;++de)He[0][de]*=l.scale,he.channels_out==2&&(He[1][de]*=l.scale);if(za.NEQ(l.scale_left,0)&&za.NEQ(l.scale_left,1))for(de=0;de<W;++de)He[0][de]*=l.scale_left;if(za.NEQ(l.scale_right,0)&&za.NEQ(l.scale_right,1))for(de=0;de<W;++de)He[1][de]*=l.scale_right;if(l.num_channels==2&&he.channels_out==1)for(de=0;de<W;++de)He[0][de]=.5*(He[0][de]+He[1][de]),He[1][de]=0;je=b(l),Fe[0]=he.mfbuf[0],Fe[1]=he.mfbuf[1];for(var Pe=0;W>0;){var Ge=[null,null],xt=0,ut=0;Ge[0]=He[0],Ge[1]=He[1];var lt=new u;if(U(l,Fe,Ge,Pe,W,lt),xt=lt.n_in,ut=lt.n_out,he.findReplayGain&&!he.decode_on_the_fly&&n.AnalyzeSamples(he.rgdata,Fe[0],he.mf_size,Fe[1],he.mf_size,ut,he.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(W-=xt,Pe+=xt,he.channels_out==2,he.mf_size+=ut,ya(he.mf_size<=Io.MFSIZE),he.mf_samples_to_encode<1&&(he.mf_samples_to_encode=nt.ENCDELAY+nt.POSTDELAY),he.mf_samples_to_encode+=ut,he.mf_size>=je){var wt=ce-ke;if(ce==0&&(wt=0),pe=c(l,Fe[0],Fe[1],re,me,wt),pe<0)return pe;for(me+=pe,ke+=pe,he.mf_size-=l.framesize,he.mf_samples_to_encode-=l.framesize,Me=0;Me<he.channels_out;Me++)for(de=0;de<he.mf_size;de++)Fe[Me][de]=Fe[Me][de+l.framesize]}}return ke}function c(l,p,Z,W,re,me){var ce=e.enc.lame_encode_mp3_frame(l,p,Z,W,re,me);return l.frameNum++,ce}function u(){this.n_in=0,this.n_out=0}function _(){this.num_used=0}function L(l,p){return p!=0?L(p,l%p):l}function Y(l,p,Z){var W=Math.PI*p;l/=Z,l<0&&(l=0),l>1&&(l=1);var re=l-.5,me=.42-.5*Math.cos(2*l*Math.PI)+.08*Math.cos(4*l*Math.PI);return Math.abs(re)<1e-9?W/Math.PI:me*Math.sin(Z*W*re)/(Math.PI*Z*re)}function F(l,p,Z,W,re,me,ce,he,ke){var pe=l.internal_flags,de,Me=0,je,Be=l.out_samplerate/L(l.out_samplerate,l.in_samplerate);Be>Io.BPC&&(Be=Io.BPC);var Fe=Math.abs(pe.resample_ratio-Math.floor(.5+pe.resample_ratio))<1e-4?1:0,He=1/pe.resample_ratio;He>1&&(He=1);var Pe=31;Pe%2==0&&--Pe,Pe+=Fe;var Ge=Pe+1;if(pe.fill_buffer_resample_init==0){for(pe.inbuf_old[0]=Ua(Ge),pe.inbuf_old[1]=Ua(Ge),de=0;de<=2*Be;++de)pe.blackfilt[de]=Ua(Ge);for(pe.itime[0]=0,pe.itime[1]=0,Me=0;Me<=2*Be;Me++){var xt=0,ut=(Me-Be)/(2*Be);for(de=0;de<=Pe;de++)xt+=pe.blackfilt[Me][de]=Y(de-ut,He,Pe);for(de=0;de<=Pe;de++)pe.blackfilt[Me][de]/=xt}pe.fill_buffer_resample_init=1}var lt=pe.inbuf_old[ke];for(je=0;je<W;je++){var wt,Ot;if(wt=je*pe.resample_ratio,Me=0|Math.floor(wt-pe.itime[ke]),Pe+Me-Pe/2>=ce)break;var ut=wt-pe.itime[ke]-(Me+.5*(Pe%2));Ot=0|Math.floor(ut*2*Be+Be+.5);var Pt=0;for(de=0;de<=Pe;++de){var ht=0|de+Me-Pe/2,Yt;Yt=ht<0?lt[Ge+ht]:re[me+ht],Pt+=Yt*pe.blackfilt[Ot][de]}p[Z+je]=Pt}if(he.num_used=Math.min(ce,Pe+Me-Pe/2),pe.itime[ke]+=he.num_used-je*pe.resample_ratio,he.num_used>=Ge)for(de=0;de<Ge;de++)lt[de]=re[me+he.num_used+de-Ge];else{var kt=Ge-he.num_used;for(de=0;de<kt;++de)lt[de]=lt[de+he.num_used];for(Me=0;de<Ge;++de,++Me)lt[de]=re[me+Me];ya(Me==he.num_used)}return je}function U(l,p,Z,W,re,me){var ce=l.internal_flags;if(ce.resample_ratio<.9999||ce.resample_ratio>1.0001)for(var he=0;he<ce.channels_out;he++){var ke=new _;me.n_out=F(l,p[he],ce.mf_size,l.framesize,Z[he],W,re,ke,he),me.n_in=ke.num_used}else{me.n_out=Math.min(l.framesize,re),me.n_in=me.n_out;for(var pe=0;pe<me.n_out;++pe)p[0][ce.mf_size+pe]=Z[0][W+pe],ce.channels_out==2&&(p[1][ce.mf_size+pe]=Z[1][W+pe])}}}var P2=mt,F2=Ze,na=F2.VbrMode;function D2(){function e(v,N,f,y,k,o,H,j,V,d,M,T,C,B,i){this.vbr_q=v,this.quant_comp=N,this.quant_comp_s=f,this.expY=y,this.st_lrm=k,this.st_s=o,this.masking_adj=H,this.masking_adj_short=j,this.ath_lower=V,this.ath_curve=d,this.ath_sensitivity=M,this.interch=T,this.safejoint=C,this.sfb21mod=B,this.msfix=i}function t(v,N,f,y,k,o,H,j,V,d,M,T,C,B){this.quant_comp=N,this.quant_comp_s=f,this.safejoint=y,this.nsmsfix=k,this.st_lrm=o,this.st_s=H,this.nsbass=j,this.scale=V,this.masking_adj=d,this.ath_lower=M,this.ath_curve=T,this.interch=C,this.sfscale=B}var a;this.setModules=function(v){a=v};var n=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],m=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function s(v,N,f){var y=v.VBR==na.vbr_rh?n:m,k=v.VBR_q_frac,o=y[N],H=y[N+1],j=o;o.st_lrm=o.st_lrm+k*(H.st_lrm-o.st_lrm),o.st_s=o.st_s+k*(H.st_s-o.st_s),o.masking_adj=o.masking_adj+k*(H.masking_adj-o.masking_adj),o.masking_adj_short=o.masking_adj_short+k*(H.masking_adj_short-o.masking_adj_short),o.ath_lower=o.ath_lower+k*(H.ath_lower-o.ath_lower),o.ath_curve=o.ath_curve+k*(H.ath_curve-o.ath_curve),o.ath_sensitivity=o.ath_sensitivity+k*(H.ath_sensitivity-o.ath_sensitivity),o.interch=o.interch+k*(H.interch-o.interch),o.msfix=o.msfix+k*(H.msfix-o.msfix),O(v,j.vbr_q),f!=0?v.quant_comp=j.quant_comp:Math.abs(v.quant_comp- -1)>0||(v.quant_comp=j.quant_comp),f!=0?v.quant_comp_short=j.quant_comp_s:Math.abs(v.quant_comp_short- -1)>0||(v.quant_comp_short=j.quant_comp_s),j.expY!=0&&(v.experimentalY=j.expY!=0),f!=0?v.internal_flags.nsPsy.attackthre=j.st_lrm:Math.abs(v.internal_flags.nsPsy.attackthre- -1)>0||(v.internal_flags.nsPsy.attackthre=j.st_lrm),f!=0?v.internal_flags.nsPsy.attackthre_s=j.st_s:Math.abs(v.internal_flags.nsPsy.attackthre_s- -1)>0||(v.internal_flags.nsPsy.attackthre_s=j.st_s),f!=0?v.maskingadjust=j.masking_adj:Math.abs(v.maskingadjust-0)>0||(v.maskingadjust=j.masking_adj),f!=0?v.maskingadjust_short=j.masking_adj_short:Math.abs(v.maskingadjust_short-0)>0||(v.maskingadjust_short=j.masking_adj_short),f!=0?v.ATHlower=-j.ath_lower/10:Math.abs(-v.ATHlower*10-0)>0||(v.ATHlower=-j.ath_lower/10),f!=0?v.ATHcurve=j.ath_curve:Math.abs(v.ATHcurve- -1)>0||(v.ATHcurve=j.ath_curve),f!=0?v.athaa_sensitivity=j.ath_sensitivity:Math.abs(v.athaa_sensitivity- -1)>0||(v.athaa_sensitivity=j.ath_sensitivity),j.interch>0&&(f!=0?v.interChRatio=j.interch:Math.abs(v.interChRatio- -1)>0||(v.interChRatio=j.interch)),j.safejoint>0&&(v.exp_nspsytune=v.exp_nspsytune|j.safejoint),j.sfb21mod>0&&(v.exp_nspsytune=v.exp_nspsytune|j.sfb21mod<<20),f!=0?v.msfix=j.msfix:Math.abs(v.msfix- -1)>0||(v.msfix=j.msfix),f==0&&(v.VBR_q=N,v.VBR_q_frac=k)}var S=[new t(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new t(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new t(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new t(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new t(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new t(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new t(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new t(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new t(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new t(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new t(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new t(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new t(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new t(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new t(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function A(v,N,f){var y=N,k=a.nearestBitrateFullIndex(N);if(v.VBR=na.vbr_abr,v.VBR_mean_bitrate_kbps=y,v.VBR_mean_bitrate_kbps=Math.min(v.VBR_mean_bitrate_kbps,320),v.VBR_mean_bitrate_kbps=Math.max(v.VBR_mean_bitrate_kbps,8),v.brate=v.VBR_mean_bitrate_kbps,v.VBR_mean_bitrate_kbps>320&&(v.disable_reservoir=!0),S[k].safejoint>0&&(v.exp_nspsytune=v.exp_nspsytune|2),S[k].sfscale>0&&(v.internal_flags.noise_shaping=2),Math.abs(S[k].nsbass)>0){var o=int(S[k].nsbass*4);o<0&&(o+=64),v.exp_nspsytune=v.exp_nspsytune|o<<2}return f!=0?v.quant_comp=S[k].quant_comp:Math.abs(v.quant_comp- -1)>0||(v.quant_comp=S[k].quant_comp),f!=0?v.quant_comp_short=S[k].quant_comp_s:Math.abs(v.quant_comp_short- -1)>0||(v.quant_comp_short=S[k].quant_comp_s),f!=0?v.msfix=S[k].nsmsfix:Math.abs(v.msfix- -1)>0||(v.msfix=S[k].nsmsfix),f!=0?v.internal_flags.nsPsy.attackthre=S[k].st_lrm:Math.abs(v.internal_flags.nsPsy.attackthre- -1)>0||(v.internal_flags.nsPsy.attackthre=S[k].st_lrm),f!=0?v.internal_flags.nsPsy.attackthre_s=S[k].st_s:Math.abs(v.internal_flags.nsPsy.attackthre_s- -1)>0||(v.internal_flags.nsPsy.attackthre_s=S[k].st_s),f!=0?v.scale=S[k].scale:Math.abs(v.scale- -1)>0||(v.scale=S[k].scale),f!=0?v.maskingadjust=S[k].masking_adj:Math.abs(v.maskingadjust-0)>0||(v.maskingadjust=S[k].masking_adj),S[k].masking_adj>0?f!=0?v.maskingadjust_short=S[k].masking_adj*.9:Math.abs(v.maskingadjust_short-0)>0||(v.maskingadjust_short=S[k].masking_adj*.9):f!=0?v.maskingadjust_short=S[k].masking_adj*1.1:Math.abs(v.maskingadjust_short-0)>0||(v.maskingadjust_short=S[k].masking_adj*1.1),f!=0?v.ATHlower=-S[k].ath_lower/10:Math.abs(-v.ATHlower*10-0)>0||(v.ATHlower=-S[k].ath_lower/10),f!=0?v.ATHcurve=S[k].ath_curve:Math.abs(v.ATHcurve- -1)>0||(v.ATHcurve=S[k].ath_curve),f!=0?v.interChRatio=S[k].interch:Math.abs(v.interChRatio- -1)>0||(v.interChRatio=S[k].interch),N}this.apply_preset=function(v,N,f){switch(N){case Lame.R3MIX:{N=Lame.V3,v.VBR=na.vbr_mtrh;break}case Lame.MEDIUM:{N=Lame.V4,v.VBR=na.vbr_rh;break}case Lame.MEDIUM_FAST:{N=Lame.V4,v.VBR=na.vbr_mtrh;break}case Lame.STANDARD:{N=Lame.V2,v.VBR=na.vbr_rh;break}case Lame.STANDARD_FAST:{N=Lame.V2,v.VBR=na.vbr_mtrh;break}case Lame.EXTREME:{N=Lame.V0,v.VBR=na.vbr_rh;break}case Lame.EXTREME_FAST:{N=Lame.V0,v.VBR=na.vbr_mtrh;break}case Lame.INSANE:return N=320,v.preset=N,A(v,N,f),v.VBR=na.vbr_off,N}switch(v.preset=N,N){case Lame.V9:return s(v,9,f),N;case Lame.V8:return s(v,8,f),N;case Lame.V7:return s(v,7,f),N;case Lame.V6:return s(v,6,f),N;case Lame.V5:return s(v,5,f),N;case Lame.V4:return s(v,4,f),N;case Lame.V3:return s(v,3,f),N;case Lame.V2:return s(v,2,f),N;case Lame.V1:return s(v,1,f),N;case Lame.V0:return s(v,0,f),N}return 8<=N&&N<=320?A(v,N,f):(v.preset=0,N)};function O(v,N){var f=0;return 0>N&&(f=-1,N=0),9<N&&(f=-1,N=9),v.VBR_q=N,v.VBR_q_frac=0,f}}var U2=D2;function z2(){this.setModules=function(e,t){}}var q2=z2;function X2(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var Y2=X2,a0=Ze,r0=a0.new_float,G2=a0.new_int;function K2(){this.global_gain=0,this.sfb_count1=0,this.step=G2(39),this.noise=r0(39),this.noise_log=r0(39)}var Z2=K2,lr=Ze,xa=lr.System,o0=lr.VbrMode,Ls=lr.Util,cr=lr.Arrays,Dr=lr.new_float,Ur=lr.assert,W2=q2,Ns=Y2,Q2=Z2,Ve=Mt,s0=ws,n0=Eo;function $2(){var e;this.rv=null;var t;this.qupvt=null;var a,n=new W2,m;this.setModules=function(V,d,M,T){e=V,t=d,this.rv=d,a=M,this.qupvt=M,m=T,n.setModules(a,m)},this.ms_convert=function(V,d){for(var M=0;M<576;++M){var T=V.tt[d][0].xr[M],C=V.tt[d][1].xr[M];V.tt[d][0].xr[M]=(T+C)*(Ls.SQRT2*.5),V.tt[d][1].xr[M]=(T-C)*(Ls.SQRT2*.5)}};function s(V,d,M,T){T=0;for(var C=0;C<=M;++C){var B=Math.abs(V.xr[C]);T+=B,d[C]=Math.sqrt(B*Math.sqrt(B)),d[C]>V.xrpow_max&&(V.xrpow_max=d[C])}return T}this.init_xrpow=function(V,d,M){var T=0,C=0|d.max_nonzero_coeff;if(d.xrpow_max=0,cr.fill(M,C,576,0),T=s(d,M,C,T),T>1e-20){var B=0;(V.substep_shaping&2)!=0&&(B=1);for(var i=0;i<d.psymax;i++)V.pseudohalf[i]=B;return!0}return cr.fill(d.l3_enc,0,576,0),!1};function S(V,d){var M=V.ATH,T=d.xr;if(d.block_type!=Ve.SHORT_TYPE)for(var C=!1,B=Ve.PSFB21-1;B>=0&&!C;B--){var i=V.scalefac_band.psfb21[B],w=V.scalefac_band.psfb21[B+1],g=a.athAdjust(M.adjust,M.psfb21[B],M.floor);V.nsPsy.longfact[21]>1e-12&&(g*=V.nsPsy.longfact[21]);for(var h=w-1;h>=i;h--)if(Math.abs(T[h])<g)T[h]=0;else{C=!0;break}}else for(var b=0;b<3;b++)for(var C=!1,B=Ve.PSFB12-1;B>=0&&!C;B--){var i=V.scalefac_band.s[12]*3+(V.scalefac_band.s[13]-V.scalefac_band.s[12])*b+(V.scalefac_band.psfb12[B]-V.scalefac_band.psfb12[0]),w=i+(V.scalefac_band.psfb12[B+1]-V.scalefac_band.psfb12[B]),x=a.athAdjust(M.adjust,M.psfb12[B],M.floor);V.nsPsy.shortfact[12]>1e-12&&(x*=V.nsPsy.shortfact[12]);for(var h=w-1;h>=i;h--)if(Math.abs(T[h])<x)T[h]=0;else{C=!0;break}}}this.init_outer_loop=function(V,d){d.part2_3_length=0,d.big_values=0,d.count1=0,d.global_gain=210,d.scalefac_compress=0,d.table_select[0]=0,d.table_select[1]=0,d.table_select[2]=0,d.subblock_gain[0]=0,d.subblock_gain[1]=0,d.subblock_gain[2]=0,d.subblock_gain[3]=0,d.region0_count=0,d.region1_count=0,d.preflag=0,d.scalefac_scale=0,d.count1table_select=0,d.part2_length=0,d.sfb_lmax=Ve.SBPSY_l,d.sfb_smin=Ve.SBPSY_s,d.psy_lmax=V.sfb21_extra?Ve.SBMAX_l:Ve.SBPSY_l,d.psymax=d.psy_lmax,d.sfbmax=d.sfb_lmax,d.sfbdivide=11;for(var M=0;M<Ve.SBMAX_l;M++)d.width[M]=V.scalefac_band.l[M+1]-V.scalefac_band.l[M],d.window[M]=3;if(d.block_type==Ve.SHORT_TYPE){var T=Dr(576);d.sfb_smin=0,d.sfb_lmax=0,d.mixed_block_flag!=0&&(d.sfb_smin=3,d.sfb_lmax=V.mode_gr*2+4),d.psymax=d.sfb_lmax+3*((V.sfb21_extra?Ve.SBMAX_s:Ve.SBPSY_s)-d.sfb_smin),d.sfbmax=d.sfb_lmax+3*(Ve.SBPSY_s-d.sfb_smin),d.sfbdivide=d.sfbmax-18,d.psy_lmax=d.sfb_lmax;var C=V.scalefac_band.l[d.sfb_lmax];xa.arraycopy(d.xr,0,T,0,576);for(var M=d.sfb_smin;M<Ve.SBMAX_s;M++)for(var B=V.scalefac_band.s[M],i=V.scalefac_band.s[M+1],w=0;w<3;w++)for(var g=B;g<i;g++)d.xr[C++]=T[3*g+w];for(var h=d.sfb_lmax,M=d.sfb_smin;M<Ve.SBMAX_s;M++)d.width[h]=d.width[h+1]=d.width[h+2]=V.scalefac_band.s[M+1]-V.scalefac_band.s[M],d.window[h]=0,d.window[h+1]=1,d.window[h+2]=2,h+=3}d.count1bits=0,d.sfb_partition_table=a.nr_of_sfb_block[0][0],d.slen[0]=0,d.slen[1]=0,d.slen[2]=0,d.slen[3]=0,d.max_nonzero_coeff=575,cr.fill(d.scalefac,0),S(V,d)};function A(V){this.ordinal=V}A.BINSEARCH_NONE=new A(0),A.BINSEARCH_UP=new A(1),A.BINSEARCH_DOWN=new A(2);function O(V,d,M,T,C){var B,i=V.CurrentStep[T],w=!1,g=V.OldValue[T],h=A.BINSEARCH_NONE;for(d.global_gain=g,M-=d.part2_length;;){var b;if(B=m.count_bits(V,C,d,null),i==1||B==M)break;B>M?(h==A.BINSEARCH_DOWN&&(w=!0),w&&(i/=2),h=A.BINSEARCH_UP,b=i):(h==A.BINSEARCH_UP&&(w=!0),w&&(i/=2),h=A.BINSEARCH_DOWN,b=-i),d.global_gain+=b,d.global_gain<0&&(d.global_gain=0,w=!0),d.global_gain>255&&(d.global_gain=255,w=!0)}for(Ur(d.global_gain>=0),Ur(d.global_gain<256);B>M&&d.global_gain<255;)d.global_gain++,B=m.count_bits(V,C,d,null);return V.CurrentStep[T]=g-d.global_gain>=4?4:2,V.OldValue[T]=d.global_gain,d.part2_3_length=B,B}this.trancate_smallspectrums=function(V,d,M,T){var C=Dr(n0.SFBMAX);if(!((V.substep_shaping&4)==0&&d.block_type==Ve.SHORT_TYPE||(V.substep_shaping&128)!=0)){a.calc_noise(d,M,C,new Ns,null);for(var i=0;i<576;i++){var B=0;d.l3_enc[i]!=0&&(B=Math.abs(d.xr[i])),T[i]=B}var i=0,w=8;d.block_type==Ve.SHORT_TYPE&&(w=6);do{var g,h,b,x,c=d.width[w];if(i+=c,!(C[w]>=1)&&(cr.sort(T,i-c,c),!BitStream.EQ(T[i-1],0))){g=(1-C[w])*M[w],h=0,x=0;do{var u;for(b=1;x+b<c&&!BitStream.NEQ(T[x+i-c],T[x+i+b-c]);b++);if(u=T[x+i-c]*T[x+i-c]*b,g<u){x!=0&&(h=T[x+i-c-1]);break}g-=u,x+=b}while(x<c);if(!BitStream.EQ(h,0))do Math.abs(d.xr[i-c])<=h&&(d.l3_enc[i-c]=0);while(--c>0)}}while(++w<d.psymax);d.part2_3_length=m.noquant_count_bits(V,d,null)}};function v(V){for(var d=0;d<V.sfbmax;d++)if(V.scalefac[d]+V.subblock_gain[V.window[d]]==0)return!1;return!0}function N(V){return Ls.FAST_LOG10(.368+.632*V*V*V)}function f(V,d){for(var M=1e-37,T=0;T<d.psymax;T++)M+=N(V[T]);return Math.max(1e-20,M)}function y(V,d,M,T,C){var B;switch(V){default:case 9:{d.over_count>0?(B=M.over_SSD<=d.over_SSD,M.over_SSD==d.over_SSD&&(B=M.bits<d.bits)):B=M.max_noise<0&&M.max_noise*10+M.bits<=d.max_noise*10+d.bits;break}case 0:B=M.over_count<d.over_count||M.over_count==d.over_count&&M.over_noise<d.over_noise||M.over_count==d.over_count&&BitStream.EQ(M.over_noise,d.over_noise)&&M.tot_noise<d.tot_noise;break;case 8:M.max_noise=f(C,T);case 1:B=M.max_noise<d.max_noise;break;case 2:B=M.tot_noise<d.tot_noise;break;case 3:B=M.tot_noise<d.tot_noise&&M.max_noise<d.max_noise;break;case 4:B=M.max_noise<=0&&d.max_noise>.2||M.max_noise<=0&&d.max_noise<0&&d.max_noise>M.max_noise-.2&&M.tot_noise<d.tot_noise||M.max_noise<=0&&d.max_noise>0&&d.max_noise>M.max_noise-.2&&M.tot_noise<d.tot_noise+d.over_noise||M.max_noise>0&&d.max_noise>-.05&&d.max_noise>M.max_noise-.1&&M.tot_noise+M.over_noise<d.tot_noise+d.over_noise||M.max_noise>0&&d.max_noise>-.1&&d.max_noise>M.max_noise-.15&&M.tot_noise+M.over_noise+M.over_noise<d.tot_noise+d.over_noise+d.over_noise;break;case 5:B=M.over_noise<d.over_noise||BitStream.EQ(M.over_noise,d.over_noise)&&M.tot_noise<d.tot_noise;break;case 6:B=M.over_noise<d.over_noise||BitStream.EQ(M.over_noise,d.over_noise)&&(M.max_noise<d.max_noise||BitStream.EQ(M.max_noise,d.max_noise)&&M.tot_noise<=d.tot_noise);break;case 7:B=M.over_count<d.over_count||M.over_noise<d.over_noise;break}return d.over_count==0&&(B=B&&M.bits<d.bits),B}function k(V,d,M,T,C){var B=V.internal_flags,i;d.scalefac_scale==0?i=1.2968395546510096:i=1.6817928305074292;for(var w=0,g=0;g<d.sfbmax;g++)w<M[g]&&(w=M[g]);var h=B.noise_shaping_amp;switch(h==3&&(C?h=2:h=1),h){case 2:break;case 1:w>1?w=Math.pow(w,.5):w*=.95;break;case 0:default:w>1?w=1:w*=.95;break}for(var b=0,g=0;g<d.sfbmax;g++){var x=d.width[g],c;if(b+=x,!(M[g]<w)){if((B.substep_shaping&2)!=0&&(B.pseudohalf[g]=B.pseudohalf[g]==0?1:0,B.pseudohalf[g]==0&&B.noise_shaping_amp==2))return;for(d.scalefac[g]++,c=-x;c<0;c++)T[b+c]*=i,T[b+c]>d.xrpow_max&&(d.xrpow_max=T[b+c]);if(B.noise_shaping_amp==2)return}}}function o(V,d){for(var M=1.2968395546510096,T=0,C=0;C<V.sfbmax;C++){var B=V.width[C],i=V.scalefac[C];if(V.preflag!=0&&(i+=a.pretab[C]),T+=B,(i&1)!=0){i++;for(var w=-B;w<0;w++)d[T+w]*=M,d[T+w]>V.xrpow_max&&(V.xrpow_max=d[T+w])}V.scalefac[C]=i>>1}V.preflag=0,V.scalefac_scale=1}function H(V,d,M){var T,C=d.scalefac;for(T=0;T<d.sfb_lmax;T++)if(C[T]>=16)return!0;for(var B=0;B<3;B++){var i=0,w=0;for(T=d.sfb_lmax+B;T<d.sfbdivide;T+=3)i<C[T]&&(i=C[T]);for(;T<d.sfbmax;T+=3)w<C[T]&&(w=C[T]);if(!(i<16&&w<8)){if(d.subblock_gain[B]>=7)return!0;d.subblock_gain[B]++;var g=V.scalefac_band.l[d.sfb_lmax];for(T=d.sfb_lmax+B;T<d.sfbmax;T+=3){var h,b=d.width[T],x=C[T];if(x=x-(4>>d.scalefac_scale),x>=0){C[T]=x,g+=b*3;continue}C[T]=0;{var c=210+(x<<d.scalefac_scale+1);h=a.IPOW20(c)}g+=b*(B+1);for(var u=-b;u<0;u++)M[g+u]*=h,M[g+u]>d.xrpow_max&&(d.xrpow_max=M[g+u]);g+=b*(3-B-1)}{var h=a.IPOW20(202);g+=d.width[T]*(B+1);for(var u=-d.width[T];u<0;u++)M[g+u]*=h,M[g+u]>d.xrpow_max&&(d.xrpow_max=M[g+u])}}}return!1}function j(V,d,M,T,C){var B=V.internal_flags;k(V,d,M,T,C);var i=v(d);return i?!1:(B.mode_gr==2?i=m.scale_bitcount(d):i=m.scale_bitcount_lsf(B,d),i?(B.noise_shaping>1&&(cr.fill(B.pseudohalf,0),d.scalefac_scale==0?(o(d,T),i=!1):d.block_type==Ve.SHORT_TYPE&&B.subblock_gain>0&&(i=H(B,d,T)||v(d))),i||(B.mode_gr==2?i=m.scale_bitcount(d):i=m.scale_bitcount_lsf(B,d)),!i):!0)}this.outer_loop=function(V,d,M,T,C,B){var i=V.internal_flags,w=new s0,g=Dr(576),h=Dr(n0.SFBMAX),b=new Ns,x,c=new Q2,u=9999999,_=!1,L=!1,Y=0;if(O(i,d,B,C,T),i.noise_shaping==0)return 100;a.calc_noise(d,M,h,b,c),b.bits=d.part2_3_length,w.assign(d);var F=0;for(xa.arraycopy(T,0,g,0,576);!_;){do{var U=new Ns,l,p=255;if((i.substep_shaping&2)!=0?l=20:l=3,i.sfb21_extra&&(h[w.sfbmax]>1||w.block_type==Ve.SHORT_TYPE&&(h[w.sfbmax+1]>1||h[w.sfbmax+2]>1))||!j(V,w,h,T,L))break;w.scalefac_scale!=0&&(p=254);var Z=B-w.part2_length;if(Z<=0)break;for(;(w.part2_3_length=m.count_bits(i,T,w,c))>Z&&w.global_gain<=p;)w.global_gain++;if(w.global_gain>p)break;if(b.over_count==0){for(;(w.part2_3_length=m.count_bits(i,T,w,c))>u&&w.global_gain<=p;)w.global_gain++;if(w.global_gain>p)break}if(a.calc_noise(w,M,h,U,c),U.bits=w.part2_3_length,d.block_type!=Ve.SHORT_TYPE?x=V.quant_comp:x=V.quant_comp_short,x=y(x,b,U,w,h)?1:0,x!=0)u=d.part2_3_length,b=U,d.assign(w),F=0,xa.arraycopy(T,0,g,0,576);else if(i.full_outer_loop==0&&(++F>l&&b.over_count==0||i.noise_shaping_amp==3&&L&&F>30||i.noise_shaping_amp==3&&L&&w.global_gain-Y>15))break}while(w.global_gain+w.scalefac_scale<255);i.noise_shaping_amp==3?L?_=!0:(w.assign(d),xa.arraycopy(g,0,T,0,576),F=0,Y=w.global_gain,L=!0):_=!0}return Ur(d.global_gain+d.scalefac_scale<=255),V.VBR==o0.vbr_rh||V.VBR==o0.vbr_mtrh?xa.arraycopy(g,0,T,0,576):(i.substep_shaping&1)!=0&&trancate_smallspectrums(i,d,M,T),b.over_count},this.iteration_finish_one=function(V,d,M){var T=V.l3_side,C=T.tt[d][M];m.best_scalefac_store(V,d,M,T),V.use_best_huffman==1&&m.best_huffman_divide(V,C),t.ResvAdjust(V,C)},this.VBR_encode_granule=function(V,d,M,T,C,B,i){var w=V.internal_flags,g=new s0,h=Dr(576),b=i,x=i+1,c=(i+B)/2,u,_,L=0,Y=w.sfb21_extra;Ur(b<=LameInternalFlags.MAX_BITS_PER_CHANNEL),cr.fill(g.l3_enc,0);do c>b-42?w.sfb21_extra=!1:w.sfb21_extra=Y,_=outer_loop(V,d,M,T,C,c),_<=0?(L=1,x=d.part2_3_length,g.assign(d),xa.arraycopy(T,0,h,0,576),i=x-32,u=i-B,c=(i+B)/2):(B=c+32,u=i-B,c=(i+B)/2,L!=0&&(L=2,d.assign(g),xa.arraycopy(h,0,T,0,576)));while(u>12);w.sfb21_extra=Y,L==2&&xa.arraycopy(g.l3_enc,0,d.l3_enc,0,576),Ur(d.part2_3_length<=b)},this.get_framebits=function(V,d){var M=V.internal_flags;M.bitrate_index=M.VBR_min_bitrate;var T=e.getframebits(V);M.bitrate_index=1,T=e.getframebits(V);for(var C=1;C<=M.VBR_max_bitrate;C++){M.bitrate_index=C;var B=new MeanBits(T);d[C]=t.ResvFrameBegin(V,B),T=B.bits}},this.VBR_old_prepare=function(V,d,M,T,C,B,i,w,g){var h=V.internal_flags,b,x=0,c=1,u=0;h.bitrate_index=h.VBR_max_bitrate;var _=t.ResvFrameBegin(V,new MeanBits(0))/h.mode_gr;get_framebits(V,B);for(var L=0;L<h.mode_gr;L++){var Y=a.on_pe(V,d,w[L],_,L,0);h.mode_ext==Ve.MPG_MD_MS_LR&&(ms_convert(h.l3_side,L),a.reduce_side(w[L],M[L],_,Y));for(var F=0;F<h.channels_out;++F){var U=h.l3_side.tt[L][F];U.block_type!=Ve.SHORT_TYPE?(x=1.28/(1+Math.exp(3.5-d[L][F]/300))-.05,b=h.PSY.mask_adjust-x):(x=2.56/(1+Math.exp(3.5-d[L][F]/300))-.14,b=h.PSY.mask_adjust_short-x),h.masking_lower=Math.pow(10,b*.1),init_outer_loop(h,U),g[L][F]=a.calc_xmin(V,T[L][F],U,C[L][F]),g[L][F]!=0&&(c=0),i[L][F]=126,u+=w[L][F]}}for(var L=0;L<h.mode_gr;L++)for(var F=0;F<h.channels_out;F++)u>B[h.VBR_max_bitrate]&&(w[L][F]*=B[h.VBR_max_bitrate],w[L][F]/=u),i[L][F]>w[L][F]&&(i[L][F]=w[L][F]);return c},this.bitpressure_strategy=function(V,d,M,T){for(var C=0;C<V.mode_gr;C++)for(var B=0;B<V.channels_out;B++){for(var i=V.l3_side.tt[C][B],w=d[C][B],g=0,h=0;h<i.psy_lmax;h++)w[g++]*=1+.029*h*h/Ve.SBMAX_l/Ve.SBMAX_l;if(i.block_type==Ve.SHORT_TYPE)for(var h=i.sfb_smin;h<Ve.SBMAX_s;h++)w[g++]*=1+.029*h*h/Ve.SBMAX_s/Ve.SBMAX_s,w[g++]*=1+.029*h*h/Ve.SBMAX_s/Ve.SBMAX_s,w[g++]*=1+.029*h*h/Ve.SBMAX_s/Ve.SBMAX_s;T[C][B]=0|Math.max(M[C][B],.9*T[C][B])}},this.VBR_new_prepare=function(V,d,M,T,C,B){var i=V.internal_flags,w=1,g=0,h=0,b;if(V.free_format){i.bitrate_index=0;var x=new MeanBits(g);b=t.ResvFrameBegin(V,x),g=x.bits,C[0]=b}else{i.bitrate_index=i.VBR_max_bitrate;var x=new MeanBits(g);t.ResvFrameBegin(V,x),g=x.bits,get_framebits(V,C),b=C[i.VBR_max_bitrate]}for(var c=0;c<i.mode_gr;c++){a.on_pe(V,d,B[c],g,c,0),i.mode_ext==Ve.MPG_MD_MS_LR&&ms_convert(i.l3_side,c);for(var u=0;u<i.channels_out;++u){var _=i.l3_side.tt[c][u];i.masking_lower=Math.pow(10,i.PSY.mask_adjust*.1),init_outer_loop(i,_),a.calc_xmin(V,M[c][u],_,T[c][u])!=0&&(w=0),h+=B[c][u]}}for(var c=0;c<i.mode_gr;c++)for(var u=0;u<i.channels_out;u++)h>b&&(B[c][u]*=b,B[c][u]/=h);return w},this.calc_target_bits=function(V,d,M,T,C,B){var i=V.internal_flags,w=i.l3_side,g,h,b,x,c=0;i.bitrate_index=i.VBR_max_bitrate;var u=new MeanBits(c);for(B[0]=t.ResvFrameBegin(V,u),c=u.bits,i.bitrate_index=1,c=e.getframebits(V)-i.sideinfo_len*8,C[0]=c/(i.mode_gr*i.channels_out),c=V.VBR_mean_bitrate_kbps*V.framesize*1e3,(i.substep_shaping&1)!=0&&(c*=1.09),c/=V.out_samplerate,c-=i.sideinfo_len*8,c/=i.mode_gr*i.channels_out,g=.93+.07*(11-V.compression_ratio)/(11-5.5),g<.9&&(g=.9),g>1&&(g=1),h=0;h<i.mode_gr;h++){var _=0;for(b=0;b<i.channels_out;b++){if(T[h][b]=int(g*c),d[h][b]>700){var L=int((d[h][b]-700)/1.4),Y=w.tt[h][b];T[h][b]=int(g*c),Y.block_type==Ve.SHORT_TYPE&&L<c/2&&(L=c/2),L>c*3/2?L=c*3/2:L<0&&(L=0),T[h][b]+=L}T[h][b]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(T[h][b]=LameInternalFlags.MAX_BITS_PER_CHANNEL),_+=T[h][b]}if(_>LameInternalFlags.MAX_BITS_PER_GRANULE)for(b=0;b<i.channels_out;++b)T[h][b]*=LameInternalFlags.MAX_BITS_PER_GRANULE,T[h][b]/=_}if(i.mode_ext==Ve.MPG_MD_MS_LR)for(h=0;h<i.mode_gr;h++)a.reduce_side(T[h],M[h],c*i.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(x=0,h=0;h<i.mode_gr;h++)for(b=0;b<i.channels_out;b++)T[h][b]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(T[h][b]=LameInternalFlags.MAX_BITS_PER_CHANNEL),x+=T[h][b];if(x>B[0])for(h=0;h<i.mode_gr;h++)for(b=0;b<i.channels_out;b++)T[h][b]*=B[0],T[h][b]/=x}}var J2=$2,eh=Ze,i0=eh.assert;function th(){var e;this.setModules=function(t){e=t},this.ResvFrameBegin=function(t,a){var n=t.internal_flags,m,s=n.l3_side,S=e.getframebits(t);a.bits=(S-n.sideinfo_len*8)/n.mode_gr;var A=8*256*n.mode_gr-8;t.brate>320?m=8*int(t.brate*1e3/(t.out_samplerate/1152)/8+.5):(m=8*1440,t.strict_ISO&&(m=8*int(32e4/(t.out_samplerate/1152)/8+.5))),n.ResvMax=m-S,n.ResvMax>A&&(n.ResvMax=A),(n.ResvMax<0||t.disable_reservoir)&&(n.ResvMax=0);var O=a.bits*n.mode_gr+Math.min(n.ResvSize,n.ResvMax);return O>m&&(O=m),i0(n.ResvMax%8==0),i0(n.ResvMax>=0),s.resvDrain_pre=0,n.pinfo!=null&&(n.pinfo.mean_bits=a.bits/2,n.pinfo.resvsize=n.ResvSize),O},this.ResvMaxBits=function(t,a,n,m){var s=t.internal_flags,S,A=s.ResvSize,O=s.ResvMax;m!=0&&(A+=a),(s.substep_shaping&1)!=0&&(O*=.9),n.bits=a,A*10>O*9?(S=A-O*9/10,n.bits+=S,s.substep_shaping|=128):(S=0,s.substep_shaping&=127,!t.disable_reservoir&&(s.substep_shaping&1)==0&&(n.bits-=.1*a));var v=A<s.ResvMax*6/10?A:s.ResvMax*6/10;return v-=S,v<0&&(v=0),v},this.ResvAdjust=function(t,a){t.ResvSize-=a.part2_3_length+a.part2_length},this.ResvFrameEnd=function(t,a){var n,m=t.l3_side;t.ResvSize+=a*t.mode_gr;var s=0;m.resvDrain_post=0,m.resvDrain_pre=0,(n=t.ResvSize%8)!=0&&(s+=n),n=t.ResvSize-s-t.ResvMax,n>0&&(s+=n);{var S=Math.min(m.main_data_begin*8,s)/8;m.resvDrain_pre+=8*S,s-=8*S,t.ResvSize-=8*S,m.main_data_begin-=S}m.resvDrain_post+=s,t.ResvSize-=s}}var ah=th;function rh(){var e="http://www.mp3dev.org/",t=3,a=98,n=4,m=0,s=93;this.getLameVersion=function(){return t+"."+a+"."+n},this.getLameShortVersion=function(){return t+"."+a+"."+n},this.getLameVeryShortVersion=function(){return"LAME"+t+"."+a+"r"},this.getPsyVersion=function(){return m+"."+s},this.getLameUrl=function(){return e},this.getLameOsBitness=function(){return"32bits"}}var oh=rh,dr=Ze,sh=dr.System,Is=dr.VbrMode,l0=dr.ShortBlock,nh=dr.Arrays,Vo=dr.new_byte,ih=dr.assert;zr.NUMTOCENTRIES=100,zr.MAXFRAMESIZE=2880;function zr(){var e,t,a;this.setModules=function(c,u,_){e=c,t=u,a=_};var n=1,m=2,s=4,S=8,A=zr.NUMTOCENTRIES,O=zr.MAXFRAMESIZE,v=A+4+4+4+4+4,N=v+9+1+1+8+1+1+3+1+1+2+4+2+2,f=128,y=64,k=32,o=null,H="Xing",j="Info",V=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function d(c,u){if(c.nVbrNumFrames++,c.sum+=u,c.seen++,!(c.seen<c.want)&&(c.pos<c.size&&(c.bag[c.pos]=c.sum,c.pos++,c.seen=0),c.pos==c.size)){for(var _=1;_<c.size;_+=2)c.bag[_/2]=c.bag[_];c.want*=2,c.pos/=2}}function M(c,u){if(!(c.pos<=0))for(var _=1;_<A;++_){var L=_/A,Y,F,U=0|Math.floor(L*c.pos);U>c.pos-1&&(U=c.pos-1),Y=c.bag[U],F=c.sum;var l=0|256*Y/F;l>255&&(l=255),u[_]=255&l}}this.addVbrFrame=function(c){var u=c.internal_flags,_=Tables.bitrate_table[c.version][u.bitrate_index];ih(u.VBR_seek_table.bag!=null),d(u.VBR_seek_table,_)};function T(c,u){var _=c[u+0]&255;return _<<=8,_|=c[u+1]&255,_<<=8,_|=c[u+2]&255,_<<=8,_|=c[u+3]&255,_}function C(c,u,_){c[u+0]=255&(_>>24&255),c[u+1]=255&(_>>16&255),c[u+2]=255&(_>>8&255),c[u+3]=255&(_&255)}function B(c,u,_){c[u+0]=255&(_>>8&255),c[u+1]=255&(_&255)}function i(c,u){return new String(c,u,H.length(),o).equals(H)||new String(c,u,j.length(),o).equals(j)}function w(c,u,_){return 255&(c<<u|_&~(-1<<u))}function g(c,u){var _=c.internal_flags;u[0]=w(u[0],8,255),u[1]=w(u[1],3,7),u[1]=w(u[1],1,c.out_samplerate<16e3?0:1),u[1]=w(u[1],1,c.version),u[1]=w(u[1],2,4-3),u[1]=w(u[1],1,c.error_protection?0:1),u[2]=w(u[2],4,_.bitrate_index),u[2]=w(u[2],2,_.samplerate_index),u[2]=w(u[2],1,0),u[2]=w(u[2],1,c.extension),u[3]=w(u[3],2,c.mode.ordinal()),u[3]=w(u[3],2,_.mode_ext),u[3]=w(u[3],1,c.copyright),u[3]=w(u[3],1,c.original),u[3]=w(u[3],2,c.emphasis),u[0]=255;var L=255&(u[1]&241),Y;c.version==1?Y=f:c.out_samplerate<16e3?Y=k:Y=y,c.VBR==Is.vbr_off&&(Y=c.brate);var F;c.free_format?F=0:F=255&16*e.BitrateIndex(Y,c.version,c.out_samplerate),c.version==1?(u[1]=255&(L|10),L=255&(u[2]&13),u[2]=255&(F|L)):(u[1]=255&(L|2),L=255&(u[2]&13),u[2]=255&(F|L))}this.getVbrTag=function(c){var u=new VBRTagData,_=0;u.flags=0;var L=c[_+1]>>3&1,Y=c[_+2]>>2&3,F=c[_+3]>>6&3,U=c[_+2]>>4&15;if(U=Tables.bitrate_table[L][U],c[_+1]>>4==14?u.samprate=Tables.samplerate_table[2][Y]:u.samprate=Tables.samplerate_table[L][Y],L!=0?F!=3?_+=32+4:_+=17+4:F!=3?_+=17+4:_+=9+4,!i(c,_))return null;_+=4,u.hId=L;var l=u.flags=T(c,_);if(_+=4,(l&n)!=0&&(u.frames=T(c,_),_+=4),(l&m)!=0&&(u.bytes=T(c,_),_+=4),(l&s)!=0){if(u.toc!=null)for(var p=0;p<A;p++)u.toc[p]=c[_+p];_+=A}u.vbrScale=-1,(l&S)!=0&&(u.vbrScale=T(c,_),_+=4),u.headersize=(L+1)*72e3*U/u.samprate,_+=21;var Z=c[_+0]<<4;Z+=c[_+1]>>4;var W=(c[_+1]&15)<<8;return W+=c[_+2]&255,(Z<0||Z>3e3)&&(Z=-1),(W<0||W>3e3)&&(W=-1),u.encDelay=Z,u.encPadding=W,u},this.InitVbrTag=function(c){var u=c.internal_flags,_;c.version==1?_=f:c.out_samplerate<16e3?_=k:_=y,c.VBR==Is.vbr_off&&(_=c.brate);var L=(c.version+1)*72e3*_/c.out_samplerate,Y=u.sideinfo_len+N;if(u.VBR_seek_table.TotalFrameSize=L,L<Y||L>O){c.bWriteVbrTag=!1;return}u.VBR_seek_table.nVbrNumFrames=0,u.VBR_seek_table.nBytesWritten=0,u.VBR_seek_table.sum=0,u.VBR_seek_table.seen=0,u.VBR_seek_table.want=1,u.VBR_seek_table.pos=0,u.VBR_seek_table.bag==null&&(u.VBR_seek_table.bag=new int[400],u.VBR_seek_table.size=400);var F=Vo(O);g(c,F);for(var U=u.VBR_seek_table.TotalFrameSize,l=0;l<U;++l)t.add_dummy_byte(c,F[l]&255,1)};function h(c,u){var _=u^c;return u=u>>8^V[_&255],u}this.updateMusicCRC=function(c,u,_,L){for(var Y=0;Y<L;++Y)c[0]=h(u[_+Y],c[0])};function b(c,u,_,L,Y){var F=c.internal_flags,U=0,l=c.encoder_delay,p=c.encoder_padding,Z=100-10*c.VBR_q-c.quality,W=a.getLameVeryShortVersion(),re,me=0,ce,he=[1,5,3,2,4,0,3],ke=0|(c.lowpassfreq/100+.5>255?255:c.lowpassfreq/100+.5),pe=0,de=0,Me=0,je=c.internal_flags.noise_shaping,Be=0,Fe=0,He=0,Pe=0,Ge=0,xt=(c.exp_nspsytune&1)!=0,ut=(c.exp_nspsytune&2)!=0,lt=!1,wt=!1,Ot=c.internal_flags.nogap_total,Pt=c.internal_flags.nogap_current,ht=c.ATHtype,Yt=0,kt;switch(c.VBR){case vbr_abr:kt=c.VBR_mean_bitrate_kbps;break;case vbr_off:kt=c.brate;break;default:kt=c.VBR_min_bitrate_kbps}switch(c.VBR.ordinal()<he.length?re=he[c.VBR.ordinal()]:re=0,ce=16*me+re,F.findReplayGain&&(F.RadioGain>510&&(F.RadioGain=510),F.RadioGain<-510&&(F.RadioGain=-510),de=8192,de|=3072,F.RadioGain>=0?de|=F.RadioGain:(de|=512,de|=-F.RadioGain)),F.findPeakSample&&(pe=Math.abs(0|F.PeakSample/32767*Math.pow(2,23)+.5)),Ot!=-1&&(Pt>0&&(wt=!0),Pt<Ot-1&&(lt=!0)),Yt=ht+((xt?1:0)<<4)+((ut?1:0)<<5)+((lt?1:0)<<6)+((wt?1:0)<<7),Z<0&&(Z=0),c.mode){case MONO:Be=0;break;case STEREO:Be=1;break;case DUAL_CHANNEL:Be=2;break;case JOINT_STEREO:c.force_ms?Be=4:Be=3;break;case NOT_SET:default:Be=7;break}c.in_samplerate<=32e3?He=0:c.in_samplerate==48e3?He=2:c.in_samplerate>48e3?He=3:He=1,(c.short_blocks==l0.short_block_forced||c.short_blocks==l0.short_block_dispensed||c.lowpassfreq==-1&&c.highpassfreq==-1||c.scale_left<c.scale_right||c.scale_left>c.scale_right||c.disable_reservoir&&c.brate<320||c.noATH||c.ATHonly||ht==0||c.in_samplerate<=32e3)&&(Fe=1),Pe=je+(Be<<2)+(Fe<<5)+(He<<6),Ge=F.nMusicCRC,C(_,L+U,Z),U+=4;for(var _t=0;_t<9;_t++)_[L+U+_t]=255&W.charAt(_t);U+=9,_[L+U]=255&ce,U++,_[L+U]=255&ke,U++,C(_,L+U,pe),U+=4,B(_,L+U,de),U+=2,B(_,L+U,Me),U+=2,_[L+U]=255&Yt,U++,kt>=255?_[L+U]=255:_[L+U]=255&kt,U++,_[L+U]=255&l>>4,_[L+U+1]=255&(l<<4)+(p>>8),_[L+U+2]=255&p,U+=3,_[L+U]=255&Pe,U++,_[L+U++]=0,B(_,L+U,c.preset),U+=2,C(_,L+U,u),U+=4,B(_,L+U,Ge),U+=2;for(var le=0;le<U;le++)Y=h(_[L+le],Y);return B(_,L+U,Y),U+=2,U}function x(c){c.seek(0);var u=Vo(10);c.readFully(u);var _;return new String(u,"ISO-8859-1").startsWith("ID3")?_=0:_=((u[6]&127)<<21|(u[7]&127)<<14|(u[8]&127)<<7|u[9]&127)+u.length,_}this.getLameTagFrame=function(c,u){var _=c.internal_flags;if(!c.bWriteVbrTag||_.Class_ID!=Lame.LAME_ID||_.VBR_seek_table.pos<=0)return 0;if(u.length<_.VBR_seek_table.TotalFrameSize)return _.VBR_seek_table.TotalFrameSize;nh.fill(u,0,_.VBR_seek_table.TotalFrameSize,0),g(c,u);var L=Vo(A);if(c.free_format)for(var Y=1;Y<A;++Y)L[Y]=255&255*Y/100;else M(_.VBR_seek_table,L);var F=_.sideinfo_len;c.error_protection&&(F-=2),c.VBR==Is.vbr_off?(u[F++]=255&j.charAt(0),u[F++]=255&j.charAt(1),u[F++]=255&j.charAt(2),u[F++]=255&j.charAt(3)):(u[F++]=255&H.charAt(0),u[F++]=255&H.charAt(1),u[F++]=255&H.charAt(2),u[F++]=255&H.charAt(3)),C(u,F,n+m+s+S),F+=4,C(u,F,_.VBR_seek_table.nVbrNumFrames),F+=4;var U=_.VBR_seek_table.nBytesWritten+_.VBR_seek_table.TotalFrameSize;C(u,F,0|U),F+=4,sh.arraycopy(L,0,u,F,L.length),F+=L.length,c.error_protection&&t.CRC_writeheader(_,u);for(var l=0,Y=0;Y<F;Y++)l=h(u[Y],l);return F+=b(c,U,u,F,l),_.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(c,u){var _=c.internal_flags;if(_.VBR_seek_table.pos<=0||(u.seek(u.length()),u.length()==0))return-1;var L=x(u);u.seek(L);var Y=Vo(O),F=getLameTagFrame(c,Y);return F>Y.length?-1:(F<1||u.write(Y,0,F),0)}}var lh=zr,c0=Ze,d0=c0.new_byte,ch=c0.assert,dh=P2,mh=U2,hh=qi,uh=Qi,fh=J2,_h=$i,ph=ah,vh=Ni,gh=e0,bh=oh,yh=lh;function xh(){this.setModules=function(e,t){}}function wh(){this.setModules=function(e,t,a){}}function kh(){}function Sh(){this.setModules=function(e,t){}}function Eh(e,t,a){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,t=44100,a=128);var n=new dh,m=new xh,s=new hh,S=new gh,A=new mh,O=new uh,v=new fh,N=new yh,f=new bh,y=new Sh,k=new ph,o=new _h,H=new wh,j=new kh;n.setModules(s,S,A,O,v,N,f,y,j),S.setModules(s,j,f,N),y.setModules(S,f),A.setModules(n),v.setModules(S,k,O,o),O.setModules(o,k,n.enc.psy),k.setModules(S),o.setModules(O),N.setModules(n,S,f),m.setModules(H,j),H.setModules(f,y,A);var V=n.lame_init();V.num_channels=e,V.in_samplerate=t,V.brate=a,V.mode=vh.STEREO,V.quality=3,V.bWriteVbrTag=!1,V.disable_reservoir=!0,V.write_id3tag_automatic=!1,n.lame_init_params(V);var d=1152,M=0|1.25*d+7200,T=d0(M);this.encodeBuffer=function(C,B){e==1&&(B=C),ch(C.length==B.length),C.length>d&&(d=C.length,M=0|1.25*d+7200,T=d0(M));var i=n.lame_encode_buffer(V,C,B,C.length,T,0,M);return new Int8Array(T.subarray(0,i))},this.flush=function(){var C=n.lame_encode_flush(V,T,0,M);return new Int8Array(T.subarray(0,C))}}function ia(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function jo(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}ia.RIFF=jo("RIFF"),ia.WAVE=jo("WAVE"),ia.fmt_=jo("fmt "),ia.data=jo("data"),ia.readHeader=function(e){var t=new ia,a=e.getUint32(0,!1);if(ia.RIFF==a&&(e.getUint32(4,!0),ia.WAVE==e.getUint32(8,!1)&&ia.fmt_==e.getUint32(12,!1))){var n=e.getUint32(16,!0),m=16+4;switch(n){case 16:case 18:t.channels=e.getUint16(m+2,!0),t.sampleRate=e.getUint32(m+4,!0);break;default:throw"extended fmt chunk not implemented"}m+=n;for(var s=ia.data,S=0;s!=a&&(a=e.getUint32(m,!1),S=e.getUint32(m+4,!0),s!=a);)m+=S+8;return t.dataLen=S,t.dataOffset=m+8,t}};var Mh=Eh;class Rh{constructor(t){this.bitRate=t.bitRate,this.sampleRate=t.sampleRate,this.dataBuffer=[],this.encoder=new Mh(1,this.sampleRate,this.bitRate)}encode(t){const n=this._convertBuffer(t);let m=n.length;for(let s=0;m>=0;s+=1152){const S=n.subarray(s,s+1152),A=this.encoder.encodeBuffer(S);this.dataBuffer.push(new Int8Array(A)),m-=1152}}finish(){this.dataBuffer.push(this.encoder.flush());const t=new Blob(this.dataBuffer,{type:"audio/mp3"});return this.dataBuffer=[],{id:Date.now(),blob:t,url:URL.createObjectURL(t)}}_floatTo16BitPCM(t,a){for(let n=0;n<t.length;n++){const m=Math.max(-1,Math.min(1,t[n]));a[n]=m<0?m*32768:m*32767}}_convertBuffer(t){const a=new Float32Array(t),n=new Int16Array(t.length);return this._floatTo16BitPCM(a,n),n}}class Ah{constructor(t={}){this.beforeRecording=t.beforeRecording,this.pauseRecording=t.pauseRecording,this.afterRecording=t.afterRecording,this.micFailed=t.micFailed,this.encoderOptions={bitRate:t.bitRate,sampleRate:t.sampleRate},this.bufferSize=4096,this.records=[],this.isPause=!1,this.isRecording=!1,this.duration=0,this.volume=0,this._duration=0}start(){const t={video:!1,audio:{channelCount:1,echoCancellation:!1}};this.beforeRecording&&this.beforeRecording("start recording"),navigator.mediaDevices.getUserMedia(t).then(this._micCaptured.bind(this)).catch(this._micError.bind(this)),this.isPause=!1,this.isRecording=!0,this.lameEncoder||(this.lameEncoder=new Rh(this.encoderOptions))}stop(){this.stream.getTracks().forEach(a=>a.stop()),this.input.disconnect(),this.processor.disconnect(),this.context.close();let t=null;t=this.lameEncoder.finish(),t.duration=this.duration,this.records.push(t),this._duration=0,this.duration=0,this.isPause=!1,this.isRecording=!1,this.afterRecording&&this.afterRecording(t)}pause(){this.stream.getTracks().forEach(t=>t.stop()),this.input.disconnect(),this.processor.disconnect(),this._duration=this.duration,this.isPause=!0,this.pauseRecording&&this.pauseRecording("pause recording")}_micCaptured(t){this.context=new(window.AudioContext||window.webkitAudioContext),this.duration=this._duration,this.input=this.context.createMediaStreamSource(t),this.processor=this.context.createScriptProcessor(this.bufferSize,1,1),this.stream=t,this.processor.onaudioprocess=a=>{const n=a.inputBuffer.getChannelData(0);let m=0;this.lameEncoder&&this.lameEncoder.encode(n);for(let s=0;s<n.length;++s)m+=n[s]*n[s];this.duration=parseFloat(this._duration)+parseFloat(this.context.currentTime.toFixed(2)),this.volume=Math.sqrt(m/n.length).toFixed(2)},this.input.connect(this.processor),this.processor.connect(this.context.destination)}_micError(t){this.micFailed&&this.micFailed(t)}}function m0(){var e=Th(),t=e.substr(0,4);return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw(n|u)|c55\/|capi|ccwa|cdm|cell|chtm|cldc|cmd|co(mp|nd)|craw|da(it|ll|ng)|dbte|dcs|devi|dica|dmob|do(c|p)o|ds(12|d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(|_)|g1 u|g560|gene|gf5|gmo|go(\.w|od)|gr(ad|un)|haie|hcit|hd(m|p|t)|hei|hi(pt|ta)|hp( i|ip)|hsc|ht(c(| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i(20|go|ma)|i230|iac( ||\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|[a-w])|libw|lynx|m1w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|mcr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|([1-8]|c))|phil|pire|pl(ay|uc)|pn2|po(ck|rt|se)|prox|psio|ptg|qaa|qc(07|12|21|32|60|[2-7]|i)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h|oo|p)|sdk\/|se(c(|0|1)|47|mc|nd|ri)|sgh|shar|sie(|m)|sk0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h|v|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl|tdg|tel(i|m)|tim|tmo|to(pl|sh)|ts(70|m|m3|m5)|tx9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas|your|zeto|zte/i.test(t)}function Th(){var e=navigator.userAgent||navigator.vendor||window.opera||null;if(!e)throw new Error("Failed to look for user agent information.");return e}const Bh={name:"RoomFooter",components:{SvgIcon:vt,EmojiPickerContainer:_i,RoomFiles:Ld,RoomMessageReply:am,RoomUsersTag:lm,RoomEmojis:hm,RoomTemplatesText:bm},directives:{clickOutside:so},props:{room:{type:Object,required:!0},roomId:{type:[String,Number],required:!0},roomMessage:{type:String,default:null},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},textMessages:{type:Object,required:!0},showSendIcon:{type:Boolean,required:!0},showFiles:{type:Boolean,required:!0},showAudio:{type:Boolean,required:!0},showEmojis:{type:Boolean,required:!0},showFooter:{type:Boolean,required:!0},acceptedFiles:{type:String,required:!0},textareaActionEnabled:{type:Boolean,required:!0},textareaAutoFocus:{type:Boolean,required:!0},userTagsEnabled:{type:Boolean,required:!0},emojisSuggestionEnabled:{type:Boolean,required:!0},templatesText:{type:Array,default:null},audioBitRate:{type:Number,required:!0},audioSampleRate:{type:Number,required:!0},initReplyMessage:{type:Object,default:null},initEditMessage:{type:Object,default:null}},emits:["edit-message","send-message","update-edited-message-id","textarea-action-handler","typing-message"],data(){return{message:"",editedMessage:{},messageReply:null,cursorRangePosition:null,files:[],fileDialog:!1,selectUsersTagItem:null,selectEmojiItem:null,selectTemplatesTextItem:null,format:"mp3",activeUpOrDownEmojis:null,activeUpOrDownUsersTag:null,activeUpOrDownTemplatesText:null,emojisDB:new Pn,emojiOpened:!1,keepKeyboardOpen:!1,filteredEmojis:[],filteredUsersTag:[],selectedUsersTag:[],filteredTemplatesText:[],recorder:this.initRecorder(),isRecording:!1}},computed:{isMessageEmpty(){return!this.files.length&&!this.message.trim()},isFileLoading(){return this.files.some(e=>e.loading)},recordedTime(){return new Date(this.recorder.duration*1e3).toISOString().substr(14,5)},shadowFooter(){return!!this.filteredEmojis.length||!!this.filteredUsersTag.length||!!this.filteredTemplatesText.length||!!this.files.length||!!this.messageReply}},watch:{roomId(){this.resetMessage(!0,!0),this.roomMessage&&(this.message=this.roomMessage,setTimeout(()=>this.onChangeInput()))},message(e){this.getTextareaRef().value=e},roomMessage:{immediate:!0,handler(e){e&&(this.message=this.roomMessage)}},editedMessage(e){this.$emit("update-edited-message-id",e._id)},initReplyMessage(e){this.replyMessage(e)},initEditMessage(e){this.editMessage(e)}},mounted(){const e=m0();let t=!0;this.getTextareaRef().addEventListener("keyup",a=>{a.key==="Enter"&&!a.shiftKey&&!this.fileDialog&&(e?(this.message=this.message+`
`,setTimeout(()=>this.onChangeInput())):t&&!this.filteredEmojis.length&&!this.filteredUsersTag.length&&!this.filteredTemplatesText.length&&this.sendMessage()),t=!a.isComposing,setTimeout(()=>{this.updateFooterLists()},60)}),this.getTextareaRef().addEventListener("click",()=>{e&&(this.keepKeyboardOpen=!0),this.updateFooterLists()}),this.getTextareaRef().addEventListener("blur",()=>{this.resetFooterList(),e&&setTimeout(()=>this.keepKeyboardOpen=!1)})},beforeUnmount(){this.stopRecorder()},methods:{getTextareaRef(){return this.$refs.roomTextarea},focusTextarea(e){m0()&&e||!this.getTextareaRef()||(this.getTextareaRef().focus(),this.cursorRangePosition&&setTimeout(()=>{this.getTextareaRef().setSelectionRange(this.cursorRangePosition,this.cursorRangePosition),this.cursorRangePosition=null}))},onChangeInput(){var e,t,a;(((e=this.getTextareaRef())==null?void 0:e.value)||((t=this.getTextareaRef())==null?void 0:t.value)==="")&&(this.message=(a=this.getTextareaRef())==null?void 0:a.value),this.keepKeyboardOpen=!0,this.resizeTextarea(),this.$emit("typing-message",this.message)},resizeTextarea(){const e=this.getTextareaRef();if(!e)return;const t=window.getComputedStyle(e,null).getPropertyValue("padding-top").replace("px","");e.style.height=0,e.style.height=e.scrollHeight-t*2+"px"},escapeTextarea(){this.filteredEmojis.length?this.filteredEmojis=[]:this.filteredUsersTag.length?this.filteredUsersTag=[]:this.filteredTemplatesText.length?this.filteredTemplatesText=[]:this.resetMessage()},onPasteImage(e){var a;const t=(a=e.clipboardData)==null?void 0:a.items;t&&Array.from(t).forEach(n=>{if(n.type.includes("image")){const m=n.getAsFile();this.onFileChange([m])}})},updateActiveUpOrDown(e){this.filteredEmojis.length?this.activeUpOrDownEmojis=e:this.filteredUsersTag.length?this.activeUpOrDownUsersTag=e:this.filteredTemplatesText.length&&(this.activeUpOrDownTemplatesText=e)},selectItem(){this.filteredEmojis.length?this.selectEmojiItem=!0:this.filteredUsersTag.length?this.selectUsersTagItem=!0:this.filteredTemplatesText.length&&(this.selectTemplatesTextItem=!0)},selectEmoji(e){if(this.selectEmojiItem=!1,!e)return;const{position:t,endPosition:a}=this.getCharPosition(":");this.message=this.message.substr(0,t-1)+e+this.message.substr(a,this.message.length-1),this.cursorRangePosition=t,this.focusTextarea()},selectTemplateText(e){if(this.selectTemplatesTextItem=!1,!e)return;const{position:t,endPosition:a}=this.getCharPosition("/"),n=this.message.substr(a,a).length?"":" ";this.message=this.message.substr(0,t-1)+e.text+n+this.message.substr(a,this.message.length-1),this.cursorRangePosition=t+e.text.length+n.length+1,this.focusTextarea()},addEmoji(e){this.message+=e.unicode,this.focusTextarea(!0)},launchFilePicker(){this.$refs.file.value="",this.$refs.file.click()},async onFileChange(e){this.fileDialog=!0,this.focusTextarea(),Array.from(e).forEach(async t=>{const a=URL.createObjectURL(t),n=t.name.lastIndexOf(".");this.files.push({loading:!0,name:t.name.substring(0,n),size:t.size,type:t.type,extension:t.name.substring(n+1),localUrl:a});const m=await fetch(a).then(S=>S.blob());let s=this.files.find(S=>S.localUrl===a);s&&(s.blob=m,s.loading=!1,delete s.loading)}),setTimeout(()=>this.fileDialog=!1,500)},removeFile(e){this.files.splice(e,1),this.focusTextarea()},toggleRecorder(e){if(this.isRecording=e,!this.recorder.isRecording)setTimeout(()=>this.recorder.start(),200);else try{this.recorder.stop();const t=this.recorder.records[0];this.files.push({blob:t.blob,name:`audio.${this.format}`,size:t.blob.size,duration:t.duration,type:t.blob.type,audio:!0,localUrl:URL.createObjectURL(t.blob)}),this.recorder=this.initRecorder(),this.sendMessage()}catch{setTimeout(()=>this.stopRecorder(),100)}},stopRecorder(){if(this.recorder.isRecording)try{this.recorder.stop(),this.recorder=this.initRecorder()}catch{setTimeout(()=>this.stopRecorder(),100)}},textareaActionHandler(){this.$emit("textarea-action-handler",this.message)},sendMessage(){var a;let e=this.message.trim();if(!this.files.length&&!e||this.isFileLoading)return;this.selectedUsersTag.forEach(n=>{e=e.replace(`@${n.username}`,`<usertag>${n._id}</usertag>`)});const t=this.files.length?this.files:null;this.editedMessage._id?(this.editedMessage.content!==e||((a=this.editedMessage.files)==null?void 0:a.length)||this.files.length)&&this.$emit("edit-message",{messageId:this.editedMessage._id,newContent:e,files:t,replyMessage:this.messageReply,usersTag:this.selectedUsersTag}):this.$emit("send-message",{content:e,files:t,replyMessage:this.messageReply,usersTag:this.selectedUsersTag}),this.resetMessage(!0)},editMessage(e){this.resetMessage(),this.editedMessage={...e};let t=e.content;const a=t,n="<usertag>",m="</usertag>";[...t.matchAll(new RegExp(n,"gi"))].map(S=>S.index).forEach(S=>{const A=a.substring(S+n.length,a.indexOf(m,S)),O=this.room.users.find(v=>v._id===A);t=t.replace(`${n}${A}${m}`,`@${(O==null?void 0:O.username)||"unknown"}`),this.selectUserTag(O,!0)}),this.message=t,e.files&&(this.files=[...e.files]),setTimeout(()=>this.resizeTextarea())},replyMessage(e){this.editedMessage={},this.messageReply=e,this.focusTextarea()},updateFooterLists(){this.updateFooterList("@"),this.updateFooterList(":"),this.updateFooterList("/")},updateFooterList(e){if(!this.getTextareaRef()||e===":"&&!this.emojisSuggestionEnabled||e==="@"&&(!this.userTagsEnabled||!this.room.users)||e==="/"&&!this.templatesText)return;const t=this.getTextareaRef().selectionStart;let a=t;for(;a>0&&this.message.charAt(a-1)!==e&&(this.message.charAt(a-1)!==" "||e!==":");)a--;const n=this.message.charAt(a-2),m=!n.match(/^[0-9a-zA-Z]+$/);if(this.message.charAt(a-1)===e&&(!n||n===" "||m)){const s=this.message.substring(a,t);e===":"?this.updateEmojis(s):e==="@"?this.updateShowUsersTag(s):e==="/"&&this.updateShowTemplatesText(s)}else this.resetFooterList(e)},updateShowUsersTag(e){this.filteredUsersTag=ts(this.room.users,"username",e,!0).filter(t=>t._id!==this.currentUserId)},selectUserTag(e,t=!1){if(this.selectUsersTagItem=!1,!e)return;const{position:a,endPosition:n}=this.getCharPosition("@"),m=this.message.substr(n,n).length?"":" ";this.message=this.message.substr(0,a)+e.username+m+this.message.substr(n,this.message.length-1),this.selectedUsersTag=[...this.selectedUsersTag,{...e}],t||(this.cursorRangePosition=a+e.username.length+m.length+1),this.focusTextarea()},updateShowTemplatesText(e){this.filteredTemplatesText=ts(this.templatesText,"tag",e,!0)},getCharPosition(e){let a=this.getTextareaRef().selectionStart;for(;a>0&&this.message.charAt(a-1)!==e;)a--;const n=this.getTextareaRef().selectionEnd;return{position:a,endPosition:n}},async updateEmojis(e){if(!e)return;const t=await this.emojisDB.getEmojiBySearchQuery(e);this.filteredEmojis=t.map(a=>a.unicode)},resetFooterList(e=null){e===":"?this.filteredEmojis=[]:e==="@"?this.filteredUsersTag=[]:e==="/"?this.filteredTemplatesText=[]:(this.filteredEmojis=[],this.filteredUsersTag=[],this.filteredTemplatesText=[])},resetMessage(e=!1,t=!1){t||this.$emit("typing-message",null),this.selectedUsersTag=[],this.resetFooterList(),this.resetTextareaSize(),this.message="",this.editedMessage={},this.messageReply=null,this.files=[],this.emojiOpened=!1,this.preventKeyboardFromClosing(),(this.textareaAutoFocus||!t)&&setTimeout(()=>this.focusTextarea(e))},resetTextareaSize(){this.getTextareaRef()&&(this.getTextareaRef().style.height="20px")},preventKeyboardFromClosing(){this.keepKeyboardOpen&&this.getTextareaRef().focus()},initRecorder(){return this.isRecording=!1,new Ah({bitRate:this.audioBitRate,sampleRate:this.audioSampleRate,beforeRecording:null,afterRecording:null,pauseRecording:null,micFailed:this.micFailed})},micFailed(){this.isRecording=!1,this.recorder=this.initRecorder()}}},Ch={key:0,class:"vac-icon-textarea-left"},Oh=r.createElementVNode("div",{class:"vac-dot-audio-record"},null,-1),Lh={class:"vac-dot-audio-record-time"},Nh=["placeholder"],Ih={class:"vac-icon-textarea"},Vh={key:1},jh=["accept"];function Hh(e,t,a,n,m,s){const S=r.resolveComponent("room-emojis"),A=r.resolveComponent("room-users-tag"),O=r.resolveComponent("room-templates-text"),v=r.resolveComponent("room-message-reply"),N=r.resolveComponent("room-files"),f=r.resolveComponent("svg-icon"),y=r.resolveComponent("emoji-picker-container"),k=r.resolveDirective("click-outside");return r.withDirectives((r.openBlock(),r.createElementBlock("div",{id:"room-footer",class:r.normalizeClass(["vac-room-footer",{"vac-app-box-shadow":s.shadowFooter}])},[r.createVNode(S,{"filtered-emojis":m.filteredEmojis,"select-item":m.selectEmojiItem,"active-up-or-down":m.activeUpOrDownEmojis,onSelectEmoji:t[0]||(t[0]=o=>s.selectEmoji(o)),onActivateItem:t[1]||(t[1]=o=>m.activeUpOrDownEmojis=0)},null,8,["filtered-emojis","select-item","active-up-or-down"]),r.createVNode(A,{"filtered-users-tag":m.filteredUsersTag,"select-item":m.selectUsersTagItem,"active-up-or-down":m.activeUpOrDownUsersTag,onSelectUserTag:t[2]||(t[2]=o=>s.selectUserTag(o)),onActivateItem:t[3]||(t[3]=o=>m.activeUpOrDownUsersTag=0)},null,8,["filtered-users-tag","select-item","active-up-or-down"]),r.createVNode(O,{"filtered-templates-text":m.filteredTemplatesText,"select-item":m.selectTemplatesTextItem,"active-up-or-down":m.activeUpOrDownTemplatesText,onSelectTemplateText:t[4]||(t[4]=o=>s.selectTemplateText(o)),onActivateItem:t[5]||(t[5]=o=>m.activeUpOrDownTemplatesText=0)},null,8,["filtered-templates-text","select-item","active-up-or-down"]),r.createVNode(v,{room:a.room,"message-reply":m.messageReply,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onResetMessage:s.resetMessage},r.createSlots({_:2},[r.renderList(e.$slots,(o,H)=>({name:H,fn:r.withCtx(j=>[r.renderSlot(e.$slots,H,r.normalizeProps(r.guardReactiveProps(j)))])}))]),1032,["room","message-reply","text-formatting","link-options","onResetMessage"]),r.createVNode(N,{files:m.files,onRemoveFile:s.removeFile,onResetMessage:s.resetMessage},r.createSlots({_:2},[r.renderList(e.$slots,(o,H)=>({name:H,fn:r.withCtx(j=>[r.renderSlot(e.$slots,H,r.normalizeProps(r.guardReactiveProps(j)))])}))]),1032,["files","onRemoveFile","onResetMessage"]),r.createElementVNode("div",{class:r.normalizeClass(["vac-box-footer",{"vac-box-footer-border":!m.files.length}])},[a.showAudio&&!m.files.length?(r.openBlock(),r.createElementBlock("div",Ch,[m.isRecording?(r.openBlock(),r.createElementBlock(r.Fragment,{key:0},[r.createElementVNode("div",{class:"vac-svg-button vac-icon-audio-stop",onClick:t[6]||(t[6]=(...o)=>s.stopRecorder&&s.stopRecorder(...o))},[r.renderSlot(e.$slots,"audio-stop-icon",{},()=>[r.createVNode(f,{name:"close-outline"})])]),Oh,r.createElementVNode("div",Lh,r.toDisplayString(s.recordedTime),1),r.createElementVNode("div",{class:"vac-svg-button vac-icon-audio-confirm",onClick:t[7]||(t[7]=o=>s.toggleRecorder(!1))},[r.renderSlot(e.$slots,"audio-stop-icon",{},()=>[r.createVNode(f,{name:"checkmark"})])])],64)):(r.openBlock(),r.createElementBlock("div",{key:1,class:"vac-svg-button",onClick:t[8]||(t[8]=o=>s.toggleRecorder(!0))},[r.renderSlot(e.$slots,"microphone-icon",{},()=>[r.createVNode(f,{name:"microphone",class:"vac-icon-microphone"})])]))])):r.createCommentVNode("",!0),r.createElementVNode("textarea",{id:"roomTextarea",ref:"roomTextarea",placeholder:a.textMessages.TYPE_MESSAGE,class:r.normalizeClass(["vac-textarea",{"vac-textarea-outline":m.editedMessage._id}]),style:{"min-height":"20px","padding-left":"12px"},onInput:t[9]||(t[9]=(...o)=>s.onChangeInput&&s.onChangeInput(...o)),onKeydown:[t[10]||(t[10]=r.withKeys((...o)=>s.escapeTextarea&&s.escapeTextarea(...o),["esc"])),t[11]||(t[11]=r.withKeys(r.withModifiers((...o)=>s.selectItem&&s.selectItem(...o),["exact","prevent"]),["enter"])),t[13]||(t[13]=r.withKeys(r.withModifiers(()=>{},["exact","prevent"]),["tab"])),t[14]||(t[14]=r.withKeys((...o)=>s.selectItem&&s.selectItem(...o),["tab"])),t[15]||(t[15]=r.withKeys(r.withModifiers(()=>{},["exact","prevent"]),["up"])),t[16]||(t[16]=r.withKeys(o=>s.updateActiveUpOrDown(-1),["up"])),t[17]||(t[17]=r.withKeys(r.withModifiers(()=>{},["exact","prevent"]),["down"])),t[18]||(t[18]=r.withKeys(o=>s.updateActiveUpOrDown(1),["down"]))],onPaste:t[12]||(t[12]=(...o)=>s.onPasteImage&&s.onPasteImage(...o))},null,42,Nh),r.createElementVNode("div",Ih,[m.editedMessage._id?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-svg-button",onClick:t[19]||(t[19]=(...o)=>s.resetMessage&&s.resetMessage(...o))},[r.renderSlot(e.$slots,"edit-close-icon",{},()=>[r.createVNode(f,{name:"close-outline"})])])):r.createCommentVNode("",!0),a.showEmojis?r.withDirectives((r.openBlock(),r.createElementBlock("div",Vh,[r.renderSlot(e.$slots,"emoji-picker",r.mergeProps({emojiOpened:m.emojiOpened},{addEmoji:s.addEmoji}),()=>[r.createVNode(y,{"emoji-opened":m.emojiOpened,"position-top":!0,onAddEmoji:s.addEmoji,onOpenEmoji:t[20]||(t[20]=o=>m.emojiOpened=o)},{"emoji-picker-icon":r.withCtx(()=>[r.renderSlot(e.$slots,"emoji-picker-icon")]),_:3},8,["emoji-opened","onAddEmoji"])])])),[[k,()=>m.emojiOpened=!1]]):r.createCommentVNode("",!0),a.showFiles?(r.openBlock(),r.createElementBlock("div",{key:2,class:"vac-svg-button",onClick:t[21]||(t[21]=(...o)=>s.launchFilePicker&&s.launchFilePicker(...o))},[r.renderSlot(e.$slots,"paperclip-icon",{},()=>[r.createVNode(f,{name:"paperclip"})])])):r.createCommentVNode("",!0),a.textareaActionEnabled?(r.openBlock(),r.createElementBlock("div",{key:3,class:"vac-svg-button",onClick:t[22]||(t[22]=(...o)=>s.textareaActionHandler&&s.textareaActionHandler(...o))},[r.renderSlot(e.$slots,"custom-action-icon",{},()=>[r.createVNode(f,{name:"deleted"})])])):r.createCommentVNode("",!0),a.showFiles?(r.openBlock(),r.createElementBlock("input",{key:4,ref:"file",type:"file",multiple:"",accept:a.acceptedFiles,style:{display:"none"},onChange:t[23]||(t[23]=o=>s.onFileChange(o.target.files))},null,40,jh)):r.createCommentVNode("",!0),a.showSendIcon?(r.openBlock(),r.createElementBlock("div",{key:5,class:r.normalizeClass(["vac-svg-button",{"vac-send-disabled":s.isMessageEmpty}]),onClick:t[24]||(t[24]=(...o)=>s.sendMessage&&s.sendMessage(...o))},[r.renderSlot(e.$slots,"send-icon",{},()=>[r.createVNode(f,{name:"send",param:s.isMessageEmpty||s.isFileLoading?"disabled":""},null,8,["param"])])],2)):r.createCommentVNode("",!0)])],2)],2)),[[r.vShow,Object.keys(a.room).length&&a.showFooter]])}var Ph=ze(Bh,[["render",Hh]]);const Fh={name:"MessageReply",components:{AudioPlayer:bs,SvgIcon:vt,FormatMessage:Rr},props:{message:{type:Object,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},roomUsers:{type:Array,required:!0}},computed:{replyUsername(){const{senderId:e}=this.message.replyMessage,t=this.roomUsers.find(a=>a._id===e);return t?t.username:""},firstFile(){var e,t;return(t=(e=this.message.replyMessage)==null?void 0:e.files)!=null&&t.length?this.message.replyMessage.files[0]:{}},isAudio(){return no(this.firstFile)},isImage(){return Qa(this.firstFile)},isVideo(){return Tr(this.firstFile)},isOtherFile(){var e;return((e=this.message.replyMessage.files)==null?void 0:e.length)&&!this.isAudio&&!this.isVideo&&!this.isImage}}},Dh={class:"vac-reply-message"},Uh={class:"vac-reply-username"},zh={key:0,class:"vac-image-reply-container"},qh={key:1,class:"vac-video-reply-container"},Xh={width:"100%",height:"100%",controls:""},Yh=["src"],Gh={key:3,class:"vac-file-container"},Kh={class:"vac-text-ellipsis"},Zh={key:0,class:"vac-text-ellipsis vac-text-extension"},Wh={class:"vac-reply-content"};function Qh(e,t,a,n,m,s){const S=r.resolveComponent("audio-player"),A=r.resolveComponent("svg-icon"),O=r.resolveComponent("format-message");return r.openBlock(),r.createElementBlock("div",Dh,[r.createElementVNode("div",Uh,r.toDisplayString(s.replyUsername),1),s.isImage?(r.openBlock(),r.createElementBlock("div",zh,[r.createElementVNode("div",{class:"vac-message-image vac-message-image-reply",style:r.normalizeStyle({"background-image":`url('${s.firstFile.url}')`})},null,4)])):s.isVideo?(r.openBlock(),r.createElementBlock("div",qh,[r.createElementVNode("video",Xh,[r.createElementVNode("source",{src:s.firstFile.url},null,8,Yh)])])):s.isAudio?(r.openBlock(),r.createBlock(S,{key:2,src:s.firstFile.url,onUpdateProgressTime:t[0]||(t[0]=v=>e.progressTime=v),onHoverAudioProgress:t[1]||(t[1]=v=>e.hoverAudioProgress=v)},r.createSlots({_:2},[r.renderList(e.$slots,(v,N)=>({name:N,fn:r.withCtx(f=>[r.renderSlot(e.$slots,N,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["src"])):s.isOtherFile?(r.openBlock(),r.createElementBlock("div",Gh,[r.createElementVNode("div",null,[r.renderSlot(e.$slots,"file-icon",{},()=>[r.createVNode(A,{name:"file"})])]),r.createElementVNode("div",Kh,r.toDisplayString(s.firstFile.name),1),s.firstFile.extension?(r.openBlock(),r.createElementBlock("div",Zh,r.toDisplayString(s.firstFile.extension),1)):r.createCommentVNode("",!0)])):r.createCommentVNode("",!0),r.createElementVNode("div",Wh,[r.createVNode(O,{content:a.message.replyMessage.content,users:a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,reply:!0},r.createSlots({_:2},[r.renderList(e.$slots,(v,N)=>({name:N,fn:r.withCtx(f=>[r.renderSlot(e.$slots,N,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["content","users","text-formatting","link-options"])])])}var $h=ze(Fh,[["render",Qh]]);const Jh={name:"ProgressBar",props:{progress:{type:Number,default:0}},data(){const n=54*Math.PI;return{radius:35,stroke:4,normalizedRadius:27,circumference:n}},computed:{strokeDashoffset(){return this.circumference-this.progress/100*this.circumference}}},eu={ref:"progress",class:"vac-progress-wrapper"},tu=["height","width"],au=["stroke-dasharray","stroke-width","r","cx","cy"],ru={class:"vac-progress-text"},ou=r.createElementVNode("span",{class:"vac-progress-pourcent"},"%",-1);function su(e,t,a,n,m,s){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-fade-spinner",appear:""},{default:r.withCtx(()=>[r.createElementVNode("div",eu,[(r.openBlock(),r.createElementBlock("svg",{height:m.radius*2,width:m.radius*2},[r.createElementVNode("circle",{stroke:"rgba(255, 255, 255, 0.7)","stroke-dasharray":m.circumference+" "+m.circumference,style:r.normalizeStyle({strokeDashoffset:s.strokeDashoffset,strokeLinecap:"round"}),"stroke-width":m.stroke,fill:"transparent",r:m.normalizedRadius,cx:m.radius,cy:m.radius},null,12,au)],8,tu)),r.createElementVNode("div",{class:"vac-progress-content",style:r.normalizeStyle({height:m.radius*2-19+"px",width:m.radius*2-19+"px"})},[r.createElementVNode("div",ru,[r.createTextVNode(r.toDisplayString(a.progress),1),ou])],4)],512)]),_:1})}var h0=ze(Jh,[["render",su]]);const nu={name:"MessageFile",components:{SvgIcon:vt,Loader:Zr,ProgressBar:h0},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},file:{type:Object,required:!0},index:{type:Number,required:!0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["open-file"],data(){return{imageResponsive:"",imageLoading:!1,imageHover:!1}},computed:{isImageLoading(){return this.file.url.indexOf("blob:http")!==-1||this.imageLoading},isImage(){return Qa(this.file)},isVideo(){return Tr(this.file)}},watch:{file:{immediate:!0,handler(){this.checkImgLoad()}}},mounted(){const e=this.$refs["imageRef"+this.index];e&&(this.imageResponsive={maxHeight:e.clientWidth-18,loaderTop:e.clientHeight/2-9})},methods:{checkImgLoad(){if(!Qa(this.file))return;this.imageLoading=!0;const e=new Image;e.src=this.file.url,e.addEventListener("load",()=>this.imageLoading=!1)},openFile(e,t){this.messageSelectionEnabled||(e.stopPropagation(),this.$emit("open-file",{file:this.file,action:t}))}}},iu={class:"vac-message-file-container"},lu={key:0,class:"vac-image-buttons"},cu={width:"100%",height:"100%",controls:""},du=["src"];function mu(e,t,a,n,m,s){const S=r.resolveComponent("progress-bar"),A=r.resolveComponent("loader"),O=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",iu,[s.isImage?(r.openBlock(),r.createElementBlock("div",{key:0,ref:"imageRef"+a.index,class:"vac-message-image-container",onMouseover:t[2]||(t[2]=v=>m.imageHover=!0),onMouseleave:t[3]||(t[3]=v=>m.imageHover=!1),onClick:t[4]||(t[4]=v=>s.openFile(v,"preview"))},[a.file.progress>=0?(r.openBlock(),r.createBlock(S,{key:0,progress:a.file.progress,style:r.normalizeStyle({top:`${m.imageResponsive.loaderTop}px`})},null,8,["progress","style"])):(r.openBlock(),r.createBlock(A,{key:1,show:s.isImageLoading,style:r.normalizeStyle({top:`${m.imageResponsive.loaderTop}px`})},r.createSlots({_:2},[r.renderList(e.$slots,(v,N)=>({name:N,fn:r.withCtx(f=>[r.renderSlot(e.$slots,N,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["show","style"])),r.createElementVNode("div",{class:r.normalizeClass(["vac-message-image",{"vac-blur-loading":s.isImageLoading&&a.message.senderId===a.currentUserId}]),style:r.normalizeStyle({"background-image":`url('${s.isImageLoading&&a.file.preview||a.file.url}')`,"max-height":`${m.imageResponsive.maxHeight}px`})},[r.createVNode(r.Transition,{name:"vac-fade-image"},{default:r.withCtx(()=>[!a.messageSelectionEnabled&&m.imageHover&&!s.isImageLoading?(r.openBlock(),r.createElementBlock("div",lu,[r.createElementVNode("div",{class:"vac-svg-button vac-button-view",onClick:t[0]||(t[0]=v=>s.openFile(v,"preview"))},[r.renderSlot(e.$slots,"eye-icon",{},()=>[r.createVNode(O,{name:"eye"})])]),r.createElementVNode("div",{class:"vac-svg-button vac-button-download",onClick:t[1]||(t[1]=v=>s.openFile(v,"download"))},[r.renderSlot(e.$slots,"document-icon",{},()=>[r.createVNode(O,{name:"document"})])])])):r.createCommentVNode("",!0)]),_:3})],6)],544)):s.isVideo?(r.openBlock(),r.createElementBlock("div",{key:1,class:"vac-video-container",onClick:t[5]||(t[5]=r.withModifiers(v=>s.openFile("preview"),["prevent"]))},[a.file.progress>=0?(r.openBlock(),r.createBlock(S,{key:0,progress:a.file.progress},null,8,["progress"])):r.createCommentVNode("",!0),r.createElementVNode("video",cu,[r.createElementVNode("source",{src:a.file.url},null,8,du)])])):r.createCommentVNode("",!0)])}var hu=ze(nu,[["render",mu]]);const uu={name:"MessageFiles",components:{SvgIcon:vt,FormatMessage:Rr,ProgressBar:h0,MessageFile:hu},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},roomUsers:{type:Array,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["open-file","open-user-tag"],computed:{imageVideoFiles(){return this.message.files.filter(e=>xn(e))},otherFiles(){return this.message.files.filter(e=>!xn(e))}},methods:{openFile(e,t,a){this.messageSelectionEnabled||(e.stopPropagation(),this.$emit("open-file",{file:t,action:a}))}}},fu={class:"vac-message-files-container"},_u=["onClick"],pu={class:"vac-svg-button"},vu={class:"vac-text-ellipsis"},gu={key:0,class:"vac-text-ellipsis vac-text-extension"};function bu(e,t,a,n,m,s){const S=r.resolveComponent("message-file"),A=r.resolveComponent("progress-bar"),O=r.resolveComponent("svg-icon"),v=r.resolveComponent("format-message");return r.openBlock(),r.createElementBlock("div",fu,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(s.imageVideoFiles,(N,f)=>(r.openBlock(),r.createElementBlock("div",{key:f+"iv"},[r.createVNode(S,{file:N,"current-user-id":a.currentUserId,message:a.message,index:f,"message-selection-enabled":a.messageSelectionEnabled,onOpenFile:t[0]||(t[0]=y=>e.$emit("open-file",y))},r.createSlots({_:2},[r.renderList(e.$slots,(y,k)=>({name:k,fn:r.withCtx(o=>[r.renderSlot(e.$slots,k,r.normalizeProps(r.guardReactiveProps(o)))])}))]),1032,["file","current-user-id","message","index","message-selection-enabled"])]))),128)),(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(s.otherFiles,(N,f)=>(r.openBlock(),r.createElementBlock("div",{key:f+"a",class:"vac-file-wrapper"},[N.progress>=0?(r.openBlock(),r.createBlock(A,{key:0,progress:N.progress,style:{top:"44px"}},null,8,["progress"])):r.createCommentVNode("",!0),r.createElementVNode("div",{class:r.normalizeClass(["vac-file-container",{"vac-file-container-progress":N.progress>=0}]),onClick:y=>s.openFile(y,N,"download")},[r.createElementVNode("div",pu,[r.renderSlot(e.$slots,"document-icon",{},()=>[r.createVNode(O,{name:"document"})])]),r.createElementVNode("div",vu,r.toDisplayString(N.name),1),N.extension?(r.openBlock(),r.createElementBlock("div",gu,r.toDisplayString(N.extension),1)):r.createCommentVNode("",!0)],10,_u)]))),128)),r.createVNode(v,{content:a.message.content,users:a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onOpenUserTag:t[1]||(t[1]=N=>e.$emit("open-user-tag",N))},r.createSlots({_:2},[r.renderList(e.$slots,(N,f)=>({name:f,fn:r.withCtx(y=>[r.renderSlot(e.$slots,f,r.normalizeProps(r.guardReactiveProps(y)))])}))]),1032,["content","users","text-formatting","link-options"])])}var yu=ze(uu,[["render",bu]]);const xu={name:"MessageActions",components:{SvgIcon:vt,EmojiPickerContainer:_i},directives:{clickOutside:so},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},messageActions:{type:Array,required:!0},showReactionEmojis:{type:Boolean,required:!0},messageHover:{type:Boolean,required:!0},hoverMessageId:{type:[String,Number],default:null},hoverAudioProgress:{type:Boolean,required:!0}},emits:["update-emoji-opened","update-options-opened","update-message-hover","message-action-handler","send-message-reaction"],data(){return{menuOptionsTop:0,optionsOpened:!1,optionsClosing:!1,emojiOpened:!1}},computed:{isMessageActions(){return this.filteredMessageActions.length&&this.messageHover&&!this.message.deleted&&!this.message.disableActions&&!this.hoverAudioProgress},isMessageReactions(){return this.showReactionEmojis&&this.messageHover&&!this.message.deleted&&!this.message.disableReactions&&!this.hoverAudioProgress},filteredMessageActions(){return this.message.senderId===this.currentUserId?this.messageActions:this.messageActions.filter(e=>!e.onlyMe)}},watch:{emojiOpened(e){this.$emit("update-emoji-opened",e),e&&(this.optionsOpened=!1)},optionsOpened(e){this.$emit("update-options-opened",e)}},methods:{openOptions(){this.optionsClosing||(this.optionsOpened=!this.optionsOpened,this.optionsOpened&&setTimeout(()=>{const e=document.getElementById("room-footer");if(!e||!this.$refs.menuOptions||!this.$refs.actionIcon)return;const t=this.$refs.menuOptions.getBoundingClientRect().height,a=this.$refs.actionIcon.getBoundingClientRect().top;e.getBoundingClientRect().top-a>t+50?this.menuOptionsTop=30:this.menuOptionsTop=-t}))},closeOptions(){this.optionsOpened=!1,this.optionsClosing=!0,this.updateMessageHover(),setTimeout(()=>this.optionsClosing=!1,100)},openEmoji(){this.emojiOpened=!this.emojiOpened},closeEmoji(){this.emojiOpened=!1,this.updateMessageHover()},updateMessageHover(){this.hoverMessageId!==this.message._id&&this.$emit("update-message-hover",!1)},messageActionHandler(e){this.closeOptions(),this.$emit("message-action-handler",e)},sendMessageReaction(e,t){this.$emit("send-message-reaction",{emoji:e,reaction:t}),this.closeEmoji()}}},wu={class:"vac-message-actions-wrapper"},ku={key:"3"},Su={class:"vac-menu-list"},Eu=["onClick"];function Mu(e,t,a,n,m,s){const S=r.resolveComponent("svg-icon"),A=r.resolveComponent("emoji-picker-container"),O=r.resolveDirective("click-outside");return r.openBlock(),r.createElementBlock("div",wu,[r.createElementVNode("div",{class:"vac-options-container",style:r.normalizeStyle({display:a.hoverAudioProgress?"none":"initial",width:s.filteredMessageActions.length&&a.showReactionEmojis?"70px":"45px"})},[r.createVNode(r.TransitionGroup,{name:"vac-slide-left",tag:"span"},{default:r.withCtx(()=>[s.isMessageActions||s.isMessageReactions?(r.openBlock(),r.createElementBlock("div",{key:"1",class:r.normalizeClass(["vac-blur-container",{"vac-options-me":a.message.senderId===a.currentUserId}])},null,2)):r.createCommentVNode("",!0),s.isMessageActions?(r.openBlock(),r.createElementBlock("div",{ref:"actionIcon",key:"2",class:"vac-svg-button vac-message-options",onClick:t[0]||(t[0]=(...v)=>s.openOptions&&s.openOptions(...v))},[r.renderSlot(e.$slots,"dropdown-icon",{},()=>[r.createVNode(S,{name:"dropdown",param:"message"})])],512)):r.createCommentVNode("",!0),s.isMessageReactions?r.withDirectives((r.openBlock(),r.createElementBlock("div",ku,[r.renderSlot(e.$slots,"emoji-picker",r.mergeProps({emojiOpened:m.emojiOpened},{addEmoji:s.sendMessageReaction}),()=>[r.createVNode(A,{class:"vac-message-emojis",style:r.normalizeStyle({right:s.isMessageActions?"30px":"5px"}),"emoji-opened":m.emojiOpened,"emoji-reaction":!0,"position-right":a.message.senderId===a.currentUserId,onAddEmoji:s.sendMessageReaction,onOpenEmoji:s.openEmoji},{"emoji-picker-icon":r.withCtx(()=>[r.renderSlot(e.$slots,"emoji-picker-reaction-icon")]),_:3},8,["style","emoji-opened","position-right","onAddEmoji","onOpenEmoji"])])])),[[O,s.closeEmoji]]):r.createCommentVNode("",!0)]),_:3})],4),s.filteredMessageActions.length?(r.openBlock(),r.createBlock(r.Transition,{key:0,name:a.message.senderId===a.currentUserId?"vac-slide-left":"vac-slide-right"},{default:r.withCtx(()=>[m.optionsOpened?r.withDirectives((r.openBlock(),r.createElementBlock("div",{key:0,ref:"menuOptions",class:r.normalizeClass(["vac-menu-options",{"vac-menu-left":a.message.senderId!==a.currentUserId}]),style:r.normalizeStyle({top:`${m.menuOptionsTop}px`})},[r.createElementVNode("div",Su,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(s.filteredMessageActions,v=>(r.openBlock(),r.createElementBlock("div",{key:v.name},[r.createElementVNode("div",{class:"vac-menu-item",onClick:N=>s.messageActionHandler(v)},r.toDisplayString(v.title),9,Eu)]))),128))])],6)),[[O,s.closeOptions]]):r.createCommentVNode("",!0)]),_:1},8,["name"])):r.createCommentVNode("",!0)])}var Ru=ze(xu,[["render",Mu]]);const Au={name:"MessageReactions",props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0}},emits:["send-message-reaction"],methods:{sendMessageReaction(e,t){this.$emit("send-message-reaction",{emoji:e,reaction:t})}}},Tu=["onClick"];function Bu(e,t,a,n,m,s){return a.message.deleted?r.createCommentVNode("",!0):(r.openBlock(),r.createBlock(r.TransitionGroup,{key:0,name:"vac-slide-left",tag:"span"},{default:r.withCtx(()=>[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.message.reactions,(S,A)=>r.withDirectives((r.openBlock(),r.createElementBlock("button",{key:A+0,class:r.normalizeClass(["vac-button-reaction",{"vac-reaction-me":S.indexOf(a.currentUserId)!==-1}]),style:r.normalizeStyle({float:a.message.senderId===a.currentUserId?"right":"left"}),onClick:O=>s.sendMessageReaction({unicode:A},S)},[r.createTextVNode(r.toDisplayString(A),1),r.createElementVNode("span",null,r.toDisplayString(S.length),1)],14,Tu)),[[r.vShow,S.length]])),128))]),_:1}))}var Cu=ze(Au,[["render",Bu]]);function Ou(e){if(!((n,m)=>m.every(s=>{let S=!1;return(s.type[0]==="array"&&Array.isArray(n[s.key])||s.type.find(A=>A===typeof n[s.key]))&&(S=!0),S&&Vs(n,s.key)}))(e,[{key:"roomId",type:["string","number"]},{key:"roomName",type:["string"]},{key:"users",type:["array"]}]))throw new Error("Rooms object is not valid! Must contain roomId[String, Number], roomName[String] and users[Array]")}function Lu(e){if(!((n,m)=>m.every(s=>s.type.find(A=>A===typeof n[s.key])&&Vs(n,s.key)))(e,[{key:"_id",type:["string","number"]},{key:"username",type:["string"]}]))throw new Error("Participants object is not valid! Must contain _id[String, Number] and username[String]")}function Nu(e){if(!((n,m)=>m.every(s=>s.type.find(A=>A===typeof n[s.key])&&Vs(n,s.key)))(e,[{key:"_id",type:["string","number"]},{key:"content",type:["string","number"]},{key:"senderId",type:["string","number"]}]))throw new Error("Messages object is not valid! Must contain _id[String, Number], content[String, Number] and senderId[String, Number]")}function Vs(e,t){return Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==null&&e[t]!==void 0}const Iu={name:"RoomMessage",components:{SvgIcon:vt,FormatMessage:Rr,AudioPlayer:bs,MessageReply:$h,MessageFiles:yu,MessageActions:Ru,MessageReactions:Cu},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},index:{type:Number,required:!0},message:{type:Object,required:!0},messages:{type:Array,required:!0},editedMessageId:{type:[String,Number],default:null},roomUsers:{type:Array,default:()=>[]},messageActions:{type:Array,required:!0},newMessages:{type:Array,default:()=>[]},showReactionEmojis:{type:Boolean,required:!0},showNewMessagesDivider:{type:Boolean,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},usernameOptions:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0},selectedMessages:{type:Array,default:()=>[]}},emits:["message-added","open-file","open-user-tag","open-failed-message","message-action-handler","send-message-reaction","select-message","unselect-message"],data(){return{hoverMessageId:null,messageHover:!1,optionsOpened:!1,emojiOpened:!1,newMessage:{},progressTime:"- : -",hoverAudioProgress:!1}},computed:{showUsername(){return!this.usernameOptions.currentUser&&this.message.senderId===this.currentUserId?!1:this.roomUsers.length>=this.usernameOptions.minUsers},showDate(){return this.index>0&&this.message.date!==this.messages[this.index-1].date},messageOffset(){return this.index>0&&this.message.senderId!==this.messages[this.index-1].senderId},isMessageHover(){return this.editedMessageId===this.message._id||this.hoverMessageId===this.message._id},isAudio(){var e;return(e=this.message.files)==null?void 0:e.some(t=>no(t))},isCheckmarkVisible(){return this.message.senderId===this.currentUserId&&!this.message.deleted&&(this.message.saved||this.message.distributed||this.message.seen)},hasCurrentUserAvatar(){return this.messages.some(e=>e.senderId===this.currentUserId&&e.avatar)},hasSenderUserAvatar(){return this.messages.some(e=>e.senderId!==this.currentUserId&&e.avatar)},isMessageSelected(){return this.messageSelectionEnabled&&!!this.selectedMessages.find(e=>e._id===this.message._id)}},watch:{newMessages:{immediate:!0,deep:!0,handler(e){if(!e.length||!this.showNewMessagesDivider){this.newMessage={};return}this.newMessage=e.reduce((t,a)=>a.index<t.index?a:t)}},messageSelectionEnabled(){this.resetMessageHover()}},mounted(){Nu(this.message),this.$emit("message-added",{message:this.message,index:this.index,ref:this.$refs.message})},methods:{onHoverMessage(){this.messageSelectionEnabled||(this.messageHover=!0,this.canEditMessage()&&(this.hoverMessageId=this.message._id))},canEditMessage(){return!this.message.deleted},onLeaveMessage(){this.messageSelectionEnabled||(!this.optionsOpened&&!this.emojiOpened&&(this.messageHover=!1),this.hoverMessageId=null)},resetMessageHover(){this.messageHover=!1,this.hoverMessageId=null},openFile(e){this.$emit("open-file",{message:this.message,file:e})},openUserTag(e){this.$emit("open-user-tag",{user:e})},messageActionHandler(e){this.resetMessageHover(),setTimeout(()=>{this.$emit("message-action-handler",{action:e,message:this.message})},300)},sendMessageReaction({emoji:e,reaction:t}){this.$emit("send-message-reaction",{messageId:this.message._id,reaction:e,remove:t&&t.indexOf(this.currentUserId)!==-1}),this.messageHover=!1},selectMessage(){this.messageSelectionEnabled&&(this.isMessageSelected?this.$emit("unselect-message",this.message._id):this.$emit("select-message",this.message))}}},Vu=["id"],ju={key:0,class:"vac-card-info vac-card-date"},Hu={key:1,class:"vac-line-new"},Pu={key:2,class:"vac-card-info vac-card-system"},Fu={key:1,class:"vac-avatar-offset"},Du={key:2},Uu={key:0,class:"vac-progress-time"},zu={class:"vac-text-timestamp"},qu={key:0,class:"vac-icon-edited"},Xu={key:1},Yu=[r.createElementVNode("div",{class:"vac-failure-text"}," ! ",-1)],Gu={key:3,class:"vac-avatar-current-offset"};function Ku(e,t,a,n,m,s){const S=r.resolveComponent("format-message"),A=r.resolveComponent("message-reply"),O=r.resolveComponent("svg-icon"),v=r.resolveComponent("message-files"),N=r.resolveComponent("audio-player"),f=r.resolveComponent("message-actions"),y=r.resolveComponent("message-reactions");return r.openBlock(),r.createElementBlock("div",{id:a.message._id,ref:"message",class:"vac-message-wrapper"},[s.showDate?(r.openBlock(),r.createElementBlock("div",ju,r.toDisplayString(a.message.date),1)):r.createCommentVNode("",!0),m.newMessage._id===a.message._id?(r.openBlock(),r.createElementBlock("div",Hu,r.toDisplayString(a.textMessages.NEW_MESSAGES),1)):r.createCommentVNode("",!0),a.message.system?(r.openBlock(),r.createElementBlock("div",Pu,[r.renderSlot(e.$slots,"system-message",r.normalizeProps(r.guardReactiveProps({message:a.message})),()=>[r.createVNode(S,{content:a.message.content,users:a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onOpenUserTag:s.openUserTag},r.createSlots({_:2},[r.renderList(e.$slots,(k,o)=>({name:o,fn:r.withCtx(H=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(H)))])}))]),1032,["content","users","text-formatting","link-options","onOpenUserTag"])])])):(r.openBlock(),r.createElementBlock("div",{key:3,class:r.normalizeClass(["vac-message-box",{"vac-offset-current":a.message.senderId===a.currentUserId}]),onClick:t[8]||(t[8]=(...k)=>s.selectMessage&&s.selectMessage(...k))},[r.renderSlot(e.$slots,"message",r.normalizeProps(r.guardReactiveProps({message:a.message})),()=>[a.message.avatar&&a.message.senderId!==a.currentUserId?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-avatar",style:r.normalizeStyle({"background-image":`url('${a.message.avatar}')`})},null,4)):r.createCommentVNode("",!0),s.hasSenderUserAvatar&&!a.message.avatar?(r.openBlock(),r.createElementBlock("div",Fu)):r.createCommentVNode("",!0),r.createElementVNode("div",{class:r.normalizeClass(["vac-message-container",{"vac-message-container-offset":s.messageOffset}])},[r.createElementVNode("div",{class:r.normalizeClass(["vac-message-card",{"vac-message-highlight":s.isMessageHover,"vac-message-current":a.message.senderId===a.currentUserId,"vac-message-deleted":a.message.deleted,"vac-item-clickable":a.messageSelectionEnabled,"vac-message-selected":s.isMessageSelected}]),onMouseover:t[5]||(t[5]=(...k)=>s.onHoverMessage&&s.onHoverMessage(...k)),onMouseleave:t[6]||(t[6]=(...k)=>s.onLeaveMessage&&s.onLeaveMessage(...k))},[s.showUsername?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-text-username",{"vac-username-reply":!a.message.deleted&&a.message.replyMessage}])},[r.createElementVNode("span",null,r.toDisplayString(a.message.username),1)],2)):r.createCommentVNode("",!0),!a.message.deleted&&a.message.replyMessage?(r.openBlock(),r.createBlock(A,{key:1,message:a.message,"room-users":a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions},r.createSlots({_:2},[r.renderList(e.$slots,(k,o)=>({name:o,fn:r.withCtx(H=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(H)))])}))]),1032,["message","room-users","text-formatting","link-options"])):r.createCommentVNode("",!0),a.message.deleted?(r.openBlock(),r.createElementBlock("div",Du,[r.renderSlot(e.$slots,"deleted-icon",{},()=>[r.createVNode(O,{name:"deleted",class:"vac-icon-deleted"})]),r.createElementVNode("span",null,r.toDisplayString(a.textMessages.MESSAGE_DELETED),1)])):!a.message.files||!a.message.files.length?(r.openBlock(),r.createBlock(S,{key:3,content:a.message.content,users:a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onOpenUserTag:s.openUserTag},r.createSlots({_:2},[r.renderList(e.$slots,(k,o)=>({name:o,fn:r.withCtx(H=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(H)))])}))]),1032,["content","users","text-formatting","link-options","onOpenUserTag"])):!s.isAudio||a.message.files.length>1?(r.openBlock(),r.createBlock(v,{key:4,"current-user-id":a.currentUserId,message:a.message,"room-users":a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"message-selection-enabled":a.messageSelectionEnabled,onOpenFile:s.openFile,onOpenUserTag:s.openUserTag},r.createSlots({_:2},[r.renderList(e.$slots,(k,o)=>({name:o,fn:r.withCtx(H=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(H)))])}))]),1032,["current-user-id","message","room-users","text-formatting","link-options","message-selection-enabled","onOpenFile","onOpenUserTag"])):(r.openBlock(),r.createElementBlock(r.Fragment,{key:5},[r.createVNode(N,{"message-id":a.message._id,src:a.message.files[0].url,"message-selection-enabled":a.messageSelectionEnabled,onUpdateProgressTime:t[0]||(t[0]=k=>m.progressTime=k),onHoverAudioProgress:t[1]||(t[1]=k=>m.hoverAudioProgress=k)},r.createSlots({_:2},[r.renderList(e.$slots,(k,o)=>({name:o,fn:r.withCtx(H=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(H)))])}))]),1032,["message-id","src","message-selection-enabled"]),a.message.deleted?r.createCommentVNode("",!0):(r.openBlock(),r.createElementBlock("div",Uu,r.toDisplayString(m.progressTime),1))],64)),r.createElementVNode("div",zu,[a.message.edited&&!a.message.deleted?(r.openBlock(),r.createElementBlock("div",qu,[r.renderSlot(e.$slots,"pencil-icon",{},()=>[r.createVNode(O,{name:"pencil"})])])):r.createCommentVNode("",!0),r.createElementVNode("span",null,r.toDisplayString(a.message.timestamp),1),s.isCheckmarkVisible?(r.openBlock(),r.createElementBlock("span",Xu,[r.renderSlot(e.$slots,"checkmark-icon",r.normalizeProps(r.guardReactiveProps({message:a.message})),()=>[r.createVNode(O,{name:a.message.distributed?"double-checkmark":"checkmark",param:a.message.seen?"seen":"",class:"vac-icon-check"},null,8,["name","param"])])])):r.createCommentVNode("",!0)]),r.createVNode(f,{"current-user-id":a.currentUserId,message:a.message,"message-actions":a.messageActions,"show-reaction-emojis":a.showReactionEmojis,"message-hover":m.messageHover,"hover-message-id":m.hoverMessageId,"hover-audio-progress":m.hoverAudioProgress,onUpdateMessageHover:t[2]||(t[2]=k=>m.messageHover=k),onUpdateOptionsOpened:t[3]||(t[3]=k=>m.optionsOpened=k),onUpdateEmojiOpened:t[4]||(t[4]=k=>m.emojiOpened=k),onMessageActionHandler:s.messageActionHandler,onSendMessageReaction:s.sendMessageReaction},r.createSlots({_:2},[r.renderList(e.$slots,(k,o)=>({name:o,fn:r.withCtx(H=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(H)))])}))]),1032,["current-user-id","message","message-actions","show-reaction-emojis","message-hover","hover-message-id","hover-audio-progress","onMessageActionHandler","onSendMessageReaction"])],34),r.createVNode(y,{"current-user-id":a.currentUserId,message:a.message,onSendMessageReaction:s.sendMessageReaction},null,8,["current-user-id","message","onSendMessageReaction"])],2),r.renderSlot(e.$slots,"message-failure",r.normalizeProps(r.guardReactiveProps({message:a.message})),()=>[a.message.failure&&a.message.senderId===a.currentUserId?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-failure-container vac-svg-button",{"vac-failure-container-avatar":a.message.avatar&&a.message.senderId===a.currentUserId}]),onClick:t[7]||(t[7]=k=>e.$emit("open-failed-message",{message:a.message}))},Yu,2)):r.createCommentVNode("",!0)]),a.message.avatar&&a.message.senderId===a.currentUserId?(r.openBlock(),r.createElementBlock("div",{key:2,class:"vac-avatar vac-avatar-current",style:r.normalizeStyle({"background-image":`url('${a.message.avatar}')`})},null,4)):r.createCommentVNode("",!0),s.hasCurrentUserAvatar&&!a.message.avatar?(r.openBlock(),r.createElementBlock("div",Gu)):r.createCommentVNode("",!0)])],2))],8,Vu)}var Zu=ze(Iu,[["render",Ku]]);const Wu={name:"ChatRoom",components:{Loader:Zr,SvgIcon:vt,RoomHeader:Uc,RoomFooter:Ph,RoomMessage:Zu},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},singleRoom:{type:Boolean,required:!0},showRoomsList:{type:Boolean,required:!0},isMobile:{type:Boolean,required:!0},rooms:{type:Array,required:!0},roomId:{type:[String,Number],required:!0},loadFirstRoom:{type:Boolean,required:!0},messages:{type:Array,required:!0},roomMessage:{type:String,default:null},messagesLoaded:{type:Boolean,required:!0},menuActions:{type:Array,required:!0},messageActions:{type:Array,required:!0},messageSelectionActions:{type:Array,required:!0},autoScroll:{type:Object,required:!0},showSendIcon:{type:Boolean,required:!0},showFiles:{type:Boolean,required:!0},showAudio:{type:Boolean,required:!0},audioBitRate:{type:Number,required:!0},audioSampleRate:{type:Number,required:!0},showEmojis:{type:Boolean,required:!0},showReactionEmojis:{type:Boolean,required:!0},showNewMessagesDivider:{type:Boolean,required:!0},showFooter:{type:Boolean,required:!0},acceptedFiles:{type:String,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},loadingRooms:{type:Boolean,required:!0},roomInfoEnabled:{type:Boolean,required:!0},textareaActionEnabled:{type:Boolean,required:!0},textareaAutoFocus:{type:Boolean,required:!0},userTagsEnabled:{type:Boolean,required:!0},emojisSuggestionEnabled:{type:Boolean,required:!0},scrollDistance:{type:Number,required:!0},templatesText:{type:Array,default:null},usernameOptions:{type:Object,required:!0}},emits:["toggle-rooms-list","room-info","menu-action-handler","message-selection-action-handler","edit-message","send-message","delete-message","message-action-handler","fetch-messages","send-message-reaction","typing-message","open-file","open-user-tag","open-failed-message","textarea-action-handler"],data(){return{editedMessageId:null,initReplyMessage:null,initEditMessage:null,infiniteState:null,loadingMessages:!1,observer:null,showLoader:!0,loadingMoreMessages:!1,scrollIcon:!1,scrollMessagesCount:0,newMessages:[],messageSelectionEnabled:!1,selectedMessages:[]}},computed:{room(){return this.rooms.find(e=>e.roomId===this.roomId)||{}},showNoMessages(){return this.roomId&&!this.messages.length&&!this.loadingMessages&&!this.loadingRooms},showNoRoom(){const e=!this.rooms.length&&!this.loadingRooms||!this.roomId&&!this.loadFirstRoom;return e&&(this.loadingMessages=!1),e},showMessagesStarted(){return this.messages.length&&this.messagesLoaded}},watch:{loadingMessages(e){e?this.infiniteState=null:(this.infiniteState&&this.infiniteState.loaded(),setTimeout(()=>this.initIntersectionObserver()))},roomId(){this.onRoomChanged()},messages:{deep:!0,handler(e,t){e.forEach((a,n)=>{this.showNewMessagesDivider&&!a.seen&&a.senderId!==this.currentUserId&&this.newMessages.push({_id:a._id,index:n})}),(t==null?void 0:t.length)===(e==null?void 0:e.length)-1&&(this.newMessages=[]),this.infiniteState&&this.infiniteState.loaded(),setTimeout(()=>this.loadingMoreMessages=!1)}},messagesLoaded(e){e&&(this.loadingMessages=!1),this.infiniteState&&this.infiniteState.complete()}},mounted(){this.newMessages=[]},methods:{initIntersectionObserver(){this.observer&&(this.showLoader=!0,this.observer.disconnect());const e=document.getElementById("infinite-loader-messages");if(e){const t={root:document.getElementById("messages-list"),rootMargin:`${this.scrollDistance}px`,threshold:0};this.observer=new IntersectionObserver(a=>{a[0].isIntersecting&&this.loadMoreMessages()},t),this.observer.observe(e)}},preventTopScroll(){const e=this.$refs.scrollContainer,t=e.scrollHeight,a=new ResizeObserver(m=>{e.scrollHeight!==t&&this.$refs.scrollContainer&&(this.$refs.scrollContainer.scrollTo({top:e.scrollHeight-t}),a.disconnect())});for(var n=0;n<e.children.length;n++)a.observe(e.children[n])},touchStart(e){if(!this.singleRoom&&e.changedTouches.length===1){const t=e.changedTouches[0].clientX,a=e.changedTouches[0].clientY;addEventListener("touchend",n=>this.touchEnd(n,t,a),{once:!0})}},touchEnd(e,t,a){if(e.changedTouches.length===1){const n=e.changedTouches[0].clientX,m=e.changedTouches[0].clientY,s=n-t>100,S=Math.abs(m-a)>50;s&&!S&&this.$emit("toggle-rooms-list")}},onRoomChanged(){this.loadingMessages=!0,this.scrollIcon=!1,this.scrollMessagesCount=0,this.resetMessageSelection(),!this.messages.length&&this.messagesLoaded&&(this.loadingMessages=!1);const e=this.$watch(()=>this.messages,t=>{if(!t||!t.length)return;const a=this.$refs.scrollContainer;!a||(e(),setTimeout(()=>{a.scrollTo({top:a.scrollHeight}),this.loadingMessages=!1}))})},resetMessageSelection(){this.messageSelectionEnabled=!1,this.selectedMessages=[]},selectMessage(e){this.selectedMessages.push(e)},unselectMessage(e){this.selectedMessages=this.selectedMessages.filter(t=>t._id!==e)},onMessageAdded({message:e,index:t,ref:a}){if(t!==this.messages.length-1)return;const n=a.offsetHeight+60;setTimeout(()=>{const m=this.getBottomScroll(this.$refs.scrollContainer)>n;e.senderId===this.currentUserId?m?this.autoScroll.send.newAfterScrollUp&&this.scrollToBottom():this.autoScroll.send.new&&this.scrollToBottom():m?this.autoScroll.receive.newAfterScrollUp?this.scrollToBottom():(this.scrollIcon=!0,this.scrollMessagesCount++):this.autoScroll.receive.new?this.scrollToBottom():(this.scrollIcon=!0,this.scrollMessagesCount++)})},onContainerScroll(e){if(!e.target)return;const t=this.getBottomScroll(e.target);t<60&&(this.scrollMessagesCount=0),this.scrollIcon=t>500||this.scrollMessagesCount},loadMoreMessages(){this.loadingMessages||setTimeout(()=>{if(!this.loadingMoreMessages){if(this.messagesLoaded||!this.roomId){this.loadingMoreMessages=!1,this.showLoader=!1;return}this.preventTopScroll(),this.$emit("fetch-messages"),this.loadingMoreMessages=!0}},500)},messageActionHandler({action:e,message:t}){switch(e.name){case"replyMessage":this.initReplyMessage=t;return;case"editMessage":this.initEditMessage=t;return;case"deleteMessage":return this.$emit("delete-message",t);case"selectMessages":this.selectedMessages=[t],this.messageSelectionEnabled=!0;return;default:return this.$emit("message-action-handler",{action:e,message:t})}},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",{action:e,messages:this.selectedMessages}),this.resetMessageSelection()},sendMessageReaction(e){this.$emit("send-message-reaction",e)},getBottomScroll(e){const{scrollHeight:t,clientHeight:a,scrollTop:n}=e;return t-a-n},scrollToBottom(){setTimeout(()=>{const e=this.$refs.scrollContainer;e.classList.add("vac-scroll-smooth"),e.scrollTo({top:e.scrollHeight,behavior:"smooth"}),setTimeout(()=>e.classList.remove("vac-scroll-smooth"))},50)},openFile({message:e,file:t}){this.$emit("open-file",{message:e,file:t})},openUserTag(e){this.$emit("open-user-tag",e)}}},Qu={class:"vac-container-center vac-room-empty"},$u={class:"vac-messages-container"},Ju={key:0,class:"vac-text-started"},ef={key:1,class:"vac-text-started"},tf={key:0,id:"infinite-loader-messages"},af={key:2},rf={key:0,class:"vac-badge-counter vac-messages-count"};function of(e,t,a,n,m,s){const S=r.resolveComponent("room-header"),A=r.resolveComponent("loader"),O=r.resolveComponent("room-message"),v=r.resolveComponent("svg-icon"),N=r.resolveComponent("room-footer");return r.withDirectives((r.openBlock(),r.createElementBlock("div",{class:"vac-col-messages",onTouchstart:t[12]||(t[12]=(...f)=>s.touchStart&&s.touchStart(...f))},[s.showNoRoom?r.renderSlot(e.$slots,"no-room-selected",{key:0},()=>[r.createElementVNode("div",Qu,[r.createElementVNode("div",null,r.toDisplayString(a.textMessages.ROOM_EMPTY),1)])]):(r.openBlock(),r.createBlock(S,{key:1,"current-user-id":a.currentUserId,"text-messages":a.textMessages,"single-room":a.singleRoom,"show-rooms-list":a.showRoomsList,"is-mobile":a.isMobile,"room-info-enabled":a.roomInfoEnabled,"menu-actions":a.menuActions,room:s.room,"message-selection-enabled":m.messageSelectionEnabled,"message-selection-actions":a.messageSelectionActions,"selected-messages-total":m.selectedMessages.length,onToggleRoomsList:t[0]||(t[0]=f=>e.$emit("toggle-rooms-list")),onRoomInfo:t[1]||(t[1]=f=>e.$emit("room-info")),onMenuActionHandler:t[2]||(t[2]=f=>e.$emit("menu-action-handler",f)),onMessageSelectionActionHandler:s.messageSelectionActionHandler,onCancelMessageSelection:t[3]||(t[3]=f=>m.messageSelectionEnabled=!1)},r.createSlots({_:2},[r.renderList(e.$slots,(f,y)=>({name:y,fn:r.withCtx(k=>[r.renderSlot(e.$slots,y,r.normalizeProps(r.guardReactiveProps(k)))])}))]),1032,["current-user-id","text-messages","single-room","show-rooms-list","is-mobile","room-info-enabled","menu-actions","room","message-selection-enabled","message-selection-actions","selected-messages-total","onMessageSelectionActionHandler"])),r.createElementVNode("div",{id:"messages-list",ref:"scrollContainer",class:"vac-container-scroll",onScroll:t[5]||(t[5]=(...f)=>s.onContainerScroll&&s.onContainerScroll(...f))},[r.createVNode(A,{show:m.loadingMessages},r.createSlots({_:2},[r.renderList(e.$slots,(f,y)=>({name:y,fn:r.withCtx(k=>[r.renderSlot(e.$slots,y,r.normalizeProps(r.guardReactiveProps(k)))])}))]),1032,["show"]),r.createElementVNode("div",$u,[r.createElementVNode("div",{class:r.normalizeClass({"vac-messages-hidden":m.loadingMessages})},[r.createVNode(r.Transition,{name:"vac-fade-message"},{default:r.withCtx(()=>[r.createElementVNode("div",null,[s.showNoMessages?(r.openBlock(),r.createElementBlock("div",Ju,[r.renderSlot(e.$slots,"messages-empty",{},()=>[r.createTextVNode(r.toDisplayString(a.textMessages.MESSAGES_EMPTY),1)])])):r.createCommentVNode("",!0),s.showMessagesStarted?(r.openBlock(),r.createElementBlock("div",ef,r.toDisplayString(a.textMessages.CONVERSATION_STARTED)+" "+r.toDisplayString(a.messages[0].date),1)):r.createCommentVNode("",!0)])]),_:3}),a.messages.length&&!a.messagesLoaded?(r.openBlock(),r.createElementBlock("div",tf,[r.createVNode(A,{show:!0,infinite:!0},r.createSlots({_:2},[r.renderList(e.$slots,(f,y)=>({name:y,fn:r.withCtx(k=>[r.renderSlot(e.$slots,y,r.normalizeProps(r.guardReactiveProps(k)))])}))]),1024)])):r.createCommentVNode("",!0),(r.openBlock(),r.createBlock(r.TransitionGroup,{key:a.roomId,name:"vac-fade-message",tag:"span"},{default:r.withCtx(()=>[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.messages,(f,y)=>(r.openBlock(),r.createElementBlock("div",{key:f.indexId||f._id},[r.createVNode(O,{"current-user-id":a.currentUserId,message:f,index:y,messages:a.messages,"edited-message-id":m.editedMessageId,"message-actions":a.messageActions,"room-users":s.room.users,"text-messages":a.textMessages,"new-messages":m.newMessages,"show-reaction-emojis":a.showReactionEmojis,"show-new-messages-divider":a.showNewMessagesDivider,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"username-options":a.usernameOptions,"message-selection-enabled":m.messageSelectionEnabled,"selected-messages":m.selectedMessages,onMessageAdded:s.onMessageAdded,onMessageActionHandler:s.messageActionHandler,onOpenFile:s.openFile,onOpenUserTag:s.openUserTag,onOpenFailedMessage:t[4]||(t[4]=k=>e.$emit("open-failed-message",k)),onSendMessageReaction:s.sendMessageReaction,onSelectMessage:s.selectMessage,onUnselectMessage:s.unselectMessage},r.createSlots({_:2},[r.renderList(e.$slots,(k,o)=>({name:o,fn:r.withCtx(H=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(H)))])}))]),1032,["current-user-id","message","index","messages","edited-message-id","message-actions","room-users","text-messages","new-messages","show-reaction-emojis","show-new-messages-divider","text-formatting","link-options","username-options","message-selection-enabled","selected-messages","onMessageAdded","onMessageActionHandler","onOpenFile","onOpenUserTag","onSendMessageReaction","onSelectMessage","onUnselectMessage"])]))),128))]),_:3}))],2)])],544),m.loadingMessages?r.createCommentVNode("",!0):(r.openBlock(),r.createElementBlock("div",af,[r.createVNode(r.Transition,{name:"vac-bounce"},{default:r.withCtx(()=>[m.scrollIcon?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-icon-scroll",onClick:t[6]||(t[6]=(...f)=>s.scrollToBottom&&s.scrollToBottom(...f))},[r.createVNode(r.Transition,{name:"vac-bounce"},{default:r.withCtx(()=>[m.scrollMessagesCount?(r.openBlock(),r.createElementBlock("div",rf,r.toDisplayString(m.scrollMessagesCount),1)):r.createCommentVNode("",!0)]),_:1}),r.renderSlot(e.$slots,"scroll-icon",{},()=>[r.createVNode(v,{name:"dropdown",param:"scroll"})])])):r.createCommentVNode("",!0)]),_:3})])),r.createVNode(N,{room:s.room,"room-id":a.roomId,"room-message":a.roomMessage,"text-messages":a.textMessages,"show-send-icon":a.showSendIcon,"show-files":a.showFiles,"show-audio":a.showAudio,"show-emojis":a.showEmojis,"show-footer":a.showFooter,"accepted-files":a.acceptedFiles,"textarea-action-enabled":a.textareaActionEnabled,"textarea-auto-focus":a.textareaAutoFocus,"user-tags-enabled":a.userTagsEnabled,"emojis-suggestion-enabled":a.emojisSuggestionEnabled,"templates-text":a.templatesText,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"audio-bit-rate":a.audioBitRate,"audio-sample-rate":a.audioSampleRate,"init-reply-message":m.initReplyMessage,"init-edit-message":m.initEditMessage,onUpdateEditedMessageId:t[7]||(t[7]=f=>m.editedMessageId=f),onEditMessage:t[8]||(t[8]=f=>e.$emit("edit-message",f)),onSendMessage:t[9]||(t[9]=f=>e.$emit("send-message",f)),onTypingMessage:t[10]||(t[10]=f=>e.$emit("typing-message",f)),onTextareaActionHandler:t[11]||(t[11]=f=>e.$emit("textarea-action-handler",f))},r.createSlots({_:2},[r.renderList(e.$slots,(f,y)=>({name:y,fn:r.withCtx(k=>[r.renderSlot(e.$slots,y,r.normalizeProps(r.guardReactiveProps(k)))])}))]),1032,["room","room-id","room-message","text-messages","show-send-icon","show-files","show-audio","show-emojis","show-footer","accepted-files","textarea-action-enabled","textarea-auto-focus","user-tags-enabled","emojis-suggestion-enabled","templates-text","text-formatting","link-options","audio-bit-rate","audio-sample-rate","init-reply-message","init-edit-message"])],544)),[[r.vShow,a.isMobile&&!a.showRoomsList||!a.isMobile||a.singleRoom]])}var sf=ze(Wu,[["render",of]]);const nf={name:"MediaPreview",components:{SvgIcon:vt},props:{file:{type:Object,required:!0}},emits:["close-media-preview"],computed:{isImage(){return Qa(this.file)},isVideo(){return Tr(this.file)}},mounted(){this.$refs.modal.focus()},methods:{closeModal(){this.$emit("close-media-preview")}}},lf={key:0,class:"vac-media-preview-container"},cf={key:1,class:"vac-media-preview-container"},df={width:"100%",height:"100%",controls:"",autoplay:""},mf=["src"],hf={class:"vac-svg-button"};function uf(e,t,a,n,m,s){const S=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",{ref:"modal",tabindex:"0",class:"vac-media-preview",onClick:t[0]||(t[0]=r.withModifiers((...A)=>s.closeModal&&s.closeModal(...A),["stop"])),onKeydown:t[1]||(t[1]=r.withKeys((...A)=>s.closeModal&&s.closeModal(...A),["esc"]))},[r.createVNode(r.Transition,{name:"vac-bounce-preview",appear:""},{default:r.withCtx(()=>[s.isImage?(r.openBlock(),r.createElementBlock("div",lf,[r.createElementVNode("div",{class:"vac-image-preview",style:r.normalizeStyle({"background-image":`url('${a.file.url}')`})},null,4)])):s.isVideo?(r.openBlock(),r.createElementBlock("div",cf,[r.createElementVNode("video",df,[r.createElementVNode("source",{src:a.file.url},null,8,mf)])])):r.createCommentVNode("",!0)]),_:1}),r.createElementVNode("div",hf,[r.renderSlot(e.$slots,"preview-close-icon",{},()=>[r.createVNode(S,{name:"close-outline",param:"preview"})])])],544)}var ff=ze(nf,[["render",uf]]),_f={ROOMS_EMPTY:"No rooms",ROOM_EMPTY:"No room selected",NEW_MESSAGES:"New Messages",MESSAGE_DELETED:"This message was deleted",MESSAGES_EMPTY:"No messages",CONVERSATION_STARTED:"Conversation started on:",TYPE_MESSAGE:"Type message",SEARCH:"Search",IS_ONLINE:"is online",LAST_SEEN:"last seen ",IS_TYPING:"is writing...",CANCEL_SELECT_MESSAGE:"Cancel"};const pf={light:{general:{color:"#0a0a0a",colorButtonClear:"#1976d2",colorButton:"#fff",backgroundColorButton:"#1976d2",backgroundInput:"#fff",colorPlaceholder:"#9ca6af",colorCaret:"#1976d2",colorSpinner:"#333",borderStyle:"1px solid #e1e4e8",backgroundScrollIcon:"#fff"},container:{border:"none",borderRadius:"4px",boxShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)"},header:{background:"#fff",colorRoomName:"#0a0a0a",colorRoomInfo:"#9ca6af"},footer:{background:"#f8f9fa",borderStyleInput:"1px solid #e1e4e8",borderInputSelected:"#1976d2",backgroundReply:"#e5e5e6",backgroundTagActive:"#e5e5e6",backgroundTag:"#f8f9fa"},content:{background:"#f8f9fa"},sidemenu:{background:"#fff",backgroundHover:"#f6f6f6",backgroundActive:"#e5effa",colorActive:"#1976d2",borderColorSearch:"#e1e5e8"},dropdown:{background:"#fff",backgroundHover:"#f6f6f6"},message:{background:"#fff",backgroundMe:"#ccf2cf",color:"#0a0a0a",colorStarted:"#9ca6af",backgroundDeleted:"#dadfe2",backgroundSelected:"#c2dcf2",colorDeleted:"#757e85",colorUsername:"#9ca6af",colorTimestamp:"#828c94",backgroundDate:"#e5effa",colorDate:"#505a62",backgroundSystem:"#e5effa",colorSystem:"#505a62",backgroundMedia:"rgba(0, 0, 0, 0.15)",backgroundReply:"rgba(0, 0, 0, 0.08)",colorReplyUsername:"#0a0a0a",colorReply:"#6e6e6e",colorTag:"#0d579c",backgroundImage:"#ddd",colorNewMessages:"#1976d2",backgroundScrollCounter:"#0696c7",colorScrollCounter:"#fff",backgroundReaction:"#eee",borderStyleReaction:"1px solid #eee",backgroundReactionHover:"#fff",borderStyleReactionHover:"1px solid #ddd",colorReactionCounter:"#0a0a0a",backgroundReactionMe:"#cfecf5",borderStyleReactionMe:"1px solid #3b98b8",backgroundReactionHoverMe:"#cfecf5",borderStyleReactionHoverMe:"1px solid #3b98b8",colorReactionCounterMe:"#0b59b3",backgroundAudioRecord:"#eb4034",backgroundAudioLine:"rgba(0, 0, 0, 0.15)",backgroundAudioProgress:"#455247",backgroundAudioProgressSelector:"#455247",colorFileExtension:"#757e85"},markdown:{background:"rgba(239, 239, 239, 0.7)",border:"rgba(212, 212, 212, 0.9)",color:"#e01e5a",colorMulti:"#0a0a0a"},room:{colorUsername:"#0a0a0a",colorMessage:"#67717a",colorTimestamp:"#a2aeb8",colorStateOnline:"#4caf50",colorStateOffline:"#9ca6af",backgroundCounterBadge:"#0696c7",colorCounterBadge:"#fff"},emoji:{background:"#fff"},icons:{search:"#9ca6af",add:"#1976d2",toggle:"#0a0a0a",menu:"#0a0a0a",close:"#9ca6af",closeImage:"#fff",file:"#1976d2",paperclip:"#1976d2",closeOutline:"#000",closePreview:"#fff",send:"#1976d2",sendDisabled:"#9ca6af",emoji:"#1976d2",emojiReaction:"rgba(0, 0, 0, 0.3)",document:"#1976d2",pencil:"#9e9e9e",checkmark:"#9e9e9e",checkmarkSeen:"#0696c7",eye:"#fff",dropdownMessage:"#fff",dropdownMessageBackground:"rgba(0, 0, 0, 0.25)",dropdownRoom:"#9e9e9e",dropdownScroll:"#0a0a0a",microphone:"#1976d2",audioPlay:"#455247",audioPause:"#455247",audioCancel:"#eb4034",audioConfirm:"#1ba65b"}},dark:{general:{color:"#fff",colorButtonClear:"#fff",colorButton:"#fff",backgroundColorButton:"#1976d2",backgroundInput:"#202223",colorPlaceholder:"#596269",colorCaret:"#fff",colorSpinner:"#fff",borderStyle:"none",backgroundScrollIcon:"#fff"},container:{border:"none",borderRadius:"4px",boxShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)"},header:{background:"#181a1b",colorRoomName:"#fff",colorRoomInfo:"#9ca6af"},footer:{background:"#131415",borderStyleInput:"none",borderInputSelected:"#1976d2",backgroundReply:"#1b1c1c",backgroundTagActive:"#1b1c1c",backgroundTag:"#131415"},content:{background:"#131415"},sidemenu:{background:"#181a1b",backgroundHover:"#202224",backgroundActive:"#151617",colorActive:"#fff",borderColorSearch:"#181a1b"},dropdown:{background:"#2a2c33",backgroundHover:"#26282e"},message:{background:"#22242a",backgroundMe:"#1f7e80",color:"#fff",colorStarted:"#9ca6af",backgroundDeleted:"#1b1c21",backgroundSelected:"#c2dcf2",colorDeleted:"#a2a5a8",colorUsername:"#b3bac9",colorTimestamp:"#ebedf2",backgroundDate:"rgba(0, 0, 0, 0.3)",colorDate:"#bec5cc",backgroundSystem:"rgba(0, 0, 0, 0.3)",colorSystem:"#bec5cc",backgroundMedia:"rgba(0, 0, 0, 0.18)",backgroundReply:"rgba(0, 0, 0, 0.18)",colorReplyUsername:"#fff",colorReply:"#d6d6d6",colorTag:"#f0c60a",backgroundImage:"#ddd",colorNewMessages:"#fff",backgroundScrollCounter:"#1976d2",colorScrollCounter:"#fff",backgroundReaction:"none",borderStyleReaction:"none",backgroundReactionHover:"#202223",borderStyleReactionHover:"none",colorReactionCounter:"#fff",backgroundReactionMe:"#4e9ad1",borderStyleReactionMe:"none",backgroundReactionHoverMe:"#4e9ad1",borderStyleReactionHoverMe:"none",colorReactionCounterMe:"#fff",backgroundAudioRecord:"#eb4034",backgroundAudioLine:"rgba(255, 255, 255, 0.15)",backgroundAudioProgress:"#b7d4d3",backgroundAudioProgressSelector:"#b7d4d3",colorFileExtension:"#a2a5a8"},markdown:{background:"rgba(239, 239, 239, 0.7)",border:"rgba(212, 212, 212, 0.9)",color:"#e01e5a",colorMulti:"#0a0a0a"},room:{colorUsername:"#fff",colorMessage:"#6c7278",colorTimestamp:"#6c7278",colorStateOnline:"#4caf50",colorStateOffline:"#596269",backgroundCounterBadge:"#1976d2",colorCounterBadge:"#fff"},emoji:{background:"#343740"},icons:{search:"#596269",add:"#fff",toggle:"#fff",menu:"#fff",close:"#9ca6af",closeImage:"#fff",file:"#1976d2",paperclip:"#fff",closeOutline:"#fff",closePreview:"#fff",send:"#fff",sendDisabled:"#646a70",emoji:"#fff",emojiReaction:"#fff",document:"#1976d2",pencil:"#ebedf2",checkmark:"#ebedf2",checkmarkSeen:"#f0d90a",eye:"#fff",dropdownMessage:"#fff",dropdownMessageBackground:"rgba(0, 0, 0, 0.25)",dropdownRoom:"#fff",dropdownScroll:"#0a0a0a",microphone:"#fff",audioPlay:"#b7d4d3",audioPause:"#b7d4d3",audioCancel:"#eb4034",audioConfirm:"#1ba65b"}}},vf=({general:e,container:t,header:a,footer:n,sidemenu:m,content:s,dropdown:S,message:A,markdown:O,room:v,emoji:N,icons:f})=>({"--chat-color":e.color,"--chat-color-button-clear":e.colorButtonClear,"--chat-color-button":e.colorButton,"--chat-bg-color-button":e.backgroundColorButton,"--chat-bg-color-input":e.backgroundInput,"--chat-color-spinner":e.colorSpinner,"--chat-color-placeholder":e.colorPlaceholder,"--chat-color-caret":e.colorCaret,"--chat-border-style":e.borderStyle,"--chat-bg-scroll-icon":e.backgroundScrollIcon,"--chat-container-border":t.border,"--chat-container-border-radius":t.borderRadius,"--chat-container-box-shadow":t.boxShadow,"--chat-header-bg-color":a.background,"--chat-header-color-name":a.colorRoomName,"--chat-header-color-info":a.colorRoomInfo,"--chat-footer-bg-color":n.background,"--chat-border-style-input":n.borderStyleInput,"--chat-border-color-input-selected":n.borderInputSelected,"--chat-footer-bg-color-reply":n.backgroundReply,"--chat-footer-bg-color-tag-active":n.backgroundTagActive,"--chat-footer-bg-color-tag":n.backgroundTag,"--chat-content-bg-color":s.background,"--chat-sidemenu-bg-color":m.background,"--chat-sidemenu-bg-color-hover":m.backgroundHover,"--chat-sidemenu-bg-color-active":m.backgroundActive,"--chat-sidemenu-color-active":m.colorActive,"--chat-sidemenu-border-color-search":m.borderColorSearch,"--chat-dropdown-bg-color":S.background,"--chat-dropdown-bg-color-hover":S.backgroundHover,"--chat-message-bg-color":A.background,"--chat-message-bg-color-me":A.backgroundMe,"--chat-message-color-started":A.colorStarted,"--chat-message-bg-color-deleted":A.backgroundDeleted,"--chat-message-bg-color-selected":A.backgroundSelected,"--chat-message-color-deleted":A.colorDeleted,"--chat-message-color-username":A.colorUsername,"--chat-message-color-timestamp":A.colorTimestamp,"--chat-message-bg-color-date":A.backgroundDate,"--chat-message-color-date":A.colorDate,"--chat-message-bg-color-system":A.backgroundSystem,"--chat-message-color-system":A.colorSystem,"--chat-message-color":A.color,"--chat-message-bg-color-media":A.backgroundMedia,"--chat-message-bg-color-reply":A.backgroundReply,"--chat-message-color-reply-username":A.colorReplyUsername,"--chat-message-color-reply-content":A.colorReply,"--chat-message-color-tag":A.colorTag,"--chat-message-bg-color-image":A.backgroundImage,"--chat-message-color-new-messages":A.colorNewMessages,"--chat-message-bg-color-scroll-counter":A.backgroundScrollCounter,"--chat-message-color-scroll-counter":A.colorScrollCounter,"--chat-message-bg-color-reaction":A.backgroundReaction,"--chat-message-border-style-reaction":A.borderStyleReaction,"--chat-message-bg-color-reaction-hover":A.backgroundReactionHover,"--chat-message-border-style-reaction-hover":A.borderStyleReactionHover,"--chat-message-color-reaction-counter":A.colorReactionCounter,"--chat-message-bg-color-reaction-me":A.backgroundReactionMe,"--chat-message-border-style-reaction-me":A.borderStyleReactionMe,"--chat-message-bg-color-reaction-hover-me":A.backgroundReactionHoverMe,"--chat-message-border-style-reaction-hover-me":A.borderStyleReactionHoverMe,"--chat-message-color-reaction-counter-me":A.colorReactionCounterMe,"--chat-message-bg-color-audio-record":A.backgroundAudioRecord,"--chat-message-bg-color-audio-line":A.backgroundAudioLine,"--chat-message-bg-color-audio-progress":A.backgroundAudioProgress,"--chat-message-bg-color-audio-progress-selector":A.backgroundAudioProgressSelector,"--chat-message-color-file-extension":A.colorFileExtension,"--chat-markdown-bg":O.background,"--chat-markdown-border":O.border,"--chat-markdown-color":O.color,"--chat-markdown-color-multi":O.colorMulti,"--chat-room-color-username":v.colorUsername,"--chat-room-color-message":v.colorMessage,"--chat-room-color-timestamp":v.colorTimestamp,"--chat-room-color-online":v.colorStateOnline,"--chat-room-color-offline":v.colorStateOffline,"--chat-room-bg-color-badge":v.backgroundCounterBadge,"--chat-room-color-badge":v.colorCounterBadge,"--chat-emoji-bg-color":N.background,"--chat-icon-color-search":f.search,"--chat-icon-color-add":f.add,"--chat-icon-color-toggle":f.toggle,"--chat-icon-color-menu":f.menu,"--chat-icon-color-close":f.close,"--chat-icon-color-close-image":f.closeImage,"--chat-icon-color-file":f.file,"--chat-icon-color-paperclip":f.paperclip,"--chat-icon-color-close-outline":f.closeOutline,"--chat-icon-color-close-preview":f.closePreview,"--chat-icon-color-send":f.send,"--chat-icon-color-send-disabled":f.sendDisabled,"--chat-icon-color-emoji":f.emoji,"--chat-icon-color-emoji-reaction":f.emojiReaction,"--chat-icon-color-document":f.document,"--chat-icon-color-pencil":f.pencil,"--chat-icon-color-checkmark":f.checkmark,"--chat-icon-color-checkmark-seen":f.checkmarkSeen,"--chat-icon-color-eye":f.eye,"--chat-icon-color-dropdown-message":f.dropdownMessage,"--chat-icon-bg-dropdown-message":f.dropdownMessageBackground,"--chat-icon-color-dropdown-room":f.dropdownRoom,"--chat-icon-color-dropdown-scroll":f.dropdownScroll,"--chat-icon-color-microphone":f.microphone,"--chat-icon-color-audio-play":f.audioPlay,"--chat-icon-color-audio-pause":f.audioPause,"--chat-icon-color-audio-cancel":f.audioCancel,"--chat-icon-color-audio-confirm":f.audioConfirm});var gf=`.vac-fade-spinner-enter-from{opacity:0}.vac-fade-spinner-enter-active{transition:opacity .8s}.vac-fade-spinner-leave-active{transition:opacity .2s;opacity:0}.vac-fade-image-enter-from{opacity:0}.vac-fade-image-enter-active{transition:opacity 1s}.vac-fade-image-leave-active{transition:opacity .5s;opacity:0}.vac-fade-message-enter-from{opacity:0}.vac-fade-message-enter-active{transition:opacity .5s}.vac-fade-message-leave-active{transition:opacity .2s;opacity:0}.vac-slide-left-enter-active,.vac-slide-right-enter-active{transition:all .3s ease;transition-property:transform,opacity}.vac-slide-left-leave-active,.vac-slide-right-leave-active{transition:all .2s cubic-bezier(1,.5,.8,1)!important;transition-property:transform,opacity}.vac-slide-left-enter-from,.vac-slide-left-leave-to{transform:translate(10px);opacity:0}.vac-slide-right-enter-from,.vac-slide-right-leave-to{transform:translate(-10px);opacity:0}.vac-slide-up-enter-active{transition:all .3s ease}.vac-slide-up-leave-active{transition:all .2s cubic-bezier(1,.5,.8,1)}.vac-slide-up-enter-from,.vac-slide-up-leave-to{transform:translateY(10px);opacity:0}.vac-bounce-enter-active{animation:vac-bounce-in .5s}.vac-bounce-leave-active{animation:vac-bounce-in .3s reverse}@keyframes vac-bounce-in{0%{transform:scale(0)}50%{transform:scale(1.05)}to{transform:scale(1)}}.vac-fade-preview-enter{opacity:0}.vac-fade-preview-enter-active{transition:opacity .1s}.vac-fade-preview-leave-active{transition:opacity .2s;opacity:0}.vac-bounce-preview-enter-active{animation:vac-bounce-image-in .4s}.vac-bounce-preview-leave-active{animation:vac-bounce-image-in .3s reverse}@keyframes vac-bounce-image-in{0%{transform:scale(.6)}to{transform:scale(1)}}.vac-menu-list{border-radius:4px;display:block;cursor:pointer;background:var(--chat-dropdown-bg-color);padding:6px 0}.vac-menu-list :hover{background:var(--chat-dropdown-bg-color-hover);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-menu-list :not(:hover){transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-menu-item{-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-ms-flex:1 1 100%;flex:1 1 100%;min-height:30px;padding:5px 16px;position:relative;white-space:nowrap;line-height:30px}.vac-menu-options{position:absolute;right:10px;top:20px;z-index:9999;min-width:150px;display:inline-block;border-radius:4px;font-size:14px;color:var(--chat-color);overflow-y:auto;overflow-x:hidden;contain:content;box-shadow:0 2px 2px -4px #0000001a,0 2px 2px 1px #0000001f,0 1px 8px 1px #0000001f}.vac-app-border{border:var(--chat-border-style)}.vac-app-border-t{border-top:var(--chat-border-style)}.vac-app-border-r{border-right:var(--chat-border-style)}.vac-app-border-b{border-bottom:var(--chat-border-style)}.vac-app-box-shadow{transition:all .5s;box-shadow:0 2px 2px -4px #0000001a,0 2px 2px 1px #0000001f,0 1px 8px 1px #0000001f}.vac-item-clickable{cursor:pointer}.vac-vertical-center{display:flex;align-items:center;height:100%}.vac-vertical-center .vac-vertical-container{width:100%;text-align:center}.vac-svg-button{max-height:30px;display:flex;cursor:pointer;transition:all .2s}.vac-svg-button:hover{transform:scale(1.1);opacity:.7}.vac-avatar{background-size:cover;background-position:center center;background-repeat:no-repeat;background-color:#ddd;height:42px;width:42px;min-height:42px;min-width:42px;margin-right:15px;border-radius:50%}.vac-blur-loading{filter:blur(3px)}.vac-badge-counter{height:13px;width:auto;min-width:13px;border-radius:50%;display:flex;align-items:center;justify-content:center;padding:3px;font-size:11px;font-weight:500}.vac-text-ellipsis{width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.vac-text-bold{font-weight:700}.vac-text-italic{font-style:italic}.vac-text-strike{text-decoration:line-through}.vac-text-underline{text-decoration:underline}.vac-text-inline-code{display:inline-block;font-size:12px;color:var(--chat-markdown-color);background:var(--chat-markdown-bg);border:1px solid var(--chat-markdown-border);border-radius:3px;margin:2px 0;padding:2px 3px}.vac-text-multiline-code{display:block;font-size:12px;color:var(--chat-markdown-color-multi);background:var(--chat-markdown-bg);border:1px solid var(--chat-markdown-border);border-radius:3px;margin:4px 0;padding:7px}.vac-text-tag{color:var(--chat-message-color-tag);cursor:pointer}.vac-file-container{display:flex;align-content:center;justify-content:center;flex-wrap:wrap;text-align:center;background:var(--chat-bg-color-input);border:var(--chat-border-style-input);border-radius:4px;padding:10px}.vac-file-container svg{height:28px;width:28px}.vac-file-container .vac-text-extension{font-size:12px;color:var(--chat-message-color-file-extension);margin-top:-2px}.vac-card-window{width:100%;display:block;max-width:100%;background:var(--chat-content-bg-color);color:var(--chat-color);overflow-wrap:break-word;white-space:normal;border:var(--chat-container-border);border-radius:var(--chat-container-border-radius);box-shadow:var(--chat-container-box-shadow);-webkit-tap-highlight-color:transparent}.vac-card-window *{font-family:inherit}.vac-card-window a{color:#0d579c;font-weight:500}.vac-card-window .vac-chat-container{height:100%;display:flex}.vac-card-window .vac-chat-container input{min-width:10px}.vac-card-window .vac-chat-container textarea,.vac-card-window .vac-chat-container input[type=text],.vac-card-window .vac-chat-container input[type=search]{-webkit-appearance:none}.vac-media-preview{position:fixed;top:0;left:0;z-index:99;width:100vw;height:100vh;display:flex;align-items:center;background-color:#000c;outline:none}.vac-media-preview .vac-media-preview-container{height:calc(100% - 140px);width:calc(100% - 80px);padding:70px 40px;margin:0 auto}.vac-media-preview .vac-image-preview{width:100%;height:100%;background-size:contain;background-repeat:no-repeat;background-position:center}.vac-media-preview .vac-svg-button{position:absolute;top:30px;right:30px;transform:scale(1.4)}@media only screen and (max-width: 768px){.vac-media-preview .vac-svg-button{top:20px;right:20px;transform:scale(1.2)}.vac-media-preview .vac-media-preview-container{width:calc(100% - 40px);padding:70px 20px}}.vac-col-messages{position:relative;height:100%;flex:1;overflow:hidden;display:flex;flex-flow:column}.vac-col-messages .vac-container-center{height:100%;width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}.vac-col-messages .vac-room-empty{font-size:14px;color:#9ca6af;font-style:italic;line-height:20px;white-space:pre-line}.vac-col-messages .vac-room-empty div{padding:0 10%}.vac-col-messages .vac-container-scroll{background:var(--chat-content-bg-color);flex:1;overflow-y:auto;margin-right:1px;margin-top:60px;-webkit-overflow-scrolling:touch}.vac-col-messages .vac-container-scroll.vac-scroll-smooth{scroll-behavior:smooth}.vac-col-messages .vac-messages-container{padding:0 5px 5px}.vac-col-messages .vac-text-started{font-size:14px;color:var(--chat-message-color-started);font-style:italic;text-align:center;margin-top:30px;margin-bottom:20px}.vac-col-messages .vac-icon-scroll{position:absolute;bottom:80px;right:20px;padding:8px;background:var(--chat-bg-scroll-icon);border-radius:50%;box-shadow:0 1px 1px -1px #0003,0 1px 1px #00000024,0 1px 2px #0000001f;display:flex;cursor:pointer;z-index:10}.vac-col-messages .vac-icon-scroll svg{height:25px;width:25px}.vac-col-messages .vac-messages-count{position:absolute;top:-8px;left:11px;background-color:var(--chat-message-bg-color-scroll-counter);color:var(--chat-message-color-scroll-counter)}.vac-col-messages .vac-messages-hidden{opacity:0}@media only screen and (max-width: 768px){.vac-col-messages .vac-container-scroll{margin-top:50px}.vac-col-messages .vac-text-started{margin-top:20px}.vac-col-messages .vac-icon-scroll{bottom:70px}}.vac-room-header{position:absolute;display:flex;align-items:center;height:64px;width:100%;z-index:10;margin-right:1px;background:var(--chat-header-bg-color);border-top-right-radius:var(--chat-container-border-radius)}.vac-room-header .vac-room-wrapper{display:flex;align-items:center;min-width:0;height:100%;width:100%;padding:0 16px}.vac-room-header .vac-toggle-button{margin-right:15px}.vac-room-header .vac-toggle-button svg{height:26px;width:26px}.vac-room-header .vac-rotate-icon{transform:rotate(180deg)!important}.vac-room-header .vac-rotate-icon-init{transform:rotate(360deg)}.vac-room-header .vac-info-wrapper,.vac-room-header .vac-room-selection{display:flex;align-items:center;min-width:0;width:100%;height:100%}.vac-room-header .vac-room-selection .vac-selection-button{padding:8px 16px;color:var(--chat-color-button);background-color:var(--chat-bg-color-button);border-radius:4px;margin-right:10px;cursor:pointer;transition:all .2s}.vac-room-header .vac-room-selection .vac-selection-button:hover{opacity:.7}.vac-room-header .vac-room-selection .vac-selection-button:active{opacity:.9}.vac-room-header .vac-room-selection .vac-selection-button .vac-selection-button-count{margin-left:6px;opacity:.9}.vac-room-header .vac-room-selection .vac-selection-cancel{display:flex;align-items:center;margin-left:auto;white-space:nowrap;color:var(--chat-color-button-clear);transition:all .2s}.vac-room-header .vac-room-selection .vac-selection-cancel:hover{opacity:.7}.vac-room-header .vac-room-name{font-size:17px;font-weight:500;line-height:22px;color:var(--chat-header-color-name)}.vac-room-header .vac-room-info{font-size:13px;line-height:18px;color:var(--chat-header-color-info)}.vac-room-header .vac-room-options{margin-left:auto}@media only screen and (max-width: 768px){.vac-room-header{height:50px}.vac-room-header .vac-room-wrapper{padding:0 10px}.vac-room-header .vac-room-name{font-size:16px;line-height:22px}.vac-room-header .vac-room-info{font-size:12px;line-height:16px}.vac-room-header .vac-avatar{height:37px;width:37px;min-height:37px;min-width:37px}}.vac-room-footer{width:100%;border-bottom-right-radius:4px;z-index:10}.vac-box-footer{display:flex;position:relative;background:var(--chat-footer-bg-color);padding:10px 8px}.vac-textarea{height:20px;width:100%;line-height:20px;overflow:hidden;outline:0;resize:none;border-radius:20px;padding:12px 16px;box-sizing:content-box;font-size:16px;background:var(--chat-bg-color-input);color:var(--chat-color);caret-color:var(--chat-color-caret);border:var(--chat-border-style-input)}.vac-textarea::placeholder{color:var(--chat-color-placeholder);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.vac-textarea-outline{border:1px solid var(--chat-border-color-input-selected);box-shadow:inset 0 0 0 1px var(--chat-border-color-input-selected)}.vac-icon-textarea,.vac-icon-textarea-left{display:flex;align-items:center}.vac-icon-textarea svg,.vac-icon-textarea .vac-wrapper,.vac-icon-textarea-left svg,.vac-icon-textarea-left .vac-wrapper{margin:0 7px}.vac-icon-textarea{margin-left:5px}.vac-icon-textarea-left{display:flex;align-items:center;margin-right:5px}.vac-icon-textarea-left svg,.vac-icon-textarea-left .vac-wrapper{margin:0 7px}.vac-icon-textarea-left .vac-icon-microphone{fill:var(--chat-icon-color-microphone);margin:0 7px}.vac-icon-textarea-left .vac-dot-audio-record{height:15px;width:15px;border-radius:50%;background-color:var(--chat-message-bg-color-audio-record);animation:vac-scaling .8s ease-in-out infinite alternate}@keyframes vac-scaling{0%{transform:scale(1);opacity:.4}to{transform:scale(1.1);opacity:1}}.vac-icon-textarea-left .vac-dot-audio-record-time{font-size:16px;color:var(--chat-color);margin-left:8px;width:45px}.vac-icon-textarea-left .vac-icon-audio-stop,.vac-icon-textarea-left .vac-icon-audio-confirm{min-height:28px;min-width:28px}.vac-icon-textarea-left .vac-icon-audio-stop svg,.vac-icon-textarea-left .vac-icon-audio-confirm svg{min-height:28px;min-width:28px}.vac-icon-textarea-left .vac-icon-audio-stop{margin-right:20px}.vac-icon-textarea-left .vac-icon-audio-stop #vac-icon-close-outline{fill:var(--chat-icon-color-audio-cancel)}.vac-icon-textarea-left .vac-icon-audio-confirm{margin-right:3px;margin-left:12px}.vac-icon-textarea-left .vac-icon-audio-confirm #vac-icon-checkmark{fill:var(--chat-icon-color-audio-confirm)}.vac-send-disabled,.vac-send-disabled svg{cursor:none!important;pointer-events:none!important;transform:none!important}@media only screen and (max-width: 768px){.vac-room-footer{width:100%}.vac-box-footer{padding:7px 2px 7px 7px}.vac-box-footer.vac-box-footer-border{border-top:var(--chat-border-style-input)}.vac-textarea{padding:7px;line-height:18px}.vac-textarea::placeholder{color:transparent}.vac-icon-textarea svg,.vac-icon-textarea .vac-wrapper,.vac-icon-textarea-left svg,.vac-icon-textarea-left .vac-wrapper{margin:0 5px!important}}.vac-emojis-container{width:calc(100% - 16px);padding:10px 8px;background:var(--chat-footer-bg-color);display:flex;align-items:center;overflow:auto}.vac-emojis-container .vac-emoji-element{padding:0 8px;font-size:30px;border-radius:4px;cursor:pointer;background:var(--chat-footer-bg-color-tag);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-emojis-container .vac-emoji-element-active{background:var(--chat-footer-bg-color-tag-active)}@media only screen and (max-width: 768px){.vac-emojis-container{width:calc(100% - 10px);padding:7px 5px}.vac-emojis-container .vac-emoji-element{padding:0 7px;font-size:26px}}.vac-reply-container{display:flex;padding:10px 10px 0;background:var(--chat-footer-bg-color);align-items:center;width:calc(100% - 20px)}.vac-reply-container .vac-reply-box{width:100%;overflow:hidden;background:var(--chat-footer-bg-color-reply);border-radius:4px;padding:8px 10px}.vac-reply-container .vac-reply-info{overflow:hidden}.vac-reply-container .vac-reply-username{color:var(--chat-message-color-reply-username);font-size:12px;line-height:15px;margin-bottom:2px}.vac-reply-container .vac-reply-content{font-size:12px;color:var(--chat-message-color-reply-content);white-space:pre-line}.vac-reply-container .vac-icon-reply{margin-left:10px}.vac-reply-container .vac-icon-reply svg{height:20px;width:20px}.vac-reply-container .vac-image-reply{max-height:100px;max-width:200px;margin:4px 10px 0 0;border-radius:4px}.vac-reply-container .vac-audio-reply{margin-right:10px}.vac-reply-container .vac-file-container{max-width:80px}@media only screen and (max-width: 768px){.vac-reply-container{padding:5px 8px;width:calc(100% - 16px)}}.vac-room-files-container{display:flex;align-items:center;padding:10px 6px 0;background:var(--chat-footer-bg-color)}.vac-room-files-container .vac-files-box{display:flex;overflow:auto;width:calc(100% - 30px)}.vac-room-files-container video{height:100px;border:var(--chat-border-style-input);border-radius:4px}.vac-room-files-container .vac-icon-close{margin-left:auto}.vac-room-files-container .vac-icon-close svg{height:20px;width:20px}@media only screen and (max-width: 768px){.vac-files-container{padding:6px 4px 4px 2px}}.vac-room-file-container{display:flex;position:relative;margin:0 4px}.vac-room-file-container .vac-message-image{position:relative;background-color:var(--chat-message-bg-color-image)!important;background-size:cover!important;background-position:center center!important;background-repeat:no-repeat!important;height:100px;width:100px;border:var(--chat-border-style-input);border-radius:4px}.vac-room-file-container .vac-file-container{height:80px;width:80px}.vac-room-file-container .vac-icon-remove{position:absolute;top:6px;left:6px;z-index:10}.vac-room-file-container .vac-icon-remove svg{height:20px;width:20px;border-radius:50%}.vac-room-file-container .vac-icon-remove:before{content:" ";position:absolute;width:100%;height:100%;background:rgba(0,0,0,.5);border-radius:50%;z-index:-1}.vac-tags-container{display:flex;flex-direction:column;align-items:center;width:100%}.vac-tags-container .vac-tags-box{display:flex;width:100%;height:54px;overflow:hidden;cursor:pointer;background:var(--chat-footer-bg-color-tag);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-tags-container .vac-tags-box-active{background:var(--chat-footer-bg-color-tag-active)}.vac-tags-container .vac-tags-info{display:flex;overflow:hidden;padding:0 20px;align-items:center}.vac-tags-container .vac-tags-avatar{height:34px;width:34px;min-height:34px;min-width:34px}.vac-tags-container .vac-tags-username{font-size:14px}@media only screen and (max-width: 768px){.vac-tags-container .vac-tags-box{height:50px}.vac-tags-container .vac-tags-info{padding:0 12px}}.vac-template-container{display:flex;flex-direction:column;align-items:center;width:100%}.vac-template-container .vac-template-box{display:flex;width:100%;height:54px;overflow:hidden;cursor:pointer;background:var(--chat-footer-bg-color-tag);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-template-container .vac-template-active{background:var(--chat-footer-bg-color-tag-active)}.vac-template-container .vac-template-info{display:flex;overflow:hidden;padding:0 20px;align-items:center}.vac-template-container .vac-template-tag{font-size:14px;font-weight:700;margin-right:10px}.vac-template-container .vac-template-text{font-size:14px}@media only screen and (max-width: 768px){.vac-template-container .vac-template-box{height:50px}.vac-template-container .vac-template-info{padding:0 12px}}.vac-rooms-container{display:flex;flex-flow:column;flex:0 0 25%;min-width:260px;max-width:500px;position:relative;background:var(--chat-sidemenu-bg-color);height:100%;border-top-left-radius:var(--chat-container-border-radius);border-bottom-left-radius:var(--chat-container-border-radius)}.vac-rooms-container.vac-rooms-container-full{flex:0 0 100%;max-width:100%}.vac-rooms-container .vac-rooms-empty{font-size:14px;color:#9ca6af;font-style:italic;text-align:center;margin:40px 0;line-height:20px;white-space:pre-line}.vac-rooms-container .vac-room-list{flex:1;position:relative;max-width:100%;cursor:pointer;padding:0 10px 5px;overflow-y:auto}.vac-rooms-container .vac-room-item{border-radius:8px;align-items:center;display:flex;flex:1 1 100%;margin-bottom:5px;padding:0 14px;position:relative;min-height:71px;transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-rooms-container .vac-room-item:hover{background:var(--chat-sidemenu-bg-color-hover)}.vac-rooms-container .vac-room-selected{color:var(--chat-sidemenu-color-active)!important;background:var(--chat-sidemenu-bg-color-active)!important}.vac-rooms-container .vac-room-selected:hover{background:var(--chat-sidemenu-bg-color-active)!important}@media only screen and (max-width: 768px){.vac-rooms-container .vac-room-list{padding:0 7px 5px}.vac-rooms-container .vac-room-item{min-height:60px;padding:0 8px}}.vac-room-container{display:flex;flex:1;align-items:center;width:100%}.vac-room-container .vac-name-container{flex:1}.vac-room-container .vac-title-container{display:flex;align-items:center;line-height:25px}.vac-room-container .vac-state-circle{width:9px;height:9px;border-radius:50%;background-color:var(--chat-room-color-offline);margin-right:6px;transition:.3s}.vac-room-container .vac-state-online{background-color:var(--chat-room-color-online)}.vac-room-container .vac-room-name{flex:1;color:var(--chat-room-color-username);font-weight:500}.vac-room-container .vac-text-date{margin-left:5px;font-size:11px;color:var(--chat-room-color-timestamp)}.vac-room-container .vac-text-last{display:flex;align-items:center;font-size:12px;line-height:19px;color:var(--chat-room-color-message)}.vac-room-container .vac-message-new{color:var(--chat-room-color-username);font-weight:500}.vac-room-container .vac-icon-check{display:flex;vertical-align:middle;height:14px;width:14px;margin-top:-2px;margin-right:2px}.vac-room-container .vac-icon-microphone{height:15px;width:15px;vertical-align:middle;margin:-3px 1px 0 -2px;fill:var(--chat-room-color-message)}.vac-room-container .vac-room-options-container{display:flex;margin-left:auto}.vac-room-container .vac-room-badge{background-color:var(--chat-room-bg-color-badge);color:var(--chat-room-color-badge);margin-left:5px}.vac-room-container .vac-list-room-options{height:19px;width:19px;align-items:center;margin-left:5px}.vac-box-empty{margin-top:10px}@media only screen and (max-width: 768px){.vac-box-empty{margin-top:7px}}.vac-box-search{position:sticky;display:flex;align-items:center;height:64px;padding:0 15px}.vac-box-search .vac-icon-search{display:flex;position:absolute;left:30px}.vac-box-search .vac-icon-search svg{width:18px;height:18px}.vac-box-search .vac-input{height:38px;width:100%;background:var(--chat-bg-color-input);color:var(--chat-color);font-size:15px;outline:0;caret-color:var(--chat-color-caret);padding:10px 10px 10px 40px;border:1px solid var(--chat-sidemenu-border-color-search);border-radius:20px}.vac-box-search .vac-input::placeholder{color:var(--chat-color-placeholder)}.vac-box-search .vac-add-icon{margin-left:auto;padding-left:10px}@media only screen and (max-width: 768px){.vac-box-search{height:58px}}.vac-message-wrapper .vac-card-info{border-radius:4px;text-align:center;margin:10px auto;font-size:12px;padding:4px;display:block;overflow-wrap:break-word;position:relative;white-space:normal;box-shadow:0 1px 1px -1px #0000001a,0 1px 1px -1px #0000001c,0 1px 2px -1px #0000001c}.vac-message-wrapper .vac-card-date{max-width:150px;font-weight:500;text-transform:uppercase;color:var(--chat-message-color-date);background-color:var(--chat-message-bg-color-date)}.vac-message-wrapper .vac-card-system{max-width:250px;padding:8px 4px;color:var(--chat-message-color-system);background-color:var(--chat-message-bg-color-system)}.vac-message-wrapper .vac-line-new{color:var(--chat-message-color-new-messages);position:relative;text-align:center;font-size:13px;padding:10px 0}.vac-message-wrapper .vac-line-new:after,.vac-message-wrapper .vac-line-new:before{border-top:1px solid var(--chat-message-color-new-messages);content:"";left:0;position:absolute;top:50%;width:calc(50% - 60px)}.vac-message-wrapper .vac-line-new:before{left:auto;right:0}.vac-message-wrapper .vac-message-box{display:flex;flex:0 0 50%;max-width:50%;justify-content:flex-start;line-height:1.4}.vac-message-wrapper .vac-avatar{height:28px;width:28px;min-height:28px;min-width:28px;margin:0 0 2px;align-self:flex-end}.vac-message-wrapper .vac-avatar-current-offset{margin-right:28px}.vac-message-wrapper .vac-avatar-offset{margin-left:28px}.vac-message-wrapper .vac-failure-container{position:relative;align-self:flex-end;height:20px;width:20px;margin:0 0 2px -4px;border-radius:50%;background-color:#f44336}.vac-message-wrapper .vac-failure-container.vac-failure-container-avatar{margin-right:6px}.vac-message-wrapper .vac-failure-container .vac-failure-text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:15px;font-weight:700}.vac-message-wrapper .vac-message-container{position:relative;padding:2px 10px;align-items:end;min-width:100px;box-sizing:content-box}.vac-message-wrapper .vac-message-container-offset{margin-top:10px}.vac-message-wrapper .vac-offset-current{margin-left:50%;justify-content:flex-end}.vac-message-wrapper .vac-message-card{background-color:var(--chat-message-bg-color);color:var(--chat-message-color);border-radius:8px;font-size:14px;padding:6px 9px 3px;white-space:pre-line;max-width:100%;-webkit-transition-property:box-shadow,opacity;transition-property:box-shadow,opacity;transition:box-shadow .28s cubic-bezier(.4,0,.2,1);will-change:box-shadow;box-shadow:0 1px 1px -1px #0000001a,0 1px 1px -1px #0000001c,0 1px 2px -1px #0000001c}.vac-message-wrapper .vac-message-highlight{box-shadow:0 1px 2px -1px #0000001a,0 1px 2px -1px #0000001c,0 1px 5px -1px #0000001c}.vac-message-wrapper .vac-message-current{background-color:var(--chat-message-bg-color-me)!important}.vac-message-wrapper .vac-message-deleted{color:var(--chat-message-color-deleted)!important;font-size:13px!important;font-style:italic!important;background-color:var(--chat-message-bg-color-deleted)!important}.vac-message-wrapper .vac-message-selected{background-color:var(--chat-message-bg-color-selected)!important;transition:background-color .2s}.vac-message-wrapper .vac-icon-deleted{height:14px;width:14px;vertical-align:middle;margin:-2px 2px 0 0;fill:var(--chat-message-color-deleted)}.vac-message-wrapper .vac-message-image{position:relative;background-color:var(--chat-message-bg-color-image)!important;background-size:cover!important;background-position:center center!important;background-repeat:no-repeat!important;height:250px;width:250px;max-width:100%;border-radius:4px;margin:4px auto 5px;transition:.4s filter linear}.vac-message-wrapper .vac-text-username{font-size:13px;color:var(--chat-message-color-username);margin-bottom:2px}.vac-message-wrapper .vac-username-reply{margin-bottom:5px}.vac-message-wrapper .vac-text-timestamp{font-size:10px;color:var(--chat-message-color-timestamp);text-align:right}.vac-message-wrapper .vac-progress-time{float:left;margin:-2px 0 0 40px;color:var(--chat-color);font-size:12px}.vac-message-wrapper .vac-icon-edited{-webkit-box-align:center;align-items:center;display:-webkit-inline-box;display:inline-flex;justify-content:center;letter-spacing:normal;line-height:1;text-indent:0;vertical-align:middle;margin:0 4px 2px}.vac-message-wrapper .vac-icon-edited svg{height:12px;width:12px}.vac-message-wrapper .vac-icon-check{height:14px;width:14px;vertical-align:middle;margin:-3px -3px 0 3px}@media only screen and (max-width: 768px){.vac-message-wrapper .vac-message-container{padding:2px 3px 1px}.vac-message-wrapper .vac-message-container-offset{margin-top:10px}.vac-message-wrapper .vac-message-box{flex:0 0 80%;max-width:80%}.vac-message-wrapper .vac-avatar{height:25px;width:25px;min-height:25px;min-width:25px;margin:0 6px 1px 0}.vac-message-wrapper .vac-avatar.vac-avatar-current{margin:0 0 1px 6px}.vac-message-wrapper .vac-avatar-current-offset{margin-right:31px}.vac-message-wrapper .vac-avatar-offset{margin-left:31px}.vac-message-wrapper .vac-failure-container{margin-left:2px}.vac-message-wrapper .vac-failure-container.vac-failure-container-avatar{margin-right:0}.vac-message-wrapper .vac-offset-current{margin-left:20%}.vac-message-wrapper .vac-progress-time{margin-left:37px}}.vac-audio-player{display:flex;margin:8px 0 5px}.vac-audio-player .vac-svg-button{max-width:18px;margin-left:7px}@media only screen and (max-width: 768px){.vac-audio-player{margin:4px 0 0}.vac-audio-player .vac-svg-button{max-width:16px;margin-left:5px}}.vac-player-bar{display:flex;align-items:center;max-width:calc(100% - 18px);margin-right:7px;margin-left:20px}.vac-player-bar .vac-player-progress{width:190px}.vac-player-bar .vac-player-progress .vac-line-container{position:relative;height:4px;border-radius:5px;background-color:var(--chat-message-bg-color-audio-line)}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-progress{position:absolute;height:inherit;background-color:var(--chat-message-bg-color-audio-progress);border-radius:inherit}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot{position:absolute;top:-5px;margin-left:-7px;height:14px;width:14px;border-radius:50%;background-color:var(--chat-message-bg-color-audio-progress-selector);transition:transform .25s}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot__active{transform:scale(1.2)}@media only screen and (max-width: 768px){.vac-player-bar{margin-right:5px}.vac-player-bar .vac-player-progress .vac-line-container{height:3px}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot{height:12px;width:12px;top:-5px;margin-left:-5px}}.vac-message-actions-wrapper .vac-options-container{position:absolute;top:2px;right:10px;height:40px;width:70px;overflow:hidden;border-top-right-radius:8px}.vac-message-actions-wrapper .vac-blur-container{position:absolute;height:100%;width:100%;left:8px;bottom:10px;background:var(--chat-message-bg-color);filter:blur(3px);border-bottom-left-radius:8px}.vac-message-actions-wrapper .vac-options-me{background:var(--chat-message-bg-color-me)}.vac-message-actions-wrapper .vac-message-options{background:var(--chat-icon-bg-dropdown-message);border-radius:50%;position:absolute;top:7px;right:7px}.vac-message-actions-wrapper .vac-message-options svg{height:17px;width:17px;padding:5px;margin:-5px}.vac-message-actions-wrapper .vac-message-emojis{position:absolute;top:6px;right:30px}.vac-message-actions-wrapper .vac-menu-options{right:15px}.vac-message-actions-wrapper .vac-menu-left{right:-118px}@media only screen and (max-width: 768px){.vac-message-actions-wrapper .vac-options-container{right:3px}.vac-message-actions-wrapper .vac-menu-left{right:-50px}}.vac-message-files-container .vac-file-wrapper{position:relative;width:fit-content}.vac-message-files-container .vac-file-wrapper .vac-file-container{height:60px;width:60px;margin:3px 0 5px;cursor:pointer;transition:all .6s}.vac-message-files-container .vac-file-wrapper .vac-file-container:hover{opacity:.85}.vac-message-files-container .vac-file-wrapper .vac-file-container svg{height:30px;width:30px}.vac-message-files-container .vac-file-wrapper .vac-file-container.vac-file-container-progress{background-color:#0000004d}.vac-message-file-container{position:relative;z-index:0}.vac-message-file-container .vac-message-image-container{cursor:pointer}.vac-message-file-container .vac-image-buttons{position:absolute;width:100%;height:100%;border-radius:4px;background:linear-gradient(to bottom,rgba(0,0,0,0) 55%,rgba(0,0,0,.02) 60%,rgba(0,0,0,.05) 65%,rgba(0,0,0,.1) 70%,rgba(0,0,0,.2) 75%,rgba(0,0,0,.3) 80%,rgba(0,0,0,.5) 85%,rgba(0,0,0,.6) 90%,rgba(0,0,0,.7) 95%,rgba(0,0,0,.8) 100%)}.vac-message-file-container .vac-image-buttons svg{height:26px;width:26px}.vac-message-file-container .vac-image-buttons .vac-button-view,.vac-message-file-container .vac-image-buttons .vac-button-download{position:absolute;bottom:6px;left:7px}.vac-message-file-container .vac-image-buttons :first-child{left:40px}.vac-message-file-container .vac-image-buttons .vac-button-view{max-width:18px;bottom:8px}.vac-message-file-container .vac-video-container{width:350px;max-width:100%;margin:4px auto 5px;cursor:pointer}.vac-message-file-container .vac-video-container video{border-radius:4px}.vac-button-reaction{display:inline-flex;align-items:center;border:var(--chat-message-border-style-reaction);outline:none;background:var(--chat-message-bg-color-reaction);border-radius:4px;margin:4px 2px 0;transition:.3s;padding:0 5px;font-size:18px;line-height:23px}.vac-button-reaction span{font-size:11px;font-weight:500;min-width:7px;color:var(--chat-message-color-reaction-counter)}.vac-button-reaction:hover{border:var(--chat-message-border-style-reaction-hover);background:var(--chat-message-bg-color-reaction-hover);cursor:pointer}.vac-button-reaction.vac-reaction-me{border:var(--chat-message-border-style-reaction-me);background:var(--chat-message-bg-color-reaction-me)}.vac-button-reaction.vac-reaction-me span{color:var(--chat-message-color-reaction-counter-me)}.vac-button-reaction.vac-reaction-me:hover{border:var(--chat-message-border-style-reaction-hover-me);background:var(--chat-message-bg-color-reaction-hover-me)}.vac-reply-message{background:var(--chat-message-bg-color-reply);border-radius:4px;margin:-1px -5px 8px;padding:8px 10px}.vac-reply-message .vac-reply-username{color:var(--chat-message-color-reply-username);font-size:12px;line-height:15px;margin-bottom:2px}.vac-reply-message .vac-image-reply-container{width:70px}.vac-reply-message .vac-image-reply-container .vac-message-image-reply{height:70px;width:70px;margin:4px auto 3px}.vac-reply-message .vac-video-reply-container{width:200px;max-width:100%}.vac-reply-message .vac-video-reply-container video{border-radius:4px}.vac-reply-message .vac-reply-content{font-size:12px;color:var(--chat-message-color-reply-content)}.vac-reply-message .vac-file-container{height:60px;width:60px}.vac-emoji-wrapper{position:relative;display:flex}.vac-emoji-wrapper .vac-emoji-reaction svg{height:19px;width:19px}.vac-emoji-wrapper .vac-emoji-picker{position:absolute;z-index:9999;bottom:32px;right:10px;width:300px;padding-top:4px;overflow:scroll;box-sizing:border-box;border-radius:.5rem;background:var(--chat-emoji-bg-color);box-shadow:0 1px 2px -2px #0000001a,0 1px 2px -1px #0000001a,0 1px 2px 1px #0000001a;scrollbar-width:none}.vac-emoji-wrapper .vac-emoji-picker::-webkit-scrollbar{display:none}.vac-emoji-wrapper .vac-emoji-picker.vac-picker-reaction{position:fixed;top:initial;right:initial}.vac-emoji-wrapper .vac-emoji-picker emoji-picker{height:100%;width:100%;--emoji-size: 1.2rem;--background: var(--chat-emoji-bg-color);--emoji-padding: .4rem;--border-color: var(--chat-sidemenu-border-color-search);--button-hover-background: var(--chat-sidemenu-bg-color-hover);--button-active-background: var(--chat-sidemenu-bg-color-hover)}.vac-format-message-wrapper .vac-format-container{display:inline}.vac-format-message-wrapper .vac-icon-deleted{height:14px;width:14px;vertical-align:middle;margin:-3px 1px 0 0;fill:var(--chat-room-color-message)}.vac-format-message-wrapper .vac-image-link-container{background-color:var(--chat-message-bg-color-media);padding:8px;margin:2px auto;border-radius:4px}.vac-format-message-wrapper .vac-image-link{position:relative;background-color:var(--chat-message-bg-color-image)!important;background-size:contain;background-position:center center!important;background-repeat:no-repeat!important;height:150px;width:150px;max-width:100%;border-radius:4px;margin:0 auto}.vac-format-message-wrapper .vac-image-link-message{max-width:166px;font-size:12px}.vac-loader-wrapper.vac-container-center{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:9}.vac-loader-wrapper.vac-container-top{padding:21px}.vac-loader-wrapper.vac-container-top #vac-circle{height:20px;width:20px}.vac-loader-wrapper #vac-circle{margin:auto;height:28px;width:28px;border:3px rgba(0,0,0,.25) solid;border-top:3px var(--chat-color-spinner) solid;border-right:3px var(--chat-color-spinner) solid;border-bottom:3px var(--chat-color-spinner) solid;border-radius:50%;-webkit-animation:vac-spin 1s infinite linear;animation:vac-spin 1s infinite linear}@media only screen and (max-width: 768px){.vac-loader-wrapper #vac-circle{height:24px;width:24px}.vac-loader-wrapper.vac-container-top{padding:18px}.vac-loader-wrapper.vac-container-top #vac-circle{height:16px;width:16px}}@-webkit-keyframes vac-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@keyframes vac-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}#vac-icon-search{fill:var(--chat-icon-color-search)}#vac-icon-add{fill:var(--chat-icon-color-add)}#vac-icon-toggle{fill:var(--chat-icon-color-toggle)}#vac-icon-menu{fill:var(--chat-icon-color-menu)}#vac-icon-close{fill:var(--chat-icon-color-close)}#vac-icon-close-image{fill:var(--chat-icon-color-close-image)}#vac-icon-file{fill:var(--chat-icon-color-file)}#vac-icon-paperclip{fill:var(--chat-icon-color-paperclip)}#vac-icon-close-outline{fill:var(--chat-icon-color-close-outline)}#vac-icon-close-outline-preview{fill:var(--chat-icon-color-close-preview)}#vac-icon-send{fill:var(--chat-icon-color-send)}#vac-icon-send-disabled{fill:var(--chat-icon-color-send-disabled)}#vac-icon-emoji{fill:var(--chat-icon-color-emoji)}#vac-icon-emoji-reaction{fill:var(--chat-icon-color-emoji-reaction)}#vac-icon-document{fill:var(--chat-icon-color-document)}#vac-icon-pencil{fill:var(--chat-icon-color-pencil)}#vac-icon-checkmark,#vac-icon-double-checkmark{fill:var(--chat-icon-color-checkmark)}#vac-icon-checkmark-seen,#vac-icon-double-checkmark-seen{fill:var(--chat-icon-color-checkmark-seen)}#vac-icon-eye{fill:var(--chat-icon-color-eye)}#vac-icon-dropdown-message{fill:var(--chat-icon-color-dropdown-message)}#vac-icon-dropdown-room{fill:var(--chat-icon-color-dropdown-room)}#vac-icon-dropdown-scroll{fill:var(--chat-icon-color-dropdown-scroll)}#vac-icon-audio-play{fill:var(--chat-icon-color-audio-play)}#vac-icon-audio-pause{fill:var(--chat-icon-color-audio-pause)}.vac-progress-wrapper{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:9}.vac-progress-wrapper circle{transition:stroke-dashoffset .35s;transform:rotate(-90deg);transform-origin:50% 50%}.vac-progress-wrapper .vac-progress-content{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:-1;margin-top:-2px;background-color:#000000b3;border-radius:50%}.vac-progress-wrapper .vac-progress-content .vac-progress-text{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-weight:700;color:#fff}.vac-progress-wrapper .vac-progress-content .vac-progress-text .vac-progress-pourcent{font-size:9px;font-weight:400}
`;const bf={name:"ChatContainer",components:{RoomsList:Mc,Room:sf,MediaPreview:ff},props:{height:{type:String,default:"600px"},theme:{type:String,default:"light"},styles:{type:Object,default:()=>({})},responsiveBreakpoint:{type:Number,default:900},singleRoom:{type:Boolean,default:!1},roomsListOpened:{type:Boolean,default:!0},textMessages:{type:Object,default:null},currentUserId:{type:[String,Number],default:""},rooms:{type:Array,default:()=>[]},roomsOrder:{type:String,default:"desc"},loadingRooms:{type:Boolean,default:!1},roomsLoaded:{type:Boolean,default:!1},roomId:{type:[String,Number],default:null},loadFirstRoom:{type:Boolean,default:!0},messages:{type:Array,default:()=>[]},messagesLoaded:{type:Boolean,default:!1},roomActions:{type:Array,default:()=>[]},menuActions:{type:Array,default:()=>[]},messageActions:{type:Array,default:()=>[{name:"replyMessage",title:"Reply"},{name:"editMessage",title:"Edit Message",onlyMe:!0},{name:"deleteMessage",title:"Delete Message",onlyMe:!0},{name:"selectMessages",title:"Select"}]},messageSelectionActions:{type:Array,default:()=>[]},autoScroll:{type:Object,default:()=>({send:{new:!0,newAfterScrollUp:!0},receive:{new:!0,newAfterScrollUp:!1}})},showSearch:{type:Boolean,default:!0},showAddRoom:{type:Boolean,default:!0},showSendIcon:{type:Boolean,default:!0},showFiles:{type:Boolean,default:!0},showAudio:{type:Boolean,default:!0},audioBitRate:{type:Number,default:128},audioSampleRate:{type:Number,default:44100},showEmojis:{type:Boolean,default:!0},showReactionEmojis:{type:Boolean,default:!0},showNewMessagesDivider:{type:Boolean,default:!0},showFooter:{type:Boolean,default:!0},textFormatting:{type:Object,default:()=>({disabled:!1,italic:"_",bold:"*",strike:"~",underline:"\xB0",multilineCode:"```",inlineCode:"`"})},linkOptions:{type:Object,default:()=>({disabled:!1,target:"_blank",rel:null})},roomInfoEnabled:{type:Boolean,default:!1},textareaActionEnabled:{type:Boolean,default:!1},textareaAutoFocus:{type:Boolean,default:!0},userTagsEnabled:{type:Boolean,default:!0},emojisSuggestionEnabled:{type:Boolean,default:!0},roomMessage:{type:String,default:""},scrollDistance:{type:Number,default:60},acceptedFiles:{type:String,default:"*"},templatesText:{type:Array,default:null},mediaPreviewEnabled:{type:Boolean,default:!0},usernameOptions:{type:Object,default:()=>({minUsers:3,currentUser:!1})}},emits:["toggle-rooms-list","room-info","fetch-messages","send-message","edit-message","delete-message","open-file","open-user-tag","open-failed-message","menu-action-handler","message-action-handler","send-message-reaction","typing-message","textarea-action-handler","fetch-more-rooms","add-room","room-action-handler","message-selection-action-handler"],data(){return{room:{},loadingMoreRooms:!1,showRoomsList:!0,isMobile:!1,showMediaPreview:!1,previewFile:{}}},computed:{t(){return{..._f,...this.textMessages}},cssVars(){const e=pf[this.theme],t={};return Object.keys(e).map(a=>{t[a]={...e[a],...this.styles[a]||{}}}),vf(t)},orderedRooms(){return this.rooms.slice().sort((e,t)=>{const a=e.index||0,n=t.index||0;return this.roomsOrder==="asc"?a<n?-1:n<a?1:0:a>n?-1:n>a?1:0})}},watch:{rooms:{immediate:!0,deep:!0,handler(e,t){if((!e[0]||!e.find(a=>a.roomId===this.room.roomId))&&(this.showRoomsList=!0),!this.loadingMoreRooms&&this.loadFirstRoom&&e[0]&&(!t||e.length!==t.length))if(this.roomId){const a=e.find(n=>n.roomId===this.roomId)||{};this.fetchRoom({room:a})}else!this.isMobile||this.singleRoom?this.fetchRoom({room:this.orderedRooms[0]}):this.showRoomsList=!0}},loadingRooms(e){e&&(this.room={})},roomId:{immediate:!0,handler(e,t){if(e&&!this.loadingRooms&&this.rooms.length){const a=this.rooms.find(n=>n.roomId===e);this.fetchRoom({room:a})}else t&&!e&&(this.room={})}},room(e){!e||Object.entries(e).length===0||(Ou(e),e.users.forEach(t=>{Lu(t)}))},roomsListOpened(e){this.showRoomsList=e}},created(){this.updateResponsive(),window.addEventListener("resize",e=>{e.isTrusted&&this.updateResponsive()})},methods:{updateResponsive(){this.isMobile=window.innerWidth<this.responsiveBreakpoint},toggleRoomsList(){this.showRoomsList=!this.showRoomsList,this.isMobile&&(this.room={}),this.$emit("toggle-rooms-list",{opened:this.showRoomsList})},fetchRoom({room:e}){this.room=e,this.fetchMessages({reset:!0}),this.isMobile&&(this.showRoomsList=!1)},fetchMoreRooms(){this.$emit("fetch-more-rooms")},roomInfo(){this.$emit("room-info",this.room)},addRoom(){this.$emit("add-room")},fetchMessages(e){this.$emit("fetch-messages",{room:this.room,options:e})},sendMessage(e){this.$emit("send-message",{...e,roomId:this.room.roomId})},editMessage(e){this.$emit("edit-message",{...e,roomId:this.room.roomId})},deleteMessage(e){this.$emit("delete-message",{message:e,roomId:this.room.roomId})},openFile({message:e,file:t}){this.mediaPreviewEnabled&&t.action==="preview"?(this.previewFile=t.file,this.showMediaPreview=!0):this.$emit("open-file",{message:e,file:t})},openUserTag({user:e}){this.$emit("open-user-tag",{user:e})},openFailedMessage({message:e}){this.$emit("open-failed-message",{message:e,roomId:this.room.roomId})},menuActionHandler(e){this.$emit("menu-action-handler",{action:e,roomId:this.room.roomId})},roomActionHandler({action:e,roomId:t}){this.$emit("room-action-handler",{action:e,roomId:t})},messageActionHandler(e){this.$emit("message-action-handler",{...e,roomId:this.room.roomId})},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",{...e,roomId:this.room.roomId})},sendMessageReaction(e){this.$emit("send-message-reaction",{...e,roomId:this.room.roomId})},typingMessage(e){this.$emit("typing-message",{message:e,roomId:this.room.roomId})},textareaActionHandler(e){this.$emit("textarea-action-handler",{message:e,roomId:this.room.roomId})}}},yf={class:"vac-chat-container"};function xf(e,t,a,n,m,s){const S=r.resolveComponent("rooms-list"),A=r.resolveComponent("room"),O=r.resolveComponent("media-preview");return r.openBlock(),r.createElementBlock("div",{class:"vac-card-window",style:r.normalizeStyle([{height:a.height},s.cssVars])},[r.createElementVNode("div",yf,[a.singleRoom?r.createCommentVNode("",!0):(r.openBlock(),r.createBlock(S,{key:0,"current-user-id":a.currentUserId,rooms:s.orderedRooms,"loading-rooms":a.loadingRooms,"rooms-loaded":a.roomsLoaded,room:m.room,"room-actions":a.roomActions,"text-messages":s.t,"show-search":a.showSearch,"show-add-room":a.showAddRoom,"show-rooms-list":m.showRoomsList,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"is-mobile":m.isMobile,"scroll-distance":a.scrollDistance,onFetchRoom:s.fetchRoom,onFetchMoreRooms:s.fetchMoreRooms,onLoadingMoreRooms:t[0]||(t[0]=v=>m.loadingMoreRooms=v),onAddRoom:s.addRoom,onRoomActionHandler:s.roomActionHandler},r.createSlots({_:2},[r.renderList(e.$slots,(v,N)=>({name:N,fn:r.withCtx(f=>[r.renderSlot(e.$slots,N,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["current-user-id","rooms","loading-rooms","rooms-loaded","room","room-actions","text-messages","show-search","show-add-room","show-rooms-list","text-formatting","link-options","is-mobile","scroll-distance","onFetchRoom","onFetchMoreRooms","onAddRoom","onRoomActionHandler"])),r.createVNode(A,{"current-user-id":a.currentUserId,rooms:a.rooms,"room-id":m.room.roomId||"","load-first-room":a.loadFirstRoom,messages:a.messages,"room-message":a.roomMessage,"messages-loaded":a.messagesLoaded,"menu-actions":a.menuActions,"message-actions":a.messageActions,"message-selection-actions":a.messageSelectionActions,"auto-scroll":a.autoScroll,"show-send-icon":a.showSendIcon,"show-files":a.showFiles,"show-audio":a.showAudio,"audio-bit-rate":a.audioBitRate,"audio-sample-rate":a.audioSampleRate,"show-emojis":a.showEmojis,"show-reaction-emojis":a.showReactionEmojis,"show-new-messages-divider":a.showNewMessagesDivider,"show-footer":a.showFooter,"text-messages":s.t,"single-room":a.singleRoom,"show-rooms-list":m.showRoomsList,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"is-mobile":m.isMobile,"loading-rooms":a.loadingRooms,"room-info-enabled":a.roomInfoEnabled,"textarea-action-enabled":a.textareaActionEnabled,"textarea-auto-focus":a.textareaAutoFocus,"user-tags-enabled":a.userTagsEnabled,"emojis-suggestion-enabled":a.emojisSuggestionEnabled,"scroll-distance":a.scrollDistance,"accepted-files":a.acceptedFiles,"templates-text":a.templatesText,"username-options":a.usernameOptions,onToggleRoomsList:s.toggleRoomsList,onRoomInfo:s.roomInfo,onFetchMessages:s.fetchMessages,onSendMessage:s.sendMessage,onEditMessage:s.editMessage,onDeleteMessage:s.deleteMessage,onOpenFile:s.openFile,onOpenUserTag:s.openUserTag,onOpenFailedMessage:s.openFailedMessage,onMenuActionHandler:s.menuActionHandler,onMessageActionHandler:s.messageActionHandler,onMessageSelectionActionHandler:s.messageSelectionActionHandler,onSendMessageReaction:s.sendMessageReaction,onTypingMessage:s.typingMessage,onTextareaActionHandler:s.textareaActionHandler},r.createSlots({_:2},[r.renderList(e.$slots,(v,N)=>({name:N,fn:r.withCtx(f=>[r.renderSlot(e.$slots,N,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["current-user-id","rooms","room-id","load-first-room","messages","room-message","messages-loaded","menu-actions","message-actions","message-selection-actions","auto-scroll","show-send-icon","show-files","show-audio","audio-bit-rate","audio-sample-rate","show-emojis","show-reaction-emojis","show-new-messages-divider","show-footer","text-messages","single-room","show-rooms-list","text-formatting","link-options","is-mobile","loading-rooms","room-info-enabled","textarea-action-enabled","textarea-auto-focus","user-tags-enabled","emojis-suggestion-enabled","scroll-distance","accepted-files","templates-text","username-options","onToggleRoomsList","onRoomInfo","onFetchMessages","onSendMessage","onEditMessage","onDeleteMessage","onOpenFile","onOpenUserTag","onOpenFailedMessage","onMenuActionHandler","onMessageActionHandler","onMessageSelectionActionHandler","onSendMessageReaction","onTypingMessage","onTextareaActionHandler"])]),r.createVNode(r.Transition,{name:"vac-fade-preview",appear:""},{default:r.withCtx(()=>[m.showMediaPreview?(r.openBlock(),r.createBlock(O,{key:0,file:m.previewFile,onCloseMediaPreview:t[1]||(t[1]=v=>m.showMediaPreview=!1)},null,8,["file"])):r.createCommentVNode("",!0)]),_:1})],4)}var wf=ze(bf,[["render",xf],["styles",[gf]]]);const kf=r.defineCustomElement(wf);customElements.define("chat-window",kf)});
