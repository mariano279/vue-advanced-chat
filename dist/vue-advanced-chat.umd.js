(function(aa,r){typeof exports=="object"&&typeof module!="undefined"?r(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],r):(aa=typeof globalThis!="undefined"?globalThis:aa||self,r(aa["vue-advanced-chat"]={},aa.Vue))})(this,function(aa,r){"use strict";var Ye=(e,t)=>{const a=e.__vccOpts||e;for(const[n,d]of t)a[n]=d;return a};const pi={name:"AppLoader",props:{show:{type:Boolean,default:!1},infinite:{type:Boolean,default:!1},type:{type:String,required:!0},messageId:{type:String,default:""}}},vi=r.createElementVNode("div",{id:"vac-circle"},null,-1),gi=r.createElementVNode("div",{id:"vac-circle"},null,-1),bi=r.createElementVNode("div",{id:"vac-circle"},null,-1),yi=r.createElementVNode("div",{id:"vac-circle"},null,-1),xi=r.createElementVNode("div",{id:"vac-circle"},null,-1),wi=r.createElementVNode("div",{id:"vac-circle"},null,-1);function ki(e,t,a,n,d,o){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-fade-spinner",appear:""},{default:r.withCtx(()=>[a.show?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-loader-wrapper",{"vac-container-center":!a.infinite,"vac-container-top":a.infinite}])},[a.type==="rooms"?r.renderSlot(e.$slots,"spinner-icon-rooms",{key:0},()=>[vi]):r.createCommentVNode("",!0),a.type==="infinite-rooms"?r.renderSlot(e.$slots,"spinner-icon-infinite-rooms",{key:1},()=>[gi]):r.createCommentVNode("",!0),a.type==="message-file"?r.renderSlot(e.$slots,"spinner-icon-message-file_"+a.messageId,{key:2},()=>[bi]):r.createCommentVNode("",!0),a.type==="room-file"?r.renderSlot(e.$slots,"spinner-icon-room-file",{key:3},()=>[yi]):r.createCommentVNode("",!0),a.type==="messages"?r.renderSlot(e.$slots,"spinner-icon-messages",{key:4},()=>[xi]):r.createCommentVNode("",!0),a.type==="infinite-messages"?r.renderSlot(e.$slots,"spinner-icon-infinite-messages",{key:5},()=>[wi]):r.createCommentVNode("",!0)],2)):r.createCommentVNode("",!0)]),_:3})}var Rr=Ye(pi,[["render",ki]]);const Si={name:"SvgIcon",props:{name:{type:String,default:null},param:{type:String,default:null}},data(){return{svgItem:{search:{path:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"},add:{path:"M17,13H13V17H11V13H7V11H11V7H13V11H17M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"},toggle:{path:"M5,13L9,17L7.6,18.42L1.18,12L7.6,5.58L9,7L5,11H21V13H5M21,6V8H11V6H21M21,16V18H11V16H21Z"},menu:{path:"M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z"},close:{path:"M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z"},file:{path:"M14,17H7V15H14M17,13H7V11H17M17,9H7V7H17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z"},paperclip:{path:"M16.5,6V17.5A4,4 0 0,1 12.5,21.5A4,4 0 0,1 8.5,17.5V5A2.5,2.5 0 0,1 11,2.5A2.5,2.5 0 0,1 13.5,5V15.5A1,1 0 0,1 12.5,16.5A1,1 0 0,1 11.5,15.5V6H10V15.5A2.5,2.5 0 0,0 12.5,18A2.5,2.5 0 0,0 15,15.5V5A4,4 0 0,0 11,1A4,4 0 0,0 7,5V17.5A5.5,5.5 0 0,0 12.5,23A5.5,5.5 0 0,0 18,17.5V6H16.5Z"},"close-outline":{path:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},send:{path:"M2,21L23,12L2,3V10L17,12L2,14V21Z"},emoji:{path:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"},document:{path:"M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"},pencil:{path:"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"},checkmark:{path:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"},"double-checkmark":{path:"M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z"},eye:{path:"M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"},dropdown:{path:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"},deleted:{path:"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12C4,13.85 4.63,15.55 5.68,16.91L16.91,5.68C15.55,4.63 13.85,4 12,4M12,20A8,8 0 0,0 20,12C20,10.15 19.37,8.45 18.32,7.09L7.09,18.32C8.45,19.37 10.15,20 12,20Z"},microphone:{size:"large",path:"M432.8,216.4v39.2c0,45.2-15.3,84.3-45.2,118.4c-29.8,33.2-67.3,52.8-111.6,57.9v40.9h78.4c5.1,0,10.2,1.7,13.6,6c4.3,4.3,6,8.5,6,13.6c0,5.1-1.7,10.2-6,13.6c-4.3,4.3-8.5,6-13.6,6H157.6c-5.1,0-10.2-1.7-13.6-6c-4.3-4.3-6-8.5-6-13.6c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6H236v-40.9c-44.3-5.1-81.8-23.9-111.6-57.9s-45.2-73.3-45.2-118.4v-39.2c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6s10.2,1.7,13.6,6c4.3,4.3,6,8.5,6,13.6v39.2c0,37.5,13.6,70.7,40,97.1s59.6,40,97.1,40s70.7-13.6,97.1-40c26.4-26.4,40-59.6,40-97.1v-39.2c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6c5.1,0,10.2,1.7,13.6,6C430.2,206.2,432.8,211.3,432.8,216.4z M353.5,98v157.6c0,27.3-9.4,50.3-29,69c-19.6,19.6-42.6,29-69,29s-50.3-9.4-69-29c-19.6-19.6-29-42.6-29-69V98c0-27.3,9.4-50.3,29-69c19.6-19.6,42.6-29,69-29s50.3,9.4,69,29C344.2,47.7,353.5,71.6,353.5,98z"},"audio-play":{size:"medium",path:"M43.331,21.237L7.233,0.397c-0.917-0.529-2.044-0.529-2.96,0c-0.916,0.528-1.48,1.505-1.48,2.563v41.684   c0,1.058,0.564,2.035,1.48,2.563c0.458,0.268,0.969,0.397,1.48,0.397c0.511,0,1.022-0.133,1.48-0.397l36.098-20.84   c0.918-0.529,1.479-1.506,1.479-2.564S44.247,21.767,43.331,21.237z"},"audio-pause":{size:"medium",path:"M17.991,40.976c0,3.662-2.969,6.631-6.631,6.631l0,0c-3.662,0-6.631-2.969-6.631-6.631V6.631C4.729,2.969,7.698,0,11.36,0l0,0c3.662,0,6.631,2.969,6.631,6.631V40.976z",path2:"M42.877,40.976c0,3.662-2.969,6.631-6.631,6.631l0,0c-3.662,0-6.631-2.969-6.631-6.631V6.631C29.616,2.969,32.585,0,36.246,0l0,0c3.662,0,6.631,2.969,6.631,6.631V40.976z"}}}},computed:{svgId(){const e=this.param?"-"+this.param:"";return`vac-icon-${this.name}${e}`},size(){const e=this.svgItem[this.name];return e.size==="large"?512:e.size==="medium"?48:24}}},Ei=["viewBox"],Mi=["id","d"],Ri=["id","d"];function Ai(e,t,a,n,d,o){return r.openBlock(),r.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",width:"24",height:"24",viewBox:`0 0 ${o.size} ${o.size}`},[r.createElementVNode("path",{id:o.svgId,d:d.svgItem[a.name].path},null,8,Mi),d.svgItem[a.name].path2?(r.openBlock(),r.createElementBlock("path",{key:0,id:o.svgId,d:d.svgItem[a.name].path2},null,8,Ri)):r.createCommentVNode("",!0)],8,Ei)}var mt=Ye(Si,[["render",Ai]]);const Ti={name:"RoomsSearch",components:{SvgIcon:mt},props:{textMessages:{type:Object,required:!0},showSearch:{type:Boolean,required:!0},showAddRoom:{type:Boolean,required:!0},rooms:{type:Array,required:!0},loadingRooms:{type:Boolean,required:!0}},emits:["search-room","add-room"],computed:{showSearchBar(){return this.showSearch||this.showAddRoom}}},Bi={key:0,class:"vac-icon-search"},Ci=["placeholder"];function Oi(e,t,a,n,d,o){const k=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",{class:r.normalizeClass({"vac-box-search":o.showSearchBar,"vac-box-empty":!o.showSearchBar})},[a.showSearch?(r.openBlock(),r.createElementBlock(r.Fragment,{key:0},[!a.loadingRooms&&a.rooms.length?(r.openBlock(),r.createElementBlock("div",Bi,[r.renderSlot(e.$slots,"search-icon",{},()=>[r.createVNode(k,{name:"search"})])])):r.createCommentVNode("",!0),!a.loadingRooms&&a.rooms.length?(r.openBlock(),r.createElementBlock("input",{key:1,type:"search",placeholder:a.textMessages.SEARCH,autocomplete:"off",class:"vac-input",onInput:t[0]||(t[0]=C=>e.$emit("search-room",C))},null,40,Ci)):r.createCommentVNode("",!0)],64)):r.createCommentVNode("",!0),a.showAddRoom?(r.openBlock(),r.createElementBlock("div",{key:1,class:"vac-svg-button vac-add-icon",onClick:t[1]||(t[1]=C=>e.$emit("add-room"))},[r.renderSlot(e.$slots,"add-icon",{},()=>[r.createVNode(k,{name:"add"})])])):r.createCommentVNode("",!0)],2)}var Ni=Ye(Ti,[["render",Oi]]),ht={},Ta={};Ta.__esModule=!0,Ta.inherits=Li;function Li(e,t){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=Object.create(e.prototype);for(var d in a)n[d]=a[d];return n.constructor=t,t.prototype=n,t}var qa={};qa.__esModule=!0;var Ii=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},At={defaultProtocol:"http",events:null,format:lo,formatHref:lo,nl2br:!1,tagName:"a",target:Vi,validate:!0,ignoreTags:[],attributes:null,className:"linkified"};qa.defaults=At,qa.Options=io,qa.contains=ji;function io(e){e=e||{},this.defaultProtocol=e.hasOwnProperty("defaultProtocol")?e.defaultProtocol:At.defaultProtocol,this.events=e.hasOwnProperty("events")?e.events:At.events,this.format=e.hasOwnProperty("format")?e.format:At.format,this.formatHref=e.hasOwnProperty("formatHref")?e.formatHref:At.formatHref,this.nl2br=e.hasOwnProperty("nl2br")?e.nl2br:At.nl2br,this.tagName=e.hasOwnProperty("tagName")?e.tagName:At.tagName,this.target=e.hasOwnProperty("target")?e.target:At.target,this.validate=e.hasOwnProperty("validate")?e.validate:At.validate,this.ignoreTags=[],this.attributes=e.attributes||e.linkAttributes||At.attributes,this.className=e.hasOwnProperty("className")?e.className:e.linkClass||At.className;for(var t=e.hasOwnProperty("ignoreTags")?e.ignoreTags:At.ignoreTags,a=0;a<t.length;a++)this.ignoreTags.push(t[a].toUpperCase())}io.prototype={resolve:function(t){var a=t.toHref(this.defaultProtocol);return{formatted:this.get("format",t.toString(),t),formattedHref:this.get("formatHref",a,t),tagName:this.get("tagName",a,t),className:this.get("className",a,t),target:this.get("target",a,t),events:this.getObject("events",a,t),attributes:this.getObject("attributes",a,t)}},check:function(t){return this.get("validate",t.toString(),t)},get:function(t,a,n){var d=void 0,o=this[t];if(!o)return o;switch(typeof o=="undefined"?"undefined":Ii(o)){case"function":return o(a,n.type);case"object":return d=o.hasOwnProperty(n.type)?o[n.type]:At[t],typeof d=="function"?d(a,n.type):d}return o},getObject:function(t,a,n){var d=this[t];return typeof d=="function"?d(a,n.type):d}};function ji(e,t){for(var a=0;a<e.length;a++)if(e[a]===t)return!0;return!1}function lo(e){return e}function Vi(e,t){return t==="url"?"_blank":null}var Yt={},$t={};$t.__esModule=!0,$t.stateify=$t.TokenState=$t.CharacterState=void 0;var co=Ta;function ds(){return function(e){this.j=[],this.T=e||null}}var ms=ds();ms.prototype={defaultTransition:!1,on:function(t,a){if(t instanceof Array){for(var n=0;n<t.length;n++)this.j.push([t[n],a]);return this}return this.j.push([t,a]),this},next:function(t){for(var a=0;a<this.j.length;a++){var n=this.j[a],d=n[0],o=n[1];if(this.test(t,d))return o}return this.defaultTransition},accepts:function(){return!!this.T},test:function(t,a){return t===a},emit:function(){return this.T}};var hs=(0,co.inherits)(ms,ds(),{test:function(t,a){return t===a||a instanceof RegExp&&a.test(t)}}),Hi=(0,co.inherits)(ms,ds(),{jump:function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=this.next(new t(""));return n===this.defaultTransition?(n=new this.constructor(a),this.on(t,n)):a&&(n.T=a),n},test:function(t,a){return t instanceof a}});function Pi(e,t,a,n){for(var d=0,o=e.length,k=t,C=[],L=void 0;d<o&&(L=k.next(e[d]));)k=L,d++;if(d>=o)return[];for(;d<o-1;)L=new hs(n),C.push(L),k.on(e[d],L),k=L,d++;return L=new hs(a),C.push(L),k.on(e[o-1],L),C}$t.CharacterState=hs,$t.TokenState=Hi,$t.stateify=Pi;var we={},Ar={};Ar.__esModule=!0;function Fi(){return function(e){e&&(this.v=e)}}Ar.createTokenClass=Fi,we.__esModule=!0,we.AMPERSAND=we.CLOSEPAREN=we.CLOSEANGLEBRACKET=we.CLOSEBRACKET=we.CLOSEBRACE=we.OPENPAREN=we.OPENANGLEBRACKET=we.OPENBRACKET=we.OPENBRACE=we.WS=we.TLD=we.SYM=we.UNDERSCORE=we.SLASH=we.MAILTO=we.PROTOCOL=we.QUERY=we.POUND=we.PLUS=we.NUM=we.NL=we.LOCALHOST=we.PUNCTUATION=we.DOT=we.COLON=we.AT=we.DOMAIN=we.Base=void 0;var mo=Ar,Di=Ta,us=(0,mo.createTokenClass)();us.prototype={toString:function(){return this.v+""}};function Xe(e){var t=e?{v:e}:{};return(0,Di.inherits)(us,(0,mo.createTokenClass)(),t)}var Ui=Xe(),zi=Xe("@"),qi=Xe(":"),Yi=Xe("."),Xi=Xe(),Gi=Xe(),Ki=Xe(`
`),Zi=Xe(),Wi=Xe("+"),Qi=Xe("#"),Ji=Xe(),$i=Xe("mailto:"),el=Xe("?"),tl=Xe("/"),al=Xe("_"),rl=Xe(),sl=Xe(),ol=Xe(),nl=Xe("{"),il=Xe("["),ll=Xe("<"),cl=Xe("("),dl=Xe("}"),ml=Xe("]"),hl=Xe(">"),ul=Xe(")"),fl=Xe("&");we.Base=us,we.DOMAIN=Ui,we.AT=zi,we.COLON=qi,we.DOT=Yi,we.PUNCTUATION=Xi,we.LOCALHOST=Gi,we.NL=Ki,we.NUM=Zi,we.PLUS=Wi,we.POUND=Qi,we.QUERY=el,we.PROTOCOL=Ji,we.MAILTO=$i,we.SLASH=tl,we.UNDERSCORE=al,we.SYM=rl,we.TLD=sl,we.WS=ol,we.OPENBRACE=nl,we.OPENBRACKET=il,we.OPENANGLEBRACKET=ll,we.OPENPAREN=cl,we.CLOSEBRACE=dl,we.CLOSEBRACKET=ml,we.CLOSEANGLEBRACKET=hl,we.CLOSEPAREN=ul,we.AMPERSAND=fl,Yt.__esModule=!0,Yt.start=Yt.run=Yt.TOKENS=Yt.State=void 0;var ra=$t,Le=we,_l=pl(Le);function pl(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}var ho="aaa|aarp|abarth|abb|abbott|abbvie|abc|able|abogado|abudhabi|ac|academy|accenture|accountant|accountants|aco|active|actor|ad|adac|ads|adult|ae|aeg|aero|aetna|af|afamilycompany|afl|africa|ag|agakhan|agency|ai|aig|aigo|airbus|airforce|airtel|akdn|al|alfaromeo|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|am|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|ao|aol|apartments|app|apple|aq|aquarelle|ar|arab|aramco|archi|army|arpa|art|arte|as|asda|asia|associates|at|athleta|attorney|au|auction|audi|audible|audio|auspost|author|auto|autos|avianca|aw|aws|ax|axa|az|azure|ba|baby|baidu|banamex|bananarepublic|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bb|bbc|bbt|bbva|bcg|bcn|bd|be|beats|beauty|beer|bentley|berlin|best|bestbuy|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|blanco|blockbuster|blog|bloomberg|blue|bm|bms|bmw|bn|bnl|bnpparibas|bo|boats|boehringer|bofa|bom|bond|boo|book|booking|boots|bosch|bostik|boston|bot|boutique|box|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|budapest|bugatti|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|calvinklein|cam|camera|camp|cancerresearch|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|cartier|casa|case|caseih|cash|casino|cat|catering|catholic|cba|cbn|cbre|cbs|cc|cd|ceb|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|chase|chat|cheap|chintai|chloe|christmas|chrome|chrysler|church|ci|cipriani|circle|cisco|citadel|citi|citic|city|cityeats|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|comcast|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cookingchannel|cool|coop|corsica|country|coupon|coupons|courses|cr|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|csc|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|data|date|dating|datsun|day|dclk|dds|de|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dj|dk|dm|dnp|do|docs|doctor|dodge|dog|doha|domains|dot|download|drive|dtv|dubai|duck|dunlop|duns|dupont|durban|dvag|dvr|dz|earth|eat|ec|eco|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epost|epson|equipment|er|ericsson|erni|es|esq|estate|esurance|et|etisalat|eu|eurovision|eus|events|everbank|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fi|fiat|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|flir|florist|flowers|fly|fm|fo|foo|food|foodnetwork|football|ford|forex|forsale|forum|foundation|fox|fr|free|fresenius|frl|frogans|frontdoor|frontier|ftr|fujitsu|fujixerox|fun|fund|furniture|futbol|fyi|ga|gal|gallery|gallo|gallup|game|games|gap|garden|gb|gbiz|gd|gdn|ge|gea|gent|genting|george|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glade|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|godaddy|gold|goldpoint|golf|goo|goodhands|goodyear|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|grocery|group|gs|gt|gu|guardian|gucci|guge|guide|guitars|guru|gw|gy|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hgtv|hiphop|hisamitsu|hitachi|hiv|hk|hkt|hm|hn|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|honeywell|horse|hospital|host|hosting|hot|hoteles|hotels|hotmail|house|how|hr|hsbc|ht|htc|hu|hughes|hyatt|hyundai|ibm|icbc|ice|icu|id|ie|ieee|ifm|ikano|il|im|imamat|imdb|immo|immobilien|in|industries|infiniti|info|ing|ink|institute|insurance|insure|int|intel|international|intuit|investments|io|ipiranga|iq|ir|irish|is|iselect|ismaili|ist|istanbul|it|itau|itv|iveco|iwc|jaguar|java|jcb|jcp|je|jeep|jetzt|jewelry|jio|jlc|jll|jm|jmp|jnj|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|juniper|kaufen|kddi|ke|kerryhotels|kerrylogistics|kerryproperties|kfh|kg|kh|ki|kia|kim|kinder|kindle|kitchen|kiwi|km|kn|koeln|komatsu|kosher|kp|kpmg|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|ladbrokes|lamborghini|lamer|lancaster|lancia|lancome|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|li|liaison|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|linde|link|lipsy|live|living|lixil|lk|loan|loans|locker|locus|loft|lol|london|lotte|lotto|love|lpl|lplfinancial|lr|ls|lt|ltd|ltda|lu|lundbeck|lupin|luxe|luxury|lv|ly|ma|macys|madrid|maif|maison|makeup|man|management|mango|map|market|marketing|markets|marriott|marshalls|maserati|mattel|mba|mc|mckinsey|md|me|med|media|meet|melbourne|meme|memorial|men|menu|meo|merckmsd|metlife|mg|mh|miami|microsoft|mil|mini|mint|mit|mitsubishi|mk|ml|mlb|mls|mm|mma|mn|mo|mobi|mobile|mobily|moda|moe|moi|mom|monash|money|monster|mopar|mormon|mortgage|moscow|moto|motorcycles|mov|movie|movistar|mp|mq|mr|ms|msd|mt|mtn|mtr|mu|museum|mutual|mv|mw|mx|my|mz|na|nab|nadex|nagoya|name|nationwide|natura|navy|nba|nc|ne|nec|net|netbank|netflix|network|neustar|new|newholland|news|next|nextdirect|nexus|nf|nfl|ng|ngo|nhk|ni|nico|nike|nikon|ninja|nissan|nissay|nl|no|nokia|northwesternmutual|norton|now|nowruz|nowtv|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|observer|off|office|okinawa|olayan|olayangroup|oldnavy|ollo|om|omega|one|ong|onl|online|onyourside|ooo|open|oracle|orange|org|organic|origins|osaka|otsuka|ott|ovh|pa|page|panasonic|panerai|paris|pars|partners|parts|party|passagens|pay|pccw|pe|pet|pf|pfizer|pg|ph|pharmacy|phd|philips|phone|photo|photography|photos|physio|piaget|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pnc|pohl|poker|politie|porn|post|pr|pramerica|praxi|press|prime|pro|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|qvc|racing|radio|raid|re|read|realestate|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|rightathome|ril|rio|rip|rmit|ro|rocher|rocks|rodeo|rogers|room|rs|rsvp|ru|rugby|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sapo|sarl|sas|save|saxo|sb|sbi|sbs|sc|sca|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scjohnson|scor|scot|sd|se|search|seat|secure|security|seek|select|sener|services|ses|seven|sew|sex|sexy|sfr|sg|sh|shangrila|sharp|shaw|shell|shia|shiksha|shoes|shop|shopping|shouji|show|showtime|shriram|si|silk|sina|singles|site|sj|sk|ski|skin|sky|skype|sl|sling|sm|smart|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|space|spiegel|spot|spreadbetting|sr|srl|srt|st|stada|staples|star|starhub|statebank|statefarm|statoil|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiftcover|swiss|sx|sy|sydney|symantec|systems|sz|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|tdk|team|tech|technology|tel|telecity|telefonica|temasek|tennis|teva|tf|tg|th|thd|theater|theatre|tiaa|tickets|tienda|tiffany|tips|tires|tirol|tj|tjmaxx|tjx|tk|tkmaxx|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tr|trade|trading|training|travel|travelchannel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubank|ubs|uconnect|ug|uk|unicom|university|uno|uol|ups|us|uy|uz|va|vacations|vana|vanguard|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|vista|vistaprint|viva|vivo|vlaanderen|vn|vodka|volkswagen|volvo|vote|voting|voto|voyage|vu|vuelos|wales|walmart|walter|wang|wanggou|warman|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|ws|wtc|wtf|xbox|xerox|xfinity|xihuan|xin|xn--11b4c3d|xn--1ck2e1b|xn--1qqw23a|xn--2scrj9c|xn--30rr7y|xn--3bst00m|xn--3ds443g|xn--3e0b707e|xn--3hcrj9c|xn--3oq18vl8pn36a|xn--3pxu8k|xn--42c2d9a|xn--45br5cyl|xn--45brj9c|xn--45q11c|xn--4gbrim|xn--54b7fta0cc|xn--55qw42g|xn--55qx5d|xn--5su34j936bgsg|xn--5tzm5g|xn--6frz82g|xn--6qq986b3xl|xn--80adxhks|xn--80ao21a|xn--80aqecdr1a|xn--80asehdb|xn--80aswg|xn--8y0a063a|xn--90a3ac|xn--90ae|xn--90ais|xn--9dbq2a|xn--9et52u|xn--9krt00a|xn--b4w605ferd|xn--bck1b9a5dre4c|xn--c1avg|xn--c2br7g|xn--cck2b3b|xn--cg4bki|xn--clchc0ea0b2g2a9gcd|xn--czr694b|xn--czrs0t|xn--czru2d|xn--d1acj3b|xn--d1alf|xn--e1a4c|xn--eckvdtc9d|xn--efvy88h|xn--estv75g|xn--fct429k|xn--fhbei|xn--fiq228c5hs|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--fjq720a|xn--flw351e|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--fzys8d69uvgm|xn--g2xx48c|xn--gckr3f0f|xn--gecrj9c|xn--gk3at1e|xn--h2breg3eve|xn--h2brj9c|xn--h2brj9c8c|xn--hxt814e|xn--i1b6b1a6a2e|xn--imr513n|xn--io0a7i|xn--j1aef|xn--j1amh|xn--j6w193g|xn--jlq61u9w7b|xn--jvr189m|xn--kcrx77d1x4a|xn--kprw13d|xn--kpry57d|xn--kpu716f|xn--kput3i|xn--l1acc|xn--lgbbat1ad8j|xn--mgb9awbf|xn--mgba3a3ejt|xn--mgba3a4f16a|xn--mgba7c0bbn0a|xn--mgbaakc7dvf|xn--mgbaam7a8h|xn--mgbab2bd|xn--mgbai9azgqp6j|xn--mgbayh7gpa|xn--mgbb9fbpob|xn--mgbbh1a|xn--mgbbh1a71e|xn--mgbc0a9azcg|xn--mgbca7dzdo|xn--mgberp4a5d4ar|xn--mgbgu82a|xn--mgbi4ecexp|xn--mgbpl2fh|xn--mgbt3dhd|xn--mgbtx2b|xn--mgbx4cd0ab|xn--mix891f|xn--mk1bu44c|xn--mxtq1m|xn--ngbc5azd|xn--ngbe9e0a|xn--ngbrx|xn--node|xn--nqv7f|xn--nqv7fs00ema|xn--nyqy26a|xn--o3cw4h|xn--ogbpf8fl|xn--p1acf|xn--p1ai|xn--pbt977c|xn--pgbs0dh|xn--pssy2u|xn--q9jyb4c|xn--qcka1pmc|xn--qxam|xn--rhqv96g|xn--rovu88b|xn--rvc1e0am3e|xn--s9brj9c|xn--ses554g|xn--t60b56a|xn--tckwe|xn--tiq49xqyj|xn--unup4y|xn--vermgensberater-ctb|xn--vermgensberatung-pwb|xn--vhquv|xn--vuq861b|xn--w4r85el8fhu5dnra|xn--w4rs40l|xn--wgbh1c|xn--wgbl6a|xn--xhq521b|xn--xkc2al3hye2a|xn--xkc2dl3a5ee0h|xn--y9a3aq|xn--yfro4i67o|xn--ygbi2ammx|xn--zfr164b|xperia|xxx|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|you|youtube|yt|yun|za|zappos|zara|zero|zip|zippo|zm|zone|zuerich|zw".split("|"),fs="0123456789".split(""),Tr="0123456789abcdefghijklmnopqrstuvwxyz".split(""),uo=[" ","\f","\r","	","\v","\xA0","\u1680","\u180E"],yt=[],ze=function(t){return new ra.CharacterState(t)},Lt=ze(),_s=ze(Le.NUM),Ba=ze(Le.DOMAIN),Ya=ze(),ps=ze(Le.WS);Lt.on("@",ze(Le.AT)).on(".",ze(Le.DOT)).on("+",ze(Le.PLUS)).on("#",ze(Le.POUND)).on("?",ze(Le.QUERY)).on("/",ze(Le.SLASH)).on("_",ze(Le.UNDERSCORE)).on(":",ze(Le.COLON)).on("{",ze(Le.OPENBRACE)).on("[",ze(Le.OPENBRACKET)).on("<",ze(Le.OPENANGLEBRACKET)).on("(",ze(Le.OPENPAREN)).on("}",ze(Le.CLOSEBRACE)).on("]",ze(Le.CLOSEBRACKET)).on(">",ze(Le.CLOSEANGLEBRACKET)).on(")",ze(Le.CLOSEPAREN)).on("&",ze(Le.AMPERSAND)).on([",",";","!",'"',"'"],ze(Le.PUNCTUATION)),Lt.on(`
`,ze(Le.NL)).on(uo,ps),ps.on(uo,ps);for(var vs=0;vs<ho.length;vs++){var vl=(0,ra.stateify)(ho[vs],Lt,Le.TLD,Le.DOMAIN);yt.push.apply(yt,vl)}var fo=(0,ra.stateify)("file",Lt,Le.DOMAIN,Le.DOMAIN),_o=(0,ra.stateify)("ftp",Lt,Le.DOMAIN,Le.DOMAIN),po=(0,ra.stateify)("http",Lt,Le.DOMAIN,Le.DOMAIN),vo=(0,ra.stateify)("mailto",Lt,Le.DOMAIN,Le.DOMAIN);yt.push.apply(yt,fo),yt.push.apply(yt,_o),yt.push.apply(yt,po),yt.push.apply(yt,vo);var gl=fo.pop(),bl=_o.pop(),yl=po.pop(),xl=vo.pop(),Br=ze(Le.DOMAIN),Cr=ze(Le.PROTOCOL),wl=ze(Le.MAILTO);bl.on("s",Br).on(":",Cr),yl.on("s",Br).on(":",Cr),yt.push(Br),gl.on(":",Cr),Br.on(":",Cr),xl.on(":",wl);var kl=(0,ra.stateify)("localhost",Lt,Le.LOCALHOST,Le.DOMAIN);yt.push.apply(yt,kl),Lt.on(fs,_s),_s.on("-",Ya).on(fs,_s).on(Tr,Ba),Ba.on("-",Ya).on(Tr,Ba);for(var gs=0;gs<yt.length;gs++)yt[gs].on("-",Ya).on(Tr,Ba);Ya.on("-",Ya).on(fs,Ba).on(Tr,Ba),Lt.defaultTransition=ze(Le.SYM);var Sl=function(t){for(var a=t.replace(/[A-Z]/g,function(R){return R.toLowerCase()}),n=t.length,d=[],o=0;o<n;){for(var k=Lt,C=null,L=0,b=null,E=-1;o<n&&(C=k.next(a[o]));)k=C,k.accepts()?(E=0,b=k):E>=0&&E++,L++,o++;if(!(E<0)){o-=E,L-=E;var h=b.emit();d.push(new h(t.substr(o-L,L)))}}return d},El=Lt;Yt.State=ra.CharacterState,Yt.TOKENS=_l,Yt.run=Sl,Yt.start=El;var Xt={},xt={};xt.__esModule=!0,xt.URL=xt.TEXT=xt.NL=xt.EMAIL=xt.MAILTOEMAIL=xt.Base=void 0;var Ca=Ar,Xa=Ta,Ga=we;function Ml(e){return e instanceof Ga.DOMAIN||e instanceof Ga.TLD}var ma=(0,Ca.createTokenClass)();ma.prototype={type:"token",isLink:!1,toString:function(){for(var t=[],a=0;a<this.v.length;a++)t.push(this.v[a].toString());return t.join("")},toHref:function(){return this.toString()},toObject:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http";return{type:this.type,value:this.toString(),href:this.toHref(t)}}};var Rl=(0,Xa.inherits)(ma,(0,Ca.createTokenClass)(),{type:"email",isLink:!0}),Al=(0,Xa.inherits)(ma,(0,Ca.createTokenClass)(),{type:"email",isLink:!0,toHref:function(){return"mailto:"+this.toString()}}),Tl=(0,Xa.inherits)(ma,(0,Ca.createTokenClass)(),{type:"text"}),Bl=(0,Xa.inherits)(ma,(0,Ca.createTokenClass)(),{type:"nl"}),Cl=(0,Xa.inherits)(ma,(0,Ca.createTokenClass)(),{type:"url",isLink:!0,toHref:function(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http",a=!1,n=!1,d=this.v,o=[],k=0;d[k]instanceof Ga.PROTOCOL;)a=!0,o.push(d[k].toString().toLowerCase()),k++;for(;d[k]instanceof Ga.SLASH;)n=!0,o.push(d[k].toString()),k++;for(;Ml(d[k]);)o.push(d[k].toString().toLowerCase()),k++;for(;k<d.length;k++)o.push(d[k].toString());return o=o.join(""),a||n||(o=t+"://"+o),o},hasProtocol:function(){return this.v[0]instanceof Ga.PROTOCOL}});xt.Base=ma,xt.MAILTOEMAIL=Rl,xt.EMAIL=Al,xt.NL=Bl,xt.TEXT=Tl,xt.URL=Cl,Xt.__esModule=!0,Xt.start=Xt.run=Xt.TOKENS=Xt.State=void 0;var go=$t,wt=xt,Ol=Nl(wt),me=we;function Nl(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}var Ie=function(t){return new go.TokenState(t)},Or=Ie(),bo=Ie(),yo=Ie(),bs=Ie(),xo=Ie(),sa=Ie(),Nr=Ie(),Ka=Ie(wt.URL),wo=Ie(),ko=Ie(wt.URL),et=Ie(wt.URL),Za=Ie(),Wa=Ie(),Qa=Ie(),Ja=Ie(),$a=Ie(),ha=Ie(wt.URL),ua=Ie(wt.URL),fa=Ie(wt.URL),_a=Ie(wt.URL),er=Ie(),tr=Ie(),ar=Ie(),rr=Ie(),Oa=Ie(),ys=Ie(),Lr=Ie(wt.EMAIL),So=Ie(),Ll=Ie(wt.EMAIL),pa=Ie(wt.MAILTOEMAIL),xs=Ie(),Na=Ie(),Ir=Ie(),Eo=Ie(),Il=Ie(wt.NL);Or.on(me.NL,Il).on(me.PROTOCOL,bo).on(me.MAILTO,yo).on(me.SLASH,bs),bo.on(me.SLASH,bs),bs.on(me.SLASH,xo),Or.on(me.TLD,sa).on(me.DOMAIN,sa).on(me.LOCALHOST,Ka).on(me.NUM,sa),xo.on(me.TLD,et).on(me.DOMAIN,et).on(me.NUM,et).on(me.LOCALHOST,et),sa.on(me.DOT,Nr),Oa.on(me.DOT,ys),Nr.on(me.TLD,Ka).on(me.DOMAIN,sa).on(me.NUM,sa).on(me.LOCALHOST,sa),ys.on(me.TLD,Lr).on(me.DOMAIN,Oa).on(me.NUM,Oa).on(me.LOCALHOST,Oa),Ka.on(me.DOT,Nr),Lr.on(me.DOT,ys),Ka.on(me.COLON,wo).on(me.SLASH,et),wo.on(me.NUM,ko),ko.on(me.SLASH,et),Lr.on(me.COLON,So),So.on(me.NUM,Ll);var ut=[me.DOMAIN,me.AT,me.LOCALHOST,me.NUM,me.PLUS,me.POUND,me.PROTOCOL,me.SLASH,me.TLD,me.UNDERSCORE,me.SYM,me.AMPERSAND],ft=[me.COLON,me.DOT,me.QUERY,me.PUNCTUATION,me.CLOSEBRACE,me.CLOSEBRACKET,me.CLOSEANGLEBRACKET,me.CLOSEPAREN,me.OPENBRACE,me.OPENBRACKET,me.OPENANGLEBRACKET,me.OPENPAREN];et.on(me.OPENBRACE,Wa).on(me.OPENBRACKET,Qa).on(me.OPENANGLEBRACKET,Ja).on(me.OPENPAREN,$a),Za.on(me.OPENBRACE,Wa).on(me.OPENBRACKET,Qa).on(me.OPENANGLEBRACKET,Ja).on(me.OPENPAREN,$a),Wa.on(me.CLOSEBRACE,et),Qa.on(me.CLOSEBRACKET,et),Ja.on(me.CLOSEANGLEBRACKET,et),$a.on(me.CLOSEPAREN,et),ha.on(me.CLOSEBRACE,et),ua.on(me.CLOSEBRACKET,et),fa.on(me.CLOSEANGLEBRACKET,et),_a.on(me.CLOSEPAREN,et),er.on(me.CLOSEBRACE,et),tr.on(me.CLOSEBRACKET,et),ar.on(me.CLOSEANGLEBRACKET,et),rr.on(me.CLOSEPAREN,et),Wa.on(ut,ha),Qa.on(ut,ua),Ja.on(ut,fa),$a.on(ut,_a),Wa.on(ft,er),Qa.on(ft,tr),Ja.on(ft,ar),$a.on(ft,rr),ha.on(ut,ha),ua.on(ut,ua),fa.on(ut,fa),_a.on(ut,_a),ha.on(ft,ha),ua.on(ft,ua),fa.on(ft,fa),_a.on(ft,_a),er.on(ut,ha),tr.on(ut,ua),ar.on(ut,fa),rr.on(ut,_a),er.on(ft,er),tr.on(ft,tr),ar.on(ft,ar),rr.on(ft,rr),et.on(ut,et),Za.on(ut,et),et.on(ft,Za),Za.on(ft,Za),yo.on(me.TLD,pa).on(me.DOMAIN,pa).on(me.NUM,pa).on(me.LOCALHOST,pa),pa.on(ut,pa).on(ft,xs),xs.on(ut,pa).on(ft,xs);var sr=[me.DOMAIN,me.NUM,me.PLUS,me.POUND,me.QUERY,me.UNDERSCORE,me.SYM,me.AMPERSAND,me.TLD];sa.on(sr,Na).on(me.AT,Ir),Ka.on(sr,Na).on(me.AT,Ir),Nr.on(sr,Na),Na.on(sr,Na).on(me.AT,Ir).on(me.DOT,Eo),Eo.on(sr,Na),Ir.on(me.TLD,Oa).on(me.DOMAIN,Oa).on(me.LOCALHOST,Lr);var jl=function(t){for(var a=t.length,n=0,d=[],o=[];n<a;){for(var k=Or,C=null,L=null,b=0,E=null,h=-1;n<a&&!(C=k.next(t[n]));)o.push(t[n++]);for(;n<a&&(L=C||k.next(t[n]));)C=null,k=L,k.accepts()?(h=0,E=k):h>=0&&h++,n++,b++;if(h<0)for(var R=n-b;R<n;R++)o.push(t[R]);else{o.length>0&&(d.push(new wt.TEXT(o)),o=[]),n-=h,b-=h;var w=E.emit();d.push(new w(t.slice(n-b,n)))}}return o.length>0&&d.push(new wt.TEXT(o)),d};Xt.State=go.TokenState,Xt.TOKENS=Ol,Xt.run=jl,Xt.start=Or,ht.__esModule=!0,ht.tokenize=ht.test=ht.scanner=ht.parser=ht.options=ht.inherits=ht.find=void 0;var Vl=Ta,Hl=qa,Pl=ws(Hl),Fl=Yt,Mo=ws(Fl),Dl=Xt,Ro=ws(Dl);function ws(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"});var ks=function(t){return Ro.run(Mo.run(t))},Ul=function(t){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=ks(t),d=[],o=0;o<n.length;o++){var k=n[o];k.isLink&&(!a||k.type===a)&&d.push(k.toObject())}return d},zl=function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=ks(t);return n.length===1&&n[0].isLink&&(!a||n[0].type===a)};ht.find=Ul,ht.inherits=Vl.inherits,ht.options=Pl,ht.parser=Ro,ht.scanner=Mo,ht.test=zl,ht.tokenize=ks;var Ao=ht,ql=(e,t,a)=>{const n={bold:a.bold,italic:a.italic,strike:a.strike,underline:a.underline,multilineCode:a.multilineCode,inlineCode:a.inlineCode},d={[n.bold]:{end:"\\"+n.bold,allowed_chars:".",type:"bold"},[n.italic]:{end:n.italic,allowed_chars:".",type:"italic"},[n.strike]:{end:n.strike,allowed_chars:".",type:"strike"},[n.underline]:{end:n.underline,allowed_chars:".",type:"underline"},[n.multilineCode]:{end:n.multilineCode,allowed_chars:`(.|
)`,type:"multiline-code"},[n.inlineCode]:{end:n.inlineCode,allowed_chars:".",type:"inline-code"},"<usertag>":{allowed_chars:".",end:"</usertag>",type:"tag"}},o=jr(e,d),k=Yl(o,d),C=[].concat.apply([],k);return t&&Gl(C),C};function jr(e,t){let a=[],n=-1,d=null,o=Ao.find(e),k=!1;if(o.length>0&&(n=e.indexOf(o[0].value),k=!0),Object.keys(t).forEach(C=>{const L=e.indexOf(C);L>=0&&(n<0||L<n)&&(n=L,d=C,k=!1)}),k&&d!==-1){let C=e.substr(0,n),L=e.substr(n,o[0].value.length),b=e.substr(n+o[0].value.length);return a.push(C),a.push(L),a=a.concat(jr(b,t)),a}if(d){let C=e.substr(0,n);const L=d;let b=e.substr(n+L.length);if(e.replace(/\s/g,"").length===L.length*2)return[e];const E=b.match(new RegExp("^("+(t[L].allowed_chars||".")+"*"+(t[L].end?"?":"")+")"+(t[L].end?"("+t[L].end+")":""),"m"));if(!E||!E[1])C=C+L,a.push(C);else{C&&a.push(C);const h={start:L,content:jr(E[1],t),end:E[2],type:t[L].type};a.push(h),b=b.substr(E[0].length)}return a=a.concat(jr(b,t)),a}else return e?[e]:[]}function Yl(e,t){const a=[];return e.forEach(n=>{typeof n=="string"?a.push({types:[],value:n}):t[n.start]&&a.push(Xl(n))}),a}function Xl(e){const t=[];return To(e,t,[]),t}function To(e,t,a){e.content.forEach(n=>{typeof n=="string"?t.push({types:Bo(a.concat([e.type])),value:n}):To(n,t,Bo([n.type].concat([e.type]).concat(a)))})}function Bo(e){return[...new Set(e)]}function Gl(e){const t=[];return e.forEach(a=>{const n=Ao.find(a.value);if(n.length){const d=a.value.replace(n[0].value,"");t.push({types:a.types,value:d}),a.types=["url"].concat(a.types),a.href=n[0].href,a.value=n[0].value}t.push(a)}),t}const Ss=["png","jpg","jpeg","webp","svg","gif"],Co=["mp4","video/ogg","webm","quicktime"],Kl=["mp3","audio/ogg","wav","mpeg"],Zl={name:"FormatMessage",components:{SvgIcon:mt},props:{messageId:{type:String,default:""},roomId:{type:String,default:""},roomList:{type:Boolean,default:!1},content:{type:[String,Number],required:!0},deleted:{type:Boolean,default:!1},users:{type:Array,default:()=>[]},linkify:{type:Boolean,default:!0},singleLine:{type:Boolean,default:!1},reply:{type:Boolean,default:!1},textFormatting:{type:Object,required:!0},textMessages:{type:Object,default:()=>{}},linkOptions:{type:Object,required:!0}},emits:["open-user-tag"],computed:{linkifiedMessage(){if(this.deleted)return[{value:this.textMessages.MESSAGE_DELETED}];const e=ql(this.formatTags(this.content),this.linkify&&!this.linkOptions.disabled,this.textFormatting);return e.forEach(t=>{t.url=this.checkType(t,"url"),t.bold=this.checkType(t,"bold"),t.italic=this.checkType(t,"italic"),t.strike=this.checkType(t,"strike"),t.underline=this.checkType(t,"underline"),t.inline=this.checkType(t,"inline-code"),t.multiline=this.checkType(t,"multiline-code"),t.tag=this.checkType(t,"tag"),t.image=this.checkImageType(t),t.value=this.replaceEmojiByElement(t.value)}),e},formattedContent(){return this.deleted?(console.log("heuy"),this.textMessages.MESSAGE_DELETED):this.formatTags(this.content)}},methods:{checkType(e,t){return e.types.indexOf(t)!==-1},checkImageType(e){let t=e.value.lastIndexOf(".");e.value.lastIndexOf("/")>t&&(t=-1);const n=e.value.substring(t+1,e.value.length),d=t>0&&Ss.some(o=>n.toLowerCase().includes(o));return d&&this.setImageSize(e),d},setImageSize(e){const t=new Image;t.src=e.value,t.addEventListener("load",a);function a(n){const d=n.path[0].width/150;e.height=Math.round(n.path[0].height/d)+"px",t.removeEventListener("load",a)}},formatTags(e){const t="<usertag>",a="</usertag>",n=[...e.matchAll(new RegExp(t,"gi"))].map(o=>o.index),d=e;return n.forEach(o=>{const k=d.substring(o+t.length,d.indexOf(a,o)),C=this.users.find(L=>L._id===k);e=e.replaceAll(k,`@${(C==null?void 0:C.username)||"unknown"}`)}),e},openTag(e){if(!this.singleLine&&this.checkType(e,"tag")){const t=this.users.find(a=>e.value.indexOf(a.username)!==-1);this.$emit("open-user-tag",t)}},replaceEmojiByElement(e){let t;return this.singleLine?t=16:t=this.containsOnlyEmojis()?28:20,e.replaceAll(/[\p{Extended_Pictographic}\u{1F3FB}-\u{1F3FF}\u{1F9B0}-\u{1F9B3}]/gu,a=>`<span style="font-size: ${t}px">${a}</span>`)},containsOnlyEmojis(){const e=this.content.replace(new RegExp("[\0-\u1EEFf]","g"),""),t=this.content.replace(new RegExp(`[
\rs]+|( )+`,"g"),"");return e.length===t.length}}},Wl={class:"vac-image-link-container"},Ql={class:"vac-image-link-message"},Jl=["innerHTML"],$l=["innerHTML"];function e0(e,t,a,n,d,o){const k=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",{class:r.normalizeClass(["vac-format-message-wrapper",{"vac-text-ellipsis":a.singleLine}])},[a.textFormatting.disabled?(r.openBlock(),r.createElementBlock("div",{key:1,innerHTML:o.formattedContent},null,8,$l)):(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass({"vac-text-ellipsis":a.singleLine})},[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(o.linkifiedMessage,(C,L)=>(r.openBlock(),r.createElementBlock("div",{key:L,class:"vac-format-container"},[(r.openBlock(),r.createBlock(r.resolveDynamicComponent(C.url?"a":"span"),{class:r.normalizeClass({"vac-text-ellipsis":a.singleLine,"vac-text-bold":C.bold,"vac-text-italic":a.deleted||C.italic,"vac-text-strike":C.strike,"vac-text-underline":C.underline,"vac-text-inline-code":!a.singleLine&&C.inline,"vac-text-multiline-code":!a.singleLine&&C.multiline,"vac-text-tag":!a.singleLine&&!a.reply&&C.tag}),href:C.href,target:C.href?a.linkOptions.target:null,rel:C.href?a.linkOptions.rel:null,onClick:b=>o.openTag(C)},{default:r.withCtx(()=>[a.deleted?(r.openBlock(),r.createElementBlock(r.Fragment,{key:0},[r.renderSlot(e.$slots,a.roomList?"deleted-icon-room_"+a.roomId:"deleted-icon_"+a.messageId,{},()=>[r.createVNode(k,{name:"deleted",class:r.normalizeClass(["vac-icon-deleted",{"vac-icon-deleted-room":a.roomList}])},null,8,["class"])]),r.createTextVNode(" "+r.toDisplayString(a.textMessages.MESSAGE_DELETED),1)],64)):C.url&&C.image?(r.openBlock(),r.createElementBlock(r.Fragment,{key:1},[r.createElementVNode("div",Wl,[r.createElementVNode("div",{class:"vac-image-link",style:r.normalizeStyle({"background-image":`url('${C.value}')`,height:C.height})},null,4)]),r.createElementVNode("div",Ql,[r.createElementVNode("span",null,r.toDisplayString(C.value),1)])],64)):(r.openBlock(),r.createElementBlock("span",{key:2,innerHTML:C.value},null,8,Jl))]),_:2},1032,["class","href","target","rel","onClick"]))]))),128))],2))],2)}var or=Ye(Zl,[["render",e0]]);const va="__v-click-outside",Oo=typeof window!="undefined",t0=typeof navigator!="undefined",a0=Oo&&("ontouchstart"in window||t0&&navigator.msMaxTouchPoints>0)?["touchstart"]:["click"],r0=e=>{const t=typeof e=="function";if(!t&&typeof e!="object")throw new Error("v-click-outside: Binding value must be a function or an object");return{handler:t?e:e.handler,middleware:e.middleware||(a=>a),events:e.events||a0,isActive:e.isActive!==!1,detectIframe:e.detectIframe!==!1,capture:Boolean(e.capture)}},No=({event:e,handler:t,middleware:a})=>{a(e)&&t(e)},s0=({el:e,event:t,handler:a,middleware:n})=>{setTimeout(()=>{const{activeElement:d}=document;d&&d.tagName==="IFRAME"&&!e.contains(d)&&No({event:t,handler:a,middleware:n})},0)},o0=({el:e,event:t,handler:a,middleware:n})=>{const d=t.path||t.composedPath&&t.composedPath();(d?d.indexOf(e)<0:!e.contains(t.target))&&No({event:t,handler:a,middleware:n})},Lo=(e,{value:t})=>{const{events:a,handler:n,middleware:d,isActive:o,detectIframe:k,capture:C}=r0(t);if(!!o){if(e[va]=a.map(L=>({event:L,srcTarget:document.documentElement,handler:b=>o0({el:e,event:b,handler:n,middleware:d}),capture:C})),k){const L={event:"blur",srcTarget:window,handler:b=>s0({el:e,event:b,handler:n,middleware:d}),capture:C};e[va]=[...e[va],L]}e[va].forEach(({event:L,srcTarget:b,handler:E})=>setTimeout(()=>{!e[va]||b.addEventListener(L,E,C)},0))}},Io=e=>{(e[va]||[]).forEach(({event:a,srcTarget:n,handler:d,capture:o})=>n.removeEventListener(a,d,o)),delete e[va]};var Vr=Oo?{beforeMount:Lo,updated:(e,{value:t,oldValue:a})=>{JSON.stringify(t)!==JSON.stringify(a)&&(Io(e),Lo(e,{value:t}))},unmounted:Io}:{},jo=(e,t,a)=>{if(e.typingUsers&&e.typingUsers.length){const n=e.users.filter(d=>{if(d._id!==t&&e.typingUsers.indexOf(d._id)!==-1&&!(d.status&&d.status.state==="offline"))return!0});return n.length?e.users.length===2?a.IS_TYPING:n.map(d=>d.username).join(", ")+" "+a.IS_TYPING:void 0}};function nr(e,t){if(!(!t||!t.type))return e.some(a=>t.type.toLowerCase().includes(a))}function La(e){return nr(Ss,e)}function ir(e){return nr(Co,e)}function Vo(e){return nr(Ss,e)||nr(Co,e)}function Hr(e){return nr(Kl,e)}const n0={name:"RoomsContent",components:{SvgIcon:mt,FormatMessage:or},directives:{clickOutside:Vr},props:{currentUserId:{type:[String,Number],required:!0},room:{type:Object,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},textMessages:{type:Object,required:!0},roomActions:{type:Array,required:!0}},emits:["room-action-handler"],data(){return{roomMenuOpened:null}},computed:{getLastMessage(){const e=this.typingUsers;if(e)return e;const t=this.room.lastMessage.content;if(this.room.users.length<=2)return t;const a=this.room.users.find(n=>n._id===this.room.lastMessage.senderId);return this.room.lastMessage.username?`${this.room.lastMessage.username} - ${t}`:!a||a._id===this.currentUserId?t:`${a.username} - ${t}`},userStatus(){if(!this.room.users||this.room.users.length!==2)return;const e=this.room.users.find(t=>t._id!==this.currentUserId);return e&&e.status?e.status.state:null},typingUsers(){return jo(this.room,this.currentUserId,this.textMessages)},isMessageCheckmarkVisible(){return!this.typingUsers&&this.room.lastMessage&&!this.room.lastMessage.deleted&&this.room.lastMessage.senderId===this.currentUserId&&(this.room.lastMessage.saved||this.room.lastMessage.distributed||this.room.lastMessage.seen)},formattedDuration(){var t,a;const e=(a=(t=this.room.lastMessage)==null?void 0:t.files)==null?void 0:a[0];if(e){if(!e.duration)return`${e.name}.${e.extension}`;let n=Math.floor(e.duration);return(n-(n%=60))/60+(n>9?":":":0")+n}return""},isAudio(){return this.room.lastMessage.files?Hr(this.room.lastMessage.files[0]):!1}},methods:{roomActionHandler(e){this.closeRoomMenu(),this.$emit("room-action-handler",{action:e,roomId:this.room.roomId})},closeRoomMenu(){this.roomMenuOpened=null}}},i0={class:"vac-room-container"},l0={class:"vac-name-container vac-text-ellipsis"},c0={class:"vac-title-container"},d0={class:"vac-room-name vac-text-ellipsis"},m0={key:1,class:"vac-text-date"},h0={key:0},u0={key:1,class:"vac-text-ellipsis"},f0={key:3,class:"vac-text-ellipsis"},_0={class:"vac-room-options-container"},p0={key:0,class:"vac-badge-counter vac-room-badge"},v0={key:0,class:"vac-menu-options"},g0={class:"vac-menu-list"},b0=["onClick"];function y0(e,t,a,n,d,o){const k=r.resolveComponent("svg-icon"),C=r.resolveComponent("format-message"),L=r.resolveDirective("click-outside");return r.openBlock(),r.createElementBlock("div",i0,[r.renderSlot(e.$slots,"room-list-item_"+a.room.roomId,{},()=>[r.renderSlot(e.$slots,"room-list-avatar_"+a.room.roomId,{},()=>[a.room.avatar?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-avatar",style:r.normalizeStyle({"background-image":`url('${a.room.avatar}')`})},null,4)):r.createCommentVNode("",!0)]),r.createElementVNode("div",l0,[r.createElementVNode("div",c0,[o.userStatus?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-state-circle",{"vac-state-online":o.userStatus==="online"}])},null,2)):r.createCommentVNode("",!0),r.createElementVNode("div",d0,r.toDisplayString(a.room.roomName),1),a.room.lastMessage?(r.openBlock(),r.createElementBlock("div",m0,r.toDisplayString(a.room.lastMessage.timestamp),1)):r.createCommentVNode("",!0)]),r.createElementVNode("div",{class:r.normalizeClass(["vac-text-last",{"vac-message-new":a.room.lastMessage&&a.room.lastMessage.new&&!o.typingUsers}])},[o.isMessageCheckmarkVisible?(r.openBlock(),r.createElementBlock("span",h0,[r.renderSlot(e.$slots,"checkmark-icon_"+a.room.roomId,{},()=>[r.createVNode(k,{name:a.room.lastMessage.distributed?"double-checkmark":"checkmark",param:a.room.lastMessage.seen?"seen":"",class:"vac-icon-check"},null,8,["name","param"])])])):r.createCommentVNode("",!0),a.room.lastMessage&&!a.room.lastMessage.deleted&&o.isAudio?(r.openBlock(),r.createElementBlock("div",u0,[r.renderSlot(e.$slots,"microphone-icon_"+a.room.roomId,{},()=>[r.createVNode(k,{name:"microphone",class:"vac-icon-microphone"})]),r.createTextVNode(" "+r.toDisplayString(o.formattedDuration),1)])):a.room.lastMessage?(r.openBlock(),r.createBlock(C,{key:2,"message-id":a.room.lastMessage._id,"room-id":a.room.roomId,"room-list":!0,content:o.getLastMessage,deleted:!!a.room.lastMessage.deleted&&!o.typingUsers,users:a.room.users,"text-messages":a.textMessages,linkify:!1,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"single-line":!0},r.createSlots({_:2},[r.renderList(e.$slots,(b,E)=>({name:E,fn:r.withCtx(h=>[r.renderSlot(e.$slots,E,r.normalizeProps(r.guardReactiveProps(h)))])}))]),1032,["message-id","room-id","content","deleted","users","text-messages","text-formatting","link-options"])):r.createCommentVNode("",!0),!a.room.lastMessage&&o.typingUsers?(r.openBlock(),r.createElementBlock("div",f0,r.toDisplayString(o.typingUsers),1)):r.createCommentVNode("",!0),r.createElementVNode("div",_0,[a.room.unreadCount?(r.openBlock(),r.createElementBlock("div",p0,r.toDisplayString(a.room.unreadCount),1)):r.createCommentVNode("",!0),r.renderSlot(e.$slots,"room-list-options_"+a.room.roomId,{},()=>[a.roomActions.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-svg-button vac-list-room-options",onClick:t[0]||(t[0]=r.withModifiers(b=>d.roomMenuOpened=a.room.roomId,["stop"]))},[r.renderSlot(e.$slots,"room-list-options-icon_"+a.room.roomId,{},()=>[r.createVNode(k,{name:"dropdown",param:"room"})])])):r.createCommentVNode("",!0),a.roomActions.length?(r.openBlock(),r.createBlock(r.Transition,{key:1,name:"vac-slide-left"},{default:r.withCtx(()=>[d.roomMenuOpened===a.room.roomId?r.withDirectives((r.openBlock(),r.createElementBlock("div",v0,[r.createElementVNode("div",g0,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.roomActions,b=>(r.openBlock(),r.createElementBlock("div",{key:b.name},[r.createElementVNode("div",{class:"vac-menu-item",onClick:r.withModifiers(E=>o.roomActionHandler(b),["stop"])},r.toDisplayString(b.title),9,b0)]))),128))])])),[[L,o.closeRoomMenu]]):r.createCommentVNode("",!0)]),_:1})):r.createCommentVNode("",!0)])])],2)])])])}var x0=Ye(n0,[["render",y0]]),Es=(e,t,a,n=!1)=>!a||a===""?e:e.filter(d=>n?Pr(d[t]).startsWith(Pr(a)):Pr(d[t]).includes(Pr(a)));function Pr(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}const w0={name:"RoomsList",components:{Loader:Rr,RoomsSearch:Ni,RoomContent:x0},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},showRoomsList:{type:Boolean,required:!0},showSearch:{type:Boolean,required:!0},showAddRoom:{type:Boolean,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},isMobile:{type:Boolean,required:!0},rooms:{type:Array,required:!0},loadingRooms:{type:Boolean,required:!0},roomsLoaded:{type:Boolean,required:!0},room:{type:Object,required:!0},roomActions:{type:Array,required:!0},scrollDistance:{type:Number,required:!0}},emits:["add-room","room-action-handler","loading-more-rooms","fetch-room","fetch-more-rooms"],data(){return{filteredRooms:this.rooms||[],observer:null,showLoader:!0,loadingMoreRooms:!1,selectedRoomId:""}},watch:{rooms:{deep:!0,handler(e,t){this.filteredRooms=e,(e.length!==t.length||this.roomsLoaded)&&(this.loadingMoreRooms=!1)}},loadingRooms(e){e||setTimeout(()=>this.initIntersectionObserver())},loadingMoreRooms(e){this.$emit("loading-more-rooms",e)},roomsLoaded:{immediate:!0,handler(e){e&&(this.loadingMoreRooms=!1,this.loadingRooms||(this.showLoader=!1))}},room:{immediate:!0,handler(e){e&&!this.isMobile&&(this.selectedRoomId=e.roomId)}}},methods:{initIntersectionObserver(){this.observer&&(this.showLoader=!0,this.observer.disconnect());const e=document.querySelector("vue-advanced-chat").shadowRoot.getElementById("infinite-loader-rooms");if(e){const t={root:document.querySelector("vue-advanced-chat").shadowRoot.getElementById("rooms-list"),rootMargin:`${this.scrollDistance}px`,threshold:0};this.observer=new IntersectionObserver(a=>{a[0].isIntersecting&&this.loadMoreRooms()},t),this.observer.observe(e)}},searchRoom(e){this.filteredRooms=Es(this.rooms,"roomName",e.target.value)},openRoom(e){e.roomId===this.room.roomId&&!this.isMobile||(this.isMobile||(this.selectedRoomId=e.roomId),this.$emit("fetch-room",{room:e}))},loadMoreRooms(){if(!this.loadingMoreRooms){if(this.roomsLoaded){this.loadingMoreRooms=!1,this.showLoader=!1;return}this.$emit("fetch-more-rooms"),this.loadingMoreRooms=!0}}}},k0={key:0,class:"vac-rooms-empty"},S0={key:1,id:"rooms-list",class:"vac-room-list"},E0=["id","onClick"],M0={key:0,id:"infinite-loader-rooms"};function R0(e,t,a,n,d,o){const k=r.resolveComponent("rooms-search"),C=r.resolveComponent("loader"),L=r.resolveComponent("room-content");return r.withDirectives((r.openBlock(),r.createElementBlock("div",{class:r.normalizeClass(["vac-rooms-container",{"vac-rooms-container-full":a.isMobile,"vac-app-border-r":!a.isMobile}])},[r.renderSlot(e.$slots,"rooms-header"),r.renderSlot(e.$slots,"rooms-list-search",{},()=>[r.createVNode(k,{rooms:a.rooms,"loading-rooms":a.loadingRooms,"text-messages":a.textMessages,"show-search":a.showSearch,"show-add-room":a.showAddRoom,onSearchRoom:o.searchRoom,onAddRoom:t[0]||(t[0]=b=>e.$emit("add-room"))},r.createSlots({_:2},[r.renderList(e.$slots,(b,E)=>({name:E,fn:r.withCtx(h=>[r.renderSlot(e.$slots,E,r.normalizeProps(r.guardReactiveProps(h)))])}))]),1032,["rooms","loading-rooms","text-messages","show-search","show-add-room","onSearchRoom"])]),r.createVNode(C,{show:a.loadingRooms,type:"rooms"},r.createSlots({_:2},[r.renderList(e.$slots,(b,E)=>({name:E,fn:r.withCtx(h=>[r.renderSlot(e.$slots,E,r.normalizeProps(r.guardReactiveProps(h)))])}))]),1032,["show"]),!a.loadingRooms&&!a.rooms.length?(r.openBlock(),r.createElementBlock("div",k0,[r.renderSlot(e.$slots,"rooms-empty",{},()=>[r.createTextVNode(r.toDisplayString(a.textMessages.ROOMS_EMPTY),1)])])):r.createCommentVNode("",!0),a.loadingRooms?r.createCommentVNode("",!0):(r.openBlock(),r.createElementBlock("div",S0,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(d.filteredRooms,b=>(r.openBlock(),r.createElementBlock("div",{id:b.roomId,key:b.roomId,class:r.normalizeClass(["vac-room-item",{"vac-room-selected":d.selectedRoomId===b.roomId}]),onClick:E=>o.openRoom(b)},[r.createVNode(L,{"current-user-id":a.currentUserId,room:b,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"text-messages":a.textMessages,"room-actions":a.roomActions,onRoomActionHandler:t[1]||(t[1]=E=>e.$emit("room-action-handler",E))},r.createSlots({_:2},[r.renderList(e.$slots,(E,h)=>({name:h,fn:r.withCtx(R=>[r.renderSlot(e.$slots,h,r.normalizeProps(r.guardReactiveProps(R)))])}))]),1032,["current-user-id","room","text-formatting","link-options","text-messages","room-actions"])],10,E0))),128)),r.createVNode(r.Transition,{name:"vac-fade-message"},{default:r.withCtx(()=>[a.rooms.length&&!a.loadingRooms?(r.openBlock(),r.createElementBlock("div",M0,[r.createVNode(C,{show:d.showLoader,infinite:!0,type:"infinite-rooms"},r.createSlots({_:2},[r.renderList(e.$slots,(b,E)=>({name:E,fn:r.withCtx(h=>[r.renderSlot(e.$slots,E,r.normalizeProps(r.guardReactiveProps(h)))])}))]),1032,["show"])])):r.createCommentVNode("",!0)]),_:3})]))],2)),[[r.vShow,a.showRoomsList]])}var A0=Ye(w0,[["render",R0]]);const T0={name:"RoomHeader",components:{SvgIcon:mt},directives:{clickOutside:Vr},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},singleRoom:{type:Boolean,required:!0},showRoomsList:{type:Boolean,required:!0},isMobile:{type:Boolean,required:!0},roomInfoEnabled:{type:Boolean,required:!0},menuActions:{type:Array,required:!0},room:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0},messageSelectionActions:{type:Array,required:!0},selectedMessagesTotal:{type:Number,required:!0}},emits:["toggle-rooms-list","room-info","menu-action-handler","cancel-message-selection","message-selection-action-handler"],data(){return{menuOpened:!1,messageSelectionAnimationEnded:!0}},computed:{typingUsers(){return jo(this.room,this.currentUserId,this.textMessages)},userStatus(){if(!this.room.users||this.room.users.length!==2)return;const e=this.room.users.find(a=>a._id!==this.currentUserId);if(!e.status)return;let t="";return e.status.state==="online"?t=this.textMessages.IS_ONLINE:e.status.lastChanged&&(t=this.textMessages.LAST_SEEN+e.status.lastChanged),t}},watch:{messageSelectionEnabled(e){e?this.messageSelectionAnimationEnded=!1:setTimeout(()=>{this.messageSelectionAnimationEnded=!0},300)}},methods:{menuActionHandler(e){this.closeMenu(),this.$emit("menu-action-handler",e)},closeMenu(){this.menuOpened=!1},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",e)}}},B0={class:"vac-room-header vac-app-border-b"},C0={class:"vac-room-wrapper"},O0={key:0,class:"vac-room-selection"},N0=["id"],L0=["onClick"],I0={class:"vac-selection-button-count"},j0={class:"vac-text-ellipsis"},V0={class:"vac-room-name vac-text-ellipsis"},H0={key:0,class:"vac-room-info vac-text-ellipsis"},P0={key:1,class:"vac-room-info vac-text-ellipsis"},F0={key:0,class:"vac-menu-options"},D0={class:"vac-menu-list"},U0=["onClick"];function z0(e,t,a,n,d,o){const k=r.resolveComponent("svg-icon"),C=r.resolveDirective("click-outside");return r.openBlock(),r.createElementBlock("div",B0,[r.renderSlot(e.$slots,"room-header",{},()=>[r.createElementVNode("div",C0,[r.createVNode(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.messageSelectionEnabled?(r.openBlock(),r.createElementBlock("div",O0,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.messageSelectionActions,L=>(r.openBlock(),r.createElementBlock("div",{id:L.name,key:L.name},[r.createElementVNode("div",{class:"vac-selection-button",onClick:b=>o.messageSelectionActionHandler(L)},[r.createTextVNode(r.toDisplayString(L.title)+" ",1),r.createElementVNode("span",I0,r.toDisplayString(a.selectedMessagesTotal),1)],8,L0)],8,N0))),128)),r.createElementVNode("div",{class:"vac-selection-cancel vac-item-clickable",onClick:t[0]||(t[0]=L=>e.$emit("cancel-message-selection"))},r.toDisplayString(a.textMessages.CANCEL_SELECT_MESSAGE),1)])):r.createCommentVNode("",!0)]),_:1}),!a.messageSelectionEnabled&&d.messageSelectionAnimationEnded?(r.openBlock(),r.createElementBlock(r.Fragment,{key:0},[a.singleRoom?r.createCommentVNode("",!0):(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-svg-button vac-toggle-button",{"vac-rotate-icon-init":!a.isMobile,"vac-rotate-icon":!a.showRoomsList&&!a.isMobile}]),onClick:t[1]||(t[1]=L=>e.$emit("toggle-rooms-list"))},[r.renderSlot(e.$slots,"toggle-icon",{},()=>[r.createVNode(k,{name:"toggle"})])],2)),r.createElementVNode("div",{class:r.normalizeClass(["vac-info-wrapper",{"vac-item-clickable":a.roomInfoEnabled}]),onClick:t[2]||(t[2]=L=>e.$emit("room-info"))},[r.renderSlot(e.$slots,"room-header-avatar",{},()=>[a.room.avatar?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-avatar",style:r.normalizeStyle({"background-image":`url('${a.room.avatar}')`})},null,4)):r.createCommentVNode("",!0)]),r.renderSlot(e.$slots,"room-header-info",{},()=>[r.createElementVNode("div",j0,[r.createElementVNode("div",V0,r.toDisplayString(a.room.roomName),1),o.typingUsers?(r.openBlock(),r.createElementBlock("div",H0,r.toDisplayString(o.typingUsers),1)):(r.openBlock(),r.createElementBlock("div",P0,r.toDisplayString(o.userStatus),1))])])],2),a.room.roomId?r.renderSlot(e.$slots,"room-options",{key:1},()=>[a.menuActions.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-svg-button vac-room-options",onClick:t[3]||(t[3]=L=>d.menuOpened=!d.menuOpened)},[r.renderSlot(e.$slots,"menu-icon",{},()=>[r.createVNode(k,{name:"menu"})])])):r.createCommentVNode("",!0),a.menuActions.length?(r.openBlock(),r.createBlock(r.Transition,{key:1,name:"vac-slide-left"},{default:r.withCtx(()=>[d.menuOpened?r.withDirectives((r.openBlock(),r.createElementBlock("div",F0,[r.createElementVNode("div",D0,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.menuActions,L=>(r.openBlock(),r.createElementBlock("div",{key:L.name},[r.createElementVNode("div",{class:"vac-menu-item",onClick:b=>o.menuActionHandler(L)},r.toDisplayString(L.title),9,U0)]))),128))])])),[[C,o.closeMenu]]):r.createCommentVNode("",!0)]),_:1})):r.createCommentVNode("",!0)]):r.createCommentVNode("",!0)],64)):r.createCommentVNode("",!0)])])])}var q0=Ye(T0,[["render",z0]]);function Fr(e){if(typeof e!="string"||!e)throw new Error("expected a non-empty string, got: "+e)}function Ms(e){if(typeof e!="number")throw new Error("expected a number, got: "+e)}const Y0=1,X0=1,ga="emoji",Ia="keyvalue",Rs="favorites",G0="tokens",Ho="tokens",K0="unicode",Po="count",Z0="group",W0="order",Fo="group-order",As="eTag",Dr="url",Do="skinTone",ja="readonly",Ts="readwrite",Uo="skinUnicodes",Q0="skinUnicodes",J0="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",$0="en";function ec(e,t){const a=new Set,n=[];for(const d of e){const o=t(d);a.has(o)||(a.add(o),n.push(d))}return n}function zo(e){return ec(e,t=>t.unicode)}function tc(e){function t(a,n,d){const o=n?e.createObjectStore(a,{keyPath:n}):e.createObjectStore(a);if(d)for(const[k,[C,L]]of Object.entries(d))o.createIndex(k,C,{multiEntry:L});return o}t(Ia),t(ga,K0,{[Ho]:[G0,!0],[Fo]:[[Z0,W0]],[Uo]:[Q0,!0]}),t(Rs,void 0,{[Po]:[""]})}const Bs={},Ur={},zr={};function qo(e,t,a){a.onerror=()=>t(a.error),a.onblocked=()=>t(new Error("IDB blocked")),a.onsuccess=()=>e(a.result)}async function ac(e){const t=await new Promise((a,n)=>{const d=indexedDB.open(e,Y0);Bs[e]=d,d.onupgradeneeded=o=>{o.oldVersion<X0&&tc(d.result)},qo(a,n,d)});return t.onclose=()=>Cs(e),t}function rc(e){return Ur[e]||(Ur[e]=ac(e)),Ur[e]}function ea(e,t,a,n){return new Promise((d,o)=>{const k=e.transaction(t,a,{durability:"relaxed"}),C=typeof t=="string"?k.objectStore(t):t.map(b=>k.objectStore(b));let L;n(C,k,b=>{L=b}),k.oncomplete=()=>d(L),k.onerror=()=>o(k.error)})}function Cs(e){const t=Bs[e],a=t&&t.result;if(a){a.close();const n=zr[e];if(n)for(const d of n)d()}delete Bs[e],delete Ur[e],delete zr[e]}function sc(e){return new Promise((t,a)=>{Cs(e);const n=indexedDB.deleteDatabase(e);qo(t,a,n)})}function oc(e,t){let a=zr[e];a||(a=zr[e]=[]),a.push(t)}const nc=new Set([":D","XD",":'D","O:)",":X",":P",";P","XP",":L",":Z",":j","8D","XO","8)",":B",":O",":S",":'o","Dx","X(","D:",":C",">0)",":3","</3","<3","\\M/",":E","8#"]);function Va(e){return e.split(/[\s_]+/).map(t=>!t.match(/\w/)||nc.has(t)?t.toLowerCase():t.replace(/[)(:,]/g,"").replace(/’/g,"'").toLowerCase()).filter(Boolean)}const ic=2;function Yo(e){return e.filter(Boolean).map(t=>t.toLowerCase()).filter(t=>t.length>=ic)}function lc(e){return e.map(({annotation:a,emoticon:n,group:d,order:o,shortcodes:k,skins:C,tags:L,emoji:b,version:E})=>{const h=[...new Set(Yo([...(k||[]).map(Va).flat(),...L.map(Va).flat(),...Va(a),n]))].sort(),R={annotation:a,group:d,order:o,tags:L,tokens:h,unicode:b,version:E};if(n&&(R.emoticon=n),k&&(R.shortcodes=k),C){R.skinTones=[],R.skinUnicodes=[],R.skinVersions=[];for(const{tone:w,emoji:s,version:F}of C)R.skinTones.push(w),R.skinUnicodes.push(s),R.skinVersions.push(F)}return R})}function Xo(e,t,a,n){e[t](a).onsuccess=d=>n&&n(d.target.result)}function ba(e,t,a){Xo(e,"get",t,a)}function Go(e,t,a){Xo(e,"getAll",t,a)}function Os(e){e.commit&&e.commit()}function cc(e,t){let a=e[0];for(let n=1;n<e.length;n++){const d=e[n];t(a)>t(d)&&(a=d)}return a}function Ko(e,t){const a=cc(e,d=>d.length),n=[];for(const d of a)e.some(o=>o.findIndex(k=>t(k)===t(d))===-1)||n.push(d);return n}async function dc(e){return!await Ns(e,Ia,Dr)}async function mc(e,t,a){const[n,d]=await Promise.all([As,Dr].map(o=>Ns(e,Ia,o)));return n===a&&d===t}async function hc(e,t){return ea(e,ga,ja,(n,d,o)=>{let k;const C=()=>{n.getAll(k&&IDBKeyRange.lowerBound(k,!0),50).onsuccess=L=>{const b=L.target.result;for(const E of b)if(k=E.unicode,t(E))return o(E);if(b.length<50)return o();C()}};C()})}async function Zo(e,t,a,n){try{const d=lc(t);await ea(e,[ga,Ia],Ts,([o,k],C)=>{let L,b,E=0;function h(){++E===2&&R()}function R(){if(!(L===n&&b===a)){o.clear();for(const w of d)o.put(w);k.put(n,As),k.put(a,Dr),Os(C)}}ba(k,As,w=>{L=w,h()}),ba(k,Dr,w=>{b=w,h()})})}finally{}}async function uc(e,t){return ea(e,ga,ja,(a,n,d)=>{const o=IDBKeyRange.bound([t,0],[t+1,0],!1,!0);Go(a.index(Fo),o,d)})}async function Wo(e,t){const a=Yo(Va(t));return a.length?ea(e,ga,ja,(n,d,o)=>{const k=[],C=()=>{k.length===a.length&&L()},L=()=>{const b=Ko(k,E=>E.unicode);o(b.sort((E,h)=>E.order<h.order?-1:1))};for(let b=0;b<a.length;b++){const E=a[b],h=b===a.length-1?IDBKeyRange.bound(E,E+"\uFFFF",!1,!0):IDBKeyRange.only(E);Go(n.index(Ho),h,R=>{k.push(R),C()})}}):[]}async function fc(e,t){const a=await Wo(e,t);return a.length?a.filter(n=>(n.shortcodes||[]).map(o=>o.toLowerCase()).includes(t.toLowerCase()))[0]||null:await hc(e,d=>(d.shortcodes||[]).includes(t.toLowerCase()))||null}async function _c(e,t){return ea(e,ga,ja,(a,n,d)=>ba(a,t,o=>{if(o)return d(o);ba(a.index(Uo),t,k=>d(k||null))}))}function Ns(e,t,a){return ea(e,t,ja,(n,d,o)=>ba(n,a,o))}function pc(e,t,a,n){return ea(e,t,Ts,(d,o)=>{d.put(n,a),Os(o)})}function vc(e,t){return ea(e,Rs,Ts,(a,n)=>ba(a,t,d=>{a.put((d||0)+1,t),Os(n)}))}function gc(e,t,a){return a===0?[]:ea(e,[Rs,ga],ja,([n,d],o,k)=>{const C=[];n.index(Po).openCursor(void 0,"prev").onsuccess=L=>{const b=L.target.result;if(!b)return k(C);function E(w){if(C.push(w),C.length===a)return k(C);b.continue()}const h=b.primaryKey,R=t.byName(h);if(R)return E(R);ba(d,h,w=>{if(w)return E(w);b.continue()})}})}const qr="";function bc(e,t){const a=new Map;for(const d of e){const o=t(d);for(const k of o){let C=a;for(let b=0;b<k.length;b++){const E=k.charAt(b);let h=C.get(E);h||(h=new Map,C.set(E,h)),C=h}let L=C.get(qr);L||(L=[],C.set(qr,L)),L.push(d)}}return(d,o)=>{let k=a;for(let b=0;b<d.length;b++){const E=d.charAt(b),h=k.get(E);if(h)k=h;else return[]}if(o)return k.get(qr)||[];const C=[],L=[k];for(;L.length;){const E=[...L.shift().entries()].sort((h,R)=>h[0]<R[0]?-1:1);for(const[h,R]of E)h===qr?C.push(...R):L.push(R)}return C}}const yc=["name","url"];function xc(e){const t=e&&Array.isArray(e),a=t&&e.length&&(!e[0]||yc.some(n=>!(n in e[0])));if(!t||a)throw new Error("Custom emojis are in the wrong format")}function Qo(e){xc(e);const t=(R,w)=>R.name.toLowerCase()<w.name.toLowerCase()?-1:1,a=e.sort(t),d=bc(e,R=>[...new Set((R.shortcodes||[]).map(w=>Va(w)).flat())]),o=R=>d(R,!0),k=R=>d(R,!1),C=R=>{const w=Va(R),s=w.map((F,H)=>(H<w.length-1?o:k)(F));return Ko(s,F=>F.name).sort(t)},L=new Map,b=new Map;for(const R of e){b.set(R.name.toLowerCase(),R);for(const w of R.shortcodes||[])L.set(w.toLowerCase(),R)}return{all:a,search:C,byShortcode:R=>L.get(R.toLowerCase()),byName:R=>b.get(R.toLowerCase())}}function lr(e){if(!e)return e;if(delete e.tokens,e.skinTones){const t=e.skinTones.length;e.skins=Array(t);for(let a=0;a<t;a++)e.skins[a]={tone:e.skinTones[a],unicode:e.skinUnicodes[a],version:e.skinVersions[a]};delete e.skinTones,delete e.skinUnicodes,delete e.skinVersions}return e}function Jo(e){e||console.warn("emoji-picker-element is more efficient if the dataSource server exposes an ETag header.")}const wc=["annotation","emoji","group","order","tags","version"];function kc(e){if(!e||!Array.isArray(e)||!e[0]||typeof e[0]!="object"||wc.some(t=>!(t in e[0])))throw new Error("Emoji data is in the wrong format")}function $o(e,t){if(Math.floor(e.status/100)!==2)throw new Error("Failed to fetch: "+t+":  "+e.status)}async function Sc(e){const t=await fetch(e,{method:"HEAD"});$o(t,e);const a=t.headers.get("etag");return Jo(a),a}async function Ls(e){const t=await fetch(e);$o(t,e);const a=t.headers.get("etag");Jo(a);const n=await t.json();return kc(n),[a,n]}function Ec(e){for(var t="",a=new Uint8Array(e),n=a.byteLength,d=-1;++d<n;)t+=String.fromCharCode(a[d]);return t}function Mc(e){for(var t=e.length,a=new ArrayBuffer(t),n=new Uint8Array(a),d=-1;++d<t;)n[d]=e.charCodeAt(d);return a}async function en(e){const t=JSON.stringify(e),a=Mc(t),n=await crypto.subtle.digest("SHA-1",a),d=Ec(n);return btoa(d)}async function Rc(e,t){let a,n=await Sc(t);if(!n){const d=await Ls(t);n=d[0],a=d[1],n||(n=await en(a))}await mc(e,t,n)||(a||(a=(await Ls(t))[1]),await Zo(e,a,t,n))}async function Ac(e,t){let[a,n]=await Ls(t);a||(a=await en(n)),await Zo(e,n,t,a)}class tn{constructor({dataSource:t=J0,locale:a=$0,customEmoji:n=[]}={}){this.dataSource=t,this.locale=a,this._dbName=`emoji-picker-element-${this.locale}`,this._db=void 0,this._lazyUpdate=void 0,this._custom=Qo(n),this._clear=this._clear.bind(this),this._ready=this._init()}async _init(){const t=this._db=await rc(this._dbName);oc(this._dbName,this._clear);const a=this.dataSource;await dc(t)?await Ac(t,a):this._lazyUpdate=Rc(t,a)}async ready(){const t=async()=>(this._ready||(this._ready=this._init()),this._ready);await t(),this._db||await t()}async getEmojiByGroup(t){return Ms(t),await this.ready(),zo(await uc(this._db,t)).map(lr)}async getEmojiBySearchQuery(t){Fr(t),await this.ready();const a=this._custom.search(t),n=zo(await Wo(this._db,t)).map(lr);return[...a,...n]}async getEmojiByShortcode(t){Fr(t),await this.ready();const a=this._custom.byShortcode(t);return a||lr(await fc(this._db,t))}async getEmojiByUnicodeOrName(t){Fr(t),await this.ready();const a=this._custom.byName(t);return a||lr(await _c(this._db,t))}async getPreferredSkinTone(){return await this.ready(),await Ns(this._db,Ia,Do)||0}async setPreferredSkinTone(t){return Ms(t),await this.ready(),pc(this._db,Ia,Do,t)}async incrementFavoriteEmojiCount(t){return Fr(t),await this.ready(),vc(this._db,t)}async getTopFavoriteEmoji(t){return Ms(t),await this.ready(),(await gc(this._db,this._custom,t)).map(lr)}set customEmoji(t){this._custom=Qo(t)}get customEmoji(){return this._custom.all}async _shutdown(){await this.ready();try{await this._lazyUpdate}catch{}}_clear(){this._db=this._ready=this._lazyUpdate=void 0}async close(){await this._shutdown(),await Cs(this._dbName)}async delete(){await this._shutdown(),await sc(this._dbName)}}function cr(){}function an(e){return e()}function rn(){return Object.create(null)}function dr(e){e.forEach(an)}function sn(e){return typeof e=="function"}function Tc(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let Yr;function Xr(e,t){return Yr||(Yr=document.createElement("a")),Yr.href=t,e===Yr.href}function Bc(e){return Object.keys(e).length===0}function Cc(e){return e&&sn(e.destroy)?e.destroy:cr}function Ge(e,t){e.appendChild(t)}function Pt(e,t,a){e.insertBefore(t,a||null)}function Ft(e){e.parentNode.removeChild(e)}function qe(e){return document.createElement(e)}function Gt(e){return document.createTextNode(e)}function Dt(e,t,a,n){return e.addEventListener(t,a,n),()=>e.removeEventListener(t,a,n)}function J(e,t,a){a==null?e.removeAttribute(t):e.getAttribute(t)!==a&&e.setAttribute(t,a)}function Kt(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function on(e,t){e.value=t==null?"":t}function oa(e,t,a,n){a===null?e.style.removeProperty(t):e.style.setProperty(t,a,n?"important":"")}let Is;function mr(e){Is=e}const hr=[],Ha=[],Gr=[],nn=[],ln=Promise.resolve();let js=!1;function cn(){js||(js=!0,ln.then(dn))}function Oc(){return cn(),ln}function Vs(e){Gr.push(e)}const Hs=new Set;let Kr=0;function dn(){const e=Is;do{for(;Kr<hr.length;){const t=hr[Kr];Kr++,mr(t),Nc(t.$$)}for(mr(null),hr.length=0,Kr=0;Ha.length;)Ha.pop()();for(let t=0;t<Gr.length;t+=1){const a=Gr[t];Hs.has(a)||(Hs.add(a),a())}Gr.length=0}while(hr.length);for(;nn.length;)nn.pop()();js=!1,Hs.clear(),mr(e)}function Nc(e){if(e.fragment!==null){e.update(),dr(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Vs)}}const Lc=new Set;function Ic(e,t){e&&e.i&&(Lc.delete(e),e.i(t))}const jc=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;function ur(e,t){e.d(1),t.delete(e.key)}function fr(e,t,a,n,d,o,k,C,L,b,E,h){let R=e.length,w=o.length,s=R;const F={};for(;s--;)F[e[s].key]=s;const H=[],V=new Map,c=new Map;for(s=w;s--;){const O=h(d,o,s),l=a(O);let x=k.get(l);x?n&&x.p(O,t):(x=b(l,O),x.c()),V.set(l,H[s]=x),l in F&&c.set(l,Math.abs(s-F[l]))}const T=new Set,N=new Set;function M(O){Ic(O,1),O.m(C,E),k.set(O.key,O),E=O.first,w--}for(;R&&w;){const O=H[w-1],l=e[R-1],x=O.key,y=l.key;O===l?(E=O.first,R--,w--):V.has(y)?!k.has(x)||T.has(x)?M(O):N.has(y)?R--:c.get(x)>c.get(y)?(N.add(x),M(O)):(T.add(y),R--):(L(l,k),R--)}for(;R--;){const O=e[R];V.has(O.key)||L(O,k)}for(;w;)M(H[w-1]);return H}function Vc(e,t,a,n){const{fragment:d,on_mount:o,on_destroy:k,after_update:C}=e.$$;d&&d.m(t,a),n||Vs(()=>{const L=o.map(an).filter(sn);k?k.push(...L):dr(L),e.$$.on_mount=[]}),C.forEach(Vs)}function Hc(e,t){const a=e.$$;a.fragment!==null&&(dr(a.on_destroy),a.fragment&&a.fragment.d(t),a.on_destroy=a.fragment=null,a.ctx=[])}function Pc(e,t){e.$$.dirty[0]===-1&&(hr.push(e),cn(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Fc(e,t,a,n,d,o,k,C=[-1]){const L=Is;mr(e);const b=e.$$={fragment:null,ctx:null,props:o,update:cr,not_equal:d,bound:rn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(L?L.$$.context:[]),callbacks:rn(),dirty:C,skip_bound:!1,root:t.target||L.$$.root};k&&k(b.root);let E=!1;b.ctx=a?a(e,t.props||{},(h,R,...w)=>{const s=w.length?w[0]:R;return b.ctx&&d(b.ctx[h],b.ctx[h]=s)&&(!b.skip_bound&&b.bound[h]&&b.bound[h](s),E&&Pc(e,h)),R}):[],b.update(),E=!0,dr(b.before_update),b.fragment=n?n(b.ctx):!1,t.target&&(b.fragment&&b.fragment.c(),Vc(e,t.target,void 0,void 0),dn()),mr(L)}class Dc{$destroy(){Hc(this,1),this.$destroy=cr}$on(t,a){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(a),()=>{const d=n.indexOf(a);d!==-1&&n.splice(d,1)}}$set(t){this.$$set&&!Bc(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const mn=[[-1,"\u2728","custom"],[0,"\u{1F600}","smileys-emotion"],[1,"\u{1F44B}","people-body"],[3,"\u{1F431}","animals-nature"],[4,"\u{1F34E}","food-drink"],[5,"\u{1F3E0}\uFE0F","travel-places"],[6,"\u26BD","activities"],[7,"\u{1F4DD}","objects"],[8,"\u26D4\uFE0F","symbols"],[9,"\u{1F3C1}","flags"]].map(([e,t,a])=>({id:e,emoji:t,name:a})),Zr=mn.slice(1),Uc=mn[0],zc=2,hn=6,un=typeof requestIdleCallback=="function"?requestIdleCallback:setTimeout;function fn(e){return e.unicode.includes("\u200D")}const qc={"\u{1FAE0}":14,"\u{1F972}":13.1,"\u{1F97B}":12.1,"\u{1F970}":11,"\u{1F929}":5,"\u{1F471}\u200D\u2640\uFE0F":4,"\u{1F923}":3,"\u{1F441}\uFE0F\u200D\u{1F5E8}\uFE0F":2,"\u{1F600}":1,"\u{1F610}\uFE0F":.7,"\u{1F603}":.6},Yc=1e3,Xc="\u{1F590}\uFE0F",Gc=8,Kc=["\u{1F60A}","\u{1F612}","\u2665\uFE0F","\u{1F44D}\uFE0F","\u{1F60D}","\u{1F602}","\u{1F62D}","\u263A\uFE0F","\u{1F614}","\u{1F629}","\u{1F60F}","\u{1F495}","\u{1F64C}","\u{1F618}"],_n='"Twemoji Mozilla","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji","EmojiOne Color","Android Emoji",sans-serif',Zc=(e,t)=>e<t?-1:e>t?1:0,pn=(e,t)=>{const a=document.createElement("canvas");a.width=a.height=1;const n=a.getContext("2d");return n.textBaseline="top",n.font=`100px ${_n}`,n.fillStyle=t,n.scale(.01,.01),n.fillText(e,0,0),n.getImageData(0,0,1,1).data},Wc=(e,t)=>{const a=[...e].join(","),n=[...t].join(",");return a===n&&!a.startsWith("0,0,0,")};function Qc(e){const t=pn(e,"#000"),a=pn(e,"#fff");return t&&a&&Wc(t,a)}function Jc(){const e=Object.entries(qc);try{for(const[t,a]of e)if(Qc(t))return a}catch{}finally{}return e[0][1]}const Ps=new Promise(e=>un(()=>e(Jc()))),Fs=new Map,$c="\uFE0F",e1="\uD83C",t1="\u200D",a1=127995,r1=57339;function s1(e,t){if(t===0)return e;const a=e.indexOf(t1);return a!==-1?e.substring(0,a)+String.fromCodePoint(a1+t-1)+e.substring(a):(e.endsWith($c)&&(e=e.substring(0,e.length-1)),e+e1+String.fromCodePoint(r1+t-1))}function na(e){e.preventDefault(),e.stopPropagation()}function Ds(e,t,a){return t+=e?-1:1,t<0?t=a.length-1:t>=a.length&&(t=0),t}function vn(e,t){const a=new Set,n=[];for(const d of e){const o=t(d);a.has(o)||(a.add(o),n.push(d))}return n}function o1(e,t){const a=n=>{const d={};for(const o of n)typeof o.tone=="number"&&o.version<=t&&(d[o.tone]=o.unicode);return d};return e.map(({unicode:n,skins:d,shortcodes:o,url:k,name:C,category:L})=>({unicode:n,name:C,shortcodes:o,url:k,category:L,id:n||C,skins:d&&a(d),title:(o||[]).join(", ")}))}const Wr=requestAnimationFrame;let n1=typeof ResizeObserver=="function";function i1(e,t){let a;return n1?(a=new ResizeObserver(n=>t(n[0].contentRect.width)),a.observe(e)):Wr(()=>t(e.getBoundingClientRect().width)),{destroy(){a&&a.disconnect()}}}function gn(e){{const t=document.createRange();return t.selectNode(e.firstChild),t.getBoundingClientRect().width}}let Us;function l1(e,t,a){for(const n of e){const d=a(n),o=gn(d);typeof Us=="undefined"&&(Us=gn(t));const k=o/1.8<Us;Fs.set(n.unicode,k)}}function c1(e){return vn(e,t=>t)}const{Map:_r}=jc;function bn(e,t,a){const n=e.slice();return n[63]=t[a],n[65]=a,n}function yn(e,t,a){const n=e.slice();return n[66]=t[a],n[65]=a,n}function xn(e,t,a){const n=e.slice();return n[63]=t[a],n[65]=a,n}function wn(e,t,a){const n=e.slice();return n[69]=t[a],n}function kn(e,t,a){const n=e.slice();return n[72]=t[a],n[65]=a,n}function Sn(e,t){let a,n=t[72]+"",d,o,k,C,L,b;return{key:e,first:null,c(){a=qe("div"),d=Gt(n),J(a,"id",o="skintone-"+t[65]),J(a,"class",k="emoji hide-focus "+(t[65]===t[20]?"active":"")),J(a,"aria-selected",C=t[65]===t[20]),J(a,"role","option"),J(a,"title",L=t[0].skinTones[t[65]]),J(a,"tabindex","-1"),J(a,"aria-label",b=t[0].skinTones[t[65]]),this.first=a},m(E,h){Pt(E,a,h),Ge(a,d)},p(E,h){t=E,h[0]&512&&n!==(n=t[72]+"")&&Kt(d,n),h[0]&512&&o!==(o="skintone-"+t[65])&&J(a,"id",o),h[0]&1049088&&k!==(k="emoji hide-focus "+(t[65]===t[20]?"active":""))&&J(a,"class",k),h[0]&1049088&&C!==(C=t[65]===t[20])&&J(a,"aria-selected",C),h[0]&513&&L!==(L=t[0].skinTones[t[65]])&&J(a,"title",L),h[0]&513&&b!==(b=t[0].skinTones[t[65]])&&J(a,"aria-label",b)},d(E){E&&Ft(a)}}}function En(e,t){let a,n,d=t[69].emoji+"",o,k,C,L,b,E,h;function R(){return t[49](t[69])}return{key:e,first:null,c(){a=qe("button"),n=qe("div"),o=Gt(d),J(n,"class","nav-emoji emoji"),J(a,"role","tab"),J(a,"class","nav-button"),J(a,"aria-controls",k="tab-"+t[69].id),J(a,"aria-label",C=t[0].categories[t[69].name]),J(a,"aria-selected",L=!t[4]&&t[13].id===t[69].id),J(a,"title",b=t[0].categories[t[69].name]),this.first=a},m(w,s){Pt(w,a,s),Ge(a,n),Ge(n,o),E||(h=Dt(a,"click",R),E=!0)},p(w,s){t=w,s[0]&4096&&d!==(d=t[69].emoji+"")&&Kt(o,d),s[0]&4096&&k!==(k="tab-"+t[69].id)&&J(a,"aria-controls",k),s[0]&4097&&C!==(C=t[0].categories[t[69].name])&&J(a,"aria-label",C),s[0]&12304&&L!==(L=!t[4]&&t[13].id===t[69].id)&&J(a,"aria-selected",L),s[0]&4097&&b!==(b=t[0].categories[t[69].name])&&J(a,"title",b)},d(w){w&&Ft(a),E=!1,h()}}}function d1(e){let t,a;return{c(){t=qe("img"),J(t,"class","custom-emoji"),Xr(t.src,a=e[63].url)||J(t,"src",a),J(t,"alt",""),J(t,"loading","lazy")},m(n,d){Pt(n,t,d)},p(n,d){d[0]&32768&&!Xr(t.src,a=n[63].url)&&J(t,"src",a)},d(n){n&&Ft(t)}}}function m1(e){let t=e[27](e[63],e[8])+"",a;return{c(){a=Gt(t)},m(n,d){Pt(n,a,d)},p(n,d){d[0]&33024&&t!==(t=n[27](n[63],n[8])+"")&&Kt(a,t)},d(n){n&&Ft(a)}}}function Mn(e,t){let a,n,d,o,k,C,L;function b(R,w){return R[63].unicode?m1:d1}let E=b(t),h=E(t);return{key:e,first:null,c(){a=qe("button"),h.c(),J(a,"role",n=t[4]?"option":"menuitem"),J(a,"aria-selected",d=t[4]?t[65]==t[5]:""),J(a,"aria-label",o=t[28](t[63],t[8])),J(a,"title",k=t[63].title),J(a,"class",C="emoji "+(t[4]&&t[65]===t[5]?"active":"")),J(a,"id",L="emo-"+t[63].id),this.first=a},m(R,w){Pt(R,a,w),h.m(a,null)},p(R,w){t=R,E===(E=b(t))&&h?h.p(t,w):(h.d(1),h=E(t),h&&(h.c(),h.m(a,null))),w[0]&16&&n!==(n=t[4]?"option":"menuitem")&&J(a,"role",n),w[0]&32816&&d!==(d=t[4]?t[65]==t[5]:"")&&J(a,"aria-selected",d),w[0]&33024&&o!==(o=t[28](t[63],t[8]))&&J(a,"aria-label",o),w[0]&32768&&k!==(k=t[63].title)&&J(a,"title",k),w[0]&32816&&C!==(C="emoji "+(t[4]&&t[65]===t[5]?"active":""))&&J(a,"class",C),w[0]&32768&&L!==(L="emo-"+t[63].id)&&J(a,"id",L)},d(R){R&&Ft(a),h.d()}}}function Rn(e,t){let a,n=(t[4]?t[0].searchResultsLabel:t[66].category?t[66].category:t[15].length>1?t[0].categories.custom:t[0].categories[t[13].name])+"",d,o,k,C,L=[],b=new _r,E,h,R,w=t[66].emojis;const s=F=>F[63].id;for(let F=0;F<w.length;F+=1){let H=xn(t,w,F),V=s(H);b.set(V,L[F]=Mn(V,H))}return{key:e,first:null,c(){a=qe("div"),d=Gt(n),C=qe("div");for(let F=0;F<L.length;F+=1)L[F].c();J(a,"id",o="menu-label-"+t[65]),J(a,"class",k="category "+(t[15].length===1&&t[15][0].category===""?"gone":"")),J(a,"aria-hidden","true"),J(C,"class","emoji-menu"),J(C,"role",E=t[4]?"listbox":"menu"),J(C,"aria-labelledby",h="menu-label-"+t[65]),J(C,"id",R=t[4]?"search-results":""),this.first=a},m(F,H){Pt(F,a,H),Ge(a,d),Pt(F,C,H);for(let V=0;V<L.length;V+=1)L[V].m(C,null)},p(F,H){t=F,H[0]&40977&&n!==(n=(t[4]?t[0].searchResultsLabel:t[66].category?t[66].category:t[15].length>1?t[0].categories.custom:t[0].categories[t[13].name])+"")&&Kt(d,n),H[0]&32768&&o!==(o="menu-label-"+t[65])&&J(a,"id",o),H[0]&32768&&k!==(k="category "+(t[15].length===1&&t[15][0].category===""?"gone":""))&&J(a,"class",k),H[0]&402686256&&(w=t[66].emojis,L=fr(L,H,s,1,t,w,b,C,ur,Mn,null,xn)),H[0]&16&&E!==(E=t[4]?"listbox":"menu")&&J(C,"role",E),H[0]&32768&&h!==(h="menu-label-"+t[65])&&J(C,"aria-labelledby",h),H[0]&16&&R!==(R=t[4]?"search-results":"")&&J(C,"id",R)},d(F){F&&Ft(a),F&&Ft(C);for(let H=0;H<L.length;H+=1)L[H].d()}}}function h1(e){let t,a;return{c(){t=qe("img"),J(t,"class","custom-emoji"),Xr(t.src,a=e[63].url)||J(t,"src",a),J(t,"alt",""),J(t,"loading","lazy")},m(n,d){Pt(n,t,d)},p(n,d){d[0]&1024&&!Xr(t.src,a=n[63].url)&&J(t,"src",a)},d(n){n&&Ft(t)}}}function u1(e){let t=e[27](e[63],e[8])+"",a;return{c(){a=Gt(t)},m(n,d){Pt(n,a,d)},p(n,d){d[0]&1280&&t!==(t=n[27](n[63],n[8])+"")&&Kt(a,t)},d(n){n&&Ft(a)}}}function An(e,t){let a,n,d,o;function k(b,E){return b[63].unicode?u1:h1}let C=k(t),L=C(t);return{key:e,first:null,c(){a=qe("button"),L.c(),J(a,"role","menuitem"),J(a,"aria-label",n=t[28](t[63],t[8])),J(a,"title",d=t[63].title),J(a,"class","emoji"),J(a,"id",o="fav-"+t[63].id),this.first=a},m(b,E){Pt(b,a,E),L.m(a,null)},p(b,E){t=b,C===(C=k(t))&&L?L.p(t,E):(L.d(1),L=C(t),L&&(L.c(),L.m(a,null))),E[0]&1280&&n!==(n=t[28](t[63],t[8]))&&J(a,"aria-label",n),E[0]&1024&&d!==(d=t[63].title)&&J(a,"title",d),E[0]&1024&&o!==(o="fav-"+t[63].id)&&J(a,"id",o)},d(b){b&&Ft(a),L.d()}}}function f1(e){let t,a,n,d,o,k,C,L,b,E=e[0].searchLabel+"",h,R,w=e[0].searchDescription+"",s,F,H,V,c,T,N,M=e[0].skinToneDescription+"",O,l,x=[],y=new _r,m,f,p,u,v,_=[],I=new _r,G,D,z,i,g,K,W,ie,he=[],ue=new _r,de,Se,ve,ce,Re,He=[],Oe=new _r,Ue,Pe,Fe,Ze,pt,lt,rt=e[9];const vt=le=>le[72];for(let le=0;le<rt.length;le+=1){let ge=kn(e,rt,le),te=vt(ge);y.set(te,x[le]=Sn(te,ge))}let Et=e[12];const Bt=le=>le[69].id;for(let le=0;le<Et.length;le+=1){let ge=wn(e,Et,le),te=Bt(ge);I.set(te,_[le]=En(te,ge))}let it=e[15];const Ht=le=>le[66].category;for(let le=0;le<it.length;le+=1){let ge=yn(e,it,le),te=Ht(ge);ue.set(te,he[le]=Rn(te,ge))}let gt=e[10];const ct=le=>le[63].id;for(let le=0;le<gt.length;le+=1){let ge=bn(e,gt,le),te=ct(ge);Oe.set(te,He[le]=An(te,ge))}return{c(){t=qe("section"),a=qe("div"),n=qe("div"),d=qe("div"),o=qe("input"),b=qe("label"),h=Gt(E),R=qe("span"),s=Gt(w),F=qe("div"),H=qe("button"),V=Gt(e[21]),N=qe("span"),O=Gt(M),l=qe("div");for(let le=0;le<x.length;le+=1)x[le].c();v=qe("div");for(let le=0;le<_.length;le+=1)_[le].c();D=qe("div"),z=qe("div"),i=qe("div"),g=Gt(e[18]),W=qe("div"),ie=qe("div");for(let le=0;le<he.length;le+=1)he[le].c();Re=qe("div");for(let le=0;le<He.length;le+=1)He[le].c();Fe=qe("button"),Fe.textContent="\u{1F600}",J(a,"class","pad-top"),J(o,"id","search"),J(o,"class","search"),J(o,"type","search"),J(o,"role","combobox"),J(o,"enterkeyhint","search"),J(o,"placeholder",k=e[0].searchLabel),J(o,"autocapitalize","none"),J(o,"autocomplete","off"),J(o,"spellcheck","true"),J(o,"aria-expanded",C=!!(e[4]&&e[1].length)),J(o,"aria-controls","search-results"),J(o,"aria-describedby","search-description"),J(o,"aria-autocomplete","list"),J(o,"aria-activedescendant",L=e[26]?`emo-${e[26]}`:""),J(b,"class","sr-only"),J(b,"for","search"),J(R,"id","search-description"),J(R,"class","sr-only"),J(d,"class","search-wrapper"),J(H,"id","skintone-button"),J(H,"class",c="emoji "+(e[6]?"hide-focus":"")),J(H,"aria-label",e[23]),J(H,"title",e[23]),J(H,"aria-describedby","skintone-description"),J(H,"aria-haspopup","listbox"),J(H,"aria-expanded",e[6]),J(H,"aria-controls","skintone-list"),J(F,"class",T="skintone-button-wrapper "+(e[19]?"expanded":"")),J(N,"id","skintone-description"),J(N,"class","sr-only"),J(l,"id","skintone-list"),J(l,"class",m="skintone-list "+(e[6]?"":"hidden no-animate")),oa(l,"transform","translateY("+(e[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),J(l,"role","listbox"),J(l,"aria-label",f=e[0].skinTonesLabel),J(l,"aria-activedescendant",p="skintone-"+e[20]),J(l,"aria-hidden",u=!e[6]),J(n,"class","search-row"),J(v,"class","nav"),J(v,"role","tablist"),oa(v,"grid-template-columns","repeat("+e[12].length+", 1fr)"),J(v,"aria-label",G=e[0].categoriesLabel),J(z,"class","indicator"),oa(z,"transform","translateX("+(e[24]?-1:1)*e[11]*100+"%)"),J(D,"class","indicator-wrapper"),J(i,"class",K="message "+(e[18]?"":"gone")),J(i,"role","alert"),J(i,"aria-live","polite"),J(W,"class",de="tabpanel "+(!e[14]||e[18]?"gone":"")),J(W,"role",Se=e[4]?"region":"tabpanel"),J(W,"aria-label",ve=e[4]?e[0].searchResultsLabel:e[0].categories[e[13].name]),J(W,"id",ce=e[4]?"":`tab-${e[13].id}`),J(W,"tabindex","0"),J(Re,"class",Ue="favorites emoji-menu "+(e[18]?"gone":"")),J(Re,"role","menu"),J(Re,"aria-label",Pe=e[0].favoritesLabel),oa(Re,"padding-inline-end",e[25]+"px"),J(Fe,"aria-hidden","true"),J(Fe,"tabindex","-1"),J(Fe,"class","abs-pos hidden emoji"),J(t,"class","picker"),J(t,"aria-label",Ze=e[0].regionLabel),J(t,"style",e[22])},m(le,ge){Pt(le,t,ge),Ge(t,a),Ge(t,n),Ge(n,d),Ge(d,o),on(o,e[2]),Ge(d,b),Ge(b,h),Ge(d,R),Ge(R,s),Ge(n,F),Ge(F,H),Ge(H,V),Ge(n,N),Ge(N,O),Ge(n,l);for(let te=0;te<x.length;te+=1)x[te].m(l,null);e[48](l),Ge(t,v);for(let te=0;te<_.length;te+=1)_[te].m(v,null);Ge(t,D),Ge(D,z),Ge(t,i),Ge(i,g),Ge(t,W),Ge(W,ie);for(let te=0;te<he.length;te+=1)he[te].m(ie,null);e[50](W),Ge(t,Re);for(let te=0;te<He.length;te+=1)He[te].m(Re,null);Ge(t,Fe),e[51](Fe),e[52](t),pt||(lt=[Dt(o,"input",e[47]),Dt(o,"keydown",e[30]),Dt(H,"click",e[35]),Dt(l,"focusout",e[38]),Dt(l,"click",e[34]),Dt(l,"keydown",e[36]),Dt(l,"keyup",e[37]),Dt(v,"keydown",e[32]),Cc(e[29].call(null,ie)),Dt(W,"click",e[33]),Dt(Re,"click",e[33])],pt=!0)},p(le,ge){ge[0]&1&&k!==(k=le[0].searchLabel)&&J(o,"placeholder",k),ge[0]&18&&C!==(C=!!(le[4]&&le[1].length))&&J(o,"aria-expanded",C),ge[0]&67108864&&L!==(L=le[26]?`emo-${le[26]}`:"")&&J(o,"aria-activedescendant",L),ge[0]&4&&on(o,le[2]),ge[0]&1&&E!==(E=le[0].searchLabel+"")&&Kt(h,E),ge[0]&1&&w!==(w=le[0].searchDescription+"")&&Kt(s,w),ge[0]&2097152&&Kt(V,le[21]),ge[0]&64&&c!==(c="emoji "+(le[6]?"hide-focus":""))&&J(H,"class",c),ge[0]&8388608&&J(H,"aria-label",le[23]),ge[0]&8388608&&J(H,"title",le[23]),ge[0]&64&&J(H,"aria-expanded",le[6]),ge[0]&524288&&T!==(T="skintone-button-wrapper "+(le[19]?"expanded":""))&&J(F,"class",T),ge[0]&1&&M!==(M=le[0].skinToneDescription+"")&&Kt(O,M),ge[0]&1049089&&(rt=le[9],x=fr(x,ge,vt,1,le,rt,y,l,ur,Sn,null,kn)),ge[0]&64&&m!==(m="skintone-list "+(le[6]?"":"hidden no-animate"))&&J(l,"class",m),ge[0]&64&&oa(l,"transform","translateY("+(le[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),ge[0]&1&&f!==(f=le[0].skinTonesLabel)&&J(l,"aria-label",f),ge[0]&1048576&&p!==(p="skintone-"+le[20])&&J(l,"aria-activedescendant",p),ge[0]&64&&u!==(u=!le[6])&&J(l,"aria-hidden",u),ge[0]&12305|ge[1]&1&&(Et=le[12],_=fr(_,ge,Bt,1,le,Et,I,v,ur,En,null,wn)),ge[0]&4096&&oa(v,"grid-template-columns","repeat("+le[12].length+", 1fr)"),ge[0]&1&&G!==(G=le[0].categoriesLabel)&&J(v,"aria-label",G),ge[0]&16779264&&oa(z,"transform","translateX("+(le[24]?-1:1)*le[11]*100+"%)"),ge[0]&262144&&Kt(g,le[18]),ge[0]&262144&&K!==(K="message "+(le[18]?"":"gone"))&&J(i,"class",K),ge[0]&402694449&&(it=le[15],he=fr(he,ge,Ht,1,le,it,ue,ie,ur,Rn,null,yn)),ge[0]&278528&&de!==(de="tabpanel "+(!le[14]||le[18]?"gone":""))&&J(W,"class",de),ge[0]&16&&Se!==(Se=le[4]?"region":"tabpanel")&&J(W,"role",Se),ge[0]&8209&&ve!==(ve=le[4]?le[0].searchResultsLabel:le[0].categories[le[13].name])&&J(W,"aria-label",ve),ge[0]&8208&&ce!==(ce=le[4]?"":`tab-${le[13].id}`)&&J(W,"id",ce),ge[0]&402654464&&(gt=le[10],He=fr(He,ge,ct,1,le,gt,Oe,Re,ur,An,null,bn)),ge[0]&262144&&Ue!==(Ue="favorites emoji-menu "+(le[18]?"gone":""))&&J(Re,"class",Ue),ge[0]&1&&Pe!==(Pe=le[0].favoritesLabel)&&J(Re,"aria-label",Pe),ge[0]&33554432&&oa(Re,"padding-inline-end",le[25]+"px"),ge[0]&1&&Ze!==(Ze=le[0].regionLabel)&&J(t,"aria-label",Ze),ge[0]&4194304&&J(t,"style",le[22])},i:cr,o:cr,d(le){le&&Ft(t);for(let ge=0;ge<x.length;ge+=1)x[ge].d();e[48](null);for(let ge=0;ge<_.length;ge+=1)_[ge].d();for(let ge=0;ge<he.length;ge+=1)he[ge].d();e[50](null);for(let ge=0;ge<He.length;ge+=1)He[ge].d();e[51](null),e[52](null),pt=!1,dr(lt)}}}function _1(e,t,a){let{skinToneEmoji:n}=t,{i18n:d}=t,{database:o}=t,{customEmoji:k}=t,{customCategorySorting:C}=t,L=!0,b=[],E=[],h="",R="",w,s,F,H=!1,V=-1,c,T=!1,N=!1,M,O=0,l=0,x,y,m="",f=[],p=[],u,v=Gc,_=!1,I=0,G=0,D=Zr,z,i=!1,g;const K=te=>{w.getRootNode().getElementById(te).focus()},W=(te,ye)=>{w.dispatchEvent(new CustomEvent(te,{detail:ye,bubbles:!0,composed:!0}))},ie=(te,ye)=>ye&&te.skins&&te.skins[ye]||te.unicode,he=(te,ye)=>c1([te.name||ie(te,ye),...te.shortcodes||[]]).join(", "),ue=te=>/^skintone-/.test(te.id);Ps.then(te=>{te||a(18,c=d.emojiUnsupportedMessage)});function de(te){return i1(te,ye=>{{const S=getComputedStyle(w),B=parseInt(S.getPropertyValue("--num-columns"),10),P=S.getPropertyValue("direction")==="rtl",Y=te.parentElement.getBoundingClientRect().width-ye;a(46,v=B),a(25,I=Y),a(24,_=P)}})}function Se(te){const ye=w.getRootNode();l1(te,s,B=>ye.getElementById(`emo-${B.id}`)),a(1,b=b)}function ve(te){return!te.unicode||!fn(te)||Fs.get(te.unicode)}async function ce(te){const ye=await Ps;return te.filter(({version:S})=>!S||S<=ye)}async function Re(te){return o1(te,await Ps)}async function He(te){if(typeof te=="undefined")return[];const ye=te===-1?k:await o.getEmojiByGroup(te);return Re(await ce(ye))}async function Oe(te){return Re(await ce(await o.getEmojiBySearchQuery(te)))}function Ue(te){if(!H||!b.length)return;const ye=S=>{na(te),a(5,V=Ds(S,V,b))};switch(te.key){case"ArrowDown":return ye(!1);case"ArrowUp":return ye(!0);case"Enter":if(V!==-1)return na(te),Ze(b[V].id);b.length&&a(5,V=0)}}function Pe(te){a(2,h=""),a(44,R=""),a(5,V=-1),a(11,G=D.findIndex(ye=>ye.id===te.id))}function Fe(te){const{target:ye,key:S}=te,B=P=>{P&&(na(te),P.focus())};switch(S){case"ArrowLeft":return B(ye.previousSibling);case"ArrowRight":return B(ye.nextSibling);case"Home":return B(ye.parentElement.firstChild);case"End":return B(ye.parentElement.lastChild)}}async function Ze(te){const ye=await o.getEmojiByUnicodeOrName(te),S=[...b,...p].find(P=>P.id===te),B=S.unicode&&ie(S,O);await o.incrementFavoriteEmojiCount(te),W("emoji-click",{emoji:ye,skinTone:O,...B&&{unicode:B},...S.name&&{name:S.name}})}async function pt(te){const{target:ye}=te;if(!ye.classList.contains("emoji"))return;na(te);const S=ye.id.substring(4);Ze(S)}async function lt(te){const{target:ye}=te;if(!ue(ye))return;na(te);const S=parseInt(ye.id.slice(9),10);a(8,O=S),a(6,T=!1),K("skintone-button"),W("skin-tone-change",{skinTone:S}),o.setPreferredSkinTone(S)}async function rt(te){a(6,T=!T),a(20,l=O),T&&(na(te),Wr(()=>K(`skintone-${l}`)))}function vt(te){if(!T)return;const ye=async S=>{na(te),a(20,l=S),await Oc(),K(`skintone-${l}`)};switch(te.key){case"ArrowUp":return ye(Ds(!0,l,f));case"ArrowDown":return ye(Ds(!1,l,f));case"Home":return ye(0);case"End":return ye(f.length-1);case"Enter":return lt(te);case"Escape":return na(te),a(6,T=!1),K("skintone-button")}}function Et(te){if(!!T)switch(te.key){case" ":return lt(te)}}async function Bt(te){const{relatedTarget:ye}=te;(!ye||!ue(ye))&&a(6,T=!1)}function it(){h=this.value,a(2,h)}function Ht(te){Ha[te?"unshift":"push"](()=>{M=te,a(7,M)})}const gt=te=>Pe(te);function ct(te){Ha[te?"unshift":"push"](()=>{F=te,a(3,F)})}function le(te){Ha[te?"unshift":"push"](()=>{s=te,a(17,s)})}function ge(te){Ha[te?"unshift":"push"](()=>{w=te,a(16,w)})}return e.$$set=te=>{"skinToneEmoji"in te&&a(40,n=te.skinToneEmoji),"i18n"in te&&a(0,d=te.i18n),"database"in te&&a(39,o=te.database),"customEmoji"in te&&a(41,k=te.customEmoji),"customCategorySorting"in te&&a(42,C=te.customCategorySorting)},e.$$.update=()=>{if(e.$$.dirty[1]&1280&&k&&o&&a(39,o.customEmoji=k,o),e.$$.dirty[0]&1|e.$$.dirty[1]&256){async function te(){let ye=!1;const S=setTimeout(()=>{ye=!0,a(18,c=d.loadingMessage)},Yc);try{await o.ready(),a(14,i=!0)}catch(B){console.error(B),a(18,c=d.networkErrorMessage)}finally{clearTimeout(S),ye&&(ye=!1,a(18,c=""))}}o&&te()}if(e.$$.dirty[0]&6144|e.$$.dirty[1]&1024&&(k&&k.length?a(12,D=[Uc,...Zr]):D!==Zr&&(G&&a(11,G--,G),a(12,D=Zr))),e.$$.dirty[0]&4&&un(()=>{a(44,R=(h||"").trim()),a(5,V=-1)}),e.$$.dirty[0]&6144&&a(13,z=D[G]),e.$$.dirty[0]&24576|e.$$.dirty[1]&8192){async function te(){if(!i)a(1,b=[]),a(4,H=!1);else if(R.length>=zc){const ye=R,S=await Oe(ye);ye===R&&(a(1,b=S),a(4,H=!0))}else if(z){const ye=z.id,S=await He(ye);ye===z.id&&(a(1,b=S),a(4,H=!1))}}te()}if(e.$$.dirty[0]&4112&&a(22,y=`
  --font-family: ${_n};
  --num-groups: ${D.length}; 
  --indicator-opacity: ${H?0:1}; 
  --num-skintones: ${hn};`),e.$$.dirty[0]&16384|e.$$.dirty[1]&256){async function te(){i&&a(8,O=await o.getPreferredSkinTone())}te()}if(e.$$.dirty[1]&512&&a(9,f=Array(hn).fill().map((te,ye)=>s1(n,ye))),e.$$.dirty[0]&768&&a(21,x=f[O]),e.$$.dirty[0]&257&&a(23,m=d.skinToneLabel.replace("{skinTone}",d.skinTones[O])),e.$$.dirty[0]&16384|e.$$.dirty[1]&256){async function te(){a(45,u=(await Promise.all(Kc.map(ye=>o.getEmojiByUnicodeOrName(ye)))).filter(Boolean))}i&&te()}if(e.$$.dirty[0]&16384|e.$$.dirty[1]&49408){async function te(){const ye=await o.getTopFavoriteEmoji(v),S=await Re(vn([...ye,...u],B=>B.unicode||B.name).slice(0,v));a(10,p=S)}i&&u&&te()}if(e.$$.dirty[0]&10){const te=b.filter(ye=>ye.unicode).filter(ye=>fn(ye)&&!Fs.has(ye.unicode));te.length?Wr(()=>Se(te)):(a(1,b=b.filter(ve)),Wr(()=>{(F||{}).scrollTop=0}))}e.$$.dirty[0]&1026|e.$$.dirty[1]&4096,e.$$.dirty[0]&18|e.$$.dirty[1]&2048&&a(15,E=function(){if(H)return[{category:"",emojis:b}];const ye=new Map;for(const S of b){const B=S.category||"";let P=ye.get(B);P||(P=[],ye.set(B,P)),P.push(S)}return[...ye.entries()].map(([S,B])=>({category:S,emojis:B})).sort((S,B)=>C(S.category,B.category))}()),e.$$.dirty[0]&34&&a(26,g=V!==-1&&b[V].id),e.$$.dirty[0]&192&&(T?M.addEventListener("transitionend",()=>{a(19,N=!0)},{once:!0}):a(19,N=!1))},[d,b,h,F,H,V,T,M,O,f,p,G,D,z,i,E,w,s,c,N,l,x,y,m,_,I,g,ie,he,de,Ue,Pe,Fe,pt,lt,rt,vt,Et,Bt,o,n,k,C,L,R,u,v,it,Ht,gt,ct,le,ge]}class p1 extends Dc{constructor(t){super(),Fc(this,t,_1,f1,Tc,{skinToneEmoji:40,i18n:0,database:39,customEmoji:41,customCategorySorting:42},null,[-1,-1,-1])}}const v1="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",g1="en";var b1={categoriesLabel:"Categories",emojiUnsupportedMessage:"Your browser does not support color emoji.",favoritesLabel:"Favorites",loadingMessage:"Loading\u2026",networkErrorMessage:"Could not load emoji.",regionLabel:"Emoji picker",searchDescription:"When search results are available, press up or down to select and enter to choose.",searchLabel:"Search",searchResultsLabel:"Search results",skinToneDescription:"When expanded, press up or down to select and enter to choose.",skinToneLabel:"Choose a skin tone (currently {skinTone})",skinTonesLabel:"Skin tones",skinTones:["Default","Light","Medium-Light","Medium","Medium-Dark","Dark"],categories:{custom:"Custom","smileys-emotion":"Smileys and emoticons","people-body":"People and body","animals-nature":"Animals and nature","food-drink":"Food and drink","travel-places":"Travel and places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"}};const Tn=["customEmoji","customCategorySorting","database","dataSource","i18n","locale","skinToneEmoji"];class Bn extends HTMLElement{constructor(t){super(),this.attachShadow({mode:"open"});const a=document.createElement("style");a.textContent=":host{--emoji-size:1.375rem;--emoji-padding:0.5rem;--category-emoji-size:var(--emoji-size);--category-emoji-padding:var(--emoji-padding);--indicator-height:3px;--input-border-radius:0.5rem;--input-border-size:1px;--input-font-size:1rem;--input-line-height:1.5;--input-padding:0.25rem;--num-columns:8;--outline-size:2px;--border-size:1px;--skintone-border-radius:1rem;--category-font-size:1rem;display:flex;width:min-content;height:400px}:host,:host(.light){--background:#fff;--border-color:#e0e0e0;--indicator-color:#385ac1;--input-border-color:#999;--input-font-color:#111;--input-placeholder-color:#999;--outline-color:#999;--category-font-color:#111;--button-active-background:#e6e6e6;--button-hover-background:#d9d9d9}:host(.dark){--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}@media (prefers-color-scheme:dark){:host{--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}}:host([hidden]){display:none}button{margin:0;padding:0;border:0;background:0 0;box-shadow:none;-webkit-tap-highlight-color:transparent}button::-moz-focus-inner{border:0}input{padding:0;margin:0;line-height:1.15;font-family:inherit}input[type=search]{-webkit-appearance:none}:focus{outline:var(--outline-color) solid var(--outline-size);outline-offset:calc(-1*var(--outline-size))}:host([data-js-focus-visible]) :focus:not([data-focus-visible-added]){outline:0}:focus:not(:focus-visible){outline:0}.hide-focus{outline:0}*{box-sizing:border-box}.picker{contain:content;display:flex;flex-direction:column;background:var(--background);border:var(--border-size) solid var(--border-color);width:100%;height:100%;overflow:hidden;--total-emoji-size:calc(var(--emoji-size) + (2 * var(--emoji-padding)));--total-category-emoji-size:calc(var(--category-emoji-size) + (2 * var(--category-emoji-padding)))}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.hidden{opacity:0;pointer-events:none}.abs-pos{position:absolute;left:0;top:0}.gone{display:none!important}.skintone-button-wrapper,.skintone-list{background:var(--background);z-index:3}.skintone-button-wrapper.expanded{z-index:1}.skintone-list{position:absolute;inset-inline-end:0;top:0;z-index:2;overflow:visible;border-bottom:var(--border-size) solid var(--border-color);border-radius:0 0 var(--skintone-border-radius) var(--skintone-border-radius);will-change:transform;transition:transform .2s ease-in-out;transform-origin:center 0}@media (prefers-reduced-motion:reduce){.skintone-list{transition-duration:.001s}}@supports not (inset-inline-end:0){.skintone-list{right:0}}.skintone-list.no-animate{transition:none}.tabpanel{overflow-y:auto;-webkit-overflow-scrolling:touch;will-change:transform;min-height:0;flex:1;contain:content}.emoji-menu{display:grid;grid-template-columns:repeat(var(--num-columns),var(--total-emoji-size));justify-content:space-around;align-items:flex-start;width:100%}.category{padding:var(--emoji-padding);font-size:var(--category-font-size);color:var(--category-font-color)}.custom-emoji,.emoji,button.emoji{height:var(--total-emoji-size);width:var(--total-emoji-size)}.emoji,button.emoji{font-size:var(--emoji-size);display:flex;align-items:center;justify-content:center;border-radius:100%;line-height:1;overflow:hidden;font-family:var(--font-family);cursor:pointer}@media (hover:hover) and (pointer:fine){.emoji:hover,button.emoji:hover{background:var(--button-hover-background)}}.emoji.active,.emoji:active,button.emoji.active,button.emoji:active{background:var(--button-active-background)}.custom-emoji{padding:var(--emoji-padding);object-fit:contain;pointer-events:none;background-repeat:no-repeat;background-position:center center;background-size:var(--emoji-size) var(--emoji-size)}.nav,.nav-button{align-items:center}.nav{display:grid;justify-content:space-between;contain:content}.nav-button{display:flex;justify-content:center}.nav-emoji{font-size:var(--category-emoji-size);width:var(--total-category-emoji-size);height:var(--total-category-emoji-size)}.indicator-wrapper{display:flex;border-bottom:1px solid var(--border-color)}.indicator{width:calc(100%/var(--num-groups));height:var(--indicator-height);opacity:var(--indicator-opacity);background-color:var(--indicator-color);will-change:transform,opacity;transition:opacity .1s linear,transform .25s ease-in-out}@media (prefers-reduced-motion:reduce){.indicator{will-change:opacity;transition:opacity .1s linear}}.pad-top,input.search{background:var(--background);width:100%}.pad-top{height:var(--emoji-padding);z-index:3}.search-row{display:flex;align-items:center;position:relative;padding-inline-start:var(--emoji-padding);padding-bottom:var(--emoji-padding)}.search-wrapper{flex:1;min-width:0}input.search{padding:var(--input-padding);border-radius:var(--input-border-radius);border:var(--input-border-size) solid var(--input-border-color);color:var(--input-font-color);font-size:var(--input-font-size);line-height:var(--input-line-height)}input.search::placeholder{color:var(--input-placeholder-color)}.favorites{display:flex;flex-direction:row;border-top:var(--border-size) solid var(--border-color);contain:content}.message{padding:var(--emoji-padding)}",this.shadowRoot.appendChild(a),this._ctx={locale:g1,dataSource:v1,skinToneEmoji:Xc,customCategorySorting:Zc,customEmoji:null,i18n:b1,...t};for(const n of Tn)n!=="database"&&Object.prototype.hasOwnProperty.call(this,n)&&(this._ctx[n]=this[n],delete this[n]);this._dbFlush()}connectedCallback(){this._cmp=new p1({target:this.shadowRoot,props:this._ctx})}disconnectedCallback(){this._cmp.$destroy(),this._cmp=void 0;const{database:t}=this._ctx;t&&t.close().catch(a=>console.error(a))}static get observedAttributes(){return["locale","data-source","skin-tone-emoji"]}attributeChangedCallback(t,a,n){this._set(t.replace(/-([a-z])/g,(d,o)=>o.toUpperCase()),n)}_set(t,a){this._ctx[t]=a,this._cmp&&this._cmp.$set({[t]:a}),["locale","dataSource"].includes(t)&&this._dbFlush()}_dbCreate(){const{locale:t,dataSource:a,database:n}=this._ctx;(!n||n.locale!==t||n.dataSource!==a)&&this._set("database",new tn({locale:t,dataSource:a}))}_dbFlush(){Promise.resolve().then(()=>this._dbCreate())}}const Cn={};for(const e of Tn)Cn[e]={get(){return e==="database"&&this._dbCreate(),this._ctx[e]},set(t){if(e==="database")throw new Error("database is read-only");this._set(e,t)}};Object.defineProperties(Bn.prototype,Cn),customElements.get("emoji-picker")||customElements.define("emoji-picker",Bn);const y1={name:"EmojiPickerContainer",components:{SvgIcon:mt},props:{emojiOpened:{type:Boolean,default:!1},emojiReaction:{type:Boolean,default:!1},positionTop:{type:Boolean,default:!1},positionRight:{type:Boolean,default:!1},messageId:{type:String,default:""}},emits:["add-emoji","open-emoji"],data(){return{emojiPickerHeight:320,emojiPickerTop:0,emojiPickerRight:""}},watch:{emojiOpened(e){e&&setTimeout(()=>{this.addCustomStyling(),this.$refs.emojiPicker.shadowRoot.addEventListener("emoji-click",({detail:t})=>{this.$emit("add-emoji",{unicode:t.unicode})})},0)}},methods:{addCustomStyling(){const e=`.picker {
				border: none;
			}`,t=`.nav {
				overflow-x: auto;
			}`,a=`.search-wrapper {
				padding-right: 2px;
				padding-left: 2px;
			}`,n=`input.search {
				height: 32px;
				font-size: 14px;
				border-radius: 10rem;
				border: var(--chat-border-style);
				padding: 5px 10px;
				outline: none;
				background: var(--chat-bg-color-input);
				color: var(--chat-color);
			}`,d=document.createElement("style");d.textContent=e+t+a+n,this.$refs.emojiPicker.shadowRoot.appendChild(d)},openEmoji(e){this.$emit("open-emoji",!this.emojiOpened),this.setEmojiPickerPosition(e.clientY,e.view.innerWidth,e.view.innerHeight)},setEmojiPickerPosition(e,t,a){const n=t<500||a<700,d=document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer");if(!d){n&&(this.emojiPickerRight="-50px");return}n?(this.emojiPickerRight=t/2-(this.positionTop?200:150)+"px",this.emojiPickerTop=100,this.emojiPickerHeight=a-200):(d.getBoundingClientRect().top-e>this.emojiPickerHeight-50?this.emojiPickerTop=e+10:this.emojiPickerTop=e-this.emojiPickerHeight-10,this.emojiPickerRight=this.positionTop?"0px":this.positionRight?"60px":"")}}},x1={class:"vac-emoji-wrapper"},w1={ref:"emojiPicker","v-if":"emojiOpened"};function k1(e,t,a,n,d,o){const k=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",x1,[r.createElementVNode("div",{class:r.normalizeClass(["vac-svg-button",{"vac-emoji-reaction":a.emojiReaction}]),onClick:t[0]||(t[0]=(...C)=>o.openEmoji&&o.openEmoji(...C))},[r.renderSlot(e.$slots,a.messageId?"emoji-picker-reaction-icon_"+a.messageId:"emoji-picker-icon",{},()=>[r.createVNode(k,{name:"emoji",param:a.emojiReaction?"reaction":""},null,8,["param"])])],2),a.emojiOpened?(r.openBlock(),r.createBlock(r.Transition,{key:0,name:"vac-slide-up",appear:""},{default:r.withCtx(()=>[r.createElementVNode("div",{class:r.normalizeClass(["vac-emoji-picker",{"vac-picker-reaction":a.emojiReaction}]),style:r.normalizeStyle({height:`${d.emojiPickerHeight}px`,top:a.positionTop?d.emojiPickerHeight:`${d.emojiPickerTop}px`,right:d.emojiPickerRight,display:d.emojiPickerTop||!a.emojiReaction?"initial":"none"})},[r.createElementVNode("emoji-picker",w1,null,512)],6)]),_:1})):r.createCommentVNode("",!0)])}var On=Ye(y1,[["render",k1]]);const S1={name:"RoomFiles",components:{Loader:Rr,SvgIcon:mt},props:{file:{type:Object,required:!0},index:{type:Number,required:!0}},emits:["remove-file"],computed:{isImage(){return La(this.file)},isVideo(){return ir(this.file)}}},E1={class:"vac-room-file-container"},M1=["src"],R1={class:"vac-text-ellipsis"},A1={key:0,class:"vac-text-ellipsis vac-text-extension"};function T1(e,t,a,n,d,o){const k=r.resolveComponent("loader"),C=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",E1,[r.createVNode(k,{show:a.file.loading,type:"room-file"},r.createSlots({_:2},[r.renderList(e.$slots,(L,b)=>({name:b,fn:r.withCtx(E=>[r.renderSlot(e.$slots,b,r.normalizeProps(r.guardReactiveProps(E)))])}))]),1032,["show"]),r.createElementVNode("div",{class:"vac-svg-button vac-icon-remove",onClick:t[0]||(t[0]=L=>e.$emit("remove-file",a.index))},[r.renderSlot(e.$slots,"image-close-icon",{},()=>[r.createVNode(C,{name:"close",param:"image"})])]),o.isImage?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-message-image",{"vac-blur-loading":a.file.loading}]),style:r.normalizeStyle({"background-image":`url('${a.file.localUrl||a.file.url}')`})},null,6)):o.isVideo?(r.openBlock(),r.createElementBlock("video",{key:1,controls:"",class:r.normalizeClass({"vac-blur-loading":a.file.loading})},[r.createElementVNode("source",{src:a.file.localUrl||a.file.url},null,8,M1)],2)):(r.openBlock(),r.createElementBlock("div",{key:2,class:r.normalizeClass(["vac-file-container",{"vac-blur-loading":a.file.loading}])},[r.createElementVNode("div",null,[r.renderSlot(e.$slots,"file-icon",{},()=>[r.createVNode(C,{name:"file"})])]),r.createElementVNode("div",R1,r.toDisplayString(a.file.name),1),a.file.extension?(r.openBlock(),r.createElementBlock("div",A1,r.toDisplayString(a.file.extension),1)):r.createCommentVNode("",!0)],2))])}var B1=Ye(S1,[["render",T1]]);const C1={name:"RoomFiles",components:{SvgIcon:mt,RoomFile:B1},props:{files:{type:Array,required:!0}},emits:["remove-file","reset-message"],computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight}}},O1={class:"vac-files-box"},N1={class:"vac-icon-close"};function L1(e,t,a,n,d,o){const k=r.resolveComponent("room-file"),C=r.resolveComponent("svg-icon");return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.files.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-room-files-container",style:r.normalizeStyle({bottom:`${o.footerHeight}px`})},[r.createElementVNode("div",O1,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.files,(L,b)=>(r.openBlock(),r.createElementBlock("div",{key:b},[r.createVNode(k,{file:L,index:b,onRemoveFile:t[0]||(t[0]=E=>e.$emit("remove-file",E))},r.createSlots({_:2},[r.renderList(e.$slots,(E,h)=>({name:h,fn:r.withCtx(R=>[r.renderSlot(e.$slots,h,r.normalizeProps(r.guardReactiveProps(R)))])}))]),1032,["file","index"])]))),128))]),r.createElementVNode("div",N1,[r.createElementVNode("div",{class:"vac-svg-button",onClick:t[1]||(t[1]=L=>e.$emit("reset-message"))},[r.renderSlot(e.$slots,"files-close-icon",{},()=>[r.createVNode(C,{name:"close-outline"})])])])],4)):r.createCommentVNode("",!0)]),_:3})}var I1=Ye(C1,[["render",L1]]);const j1={props:{percentage:{type:Number,default:0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["hover-audio-progress","change-linehead"],data(){return{isMouseDown:!1}},methods:{onMouseDown(e){if(this.messageSelectionEnabled)return;this.isMouseDown=!0;const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)},onMouseUp(e){if(this.messageSelectionEnabled)return;this.isMouseDown=!1,document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove);const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t)},onMouseMove(e){if(this.messageSelectionEnabled)return;const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t)},calculateLineHeadPosition(e,t){const a=t.getBoundingClientRect().width,n=t.getBoundingClientRect().left;let d=(e.clientX-n)/a;return d=d<0?0:d,d=d>1?1:d,d}}},V1={class:"vac-player-progress"},H1={class:"vac-line-container"};function P1(e,t,a,n,d,o){return r.openBlock(),r.createElementBlock("div",{ref:"progress",class:"vac-player-bar",onMousedown:t[0]||(t[0]=(...k)=>o.onMouseDown&&o.onMouseDown(...k)),onMouseover:t[1]||(t[1]=k=>e.$emit("hover-audio-progress",!0)),onMouseout:t[2]||(t[2]=k=>e.$emit("hover-audio-progress",!1))},[r.createElementVNode("div",V1,[r.createElementVNode("div",H1,[r.createElementVNode("div",{class:"vac-line-progress",style:r.normalizeStyle({width:`${a.percentage}%`})},null,4),r.createElementVNode("div",{class:r.normalizeClass(["vac-line-dot",{"vac-line-dot__active":d.isMouseDown}]),style:r.normalizeStyle({left:`${a.percentage}%`})},null,6)])])],544)}var F1=Ye(j1,[["render",P1]]);const D1={name:"AudioPlayer",components:{SvgIcon:mt,AudioControl:F1},props:{messageId:{type:[String,Number],default:null},src:{type:String,default:null},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["hover-audio-progress","update-progress-time"],data(){return{isPlaying:!1,duration:this.convertTimeMMSS(0),playedTime:this.convertTimeMMSS(0),progress:0}},computed:{playerUniqId(){return`audio-player${this.messageId}`},audioSource(){return this.src?this.src:(this.resetProgress(),null)}},mounted(){this.player=document.querySelector("vue-advanced-chat").shadowRoot.getElementById(this.playerUniqId),this.player.addEventListener("ended",()=>{this.isPlaying=!1}),this.player.addEventListener("loadeddata",()=>{this.resetProgress(),this.duration=this.convertTimeMMSS(this.player.duration),this.updateProgressTime()}),this.player.addEventListener("timeupdate",this.onTimeUpdate)},methods:{convertTimeMMSS(e){return new Date(e*1e3).toISOString().substr(14,5)},playback(){this.messageSelectionEnabled||!this.audioSource||(this.isPlaying?this.player.pause():setTimeout(()=>this.player.play()),this.isPlaying=!this.isPlaying)},resetProgress(){this.isPlaying&&this.player.pause(),this.duration=this.convertTimeMMSS(0),this.playedTime=this.convertTimeMMSS(0),this.progress=0,this.isPlaying=!1,this.updateProgressTime()},onTimeUpdate(){this.playedTime=this.convertTimeMMSS(this.player.currentTime),this.progress=this.player.currentTime/this.player.duration*100,this.updateProgressTime()},onUpdateProgress(e){e&&(this.player.currentTime=e*this.player.duration)},updateProgressTime(){this.$emit("update-progress-time",this.progress>1?this.playedTime:this.duration)}}},U1={class:"vac-audio-player"},z1=["id","src"];function q1(e,t,a,n,d,o){const k=r.resolveComponent("svg-icon"),C=r.resolveComponent("audio-control");return r.openBlock(),r.createElementBlock("div",null,[r.createElementVNode("div",U1,[r.createElementVNode("div",{class:"vac-svg-button",onClick:t[0]||(t[0]=(...L)=>o.playback&&o.playback(...L))},[d.isPlaying?r.renderSlot(e.$slots,"audio-pause-icon_"+a.messageId,{key:0},()=>[r.createVNode(k,{name:"audio-pause"})]):r.renderSlot(e.$slots,"audio-play-icon_"+a.messageId,{key:1},()=>[r.createVNode(k,{name:"audio-play"})])]),r.createVNode(C,{percentage:d.progress,"message-selection-enabled":a.messageSelectionEnabled,onChangeLinehead:o.onUpdateProgress,onHoverAudioProgress:t[1]||(t[1]=L=>e.$emit("hover-audio-progress",L))},null,8,["percentage","message-selection-enabled","onChangeLinehead"]),r.createElementVNode("audio",{id:o.playerUniqId,src:o.audioSource},null,8,z1)])])}var zs=Ye(D1,[["render",q1]]);const Y1={name:"RoomMessageReply",components:{SvgIcon:mt,FormatMessage:or,AudioPlayer:zs},props:{room:{type:Object,required:!0},messageReply:{type:Object,default:null},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0}},emits:["reset-message"],computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight},firstFile(){var e,t;return(t=(e=this.messageReply)==null?void 0:e.files)!=null&&t.length?this.messageReply.files[0]:{}},isImage(){return La(this.firstFile)},isVideo(){return ir(this.firstFile)},isAudio(){return Hr(this.firstFile)},isOtherFile(){var e,t;return((t=(e=this.messageReply)==null?void 0:e.files)==null?void 0:t.length)&&!this.isAudio&&!this.isVideo&&!this.isImage}}},X1={class:"vac-reply-box"},G1={class:"vac-reply-info"},K1={class:"vac-reply-username"},Z1={class:"vac-reply-content"},W1=["src"],Q1={key:1,controls:"",class:"vac-image-reply"},J1=["src"],$1={key:3,class:"vac-image-reply vac-file-container"},ed={class:"vac-text-ellipsis"},td={key:0,class:"vac-text-ellipsis vac-text-extension"},ad={class:"vac-icon-reply"};function rd(e,t,a,n,d,o){const k=r.resolveComponent("format-message"),C=r.resolveComponent("audio-player"),L=r.resolveComponent("svg-icon");return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.messageReply?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-reply-container",style:r.normalizeStyle({bottom:`${o.footerHeight}px`})},[r.createElementVNode("div",X1,[r.createElementVNode("div",G1,[r.createElementVNode("div",K1,r.toDisplayString(a.messageReply.username),1),r.createElementVNode("div",Z1,[r.createVNode(k,{"message-id":a.messageReply._id,content:a.messageReply.content,users:a.room.users,"text-formatting":a.textFormatting,"link-options":a.linkOptions,reply:!0},null,8,["message-id","content","users","text-formatting","link-options"])])]),o.isImage?(r.openBlock(),r.createElementBlock("img",{key:0,src:o.firstFile.url,class:"vac-image-reply"},null,8,W1)):o.isVideo?(r.openBlock(),r.createElementBlock("video",Q1,[r.createElementVNode("source",{src:o.firstFile.url},null,8,J1)])):o.isAudio?(r.openBlock(),r.createBlock(C,{key:2,src:o.firstFile.url,"message-selection-enabled":!1,class:"vac-audio-reply"},r.createSlots({_:2},[r.renderList(e.$slots,(b,E)=>({name:E,fn:r.withCtx(h=>[r.renderSlot(e.$slots,E,r.normalizeProps(r.guardReactiveProps(h)))])}))]),1032,["src"])):o.isOtherFile?(r.openBlock(),r.createElementBlock("div",$1,[r.createElementVNode("div",null,[r.renderSlot(e.$slots,"file-icon",{},()=>[r.createVNode(L,{name:"file"})])]),r.createElementVNode("div",ed,r.toDisplayString(o.firstFile.name),1),o.firstFile.extension?(r.openBlock(),r.createElementBlock("div",td,r.toDisplayString(o.firstFile.extension),1)):r.createCommentVNode("",!0)])):r.createCommentVNode("",!0)]),r.createElementVNode("div",ad,[r.createElementVNode("div",{class:"vac-svg-button",onClick:t[0]||(t[0]=b=>e.$emit("reset-message"))},[r.renderSlot(e.$slots,"reply-close-icon",{},()=>[r.createVNode(L,{name:"close-outline"})])])])],4)):r.createCommentVNode("",!0)]),_:3})}var sd=Ye(Y1,[["render",rd]]);const od={name:"RoomUsersTag",props:{filteredUsersTag:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-user-tag","activate-item"],data(){return{activeItem:null}},computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight}},watch:{filteredUsersTag(e,t){(!t.length||e.length!==t.length)&&(this.activeItem=0)},selectItem(e){e&&this.$emit("select-user-tag",this.filteredUsersTag[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredUsersTag.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},nd=["onMouseover","onClick"],id={class:"vac-tags-info"},ld={class:"vac-tags-username"};function cd(e,t,a,n,d,o){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.filteredUsersTag.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-tags-container",style:r.normalizeStyle({bottom:`${o.footerHeight}px`})},[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.filteredUsersTag,(k,C)=>(r.openBlock(),r.createElementBlock("div",{key:k._id,class:r.normalizeClass(["vac-tags-box",{"vac-tags-box-active":C===d.activeItem}]),onMouseover:L=>d.activeItem=C,onClick:L=>e.$emit("select-user-tag",k)},[r.createElementVNode("div",id,[k.avatar?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-avatar vac-tags-avatar",style:r.normalizeStyle({"background-image":`url('${k.avatar}')`})},null,4)):r.createCommentVNode("",!0),r.createElementVNode("div",ld,r.toDisplayString(k.username),1)])],42,nd))),128))],4)):r.createCommentVNode("",!0)]),_:1})}var dd=Ye(od,[["render",cd]]);const md={name:"RoomEmojis",props:{filteredEmojis:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-emoji","activate-item"],data(){return{activeItem:null}},computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight}},watch:{filteredEmojis(e,t){(!t.length||e.length!==t.length)&&(this.activeItem=0)},selectItem(e){e&&this.$emit("select-emoji",this.filteredEmojis[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredEmojis.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},hd=["onMouseover","onClick"];function ud(e,t,a,n,d,o){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.filteredEmojis.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-emojis-container",style:r.normalizeStyle({bottom:`${o.footerHeight}px`})},[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.filteredEmojis,(k,C)=>(r.openBlock(),r.createElementBlock("div",{key:k,class:r.normalizeClass(["vac-emoji-element",{"vac-emoji-element-active":C===d.activeItem}]),onMouseover:L=>d.activeItem=C,onClick:L=>e.$emit("select-emoji",k)},r.toDisplayString(k),43,hd))),128))],4)):r.createCommentVNode("",!0)]),_:1})}var fd=Ye(md,[["render",ud]]);const _d={name:"RoomTemplatesText",props:{filteredTemplatesText:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-template-text","activate-item"],data(){return{activeItem:null}},computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight}},watch:{filteredTemplatesText(e,t){(!t.length||e.length!==t.length)&&(this.activeItem=0)},selectItem(e){e&&this.$emit("select-template-text",this.filteredTemplatesText[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredTemplatesText.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},pd=["onMouseover","onClick"],vd={class:"vac-template-info"},gd={class:"vac-template-tag"},bd={class:"vac-template-text"};function yd(e,t,a,n,d,o){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.filteredTemplatesText.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-template-container vac-app-box-shadow",style:r.normalizeStyle({bottom:`${o.footerHeight}px`})},[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.filteredTemplatesText,(k,C)=>(r.openBlock(),r.createElementBlock("div",{key:C,class:r.normalizeClass(["vac-template-box",{"vac-template-active":C===d.activeItem}]),onMouseover:L=>d.activeItem=C,onClick:L=>e.$emit("select-template-text",k)},[r.createElementVNode("div",vd,[r.createElementVNode("div",gd," /"+r.toDisplayString(k.tag),1),r.createElementVNode("div",bd,r.toDisplayString(k.text),1)])],42,pd))),128))],4)):r.createCommentVNode("",!0)]),_:1})}var xd=Ye(_d,[["render",yd]]);function wd(e){return new Int8Array(e)}function Nn(e){return new Int16Array(e)}function Ln(e){return new Int32Array(e)}function In(e){return new Float32Array(e)}function kd(e){return new Float64Array(e)}function jn(e){if(e.length==1)return In(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(jn(e));return a}function Vn(e){if(e.length==1)return Ln(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(Vn(e));return a}function Hn(e){if(e.length==1)return Nn(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(Hn(e));return a}function Pn(e){if(e.length==1)return new Array(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(Pn(e));return a}var Fn={};Fn.fill=function(e,t,a,n){if(arguments.length==2)for(var d=0;d<e.length;d++)e[d]=arguments[1];else for(var d=t;d<a;d++)e[d]=n};var pr={};pr.arraycopy=function(e,t,a,n,d){for(var o=t+d;t<o;)a[n++]=e[t++]},pr.out={},pr.out.println=function(e){console.log(e)},pr.out.printf=function(){console.log.apply(console,arguments)};var Qr={};Qr.SQRT2=1.4142135623730951,Qr.FAST_LOG10=function(e){return Math.log10(e)},Qr.FAST_LOG10_X=function(e,t){return Math.log10(e)*t};function ta(e){this.ordinal=e}ta.short_block_allowed=new ta(0),ta.short_block_coupled=new ta(1),ta.short_block_dispensed=new ta(2),ta.short_block_forced=new ta(3);var Dn={};Dn.MAX_VALUE=34028235e31;function Tt(e){this.ordinal=e}Tt.vbr_off=new Tt(0),Tt.vbr_mt=new Tt(1),Tt.vbr_rh=new Tt(2),Tt.vbr_abr=new Tt(3),Tt.vbr_mtrh=new Tt(4),Tt.vbr_default=Tt.vbr_mtrh;var Sd=function(e){},fe={System:pr,VbrMode:Tt,Float:Dn,ShortBlock:ta,Util:Qr,Arrays:Fn,new_array_n:Pn,new_byte:wd,new_double:kd,new_float:In,new_float_n:jn,new_int:Ln,new_int_n:Vn,new_short:Nn,new_short_n:Hn,assert:Sd},Ed=fe.System,tt=fe.Util,Md=fe.Arrays,Rd=fe.new_float;function Ad(){var e=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*tt.SQRT2*.5/2384e-9,.017876148*tt.SQRT2*.5/2384e-9,.003134727*tt.SQRT2*.5/2384e-9,.002457142*tt.SQRT2*.5/2384e-9,971317e-9*tt.SQRT2*.5/2384e-9,218868e-9*tt.SQRT2*.5/2384e-9,101566e-9*tt.SQRT2*.5/2384e-9,13828e-9*tt.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],t=12,a=36,n=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],d=n[A.SHORT_TYPE],o=n[A.SHORT_TYPE],k=n[A.SHORT_TYPE],C=n[A.SHORT_TYPE],L=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function b(R,w,s){for(var F=10,H=w+238-14-286,V=-15;V<0;V++){var c,T,N;c=e[F+-10],T=R[H+-224]*c,N=R[w+224]*c,c=e[F+-9],T+=R[H+-160]*c,N+=R[w+160]*c,c=e[F+-8],T+=R[H+-96]*c,N+=R[w+96]*c,c=e[F+-7],T+=R[H+-32]*c,N+=R[w+32]*c,c=e[F+-6],T+=R[H+32]*c,N+=R[w+-32]*c,c=e[F+-5],T+=R[H+96]*c,N+=R[w+-96]*c,c=e[F+-4],T+=R[H+160]*c,N+=R[w+-160]*c,c=e[F+-3],T+=R[H+224]*c,N+=R[w+-224]*c,c=e[F+-2],T+=R[w+-256]*c,N-=R[H+256]*c,c=e[F+-1],T+=R[w+-192]*c,N-=R[H+192]*c,c=e[F+0],T+=R[w+-128]*c,N-=R[H+128]*c,c=e[F+1],T+=R[w+-64]*c,N-=R[H+64]*c,c=e[F+2],T+=R[w+0]*c,N-=R[H+0]*c,c=e[F+3],T+=R[w+64]*c,N-=R[H+-64]*c,c=e[F+4],T+=R[w+128]*c,N-=R[H+-128]*c,c=e[F+5],T+=R[w+192]*c,N-=R[H+-192]*c,T*=e[F+6],c=N-T,s[30+V*2]=N+T,s[31+V*2]=e[F+7]*c,F+=18,w--,H++}{var T,N,M,O;N=R[w+-16]*e[F+-10],T=R[w+-32]*e[F+-2],N+=(R[w+-48]-R[w+16])*e[F+-9],T+=R[w+-96]*e[F+-1],N+=(R[w+-80]+R[w+48])*e[F+-8],T+=R[w+-160]*e[F+0],N+=(R[w+-112]-R[w+80])*e[F+-7],T+=R[w+-224]*e[F+1],N+=(R[w+-144]+R[w+112])*e[F+-6],T-=R[w+32]*e[F+2],N+=(R[w+-176]-R[w+144])*e[F+-5],T-=R[w+96]*e[F+3],N+=(R[w+-208]+R[w+176])*e[F+-4],T-=R[w+160]*e[F+4],N+=(R[w+-240]-R[w+208])*e[F+-3],T-=R[w+224],M=T-N,O=T+N,N=s[14],T=s[15]-N,s[31]=O+N,s[30]=M+T,s[15]=M-T,s[14]=O-N}{var l;l=s[28]-s[0],s[0]+=s[28],s[28]=l*e[F+-2*18+7],l=s[29]-s[1],s[1]+=s[29],s[29]=l*e[F+-2*18+7],l=s[26]-s[2],s[2]+=s[26],s[26]=l*e[F+-4*18+7],l=s[27]-s[3],s[3]+=s[27],s[27]=l*e[F+-4*18+7],l=s[24]-s[4],s[4]+=s[24],s[24]=l*e[F+-6*18+7],l=s[25]-s[5],s[5]+=s[25],s[25]=l*e[F+-6*18+7],l=s[22]-s[6],s[6]+=s[22],s[22]=l*tt.SQRT2,l=s[23]-s[7],s[7]+=s[23],s[23]=l*tt.SQRT2-s[7],s[7]-=s[6],s[22]-=s[7],s[23]-=s[22],l=s[6],s[6]=s[31]-l,s[31]=s[31]+l,l=s[7],s[7]=s[30]-l,s[30]=s[30]+l,l=s[22],s[22]=s[15]-l,s[15]=s[15]+l,l=s[23],s[23]=s[14]-l,s[14]=s[14]+l,l=s[20]-s[8],s[8]+=s[20],s[20]=l*e[F+-10*18+7],l=s[21]-s[9],s[9]+=s[21],s[21]=l*e[F+-10*18+7],l=s[18]-s[10],s[10]+=s[18],s[18]=l*e[F+-12*18+7],l=s[19]-s[11],s[11]+=s[19],s[19]=l*e[F+-12*18+7],l=s[16]-s[12],s[12]+=s[16],s[16]=l*e[F+-14*18+7],l=s[17]-s[13],s[13]+=s[17],s[17]=l*e[F+-14*18+7],l=-s[20]+s[24],s[20]+=s[24],s[24]=l*e[F+-12*18+7],l=-s[21]+s[25],s[21]+=s[25],s[25]=l*e[F+-12*18+7],l=s[4]-s[8],s[4]+=s[8],s[8]=l*e[F+-12*18+7],l=s[5]-s[9],s[5]+=s[9],s[9]=l*e[F+-12*18+7],l=s[0]-s[12],s[0]+=s[12],s[12]=l*e[F+-4*18+7],l=s[1]-s[13],s[1]+=s[13],s[13]=l*e[F+-4*18+7],l=s[16]-s[28],s[16]+=s[28],s[28]=l*e[F+-4*18+7],l=-s[17]+s[29],s[17]+=s[29],s[29]=l*e[F+-4*18+7],l=tt.SQRT2*(s[2]-s[10]),s[2]+=s[10],s[10]=l,l=tt.SQRT2*(s[3]-s[11]),s[3]+=s[11],s[11]=l,l=tt.SQRT2*(-s[18]+s[26]),s[18]+=s[26],s[26]=l-s[18],l=tt.SQRT2*(-s[19]+s[27]),s[19]+=s[27],s[27]=l-s[19],l=s[2],s[19]-=s[3],s[3]-=l,s[2]=s[31]-l,s[31]+=l,l=s[3],s[11]-=s[19],s[18]-=l,s[3]=s[30]-l,s[30]+=l,l=s[18],s[27]-=s[11],s[19]-=l,s[18]=s[15]-l,s[15]+=l,l=s[19],s[10]-=l,s[19]=s[14]-l,s[14]+=l,l=s[10],s[11]-=l,s[10]=s[23]-l,s[23]+=l,l=s[11],s[26]-=l,s[11]=s[22]-l,s[22]+=l,l=s[26],s[27]-=l,s[26]=s[7]-l,s[7]+=l,l=s[27],s[27]=s[6]-l,s[6]+=l,l=tt.SQRT2*(s[0]-s[4]),s[0]+=s[4],s[4]=l,l=tt.SQRT2*(s[1]-s[5]),s[1]+=s[5],s[5]=l,l=tt.SQRT2*(s[16]-s[20]),s[16]+=s[20],s[20]=l,l=tt.SQRT2*(s[17]-s[21]),s[17]+=s[21],s[21]=l,l=-tt.SQRT2*(s[8]-s[12]),s[8]+=s[12],s[12]=l-s[8],l=-tt.SQRT2*(s[9]-s[13]),s[9]+=s[13],s[13]=l-s[9],l=-tt.SQRT2*(s[25]-s[29]),s[25]+=s[29],s[29]=l-s[25],l=-tt.SQRT2*(s[24]+s[28]),s[24]-=s[28],s[28]=l-s[24],l=s[24]-s[16],s[24]=l,l=s[20]-l,s[20]=l,l=s[28]-l,s[28]=l,l=s[25]-s[17],s[25]=l,l=s[21]-l,s[21]=l,l=s[29]-l,s[29]=l,l=s[17]-s[1],s[17]=l,l=s[9]-l,s[9]=l,l=s[25]-l,s[25]=l,l=s[5]-l,s[5]=l,l=s[21]-l,s[21]=l,l=s[13]-l,s[13]=l,l=s[29]-l,s[29]=l,l=s[1]-s[0],s[1]=l,l=s[16]-l,s[16]=l,l=s[17]-l,s[17]=l,l=s[8]-l,s[8]=l,l=s[9]-l,s[9]=l,l=s[24]-l,s[24]=l,l=s[25]-l,s[25]=l,l=s[4]-l,s[4]=l,l=s[5]-l,s[5]=l,l=s[20]-l,s[20]=l,l=s[21]-l,s[21]=l,l=s[12]-l,s[12]=l,l=s[13]-l,s[13]=l,l=s[28]-l,s[28]=l,l=s[29]-l,s[29]=l,l=s[0],s[0]+=s[31],s[31]-=l,l=s[1],s[1]+=s[30],s[30]-=l,l=s[16],s[16]+=s[15],s[15]-=l,l=s[17],s[17]+=s[14],s[14]-=l,l=s[8],s[8]+=s[23],s[23]-=l,l=s[9],s[9]+=s[22],s[22]-=l,l=s[24],s[24]+=s[7],s[7]-=l,l=s[25],s[25]+=s[6],s[6]-=l,l=s[4],s[4]+=s[27],s[27]-=l,l=s[5],s[5]+=s[26],s[26]-=l,l=s[20],s[20]+=s[11],s[11]-=l,l=s[21],s[21]+=s[10],s[10]-=l,l=s[12],s[12]+=s[19],s[19]-=l,l=s[13],s[13]+=s[18],s[18]-=l,l=s[28],s[28]+=s[3],s[3]-=l,l=s[29],s[29]+=s[2],s[2]-=l}}function E(R,w){for(var s=0;s<3;s++){var F,H,V,c,T,N;c=R[w+2*3]*n[A.SHORT_TYPE][0]-R[w+5*3],F=R[w+0*3]*n[A.SHORT_TYPE][2]-R[w+3*3],H=c+F,V=c-F,c=R[w+5*3]*n[A.SHORT_TYPE][0]+R[w+2*3],F=R[w+3*3]*n[A.SHORT_TYPE][2]+R[w+0*3],T=c+F,N=-c+F,F=(R[w+1*3]*n[A.SHORT_TYPE][1]-R[w+4*3])*2069978111953089e-26,c=(R[w+4*3]*n[A.SHORT_TYPE][1]+R[w+1*3])*2069978111953089e-26,R[w+3*0]=H*190752519173728e-25+F,R[w+3*5]=-T*190752519173728e-25+c,V=V*.8660254037844387*1907525191737281e-26,T=T*.5*1907525191737281e-26+c,R[w+3*1]=V-T,R[w+3*2]=V+T,H=H*.5*1907525191737281e-26-F,N=N*.8660254037844387*1907525191737281e-26,R[w+3*3]=H+N,R[w+3*4]=H-N,w++}}function h(R,w,s){var F,H;{var V,c,T,N,M,O,l,x;V=s[17]-s[9],T=s[15]-s[11],N=s[14]-s[12],M=s[0]+s[8],O=s[1]+s[7],l=s[2]+s[6],x=s[3]+s[5],R[w+17]=M+l-x-(O-s[4]),H=(M+l-x)*o[12+7]+(O-s[4]),F=(V-T-N)*o[12+6],R[w+5]=F+H,R[w+6]=F-H,c=(s[16]-s[10])*o[12+6],O=O*o[12+7]+s[4],F=V*o[12+0]+c+T*o[12+1]+N*o[12+2],H=-M*o[12+4]+O-l*o[12+5]+x*o[12+3],R[w+1]=F+H,R[w+2]=F-H,F=V*o[12+1]-c-T*o[12+2]+N*o[12+0],H=-M*o[12+5]+O-l*o[12+3]+x*o[12+4],R[w+9]=F+H,R[w+10]=F-H,F=V*o[12+2]-c+T*o[12+0]-N*o[12+1],H=M*o[12+3]-O+l*o[12+4]-x*o[12+5],R[w+13]=F+H,R[w+14]=F-H}{var y,m,f,p,u,v,_,I;y=s[8]-s[0],f=s[6]-s[2],p=s[5]-s[3],u=s[17]+s[9],v=s[16]+s[10],_=s[15]+s[11],I=s[14]+s[12],R[w+0]=u+_+I+(v+s[13]),F=(u+_+I)*o[12+7]-(v+s[13]),H=(y-f+p)*o[12+6],R[w+11]=F+H,R[w+12]=F-H,m=(s[7]-s[1])*o[12+6],v=s[13]-v*o[12+7],F=u*o[12+3]-v+_*o[12+4]+I*o[12+5],H=y*o[12+2]+m+f*o[12+0]+p*o[12+1],R[w+3]=F+H,R[w+4]=F-H,F=-u*o[12+5]+v-_*o[12+3]-I*o[12+4],H=y*o[12+1]+m-f*o[12+2]-p*o[12+0],R[w+7]=F+H,R[w+8]=F-H,F=-u*o[12+4]+v-_*o[12+5]-I*o[12+3],H=y*o[12+0]-m+f*o[12+1]-p*o[12+2],R[w+15]=F+H,R[w+16]=F-H}}this.mdct_sub48=function(R,w,s){for(var F=w,H=286,V=0;V<R.channels_out;V++){for(var c=0;c<R.mode_gr;c++){for(var T,N=R.l3_side.tt[c][V],M=N.xr,O=0,l=R.sb_sample[V][1-c],x=0,y=0;y<18/2;y++)for(b(F,H,l[x]),b(F,H+32,l[x+1]),x+=2,H+=64,T=1;T<32;T+=2)l[x-1][T]*=-1;for(T=0;T<32;T++,O+=18){var m=N.block_type,f=R.sb_sample[V][c],p=R.sb_sample[V][1-c];if(N.mixed_block_flag!=0&&T<2&&(m=0),R.amp_filter[T]<1e-12)Md.fill(M,O+0,O+18,0);else{if(R.amp_filter[T]<1)for(var y=0;y<18;y++)p[y][L[T]]*=R.amp_filter[T];if(m==A.SHORT_TYPE){for(var y=-t/4;y<0;y++){var u=n[A.SHORT_TYPE][y+3];M[O+y*3+9]=f[9+y][L[T]]*u-f[8-y][L[T]],M[O+y*3+18]=f[14-y][L[T]]*u+f[15+y][L[T]],M[O+y*3+10]=f[15+y][L[T]]*u-f[14-y][L[T]],M[O+y*3+19]=p[2-y][L[T]]*u+p[3+y][L[T]],M[O+y*3+11]=p[3+y][L[T]]*u-p[2-y][L[T]],M[O+y*3+20]=p[8-y][L[T]]*u+p[9+y][L[T]]}E(M,O)}else{for(var v=Rd(18),y=-a/4;y<0;y++){var _,I;_=n[m][y+27]*p[y+9][L[T]]+n[m][y+36]*p[8-y][L[T]],I=n[m][y+9]*f[y+9][L[T]]-n[m][y+18]*f[8-y][L[T]],v[y+9]=_-I*d[3+y+9],v[y+18]=_*d[3+y+9]+I}h(M,O,v)}}if(m!=A.SHORT_TYPE&&T!=0)for(var y=7;y>=0;--y){var G,D;G=M[O+y]*k[20+y]+M[O+-1-y]*C[28+y],D=M[O+y]*C[28+y]-M[O+-1-y]*k[20+y],M[O+-1-y]=G,M[O+y]=D}}}if(F=s,H=286,R.mode_gr==1)for(var z=0;z<18;z++)Ed.arraycopy(R.sb_sample[V][1][z],0,R.sb_sample[V][0][z],0,32)}}}var Td=fe.System,Bd=fe.new_float,Cd=fe.new_float_n;function Jr(){this.l=Bd(A.SBMAX_l),this.s=Cd([A.SBMAX_s,3]);var e=this;this.assign=function(t){Td.arraycopy(t.l,0,e.l,0,A.SBMAX_l);for(var a=0;a<A.SBMAX_s;a++)for(var n=0;n<3;n++)e.s[a][n]=t.s[a][n]}}function ia(){this.thm=new Jr,this.en=new Jr}function De(e){var t=e;this.ordinal=function(){return t}}De.STEREO=new De(0),De.JOINT_STEREO=new De(1),De.DUAL_CHANNEL=new De(2),De.MONO=new De(3),De.NOT_SET=new De(4);var Un=fe.System,$r=fe.VbrMode,zn=fe.new_array_n,qn=fe.new_float,Od=fe.new_float_n,Nd=fe.new_int,es=fe.assert;A.ENCDELAY=576,A.POSTDELAY=1152,A.MDCTDELAY=48,A.FFTOFFSET=224+A.MDCTDELAY,A.DECDELAY=528,A.SBLIMIT=32,A.CBANDS=64,A.SBPSY_l=21,A.SBPSY_s=12,A.SBMAX_l=22,A.SBMAX_s=13,A.PSFB21=6,A.PSFB12=6,A.BLKSIZE=1024,A.HBLKSIZE=A.BLKSIZE/2+1,A.BLKSIZE_s=256,A.HBLKSIZE_s=A.BLKSIZE_s/2+1,A.NORM_TYPE=0,A.START_TYPE=1,A.SHORT_TYPE=2,A.STOP_TYPE=3,A.MPG_MD_LR_LR=0,A.MPG_MD_LR_I=1,A.MPG_MD_MS_LR=2,A.MPG_MD_MS_I=3,A.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function A(){var e=A.FFTOFFSET,t=A.MPG_MD_MS_LR,a=null;this.psy=null;var n=null,d=null,o=null;this.setModules=function(E,h,R,w){a=E,this.psy=h,n=h,d=w,o=R};var k=new Ad;function C(E){var h,R;if(E.ATH.useAdjust==0){E.ATH.adjust=1;return}if(R=E.loudness_sq[0][0],h=E.loudness_sq[1][0],E.channels_out==2?(R+=E.loudness_sq[0][1],h+=E.loudness_sq[1][1]):(R+=R,h+=h),E.mode_gr==2&&(R=Math.max(R,h)),R*=.5,R*=E.ATH.aaSensitivityP,R>.03125)E.ATH.adjust>=1?E.ATH.adjust=1:E.ATH.adjust<E.ATH.adjustLimit&&(E.ATH.adjust=E.ATH.adjustLimit),E.ATH.adjustLimit=1;else{var w=31.98*R+625e-6;E.ATH.adjust>=w?(E.ATH.adjust*=w*.075+.925,E.ATH.adjust<w&&(E.ATH.adjust=w)):E.ATH.adjustLimit>=w?E.ATH.adjust=w:E.ATH.adjust<E.ATH.adjustLimit&&(E.ATH.adjust=E.ATH.adjustLimit),E.ATH.adjustLimit=w}}function L(E){var h,R;for(es(E.bitrate_index>=0&&E.bitrate_index<16),es(E.mode_ext>=0&&E.mode_ext<4),E.bitrate_stereoMode_Hist[E.bitrate_index][4]++,E.bitrate_stereoMode_Hist[15][4]++,E.channels_out==2&&(E.bitrate_stereoMode_Hist[E.bitrate_index][E.mode_ext]++,E.bitrate_stereoMode_Hist[15][E.mode_ext]++),h=0;h<E.mode_gr;++h)for(R=0;R<E.channels_out;++R){var w=E.l3_side.tt[h][R].block_type|0;E.l3_side.tt[h][R].mixed_block_flag!=0&&(w=4),E.bitrate_blockType_Hist[E.bitrate_index][w]++,E.bitrate_blockType_Hist[E.bitrate_index][5]++,E.bitrate_blockType_Hist[15][w]++,E.bitrate_blockType_Hist[15][5]++}}function b(E,h){var R=E.internal_flags,w,s;if(R.lame_encode_frame_init==0){var F,H,V=qn(2014),c=qn(286+1152+576);for(R.lame_encode_frame_init=1,F=0,H=0;F<286+576*(1+R.mode_gr);++F)F<576*R.mode_gr?(V[F]=0,R.channels_out==2&&(c[F]=0)):(V[F]=h[0][H],R.channels_out==2&&(c[F]=h[1][H]),++H);for(s=0;s<R.mode_gr;s++)for(w=0;w<R.channels_out;w++)R.l3_side.tt[s][w].block_type=A.SHORT_TYPE;k.mdct_sub48(R,V,c),es(R.mf_size>=A.BLKSIZE+E.framesize-A.FFTOFFSET),es(R.mf_size>=512+E.framesize-32)}}this.lame_encode_mp3_frame=function(E,h,R,w,s,F){var H,V=zn([2,2]);V[0][0]=new ia,V[0][1]=new ia,V[1][0]=new ia,V[1][1]=new ia;var c=zn([2,2]);c[0][0]=new ia,c[0][1]=new ia,c[1][0]=new ia,c[1][1]=new ia;var T,N=[null,null],M=E.internal_flags,O=Od([2,4]),l=[.5,.5],x=[[0,0],[0,0]],y=[[0,0],[0,0]],m,f,p;if(N[0]=h,N[1]=R,M.lame_encode_frame_init==0&&b(E,N),M.padding=0,(M.slot_lag-=M.frac_SpF)<0&&(M.slot_lag+=E.out_samplerate,M.padding=1),M.psymodel!=0){var u,v=[null,null],_=0,I=Nd(2);for(p=0;p<M.mode_gr;p++){for(f=0;f<M.channels_out;f++)v[f]=N[f],_=576+p*576-A.FFTOFFSET;if(E.VBR==$r.vbr_mtrh||E.VBR==$r.vbr_mt?u=n.L3psycho_anal_vbr(E,v,_,p,V,c,x[p],y[p],O[p],I):u=n.L3psycho_anal_ns(E,v,_,p,V,c,x[p],y[p],O[p],I),u!=0)return-4;for(E.mode==De.JOINT_STEREO&&(l[p]=O[p][2]+O[p][3],l[p]>0&&(l[p]=O[p][3]/l[p])),f=0;f<M.channels_out;f++){var G=M.l3_side.tt[p][f];G.block_type=I[f],G.mixed_block_flag=0}}}else for(p=0;p<M.mode_gr;p++)for(f=0;f<M.channels_out;f++)M.l3_side.tt[p][f].block_type=A.NORM_TYPE,M.l3_side.tt[p][f].mixed_block_flag=0,y[p][f]=x[p][f]=700;if(C(M),k.mdct_sub48(M,N[0],N[1]),M.mode_ext=A.MPG_MD_LR_LR,E.force_ms)M.mode_ext=A.MPG_MD_MS_LR;else if(E.mode==De.JOINT_STEREO){var D=0,z=0;for(p=0;p<M.mode_gr;p++)for(f=0;f<M.channels_out;f++)D+=y[p][f],z+=x[p][f];if(D<=1*z){var i=M.l3_side.tt[0],g=M.l3_side.tt[M.mode_gr-1];i[0].block_type==i[1].block_type&&g[0].block_type==g[1].block_type&&(M.mode_ext=A.MPG_MD_MS_LR)}}if(M.mode_ext==t?(T=c,m=y):(T=V,m=x),E.analysis&&M.pinfo!=null)for(p=0;p<M.mode_gr;p++)for(f=0;f<M.channels_out;f++)M.pinfo.ms_ratio[p]=M.ms_ratio[p],M.pinfo.ms_ener_ratio[p]=l[p],M.pinfo.blocktype[p][f]=M.l3_side.tt[p][f].block_type,M.pinfo.pe[p][f]=m[p][f],Un.arraycopy(M.l3_side.tt[p][f].xr,0,M.pinfo.xr[p][f],0,576),M.mode_ext==t&&(M.pinfo.ers[p][f]=M.pinfo.ers[p][f+2],Un.arraycopy(M.pinfo.energy[p][f+2],0,M.pinfo.energy[p][f],0,M.pinfo.energy[p][f].length));if(E.VBR==$r.vbr_off||E.VBR==$r.vbr_abr){var K,W;for(K=0;K<18;K++)M.nsPsy.pefirbuf[K]=M.nsPsy.pefirbuf[K+1];for(W=0,p=0;p<M.mode_gr;p++)for(f=0;f<M.channels_out;f++)W+=m[p][f];for(M.nsPsy.pefirbuf[18]=W,W=M.nsPsy.pefirbuf[9],K=0;K<9;K++)W+=(M.nsPsy.pefirbuf[K]+M.nsPsy.pefirbuf[18-K])*A.fircoef[K];for(W=670*5*M.mode_gr*M.channels_out/W,p=0;p<M.mode_gr;p++)for(f=0;f<M.channels_out;f++)m[p][f]*=W}if(M.iteration_loop.iteration_loop(E,m,l,T),a.format_bitstream(E),H=a.copy_buffer(M,w,s,F,1),E.bWriteVbrTag&&d.addVbrFrame(E),E.analysis&&M.pinfo!=null){for(f=0;f<M.channels_out;f++){var ie;for(ie=0;ie<e;ie++)M.pinfo.pcmdata[f][ie]=M.pinfo.pcmdata[f][ie+E.framesize];for(ie=e;ie<1600;ie++)M.pinfo.pcmdata[f][ie]=N[f][ie-e]}o.set_frame_pinfo(E,T)}return L(M),H}}var Yn=fe.Util,Xn=fe.new_float;function Ld(){var e=Xn(A.BLKSIZE),t=Xn(A.BLKSIZE_s/2),a=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function n(o,k,C){var L=0,b,E,h;C<<=1;var R=k+C;b=4;do{var w,s,F,H,V,c,T;T=b>>1,H=b,V=b<<1,c=V+H,b=V<<1,E=k,h=E+T;do{var N,M,O,l;M=o[E+0]-o[E+H],N=o[E+0]+o[E+H],l=o[E+V]-o[E+c],O=o[E+V]+o[E+c],o[E+V]=N-O,o[E+0]=N+O,o[E+c]=M-l,o[E+H]=M+l,M=o[h+0]-o[h+H],N=o[h+0]+o[h+H],l=Yn.SQRT2*o[h+c],O=Yn.SQRT2*o[h+V],o[h+V]=N-O,o[h+0]=N+O,o[h+c]=M-l,o[h+H]=M+l,h+=b,E+=b}while(E<R);for(s=a[L+0],w=a[L+1],F=1;F<T;F++){var x,y;x=1-2*w*w,y=2*w*s,E=k+F,h=k+H-F;do{var m,f,p,N,M,u,O,v,l,_;f=y*o[E+H]-x*o[h+H],m=x*o[E+H]+y*o[h+H],M=o[E+0]-m,N=o[E+0]+m,u=o[h+0]-f,p=o[h+0]+f,f=y*o[E+c]-x*o[h+c],m=x*o[E+c]+y*o[h+c],l=o[E+V]-m,O=o[E+V]+m,_=o[h+V]-f,v=o[h+V]+f,f=w*O-s*_,m=s*O+w*_,o[E+V]=N-m,o[E+0]=N+m,o[h+c]=u-f,o[h+H]=u+f,f=s*v-w*l,m=w*v+s*l,o[h+V]=p-m,o[h+0]=p+m,o[E+c]=M-f,o[E+H]=M+f,h+=b,E+=b}while(E<R);x=s,s=x*a[L+0]-w*a[L+1],w=x*a[L+1]+w*a[L+0]}L+=2}while(b<C)}var d=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(o,k,C,L,b){for(var E=0;E<3;E++){var h=A.BLKSIZE_s/2,R=65535&576/3*(E+1),w=A.BLKSIZE_s/8-1;do{var s,F,H,V,c,T=d[w<<2]&255;s=t[T]*L[C][b+T+R],c=t[127-T]*L[C][b+T+R+128],F=s-c,s=s+c,H=t[T+64]*L[C][b+T+R+64],c=t[63-T]*L[C][b+T+R+192],V=H-c,H=H+c,h-=4,k[E][h+0]=s+H,k[E][h+2]=s-H,k[E][h+1]=F+V,k[E][h+3]=F-V,s=t[T+1]*L[C][b+T+R+1],c=t[126-T]*L[C][b+T+R+129],F=s-c,s=s+c,H=t[T+65]*L[C][b+T+R+65],c=t[62-T]*L[C][b+T+R+193],V=H-c,H=H+c,k[E][h+A.BLKSIZE_s/2+0]=s+H,k[E][h+A.BLKSIZE_s/2+2]=s-H,k[E][h+A.BLKSIZE_s/2+1]=F+V,k[E][h+A.BLKSIZE_s/2+3]=F-V}while(--w>=0);n(k[E],h,A.BLKSIZE_s/2)}},this.fft_long=function(o,k,C,L,b){var E=A.BLKSIZE/8-1,h=A.BLKSIZE/2;do{var R,w,s,F,H,V=d[E]&255;R=e[V]*L[C][b+V],H=e[V+512]*L[C][b+V+512],w=R-H,R=R+H,s=e[V+256]*L[C][b+V+256],H=e[V+768]*L[C][b+V+768],F=s-H,s=s+H,h-=4,k[h+0]=R+s,k[h+2]=R-s,k[h+1]=w+F,k[h+3]=w-F,R=e[V+1]*L[C][b+V+1],H=e[V+513]*L[C][b+V+513],w=R-H,R=R+H,s=e[V+257]*L[C][b+V+257],H=e[V+769]*L[C][b+V+769],F=s-H,s=s+H,k[h+A.BLKSIZE/2+0]=R+s,k[h+A.BLKSIZE/2+2]=R-s,k[h+A.BLKSIZE/2+1]=w+F,k[h+A.BLKSIZE/2+3]=w-F}while(--E>=0);n(k,h,A.BLKSIZE/2)},this.init_fft=function(o){for(var k=0;k<A.BLKSIZE;k++)e[k]=.42-.5*Math.cos(2*Math.PI*(k+.5)/A.BLKSIZE)+.08*Math.cos(4*Math.PI*(k+.5)/A.BLKSIZE);for(var k=0;k<A.BLKSIZE_s/2;k++)t[k]=.5*(1-Math.cos(2*Math.PI*(k+.5)/A.BLKSIZE_s))}}var Pa=fe.VbrMode,Gn=fe.Float,Fa=fe.ShortBlock,kt=fe.Util,Id=fe.Arrays,ot=fe.new_float,It=fe.new_float_n,ya=fe.new_int,Ce=fe.assert;function qs(){var e=new Ld,t=2.302585092994046,a=2,n=16,d=2,o=16,k=.34,C=1/(14752*14752)/(A.BLKSIZE/2),L=.01,b=.8,E=.6,h=.3,R=3.5,w=21,s=.2302585093;function F(S){return S}function H(S,B){for(var P=0,U=0;U<A.BLKSIZE/2;++U)P+=S[U]*B.ATH.eql_w[U];return P*=C,P}function V(S,B,P,U,Y,j,X,Z,q,ae,Q){var re=S.internal_flags;if(q<2)e.fft_long(re,U[Y],q,ae,Q),e.fft_short(re,j[X],q,ae,Q);else if(q==2){for(var _e=A.BLKSIZE-1;_e>=0;--_e){var Ee=U[Y+0][_e],se=U[Y+1][_e];U[Y+0][_e]=(Ee+se)*kt.SQRT2*.5,U[Y+1][_e]=(Ee-se)*kt.SQRT2*.5}for(var ke=2;ke>=0;--ke)for(var _e=A.BLKSIZE_s-1;_e>=0;--_e){var Ee=j[X+0][ke][_e],se=j[X+1][ke][_e];j[X+0][ke][_e]=(Ee+se)*kt.SQRT2*.5,j[X+1][ke][_e]=(Ee-se)*kt.SQRT2*.5}}B[0]=U[Y+0][0],B[0]*=B[0];for(var _e=A.BLKSIZE/2-1;_e>=0;--_e){var $=U[Y+0][A.BLKSIZE/2-_e],be=U[Y+0][A.BLKSIZE/2+_e];B[A.BLKSIZE/2-_e]=($*$+be*be)*.5}for(var ke=2;ke>=0;--ke){P[ke][0]=j[X+0][ke][0],P[ke][0]*=P[ke][0];for(var _e=A.BLKSIZE_s/2-1;_e>=0;--_e){var $=j[X+0][ke][A.BLKSIZE_s/2-_e],be=j[X+0][ke][A.BLKSIZE_s/2+_e];P[ke][A.BLKSIZE_s/2-_e]=($*$+be*be)*.5}}{for(var Be=0,_e=11;_e<A.HBLKSIZE;_e++)Be+=B[_e];re.tot_ener[q]=Be}if(S.analysis){for(var _e=0;_e<A.HBLKSIZE;_e++)re.pinfo.energy[Z][q][_e]=re.pinfo.energy_save[q][_e],re.pinfo.energy_save[q][_e]=B[_e];re.pinfo.pe[Z][q]=re.pe[q]}S.athaa_loudapprox==2&&q<2&&(re.loudness_sq[Z][q]=re.loudness_sq_save[q],re.loudness_sq_save[q]=H(B,re))}var c=8,T=23,N=15,M,O,l,x=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function y(){M=Math.pow(10,(c+1)/16),O=Math.pow(10,(T+1)/16),l=Math.pow(10,N/10)}var m=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],f=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],p=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function u(S,B,P,U,Y,j){var X;if(B>S)if(B<S*O)X=B/S;else return S+B;else{if(S>=B*O)return S+B;X=S/B}if(S+=B,U+3<=3+3){if(X>=M)return S;var Z=0|kt.FAST_LOG10_X(X,16);return S*f[Z]}var Z=0|kt.FAST_LOG10_X(X,16);if(j!=0?B=Y.ATH.cb_s[P]*Y.ATH.adjust:B=Y.ATH.cb_l[P]*Y.ATH.adjust,S<l*B){if(S>B){var q,ae;return q=1,Z<=13&&(q=p[Z]),ae=kt.FAST_LOG10_X(S/B,10/15),S*((m[Z]-q)*ae+q)}return Z>13?S:S*p[Z]}return S*m[Z]}var v=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function _(S,B,P){var U;if(S<0&&(S=0),B<0&&(B=0),S<=0)return B;if(B<=0)return S;if(B>S?U=B/S:U=S/B,P>=-2&&P<=2){if(U>=M)return S+B;var Y=0|kt.FAST_LOG10_X(U,16);return(S+B)*v[Y]}return U<O?S+B:(S<B&&(S=B),S)}function I(S,B){var P=S.internal_flags;if(P.channels_out>1){for(var U=0;U<A.SBMAX_l;U++){var Y=P.thm[0].l[U],j=P.thm[1].l[U];P.thm[0].l[U]+=j*B,P.thm[1].l[U]+=Y*B}for(var U=0;U<A.SBMAX_s;U++)for(var X=0;X<3;X++){var Y=P.thm[0].s[U][X],j=P.thm[1].s[U][X];P.thm[0].s[U][X]+=j*B,P.thm[1].s[U][X]+=Y*B}}}function G(S){for(var B=0;B<A.SBMAX_l;B++)if(!(S.thm[0].l[B]>1.58*S.thm[1].l[B]||S.thm[1].l[B]>1.58*S.thm[0].l[B])){var P=S.mld_l[B]*S.en[3].l[B],U=Math.max(S.thm[2].l[B],Math.min(S.thm[3].l[B],P));P=S.mld_l[B]*S.en[2].l[B];var Y=Math.max(S.thm[3].l[B],Math.min(S.thm[2].l[B],P));S.thm[2].l[B]=U,S.thm[3].l[B]=Y}for(var B=0;B<A.SBMAX_s;B++)for(var j=0;j<3;j++)if(!(S.thm[0].s[B][j]>1.58*S.thm[1].s[B][j]||S.thm[1].s[B][j]>1.58*S.thm[0].s[B][j])){var P=S.mld_s[B]*S.en[3].s[B][j],U=Math.max(S.thm[2].s[B][j],Math.min(S.thm[3].s[B][j],P));P=S.mld_s[B]*S.en[2].s[B][j];var Y=Math.max(S.thm[3].s[B][j],Math.min(S.thm[2].s[B][j],P));S.thm[2].s[B][j]=U,S.thm[3].s[B][j]=Y}}function D(S,B,P){var U=B,Y=Math.pow(10,P);B*=2,U*=2;for(var j=0;j<A.SBMAX_l;j++){var X,Z,q,ae;if(ae=S.ATH.cb_l[S.bm_l[j]]*Y,X=Math.min(Math.max(S.thm[0].l[j],ae),Math.max(S.thm[1].l[j],ae)),Z=Math.max(S.thm[2].l[j],ae),q=Math.max(S.thm[3].l[j],ae),X*B<Z+q){var Q=X*U/(Z+q);Z*=Q,q*=Q}S.thm[2].l[j]=Math.min(Z,S.thm[2].l[j]),S.thm[3].l[j]=Math.min(q,S.thm[3].l[j])}Y*=A.BLKSIZE_s/A.BLKSIZE;for(var j=0;j<A.SBMAX_s;j++)for(var re=0;re<3;re++){var X,Z,q,ae;if(ae=S.ATH.cb_s[S.bm_s[j]]*Y,X=Math.min(Math.max(S.thm[0].s[j][re],ae),Math.max(S.thm[1].s[j][re],ae)),Z=Math.max(S.thm[2].s[j][re],ae),q=Math.max(S.thm[3].s[j][re],ae),X*B<Z+q){var Q=X*B/(Z+q);Z*=Q,q*=Q}S.thm[2].s[j][re]=Math.min(S.thm[2].s[j][re],Z),S.thm[3].s[j][re]=Math.min(S.thm[3].s[j][re],q)}}function z(S,B,P,U,Y){var j,X,Z=0,q=0;for(j=X=0;j<A.SBMAX_s;++X,++j){for(var ae=S.bo_s[j],Q=S.npart_s,re=ae<Q?ae:Q;X<re;)Ce(B[X]>=0),Ce(P[X]>=0),Z+=B[X],q+=P[X],X++;if(S.en[U].s[j][Y]=Z,S.thm[U].s[j][Y]=q,X>=Q){++j;break}Ce(B[X]>=0),Ce(P[X]>=0);{var _e=S.PSY.bo_s_weight[j],Ee=1-_e;Z=_e*B[X],q=_e*P[X],S.en[U].s[j][Y]+=Z,S.thm[U].s[j][Y]+=q,Z=Ee*B[X],q=Ee*P[X]}}for(;j<A.SBMAX_s;++j)S.en[U].s[j][Y]=0,S.thm[U].s[j][Y]=0}function i(S,B,P,U){var Y,j,X=0,Z=0;for(Y=j=0;Y<A.SBMAX_l;++j,++Y){for(var q=S.bo_l[Y],ae=S.npart_l,Q=q<ae?q:ae;j<Q;)Ce(B[j]>=0),Ce(P[j]>=0),X+=B[j],Z+=P[j],j++;if(S.en[U].l[Y]=X,S.thm[U].l[Y]=Z,j>=ae){++Y;break}Ce(B[j]>=0),Ce(P[j]>=0);{var re=S.PSY.bo_l_weight[Y],_e=1-re;X=re*B[j],Z=re*P[j],S.en[U].l[Y]+=X,S.thm[U].l[Y]+=Z,X=_e*B[j],Z=_e*P[j]}}for(;Y<A.SBMAX_l;++Y)S.en[U].l[Y]=0,S.thm[U].l[Y]=0}function g(S,B,P,U,Y,j){var X=S.internal_flags,Z,q;for(q=Z=0;q<X.npart_s;++q){for(var ae=0,Q=X.numlines_s[q],re=0;re<Q;++re,++Z){var _e=B[j][Z];ae+=_e}P[q]=ae}for(Ce(q==X.npart_s),Z=q=0;q<X.npart_s;q++){var Ee=X.s3ind_s[q][0],se=X.s3_ss[Z++]*P[Ee];for(++Ee;Ee<=X.s3ind_s[q][1];)se+=X.s3_ss[Z]*P[Ee],++Z,++Ee;{var ke=d*X.nb_s1[Y][q];U[q]=Math.min(se,ke)}if(X.blocktype_old[Y&1]==A.SHORT_TYPE){var ke=o*X.nb_s2[Y][q],$=U[q];U[q]=Math.min(ke,$)}X.nb_s2[Y][q]=X.nb_s1[Y][q],X.nb_s1[Y][q]=se,Ce(U[q]>=0)}for(;q<=A.CBANDS;++q)P[q]=0,U[q]=0}function K(S,B,P,U){var Y=S.internal_flags;S.short_blocks==Fa.short_block_coupled&&!(B[0]!=0&&B[1]!=0)&&(B[0]=B[1]=0);for(var j=0;j<Y.channels_out;j++)U[j]=A.NORM_TYPE,S.short_blocks==Fa.short_block_dispensed&&(B[j]=1),S.short_blocks==Fa.short_block_forced&&(B[j]=0),B[j]!=0?(Ce(Y.blocktype_old[j]!=A.START_TYPE),Y.blocktype_old[j]==A.SHORT_TYPE&&(U[j]=A.STOP_TYPE)):(U[j]=A.SHORT_TYPE,Y.blocktype_old[j]==A.NORM_TYPE&&(Y.blocktype_old[j]=A.START_TYPE),Y.blocktype_old[j]==A.STOP_TYPE&&(Y.blocktype_old[j]=A.SHORT_TYPE)),P[j]=Y.blocktype_old[j],Y.blocktype_old[j]=U[j]}function W(S,B,P){return P>=1?S:P<=0?B:B>0?Math.pow(S/B,P)*B:0}var ie=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function he(S,B){for(var P=309.07,U=0;U<A.SBMAX_s-1;U++)for(var Y=0;Y<3;Y++){var j=S.thm.s[U][Y];if(j>0){var X=j*B,Z=S.en.s[U][Y];Z>X&&(Z>X*1e10?P+=ie[U]*(10*t):P+=ie[U]*kt.FAST_LOG10(Z/X))}}return P}var ue=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function de(S,B){for(var P=281.0575,U=0;U<A.SBMAX_l-1;U++){var Y=S.thm.l[U];if(Y>0){var j=Y*B,X=S.en.l[U];X>j&&(X>j*1e10?P+=ue[U]*(10*t):P+=ue[U]*kt.FAST_LOG10(X/j))}}return P}function Se(S,B,P,U,Y){var j,X;for(j=X=0;j<S.npart_l;++j){var Z=0,q=0,ae;for(ae=0;ae<S.numlines_l[j];++ae,++X){var Q=B[X];Z+=Q,q<Q&&(q=Q)}P[j]=Z,U[j]=q,Y[j]=Z*S.rnumlines_l[j],Ce(S.rnumlines_l[j]>=0),Ce(P[j]>=0),Ce(U[j]>=0),Ce(Y[j]>=0)}}function ve(S,B,P,U){var Y=x.length-1,j=0,X=P[j]+P[j+1];if(X>0){var Z=B[j];Z<B[j+1]&&(Z=B[j+1]),Ce(S.numlines_l[j]+S.numlines_l[j+1]-1>0),X=20*(Z*2-X)/(X*(S.numlines_l[j]+S.numlines_l[j+1]-1));var q=0|X;q>Y&&(q=Y),U[j]=q}else U[j]=0;for(j=1;j<S.npart_l-1;j++)if(X=P[j-1]+P[j]+P[j+1],X>0){var Z=B[j-1];Z<B[j]&&(Z=B[j]),Z<B[j+1]&&(Z=B[j+1]),Ce(S.numlines_l[j-1]+S.numlines_l[j]+S.numlines_l[j+1]-1>0),X=20*(Z*3-X)/(X*(S.numlines_l[j-1]+S.numlines_l[j]+S.numlines_l[j+1]-1));var q=0|X;q>Y&&(q=Y),U[j]=q}else U[j]=0;if(Ce(j==S.npart_l-1),X=P[j-1]+P[j],X>0){var Z=B[j-1];Z<B[j]&&(Z=B[j]),Ce(S.numlines_l[j-1]+S.numlines_l[j]-1>0),X=20*(Z*2-X)/(X*(S.numlines_l[j-1]+S.numlines_l[j]-1));var q=0|X;q>Y&&(q=Y),U[j]=q}else U[j]=0;Ce(j==S.npart_l-1)}var ce=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(S,B,P,U,Y,j,X,Z,q,ae){var Q=S.internal_flags,re=It([2,A.BLKSIZE]),_e=It([2,3,A.BLKSIZE_s]),Ee=ot(A.CBANDS+1),se=ot(A.CBANDS+1),ke=ot(A.CBANDS+2),$=ya(2),be=ya(2),Be,oe,xe,ne,Me,We,pe,Ae,Ne=It([2,576]),Qe,Ct=ya(A.CBANDS+2),st=ya(A.CBANDS+2);for(Id.fill(st,0),Be=Q.channels_out,S.mode==De.JOINT_STEREO&&(Be=4),S.VBR==Pa.vbr_off?Qe=Q.ResvMax==0?0:Q.ResvSize/Q.ResvMax*.5:S.VBR==Pa.vbr_rh||S.VBR==Pa.vbr_mtrh||S.VBR==Pa.vbr_mt?Qe=.6:Qe=1,oe=0;oe<Q.channels_out;oe++){var Je=B[oe],Mt=P+576-350-w+192;for(ne=0;ne<576;ne++){var Ot,Nt;for(Ot=Je[Mt+ne+10],Nt=0,Me=0;Me<(w-1)/2-1;Me+=2)Ot+=ce[Me]*(Je[Mt+ne+Me]+Je[Mt+ne+w-Me]),Nt+=ce[Me+1]*(Je[Mt+ne+Me+1]+Je[Mt+ne+w-Me-1]);Ne[oe][ne]=Ot+Nt}Y[U][oe].en.assign(Q.en[oe]),Y[U][oe].thm.assign(Q.thm[oe]),Be>2&&(j[U][oe].en.assign(Q.en[oe+2]),j[U][oe].thm.assign(Q.thm[oe+2]))}for(oe=0;oe<Be;oe++){var zt,qt,bt=ot(12),Jt=[0,0,0,0],za=ot(12),$s=1,di,mi=ot(A.CBANDS),hi=ot(A.CBANDS),$e=[0,0,0,0],ui=ot(A.HBLKSIZE),fi=It([3,A.HBLKSIZE_s]);for(Ce(Q.npart_s<=A.CBANDS),Ce(Q.npart_l<=A.CBANDS),ne=0;ne<3;ne++)bt[ne]=Q.nsPsy.last_en_subshort[oe][ne+6],Ce(Q.nsPsy.last_en_subshort[oe][ne+4]>0),za[ne]=bt[ne]/Q.nsPsy.last_en_subshort[oe][ne+4],Jt[0]+=bt[ne];if(oe==2)for(ne=0;ne<576;ne++){var eo,to;eo=Ne[0][ne],to=Ne[1][ne],Ne[0][ne]=eo+to,Ne[1][ne]=eo-to}{var _i=Ne[oe&1],kr=0;for(ne=0;ne<9;ne++){for(var _h=kr+64,dt=1;kr<_h;kr++)dt<Math.abs(_i[kr])&&(dt=Math.abs(_i[kr]));Q.nsPsy.last_en_subshort[oe][ne]=bt[ne+3]=dt,Jt[1+ne/3]+=dt,dt>bt[ne+3-2]?(Ce(bt[ne+3-2]>0),dt=dt/bt[ne+3-2]):bt[ne+3-2]>dt*10?dt=bt[ne+3-2]/(dt*10):dt=0,za[ne+3]=dt}}if(S.analysis){var ao=za[0];for(ne=1;ne<12;ne++)ao<za[ne]&&(ao=za[ne]);Q.pinfo.ers[U][oe]=Q.pinfo.ers_save[oe],Q.pinfo.ers_save[oe]=ao}for(di=oe==3?Q.nsPsy.attackthre_s:Q.nsPsy.attackthre,ne=0;ne<12;ne++)$e[ne/3]==0&&za[ne]>di&&($e[ne/3]=ne%3+1);for(ne=1;ne<4;ne++){var ro;Jt[ne-1]>Jt[ne]?(Ce(Jt[ne]>0),ro=Jt[ne-1]/Jt[ne]):(Ce(Jt[ne-1]>0),ro=Jt[ne]/Jt[ne-1]),ro<1.7&&($e[ne]=0,ne==1&&($e[0]=0))}for($e[0]!=0&&Q.nsPsy.lastAttacks[oe]!=0&&($e[0]=0),(Q.nsPsy.lastAttacks[oe]==3||$e[0]+$e[1]+$e[2]+$e[3]!=0)&&($s=0,$e[1]!=0&&$e[0]!=0&&($e[1]=0),$e[2]!=0&&$e[1]!=0&&($e[2]=0),$e[3]!=0&&$e[2]!=0&&($e[3]=0)),oe<2?be[oe]=$s:$s==0&&(be[0]=be[1]=0),q[oe]=Q.tot_ener[oe],qt=_e,zt=re,V(S,ui,fi,zt,oe&1,qt,oe&1,U,oe,B,P),Se(Q,ui,Ee,mi,hi),ve(Q,mi,hi,Ct),Ae=0;Ae<3;Ae++){var so,Rt;for(g(S,fi,se,ke,oe,Ae),z(Q,se,ke,oe,Ae),pe=0;pe<A.SBMAX_s;pe++){if(Rt=Q.thm[oe].s[pe][Ae],Rt*=b,$e[Ae]>=2||$e[Ae+1]==1){var Sr=Ae!=0?Ae-1:2,dt=W(Q.thm[oe].s[pe][Sr],Rt,E*Qe);Rt=Math.min(Rt,dt)}if($e[Ae]==1){var Sr=Ae!=0?Ae-1:2,dt=W(Q.thm[oe].s[pe][Sr],Rt,h*Qe);Rt=Math.min(Rt,dt)}else if(Ae!=0&&$e[Ae-1]==3||Ae==0&&Q.nsPsy.lastAttacks[oe]==3){var Sr=Ae!=2?Ae+1:0,dt=W(Q.thm[oe].s[pe][Sr],Rt,h*Qe);Rt=Math.min(Rt,dt)}so=bt[Ae*3+3]+bt[Ae*3+4]+bt[Ae*3+5],bt[Ae*3+5]*6<so&&(Rt*=.5,bt[Ae*3+4]*6<so&&(Rt*=.5)),Q.thm[oe].s[pe][Ae]=Rt}}for(Q.nsPsy.lastAttacks[oe]=$e[2],We=0,xe=0;xe<Q.npart_l;xe++){for(var Ra=Q.s3ind[xe][0],oo=Ee[Ra]*x[Ct[Ra]],Aa=Q.s3_ll[We++]*oo;++Ra<=Q.s3ind[xe][1];)oo=Ee[Ra]*x[Ct[Ra]],Aa=u(Aa,Q.s3_ll[We++]*oo,Ra,Ra-xe,Q,0);Aa*=.158489319246111,Q.blocktype_old[oe&1]==A.SHORT_TYPE?ke[xe]=Aa:ke[xe]=W(Math.min(Aa,Math.min(a*Q.nb_1[oe][xe],n*Q.nb_2[oe][xe])),Aa,Qe),Q.nb_2[oe][xe]=Q.nb_1[oe][xe],Q.nb_1[oe][xe]=Aa}for(;xe<=A.CBANDS;++xe)Ee[xe]=0,ke[xe]=0;i(Q,Ee,ke,oe)}if((S.mode==De.STEREO||S.mode==De.JOINT_STEREO)&&S.interChRatio>0&&I(S,S.interChRatio),S.mode==De.JOINT_STEREO){var no;G(Q),no=S.msfix,Math.abs(no)>0&&D(Q,no,S.ATHlower*Q.ATH.adjust)}for(K(S,be,ae,$),oe=0;oe<Be;oe++){var Er,Mr=0,ls,cs;oe>1?(Er=Z,Mr=-2,ls=A.NORM_TYPE,(ae[0]==A.SHORT_TYPE||ae[1]==A.SHORT_TYPE)&&(ls=A.SHORT_TYPE),cs=j[U][oe-2]):(Er=X,Mr=0,ls=ae[oe],cs=Y[U][oe]),ls==A.SHORT_TYPE?Er[Mr+oe]=he(cs,Q.masking_lower):Er[Mr+oe]=de(cs,Q.masking_lower),S.analysis&&(Q.pinfo.pe[U][oe]=Er[Mr+oe])}return 0};function Re(S,B,P,U,Y,j,X,Z){var q=S.internal_flags;if(U<2)e.fft_long(q,X[Z],U,B,P);else if(U==2)for(var ae=A.BLKSIZE-1;ae>=0;--ae){var Q=X[Z+0][ae],re=X[Z+1][ae];X[Z+0][ae]=(Q+re)*kt.SQRT2*.5,X[Z+1][ae]=(Q-re)*kt.SQRT2*.5}j[0]=X[Z+0][0],j[0]*=j[0];for(var ae=A.BLKSIZE/2-1;ae>=0;--ae){var _e=X[Z+0][A.BLKSIZE/2-ae],Ee=X[Z+0][A.BLKSIZE/2+ae];j[A.BLKSIZE/2-ae]=(_e*_e+Ee*Ee)*.5}{for(var se=0,ae=11;ae<A.HBLKSIZE;ae++)se+=j[ae];q.tot_ener[U]=se}if(S.analysis){for(var ae=0;ae<A.HBLKSIZE;ae++)q.pinfo.energy[Y][U][ae]=q.pinfo.energy_save[U][ae],q.pinfo.energy_save[U][ae]=j[ae];q.pinfo.pe[Y][U]=q.pe[U]}}function He(S,B,P,U,Y,j,X,Z){var q=S.internal_flags;if(Y==0&&U<2&&e.fft_short(q,X[Z],U,B,P),U==2)for(var ae=A.BLKSIZE_s-1;ae>=0;--ae){var Q=X[Z+0][Y][ae],re=X[Z+1][Y][ae];X[Z+0][Y][ae]=(Q+re)*kt.SQRT2*.5,X[Z+1][Y][ae]=(Q-re)*kt.SQRT2*.5}j[Y][0]=X[Z+0][Y][0],j[Y][0]*=j[Y][0];for(var ae=A.BLKSIZE_s/2-1;ae>=0;--ae){var _e=X[Z+0][Y][A.BLKSIZE_s/2-ae],Ee=X[Z+0][Y][A.BLKSIZE_s/2+ae];j[Y][A.BLKSIZE_s/2-ae]=(_e*_e+Ee*Ee)*.5}}function Oe(S,B,P,U){var Y=S.internal_flags;S.athaa_loudapprox==2&&P<2&&(Y.loudness_sq[B][P]=Y.loudness_sq_save[P],Y.loudness_sq_save[P]=H(U,Y))}var Ue=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function Pe(S,B,P,U,Y,j,X,Z,q,ae){for(var Q=It([2,576]),re=S.internal_flags,_e=re.channels_out,Ee=S.mode==De.JOINT_STEREO?4:_e,se=0;se<_e;se++){firbuf=B[se];for(var ke=P+576-350-w+192,$=0;$<576;$++){var be,Be;be=firbuf[ke+$+10],Be=0;for(var oe=0;oe<(w-1)/2-1;oe+=2)be+=Ue[oe]*(firbuf[ke+$+oe]+firbuf[ke+$+w-oe]),Be+=Ue[oe+1]*(firbuf[ke+$+oe+1]+firbuf[ke+$+w-oe-1]);Q[se][$]=be+Be}Y[U][se].en.assign(re.en[se]),Y[U][se].thm.assign(re.thm[se]),Ee>2&&(j[U][se].en.assign(re.en[se+2]),j[U][se].thm.assign(re.thm[se+2]))}for(var se=0;se<Ee;se++){var xe=ot(12),ne=ot(12),Me=[0,0,0,0],We=Q[se&1],pe=0,Ae=se==3?re.nsPsy.attackthre_s:re.nsPsy.attackthre,Ne=1;if(se==2)for(var $=0,oe=576;oe>0;++$,--oe){var Qe=Q[0][$],Ct=Q[1][$];Q[0][$]=Qe+Ct,Q[1][$]=Qe-Ct}for(var $=0;$<3;$++)ne[$]=re.nsPsy.last_en_subshort[se][$+6],Ce(re.nsPsy.last_en_subshort[se][$+4]>0),xe[$]=ne[$]/re.nsPsy.last_en_subshort[se][$+4],Me[0]+=ne[$];for(var $=0;$<9;$++){for(var st=pe+64,Je=1;pe<st;pe++)Je<Math.abs(We[pe])&&(Je=Math.abs(We[pe]));re.nsPsy.last_en_subshort[se][$]=ne[$+3]=Je,Me[1+$/3]+=Je,Je>ne[$+3-2]?(Ce(ne[$+3-2]>0),Je=Je/ne[$+3-2]):ne[$+3-2]>Je*10?Je=ne[$+3-2]/(Je*10):Je=0,xe[$+3]=Je}for(var $=0;$<3;++$){var Mt=ne[$*3+3]+ne[$*3+4]+ne[$*3+5],Ot=1;ne[$*3+5]*6<Mt&&(Ot*=.5,ne[$*3+4]*6<Mt&&(Ot*=.5)),Z[se][$]=Ot}if(S.analysis){for(var Nt=xe[0],$=1;$<12;$++)Nt<xe[$]&&(Nt=xe[$]);re.pinfo.ers[U][se]=re.pinfo.ers_save[se],re.pinfo.ers_save[se]=Nt}for(var $=0;$<12;$++)q[se][$/3]==0&&xe[$]>Ae&&(q[se][$/3]=$%3+1);for(var $=1;$<4;$++){var zt=Me[$-1],qt=Me[$],bt=Math.max(zt,qt);bt<4e4&&zt<1.7*qt&&qt<1.7*zt&&($==1&&q[se][0]<=q[se][$]&&(q[se][0]=0),q[se][$]=0)}q[se][0]<=re.nsPsy.lastAttacks[se]&&(q[se][0]=0),(re.nsPsy.lastAttacks[se]==3||q[se][0]+q[se][1]+q[se][2]+q[se][3]!=0)&&(Ne=0,q[se][1]!=0&&q[se][0]!=0&&(q[se][1]=0),q[se][2]!=0&&q[se][1]!=0&&(q[se][2]=0),q[se][3]!=0&&q[se][2]!=0&&(q[se][3]=0)),se<2?ae[se]=Ne:Ne==0&&(ae[0]=ae[1]=0),X[se]=re.tot_ener[se]}}function Fe(S,B,P){if(P==0)for(var U=0;U<S.npart_s;U++)S.nb_s2[B][U]=S.nb_s1[B][U],S.nb_s1[B][U]=0}function Ze(S,B){for(var P=0;P<S.npart_l;P++)S.nb_2[B][P]=S.nb_1[B][P],S.nb_1[B][P]=0}function pt(S,B,P,U){var Y=x.length-1,j=0,X=P[j]+P[j+1];if(X>0){var Z=B[j];Z<B[j+1]&&(Z=B[j+1]),Ce(S.numlines_s[j]+S.numlines_s[j+1]-1>0),X=20*(Z*2-X)/(X*(S.numlines_s[j]+S.numlines_s[j+1]-1));var q=0|X;q>Y&&(q=Y),U[j]=q}else U[j]=0;for(j=1;j<S.npart_s-1;j++)if(X=P[j-1]+P[j]+P[j+1],Ce(j+1<S.npart_s),X>0){var Z=B[j-1];Z<B[j]&&(Z=B[j]),Z<B[j+1]&&(Z=B[j+1]),Ce(S.numlines_s[j-1]+S.numlines_s[j]+S.numlines_s[j+1]-1>0),X=20*(Z*3-X)/(X*(S.numlines_s[j-1]+S.numlines_s[j]+S.numlines_s[j+1]-1));var q=0|X;q>Y&&(q=Y),U[j]=q}else U[j]=0;if(Ce(j==S.npart_s-1),X=P[j-1]+P[j],X>0){var Z=B[j-1];Z<B[j]&&(Z=B[j]),Ce(S.numlines_s[j-1]+S.numlines_s[j]-1>0),X=20*(Z*2-X)/(X*(S.numlines_s[j-1]+S.numlines_s[j]-1));var q=0|X;q>Y&&(q=Y),U[j]=q}else U[j]=0;Ce(j==S.npart_s-1)}function lt(S,B,P,U,Y,j){var X=S.internal_flags,Z=new float[A.CBANDS],q=ot(A.CBANDS),ae,Q,re,_e=new int[A.CBANDS];for(re=Q=0;re<X.npart_s;++re){var Ee=0,se=0,ke=X.numlines_s[re];for(ae=0;ae<ke;++ae,++Q){var $=B[j][Q];Ee+=$,se<$&&(se=$)}P[re]=Ee,Z[re]=se,q[re]=Ee/ke,Ce(q[re]>=0)}for(Ce(re==X.npart_s);re<A.CBANDS;++re)Z[re]=0,q[re]=0;for(pt(X,Z,q,_e),Q=re=0;re<X.npart_s;re++){var be=X.s3ind_s[re][0],Be=X.s3ind_s[re][1],oe,xe,ne,Me,We;for(oe=_e[be],xe=1,Me=X.s3_ss[Q]*P[be]*x[_e[be]],++Q,++be;be<=Be;)oe+=_e[be],xe+=1,ne=X.s3_ss[Q]*P[be]*x[_e[be]],Me=_(Me,ne,be-re),++Q,++be;oe=(1+2*oe)/(2*xe),We=x[oe]*.5,Me*=We,U[re]=Me,X.nb_s2[Y][re]=X.nb_s1[Y][re],X.nb_s1[Y][re]=Me,ne=Z[re],ne*=X.minval_s[re],ne*=We,U[re]>ne&&(U[re]=ne),X.masking_lower>1&&(U[re]*=X.masking_lower),U[re]>P[re]&&(U[re]=P[re]),X.masking_lower<1&&(U[re]*=X.masking_lower),Ce(U[re]>=0)}for(;re<A.CBANDS;++re)P[re]=0,U[re]=0}function rt(S,B,P,U,Y){var j=ot(A.CBANDS),X=ot(A.CBANDS),Z=ya(A.CBANDS+2),q;Se(S,B,P,j,X),ve(S,j,X,Z);var ae=0;for(q=0;q<S.npart_l;q++){var Q,re,_e,Ee,se=S.s3ind[q][0],ke=S.s3ind[q][1],$=0,be=0;for($=Z[se],be+=1,re=S.s3_ll[ae]*P[se]*x[Z[se]],++ae,++se;se<=ke;)$+=Z[se],be+=1,Q=S.s3_ll[ae]*P[se]*x[Z[se]],Ee=_(re,Q,se-q),re=Ee,++ae,++se;if($=(1+2*$)/(2*be),_e=x[$]*.5,re*=_e,S.blocktype_old[Y&1]==A.SHORT_TYPE){var Be=a*S.nb_1[Y][q];Be>0?U[q]=Math.min(re,Be):U[q]=Math.min(re,P[q]*h)}else{var oe=n*S.nb_2[Y][q],xe=a*S.nb_1[Y][q],Be;oe<=0&&(oe=re),xe<=0&&(xe=re),S.blocktype_old[Y&1]==A.NORM_TYPE?Be=Math.min(xe,oe):Be=xe,U[q]=Math.min(re,Be)}S.nb_2[Y][q]=S.nb_1[Y][q],S.nb_1[Y][q]=re,Q=j[q],Q*=S.minval_l[q],Q*=_e,U[q]>Q&&(U[q]=Q),S.masking_lower>1&&(U[q]*=S.masking_lower),U[q]>P[q]&&(U[q]=P[q]),S.masking_lower<1&&(U[q]*=S.masking_lower),Ce(U[q]>=0)}for(;q<A.CBANDS;++q)P[q]=0,U[q]=0}function vt(S,B){var P=S.internal_flags;S.short_blocks==Fa.short_block_coupled&&!(B[0]!=0&&B[1]!=0)&&(B[0]=B[1]=0);for(var U=0;U<P.channels_out;U++)S.short_blocks==Fa.short_block_dispensed&&(B[U]=1),S.short_blocks==Fa.short_block_forced&&(B[U]=0)}function Et(S,B,P){for(var U=S.internal_flags,Y=0;Y<U.channels_out;Y++){var j=A.NORM_TYPE;B[Y]!=0?(Ce(U.blocktype_old[Y]!=A.START_TYPE),U.blocktype_old[Y]==A.SHORT_TYPE&&(j=A.STOP_TYPE)):(j=A.SHORT_TYPE,U.blocktype_old[Y]==A.NORM_TYPE&&(U.blocktype_old[Y]=A.START_TYPE),U.blocktype_old[Y]==A.STOP_TYPE&&(U.blocktype_old[Y]=A.SHORT_TYPE)),P[Y]=U.blocktype_old[Y],U.blocktype_old[Y]=j}}function Bt(S,B,P,U,Y,j,X){for(var Z=j*2,q=j>0?Math.pow(10,Y):1,ae,Q,re=0;re<X;++re){var _e=S[2][re],Ee=S[3][re],se=B[0][re],ke=B[1][re],$=B[2][re],be=B[3][re];if(se<=1.58*ke&&ke<=1.58*se){var Be=P[re]*Ee,oe=P[re]*_e;Q=Math.max($,Math.min(be,Be)),ae=Math.max(be,Math.min($,oe))}else Q=$,ae=be;if(j>0){var xe,ne,Me=U[re]*q;if(xe=Math.min(Math.max(se,Me),Math.max(ke,Me)),$=Math.max(Q,Me),be=Math.max(ae,Me),ne=$+be,ne>0&&xe*Z<ne){var We=xe*Z/ne;$*=We,be*=We}Q=Math.min($,Q),ae=Math.min(be,ae)}Q>_e&&(Q=_e),ae>Ee&&(ae=Ee),B[2][re]=Q,B[3][re]=ae}}this.L3psycho_anal_vbr=function(S,B,P,U,Y,j,X,Z,q,ae){var Q=S.internal_flags,re,_e,Ee=ot(A.HBLKSIZE),se=It([3,A.HBLKSIZE_s]),ke=It([2,A.BLKSIZE]),$=It([2,3,A.BLKSIZE_s]),be=It([4,A.CBANDS]),Be=It([4,A.CBANDS]),oe=It([4,3]),xe=.6,ne=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],Me=ya(2),We=S.mode==De.JOINT_STEREO?4:Q.channels_out;Pe(S,B,P,U,Y,j,q,oe,ne,Me),vt(S,Me);{for(var pe=0;pe<We;pe++){var Ae=pe&1;re=ke,Re(S,B,P,pe,U,Ee,re,Ae),Oe(S,U,pe,Ee),Me[Ae]!=0?rt(Q,Ee,be[pe],Be[pe],pe):Ze(Q,pe)}Me[0]+Me[1]==2&&S.mode==De.JOINT_STEREO&&Bt(be,Be,Q.mld_cb_l,Q.ATH.cb_l,S.ATHlower*Q.ATH.adjust,S.msfix,Q.npart_l);for(var pe=0;pe<We;pe++){var Ae=pe&1;Me[Ae]!=0&&i(Q,be[pe],Be[pe],pe)}}{for(var Ne=0;Ne<3;Ne++){for(var pe=0;pe<We;++pe){var Ae=pe&1;Me[Ae]!=0?Fe(Q,pe,Ne):(_e=$,He(S,B,P,pe,Ne,se,_e,Ae),lt(S,se,be[pe],Be[pe],pe,Ne))}Me[0]+Me[1]==0&&S.mode==De.JOINT_STEREO&&Bt(be,Be,Q.mld_cb_s,Q.ATH.cb_s,S.ATHlower*Q.ATH.adjust,S.msfix,Q.npart_s);for(var pe=0;pe<We;++pe){var Ae=pe&1;Me[Ae]==0&&z(Q,be[pe],Be[pe],pe,Ne)}}for(var pe=0;pe<We;pe++){var Ae=pe&1;if(Me[Ae]==0)for(var Qe=0;Qe<A.SBMAX_s;Qe++){for(var Ct=ot(3),Ne=0;Ne<3;Ne++){var st=Q.thm[pe].s[Qe][Ne];if(st*=b,ne[pe][Ne]>=2||ne[pe][Ne+1]==1){var Je=Ne!=0?Ne-1:2,Mt=W(Q.thm[pe].s[Qe][Je],st,E*xe);st=Math.min(st,Mt)}else if(ne[pe][Ne]==1){var Je=Ne!=0?Ne-1:2,Mt=W(Q.thm[pe].s[Qe][Je],st,h*xe);st=Math.min(st,Mt)}else if(Ne!=0&&ne[pe][Ne-1]==3||Ne==0&&Q.nsPsy.lastAttacks[pe]==3){var Je=Ne!=2?Ne+1:0,Mt=W(Q.thm[pe].s[Qe][Je],st,h*xe);st=Math.min(st,Mt)}st*=oe[pe][Ne],Ct[Ne]=st}for(var Ne=0;Ne<3;Ne++)Q.thm[pe].s[Qe][Ne]=Ct[Ne]}}}for(var pe=0;pe<We;pe++)Q.nsPsy.lastAttacks[pe]=ne[pe][2];Et(S,Me,ae);for(var pe=0;pe<We;pe++){var Ot,Nt,zt,qt;pe>1?(Ot=Z,Nt=-2,zt=A.NORM_TYPE,(ae[0]==A.SHORT_TYPE||ae[1]==A.SHORT_TYPE)&&(zt=A.SHORT_TYPE),qt=j[U][pe-2]):(Ot=X,Nt=0,zt=ae[pe],qt=Y[U][pe]),zt==A.SHORT_TYPE?Ot[Nt+pe]=he(qt,Q.masking_lower):Ot[Nt+pe]=de(qt,Q.masking_lower),S.analysis&&(Q.pinfo.pe[U][pe]=Ot[Nt+pe])}return 0};function it(S,B){var P=S,U;return P>=0?U=-P*27:U=P*B,U<=-72?0:Math.exp(U*s)}function Ht(S){var B=0,P=0;{var U=0,Y,j;for(U=0;it(U,S)>1e-20;U-=1);for(Y=U,j=0;Math.abs(j-Y)>1e-12;)U=(j+Y)/2,it(U,S)>0?j=U:Y=U;B=Y}{var U=0,Y,j;for(U=0;it(U,S)>1e-20;U+=1);for(Y=0,j=U;Math.abs(j-Y)>1e-12;)U=(j+Y)/2,it(U,S)>0?Y=U:j=U;P=j}{var X=0,Z=1e3,q;for(q=0;q<=Z;++q){var U=B+q*(P-B)/Z,ae=it(U,S);X+=ae}{var Q=(Z+1)/(X*(P-B));return Q}}}function gt(S){var B,P,U,Y;return B=S,B>=0?B*=3:B*=1.5,B>=.5&&B<=2.5?(Y=B-.5,P=8*(Y*Y-2*Y)):P=0,B+=.474,U=15.811389+7.5*B-17.5*Math.sqrt(1+B*B),U<=-60?0:(B=Math.exp((P+U)*s),B/=.6609193,B)}function ct(S){return S<0&&(S=0),S=S*.001,13*Math.atan(.76*S)+3.5*Math.atan(S*S/(7.5*7.5))}function le(S,B,P,U,Y,j,X,Z,q,ae,Q,re){var _e=ot(A.CBANDS+1),Ee=Z/(re>15?2*576:2*192),se=ya(A.HBLKSIZE),ke;Z/=q;var $=0,be=0;for(ke=0;ke<A.CBANDS;ke++){var Be,oe;for(Be=ct(Z*$),_e[ke]=Z*$,oe=$;ct(Z*oe)-Be<k&&oe<=q/2;oe++);for(S[ke]=oe-$,be=ke+1;$<oe;)se[$++]=ke;if($>q/2){$=q/2,++ke;break}}_e[ke]=Z*$;for(var xe=0;xe<re;xe++){var ne,Me,We,pe,Ae;We=ae[xe],pe=ae[xe+1],ne=0|Math.floor(.5+Q*(We-.5)),ne<0&&(ne=0),Me=0|Math.floor(.5+Q*(pe-.5)),Me>q/2&&(Me=q/2),P[xe]=(se[ne]+se[Me])/2,B[xe]=se[Me];var Ne=Ee*pe;X[xe]=(Ne-_e[B[xe]])/(_e[B[xe]+1]-_e[B[xe]]),X[xe]<0?X[xe]=0:X[xe]>1&&(X[xe]=1),Ae=ct(Z*ae[xe]*Q),Ae=Math.min(Ae,15.5)/15.5,j[xe]=Math.pow(10,1.25*(1-Math.cos(Math.PI*Ae))-2.5)}$=0;for(var Qe=0;Qe<be;Qe++){var Ct=S[Qe],Be,st;Be=ct(Z*$),st=ct(Z*($+Ct-1)),U[Qe]=.5*(Be+st),Be=ct(Z*($-.5)),st=ct(Z*($+Ct-.5)),Y[Qe]=st-Be,$+=Ct}return be}function ge(S,B,P,U,Y,j){var X=It([A.CBANDS,A.CBANDS]),Z,q=0;if(j)for(var ae=0;ae<B;ae++)for(Z=0;Z<B;Z++){var Q=gt(P[ae]-P[Z])*U[Z];X[ae][Z]=Q*Y[ae]}else for(Z=0;Z<B;Z++)for(var re=15+Math.min(21/P[Z],12),_e=Ht(re),ae=0;ae<B;ae++){var Q=_e*it(P[ae]-P[Z],re)*U[Z];X[ae][Z]=Q*Y[ae]}for(var ae=0;ae<B;ae++){for(Z=0;Z<B&&!(X[ae][Z]>0);Z++);for(S[ae][0]=Z,Z=B-1;Z>0&&!(X[ae][Z]>0);Z--);S[ae][1]=Z,q+=S[ae][1]-S[ae][0]+1}for(var Ee=ot(q),se=0,ae=0;ae<B;ae++)for(Z=S[ae][0];Z<=S[ae][1];Z++)Ee[se++]=X[ae][Z];return Ee}function te(S){var B=ct(S);return B=Math.min(B,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*B))-2.5)}this.psymodel_init=function(S){var B=S.internal_flags,P,U=!0,Y=13,j=24,X=0,Z=0,q=-8.25,ae=-4.5,Q=ot(A.CBANDS),re=ot(A.CBANDS),_e=ot(A.CBANDS),Ee=S.out_samplerate;switch(S.experimentalZ){default:case 0:U=!0;break;case 1:U=!(S.VBR==Pa.vbr_mtrh||S.VBR==Pa.vbr_mt);break;case 2:U=!1;break;case 3:Y=8,X=-1.75,Z=-.0125,q=-8.25,ae=-2.25;break}for(B.ms_ener_ratio_old=.25,B.blocktype_old[0]=B.blocktype_old[1]=A.NORM_TYPE,P=0;P<4;++P){for(var $=0;$<A.CBANDS;++$)B.nb_1[P][$]=1e20,B.nb_2[P][$]=1e20,B.nb_s1[P][$]=B.nb_s2[P][$]=1;for(var se=0;se<A.SBMAX_l;se++)B.en[P].l[se]=1e20,B.thm[P].l[se]=1e20;for(var $=0;$<3;++$){for(var se=0;se<A.SBMAX_s;se++)B.en[P].s[se][$]=1e20,B.thm[P].s[se][$]=1e20;B.nsPsy.lastAttacks[P]=0}for(var $=0;$<9;$++)B.nsPsy.last_en_subshort[P][$]=10}for(B.loudness_sq_save[0]=B.loudness_sq_save[1]=0,B.npart_l=le(B.numlines_l,B.bo_l,B.bm_l,Q,re,B.mld_l,B.PSY.bo_l_weight,Ee,A.BLKSIZE,B.scalefac_band.l,A.BLKSIZE/(2*576),A.SBMAX_l),Ce(B.npart_l<A.CBANDS),P=0;P<B.npart_l;P++){var ke=X;Q[P]>=Y&&(ke=Z*(Q[P]-Y)/(j-Y)+X*(j-Q[P])/(j-Y)),_e[P]=Math.pow(10,ke/10),B.numlines_l[P]>0?B.rnumlines_l[P]=1/B.numlines_l[P]:B.rnumlines_l[P]=0}B.s3_ll=ge(B.s3ind,B.npart_l,Q,re,_e,U);var $=0;for(P=0;P<B.npart_l;P++){var be;be=Gn.MAX_VALUE;for(var Be=0;Be<B.numlines_l[P];Be++,$++){var oe=Ee*$/(1e3*A.BLKSIZE),xe;xe=this.ATHformula(oe*1e3,S)-20,xe=Math.pow(10,.1*xe),xe*=B.numlines_l[P],be>xe&&(be=xe)}B.ATH.cb_l[P]=be,be=-20+Q[P]*20/10,be>6&&(be=100),be<-15&&(be=-15),be-=8,B.minval_l[P]=Math.pow(10,be/10)*B.numlines_l[P]}for(B.npart_s=le(B.numlines_s,B.bo_s,B.bm_s,Q,re,B.mld_s,B.PSY.bo_s_weight,Ee,A.BLKSIZE_s,B.scalefac_band.s,A.BLKSIZE_s/(2*192),A.SBMAX_s),Ce(B.npart_s<A.CBANDS),$=0,P=0;P<B.npart_s;P++){var be,ke=q;Q[P]>=Y&&(ke=ae*(Q[P]-Y)/(j-Y)+q*(j-Q[P])/(j-Y)),_e[P]=Math.pow(10,ke/10),be=Gn.MAX_VALUE;for(var Be=0;Be<B.numlines_s[P];Be++,$++){var oe=Ee*$/(1e3*A.BLKSIZE_s),xe;xe=this.ATHformula(oe*1e3,S)-20,xe=Math.pow(10,.1*xe),xe*=B.numlines_s[P],be>xe&&(be=xe)}B.ATH.cb_s[P]=be,be=-7+Q[P]*7/12,Q[P]>12&&(be*=1+Math.log(1+be)*3.1),Q[P]<12&&(be*=1+Math.log(1-be)*2.3),be<-15&&(be=-15),be-=8,B.minval_s[P]=Math.pow(10,be/10)*B.numlines_s[P]}B.s3_ss=ge(B.s3ind_s,B.npart_s,Q,re,_e,U),y(),e.init_fft(B),B.decay=Math.exp(-1*t/(L*Ee/192));{var ne;ne=R,(S.exp_nspsytune&2)!=0&&(ne=1),Math.abs(S.msfix)>0&&(ne=S.msfix),S.msfix=ne;for(var Me=0;Me<B.npart_l;Me++)B.s3ind[Me][1]>B.npart_l-1&&(B.s3ind[Me][1]=B.npart_l-1)}var We=576*B.mode_gr/Ee;if(B.ATH.decay=Math.pow(10,-12/10*We),B.ATH.adjust=.01,B.ATH.adjustLimit=1,Ce(B.bo_l[A.SBMAX_l-1]<=B.npart_l),Ce(B.bo_s[A.SBMAX_s-1]<=B.npart_s),S.ATHtype!=-1){var oe,pe=S.out_samplerate/A.BLKSIZE,Ae=0;for(oe=0,P=0;P<A.BLKSIZE/2;++P)oe+=pe,B.ATH.eql_w[P]=1/Math.pow(10,this.ATHformula(oe,S)/10),Ae+=B.ATH.eql_w[P];for(Ae=1/Ae,P=A.BLKSIZE/2;--P>=0;)B.ATH.eql_w[P]*=Ae}{for(var Me=$=0;Me<B.npart_s;++Me)for(P=0;P<B.numlines_s[Me];++P)++$;for(var Me=$=0;Me<B.npart_l;++Me)for(P=0;P<B.numlines_l[Me];++P)++$}for($=0,P=0;P<B.npart_l;P++){var oe=Ee*($+B.numlines_l[P]/2)/(1*A.BLKSIZE);B.mld_cb_l[P]=te(oe),$+=B.numlines_l[P]}for(;P<A.CBANDS;++P)B.mld_cb_l[P]=1;for($=0,P=0;P<B.npart_s;P++){var oe=Ee*($+B.numlines_s[P]/2)/(1*A.BLKSIZE_s);B.mld_cb_s[P]=te(oe),$+=B.numlines_s[P]}for(;P<A.CBANDS;++P)B.mld_cb_s[P]=1;return 0};function ye(S,B){S<-.3&&(S=3410),S/=1e3,S=Math.max(.1,S);var P=3.64*Math.pow(S,-.8)-6.8*Math.exp(-.6*Math.pow(S-3.4,2))+6*Math.exp(-.15*Math.pow(S-8.7,2))+(.6+.04*B)*.001*Math.pow(S,4);return P}this.ATHformula=function(S,B){var P;switch(B.ATHtype){case 0:P=ye(S,9);break;case 1:P=ye(S,-1);break;case 2:P=ye(S,0);break;case 3:P=ye(S,1)+6;break;case 4:P=ye(S,B.ATHcurve);break;default:P=ye(S,0);break}return P}}function jd(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=De.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var la={};la.SFBMAX=A.SBMAX_s*3;var Vd=fe.new_float,xa=fe.new_int;function ts(){this.xr=Vd(576),this.l3_enc=xa(576),this.scalefac=xa(la.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=xa(3),this.subblock_gain=xa(3+1),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=xa(la.SFBMAX),this.window=xa(la.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=xa(4),this.max_nonzero_coeff=0;var e=this;function t(n){return new Int32Array(n)}function a(n){return new Float32Array(n)}this.assign=function(n){e.xr=a(n.xr),e.l3_enc=t(n.l3_enc),e.scalefac=t(n.scalefac),e.xrpow_max=n.xrpow_max,e.part2_3_length=n.part2_3_length,e.big_values=n.big_values,e.count1=n.count1,e.global_gain=n.global_gain,e.scalefac_compress=n.scalefac_compress,e.block_type=n.block_type,e.mixed_block_flag=n.mixed_block_flag,e.table_select=t(n.table_select),e.subblock_gain=t(n.subblock_gain),e.region0_count=n.region0_count,e.region1_count=n.region1_count,e.preflag=n.preflag,e.scalefac_scale=n.scalefac_scale,e.count1table_select=n.count1table_select,e.part2_length=n.part2_length,e.sfb_lmax=n.sfb_lmax,e.sfb_smin=n.sfb_smin,e.psy_lmax=n.psy_lmax,e.sfbmax=n.sfbmax,e.psymax=n.psymax,e.sfbdivide=n.sfbdivide,e.width=t(n.width),e.window=t(n.window),e.count1bits=n.count1bits,e.sfb_partition_table=n.sfb_partition_table.slice(0),e.slen=t(n.slen),e.max_nonzero_coeff=n.max_nonzero_coeff}}var Kn=fe.new_int;function Hd(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[Kn(4),Kn(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new ts}var as=fe.System,rs=fe.new_int;function Zt(e,t,a,n){this.l=rs(1+A.SBMAX_l),this.s=rs(1+A.SBMAX_s),this.psfb21=rs(1+A.PSFB21),this.psfb12=rs(1+A.PSFB12);var d=this.l,o=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],as.arraycopy(this.arrL,0,d,0,Math.min(this.arrL.length,this.l.length)),as.arraycopy(this.arrS,0,o,0,Math.min(this.arrS.length,this.s.length)),as.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),as.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var Ys=fe.new_float,Pd=fe.new_float_n,Fd=fe.new_int;function Dd(){this.last_en_subshort=Pd([4,9]),this.lastAttacks=Fd(4),this.pefirbuf=Ys(19),this.longfact=Ys(A.SBMAX_l),this.shortfact=Ys(A.SBMAX_s),this.attackthre=0,this.attackthre_s=0}function Ud(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var zd=fe.new_byte,qd=fe.new_double,jt=fe.new_float,wa=fe.new_float_n,Ut=fe.new_int,ss=fe.new_int_n;Ve.MFSIZE=3*1152+A.ENCDELAY-A.MDCTDELAY,Ve.MAX_HEADER_BUF=256,Ve.MAX_BITS_PER_CHANNEL=4095,Ve.MAX_BITS_PER_GRANULE=7680,Ve.BPC=320;function Ve(){var e=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=wa([2,Ve.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new Hd,this.ms_ratio=jt(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=Ut(2),this.CurrentStep=Ut(2),this.masking_lower=0,this.bv_scf=Ut(576),this.pseudohalf=Ut(la.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*Ve.BPC+1),this.itime=qd(2),this.sideinfo_len=0,this.sb_sample=wa([2,2,18,A.SBLIMIT]),this.amp_filter=jt(32);function t(){this.write_timing=0,this.ptr=0,this.buf=zd(e)}this.header=new Array(Ve.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new Zt,this.minval_l=jt(A.CBANDS),this.minval_s=jt(A.CBANDS),this.nb_1=wa([4,A.CBANDS]),this.nb_2=wa([4,A.CBANDS]),this.nb_s1=wa([4,A.CBANDS]),this.nb_s2=wa([4,A.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=jt(4),this.loudness_sq=wa([2,2]),this.loudness_sq_save=jt(2),this.mld_l=jt(A.SBMAX_l),this.mld_s=jt(A.SBMAX_s),this.bm_l=Ut(A.SBMAX_l),this.bo_l=Ut(A.SBMAX_l),this.bm_s=Ut(A.SBMAX_s),this.bo_s=Ut(A.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=ss([A.CBANDS,2]),this.s3ind_s=ss([A.CBANDS,2]),this.numlines_s=Ut(A.CBANDS),this.numlines_l=Ut(A.CBANDS),this.rnumlines_l=jt(A.CBANDS),this.mld_cb_l=jt(A.CBANDS),this.mld_cb_s=jt(A.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=jt(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=Ut(2),this.nsPsy=new Dd,this.VBR_seek_table=new Ud,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=ss([16,4+1]),this.bitrate_blockType_Hist=ss([16,4+1+1]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var a=0;a<this.en.length;a++)this.en[a]=new Jr;for(var a=0;a<this.thm.length;a++)this.thm[a]=new Jr;for(var a=0;a<this.header.length;a++)this.header[a]=new t}var ka=fe.new_float;function Yd(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=ka(A.SBMAX_l),this.s=ka(A.SBMAX_s),this.psfb21=ka(A.PSFB21),this.psfb12=ka(A.PSFB12),this.cb_l=ka(A.CBANDS),this.cb_s=ka(A.CBANDS),this.eql_w=ka(A.BLKSIZE/2)}var St=fe.System,Zn=fe.Arrays;at.STEPS_per_dB=100,at.MAX_dB=120,at.GAIN_NOT_ENOUGH_SAMPLES=-24601,at.GAIN_ANALYSIS_ERROR=0,at.GAIN_ANALYSIS_OK=1,at.INIT_GAIN_ANALYSIS_ERROR=0,at.INIT_GAIN_ANALYSIS_OK=1,at.YULE_ORDER=10,at.MAX_ORDER=at.YULE_ORDER,at.MAX_SAMP_FREQ=48e3,at.RMS_WINDOW_TIME_NUMERATOR=1,at.RMS_WINDOW_TIME_DENOMINATOR=20,at.MAX_SAMPLES_PER_WINDOW=at.MAX_SAMP_FREQ*at.RMS_WINDOW_TIME_NUMERATOR/at.RMS_WINDOW_TIME_DENOMINATOR+1;function at(){var e=64.82,t=.95,a=at.RMS_WINDOW_TIME_NUMERATOR,n=at.RMS_WINDOW_TIME_DENOMINATOR,d=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],o=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function k(h,R,w,s,F,H){for(;F--!=0;)w[s]=1e-10+h[R+0]*H[0]-w[s-1]*H[1]+h[R-1]*H[2]-w[s-2]*H[3]+h[R-2]*H[4]-w[s-3]*H[5]+h[R-3]*H[6]-w[s-4]*H[7]+h[R-4]*H[8]-w[s-5]*H[9]+h[R-5]*H[10]-w[s-6]*H[11]+h[R-6]*H[12]-w[s-7]*H[13]+h[R-7]*H[14]-w[s-8]*H[15]+h[R-8]*H[16]-w[s-9]*H[17]+h[R-9]*H[18]-w[s-10]*H[19]+h[R-10]*H[20],++s,++R}function C(h,R,w,s,F,H){for(;F--!=0;)w[s]=h[R+0]*H[0]-w[s-1]*H[1]+h[R-1]*H[2]-w[s-2]*H[3]+h[R-2]*H[4],++s,++R}function L(h,R){for(var w=0;w<MAX_ORDER;w++)h.linprebuf[w]=h.lstepbuf[w]=h.loutbuf[w]=h.rinprebuf[w]=h.rstepbuf[w]=h.routbuf[w]=0;switch(0|R){case 48e3:h.reqindex=0;break;case 44100:h.reqindex=1;break;case 32e3:h.reqindex=2;break;case 24e3:h.reqindex=3;break;case 22050:h.reqindex=4;break;case 16e3:h.reqindex=5;break;case 12e3:h.reqindex=6;break;case 11025:h.reqindex=7;break;case 8e3:h.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return h.sampleWindow=0|(R*a+n-1)/n,h.lsum=0,h.rsum=0,h.totsamp=0,Zn.ill(h.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(h,R){return L(h,R)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(h.linpre=MAX_ORDER,h.rinpre=MAX_ORDER,h.lstep=MAX_ORDER,h.rstep=MAX_ORDER,h.lout=MAX_ORDER,h.rout=MAX_ORDER,Zn.fill(h.B,0),INIT_GAIN_ANALYSIS_OK)};function b(h){return h*h}this.AnalyzeSamples=function(h,R,w,s,F,H,V){var c,T,N,M,O,l,x;if(H==0)return GAIN_ANALYSIS_OK;switch(x=0,O=H,V){case 1:s=R,F=w;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(H<MAX_ORDER?(St.arraycopy(R,w,h.linprebuf,MAX_ORDER,H),St.arraycopy(s,F,h.rinprebuf,MAX_ORDER,H)):(St.arraycopy(R,w,h.linprebuf,MAX_ORDER,MAX_ORDER),St.arraycopy(s,F,h.rinprebuf,MAX_ORDER,MAX_ORDER));O>0;){l=O>h.sampleWindow-h.totsamp?h.sampleWindow-h.totsamp:O,x<MAX_ORDER?(c=h.linpre+x,T=h.linprebuf,N=h.rinpre+x,M=h.rinprebuf,l>MAX_ORDER-x&&(l=MAX_ORDER-x)):(c=w+x,T=R,N=F+x,M=s),k(T,c,h.lstepbuf,h.lstep+h.totsamp,l,d[h.reqindex]),k(M,N,h.rstepbuf,h.rstep+h.totsamp,l,d[h.reqindex]),C(h.lstepbuf,h.lstep+h.totsamp,h.loutbuf,h.lout+h.totsamp,l,o[h.reqindex]),C(h.rstepbuf,h.rstep+h.totsamp,h.routbuf,h.rout+h.totsamp,l,o[h.reqindex]),c=h.lout+h.totsamp,T=h.loutbuf,N=h.rout+h.totsamp,M=h.routbuf;for(var y=l%8;y--!=0;)h.lsum+=b(T[c++]),h.rsum+=b(M[N++]);for(y=l/8;y--!=0;)h.lsum+=b(T[c+0])+b(T[c+1])+b(T[c+2])+b(T[c+3])+b(T[c+4])+b(T[c+5])+b(T[c+6])+b(T[c+7]),c+=8,h.rsum+=b(M[N+0])+b(M[N+1])+b(M[N+2])+b(M[N+3])+b(M[N+4])+b(M[N+5])+b(M[N+6])+b(M[N+7]),N+=8;if(O-=l,x+=l,h.totsamp+=l,h.totsamp==h.sampleWindow){var m=at.STEPS_per_dB*10*Math.log10((h.lsum+h.rsum)/h.totsamp*.5+1e-37),f=m<=0?0:0|m;f>=h.A.length&&(f=h.A.length-1),h.A[f]++,h.lsum=h.rsum=0,St.arraycopy(h.loutbuf,h.totsamp,h.loutbuf,0,MAX_ORDER),St.arraycopy(h.routbuf,h.totsamp,h.routbuf,0,MAX_ORDER),St.arraycopy(h.lstepbuf,h.totsamp,h.lstepbuf,0,MAX_ORDER),St.arraycopy(h.rstepbuf,h.totsamp,h.rstepbuf,0,MAX_ORDER),h.totsamp=0}if(h.totsamp>h.sampleWindow)return GAIN_ANALYSIS_ERROR}return H<MAX_ORDER?(St.arraycopy(h.linprebuf,H,h.linprebuf,0,MAX_ORDER-H),St.arraycopy(h.rinprebuf,H,h.rinprebuf,0,MAX_ORDER-H),St.arraycopy(R,w,h.linprebuf,MAX_ORDER-H,H),St.arraycopy(s,F,h.rinprebuf,MAX_ORDER-H,H)):(St.arraycopy(R,w+H-MAX_ORDER,h.linprebuf,0,MAX_ORDER),St.arraycopy(s,F+H-MAX_ORDER,h.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function E(h,R){var w,s=0;for(w=0;w<R;w++)s+=h[w];if(s==0)return GAIN_NOT_ENOUGH_SAMPLES;var F=0|Math.ceil(s*(1-t));for(w=R;w-- >0&&!((F-=h[w])<=0););return e-w/at.STEPS_per_dB}this.GetTitleGain=function(h){for(var R=E(h.A,h.A.length),w=0;w<h.A.length;w++)h.B[w]+=h.A[w],h.A[w]=0;for(var w=0;w<MAX_ORDER;w++)h.linprebuf[w]=h.lstepbuf[w]=h.loutbuf[w]=h.rinprebuf[w]=h.rstepbuf[w]=h.routbuf[w]=0;return h.totsamp=0,h.lsum=h.rsum=0,R}}var Da=fe.new_float,Wn=fe.new_int;function Xd(){this.linprebuf=Da(void 0*2),this.linpre=0,this.lstepbuf=Da(void 0+void 0),this.lstep=0,this.loutbuf=Da(void 0+void 0),this.lout=0,this.rinprebuf=Da(void 0*2),this.rinpre=0,this.rstepbuf=Da(void 0+void 0),this.rstep=0,this.routbuf=Da(void 0+void 0),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=Wn(0|void 0*void 0),this.B=Wn(0|void 0*void 0)}function Qn(e){this.bits=e}var Jn=fe.new_float,Gd=fe.new_int,$n=fe.assert;function Kd(e){var t=e;this.quantize=t,this.iteration_loop=function(a,n,d,o){var k=a.internal_flags,C=Jn(la.SFBMAX),L=Jn(576),b=Gd(2),E=0,h,R=k.l3_side,w=new Qn(E);this.quantize.rv.ResvFrameBegin(a,w),E=w.bits;for(var s=0;s<k.mode_gr;s++){h=this.quantize.qupvt.on_pe(a,n,b,E,s,s),k.mode_ext==A.MPG_MD_MS_LR&&(this.quantize.ms_convert(k.l3_side,s),this.quantize.qupvt.reduce_side(b,d[s],E,h));for(var F=0;F<k.channels_out;F++){var H,V,c=R.tt[s][F];c.block_type!=A.SHORT_TYPE?(H=0,V=k.PSY.mask_adjust-H):(H=0,V=k.PSY.mask_adjust_short-H),k.masking_lower=Math.pow(10,V*.1),this.quantize.init_outer_loop(k,c),this.quantize.init_xrpow(k,c,L)&&(this.quantize.qupvt.calc_xmin(a,o[s][F],c,C),this.quantize.outer_loop(a,c,C,L,F,b[F])),this.quantize.iteration_finish_one(k,s,F),$n(c.part2_3_length<=Ve.MAX_BITS_PER_CHANNEL),$n(c.part2_3_length<=b[F])}}this.quantize.rv.ResvFrameEnd(k,E)}}function je(e,t,a,n){this.xlen=e,this.linmax=t,this.table=a,this.hlen=n}var ee={};ee.t1HB=[1,1,1,0],ee.t2HB=[1,2,1,3,1,1,3,2,0],ee.t3HB=[3,2,1,1,1,1,3,2,0],ee.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],ee.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],ee.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],ee.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],ee.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],ee.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],ee.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],ee.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],ee.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],ee.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],ee.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],ee.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],ee.t32HB=[1<<0,5<<1,4<<1,5<<2,6<<1,5<<2,4<<2,4<<3,7<<1,3<<2,6<<2,0<<3,7<<2,2<<3,3<<3,1<<4],ee.t33HB=[15<<0,14<<1,13<<1,12<<2,11<<1,10<<2,9<<2,8<<3,7<<1,6<<2,5<<2,4<<3,3<<2,2<<3,1<<3,0<<4],ee.t1l=[1,4,3,5],ee.t2l=[1,4,7,4,5,7,6,7,8],ee.t3l=[2,3,7,4,4,7,6,7,8],ee.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],ee.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],ee.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],ee.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],ee.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],ee.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],ee.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],ee.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],ee.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],ee.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],ee.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],ee.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],ee.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],ee.t32l=[1+0,4+1,4+1,5+2,4+1,6+2,5+2,6+3,4+1,5+2,5+2,6+3,5+2,6+3,6+3,6+4],ee.t33l=[4+0,4+1,4+1,4+2,4+1,4+2,4+2,4+3,4+1,4+2,4+2,4+3,4+2,4+3,4+3,4+4],ee.ht=[new je(0,0,null,null),new je(2,0,ee.t1HB,ee.t1l),new je(3,0,ee.t2HB,ee.t2l),new je(3,0,ee.t3HB,ee.t3l),new je(0,0,null,null),new je(4,0,ee.t5HB,ee.t5l),new je(4,0,ee.t6HB,ee.t6l),new je(6,0,ee.t7HB,ee.t7l),new je(6,0,ee.t8HB,ee.t8l),new je(6,0,ee.t9HB,ee.t9l),new je(8,0,ee.t10HB,ee.t10l),new je(8,0,ee.t11HB,ee.t11l),new je(8,0,ee.t12HB,ee.t12l),new je(16,0,ee.t13HB,ee.t13l),new je(0,0,null,ee.t16_5l),new je(16,0,ee.t15HB,ee.t15l),new je(1,1,ee.t16HB,ee.t16l),new je(2,3,ee.t16HB,ee.t16l),new je(3,7,ee.t16HB,ee.t16l),new je(4,15,ee.t16HB,ee.t16l),new je(6,63,ee.t16HB,ee.t16l),new je(8,255,ee.t16HB,ee.t16l),new je(10,1023,ee.t16HB,ee.t16l),new je(13,8191,ee.t16HB,ee.t16l),new je(4,15,ee.t24HB,ee.t24l),new je(5,31,ee.t24HB,ee.t24l),new je(6,63,ee.t24HB,ee.t24l),new je(7,127,ee.t24HB,ee.t24l),new je(8,255,ee.t24HB,ee.t24l),new je(9,511,ee.t24HB,ee.t24l),new je(11,2047,ee.t24HB,ee.t24l),new je(13,8191,ee.t24HB,ee.t24l),new je(0,0,ee.t32HB,ee.t32l),new je(0,0,ee.t33HB,ee.t33l)],ee.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],ee.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],ee.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],ee.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],ee.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],ee.scfsi_band=[0,6,11,16,21];var Sa=fe.VbrMode,os=fe.Float,Xs=fe.Util,Ea=fe.new_float,Zd=fe.new_int,vr=fe.assert;_t.Q_MAX=256+1,_t.Q_MAX2=116,_t.LARGE_BITS=1e5,_t.IXMAX_VAL=8206;function _t(){var e=null,t=null,a=null;this.setModules=function(c,T,N){e=c,t=T,a=N};function n(c){return h[c+_t.Q_MAX2]}this.IPOW20=function(c){return R[c]};var d=2220446049250313e-31,o=_t.IXMAX_VAL,k=o+2,C=_t.Q_MAX,L=_t.Q_MAX2,b=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var E=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=E,this.sfBandIndex=[new Zt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Zt([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Zt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Zt([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Zt([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Zt([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Zt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Zt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Zt([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var h=Ea(C+L+1),R=Ea(C),w=Ea(k),s=Ea(k);this.adj43=s;function F(c,T){var N=a.ATHformula(T,c);return N-=b,N=Math.pow(10,N/10+c.ATHlower),N}function H(c){for(var T=c.internal_flags.ATH.l,N=c.internal_flags.ATH.psfb21,M=c.internal_flags.ATH.s,O=c.internal_flags.ATH.psfb12,l=c.internal_flags,x=c.out_samplerate,y=0;y<A.SBMAX_l;y++){var m=l.scalefac_band.l[y],f=l.scalefac_band.l[y+1];T[y]=os.MAX_VALUE;for(var p=m;p<f;p++){var u=p*x/1152,v=F(c,u);T[y]=Math.min(T[y],v)}}for(var y=0;y<A.PSFB21;y++){var m=l.scalefac_band.psfb21[y],f=l.scalefac_band.psfb21[y+1];N[y]=os.MAX_VALUE;for(var p=m;p<f;p++){var u=p*x/1152,v=F(c,u);N[y]=Math.min(N[y],v)}}for(var y=0;y<A.SBMAX_s;y++){var m=l.scalefac_band.s[y],f=l.scalefac_band.s[y+1];M[y]=os.MAX_VALUE;for(var p=m;p<f;p++){var u=p*x/384,v=F(c,u);M[y]=Math.min(M[y],v)}M[y]*=l.scalefac_band.s[y+1]-l.scalefac_band.s[y]}for(var y=0;y<A.PSFB12;y++){var m=l.scalefac_band.psfb12[y],f=l.scalefac_band.psfb12[y+1];O[y]=os.MAX_VALUE;for(var p=m;p<f;p++){var u=p*x/384,v=F(c,u);O[y]=Math.min(O[y],v)}O[y]*=l.scalefac_band.s[13]-l.scalefac_band.s[12]}if(c.noATH){for(var y=0;y<A.SBMAX_l;y++)T[y]=1e-20;for(var y=0;y<A.PSFB21;y++)N[y]=1e-20;for(var y=0;y<A.SBMAX_s;y++)M[y]=1e-20;for(var y=0;y<A.PSFB12;y++)O[y]=1e-20}l.ATH.floor=10*Math.log10(F(c,-1))}this.iteration_init=function(c){var T=c.internal_flags,N=T.l3_side,M;if(T.iteration_init_init==0){for(T.iteration_init_init=1,N.main_data_begin=0,H(c),w[0]=0,M=1;M<k;M++)w[M]=Math.pow(M,4/3);for(M=0;M<k-1;M++)s[M]=M+1-Math.pow(.5*(w[M]+w[M+1]),.75);for(s[M]=.5,M=0;M<C;M++)R[M]=Math.pow(2,(M-210)*-.1875);for(M=0;M<=C+L;M++)h[M]=Math.pow(2,(M-210-L)*.25);e.huffman_init(T);{var O,l,x,y;for(M=c.exp_nspsytune>>2&63,M>=32&&(M-=64),O=Math.pow(10,M/4/10),M=c.exp_nspsytune>>8&63,M>=32&&(M-=64),l=Math.pow(10,M/4/10),M=c.exp_nspsytune>>14&63,M>=32&&(M-=64),x=Math.pow(10,M/4/10),M=c.exp_nspsytune>>20&63,M>=32&&(M-=64),y=x*Math.pow(10,M/4/10),M=0;M<A.SBMAX_l;M++){var m;M<=6?m=O:M<=13?m=l:M<=20?m=x:m=y,T.nsPsy.longfact[M]=m}for(M=0;M<A.SBMAX_s;M++){var m;M<=5?m=O:M<=10?m=l:M<=11?m=x:m=y,T.nsPsy.shortfact[M]=m}}}},this.on_pe=function(c,T,N,M,O,l){var x=c.internal_flags,y=0,m,f=Zd(2),p,u=new Qn(y),v=t.ResvMaxBits(c,M,u,l);y=u.bits;var _=y+v;for(_>Ve.MAX_BITS_PER_GRANULE&&(_=Ve.MAX_BITS_PER_GRANULE),m=0,p=0;p<x.channels_out;++p)N[p]=Math.min(Ve.MAX_BITS_PER_CHANNEL,y/x.channels_out),f[p]=0|N[p]*T[O][p]/700-N[p],f[p]>M*3/4&&(f[p]=M*3/4),f[p]<0&&(f[p]=0),f[p]+N[p]>Ve.MAX_BITS_PER_CHANNEL&&(f[p]=Math.max(0,Ve.MAX_BITS_PER_CHANNEL-N[p])),m+=f[p];if(m>v)for(p=0;p<x.channels_out;++p)f[p]=v*f[p]/m;for(p=0;p<x.channels_out;++p)N[p]+=f[p],v-=f[p];for(m=0,p=0;p<x.channels_out;++p)m+=N[p];if(m>Ve.MAX_BITS_PER_GRANULE){var I=0;for(p=0;p<x.channels_out;++p)N[p]*=Ve.MAX_BITS_PER_GRANULE,N[p]/=m,I+=N[p]}return _},this.reduce_side=function(c,T,N,M){vr(c[0]+c[1]<=Ve.MAX_BITS_PER_GRANULE);var O=.33*(.5-T)/.5;O<0&&(O=0),O>.5&&(O=.5);var l=0|O*.5*(c[0]+c[1]);l>Ve.MAX_BITS_PER_CHANNEL-c[0]&&(l=Ve.MAX_BITS_PER_CHANNEL-c[0]),l<0&&(l=0),c[1]>=125&&(c[1]-l>125?(c[0]<N&&(c[0]+=l),c[1]-=l):(c[0]+=c[1]-125,c[1]=125)),l=c[0]+c[1],l>M&&(c[0]=M*c[0]/l,c[1]=M*c[1]/l),vr(c[0]<=Ve.MAX_BITS_PER_CHANNEL),vr(c[1]<=Ve.MAX_BITS_PER_CHANNEL),vr(c[0]+c[1]<=Ve.MAX_BITS_PER_GRANULE)},this.athAdjust=function(c,T,N){var M=90.30873362,O=94.82444863,l=Xs.FAST_LOG10_X(T,10),x=c*c,y=0;return l-=N,x>1e-20&&(y=1+Xs.FAST_LOG10_X(x,10/M)),y<0&&(y=0),l*=y,l+=N+M-O,Math.pow(10,.1*l)},this.calc_xmin=function(c,T,N,M){var O=0,l=c.internal_flags,x,y=0,m=0,f=l.ATH,p=N.xr,u=c.VBR==Sa.vbr_mtrh?1:0,v=l.masking_lower;for((c.VBR==Sa.vbr_mtrh||c.VBR==Sa.vbr_mt)&&(v=1),x=0;x<N.psy_lmax;x++){var _,I,G,D,z,i;c.VBR==Sa.vbr_rh||c.VBR==Sa.vbr_mtrh?I=athAdjust(f.adjust,f.l[x],f.floor):I=f.adjust*f.l[x],z=N.width[x],G=I/z,D=d,i=z>>1,_=0;do{var g,K;g=p[y]*p[y],_+=g,D+=g<G?g:G,y++,K=p[y]*p[y],_+=K,D+=K<G?K:G,y++}while(--i>0);if(_>I&&m++,x==A.SBPSY_l){var W=I*l.nsPsy.longfact[x];D<W&&(D=W)}if(u!=0&&(I=D),!c.ATHonly){var ie=T.en.l[x];if(ie>0){var W;W=_*T.thm.l[x]*v/ie,u!=0&&(W*=l.nsPsy.longfact[x]),I<W&&(I=W)}}u!=0?M[O++]=I:M[O++]=I*l.nsPsy.longfact[x]}var he=575;if(N.block_type!=A.SHORT_TYPE)for(var ue=576;ue--!=0&&Vt.EQ(p[ue],0);)he=ue;N.max_nonzero_coeff=he;for(var de=N.sfb_smin;x<N.psymax;de++,x+=3){var z,Se,ve;for(c.VBR==Sa.vbr_rh||c.VBR==Sa.vbr_mtrh?ve=athAdjust(f.adjust,f.s[de],f.floor):ve=f.adjust*f.s[de],z=N.width[x],Se=0;Se<3;Se++){var _=0,I,G,D,i=z>>1;G=ve/z,D=d;do{var g,K;g=p[y]*p[y],_+=g,D+=g<G?g:G,y++,K=p[y]*p[y],_+=K,D+=K<G?K:G,y++}while(--i>0);if(_>ve&&m++,de==A.SBPSY_s){var W=ve*l.nsPsy.shortfact[de];D<W&&(D=W)}if(u!=0?I=D:I=ve,!c.ATHonly&&!c.ATHshort){var ie=T.en.s[de][Se];if(ie>0){var W;W=_*T.thm.s[de][Se]*v/ie,u!=0&&(W*=l.nsPsy.shortfact[de]),I<W&&(I=W)}}u!=0?M[O++]=I:M[O++]=I*l.nsPsy.shortfact[de]}c.useTemporal&&(M[O-3]>M[O-3+1]&&(M[O-3+1]+=(M[O-3]-M[O-3+1])*l.decay),M[O-3+1]>M[O-3+2]&&(M[O-3+2]+=(M[O-3+1]-M[O-3+2])*l.decay))}return m};function V(c){this.s=c}this.calc_noise_core=function(c,T,N,M){var O=0,l=T.s,x=c.l3_enc;if(l>c.count1)for(;N--!=0;){var y;y=c.xr[l],l++,O+=y*y,y=c.xr[l],l++,O+=y*y}else if(l>c.big_values){var m=Ea(2);for(m[0]=0,m[1]=M;N--!=0;){var y;y=Math.abs(c.xr[l])-m[x[l]],l++,O+=y*y,y=Math.abs(c.xr[l])-m[x[l]],l++,O+=y*y}}else for(;N--!=0;){var y;y=Math.abs(c.xr[l])-w[x[l]]*M,l++,O+=y*y,y=Math.abs(c.xr[l])-w[x[l]]*M,l++,O+=y*y}return T.s=l,O},this.calc_noise=function(c,T,N,M,O){var l=0,x=0,y,m,f=0,p=0,u=0,v=-20,_=0,I=c.scalefac,G=0;for(M.over_SSD=0,y=0;y<c.psymax;y++){var D=c.global_gain-(I[G++]+(c.preflag!=0?E[y]:0)<<c.scalefac_scale+1)-c.subblock_gain[c.window[y]]*8,z=0;if(O!=null&&O.step[y]==D)z=O.noise[y],_+=c.width[y],N[l++]=z/T[x++],z=O.noise_log[y];else{var i=n(D);if(m=c.width[y]>>1,_+c.width[y]>c.max_nonzero_coeff){var g;g=c.max_nonzero_coeff-_+1,g>0?m=g>>1:m=0}var K=new V(_);z=this.calc_noise_core(c,K,m,i),_=K.s,O!=null&&(O.step[y]=D,O.noise[y]=z),z=N[l++]=z/T[x++],z=Xs.FAST_LOG10(Math.max(z,1e-20)),O!=null&&(O.noise_log[y]=z)}if(O!=null&&(O.global_gain=c.global_gain),u+=z,z>0){var W;W=Math.max(0|z*10+.5,1),M.over_SSD+=W*W,f++,p+=z}v=Math.max(v,z)}return M.over_count=f,M.tot_noise=u,M.over_noise=p,M.max_noise=v,f},this.set_pinfo=function(c,T,N,M,O){var l=c.internal_flags,x,y,m,f,p,u=T.scalefac_scale==0?.5:1,v=T.scalefac,_=Ea(L3Side.SFBMAX),I=Ea(L3Side.SFBMAX),G=new CalcNoiseResult;calc_xmin(c,N,T,_),calc_noise(T,_,I,G,null);var D=0;for(y=T.sfb_lmax,T.block_type!=A.SHORT_TYPE&&T.mixed_block_flag==0&&(y=22),x=0;x<y;x++){var z=l.scalefac_band.l[x],i=l.scalefac_band.l[x+1],g=i-z;for(f=0;D<i;D++)f+=T.xr[D]*T.xr[D];f/=g,p=1e15,l.pinfo.en[M][O][x]=p*f,l.pinfo.xfsf[M][O][x]=p*_[x]*I[x]/g,N.en.l[x]>0&&!c.ATHonly?f=f/N.en.l[x]:f=0,l.pinfo.thr[M][O][x]=p*Math.max(f*N.thm.l[x],l.ATH.l[x]),l.pinfo.LAMEsfb[M][O][x]=0,T.preflag!=0&&x>=11&&(l.pinfo.LAMEsfb[M][O][x]=-u*E[x]),x<A.SBPSY_l&&(vr(v[x]>=0),l.pinfo.LAMEsfb[M][O][x]-=u*v[x])}if(T.block_type==A.SHORT_TYPE)for(y=x,x=T.sfb_smin;x<A.SBMAX_s;x++)for(var z=l.scalefac_band.s[x],i=l.scalefac_band.s[x+1],g=i-z,K=0;K<3;K++){for(f=0,m=z;m<i;m++)f+=T.xr[D]*T.xr[D],D++;f=Math.max(f/g,1e-20),p=1e15,l.pinfo.en_s[M][O][3*x+K]=p*f,l.pinfo.xfsf_s[M][O][3*x+K]=p*_[y]*I[y]/g,N.en.s[x][K]>0?f=f/N.en.s[x][K]:f=0,(c.ATHonly||c.ATHshort)&&(f=0),l.pinfo.thr_s[M][O][3*x+K]=p*Math.max(f*N.thm.s[x][K],l.ATH.s[x]),l.pinfo.LAMEsfb_s[M][O][3*x+K]=-2*T.subblock_gain[K],x<A.SBPSY_s&&(l.pinfo.LAMEsfb_s[M][O][3*x+K]-=u*v[y]),y++}l.pinfo.LAMEqss[M][O]=T.global_gain,l.pinfo.LAMEmainbits[M][O]=T.part2_3_length+T.part2_length,l.pinfo.LAMEsfbits[M][O]=T.part2_length,l.pinfo.over[M][O]=G.over_count,l.pinfo.max_noise[M][O]=G.max_noise*10,l.pinfo.over_noise[M][O]=G.over_noise*10,l.pinfo.tot_noise[M][O]=G.tot_noise*10,l.pinfo.over_SSD[M][O]=G.over_SSD}}var Wd=fe.System,Qd=fe.Arrays,gr=fe.new_int,Gs=fe.assert;function br(){var e=null;this.qupvt=null,this.setModules=function(m){this.qupvt=m,e=m};function t(m){this.bits=0|m}var a=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function n(m,f,p,u,v,_){var I=.5946/f;for(m=m>>1;m--!=0;)v[_++]=I>p[u++]?0:1,v[_++]=I>p[u++]?0:1}function d(m,f,p,u,v,_){m=m>>1;var I=m%2;for(m=m>>1;m--!=0;){var G,D,z,i,g,K,W,ie;G=p[u++]*f,D=p[u++]*f,g=0|G,z=p[u++]*f,K=0|D,i=p[u++]*f,W=0|z,G+=e.adj43[g],ie=0|i,D+=e.adj43[K],v[_++]=0|G,z+=e.adj43[W],v[_++]=0|D,i+=e.adj43[ie],v[_++]=0|z,v[_++]=0|i}if(I!=0){var G,D,g,K;G=p[u++]*f,D=p[u++]*f,g=0|G,K=0|D,G+=e.adj43[g],D+=e.adj43[K],v[_++]=0|G,v[_++]=0|D}}function o(m,f,p,u,v){var _,I,G=0,D,z=0,i=0,g=0,K=f,W=0,ie=K,he=0,ue=m,de=0;for(D=v!=null&&u.global_gain==v.global_gain,u.block_type==A.SHORT_TYPE?I=38:I=21,_=0;_<=I;_++){var Se=-1;if((D||u.block_type==A.NORM_TYPE)&&(Se=u.global_gain-(u.scalefac[_]+(u.preflag!=0?e.pretab[_]:0)<<u.scalefac_scale+1)-u.subblock_gain[u.window[_]]*8),Gs(u.width[_]>=0),D&&v.step[_]==Se)z!=0&&(d(z,p,ue,de,ie,he),z=0),i!=0&&(n(i,p,ue,de,ie,he),i=0);else{var ve=u.width[_];if(G+u.width[_]>u.max_nonzero_coeff){var ce;ce=u.max_nonzero_coeff-G+1,Qd.fill(f,u.max_nonzero_coeff,576,0),ve=ce,ve<0&&(ve=0),_=I+1}if(z==0&&i==0&&(ie=K,he=W,ue=m,de=g),v!=null&&v.sfb_count1>0&&_>=v.sfb_count1&&v.step[_]>0&&Se>=v.step[_]?(z!=0&&(d(z,p,ue,de,ie,he),z=0,ie=K,he=W,ue=m,de=g),i+=ve):(i!=0&&(n(i,p,ue,de,ie,he),i=0,ie=K,he=W,ue=m,de=g),z+=ve),ve<=0){i!=0&&(n(i,p,ue,de,ie,he),i=0),z!=0&&(d(z,p,ue,de,ie,he),z=0);break}}_<=I&&(W+=u.width[_],g+=u.width[_],G+=u.width[_])}z!=0&&(d(z,p,ue,de,ie,he),z=0),i!=0&&(n(i,p,ue,de,ie,he),i=0)}function k(m,f,p){var u=0,v=0;do{var _=m[f++],I=m[f++];u<_&&(u=_),v<I&&(v=I)}while(f<p);return u<v&&(u=v),u}function C(m,f,p,u,v,_){var I=ee.ht[u].xlen*65536+ee.ht[v].xlen,G=0,D;do{var z=m[f++],i=m[f++];z!=0&&(z>14&&(z=15,G+=I),z*=16),i!=0&&(i>14&&(i=15,G+=I),z+=i),G+=ee.largetbl[z]}while(f<p);return D=G&65535,G>>=16,G>D&&(G=D,u=v),_.bits+=G,u}function L(m,f,p,u){var v=0,_=ee.ht[1].hlen;do{var I=m[f+0]*2+m[f+1];f+=2,v+=_[I]}while(f<p);return u.bits+=v,1}function b(m,f,p,u,v){var _=0,I,G=ee.ht[u].xlen,D;u==2?D=ee.table23:D=ee.table56;do{var z=m[f+0]*G+m[f+1];f+=2,_+=D[z]}while(f<p);return I=_&65535,_>>=16,_>I&&(_=I,u++),v.bits+=_,u}function E(m,f,p,u,v){var _=0,I=0,G=0,D=ee.ht[u].xlen,z=ee.ht[u].hlen,i=ee.ht[u+1].hlen,g=ee.ht[u+2].hlen;do{var K=m[f+0]*D+m[f+1];f+=2,_+=z[K],I+=i[K],G+=g[K]}while(f<p);var W=u;return _>I&&(_=I,W++),_>G&&(_=G,W=u+2),v.bits+=_,W}var h=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function R(m,f,p,u){var v=k(m,f,p);switch(v){case 0:return v;case 1:return L(m,f,p,u);case 2:case 3:return b(m,f,p,h[v-1],u);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return E(m,f,p,h[v-1],u);default:if(v>_t.IXMAX_VAL)return u.bits=_t.LARGE_BITS,-1;v-=15;var _;for(_=24;_<32&&!(ee.ht[_].linmax>=v);_++);var I;for(I=_-8;I<24&&!(ee.ht[I].linmax>=v);I++);return C(m,f,p,I,_,u)}}this.noquant_count_bits=function(m,f,p){var u=f.l3_enc,v=Math.min(576,f.max_nonzero_coeff+2>>1<<1);for(p!=null&&(p.sfb_count1=0);v>1&&(u[v-1]|u[v-2])==0;v-=2);f.count1=v;for(var _=0,I=0;v>3;v-=4){var G;if(((u[v-1]|u[v-2]|u[v-3]|u[v-4])&2147483647)>1)break;G=((u[v-4]*2+u[v-3])*2+u[v-2])*2+u[v-1],_+=ee.t32l[G],I+=ee.t33l[G]}var D=_;if(f.count1table_select=0,_>I&&(D=I,f.count1table_select=1),f.count1bits=D,f.big_values=v,v==0)return D;if(f.block_type==A.SHORT_TYPE)_=3*m.scalefac_band.s[3],_>f.big_values&&(_=f.big_values),I=f.big_values;else if(f.block_type==A.NORM_TYPE){if(_=f.region0_count=m.bv_scf[v-2],I=f.region1_count=m.bv_scf[v-1],I=m.scalefac_band.l[_+I+2],_=m.scalefac_band.l[_+1],I<v){var z=new t(D);f.table_select[2]=R(u,I,v,z),D=z.bits}}else f.region0_count=7,f.region1_count=A.SBMAX_l-1-7-1,_=m.scalefac_band.l[7+1],I=v,_>I&&(_=I);if(_=Math.min(_,v),I=Math.min(I,v),_>0){var z=new t(D);f.table_select[0]=R(u,0,_,z),D=z.bits}if(_<I){var z=new t(D);f.table_select[1]=R(u,_,I,z),D=z.bits}if(m.use_best_huffman==2&&(f.part2_3_length=D,best_huffman_divide(m,f),D=f.part2_3_length),p!=null&&f.block_type==A.NORM_TYPE){for(var i=0;m.scalefac_band.l[i]<f.big_values;)i++;p.sfb_count1=i}return D},this.count_bits=function(m,f,p,u){var v=p.l3_enc,_=_t.IXMAX_VAL/e.IPOW20(p.global_gain);if(p.xrpow_max>_)return _t.LARGE_BITS;if(o(f,v,e.IPOW20(p.global_gain),p,u),(m.substep_shaping&2)!=0)for(var I=0,G=p.global_gain+p.scalefac_scale,D=.634521682242439/e.IPOW20(G),z=0;z<p.sfbmax;z++){var i=p.width[z];if(m.pseudohalf[z]==0)I+=i;else{var g;for(g=I,I+=i;g<I;++g)v[g]=f[g]>=D?v[g]:0}}return this.noquant_count_bits(m,p,u)};function w(m,f,p,u,v,_,I){for(var G=f.big_values,D=0;D<=7+15;D++)u[D]=_t.LARGE_BITS;for(var D=0;D<16;D++){var z=m.scalefac_band.l[D+1];if(z>=G)break;var i=0,g=new t(i),K=R(p,0,z,g);i=g.bits;for(var W=0;W<8;W++){var ie=m.scalefac_band.l[D+W+2];if(ie>=G)break;var he=i;g=new t(he);var ue=R(p,z,ie,g);he=g.bits,u[D+W]>he&&(u[D+W]=he,v[D+W]=D,_[D+W]=K,I[D+W]=ue)}}}function s(m,f,p,u,v,_,I,G){for(var D=f.big_values,z=2;z<A.SBMAX_l+1;z++){var i=m.scalefac_band.l[z];if(i>=D)break;var g=v[z-2]+f.count1bits;if(p.part2_3_length<=g)break;var K=new t(g),W=R(u,i,D,K);g=K.bits,!(p.part2_3_length<=g)&&(p.assign(f),p.part2_3_length=g,p.region0_count=_[z-2],p.region1_count=z-2-_[z-2],p.table_select[0]=I[z-2],p.table_select[1]=G[z-2],p.table_select[2]=W)}}this.best_huffman_divide=function(m,f){var p=new ts,u=f.l3_enc,v=gr(7+15+1),_=gr(7+15+1),I=gr(7+15+1),G=gr(7+15+1);if(!(f.block_type==A.SHORT_TYPE&&m.mode_gr==1)){p.assign(f),f.block_type==A.NORM_TYPE&&(w(m,f,u,v,_,I,G),s(m,p,f,u,v,_,I,G));var D=p.big_values;if(!(D==0||(u[D-2]|u[D-1])>1)&&(D=f.count1+2,!(D>576))){p.assign(f),p.count1=D;for(var z=0,i=0;D>p.big_values;D-=4){var g=((u[D-4]*2+u[D-3])*2+u[D-2])*2+u[D-1];z+=ee.t32l[g],i+=ee.t33l[g]}if(p.big_values=D,p.count1table_select=0,z>i&&(z=i,p.count1table_select=1),p.count1bits=z,p.block_type==A.NORM_TYPE)s(m,p,f,u,v,_,I,G);else{if(p.part2_3_length=z,z=m.scalefac_band.l[7+1],z>D&&(z=D),z>0){var K=new t(p.part2_3_length);p.table_select[0]=R(u,0,z,K),p.part2_3_length=K.bits}if(D>z){var K=new t(p.part2_3_length);p.table_select[1]=R(u,z,D,K),p.part2_3_length=K.bits}f.part2_3_length>p.part2_3_length&&f.assign(p)}}}};var F=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],H=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],V=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],c=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];br.slen1_tab=V,br.slen2_tab=c;function T(m,f){for(var p,u=f.tt[1][m],v=f.tt[0][m],_=0;_<ee.scfsi_band.length-1;_++){for(p=ee.scfsi_band[_];p<ee.scfsi_band[_+1]&&!(v.scalefac[p]!=u.scalefac[p]&&u.scalefac[p]>=0);p++);if(p==ee.scfsi_band[_+1]){for(p=ee.scfsi_band[_];p<ee.scfsi_band[_+1];p++)u.scalefac[p]=-1;f.scfsi[m][_]=1}}var I=0,G=0;for(p=0;p<11;p++)u.scalefac[p]!=-1&&(G++,I<u.scalefac[p]&&(I=u.scalefac[p]));for(var D=0,z=0;p<A.SBPSY_l;p++)u.scalefac[p]!=-1&&(z++,D<u.scalefac[p]&&(D=u.scalefac[p]));for(var _=0;_<16;_++)if(I<F[_]&&D<H[_]){var i=V[_]*G+c[_]*z;u.part2_length>i&&(u.part2_length=i,u.scalefac_compress=_)}}this.best_scalefac_store=function(m,f,p,u){var v=u.tt[f][p],_,I,G,D,z=0;for(G=0,_=0;_<v.sfbmax;_++){var i=v.width[_];for(G+=i,D=-i;D<0&&v.l3_enc[D+G]==0;D++);D==0&&(v.scalefac[_]=z=-2)}if(v.scalefac_scale==0&&v.preflag==0){var g=0;for(_=0;_<v.sfbmax;_++)v.scalefac[_]>0&&(g|=v.scalefac[_]);if((g&1)==0&&g!=0){for(_=0;_<v.sfbmax;_++)v.scalefac[_]>0&&(v.scalefac[_]>>=1);v.scalefac_scale=z=1}}if(v.preflag==0&&v.block_type!=A.SHORT_TYPE&&m.mode_gr==2){for(_=11;_<A.SBPSY_l&&!(v.scalefac[_]<e.pretab[_]&&v.scalefac[_]!=-2);_++);if(_==A.SBPSY_l){for(_=11;_<A.SBPSY_l;_++)v.scalefac[_]>0&&(v.scalefac[_]-=e.pretab[_]);v.preflag=z=1}}for(I=0;I<4;I++)u.scfsi[p][I]=0;for(m.mode_gr==2&&f==1&&u.tt[0][p].block_type!=A.SHORT_TYPE&&u.tt[1][p].block_type!=A.SHORT_TYPE&&(T(p,u),z=0),_=0;_<v.sfbmax;_++)v.scalefac[_]==-2&&(v.scalefac[_]=0);z!=0&&(m.mode_gr==2?this.scale_bitcount(v):this.scale_bitcount_lsf(m,v))};function N(m,f){for(var p=0;p<f;++p)if(m[p]<0)return!1;return!0}var M=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],O=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],l=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(m){var f,p,u=0,v=0,_,I=m.scalefac;if(Gs(N(I,m.sfbmax)),m.block_type==A.SHORT_TYPE)_=M,m.mixed_block_flag!=0&&(_=O);else if(_=l,m.preflag==0){for(p=11;p<A.SBPSY_l&&!(I[p]<e.pretab[p]);p++);if(p==A.SBPSY_l)for(m.preflag=1,p=11;p<A.SBPSY_l;p++)I[p]-=e.pretab[p]}for(p=0;p<m.sfbdivide;p++)u<I[p]&&(u=I[p]);for(;p<m.sfbmax;p++)v<I[p]&&(v=I[p]);for(m.part2_length=_t.LARGE_BITS,f=0;f<16;f++)u<F[f]&&v<H[f]&&m.part2_length>_[f]&&(m.part2_length=_[f],m.scalefac_compress=f);return m.part2_length==_t.LARGE_BITS};var x=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(m,f){var p,u,v,_,I,G,D,z,i=gr(4),g=f.scalefac;for(f.preflag!=0?p=2:p=0,D=0;D<4;D++)i[D]=0;if(f.block_type==A.SHORT_TYPE){u=1;var K=e.nr_of_sfb_block[p][u];for(z=0,v=0;v<4;v++)for(_=K[v]/3,D=0;D<_;D++,z++)for(I=0;I<3;I++)g[z*3+I]>i[v]&&(i[v]=g[z*3+I])}else{u=0;var K=e.nr_of_sfb_block[p][u];for(z=0,v=0;v<4;v++)for(_=K[v],D=0;D<_;D++,z++)g[z]>i[v]&&(i[v]=g[z])}for(G=!1,v=0;v<4;v++)i[v]>x[p][v]&&(G=!0);if(!G){var W,ie,he,ue;for(f.sfb_partition_table=e.nr_of_sfb_block[p][u],v=0;v<4;v++)f.slen[v]=y[i[v]];switch(W=f.slen[0],ie=f.slen[1],he=f.slen[2],ue=f.slen[3],p){case 0:f.scalefac_compress=(W*5+ie<<4)+(he<<2)+ue;break;case 1:f.scalefac_compress=400+(W*5+ie<<2)+he;break;case 2:f.scalefac_compress=500+W*3+ie;break;default:Wd.err.printf(`intensity stereo not implemented yet
`);break}}if(!G)for(Gs(f.sfb_partition_table!=null),f.part2_length=0,v=0;v<4;v++)f.part2_length+=f.slen[v]*f.sfb_partition_table[v];return G};var y=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(m){for(var f=2;f<=576;f+=2){for(var p=0,u;m.scalefac_band.l[++p]<f;);for(u=a[p][0];m.scalefac_band.l[u+1]>f;)u--;for(u<0&&(u=a[p][0]),m.bv_scf[f-2]=u,u=a[p][1];m.scalefac_band.l[u+m.bv_scf[f-2]+2]>f;)u--;u<0&&(u=a[p][1]),m.bv_scf[f-1]=u}}}var Wt=fe.System,Jd=fe.Arrays,$d=fe.new_byte,em=fe.new_float_n,tm=fe.new_int,nt=fe.assert;Vt.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=Math.abs(e)*1e-6:Math.abs(e-t)<=Math.abs(t)*1e-6},Vt.NEQ=function(e,t){return!Vt.EQ(e,t)};function Vt(){var e=this,t=32773,a=null,n=null,d=null,o=null;this.setModules=function(x,y,m,f){a=x,n=y,d=m,o=f};var k=null,C=0,L=0,b=0;this.getframebits=function(x){var y=x.internal_flags,m;y.bitrate_index!=0?m=ee.bitrate_table[x.version][y.bitrate_index]:m=x.brate;var f=0|(x.version+1)*72e3*m/x.out_samplerate+y.padding;return 8*f};function E(x){Wt.arraycopy(x.header[x.w_ptr].buf,0,k,L,x.sideinfo_len),L+=x.sideinfo_len,C+=x.sideinfo_len*8,x.w_ptr=x.w_ptr+1&Ve.MAX_HEADER_BUF-1}function h(x,y,m){for(;m>0;){var f;b==0&&(b=8,L++,nt(x.header[x.w_ptr].write_timing>=C),x.header[x.w_ptr].write_timing==C&&E(x),k[L]=0),f=Math.min(m,b),m-=f,b-=f,k[L]|=y>>m<<b,C+=f}}function R(x,y,m){for(;m>0;){var f;b==0&&(b=8,L++,k[L]=0),f=Math.min(m,b),m-=f,b-=f,k[L]|=y>>m<<b,C+=f}}function w(x,y){var m=x.internal_flags,f;if(y>=8&&(h(m,76,8),y-=8),y>=8&&(h(m,65,8),y-=8),y>=8&&(h(m,77,8),y-=8),y>=8&&(h(m,69,8),y-=8),y>=32){var p=d.getLameShortVersion();if(y>=32)for(f=0;f<p.length&&y>=8;++f)y-=8,h(m,p.charAt(f),8)}for(;y>=1;y-=1)h(m,m.ancillary_flag,1),m.ancillary_flag^=x.disable_reservoir?0:1}function s(x,y,m){for(var f=x.header[x.h_ptr].ptr;m>0;){var p=Math.min(m,8-(f&7));m-=p,x.header[x.h_ptr].buf[f>>3]|=y>>m<<8-(f&7)-p,f+=p}x.header[x.h_ptr].ptr=f}function F(x,y){x<<=8;for(var m=0;m<8;m++)x<<=1,y<<=1,((y^x)&65536)!=0&&(y^=t);return y}this.CRC_writeheader=function(x,y){var m=65535;m=F(y[2]&255,m),m=F(y[3]&255,m);for(var f=6;f<x.sideinfo_len;f++)m=F(y[f]&255,m);y[4]=byte(m>>8),y[5]=byte(m&255)};function H(x,y){var m=x.internal_flags,f,p,u;if(f=m.l3_side,m.header[m.h_ptr].ptr=0,Jd.fill(m.header[m.h_ptr].buf,0,m.sideinfo_len,0),x.out_samplerate<16e3?s(m,4094,12):s(m,4095,12),s(m,x.version,1),s(m,4-3,2),s(m,x.error_protection?0:1,1),s(m,m.bitrate_index,4),s(m,m.samplerate_index,2),s(m,m.padding,1),s(m,x.extension,1),s(m,x.mode.ordinal(),2),s(m,m.mode_ext,2),s(m,x.copyright,1),s(m,x.original,1),s(m,x.emphasis,2),x.error_protection&&s(m,0,16),x.version==1){for(nt(f.main_data_begin>=0),s(m,f.main_data_begin,9),m.channels_out==2?s(m,f.private_bits,3):s(m,f.private_bits,5),u=0;u<m.channels_out;u++){var v;for(v=0;v<4;v++)s(m,f.scfsi[u][v],1)}for(p=0;p<2;p++)for(u=0;u<m.channels_out;u++){var _=f.tt[p][u];s(m,_.part2_3_length+_.part2_length,12),s(m,_.big_values/2,9),s(m,_.global_gain,8),s(m,_.scalefac_compress,4),_.block_type!=A.NORM_TYPE?(s(m,1,1),s(m,_.block_type,2),s(m,_.mixed_block_flag,1),_.table_select[0]==14&&(_.table_select[0]=16),s(m,_.table_select[0],5),_.table_select[1]==14&&(_.table_select[1]=16),s(m,_.table_select[1],5),s(m,_.subblock_gain[0],3),s(m,_.subblock_gain[1],3),s(m,_.subblock_gain[2],3)):(s(m,0,1),_.table_select[0]==14&&(_.table_select[0]=16),s(m,_.table_select[0],5),_.table_select[1]==14&&(_.table_select[1]=16),s(m,_.table_select[1],5),_.table_select[2]==14&&(_.table_select[2]=16),s(m,_.table_select[2],5),nt(_.region0_count>=0&&_.region0_count<16),nt(_.region1_count>=0&&_.region1_count<8),s(m,_.region0_count,4),s(m,_.region1_count,3)),s(m,_.preflag,1),s(m,_.scalefac_scale,1),s(m,_.count1table_select,1)}}else for(nt(f.main_data_begin>=0),s(m,f.main_data_begin,8),s(m,f.private_bits,m.channels_out),p=0,u=0;u<m.channels_out;u++){var _=f.tt[p][u];s(m,_.part2_3_length+_.part2_length,12),s(m,_.big_values/2,9),s(m,_.global_gain,8),s(m,_.scalefac_compress,9),_.block_type!=A.NORM_TYPE?(s(m,1,1),s(m,_.block_type,2),s(m,_.mixed_block_flag,1),_.table_select[0]==14&&(_.table_select[0]=16),s(m,_.table_select[0],5),_.table_select[1]==14&&(_.table_select[1]=16),s(m,_.table_select[1],5),s(m,_.subblock_gain[0],3),s(m,_.subblock_gain[1],3),s(m,_.subblock_gain[2],3)):(s(m,0,1),_.table_select[0]==14&&(_.table_select[0]=16),s(m,_.table_select[0],5),_.table_select[1]==14&&(_.table_select[1]=16),s(m,_.table_select[1],5),_.table_select[2]==14&&(_.table_select[2]=16),s(m,_.table_select[2],5),nt(_.region0_count>=0&&_.region0_count<16),nt(_.region1_count>=0&&_.region1_count<8),s(m,_.region0_count,4),s(m,_.region1_count,3)),s(m,_.scalefac_scale,1),s(m,_.count1table_select,1)}x.error_protection&&CRC_writeheader(m,m.header[m.h_ptr].buf);{var I=m.h_ptr;nt(m.header[I].ptr==m.sideinfo_len*8),m.h_ptr=I+1&Ve.MAX_HEADER_BUF-1,m.header[m.h_ptr].write_timing=m.header[I].write_timing+y,m.h_ptr==m.w_ptr&&Wt.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function V(x,y){var m=ee.ht[y.count1table_select+32],f,p=0,u=y.big_values,v=y.big_values;for(nt(y.count1table_select<2),f=(y.count1-y.big_values)/4;f>0;--f){var _=0,I=0,G;G=y.l3_enc[u+0],G!=0&&(I+=8,y.xr[v+0]<0&&_++),G=y.l3_enc[u+1],G!=0&&(I+=4,_*=2,y.xr[v+1]<0&&_++),G=y.l3_enc[u+2],G!=0&&(I+=2,_*=2,y.xr[v+2]<0&&_++),G=y.l3_enc[u+3],G!=0&&(I++,_*=2,y.xr[v+3]<0&&_++),u+=4,v+=4,h(x,_+m.table[I],m.hlen[I]),p+=m.hlen[I]}return p}function c(x,y,m,f,p){var u=ee.ht[y],v=0;if(y==0)return v;for(var _=m;_<f;_+=2){var I=0,G=0,D=u.xlen,z=u.xlen,i=0,g=p.l3_enc[_],K=p.l3_enc[_+1];if(g!=0&&(p.xr[_]<0&&i++,I--),y>15){if(g>14){var W=g-15;nt(W<=u.linmax),i|=W<<1,G=D,g=15}if(K>14){var ie=K-15;nt(ie<=u.linmax),i<<=D,i|=ie,G+=D,K=15}z=16}K!=0&&(i<<=1,p.xr[_+1]<0&&i++,I--),g=g*z+K,G-=I,I+=u.hlen[g],h(x,u.table[g],I),h(x,i,G),v+=I+G}return v}function T(x,y){var m=3*x.scalefac_band.s[3];m>y.big_values&&(m=y.big_values);var f=c(x,y.table_select[0],0,m,y);return f+=c(x,y.table_select[1],m,y.big_values,y),f}function N(x,y){var m,f,p,u;m=y.big_values;var v=y.region0_count+1;return nt(v<x.scalefac_band.l.length),p=x.scalefac_band.l[v],v+=y.region1_count+1,nt(v<x.scalefac_band.l.length),u=x.scalefac_band.l[v],p>m&&(p=m),u>m&&(u=m),f=c(x,y.table_select[0],0,p,y),f+=c(x,y.table_select[1],p,u,y),f+=c(x,y.table_select[2],u,m,y),f}function M(x){var y,m,f,p,u=0,v=x.internal_flags,_=v.l3_side;if(x.version==1)for(y=0;y<2;y++)for(m=0;m<v.channels_out;m++){var I=_.tt[y][m],G=br.slen1_tab[I.scalefac_compress],D=br.slen2_tab[I.scalefac_compress];for(p=0,f=0;f<I.sfbdivide;f++)I.scalefac[f]!=-1&&(h(v,I.scalefac[f],G),p+=G);for(;f<I.sfbmax;f++)I.scalefac[f]!=-1&&(h(v,I.scalefac[f],D),p+=D);nt(p==I.part2_length),I.block_type==A.SHORT_TYPE?p+=T(v,I):p+=N(v,I),p+=V(v,I),nt(p==I.part2_3_length+I.part2_length),u+=p}else for(y=0,m=0;m<v.channels_out;m++){var I=_.tt[y][m],z,i,g=0;if(nt(I.sfb_partition_table!=null),p=0,f=0,i=0,I.block_type==A.SHORT_TYPE){for(;i<4;i++){var K=I.sfb_partition_table[i]/3,W=I.slen[i];for(z=0;z<K;z++,f++)h(v,Math.max(I.scalefac[f*3+0],0),W),h(v,Math.max(I.scalefac[f*3+1],0),W),h(v,Math.max(I.scalefac[f*3+2],0),W),g+=3*W}p+=T(v,I)}else{for(;i<4;i++){var K=I.sfb_partition_table[i],W=I.slen[i];for(z=0;z<K;z++,f++)h(v,Math.max(I.scalefac[f],0),W),g+=W}p+=N(v,I)}p+=V(v,I),nt(p==I.part2_3_length),nt(g==I.part2_length),u+=g+p}return u}function O(){this.total=0}function l(x,y){var m=x.internal_flags,f,p,u,v,_;return _=m.w_ptr,v=m.h_ptr-1,v==-1&&(v=Ve.MAX_HEADER_BUF-1),f=m.header[v].write_timing-C,y.total=f,f>=0&&(p=1+v-_,v<_&&(p=1+v-_+Ve.MAX_HEADER_BUF),f-=p*8*m.sideinfo_len),u=e.getframebits(x),f+=u,y.total+=u,y.total%8!=0?y.total=1+y.total/8:y.total=y.total/8,y.total+=L+1,f<0&&Wt.err.println(`strange error flushing buffer ... 
`),f}this.flush_bitstream=function(x){var y=x.internal_flags,m,f,p=y.h_ptr-1;if(p==-1&&(p=Ve.MAX_HEADER_BUF-1),m=y.l3_side,!((f=l(x,new O))<0)){if(w(x,f),nt(y.header[p].write_timing+this.getframebits(x)==C),y.ResvSize=0,m.main_data_begin=0,y.findReplayGain){var u=a.GetTitleGain(y.rgdata);nt(NEQ(u,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),y.RadioGain=Math.floor(u*10+.5)|0}y.findPeakSample&&(y.noclipGainChange=Math.ceil(Math.log10(y.PeakSample/32767)*20*10)|0,y.noclipGainChange>0&&(EQ(x.scale,1)||EQ(x.scale,0))?y.noclipScale=Math.floor(32767/y.PeakSample*100)/100:y.noclipScale=-1)}},this.add_dummy_byte=function(x,y,m){for(var f=x.internal_flags,p;m-- >0;)for(R(f,y,8),p=0;p<Ve.MAX_HEADER_BUF;++p)f.header[p].write_timing+=8},this.format_bitstream=function(x){var y=x.internal_flags,m;m=y.l3_side;var f=this.getframebits(x);w(x,m.resvDrain_pre),H(x,f);var p=8*y.sideinfo_len;if(p+=M(x),w(x,m.resvDrain_post),p+=m.resvDrain_post,m.main_data_begin+=(f-p)/8,l(x,new O)!=y.ResvSize&&Wt.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),m.main_data_begin*8!=y.ResvSize&&(Wt.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*m.main_data_begin,y.ResvSize,m.resvDrain_post,m.resvDrain_pre,8*y.sideinfo_len,p-m.resvDrain_post-8*y.sideinfo_len,p,p%8,f),Wt.err.println("This is a fatal error.  It has several possible causes:"),Wt.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),Wt.err.println(" 9%%  Your system is overclocked"),Wt.err.println(" 1%%  bug in LAME encoding library"),y.ResvSize=m.main_data_begin*8),C>1e9){var u;for(u=0;u<Ve.MAX_HEADER_BUF;++u)y.header[u].write_timing-=C;C=0}return 0},this.copy_buffer=function(x,y,m,f,p){var u=L+1;if(u<=0)return 0;if(f!=0&&u>f)return-1;if(Wt.arraycopy(k,0,y,m,u),L=-1,b=0,p!=0){var v=tm(1);if(v[0]=x.nMusicCRC,o.updateMusicCRC(v,y,m,u),x.nMusicCRC=v[0],u>0&&(x.VBR_seek_table.nBytesWritten+=u),x.decode_on_the_fly){for(var _=em([2,1152]),I=u,G=-1,D;G!=0;)if(G=n.hip_decode1_unclipped(x.hip,y,m,I,_[0],_[1]),I=0,G==-1&&(G=0),G>0){if(x.findPeakSample){for(D=0;D<G;D++)_[0][D]>x.PeakSample?x.PeakSample=_[0][D]:-_[0][D]>x.PeakSample&&(x.PeakSample=-_[0][D]);if(x.channels_out>1)for(D=0;D<G;D++)_[1][D]>x.PeakSample?x.PeakSample=_[1][D]:-_[1][D]>x.PeakSample&&(x.PeakSample=-_[1][D])}if(x.findReplayGain&&a.AnalyzeSamples(x.rgdata,_[0],0,_[1],0,G,x.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return u},this.init_bit_stream_w=function(x){k=$d(Te.LAME_MAXMP3BUFFER),x.h_ptr=x.w_ptr=0,x.header[x.h_ptr].write_timing=0,L=-1,b=0,C=0}}var am=fe.System,Ke=fe.VbrMode,Ks=fe.ShortBlock,Ma=fe.new_float,ei=fe.new_int_n,rm=fe.new_short_n,ca=fe.assert;function Te(){var e=this,t=128*1024;Te.V9=410,Te.V8=420,Te.V7=430,Te.V6=440,Te.V5=450,Te.V4=460,Te.V3=470,Te.V2=480,Te.V1=490,Te.V0=500,Te.R3MIX=1e3,Te.STANDARD=1001,Te.EXTREME=1002,Te.INSANE=1003,Te.STANDARD_FAST=1004,Te.EXTREME_FAST=1005,Te.MEDIUM=1006,Te.MEDIUM_FAST=1007;var a=16384+t;Te.LAME_MAXMP3BUFFER=a;var n,d,o,k,C,L=new qs,b,E,h;this.enc=new A,this.setModules=function(i,g,K,W,ie,he,ue,de,Se){n=i,d=g,o=K,k=W,C=ie,b=he,E=de,h=Se,this.enc.setModules(d,L,k,b)};function R(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=Ma(A.SBMAX_l),this.bo_s_weight=Ma(A.SBMAX_s)}function w(){this.lowerlimit=0}function s(i,g){this.lowpass=g}var F=4294479419;function H(i){var g;return i.class_id=F,g=i.internal_flags=new Ve,i.mode=De.NOT_SET,i.original=1,i.in_samplerate=44100,i.num_channels=2,i.num_samples=-1,i.bWriteVbrTag=!0,i.quality=-1,i.short_blocks=null,g.subblock_gain=-1,i.lowpassfreq=0,i.highpassfreq=0,i.lowpasswidth=-1,i.highpasswidth=-1,i.VBR=Ke.vbr_off,i.VBR_q=4,i.ATHcurve=-1,i.VBR_mean_bitrate_kbps=128,i.VBR_min_bitrate_kbps=0,i.VBR_max_bitrate_kbps=0,i.VBR_hard_min=0,g.VBR_min_bitrate=1,g.VBR_max_bitrate=13,i.quant_comp=-1,i.quant_comp_short=-1,i.msfix=-1,g.resample_ratio=1,g.OldValue[0]=180,g.OldValue[1]=180,g.CurrentStep[0]=4,g.CurrentStep[1]=4,g.masking_lower=1,g.nsPsy.attackthre=-1,g.nsPsy.attackthre_s=-1,i.scale=-1,i.athaa_type=-1,i.ATHtype=-1,i.athaa_loudapprox=-1,i.athaa_sensitivity=0,i.useTemporal=null,i.interChRatio=-1,g.mf_samples_to_encode=A.ENCDELAY+A.POSTDELAY,i.encoder_padding=0,g.mf_size=A.ENCDELAY-A.MDCTDELAY,i.findReplayGain=!1,i.decode_on_the_fly=!1,g.decode_on_the_fly=!1,g.findReplayGain=!1,g.findPeakSample=!1,g.RadioGain=0,g.AudiophileGain=0,g.noclipGainChange=0,g.noclipScale=-1,i.preset=0,i.write_id3tag_automatic=!0,0}this.lame_init=function(){var i=new jd;return H(i),i.lame_allocated_gfp=1,i};function V(i){return i>1?0:i<=0?1:Math.cos(Math.PI/2*i)}this.nearestBitrateFullIndex=function(i){var g=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],K=0,W=0,ie=0,he=0;he=g[16],ie=16,W=g[16],K=16;for(var ue=0;ue<16;ue++)if(Math.max(i,g[ue+1])!=i){he=g[ue+1],ie=ue+1,W=g[ue],K=ue;break}return he-i>i-W?K:ie};function c(i,g){var K=44100;return g>=48e3?K=48e3:g>=44100?K=44100:g>=32e3?K=32e3:g>=24e3?K=24e3:g>=22050?K=22050:g>=16e3?K=16e3:g>=12e3?K=12e3:g>=11025?K=11025:g>=8e3&&(K=8e3),i==-1?K:(i<=15960&&(K=44100),i<=15250&&(K=32e3),i<=11220&&(K=24e3),i<=9970&&(K=22050),i<=7230&&(K=16e3),i<=5420&&(K=12e3),i<=4510&&(K=11025),i<=3970&&(K=8e3),g<K?g>44100?48e3:g>32e3?44100:g>24e3?32e3:g>22050?24e3:g>16e3?22050:g>12e3?16e3:g>11025?12e3:g>8e3?11025:8e3:K)}function T(i,g){switch(i){case 44100:return g.version=1,0;case 48e3:return g.version=1,1;case 32e3:return g.version=1,2;case 22050:return g.version=0,0;case 24e3:return g.version=0,1;case 16e3:return g.version=0,2;case 11025:return g.version=0,0;case 12e3:return g.version=0,1;case 8e3:return g.version=0,2;default:return g.version=0,-1}}function N(i,g,K){K<16e3&&(g=2);for(var W=ee.bitrate_table[g][1],ie=2;ie<=14;ie++)ee.bitrate_table[g][ie]>0&&Math.abs(ee.bitrate_table[g][ie]-i)<Math.abs(W-i)&&(W=ee.bitrate_table[g][ie]);return W}function M(i,g,K){K<16e3&&(g=2);for(var W=0;W<=14;W++)if(ee.bitrate_table[g][W]>0&&ee.bitrate_table[g][W]==i)return W;return-1}function O(i,g){var K=[new s(8,2e3),new s(16,3700),new s(24,3900),new s(32,5500),new s(40,7e3),new s(48,7500),new s(56,1e4),new s(64,11e3),new s(80,13500),new s(96,15100),new s(112,15600),new s(128,17e3),new s(160,17500),new s(192,18600),new s(224,19400),new s(256,19700),new s(320,20500)],W=e.nearestBitrateFullIndex(g);i.lowerlimit=K[W].lowpass}function l(i){var g=i.internal_flags,K=32,W=-1;if(g.lowpass1>0){for(var ie=999,he=0;he<=31;he++){var ue=he/31;ue>=g.lowpass2&&(K=Math.min(K,he)),g.lowpass1<ue&&ue<g.lowpass2&&(ie=Math.min(ie,he))}ie==999?g.lowpass1=(K-.75)/31:g.lowpass1=(ie-.75)/31,g.lowpass2=K/31}if(g.highpass2>0&&g.highpass2<.9*(.75/31)&&(g.highpass1=0,g.highpass2=0,am.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),g.highpass2>0){for(var de=-1,he=0;he<=31;he++){var ue=he/31;ue<=g.highpass1&&(W=Math.max(W,he)),g.highpass1<ue&&ue<g.highpass2&&(de=Math.max(de,he))}g.highpass1=W/31,de==-1?g.highpass2=(W+.75)/31:g.highpass2=(de+.75)/31}for(var he=0;he<32;he++){var Se,ve,ue=he/31;g.highpass2>g.highpass1?Se=V((g.highpass2-ue)/(g.highpass2-g.highpass1+1e-20)):Se=1,g.lowpass2>g.lowpass1?ve=V((ue-g.lowpass1)/(g.lowpass2-g.lowpass1+1e-20)):ve=1,g.amp_filter[he]=Se*ve}}function x(i){var g=i.internal_flags;switch(i.quality){default:case 9:g.psymodel=0,g.noise_shaping=0,g.noise_shaping_amp=0,g.noise_shaping_stop=0,g.use_best_huffman=0,g.full_outer_loop=0;break;case 8:i.quality=7;case 7:g.psymodel=1,g.noise_shaping=0,g.noise_shaping_amp=0,g.noise_shaping_stop=0,g.use_best_huffman=0,g.full_outer_loop=0;break;case 6:g.psymodel=1,g.noise_shaping==0&&(g.noise_shaping=1),g.noise_shaping_amp=0,g.noise_shaping_stop=0,g.subblock_gain==-1&&(g.subblock_gain=1),g.use_best_huffman=0,g.full_outer_loop=0;break;case 5:g.psymodel=1,g.noise_shaping==0&&(g.noise_shaping=1),g.noise_shaping_amp=0,g.noise_shaping_stop=0,g.subblock_gain==-1&&(g.subblock_gain=1),g.use_best_huffman=0,g.full_outer_loop=0;break;case 4:g.psymodel=1,g.noise_shaping==0&&(g.noise_shaping=1),g.noise_shaping_amp=0,g.noise_shaping_stop=0,g.subblock_gain==-1&&(g.subblock_gain=1),g.use_best_huffman=1,g.full_outer_loop=0;break;case 3:g.psymodel=1,g.noise_shaping==0&&(g.noise_shaping=1),g.noise_shaping_amp=1,g.noise_shaping_stop=1,g.subblock_gain==-1&&(g.subblock_gain=1),g.use_best_huffman=1,g.full_outer_loop=0;break;case 2:g.psymodel=1,g.noise_shaping==0&&(g.noise_shaping=1),g.substep_shaping==0&&(g.substep_shaping=2),g.noise_shaping_amp=1,g.noise_shaping_stop=1,g.subblock_gain==-1&&(g.subblock_gain=1),g.use_best_huffman=1,g.full_outer_loop=0;break;case 1:g.psymodel=1,g.noise_shaping==0&&(g.noise_shaping=1),g.substep_shaping==0&&(g.substep_shaping=2),g.noise_shaping_amp=2,g.noise_shaping_stop=1,g.subblock_gain==-1&&(g.subblock_gain=1),g.use_best_huffman=1,g.full_outer_loop=0;break;case 0:g.psymodel=1,g.noise_shaping==0&&(g.noise_shaping=1),g.substep_shaping==0&&(g.substep_shaping=2),g.noise_shaping_amp=2,g.noise_shaping_stop=1,g.subblock_gain==-1&&(g.subblock_gain=1),g.use_best_huffman=1,g.full_outer_loop=0;break}}function y(i){var g=i.internal_flags;i.frameNum=0,i.write_id3tag_automatic&&E.id3tag_write_v2(i),g.bitrate_stereoMode_Hist=ei([16,4+1]),g.bitrate_blockType_Hist=ei([16,4+1+1]),g.PeakSample=0,i.bWriteVbrTag&&b.InitVbrTag(i)}this.lame_init_params=function(i){var g=i.internal_flags;if(g.Class_ID=0,g.ATH==null&&(g.ATH=new Yd),g.PSY==null&&(g.PSY=new R),g.rgdata==null&&(g.rgdata=new Xd),g.channels_in=i.num_channels,g.channels_in==1&&(i.mode=De.MONO),g.channels_out=i.mode==De.MONO?1:2,g.mode_ext=A.MPG_MD_MS_LR,i.mode==De.MONO&&(i.force_ms=!1),i.VBR==Ke.vbr_off&&i.VBR_mean_bitrate_kbps!=128&&i.brate==0&&(i.brate=i.VBR_mean_bitrate_kbps),i.VBR==Ke.vbr_off||i.VBR==Ke.vbr_mtrh||i.VBR==Ke.vbr_mt||(i.free_format=!1),i.VBR==Ke.vbr_off&&i.brate==0&&Vt.EQ(i.compression_ratio,0)&&(i.compression_ratio=11.025),i.VBR==Ke.vbr_off&&i.compression_ratio>0&&(i.out_samplerate==0&&(i.out_samplerate=map2MP3Frequency(int(.97*i.in_samplerate))),i.brate=0|i.out_samplerate*16*g.channels_out/(1e3*i.compression_ratio),g.samplerate_index=T(i.out_samplerate,i),i.free_format||(i.brate=N(i.brate,i.version,i.out_samplerate))),i.out_samplerate!=0&&(i.out_samplerate<16e3?(i.VBR_mean_bitrate_kbps=Math.max(i.VBR_mean_bitrate_kbps,8),i.VBR_mean_bitrate_kbps=Math.min(i.VBR_mean_bitrate_kbps,64)):i.out_samplerate<32e3?(i.VBR_mean_bitrate_kbps=Math.max(i.VBR_mean_bitrate_kbps,8),i.VBR_mean_bitrate_kbps=Math.min(i.VBR_mean_bitrate_kbps,160)):(i.VBR_mean_bitrate_kbps=Math.max(i.VBR_mean_bitrate_kbps,32),i.VBR_mean_bitrate_kbps=Math.min(i.VBR_mean_bitrate_kbps,320))),i.lowpassfreq==0){var K=16e3;switch(i.VBR){case Ke.vbr_off:{var W=new w;O(W,i.brate),K=W.lowerlimit;break}case Ke.vbr_abr:{var W=new w;O(W,i.VBR_mean_bitrate_kbps),K=W.lowerlimit;break}case Ke.vbr_rh:{var ie=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(i.VBR_q>=0&&i.VBR_q<=9){var he=ie[i.VBR_q],ue=ie[i.VBR_q+1],de=i.VBR_q_frac;K=linear_int(he,ue,de)}else K=19500;break}default:{var ie=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(i.VBR_q>=0&&i.VBR_q<=9){var he=ie[i.VBR_q],ue=ie[i.VBR_q+1],de=i.VBR_q_frac;K=linear_int(he,ue,de)}else K=19500}}i.mode==De.MONO&&(i.VBR==Ke.vbr_off||i.VBR==Ke.vbr_abr)&&(K*=1.5),i.lowpassfreq=K|0}if(i.out_samplerate==0&&(2*i.lowpassfreq>i.in_samplerate&&(i.lowpassfreq=i.in_samplerate/2),i.out_samplerate=c(i.lowpassfreq|0,i.in_samplerate)),i.lowpassfreq=Math.min(20500,i.lowpassfreq),i.lowpassfreq=Math.min(i.out_samplerate/2,i.lowpassfreq),i.VBR==Ke.vbr_off&&(i.compression_ratio=i.out_samplerate*16*g.channels_out/(1e3*i.brate)),i.VBR==Ke.vbr_abr&&(i.compression_ratio=i.out_samplerate*16*g.channels_out/(1e3*i.VBR_mean_bitrate_kbps)),i.bWriteVbrTag||(i.findReplayGain=!1,i.decode_on_the_fly=!1,g.findPeakSample=!1),g.findReplayGain=i.findReplayGain,g.decode_on_the_fly=i.decode_on_the_fly,g.decode_on_the_fly&&(g.findPeakSample=!0),g.findReplayGain&&n.InitGainAnalysis(g.rgdata,i.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return i.internal_flags=null,-6;switch(g.decode_on_the_fly&&!i.decode_only&&(g.hip!=null&&h.hip_decode_exit(g.hip),g.hip=h.hip_decode_init()),g.mode_gr=i.out_samplerate<=24e3?1:2,i.framesize=576*g.mode_gr,i.encoder_delay=A.ENCDELAY,g.resample_ratio=i.in_samplerate/i.out_samplerate,i.VBR){case Ke.vbr_mt:case Ke.vbr_rh:case Ke.vbr_mtrh:{var Se=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];i.compression_ratio=Se[i.VBR_q]}break;case Ke.vbr_abr:i.compression_ratio=i.out_samplerate*16*g.channels_out/(1e3*i.VBR_mean_bitrate_kbps);break;default:i.compression_ratio=i.out_samplerate*16*g.channels_out/(1e3*i.brate);break}if(i.mode==De.NOT_SET&&(i.mode=De.JOINT_STEREO),i.highpassfreq>0?(g.highpass1=2*i.highpassfreq,i.highpasswidth>=0?g.highpass2=2*(i.highpassfreq+i.highpasswidth):g.highpass2=(1+0)*2*i.highpassfreq,g.highpass1/=i.out_samplerate,g.highpass2/=i.out_samplerate):(g.highpass1=0,g.highpass2=0),i.lowpassfreq>0?(g.lowpass2=2*i.lowpassfreq,i.lowpasswidth>=0?(g.lowpass1=2*(i.lowpassfreq-i.lowpasswidth),g.lowpass1<0&&(g.lowpass1=0)):g.lowpass1=(1-0)*2*i.lowpassfreq,g.lowpass1/=i.out_samplerate,g.lowpass2/=i.out_samplerate):(g.lowpass1=0,g.lowpass2=0),l(i),g.samplerate_index=T(i.out_samplerate,i),g.samplerate_index<0)return i.internal_flags=null,-1;if(i.VBR==Ke.vbr_off){if(i.free_format)g.bitrate_index=0;else if(i.brate=N(i.brate,i.version,i.out_samplerate),g.bitrate_index=M(i.brate,i.version,i.out_samplerate),g.bitrate_index<=0)return i.internal_flags=null,-1}else g.bitrate_index=1;i.analysis&&(i.bWriteVbrTag=!1),g.pinfo!=null&&(i.bWriteVbrTag=!1),d.init_bit_stream_w(g);for(var ve=g.samplerate_index+3*i.version+6*(i.out_samplerate<16e3?1:0),ce=0;ce<A.SBMAX_l+1;ce++)g.scalefac_band.l[ce]=k.sfBandIndex[ve].l[ce];for(var ce=0;ce<A.PSFB21+1;ce++){var Re=(g.scalefac_band.l[22]-g.scalefac_band.l[21])/A.PSFB21,He=g.scalefac_band.l[21]+ce*Re;g.scalefac_band.psfb21[ce]=He}g.scalefac_band.psfb21[A.PSFB21]=576;for(var ce=0;ce<A.SBMAX_s+1;ce++)g.scalefac_band.s[ce]=k.sfBandIndex[ve].s[ce];for(var ce=0;ce<A.PSFB12+1;ce++){var Re=(g.scalefac_band.s[13]-g.scalefac_band.s[12])/A.PSFB12,He=g.scalefac_band.s[12]+ce*Re;g.scalefac_band.psfb12[ce]=He}g.scalefac_band.psfb12[A.PSFB12]=192,i.version==1?g.sideinfo_len=g.channels_out==1?4+17:4+32:g.sideinfo_len=g.channels_out==1?4+9:4+17,i.error_protection&&(g.sideinfo_len+=2),y(i),g.Class_ID=F;{var Oe;for(Oe=0;Oe<19;Oe++)g.nsPsy.pefirbuf[Oe]=700*g.mode_gr*g.channels_out;i.ATHtype==-1&&(i.ATHtype=4)}switch(ca(i.VBR_q<=9),ca(i.VBR_q>=0),i.VBR){case Ke.vbr_mt:i.VBR=Ke.vbr_mtrh;case Ke.vbr_mtrh:{i.useTemporal==null&&(i.useTemporal=!1),o.apply_preset(i,500-i.VBR_q*10,0),i.quality<0&&(i.quality=LAME_DEFAULT_QUALITY),i.quality<5&&(i.quality=0),i.quality>5&&(i.quality=5),g.PSY.mask_adjust=i.maskingadjust,g.PSY.mask_adjust_short=i.maskingadjust_short,i.experimentalY?g.sfb21_extra=!1:g.sfb21_extra=i.out_samplerate>44e3,g.iteration_loop=new VBRNewIterationLoop(C);break}case Ke.vbr_rh:{o.apply_preset(i,500-i.VBR_q*10,0),g.PSY.mask_adjust=i.maskingadjust,g.PSY.mask_adjust_short=i.maskingadjust_short,i.experimentalY?g.sfb21_extra=!1:g.sfb21_extra=i.out_samplerate>44e3,i.quality>6&&(i.quality=6),i.quality<0&&(i.quality=LAME_DEFAULT_QUALITY),g.iteration_loop=new VBROldIterationLoop(C);break}default:{var Ue;g.sfb21_extra=!1,i.quality<0&&(i.quality=LAME_DEFAULT_QUALITY),Ue=i.VBR,Ue==Ke.vbr_off&&(i.VBR_mean_bitrate_kbps=i.brate),o.apply_preset(i,i.VBR_mean_bitrate_kbps,0),i.VBR=Ue,g.PSY.mask_adjust=i.maskingadjust,g.PSY.mask_adjust_short=i.maskingadjust_short,Ue==Ke.vbr_off?g.iteration_loop=new Kd(C):g.iteration_loop=new ABRIterationLoop(C);break}}if(ca(i.scale>=0),i.VBR!=Ke.vbr_off){if(g.VBR_min_bitrate=1,g.VBR_max_bitrate=14,i.out_samplerate<16e3&&(g.VBR_max_bitrate=8),i.VBR_min_bitrate_kbps!=0&&(i.VBR_min_bitrate_kbps=N(i.VBR_min_bitrate_kbps,i.version,i.out_samplerate),g.VBR_min_bitrate=M(i.VBR_min_bitrate_kbps,i.version,i.out_samplerate),g.VBR_min_bitrate<0)||i.VBR_max_bitrate_kbps!=0&&(i.VBR_max_bitrate_kbps=N(i.VBR_max_bitrate_kbps,i.version,i.out_samplerate),g.VBR_max_bitrate=M(i.VBR_max_bitrate_kbps,i.version,i.out_samplerate),g.VBR_max_bitrate<0))return-1;i.VBR_min_bitrate_kbps=ee.bitrate_table[i.version][g.VBR_min_bitrate],i.VBR_max_bitrate_kbps=ee.bitrate_table[i.version][g.VBR_max_bitrate],i.VBR_mean_bitrate_kbps=Math.min(ee.bitrate_table[i.version][g.VBR_max_bitrate],i.VBR_mean_bitrate_kbps),i.VBR_mean_bitrate_kbps=Math.max(ee.bitrate_table[i.version][g.VBR_min_bitrate],i.VBR_mean_bitrate_kbps)}return i.tune&&(g.PSY.mask_adjust+=i.tune_value_a,g.PSY.mask_adjust_short+=i.tune_value_a),x(i),ca(i.scale>=0),i.athaa_type<0?g.ATH.useAdjust=3:g.ATH.useAdjust=i.athaa_type,g.ATH.aaSensitivityP=Math.pow(10,i.athaa_sensitivity/-10),i.short_blocks==null&&(i.short_blocks=Ks.short_block_allowed),i.short_blocks==Ks.short_block_allowed&&(i.mode==De.JOINT_STEREO||i.mode==De.STEREO)&&(i.short_blocks=Ks.short_block_coupled),i.quant_comp<0&&(i.quant_comp=1),i.quant_comp_short<0&&(i.quant_comp_short=0),i.msfix<0&&(i.msfix=0),i.exp_nspsytune=i.exp_nspsytune|1,i.internal_flags.nsPsy.attackthre<0&&(i.internal_flags.nsPsy.attackthre=qs.NSATTACKTHRE),i.internal_flags.nsPsy.attackthre_s<0&&(i.internal_flags.nsPsy.attackthre_s=qs.NSATTACKTHRE_S),ca(i.scale>=0),i.scale<0&&(i.scale=1),i.ATHtype<0&&(i.ATHtype=4),i.ATHcurve<0&&(i.ATHcurve=4),i.athaa_loudapprox<0&&(i.athaa_loudapprox=2),i.interChRatio<0&&(i.interChRatio=0),i.useTemporal==null&&(i.useTemporal=!0),g.slot_lag=g.frac_SpF=0,i.VBR==Ke.vbr_off&&(g.slot_lag=g.frac_SpF=(i.version+1)*72e3*i.brate%i.out_samplerate|0),k.iteration_init(i),L.psymodel_init(i),ca(i.scale>=0),0};function m(i,g){(i.in_buffer_0==null||i.in_buffer_nsamples<g)&&(i.in_buffer_0=Ma(g),i.in_buffer_1=Ma(g),i.in_buffer_nsamples=g)}this.lame_encode_flush=function(i,g,K,W){var ie=i.internal_flags,he=rm([2,1152]),ue=0,de,Se,ve,ce,Re=ie.mf_samples_to_encode-A.POSTDELAY,He=f(i);if(ie.mf_samples_to_encode<1)return 0;for(de=0,i.in_samplerate!=i.out_samplerate&&(Re+=16*i.out_samplerate/i.in_samplerate),ve=i.framesize-Re%i.framesize,ve<576&&(ve+=i.framesize),i.encoder_padding=ve,ce=(Re+ve)/i.framesize;ce>0&&ue>=0;){var Oe=He-ie.mf_size,Ue=i.frameNum;Oe*=i.in_samplerate,Oe/=i.out_samplerate,Oe>1152&&(Oe=1152),Oe<1&&(Oe=1),Se=W-de,W==0&&(Se=0),ue=this.lame_encode_buffer(i,he[0],he[1],Oe,g,K,Se),K+=ue,de+=ue,ce-=Ue!=i.frameNum?1:0}if(ie.mf_samples_to_encode=0,ue<0||(Se=W-de,W==0&&(Se=0),d.flush_bitstream(i),ue=d.copy_buffer(ie,g,K,Se,1),ue<0))return ue;if(K+=ue,de+=ue,Se=W-de,W==0&&(Se=0),i.write_id3tag_automatic){if(E.id3tag_write_v1(i),ue=d.copy_buffer(ie,g,K,Se,0),ue<0)return ue;de+=ue}return de},this.lame_encode_buffer=function(i,g,K,W,ie,he,ue){var de=i.internal_flags,Se=[null,null];if(de.Class_ID!=F)return-3;if(W==0)return 0;m(de,W),Se[0]=de.in_buffer_0,Se[1]=de.in_buffer_1;for(var ve=0;ve<W;ve++)Se[0][ve]=g[ve],de.channels_in>1&&(Se[1][ve]=K[ve]);return p(i,Se[0],Se[1],W,ie,he,ue)};function f(i){var g=A.BLKSIZE+i.framesize-A.FFTOFFSET;return g=Math.max(g,512+i.framesize-32),g}function p(i,g,K,W,ie,he,ue){var de=i.internal_flags,Se=0,ve,ce,Re,He,Oe,Ue=[null,null],Pe=[null,null];if(de.Class_ID!=F)return-3;if(W==0)return 0;if(Oe=d.copy_buffer(de,ie,he,ue,0),Oe<0)return Oe;if(he+=Oe,Se+=Oe,Pe[0]=g,Pe[1]=K,Vt.NEQ(i.scale,0)&&Vt.NEQ(i.scale,1))for(ce=0;ce<W;++ce)Pe[0][ce]*=i.scale,de.channels_out==2&&(Pe[1][ce]*=i.scale);if(Vt.NEQ(i.scale_left,0)&&Vt.NEQ(i.scale_left,1))for(ce=0;ce<W;++ce)Pe[0][ce]*=i.scale_left;if(Vt.NEQ(i.scale_right,0)&&Vt.NEQ(i.scale_right,1))for(ce=0;ce<W;++ce)Pe[1][ce]*=i.scale_right;if(i.num_channels==2&&de.channels_out==1)for(ce=0;ce<W;++ce)Pe[0][ce]=.5*(Pe[0][ce]+Pe[1][ce]),Pe[1][ce]=0;He=f(i),Ue[0]=de.mfbuf[0],Ue[1]=de.mfbuf[1];for(var Fe=0;W>0;){var Ze=[null,null],pt=0,lt=0;Ze[0]=Pe[0],Ze[1]=Pe[1];var rt=new v;if(z(i,Ue,Ze,Fe,W,rt),pt=rt.n_in,lt=rt.n_out,de.findReplayGain&&!de.decode_on_the_fly&&n.AnalyzeSamples(de.rgdata,Ue[0],de.mf_size,Ue[1],de.mf_size,lt,de.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(W-=pt,Fe+=pt,de.channels_out==2,de.mf_size+=lt,ca(de.mf_size<=Ve.MFSIZE),de.mf_samples_to_encode<1&&(de.mf_samples_to_encode=A.ENCDELAY+A.POSTDELAY),de.mf_samples_to_encode+=lt,de.mf_size>=He){var vt=ue-Se;if(ue==0&&(vt=0),ve=u(i,Ue[0],Ue[1],ie,he,vt),ve<0)return ve;for(he+=ve,Se+=ve,de.mf_size-=i.framesize,de.mf_samples_to_encode-=i.framesize,Re=0;Re<de.channels_out;Re++)for(ce=0;ce<de.mf_size;ce++)Ue[Re][ce]=Ue[Re][ce+i.framesize]}}return Se}function u(i,g,K,W,ie,he){var ue=e.enc.lame_encode_mp3_frame(i,g,K,W,ie,he);return i.frameNum++,ue}function v(){this.n_in=0,this.n_out=0}function _(){this.num_used=0}function I(i,g){return g!=0?I(g,i%g):i}function G(i,g,K){var W=Math.PI*g;i/=K,i<0&&(i=0),i>1&&(i=1);var ie=i-.5,he=.42-.5*Math.cos(2*i*Math.PI)+.08*Math.cos(4*i*Math.PI);return Math.abs(ie)<1e-9?W/Math.PI:he*Math.sin(K*W*ie)/(Math.PI*K*ie)}function D(i,g,K,W,ie,he,ue,de,Se){var ve=i.internal_flags,ce,Re=0,He,Oe=i.out_samplerate/I(i.out_samplerate,i.in_samplerate);Oe>Ve.BPC&&(Oe=Ve.BPC);var Ue=Math.abs(ve.resample_ratio-Math.floor(.5+ve.resample_ratio))<1e-4?1:0,Pe=1/ve.resample_ratio;Pe>1&&(Pe=1);var Fe=31;Fe%2==0&&--Fe,Fe+=Ue;var Ze=Fe+1;if(ve.fill_buffer_resample_init==0){for(ve.inbuf_old[0]=Ma(Ze),ve.inbuf_old[1]=Ma(Ze),ce=0;ce<=2*Oe;++ce)ve.blackfilt[ce]=Ma(Ze);for(ve.itime[0]=0,ve.itime[1]=0,Re=0;Re<=2*Oe;Re++){var pt=0,lt=(Re-Oe)/(2*Oe);for(ce=0;ce<=Fe;ce++)pt+=ve.blackfilt[Re][ce]=G(ce-lt,Pe,Fe);for(ce=0;ce<=Fe;ce++)ve.blackfilt[Re][ce]/=pt}ve.fill_buffer_resample_init=1}var rt=ve.inbuf_old[Se];for(He=0;He<W;He++){var vt,Et;if(vt=He*ve.resample_ratio,Re=0|Math.floor(vt-ve.itime[Se]),Fe+Re-Fe/2>=ue)break;var lt=vt-ve.itime[Se]-(Re+.5*(Fe%2));Et=0|Math.floor(lt*2*Oe+Oe+.5);var Bt=0;for(ce=0;ce<=Fe;++ce){var it=0|ce+Re-Fe/2,Ht;Ht=it<0?rt[Ze+it]:ie[he+it],Bt+=Ht*ve.blackfilt[Et][ce]}g[K+He]=Bt}if(de.num_used=Math.min(ue,Fe+Re-Fe/2),ve.itime[Se]+=de.num_used-He*ve.resample_ratio,de.num_used>=Ze)for(ce=0;ce<Ze;ce++)rt[ce]=ie[he+de.num_used+ce-Ze];else{var gt=Ze-de.num_used;for(ce=0;ce<gt;++ce)rt[ce]=rt[ce+de.num_used];for(Re=0;ce<Ze;++ce,++Re)rt[ce]=ie[he+Re];ca(Re==de.num_used)}return He}function z(i,g,K,W,ie,he){var ue=i.internal_flags;if(ue.resample_ratio<.9999||ue.resample_ratio>1.0001)for(var de=0;de<ue.channels_out;de++){var Se=new _;he.n_out=D(i,g[de],ue.mf_size,i.framesize,K[de],W,ie,Se,de),he.n_in=Se.num_used}else{he.n_out=Math.min(i.framesize,ie),he.n_in=he.n_out;for(var ve=0;ve<he.n_out;++ve)g[0][ue.mf_size+ve]=K[0][W+ve],ue.channels_out==2&&(g[1][ue.mf_size+ve]=K[1][W+ve])}}}var Qt=fe.VbrMode;function sm(){function e(b,E,h,R,w,s,F,H,V,c,T,N,M,O,l){this.vbr_q=b,this.quant_comp=E,this.quant_comp_s=h,this.expY=R,this.st_lrm=w,this.st_s=s,this.masking_adj=F,this.masking_adj_short=H,this.ath_lower=V,this.ath_curve=c,this.ath_sensitivity=T,this.interch=N,this.safejoint=M,this.sfb21mod=O,this.msfix=l}function t(b,E,h,R,w,s,F,H,V,c,T,N,M,O){this.quant_comp=E,this.quant_comp_s=h,this.safejoint=R,this.nsmsfix=w,this.st_lrm=s,this.st_s=F,this.nsbass=H,this.scale=V,this.masking_adj=c,this.ath_lower=T,this.ath_curve=N,this.interch=M,this.sfscale=O}var a;this.setModules=function(b){a=b};var n=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],d=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function o(b,E,h){var R=b.VBR==Qt.vbr_rh?n:d,w=b.VBR_q_frac,s=R[E],F=R[E+1],H=s;s.st_lrm=s.st_lrm+w*(F.st_lrm-s.st_lrm),s.st_s=s.st_s+w*(F.st_s-s.st_s),s.masking_adj=s.masking_adj+w*(F.masking_adj-s.masking_adj),s.masking_adj_short=s.masking_adj_short+w*(F.masking_adj_short-s.masking_adj_short),s.ath_lower=s.ath_lower+w*(F.ath_lower-s.ath_lower),s.ath_curve=s.ath_curve+w*(F.ath_curve-s.ath_curve),s.ath_sensitivity=s.ath_sensitivity+w*(F.ath_sensitivity-s.ath_sensitivity),s.interch=s.interch+w*(F.interch-s.interch),s.msfix=s.msfix+w*(F.msfix-s.msfix),L(b,H.vbr_q),h!=0?b.quant_comp=H.quant_comp:Math.abs(b.quant_comp- -1)>0||(b.quant_comp=H.quant_comp),h!=0?b.quant_comp_short=H.quant_comp_s:Math.abs(b.quant_comp_short- -1)>0||(b.quant_comp_short=H.quant_comp_s),H.expY!=0&&(b.experimentalY=H.expY!=0),h!=0?b.internal_flags.nsPsy.attackthre=H.st_lrm:Math.abs(b.internal_flags.nsPsy.attackthre- -1)>0||(b.internal_flags.nsPsy.attackthre=H.st_lrm),h!=0?b.internal_flags.nsPsy.attackthre_s=H.st_s:Math.abs(b.internal_flags.nsPsy.attackthre_s- -1)>0||(b.internal_flags.nsPsy.attackthre_s=H.st_s),h!=0?b.maskingadjust=H.masking_adj:Math.abs(b.maskingadjust-0)>0||(b.maskingadjust=H.masking_adj),h!=0?b.maskingadjust_short=H.masking_adj_short:Math.abs(b.maskingadjust_short-0)>0||(b.maskingadjust_short=H.masking_adj_short),h!=0?b.ATHlower=-H.ath_lower/10:Math.abs(-b.ATHlower*10-0)>0||(b.ATHlower=-H.ath_lower/10),h!=0?b.ATHcurve=H.ath_curve:Math.abs(b.ATHcurve- -1)>0||(b.ATHcurve=H.ath_curve),h!=0?b.athaa_sensitivity=H.ath_sensitivity:Math.abs(b.athaa_sensitivity- -1)>0||(b.athaa_sensitivity=H.ath_sensitivity),H.interch>0&&(h!=0?b.interChRatio=H.interch:Math.abs(b.interChRatio- -1)>0||(b.interChRatio=H.interch)),H.safejoint>0&&(b.exp_nspsytune=b.exp_nspsytune|H.safejoint),H.sfb21mod>0&&(b.exp_nspsytune=b.exp_nspsytune|H.sfb21mod<<20),h!=0?b.msfix=H.msfix:Math.abs(b.msfix- -1)>0||(b.msfix=H.msfix),h==0&&(b.VBR_q=E,b.VBR_q_frac=w)}var k=[new t(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new t(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new t(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new t(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new t(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new t(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new t(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new t(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new t(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new t(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new t(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new t(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new t(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new t(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new t(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function C(b,E,h){var R=E,w=a.nearestBitrateFullIndex(E);if(b.VBR=Qt.vbr_abr,b.VBR_mean_bitrate_kbps=R,b.VBR_mean_bitrate_kbps=Math.min(b.VBR_mean_bitrate_kbps,320),b.VBR_mean_bitrate_kbps=Math.max(b.VBR_mean_bitrate_kbps,8),b.brate=b.VBR_mean_bitrate_kbps,b.VBR_mean_bitrate_kbps>320&&(b.disable_reservoir=!0),k[w].safejoint>0&&(b.exp_nspsytune=b.exp_nspsytune|2),k[w].sfscale>0&&(b.internal_flags.noise_shaping=2),Math.abs(k[w].nsbass)>0){var s=int(k[w].nsbass*4);s<0&&(s+=64),b.exp_nspsytune=b.exp_nspsytune|s<<2}return h!=0?b.quant_comp=k[w].quant_comp:Math.abs(b.quant_comp- -1)>0||(b.quant_comp=k[w].quant_comp),h!=0?b.quant_comp_short=k[w].quant_comp_s:Math.abs(b.quant_comp_short- -1)>0||(b.quant_comp_short=k[w].quant_comp_s),h!=0?b.msfix=k[w].nsmsfix:Math.abs(b.msfix- -1)>0||(b.msfix=k[w].nsmsfix),h!=0?b.internal_flags.nsPsy.attackthre=k[w].st_lrm:Math.abs(b.internal_flags.nsPsy.attackthre- -1)>0||(b.internal_flags.nsPsy.attackthre=k[w].st_lrm),h!=0?b.internal_flags.nsPsy.attackthre_s=k[w].st_s:Math.abs(b.internal_flags.nsPsy.attackthre_s- -1)>0||(b.internal_flags.nsPsy.attackthre_s=k[w].st_s),h!=0?b.scale=k[w].scale:Math.abs(b.scale- -1)>0||(b.scale=k[w].scale),h!=0?b.maskingadjust=k[w].masking_adj:Math.abs(b.maskingadjust-0)>0||(b.maskingadjust=k[w].masking_adj),k[w].masking_adj>0?h!=0?b.maskingadjust_short=k[w].masking_adj*.9:Math.abs(b.maskingadjust_short-0)>0||(b.maskingadjust_short=k[w].masking_adj*.9):h!=0?b.maskingadjust_short=k[w].masking_adj*1.1:Math.abs(b.maskingadjust_short-0)>0||(b.maskingadjust_short=k[w].masking_adj*1.1),h!=0?b.ATHlower=-k[w].ath_lower/10:Math.abs(-b.ATHlower*10-0)>0||(b.ATHlower=-k[w].ath_lower/10),h!=0?b.ATHcurve=k[w].ath_curve:Math.abs(b.ATHcurve- -1)>0||(b.ATHcurve=k[w].ath_curve),h!=0?b.interChRatio=k[w].interch:Math.abs(b.interChRatio- -1)>0||(b.interChRatio=k[w].interch),E}this.apply_preset=function(b,E,h){switch(E){case Te.R3MIX:{E=Te.V3,b.VBR=Qt.vbr_mtrh;break}case Te.MEDIUM:{E=Te.V4,b.VBR=Qt.vbr_rh;break}case Te.MEDIUM_FAST:{E=Te.V4,b.VBR=Qt.vbr_mtrh;break}case Te.STANDARD:{E=Te.V2,b.VBR=Qt.vbr_rh;break}case Te.STANDARD_FAST:{E=Te.V2,b.VBR=Qt.vbr_mtrh;break}case Te.EXTREME:{E=Te.V0,b.VBR=Qt.vbr_rh;break}case Te.EXTREME_FAST:{E=Te.V0,b.VBR=Qt.vbr_mtrh;break}case Te.INSANE:return E=320,b.preset=E,C(b,E,h),b.VBR=Qt.vbr_off,E}switch(b.preset=E,E){case Te.V9:return o(b,9,h),E;case Te.V8:return o(b,8,h),E;case Te.V7:return o(b,7,h),E;case Te.V6:return o(b,6,h),E;case Te.V5:return o(b,5,h),E;case Te.V4:return o(b,4,h),E;case Te.V3:return o(b,3,h),E;case Te.V2:return o(b,2,h),E;case Te.V1:return o(b,1,h),E;case Te.V0:return o(b,0,h),E}return E>=8&&E<=320?C(b,E,h):(b.preset=0,E)};function L(b,E){var h=0;return E<0&&(h=-1,E=0),E>9&&(h=-1,E=9),b.VBR_q=E,b.VBR_q_frac=0,h}}function om(){this.setModules=function(e,t){}}function Zs(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var ti=fe.new_float,nm=fe.new_int;function im(){this.global_gain=0,this.sfb_count1=0,this.step=nm(39),this.noise=ti(39),this.noise_log=ti(39)}var da=fe.System,ai=fe.VbrMode,Ws=fe.Util,Ua=fe.Arrays,yr=fe.new_float,xr=fe.assert;function lm(){var e;this.rv=null;var t;this.qupvt=null;var a,n=new om,d;this.setModules=function(V,c,T,N){e=V,t=c,this.rv=c,a=T,this.qupvt=T,d=N,n.setModules(a,d)},this.ms_convert=function(V,c){for(var T=0;T<576;++T){var N=V.tt[c][0].xr[T],M=V.tt[c][1].xr[T];V.tt[c][0].xr[T]=(N+M)*(Ws.SQRT2*.5),V.tt[c][1].xr[T]=(N-M)*(Ws.SQRT2*.5)}};function o(V,c,T,N){N=0;for(var M=0;M<=T;++M){var O=Math.abs(V.xr[M]);N+=O,c[M]=Math.sqrt(O*Math.sqrt(O)),c[M]>V.xrpow_max&&(V.xrpow_max=c[M])}return N}this.init_xrpow=function(V,c,T){var N=0,M=0|c.max_nonzero_coeff;if(c.xrpow_max=0,Ua.fill(T,M,576,0),N=o(c,T,M,N),N>1e-20){var O=0;(V.substep_shaping&2)!=0&&(O=1);for(var l=0;l<c.psymax;l++)V.pseudohalf[l]=O;return!0}return Ua.fill(c.l3_enc,0,576,0),!1};function k(V,c){var T=V.ATH,N=c.xr;if(c.block_type!=A.SHORT_TYPE)for(var M=!1,O=A.PSFB21-1;O>=0&&!M;O--){var l=V.scalefac_band.psfb21[O],x=V.scalefac_band.psfb21[O+1],y=a.athAdjust(T.adjust,T.psfb21[O],T.floor);V.nsPsy.longfact[21]>1e-12&&(y*=V.nsPsy.longfact[21]);for(var m=x-1;m>=l;m--)if(Math.abs(N[m])<y)N[m]=0;else{M=!0;break}}else for(var f=0;f<3;f++)for(var M=!1,O=A.PSFB12-1;O>=0&&!M;O--){var l=V.scalefac_band.s[12]*3+(V.scalefac_band.s[13]-V.scalefac_band.s[12])*f+(V.scalefac_band.psfb12[O]-V.scalefac_band.psfb12[0]),x=l+(V.scalefac_band.psfb12[O+1]-V.scalefac_band.psfb12[O]),p=a.athAdjust(T.adjust,T.psfb12[O],T.floor);V.nsPsy.shortfact[12]>1e-12&&(p*=V.nsPsy.shortfact[12]);for(var m=x-1;m>=l;m--)if(Math.abs(N[m])<p)N[m]=0;else{M=!0;break}}}this.init_outer_loop=function(V,c){c.part2_3_length=0,c.big_values=0,c.count1=0,c.global_gain=210,c.scalefac_compress=0,c.table_select[0]=0,c.table_select[1]=0,c.table_select[2]=0,c.subblock_gain[0]=0,c.subblock_gain[1]=0,c.subblock_gain[2]=0,c.subblock_gain[3]=0,c.region0_count=0,c.region1_count=0,c.preflag=0,c.scalefac_scale=0,c.count1table_select=0,c.part2_length=0,c.sfb_lmax=A.SBPSY_l,c.sfb_smin=A.SBPSY_s,c.psy_lmax=V.sfb21_extra?A.SBMAX_l:A.SBPSY_l,c.psymax=c.psy_lmax,c.sfbmax=c.sfb_lmax,c.sfbdivide=11;for(var T=0;T<A.SBMAX_l;T++)c.width[T]=V.scalefac_band.l[T+1]-V.scalefac_band.l[T],c.window[T]=3;if(c.block_type==A.SHORT_TYPE){var N=yr(576);c.sfb_smin=0,c.sfb_lmax=0,c.mixed_block_flag!=0&&(c.sfb_smin=3,c.sfb_lmax=V.mode_gr*2+4),c.psymax=c.sfb_lmax+3*((V.sfb21_extra?A.SBMAX_s:A.SBPSY_s)-c.sfb_smin),c.sfbmax=c.sfb_lmax+3*(A.SBPSY_s-c.sfb_smin),c.sfbdivide=c.sfbmax-18,c.psy_lmax=c.sfb_lmax;var M=V.scalefac_band.l[c.sfb_lmax];da.arraycopy(c.xr,0,N,0,576);for(var T=c.sfb_smin;T<A.SBMAX_s;T++)for(var O=V.scalefac_band.s[T],l=V.scalefac_band.s[T+1],x=0;x<3;x++)for(var y=O;y<l;y++)c.xr[M++]=N[3*y+x];for(var m=c.sfb_lmax,T=c.sfb_smin;T<A.SBMAX_s;T++)c.width[m]=c.width[m+1]=c.width[m+2]=V.scalefac_band.s[T+1]-V.scalefac_band.s[T],c.window[m]=0,c.window[m+1]=1,c.window[m+2]=2,m+=3}c.count1bits=0,c.sfb_partition_table=a.nr_of_sfb_block[0][0],c.slen[0]=0,c.slen[1]=0,c.slen[2]=0,c.slen[3]=0,c.max_nonzero_coeff=575,Ua.fill(c.scalefac,0),k(V,c)};function C(V){this.ordinal=V}C.BINSEARCH_NONE=new C(0),C.BINSEARCH_UP=new C(1),C.BINSEARCH_DOWN=new C(2);function L(V,c,T,N,M){var O,l=V.CurrentStep[N],x=!1,y=V.OldValue[N],m=C.BINSEARCH_NONE;for(c.global_gain=y,T-=c.part2_length;;){var f;if(O=d.count_bits(V,M,c,null),l==1||O==T)break;O>T?(m==C.BINSEARCH_DOWN&&(x=!0),x&&(l/=2),m=C.BINSEARCH_UP,f=l):(m==C.BINSEARCH_UP&&(x=!0),x&&(l/=2),m=C.BINSEARCH_DOWN,f=-l),c.global_gain+=f,c.global_gain<0&&(c.global_gain=0,x=!0),c.global_gain>255&&(c.global_gain=255,x=!0)}for(xr(c.global_gain>=0),xr(c.global_gain<256);O>T&&c.global_gain<255;)c.global_gain++,O=d.count_bits(V,M,c,null);return V.CurrentStep[N]=y-c.global_gain>=4?4:2,V.OldValue[N]=c.global_gain,c.part2_3_length=O,O}this.trancate_smallspectrums=function(V,c,T,N){var M=yr(la.SFBMAX);if(!((V.substep_shaping&4)==0&&c.block_type==A.SHORT_TYPE||(V.substep_shaping&128)!=0)){a.calc_noise(c,T,M,new Zs,null);for(var l=0;l<576;l++){var O=0;c.l3_enc[l]!=0&&(O=Math.abs(c.xr[l])),N[l]=O}var l=0,x=8;c.block_type==A.SHORT_TYPE&&(x=6);do{var y,m,f,p,u=c.width[x];if(l+=u,!(M[x]>=1)&&(Ua.sort(N,l-u,u),!BitStream.EQ(N[l-1],0))){y=(1-M[x])*T[x],m=0,p=0;do{var v;for(f=1;p+f<u&&!BitStream.NEQ(N[p+l-u],N[p+l+f-u]);f++);if(v=N[p+l-u]*N[p+l-u]*f,y<v){p!=0&&(m=N[p+l-u-1]);break}y-=v,p+=f}while(p<u);if(!BitStream.EQ(m,0))do Math.abs(c.xr[l-u])<=m&&(c.l3_enc[l-u]=0);while(--u>0)}}while(++x<c.psymax);c.part2_3_length=d.noquant_count_bits(V,c,null)}};function b(V){for(var c=0;c<V.sfbmax;c++)if(V.scalefac[c]+V.subblock_gain[V.window[c]]==0)return!1;return!0}function E(V){return Ws.FAST_LOG10(.368+.632*V*V*V)}function h(V,c){for(var T=1e-37,N=0;N<c.psymax;N++)T+=E(V[N]);return Math.max(1e-20,T)}function R(V,c,T,N,M){var O;switch(V){default:case 9:{c.over_count>0?(O=T.over_SSD<=c.over_SSD,T.over_SSD==c.over_SSD&&(O=T.bits<c.bits)):O=T.max_noise<0&&T.max_noise*10+T.bits<=c.max_noise*10+c.bits;break}case 0:O=T.over_count<c.over_count||T.over_count==c.over_count&&T.over_noise<c.over_noise||T.over_count==c.over_count&&BitStream.EQ(T.over_noise,c.over_noise)&&T.tot_noise<c.tot_noise;break;case 8:T.max_noise=h(M,N);case 1:O=T.max_noise<c.max_noise;break;case 2:O=T.tot_noise<c.tot_noise;break;case 3:O=T.tot_noise<c.tot_noise&&T.max_noise<c.max_noise;break;case 4:O=T.max_noise<=0&&c.max_noise>.2||T.max_noise<=0&&c.max_noise<0&&c.max_noise>T.max_noise-.2&&T.tot_noise<c.tot_noise||T.max_noise<=0&&c.max_noise>0&&c.max_noise>T.max_noise-.2&&T.tot_noise<c.tot_noise+c.over_noise||T.max_noise>0&&c.max_noise>-.05&&c.max_noise>T.max_noise-.1&&T.tot_noise+T.over_noise<c.tot_noise+c.over_noise||T.max_noise>0&&c.max_noise>-.1&&c.max_noise>T.max_noise-.15&&T.tot_noise+T.over_noise+T.over_noise<c.tot_noise+c.over_noise+c.over_noise;break;case 5:O=T.over_noise<c.over_noise||BitStream.EQ(T.over_noise,c.over_noise)&&T.tot_noise<c.tot_noise;break;case 6:O=T.over_noise<c.over_noise||BitStream.EQ(T.over_noise,c.over_noise)&&(T.max_noise<c.max_noise||BitStream.EQ(T.max_noise,c.max_noise)&&T.tot_noise<=c.tot_noise);break;case 7:O=T.over_count<c.over_count||T.over_noise<c.over_noise;break}return c.over_count==0&&(O=O&&T.bits<c.bits),O}function w(V,c,T,N,M){var O=V.internal_flags,l;c.scalefac_scale==0?l=1.2968395546510096:l=1.6817928305074292;for(var x=0,y=0;y<c.sfbmax;y++)x<T[y]&&(x=T[y]);var m=O.noise_shaping_amp;switch(m==3&&(M?m=2:m=1),m){case 2:break;case 1:x>1?x=Math.pow(x,.5):x*=.95;break;case 0:default:x>1?x=1:x*=.95;break}for(var f=0,y=0;y<c.sfbmax;y++){var p=c.width[y],u;if(f+=p,!(T[y]<x)){if((O.substep_shaping&2)!=0&&(O.pseudohalf[y]=O.pseudohalf[y]==0?1:0,O.pseudohalf[y]==0&&O.noise_shaping_amp==2))return;for(c.scalefac[y]++,u=-p;u<0;u++)N[f+u]*=l,N[f+u]>c.xrpow_max&&(c.xrpow_max=N[f+u]);if(O.noise_shaping_amp==2)return}}}function s(V,c){for(var T=1.2968395546510096,N=0,M=0;M<V.sfbmax;M++){var O=V.width[M],l=V.scalefac[M];if(V.preflag!=0&&(l+=a.pretab[M]),N+=O,(l&1)!=0){l++;for(var x=-O;x<0;x++)c[N+x]*=T,c[N+x]>V.xrpow_max&&(V.xrpow_max=c[N+x])}V.scalefac[M]=l>>1}V.preflag=0,V.scalefac_scale=1}function F(V,c,T){var N,M=c.scalefac;for(N=0;N<c.sfb_lmax;N++)if(M[N]>=16)return!0;for(var O=0;O<3;O++){var l=0,x=0;for(N=c.sfb_lmax+O;N<c.sfbdivide;N+=3)l<M[N]&&(l=M[N]);for(;N<c.sfbmax;N+=3)x<M[N]&&(x=M[N]);if(!(l<16&&x<8)){if(c.subblock_gain[O]>=7)return!0;c.subblock_gain[O]++;var y=V.scalefac_band.l[c.sfb_lmax];for(N=c.sfb_lmax+O;N<c.sfbmax;N+=3){var m,f=c.width[N],p=M[N];if(p=p-(4>>c.scalefac_scale),p>=0){M[N]=p,y+=f*3;continue}M[N]=0;{var u=210+(p<<c.scalefac_scale+1);m=a.IPOW20(u)}y+=f*(O+1);for(var v=-f;v<0;v++)T[y+v]*=m,T[y+v]>c.xrpow_max&&(c.xrpow_max=T[y+v]);y+=f*(3-O-1)}{var m=a.IPOW20(202);y+=c.width[N]*(O+1);for(var v=-c.width[N];v<0;v++)T[y+v]*=m,T[y+v]>c.xrpow_max&&(c.xrpow_max=T[y+v])}}}return!1}function H(V,c,T,N,M){var O=V.internal_flags;w(V,c,T,N,M);var l=b(c);return l?!1:(O.mode_gr==2?l=d.scale_bitcount(c):l=d.scale_bitcount_lsf(O,c),l?(O.noise_shaping>1&&(Ua.fill(O.pseudohalf,0),c.scalefac_scale==0?(s(c,N),l=!1):c.block_type==A.SHORT_TYPE&&O.subblock_gain>0&&(l=F(O,c,N)||b(c))),l||(O.mode_gr==2?l=d.scale_bitcount(c):l=d.scale_bitcount_lsf(O,c)),!l):!0)}this.outer_loop=function(V,c,T,N,M,O){var l=V.internal_flags,x=new ts,y=yr(576),m=yr(la.SFBMAX),f=new Zs,p,u=new im,v=9999999,_=!1,I=!1,G=0;if(L(l,c,O,M,N),l.noise_shaping==0)return 100;a.calc_noise(c,T,m,f,u),f.bits=c.part2_3_length,x.assign(c);var D=0;for(da.arraycopy(N,0,y,0,576);!_;){do{var z=new Zs,i,g=255;if((l.substep_shaping&2)!=0?i=20:i=3,l.sfb21_extra&&(m[x.sfbmax]>1||x.block_type==A.SHORT_TYPE&&(m[x.sfbmax+1]>1||m[x.sfbmax+2]>1))||!H(V,x,m,N,I))break;x.scalefac_scale!=0&&(g=254);var K=O-x.part2_length;if(K<=0)break;for(;(x.part2_3_length=d.count_bits(l,N,x,u))>K&&x.global_gain<=g;)x.global_gain++;if(x.global_gain>g)break;if(f.over_count==0){for(;(x.part2_3_length=d.count_bits(l,N,x,u))>v&&x.global_gain<=g;)x.global_gain++;if(x.global_gain>g)break}if(a.calc_noise(x,T,m,z,u),z.bits=x.part2_3_length,c.block_type!=A.SHORT_TYPE?p=V.quant_comp:p=V.quant_comp_short,p=R(p,f,z,x,m)?1:0,p!=0)v=c.part2_3_length,f=z,c.assign(x),D=0,da.arraycopy(N,0,y,0,576);else if(l.full_outer_loop==0&&(++D>i&&f.over_count==0||l.noise_shaping_amp==3&&I&&D>30||l.noise_shaping_amp==3&&I&&x.global_gain-G>15))break}while(x.global_gain+x.scalefac_scale<255);l.noise_shaping_amp==3?I?_=!0:(x.assign(c),da.arraycopy(y,0,N,0,576),D=0,G=x.global_gain,I=!0):_=!0}return xr(c.global_gain+c.scalefac_scale<=255),V.VBR==ai.vbr_rh||V.VBR==ai.vbr_mtrh?da.arraycopy(y,0,N,0,576):(l.substep_shaping&1)!=0&&trancate_smallspectrums(l,c,T,N),f.over_count},this.iteration_finish_one=function(V,c,T){var N=V.l3_side,M=N.tt[c][T];d.best_scalefac_store(V,c,T,N),V.use_best_huffman==1&&d.best_huffman_divide(V,M),t.ResvAdjust(V,M)},this.VBR_encode_granule=function(V,c,T,N,M,O,l){var x=V.internal_flags,y=new ts,m=yr(576),f=l,p=l+1,u=(l+O)/2,v,_,I=0,G=x.sfb21_extra;xr(f<=LameInternalFlags.MAX_BITS_PER_CHANNEL),Ua.fill(y.l3_enc,0);do u>f-42?x.sfb21_extra=!1:x.sfb21_extra=G,_=outer_loop(V,c,T,N,M,u),_<=0?(I=1,p=c.part2_3_length,y.assign(c),da.arraycopy(N,0,m,0,576),l=p-32,v=l-O,u=(l+O)/2):(O=u+32,v=l-O,u=(l+O)/2,I!=0&&(I=2,c.assign(y),da.arraycopy(m,0,N,0,576)));while(v>12);x.sfb21_extra=G,I==2&&da.arraycopy(y.l3_enc,0,c.l3_enc,0,576),xr(c.part2_3_length<=f)},this.get_framebits=function(V,c){var T=V.internal_flags;T.bitrate_index=T.VBR_min_bitrate;var N=e.getframebits(V);T.bitrate_index=1,N=e.getframebits(V);for(var M=1;M<=T.VBR_max_bitrate;M++){T.bitrate_index=M;var O=new MeanBits(N);c[M]=t.ResvFrameBegin(V,O),N=O.bits}},this.VBR_old_prepare=function(V,c,T,N,M,O,l,x,y){var m=V.internal_flags,f,p=0,u=1,v=0;m.bitrate_index=m.VBR_max_bitrate;var _=t.ResvFrameBegin(V,new MeanBits(0))/m.mode_gr;get_framebits(V,O);for(var I=0;I<m.mode_gr;I++){var G=a.on_pe(V,c,x[I],_,I,0);m.mode_ext==A.MPG_MD_MS_LR&&(ms_convert(m.l3_side,I),a.reduce_side(x[I],T[I],_,G));for(var D=0;D<m.channels_out;++D){var z=m.l3_side.tt[I][D];z.block_type!=A.SHORT_TYPE?(p=1.28/(1+Math.exp(3.5-c[I][D]/300))-.05,f=m.PSY.mask_adjust-p):(p=2.56/(1+Math.exp(3.5-c[I][D]/300))-.14,f=m.PSY.mask_adjust_short-p),m.masking_lower=Math.pow(10,f*.1),init_outer_loop(m,z),y[I][D]=a.calc_xmin(V,N[I][D],z,M[I][D]),y[I][D]!=0&&(u=0),l[I][D]=126,v+=x[I][D]}}for(var I=0;I<m.mode_gr;I++)for(var D=0;D<m.channels_out;D++)v>O[m.VBR_max_bitrate]&&(x[I][D]*=O[m.VBR_max_bitrate],x[I][D]/=v),l[I][D]>x[I][D]&&(l[I][D]=x[I][D]);return u},this.bitpressure_strategy=function(V,c,T,N){for(var M=0;M<V.mode_gr;M++)for(var O=0;O<V.channels_out;O++){for(var l=V.l3_side.tt[M][O],x=c[M][O],y=0,m=0;m<l.psy_lmax;m++)x[y++]*=1+.029*m*m/A.SBMAX_l/A.SBMAX_l;if(l.block_type==A.SHORT_TYPE)for(var m=l.sfb_smin;m<A.SBMAX_s;m++)x[y++]*=1+.029*m*m/A.SBMAX_s/A.SBMAX_s,x[y++]*=1+.029*m*m/A.SBMAX_s/A.SBMAX_s,x[y++]*=1+.029*m*m/A.SBMAX_s/A.SBMAX_s;N[M][O]=0|Math.max(T[M][O],.9*N[M][O])}},this.VBR_new_prepare=function(V,c,T,N,M,O){var l=V.internal_flags,x=1,y=0,m=0,f;if(V.free_format){l.bitrate_index=0;var p=new MeanBits(y);f=t.ResvFrameBegin(V,p),y=p.bits,M[0]=f}else{l.bitrate_index=l.VBR_max_bitrate;var p=new MeanBits(y);t.ResvFrameBegin(V,p),y=p.bits,get_framebits(V,M),f=M[l.VBR_max_bitrate]}for(var u=0;u<l.mode_gr;u++){a.on_pe(V,c,O[u],y,u,0),l.mode_ext==A.MPG_MD_MS_LR&&ms_convert(l.l3_side,u);for(var v=0;v<l.channels_out;++v){var _=l.l3_side.tt[u][v];l.masking_lower=Math.pow(10,l.PSY.mask_adjust*.1),init_outer_loop(l,_),a.calc_xmin(V,T[u][v],_,N[u][v])!=0&&(x=0),m+=O[u][v]}}for(var u=0;u<l.mode_gr;u++)for(var v=0;v<l.channels_out;v++)m>f&&(O[u][v]*=f,O[u][v]/=m);return x},this.calc_target_bits=function(V,c,T,N,M,O){var l=V.internal_flags,x=l.l3_side,y,m,f,p,u=0;l.bitrate_index=l.VBR_max_bitrate;var v=new MeanBits(u);for(O[0]=t.ResvFrameBegin(V,v),u=v.bits,l.bitrate_index=1,u=e.getframebits(V)-l.sideinfo_len*8,M[0]=u/(l.mode_gr*l.channels_out),u=V.VBR_mean_bitrate_kbps*V.framesize*1e3,(l.substep_shaping&1)!=0&&(u*=1.09),u/=V.out_samplerate,u-=l.sideinfo_len*8,u/=l.mode_gr*l.channels_out,y=.93+.07*(11-V.compression_ratio)/(11-5.5),y<.9&&(y=.9),y>1&&(y=1),m=0;m<l.mode_gr;m++){var _=0;for(f=0;f<l.channels_out;f++){if(N[m][f]=int(y*u),c[m][f]>700){var I=int((c[m][f]-700)/1.4),G=x.tt[m][f];N[m][f]=int(y*u),G.block_type==A.SHORT_TYPE&&I<u/2&&(I=u/2),I>u*3/2?I=u*3/2:I<0&&(I=0),N[m][f]+=I}N[m][f]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(N[m][f]=LameInternalFlags.MAX_BITS_PER_CHANNEL),_+=N[m][f]}if(_>LameInternalFlags.MAX_BITS_PER_GRANULE)for(f=0;f<l.channels_out;++f)N[m][f]*=LameInternalFlags.MAX_BITS_PER_GRANULE,N[m][f]/=_}if(l.mode_ext==A.MPG_MD_MS_LR)for(m=0;m<l.mode_gr;m++)a.reduce_side(N[m],T[m],u*l.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(p=0,m=0;m<l.mode_gr;m++)for(f=0;f<l.channels_out;f++)N[m][f]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(N[m][f]=LameInternalFlags.MAX_BITS_PER_CHANNEL),p+=N[m][f];if(p>O[0])for(m=0;m<l.mode_gr;m++)for(f=0;f<l.channels_out;f++)N[m][f]*=O[0],N[m][f]/=p}}var ri=fe.assert;function cm(){var e;this.setModules=function(t){e=t},this.ResvFrameBegin=function(t,a){var n=t.internal_flags,d,o=n.l3_side,k=e.getframebits(t);a.bits=(k-n.sideinfo_len*8)/n.mode_gr;var C=8*256*n.mode_gr-8;t.brate>320?d=8*int(t.brate*1e3/(t.out_samplerate/1152)/8+.5):(d=8*1440,t.strict_ISO&&(d=8*int(32e4/(t.out_samplerate/1152)/8+.5))),n.ResvMax=d-k,n.ResvMax>C&&(n.ResvMax=C),(n.ResvMax<0||t.disable_reservoir)&&(n.ResvMax=0);var L=a.bits*n.mode_gr+Math.min(n.ResvSize,n.ResvMax);return L>d&&(L=d),ri(n.ResvMax%8==0),ri(n.ResvMax>=0),o.resvDrain_pre=0,n.pinfo!=null&&(n.pinfo.mean_bits=a.bits/2,n.pinfo.resvsize=n.ResvSize),L},this.ResvMaxBits=function(t,a,n,d){var o=t.internal_flags,k,C=o.ResvSize,L=o.ResvMax;d!=0&&(C+=a),(o.substep_shaping&1)!=0&&(L*=.9),n.bits=a,C*10>L*9?(k=C-L*9/10,n.bits+=k,o.substep_shaping|=128):(k=0,o.substep_shaping&=127,!t.disable_reservoir&&(o.substep_shaping&1)==0&&(n.bits-=.1*a));var b=C<o.ResvMax*6/10?C:o.ResvMax*6/10;return b-=k,b<0&&(b=0),b},this.ResvAdjust=function(t,a){t.ResvSize-=a.part2_3_length+a.part2_length},this.ResvFrameEnd=function(t,a){var n,d=t.l3_side;t.ResvSize+=a*t.mode_gr;var o=0;d.resvDrain_post=0,d.resvDrain_pre=0,(n=t.ResvSize%8)!=0&&(o+=n),n=t.ResvSize-o-t.ResvMax,n>0&&(o+=n);{var k=Math.min(d.main_data_begin*8,o)/8;d.resvDrain_pre+=8*k,o-=8*k,t.ResvSize-=8*k,d.main_data_begin-=k}d.resvDrain_post+=o,t.ResvSize-=o}}function dm(){var e="http://www.mp3dev.org/",t=3,a=98,n=4,d=0,o=93;this.getLameVersion=function(){return t+"."+a+"."+n},this.getLameShortVersion=function(){return t+"."+a+"."+n},this.getLameVeryShortVersion=function(){return"LAME"+t+"."+a+"r"},this.getPsyVersion=function(){return d+"."+o},this.getLameUrl=function(){return e},this.getLameOsBitness=function(){return"32bits"}}var mm=fe.System,Qs=fe.VbrMode,si=fe.ShortBlock,hm=fe.Arrays,ns=fe.new_byte,um=fe.assert;wr.NUMTOCENTRIES=100,wr.MAXFRAMESIZE=2880;function wr(){var e,t,a;this.setModules=function(u,v,_){e=u,t=v,a=_};var n=1,d=2,o=4,k=8,C=wr.NUMTOCENTRIES,L=wr.MAXFRAMESIZE,b=C+4+4+4+4+4,E=b+9+1+1+8+1+1+3+1+1+2+4+2+2,h=128,R=64,w=32,s=null,F="Xing",H="Info",V=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function c(u,v){if(u.nVbrNumFrames++,u.sum+=v,u.seen++,!(u.seen<u.want)&&(u.pos<u.size&&(u.bag[u.pos]=u.sum,u.pos++,u.seen=0),u.pos==u.size)){for(var _=1;_<u.size;_+=2)u.bag[_/2]=u.bag[_];u.want*=2,u.pos/=2}}function T(u,v){if(!(u.pos<=0))for(var _=1;_<C;++_){var I=_/C,G,D,z=0|Math.floor(I*u.pos);z>u.pos-1&&(z=u.pos-1),G=u.bag[z],D=u.sum;var i=0|256*G/D;i>255&&(i=255),v[_]=255&i}}this.addVbrFrame=function(u){var v=u.internal_flags,_=Tables.bitrate_table[u.version][v.bitrate_index];um(v.VBR_seek_table.bag!=null),c(v.VBR_seek_table,_)};function N(u,v){var _=u[v+0]&255;return _<<=8,_|=u[v+1]&255,_<<=8,_|=u[v+2]&255,_<<=8,_|=u[v+3]&255,_}function M(u,v,_){u[v+0]=255&(_>>24&255),u[v+1]=255&(_>>16&255),u[v+2]=255&(_>>8&255),u[v+3]=255&(_&255)}function O(u,v,_){u[v+0]=255&(_>>8&255),u[v+1]=255&(_&255)}function l(u,v){return new String(u,v,F.length(),s).equals(F)||new String(u,v,H.length(),s).equals(H)}function x(u,v,_){return 255&(u<<v|_&~(-1<<v))}function y(u,v){var _=u.internal_flags;v[0]=x(v[0],8,255),v[1]=x(v[1],3,7),v[1]=x(v[1],1,u.out_samplerate<16e3?0:1),v[1]=x(v[1],1,u.version),v[1]=x(v[1],2,4-3),v[1]=x(v[1],1,u.error_protection?0:1),v[2]=x(v[2],4,_.bitrate_index),v[2]=x(v[2],2,_.samplerate_index),v[2]=x(v[2],1,0),v[2]=x(v[2],1,u.extension),v[3]=x(v[3],2,u.mode.ordinal()),v[3]=x(v[3],2,_.mode_ext),v[3]=x(v[3],1,u.copyright),v[3]=x(v[3],1,u.original),v[3]=x(v[3],2,u.emphasis),v[0]=255;var I=255&(v[1]&241),G;u.version==1?G=h:u.out_samplerate<16e3?G=w:G=R,u.VBR==Qs.vbr_off&&(G=u.brate);var D;u.free_format?D=0:D=255&16*e.BitrateIndex(G,u.version,u.out_samplerate),u.version==1?(v[1]=255&(I|10),I=255&(v[2]&13),v[2]=255&(D|I)):(v[1]=255&(I|2),I=255&(v[2]&13),v[2]=255&(D|I))}this.getVbrTag=function(u){var v=new VBRTagData,_=0;v.flags=0;var I=u[_+1]>>3&1,G=u[_+2]>>2&3,D=u[_+3]>>6&3,z=u[_+2]>>4&15;if(z=Tables.bitrate_table[I][z],u[_+1]>>4==14?v.samprate=Tables.samplerate_table[2][G]:v.samprate=Tables.samplerate_table[I][G],I!=0?D!=3?_+=32+4:_+=17+4:D!=3?_+=17+4:_+=9+4,!l(u,_))return null;_+=4,v.hId=I;var i=v.flags=N(u,_);if(_+=4,(i&n)!=0&&(v.frames=N(u,_),_+=4),(i&d)!=0&&(v.bytes=N(u,_),_+=4),(i&o)!=0){if(v.toc!=null)for(var g=0;g<C;g++)v.toc[g]=u[_+g];_+=C}v.vbrScale=-1,(i&k)!=0&&(v.vbrScale=N(u,_),_+=4),v.headersize=(I+1)*72e3*z/v.samprate,_+=21;var K=u[_+0]<<4;K+=u[_+1]>>4;var W=(u[_+1]&15)<<8;return W+=u[_+2]&255,(K<0||K>3e3)&&(K=-1),(W<0||W>3e3)&&(W=-1),v.encDelay=K,v.encPadding=W,v},this.InitVbrTag=function(u){var v=u.internal_flags,_;u.version==1?_=h:u.out_samplerate<16e3?_=w:_=R,u.VBR==Qs.vbr_off&&(_=u.brate);var I=(u.version+1)*72e3*_/u.out_samplerate,G=v.sideinfo_len+E;if(v.VBR_seek_table.TotalFrameSize=I,I<G||I>L){u.bWriteVbrTag=!1;return}v.VBR_seek_table.nVbrNumFrames=0,v.VBR_seek_table.nBytesWritten=0,v.VBR_seek_table.sum=0,v.VBR_seek_table.seen=0,v.VBR_seek_table.want=1,v.VBR_seek_table.pos=0,v.VBR_seek_table.bag==null&&(v.VBR_seek_table.bag=new int[400],v.VBR_seek_table.size=400);var D=ns(L);y(u,D);for(var z=v.VBR_seek_table.TotalFrameSize,i=0;i<z;++i)t.add_dummy_byte(u,D[i]&255,1)};function m(u,v){var _=v^u;return v=v>>8^V[_&255],v}this.updateMusicCRC=function(u,v,_,I){for(var G=0;G<I;++G)u[0]=m(v[_+G],u[0])};function f(u,v,_,I,G){var D=u.internal_flags,z=0,i=u.encoder_delay,g=u.encoder_padding,K=100-10*u.VBR_q-u.quality,W=a.getLameVeryShortVersion(),ie,he=0,ue,de=[1,5,3,2,4,0,3],Se=0|(u.lowpassfreq/100+.5>255?255:u.lowpassfreq/100+.5),ve=0,ce=0,Re=0,He=u.internal_flags.noise_shaping,Oe=0,Ue=0,Pe=0,Fe=0,Ze=0,pt=(u.exp_nspsytune&1)!=0,lt=(u.exp_nspsytune&2)!=0,rt=!1,vt=!1,Et=u.internal_flags.nogap_total,Bt=u.internal_flags.nogap_current,it=u.ATHtype,Ht=0,gt;switch(u.VBR){case vbr_abr:gt=u.VBR_mean_bitrate_kbps;break;case vbr_off:gt=u.brate;break;default:gt=u.VBR_min_bitrate_kbps}switch(u.VBR.ordinal()<de.length?ie=de[u.VBR.ordinal()]:ie=0,ue=16*he+ie,D.findReplayGain&&(D.RadioGain>510&&(D.RadioGain=510),D.RadioGain<-510&&(D.RadioGain=-510),ce=8192,ce|=3072,D.RadioGain>=0?ce|=D.RadioGain:(ce|=512,ce|=-D.RadioGain)),D.findPeakSample&&(ve=Math.abs(0|D.PeakSample/32767*Math.pow(2,23)+.5)),Et!=-1&&(Bt>0&&(vt=!0),Bt<Et-1&&(rt=!0)),Ht=it+((pt?1:0)<<4)+((lt?1:0)<<5)+((rt?1:0)<<6)+((vt?1:0)<<7),K<0&&(K=0),u.mode){case MONO:Oe=0;break;case STEREO:Oe=1;break;case DUAL_CHANNEL:Oe=2;break;case JOINT_STEREO:u.force_ms?Oe=4:Oe=3;break;case NOT_SET:default:Oe=7;break}u.in_samplerate<=32e3?Pe=0:u.in_samplerate==48e3?Pe=2:u.in_samplerate>48e3?Pe=3:Pe=1,(u.short_blocks==si.short_block_forced||u.short_blocks==si.short_block_dispensed||u.lowpassfreq==-1&&u.highpassfreq==-1||u.scale_left<u.scale_right||u.scale_left>u.scale_right||u.disable_reservoir&&u.brate<320||u.noATH||u.ATHonly||it==0||u.in_samplerate<=32e3)&&(Ue=1),Fe=He+(Oe<<2)+(Ue<<5)+(Pe<<6),Ze=D.nMusicCRC,M(_,I+z,K),z+=4;for(var ct=0;ct<9;ct++)_[I+z+ct]=255&W.charAt(ct);z+=9,_[I+z]=255&ue,z++,_[I+z]=255&Se,z++,M(_,I+z,ve),z+=4,O(_,I+z,ce),z+=2,O(_,I+z,Re),z+=2,_[I+z]=255&Ht,z++,gt>=255?_[I+z]=255:_[I+z]=255&gt,z++,_[I+z]=255&i>>4,_[I+z+1]=255&(i<<4)+(g>>8),_[I+z+2]=255&g,z+=3,_[I+z]=255&Fe,z++,_[I+z++]=0,O(_,I+z,u.preset),z+=2,M(_,I+z,v),z+=4,O(_,I+z,Ze),z+=2;for(var le=0;le<z;le++)G=m(_[I+le],G);return O(_,I+z,G),z+=2,z}function p(u){u.seek(0);var v=ns(10);u.readFully(v);var _;return new String(v,"ISO-8859-1").startsWith("ID3")?_=0:_=((v[6]&127)<<21|(v[7]&127)<<14|(v[8]&127)<<7|v[9]&127)+v.length,_}this.getLameTagFrame=function(u,v){var _=u.internal_flags;if(!u.bWriteVbrTag||_.Class_ID!=Lame.LAME_ID||_.VBR_seek_table.pos<=0)return 0;if(v.length<_.VBR_seek_table.TotalFrameSize)return _.VBR_seek_table.TotalFrameSize;hm.fill(v,0,_.VBR_seek_table.TotalFrameSize,0),y(u,v);var I=ns(C);if(u.free_format)for(var G=1;G<C;++G)I[G]=255&255*G/100;else T(_.VBR_seek_table,I);var D=_.sideinfo_len;u.error_protection&&(D-=2),u.VBR==Qs.vbr_off?(v[D++]=255&H.charAt(0),v[D++]=255&H.charAt(1),v[D++]=255&H.charAt(2),v[D++]=255&H.charAt(3)):(v[D++]=255&F.charAt(0),v[D++]=255&F.charAt(1),v[D++]=255&F.charAt(2),v[D++]=255&F.charAt(3)),M(v,D,n+d+o+k),D+=4,M(v,D,_.VBR_seek_table.nVbrNumFrames),D+=4;var z=_.VBR_seek_table.nBytesWritten+_.VBR_seek_table.TotalFrameSize;M(v,D,0|z),D+=4,mm.arraycopy(I,0,v,D,I.length),D+=I.length,u.error_protection&&t.CRC_writeheader(_,v);for(var i=0,G=0;G<D;G++)i=m(v[G],i);return D+=f(u,z,v,D,i),_.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(u,v){var _=u.internal_flags;if(_.VBR_seek_table.pos<=0||(v.seek(v.length()),v.length()==0))return-1;var I=p(v);v.seek(I);var G=ns(L),D=getLameTagFrame(u,G);return D>G.length?-1:(D<1||v.write(G,0,D),0)}}var oi=fe.new_byte,fm=fe.assert;function _m(){this.setModules=function(e,t){}}function pm(){this.setModules=function(e,t,a){}}function vm(){}function gm(){this.setModules=function(e,t){}}function bm(e,t,a){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,t=44100,a=128);var n=new Te,d=new _m,o=new at,k=new Vt,C=new sm,L=new _t,b=new lm,E=new wr,h=new dm,R=new gm,w=new cm,s=new br,F=new pm,H=new vm;n.setModules(o,k,C,L,b,E,h,R,H),k.setModules(o,H,h,E),R.setModules(k,h),C.setModules(n),b.setModules(k,w,L,s),L.setModules(s,w,n.enc.psy),w.setModules(k),s.setModules(L),E.setModules(n,k,h),d.setModules(F,H),F.setModules(h,R,C);var V=n.lame_init();V.num_channels=e,V.in_samplerate=t,V.brate=a,V.mode=De.STEREO,V.quality=3,V.bWriteVbrTag=!1,V.disable_reservoir=!0,V.write_id3tag_automatic=!1,n.lame_init_params(V);var c=1152,T=0|1.25*c+7200,N=oi(T);this.encodeBuffer=function(M,O){e==1&&(O=M),fm(M.length==O.length),M.length>c&&(c=M.length,T=0|1.25*c+7200,N=oi(T));var l=n.lame_encode_buffer(V,M,O,M.length,N,0,T);return new Int8Array(N.subarray(0,l))},this.flush=function(){var M=n.lame_encode_flush(V,N,0,T);return new Int8Array(N.subarray(0,M))}}function is(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}is("RIFF"),is("WAVE"),is("fmt "),is("data");class ym{constructor(t){this.bitRate=t.bitRate,this.sampleRate=t.sampleRate,this.dataBuffer=[],this.encoder=new bm(1,this.sampleRate,this.bitRate)}encode(t){const n=this._convertBuffer(t);let d=n.length;for(let o=0;d>=0;o+=1152){const k=n.subarray(o,o+1152),C=this.encoder.encodeBuffer(k);this.dataBuffer.push(new Int8Array(C)),d-=1152}}finish(){this.dataBuffer.push(this.encoder.flush());const t=new Blob(this.dataBuffer,{type:"audio/mp3"});return this.dataBuffer=[],{id:Date.now(),blob:t,url:URL.createObjectURL(t)}}_floatTo16BitPCM(t,a){for(let n=0;n<t.length;n++){const d=Math.max(-1,Math.min(1,t[n]));a[n]=d<0?d*32768:d*32767}}_convertBuffer(t){const a=new Float32Array(t),n=new Int16Array(t.length);return this._floatTo16BitPCM(a,n),n}}class xm{constructor(t={}){this.beforeRecording=t.beforeRecording,this.pauseRecording=t.pauseRecording,this.afterRecording=t.afterRecording,this.micFailed=t.micFailed,this.encoderOptions={bitRate:t.bitRate,sampleRate:t.sampleRate},this.bufferSize=4096,this.records=[],this.isPause=!1,this.isRecording=!1,this.duration=0,this.volume=0,this._duration=0}start(){const t={video:!1,audio:{channelCount:1,echoCancellation:!1}};this.beforeRecording&&this.beforeRecording("start recording"),navigator.mediaDevices.getUserMedia(t).then(this._micCaptured.bind(this)).catch(this._micError.bind(this)),this.isPause=!1,this.isRecording=!0,this.lameEncoder||(this.lameEncoder=new ym(this.encoderOptions))}stop(){this.stream.getTracks().forEach(a=>a.stop()),this.input.disconnect(),this.processor.disconnect(),this.context.close();let t=null;t=this.lameEncoder.finish(),t.duration=this.duration,this.records.push(t),this._duration=0,this.duration=0,this.isPause=!1,this.isRecording=!1,this.afterRecording&&this.afterRecording(t)}pause(){this.stream.getTracks().forEach(t=>t.stop()),this.input.disconnect(),this.processor.disconnect(),this._duration=this.duration,this.isPause=!0,this.pauseRecording&&this.pauseRecording("pause recording")}_micCaptured(t){this.context=new(window.AudioContext||window.webkitAudioContext),this.duration=this._duration,this.input=this.context.createMediaStreamSource(t),this.processor=this.context.createScriptProcessor(this.bufferSize,1,1),this.stream=t,this.processor.onaudioprocess=a=>{const n=a.inputBuffer.getChannelData(0);let d=0;this.lameEncoder&&this.lameEncoder.encode(n);for(let o=0;o<n.length;++o)d+=n[o]*n[o];this.duration=parseFloat(this._duration)+parseFloat(this.context.currentTime.toFixed(2)),this.volume=Math.sqrt(d/n.length).toFixed(2)},this.input.connect(this.processor),this.processor.connect(this.context.destination)}_micError(t){this.micFailed&&this.micFailed(t)}}function ni(){var e=wm(),t=e.substr(0,4);return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw(n|u)|c55\/|capi|ccwa|cdm|cell|chtm|cldc|cmd|co(mp|nd)|craw|da(it|ll|ng)|dbte|dcs|devi|dica|dmob|do(c|p)o|ds(12|d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(|_)|g1 u|g560|gene|gf5|gmo|go(\.w|od)|gr(ad|un)|haie|hcit|hd(m|p|t)|hei|hi(pt|ta)|hp( i|ip)|hsc|ht(c(| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i(20|go|ma)|i230|iac( ||\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|[a-w])|libw|lynx|m1w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|mcr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|([1-8]|c))|phil|pire|pl(ay|uc)|pn2|po(ck|rt|se)|prox|psio|ptg|qaa|qc(07|12|21|32|60|[2-7]|i)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h|oo|p)|sdk\/|se(c(|0|1)|47|mc|nd|ri)|sgh|shar|sie(|m)|sk0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h|v|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl|tdg|tel(i|m)|tim|tmo|to(pl|sh)|ts(70|m|m3|m5)|tx9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas|your|zeto|zte/i.test(t)}function wm(){var e=navigator.userAgent||navigator.vendor||window.opera||null;if(!e)throw new Error("Failed to look for user agent information.");return e}const km={name:"RoomFooter",components:{SvgIcon:mt,EmojiPickerContainer:On,RoomFiles:I1,RoomMessageReply:sd,RoomUsersTag:dd,RoomEmojis:fd,RoomTemplatesText:xd},directives:{clickOutside:Vr},props:{room:{type:Object,required:!0},roomId:{type:[String,Number],required:!0},roomMessage:{type:String,default:null},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},textMessages:{type:Object,required:!0},showSendIcon:{type:Boolean,required:!0},showFiles:{type:Boolean,required:!0},showAudio:{type:Boolean,required:!0},showEmojis:{type:Boolean,required:!0},showFooter:{type:Boolean,required:!0},acceptedFiles:{type:String,required:!0},textareaActionEnabled:{type:Boolean,required:!0},textareaAutoFocus:{type:Boolean,required:!0},userTagsEnabled:{type:Boolean,required:!0},emojisSuggestionEnabled:{type:Boolean,required:!0},templatesText:{type:Array,default:null},audioBitRate:{type:Number,required:!0},audioSampleRate:{type:Number,required:!0},initReplyMessage:{type:Object,default:null},initEditMessage:{type:Object,default:null}},emits:["edit-message","send-message","update-edited-message-id","textarea-action-handler","typing-message"],data(){return{message:"",editedMessage:{},messageReply:null,cursorRangePosition:null,files:[],fileDialog:!1,selectUsersTagItem:null,selectEmojiItem:null,selectTemplatesTextItem:null,format:"mp3",activeUpOrDownEmojis:null,activeUpOrDownUsersTag:null,activeUpOrDownTemplatesText:null,emojisDB:new tn,emojiOpened:!1,keepKeyboardOpen:!1,filteredEmojis:[],filteredUsersTag:[],selectedUsersTag:[],filteredTemplatesText:[],recorder:this.initRecorder(),isRecording:!1}},computed:{isMessageEmpty(){return!this.files.length&&!this.message.trim()},isFileLoading(){return this.files.some(e=>e.loading)},recordedTime(){return new Date(this.recorder.duration*1e3).toISOString().substr(14,5)},shadowFooter(){return!!this.filteredEmojis.length||!!this.filteredUsersTag.length||!!this.filteredTemplatesText.length||!!this.files.length||!!this.messageReply}},watch:{roomId(){this.resetMessage(!0,!0),this.roomMessage&&(this.message=this.roomMessage,setTimeout(()=>this.onChangeInput()))},message(e){this.getTextareaRef().value=e},roomMessage:{immediate:!0,handler(e){e&&(this.message=this.roomMessage)}},editedMessage(e){this.$emit("update-edited-message-id",e._id)},initReplyMessage(e){this.replyMessage(e)},initEditMessage(e){this.editMessage(e)}},mounted(){const e=ni();let t=!0;this.getTextareaRef().addEventListener("keyup",a=>{a.key==="Enter"&&!a.shiftKey&&!this.fileDialog&&(e?(this.message=this.message+`
`,setTimeout(()=>this.onChangeInput())):t&&!this.filteredEmojis.length&&!this.filteredUsersTag.length&&!this.filteredTemplatesText.length&&this.sendMessage()),t=!a.isComposing,setTimeout(()=>{this.updateFooterLists()},60)}),this.getTextareaRef().addEventListener("click",()=>{e&&(this.keepKeyboardOpen=!0),this.updateFooterLists()}),this.getTextareaRef().addEventListener("blur",()=>{setTimeout(()=>{this.resetFooterList()},100),e&&setTimeout(()=>this.keepKeyboardOpen=!1)})},beforeUnmount(){this.stopRecorder()},methods:{getTextareaRef(){return this.$refs.roomTextarea},focusTextarea(e){ni()&&e||!this.getTextareaRef()||(this.getTextareaRef().focus(),this.cursorRangePosition&&setTimeout(()=>{this.getTextareaRef().setSelectionRange(this.cursorRangePosition,this.cursorRangePosition),this.cursorRangePosition=null}))},onChangeInput(){var e,t,a;(((e=this.getTextareaRef())==null?void 0:e.value)||((t=this.getTextareaRef())==null?void 0:t.value)==="")&&(this.message=(a=this.getTextareaRef())==null?void 0:a.value),this.keepKeyboardOpen=!0,this.resizeTextarea(),this.$emit("typing-message",this.message)},resizeTextarea(){const e=this.getTextareaRef();if(!e)return;const t=window.getComputedStyle(e,null).getPropertyValue("padding-top").replace("px","");e.style.height=0,e.style.height=e.scrollHeight-t*2+"px"},escapeTextarea(){this.filteredEmojis.length?this.filteredEmojis=[]:this.filteredUsersTag.length?this.filteredUsersTag=[]:this.filteredTemplatesText.length?this.filteredTemplatesText=[]:this.resetMessage()},onPasteImage(e){var a;const t=(a=e.clipboardData)==null?void 0:a.items;t&&Array.from(t).forEach(n=>{if(n.type.includes("image")){const d=n.getAsFile();this.onFileChange([d])}})},updateActiveUpOrDown(e){this.filteredEmojis.length?this.activeUpOrDownEmojis=e:this.filteredUsersTag.length?this.activeUpOrDownUsersTag=e:this.filteredTemplatesText.length&&(this.activeUpOrDownTemplatesText=e)},selectItem(){this.filteredEmojis.length?this.selectEmojiItem=!0:this.filteredUsersTag.length?this.selectUsersTagItem=!0:this.filteredTemplatesText.length&&(this.selectTemplatesTextItem=!0)},selectEmoji(e){if(this.selectEmojiItem=!1,!e)return;const{position:t,endPosition:a}=this.getCharPosition(":");this.message=this.message.substr(0,t-1)+e+this.message.substr(a,this.message.length-1),this.cursorRangePosition=t,this.focusTextarea()},selectTemplateText(e){if(this.selectTemplatesTextItem=!1,!e)return;const{position:t,endPosition:a}=this.getCharPosition("/"),n=this.message.substr(a,a).length?"":" ";this.message=this.message.substr(0,t-1)+e.text+n+this.message.substr(a,this.message.length-1),this.cursorRangePosition=t+e.text.length+n.length+1,this.focusTextarea()},addEmoji(e){this.message+=e.unicode,this.focusTextarea(!0)},launchFilePicker(){this.$refs.file.value="",this.$refs.file.click()},async onFileChange(e){this.fileDialog=!0,this.focusTextarea(),Array.from(e).forEach(async t=>{const a=URL.createObjectURL(t),n=t.name.lastIndexOf(".");this.files.push({loading:!0,name:t.name.substring(0,n),size:t.size,type:t.type,extension:t.name.substring(n+1),localUrl:a});const d=await fetch(a).then(k=>k.blob());let o=this.files.find(k=>k.localUrl===a);o&&(o.blob=d,o.loading=!1,delete o.loading)}),setTimeout(()=>this.fileDialog=!1,500)},removeFile(e){this.files.splice(e,1),this.focusTextarea()},toggleRecorder(e){if(this.isRecording=e,!this.recorder.isRecording)setTimeout(()=>this.recorder.start(),200);else try{this.recorder.stop();const t=this.recorder.records[0];this.files.push({blob:t.blob,name:`audio.${this.format}`,size:t.blob.size,duration:t.duration,type:t.blob.type,audio:!0,localUrl:URL.createObjectURL(t.blob)}),this.recorder=this.initRecorder(),this.sendMessage()}catch{setTimeout(()=>this.stopRecorder(),100)}},stopRecorder(){if(this.recorder.isRecording)try{this.recorder.stop(),this.recorder=this.initRecorder()}catch{setTimeout(()=>this.stopRecorder(),100)}},textareaActionHandler(){this.$emit("textarea-action-handler",this.message)},sendMessage(){var a;let e=this.message.trim();if(!this.files.length&&!e||this.isFileLoading)return;this.selectedUsersTag.forEach(n=>{e=e.replace(`@${n.username}`,`<usertag>${n._id}</usertag>`)});const t=this.files.length?this.files:null;this.editedMessage._id?(this.editedMessage.content!==e||((a=this.editedMessage.files)==null?void 0:a.length)||this.files.length)&&this.$emit("edit-message",{messageId:this.editedMessage._id,newContent:e,files:t,replyMessage:this.messageReply,usersTag:this.selectedUsersTag}):this.$emit("send-message",{content:e,files:t,replyMessage:this.messageReply,usersTag:this.selectedUsersTag}),this.resetMessage(!0)},editMessage(e){this.resetMessage(),this.editedMessage={...e};let t=e.content;const a=t,n="<usertag>",d="</usertag>";[...t.matchAll(new RegExp(n,"gi"))].map(k=>k.index).forEach(k=>{const C=a.substring(k+n.length,a.indexOf(d,k)),L=this.room.users.find(b=>b._id===C);t=t.replace(`${n}${C}${d}`,`@${(L==null?void 0:L.username)||"unknown"}`),this.selectUserTag(L,!0)}),this.message=t,e.files&&(this.files=[...e.files]),setTimeout(()=>this.resizeTextarea())},replyMessage(e){this.editedMessage={},this.messageReply=e,this.focusTextarea()},updateFooterLists(){this.updateFooterList("@"),this.updateFooterList(":"),this.updateFooterList("/")},updateFooterList(e){if(!this.getTextareaRef()||e===":"&&!this.emojisSuggestionEnabled||e==="@"&&(!this.userTagsEnabled||!this.room.users)||e==="/"&&!this.templatesText)return;const t=this.getTextareaRef().selectionStart;let a=t;for(;a>0&&this.message.charAt(a-1)!==e&&(this.message.charAt(a-1)!==" "||e!==":");)a--;const n=this.message.charAt(a-2),d=!n.match(/^[0-9a-zA-Z]+$/);if(this.message.charAt(a-1)===e&&(!n||n===" "||d)){const o=this.message.substring(a,t);e===":"?this.updateEmojis(o):e==="@"?this.updateShowUsersTag(o):e==="/"&&this.updateShowTemplatesText(o)}else this.resetFooterList(e)},updateShowUsersTag(e){this.filteredUsersTag=Es(this.room.users,"username",e,!0).filter(t=>t._id!==this.currentUserId)},selectUserTag(e,t=!1){if(this.selectUsersTagItem=!1,!e)return;const{position:a,endPosition:n}=this.getCharPosition("@"),d=this.message.substr(n,n).length?"":" ";this.message=this.message.substr(0,a)+e.username+d+this.message.substr(n,this.message.length-1),this.selectedUsersTag=[...this.selectedUsersTag,{...e}],t||(this.cursorRangePosition=a+e.username.length+d.length+1),this.focusTextarea()},updateShowTemplatesText(e){this.filteredTemplatesText=Es(this.templatesText,"tag",e,!0)},getCharPosition(e){let a=this.getTextareaRef().selectionStart;for(;a>0&&this.message.charAt(a-1)!==e;)a--;const n=this.getTextareaRef().selectionEnd;return{position:a,endPosition:n}},async updateEmojis(e){if(!e)return;const t=await this.emojisDB.getEmojiBySearchQuery(e);this.filteredEmojis=t.map(a=>a.unicode)},resetFooterList(e=null){e===":"?this.filteredEmojis=[]:e==="@"?this.filteredUsersTag=[]:e==="/"?this.filteredTemplatesText=[]:(this.filteredEmojis=[],this.filteredUsersTag=[],this.filteredTemplatesText=[])},resetMessage(e=!1,t=!1){t||this.$emit("typing-message",null),this.selectedUsersTag=[],this.resetFooterList(),this.resetTextareaSize(),this.message="",this.editedMessage={},this.messageReply=null,this.files=[],this.emojiOpened=!1,this.preventKeyboardFromClosing(),(this.textareaAutoFocus||!t)&&setTimeout(()=>this.focusTextarea(e))},resetTextareaSize(){this.getTextareaRef()&&(this.getTextareaRef().style.height="20px")},preventKeyboardFromClosing(){this.keepKeyboardOpen&&this.getTextareaRef().focus()},initRecorder(){return this.isRecording=!1,new xm({bitRate:Number(this.audioBitRate),sampleRate:Number(this.audioSampleRate),beforeRecording:null,afterRecording:null,pauseRecording:null,micFailed:this.micFailed})},micFailed(){this.isRecording=!1,this.recorder=this.initRecorder()}}},Sm={key:0,class:"vac-icon-textarea-left"},Em=r.createElementVNode("div",{class:"vac-dot-audio-record"},null,-1),Mm={class:"vac-dot-audio-record-time"},Rm=["placeholder"],Am={class:"vac-icon-textarea"},Tm={key:1},Bm=["accept"];function Cm(e,t,a,n,d,o){const k=r.resolveComponent("room-emojis"),C=r.resolveComponent("room-users-tag"),L=r.resolveComponent("room-templates-text"),b=r.resolveComponent("room-message-reply"),E=r.resolveComponent("room-files"),h=r.resolveComponent("svg-icon"),R=r.resolveComponent("emoji-picker-container"),w=r.resolveDirective("click-outside");return r.withDirectives((r.openBlock(),r.createElementBlock("div",{id:"room-footer",class:r.normalizeClass(["vac-room-footer",{"vac-app-box-shadow":o.shadowFooter}])},[r.createVNode(k,{"filtered-emojis":d.filteredEmojis,"select-item":d.selectEmojiItem,"active-up-or-down":d.activeUpOrDownEmojis,onSelectEmoji:t[0]||(t[0]=s=>o.selectEmoji(s)),onActivateItem:t[1]||(t[1]=s=>d.activeUpOrDownEmojis=0)},null,8,["filtered-emojis","select-item","active-up-or-down"]),r.createVNode(C,{"filtered-users-tag":d.filteredUsersTag,"select-item":d.selectUsersTagItem,"active-up-or-down":d.activeUpOrDownUsersTag,onSelectUserTag:t[2]||(t[2]=s=>o.selectUserTag(s)),onActivateItem:t[3]||(t[3]=s=>d.activeUpOrDownUsersTag=0)},null,8,["filtered-users-tag","select-item","active-up-or-down"]),r.createVNode(L,{"filtered-templates-text":d.filteredTemplatesText,"select-item":d.selectTemplatesTextItem,"active-up-or-down":d.activeUpOrDownTemplatesText,onSelectTemplateText:t[4]||(t[4]=s=>o.selectTemplateText(s)),onActivateItem:t[5]||(t[5]=s=>d.activeUpOrDownTemplatesText=0)},null,8,["filtered-templates-text","select-item","active-up-or-down"]),r.createVNode(b,{room:a.room,"message-reply":d.messageReply,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onResetMessage:o.resetMessage},r.createSlots({_:2},[r.renderList(e.$slots,(s,F)=>({name:F,fn:r.withCtx(H=>[r.renderSlot(e.$slots,F,r.normalizeProps(r.guardReactiveProps(H)))])}))]),1032,["room","message-reply","text-formatting","link-options","onResetMessage"]),r.createVNode(E,{files:d.files,onRemoveFile:o.removeFile,onResetMessage:o.resetMessage},r.createSlots({_:2},[r.renderList(e.$slots,(s,F)=>({name:F,fn:r.withCtx(H=>[r.renderSlot(e.$slots,F,r.normalizeProps(r.guardReactiveProps(H)))])}))]),1032,["files","onRemoveFile","onResetMessage"]),r.createElementVNode("div",{class:r.normalizeClass(["vac-box-footer",{"vac-box-footer-border":!d.files.length}])},[a.showAudio&&!d.files.length?(r.openBlock(),r.createElementBlock("div",Sm,[d.isRecording?(r.openBlock(),r.createElementBlock(r.Fragment,{key:0},[r.createElementVNode("div",{class:"vac-svg-button vac-icon-audio-stop",onClick:t[6]||(t[6]=(...s)=>o.stopRecorder&&o.stopRecorder(...s))},[r.renderSlot(e.$slots,"audio-stop-icon",{},()=>[r.createVNode(h,{name:"close-outline"})])]),Em,r.createElementVNode("div",Mm,r.toDisplayString(o.recordedTime),1),r.createElementVNode("div",{class:"vac-svg-button vac-icon-audio-confirm",onClick:t[7]||(t[7]=s=>o.toggleRecorder(!1))},[r.renderSlot(e.$slots,"audio-check-icon",{},()=>[r.createVNode(h,{name:"checkmark"})])])],64)):(r.openBlock(),r.createElementBlock("div",{key:1,class:"vac-svg-button",onClick:t[8]||(t[8]=s=>o.toggleRecorder(!0))},[r.renderSlot(e.$slots,"microphone-icon",{},()=>[r.createVNode(h,{name:"microphone",class:"vac-icon-microphone"})])]))])):r.createCommentVNode("",!0),r.createElementVNode("textarea",{id:"roomTextarea",ref:"roomTextarea",placeholder:a.textMessages.TYPE_MESSAGE,class:r.normalizeClass(["vac-textarea",{"vac-textarea-outline":d.editedMessage._id}]),style:{"min-height":"20px","padding-left":"12px"},onInput:t[9]||(t[9]=(...s)=>o.onChangeInput&&o.onChangeInput(...s)),onKeydown:[t[10]||(t[10]=r.withKeys((...s)=>o.escapeTextarea&&o.escapeTextarea(...s),["esc"])),t[11]||(t[11]=r.withKeys(r.withModifiers((...s)=>o.selectItem&&o.selectItem(...s),["exact","prevent"]),["enter"])),t[13]||(t[13]=r.withKeys(r.withModifiers(()=>{},["exact","prevent"]),["tab"])),t[14]||(t[14]=r.withKeys((...s)=>o.selectItem&&o.selectItem(...s),["tab"])),t[15]||(t[15]=r.withKeys(r.withModifiers(()=>{},["exact","prevent"]),["up"])),t[16]||(t[16]=r.withKeys(s=>o.updateActiveUpOrDown(-1),["up"])),t[17]||(t[17]=r.withKeys(r.withModifiers(()=>{},["exact","prevent"]),["down"])),t[18]||(t[18]=r.withKeys(s=>o.updateActiveUpOrDown(1),["down"]))],onPaste:t[12]||(t[12]=(...s)=>o.onPasteImage&&o.onPasteImage(...s))},null,42,Rm),r.createElementVNode("div",Am,[d.editedMessage._id?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-svg-button",onClick:t[19]||(t[19]=(...s)=>o.resetMessage&&o.resetMessage(...s))},[r.renderSlot(e.$slots,"edit-close-icon",{},()=>[r.createVNode(h,{name:"close-outline"})])])):r.createCommentVNode("",!0),a.showEmojis?r.withDirectives((r.openBlock(),r.createElementBlock("div",Tm,[r.renderSlot(e.$slots,"emoji-picker",r.mergeProps({emojiOpened:d.emojiOpened},{addEmoji:o.addEmoji}),()=>[r.createVNode(R,{"emoji-opened":d.emojiOpened,"position-top":!0,onAddEmoji:o.addEmoji,onOpenEmoji:t[20]||(t[20]=s=>d.emojiOpened=s)},{"emoji-picker-icon":r.withCtx(()=>[r.renderSlot(e.$slots,"emoji-picker-icon")]),_:3},8,["emoji-opened","onAddEmoji"])])])),[[w,()=>d.emojiOpened=!1]]):r.createCommentVNode("",!0),a.showFiles?(r.openBlock(),r.createElementBlock("div",{key:2,class:"vac-svg-button",onClick:t[21]||(t[21]=(...s)=>o.launchFilePicker&&o.launchFilePicker(...s))},[r.renderSlot(e.$slots,"paperclip-icon",{},()=>[r.createVNode(h,{name:"paperclip"})])])):r.createCommentVNode("",!0),a.textareaActionEnabled?(r.openBlock(),r.createElementBlock("div",{key:3,class:"vac-svg-button",onClick:t[22]||(t[22]=(...s)=>o.textareaActionHandler&&o.textareaActionHandler(...s))},[r.renderSlot(e.$slots,"custom-action-icon",{},()=>[r.createVNode(h,{name:"deleted"})])])):r.createCommentVNode("",!0),a.showFiles?(r.openBlock(),r.createElementBlock("input",{key:4,ref:"file",type:"file",multiple:"",accept:a.acceptedFiles,style:{display:"none"},onChange:t[23]||(t[23]=s=>o.onFileChange(s.target.files))},null,40,Bm)):r.createCommentVNode("",!0),a.showSendIcon?(r.openBlock(),r.createElementBlock("div",{key:5,class:r.normalizeClass(["vac-svg-button",{"vac-send-disabled":o.isMessageEmpty}]),onClick:t[24]||(t[24]=(...s)=>o.sendMessage&&o.sendMessage(...s))},[r.renderSlot(e.$slots,"send-icon",{},()=>[r.createVNode(h,{name:"send",param:o.isMessageEmpty||o.isFileLoading?"disabled":""},null,8,["param"])])],2)):r.createCommentVNode("",!0)])],2)],2)),[[r.vShow,Object.keys(a.room).length&&a.showFooter]])}var Om=Ye(km,[["render",Cm]]);const Nm={name:"MessageReply",components:{AudioPlayer:zs,SvgIcon:mt,FormatMessage:or},props:{message:{type:Object,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},roomUsers:{type:Array,required:!0}},computed:{replyUsername(){const{senderId:e}=this.message.replyMessage,t=this.roomUsers.find(a=>a._id===e);return t?t.username:""},firstFile(){var e,t;return(t=(e=this.message.replyMessage)==null?void 0:e.files)!=null&&t.length?this.message.replyMessage.files[0]:{}},isAudio(){return Hr(this.firstFile)},isImage(){return La(this.firstFile)},isVideo(){return ir(this.firstFile)},isOtherFile(){var e;return((e=this.message.replyMessage.files)==null?void 0:e.length)&&!this.isAudio&&!this.isVideo&&!this.isImage}}},Lm={class:"vac-reply-message"},Im={class:"vac-reply-username"},jm={key:0,class:"vac-image-reply-container"},Vm={key:1,class:"vac-video-reply-container"},Hm={width:"100%",height:"100%",controls:""},Pm=["src"],Fm={key:3,class:"vac-file-container"},Dm={class:"vac-text-ellipsis"},Um={key:0,class:"vac-text-ellipsis vac-text-extension"},zm={class:"vac-reply-content"};function qm(e,t,a,n,d,o){const k=r.resolveComponent("audio-player"),C=r.resolveComponent("svg-icon"),L=r.resolveComponent("format-message");return r.openBlock(),r.createElementBlock("div",Lm,[r.createElementVNode("div",Im,r.toDisplayString(o.replyUsername),1),o.isImage?(r.openBlock(),r.createElementBlock("div",jm,[r.createElementVNode("div",{class:"vac-message-image vac-message-image-reply",style:r.normalizeStyle({"background-image":`url('${o.firstFile.url}')`})},null,4)])):o.isVideo?(r.openBlock(),r.createElementBlock("div",Vm,[r.createElementVNode("video",Hm,[r.createElementVNode("source",{src:o.firstFile.url},null,8,Pm)])])):o.isAudio?(r.openBlock(),r.createBlock(k,{key:2,src:o.firstFile.url,"message-selection-enabled":!1,onUpdateProgressTime:t[0]||(t[0]=b=>e.progressTime=b),onHoverAudioProgress:t[1]||(t[1]=b=>e.hoverAudioProgress=b)},r.createSlots({_:2},[r.renderList(e.$slots,(b,E)=>({name:E,fn:r.withCtx(h=>[r.renderSlot(e.$slots,E,r.normalizeProps(r.guardReactiveProps(h)))])}))]),1032,["src"])):o.isOtherFile?(r.openBlock(),r.createElementBlock("div",Fm,[r.createElementVNode("div",null,[r.renderSlot(e.$slots,"file-icon",{},()=>[r.createVNode(C,{name:"file"})])]),r.createElementVNode("div",Dm,r.toDisplayString(o.firstFile.name),1),o.firstFile.extension?(r.openBlock(),r.createElementBlock("div",Um,r.toDisplayString(o.firstFile.extension),1)):r.createCommentVNode("",!0)])):r.createCommentVNode("",!0),r.createElementVNode("div",zm,[r.createVNode(L,{"message-id":a.message.replyMessage._id,content:a.message.replyMessage.content,users:a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,reply:!0},null,8,["message-id","content","users","text-formatting","link-options"])])])}var Ym=Ye(Nm,[["render",qm]]);const Xm={name:"ProgressBar",props:{progress:{type:Number,default:0}},data(){const n=54*Math.PI;return{radius:35,stroke:4,normalizedRadius:27,circumference:n}},computed:{strokeDashoffset(){return this.circumference-this.progress/100*this.circumference}}},Gm={ref:"progress",class:"vac-progress-wrapper"},Km=["height","width"],Zm=["stroke-dasharray","stroke-width","r","cx","cy"],Wm={class:"vac-progress-text"},Qm=r.createElementVNode("span",{class:"vac-progress-pourcent"},"%",-1);function Jm(e,t,a,n,d,o){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-fade-spinner",appear:""},{default:r.withCtx(()=>[r.createElementVNode("div",Gm,[(r.openBlock(),r.createElementBlock("svg",{height:d.radius*2,width:d.radius*2},[r.createElementVNode("circle",{stroke:"rgba(255, 255, 255, 0.7)","stroke-dasharray":d.circumference+" "+d.circumference,style:r.normalizeStyle({strokeDashoffset:o.strokeDashoffset,strokeLinecap:"round"}),"stroke-width":d.stroke,fill:"transparent",r:d.normalizedRadius,cx:d.radius,cy:d.radius},null,12,Zm)],8,Km)),r.createElementVNode("div",{class:"vac-progress-content",style:r.normalizeStyle({height:d.radius*2-19+"px",width:d.radius*2-19+"px"})},[r.createElementVNode("div",Wm,[r.createTextVNode(r.toDisplayString(a.progress),1),Qm])],4)],512)]),_:1})}var ii=Ye(Xm,[["render",Jm]]);const $m={name:"MessageFile",components:{SvgIcon:mt,Loader:Rr,ProgressBar:ii},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},file:{type:Object,required:!0},index:{type:Number,required:!0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["open-file"],data(){return{imageResponsive:"",imageLoading:!1,imageHover:!1}},computed:{isImageLoading(){return this.file.url.indexOf("blob:http")!==-1||this.imageLoading},isImage(){return La(this.file)},isVideo(){return ir(this.file)}},watch:{file:{immediate:!0,handler(){this.checkImgLoad()}}},mounted(){const e=this.$refs["imageRef"+this.index];e&&(this.imageResponsive={maxHeight:e.clientWidth-18,loaderTop:e.clientHeight/2-9})},methods:{checkImgLoad(){if(!La(this.file))return;this.imageLoading=!0;const e=new Image;e.src=this.file.url,e.addEventListener("load",()=>this.imageLoading=!1)},openFile(e,t){this.messageSelectionEnabled||(e.stopPropagation(),this.$emit("open-file",{file:this.file,action:t}))}}},e2={class:"vac-message-file-container"},t2={key:0,class:"vac-image-buttons"},a2={width:"100%",height:"100%",controls:""},r2=["src"];function s2(e,t,a,n,d,o){const k=r.resolveComponent("progress-bar"),C=r.resolveComponent("loader"),L=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",e2,[o.isImage?(r.openBlock(),r.createElementBlock("div",{key:0,ref:"imageRef"+a.index,class:"vac-message-image-container",onMouseover:t[2]||(t[2]=b=>d.imageHover=!0),onMouseleave:t[3]||(t[3]=b=>d.imageHover=!1),onClick:t[4]||(t[4]=b=>o.openFile(b,"preview"))},[a.file.progress>=0?(r.openBlock(),r.createBlock(k,{key:0,progress:a.file.progress,style:r.normalizeStyle({top:`${d.imageResponsive.loaderTop}px`})},null,8,["progress","style"])):(r.openBlock(),r.createBlock(C,{key:1,show:o.isImageLoading,type:"message-file","message-id":a.message._id,style:r.normalizeStyle({top:`${d.imageResponsive.loaderTop}px`})},r.createSlots({_:2},[r.renderList(e.$slots,(b,E)=>({name:E,fn:r.withCtx(h=>[r.renderSlot(e.$slots,E,r.normalizeProps(r.guardReactiveProps(h)))])}))]),1032,["show","message-id","style"])),r.createElementVNode("div",{class:r.normalizeClass(["vac-message-image",{"vac-blur-loading":o.isImageLoading&&a.message.senderId===a.currentUserId}]),style:r.normalizeStyle({"background-image":`url('${o.isImageLoading&&a.file.preview||a.file.url}')`,"max-height":`${d.imageResponsive.maxHeight}px`})},[r.createVNode(r.Transition,{name:"vac-fade-image"},{default:r.withCtx(()=>[!a.messageSelectionEnabled&&d.imageHover&&!o.isImageLoading?(r.openBlock(),r.createElementBlock("div",t2,[r.createElementVNode("div",{class:"vac-svg-button vac-button-view",onClick:t[0]||(t[0]=b=>o.openFile(b,"preview"))},[r.renderSlot(e.$slots,"eye-icon_"+a.message._id,{},()=>[r.createVNode(L,{name:"eye"})])]),r.createElementVNode("div",{class:"vac-svg-button vac-button-download",onClick:t[1]||(t[1]=b=>o.openFile(b,"download"))},[r.renderSlot(e.$slots,"document-icon_"+a.message._id,{},()=>[r.createVNode(L,{name:"document"})])])])):r.createCommentVNode("",!0)]),_:3})],6)],544)):o.isVideo?(r.openBlock(),r.createElementBlock("div",{key:1,class:"vac-video-container",onClick:t[5]||(t[5]=r.withModifiers(b=>o.openFile("preview"),["prevent"]))},[a.file.progress>=0?(r.openBlock(),r.createBlock(k,{key:0,progress:a.file.progress},null,8,["progress"])):r.createCommentVNode("",!0),r.createElementVNode("video",a2,[r.createElementVNode("source",{src:a.file.url},null,8,r2)])])):r.createCommentVNode("",!0)])}var o2=Ye($m,[["render",s2]]);const n2={name:"MessageFiles",components:{SvgIcon:mt,FormatMessage:or,ProgressBar:ii,MessageFile:o2},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},roomUsers:{type:Array,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["open-file","open-user-tag"],computed:{imageVideoFiles(){return this.message.files.filter(e=>Vo(e))},otherFiles(){return this.message.files.filter(e=>!Vo(e))}},methods:{openFile(e,t,a){this.messageSelectionEnabled||(e.stopPropagation(),this.$emit("open-file",{file:t,action:a}))}}},i2={class:"vac-message-files-container"},l2=["onClick"],c2={class:"vac-svg-button"},d2={class:"vac-text-ellipsis"},m2={key:0,class:"vac-text-ellipsis vac-text-extension"};function h2(e,t,a,n,d,o){const k=r.resolveComponent("message-file"),C=r.resolveComponent("progress-bar"),L=r.resolveComponent("svg-icon"),b=r.resolveComponent("format-message");return r.openBlock(),r.createElementBlock("div",i2,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(o.imageVideoFiles,(E,h)=>(r.openBlock(),r.createElementBlock("div",{key:h+"iv"},[r.createVNode(k,{file:E,"current-user-id":a.currentUserId,message:a.message,index:h,"message-selection-enabled":a.messageSelectionEnabled,onOpenFile:t[0]||(t[0]=R=>e.$emit("open-file",R))},r.createSlots({_:2},[r.renderList(e.$slots,(R,w)=>({name:w,fn:r.withCtx(s=>[r.renderSlot(e.$slots,w,r.normalizeProps(r.guardReactiveProps(s)))])}))]),1032,["file","current-user-id","message","index","message-selection-enabled"])]))),128)),(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(o.otherFiles,(E,h)=>(r.openBlock(),r.createElementBlock("div",{key:h+"a",class:"vac-file-wrapper"},[E.progress>=0?(r.openBlock(),r.createBlock(C,{key:0,progress:E.progress,style:{top:"44px"}},null,8,["progress"])):r.createCommentVNode("",!0),r.createElementVNode("div",{class:r.normalizeClass(["vac-file-container",{"vac-file-container-progress":E.progress>=0}]),onClick:R=>o.openFile(R,E,"download")},[r.createElementVNode("div",c2,[r.renderSlot(e.$slots,"document-icon",{},()=>[r.createVNode(L,{name:"document"})])]),r.createElementVNode("div",d2,r.toDisplayString(E.name),1),E.extension?(r.openBlock(),r.createElementBlock("div",m2,r.toDisplayString(E.extension),1)):r.createCommentVNode("",!0)],10,l2)]))),128)),r.createVNode(b,{"message-id":a.message._id,content:a.message.content,users:a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onOpenUserTag:t[1]||(t[1]=E=>e.$emit("open-user-tag",E))},null,8,["message-id","content","users","text-formatting","link-options"])])}var u2=Ye(n2,[["render",h2]]);const f2={name:"MessageActions",components:{SvgIcon:mt,EmojiPickerContainer:On},directives:{clickOutside:Vr},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},messageActions:{type:Array,required:!0},showReactionEmojis:{type:Boolean,required:!0},messageHover:{type:Boolean,required:!0},hoverMessageId:{type:[String,Number],default:null},hoverAudioProgress:{type:Boolean,required:!0}},emits:["update-emoji-opened","update-options-opened","update-message-hover","message-action-handler","send-message-reaction"],data(){return{menuOptionsTop:0,optionsOpened:!1,optionsClosing:!1,emojiOpened:!1}},computed:{isMessageActions(){return this.filteredMessageActions.length&&this.messageHover&&!this.message.deleted&&!this.message.disableActions&&!this.hoverAudioProgress},isMessageReactions(){return this.showReactionEmojis&&this.messageHover&&!this.message.deleted&&!this.message.disableReactions&&!this.hoverAudioProgress},filteredMessageActions(){return this.message.senderId===this.currentUserId?this.messageActions:this.messageActions.filter(e=>!e.onlyMe)}},watch:{emojiOpened(e){this.$emit("update-emoji-opened",e),e&&(this.optionsOpened=!1)},optionsOpened(e){this.$emit("update-options-opened",e)}},methods:{openOptions(){this.optionsClosing||(this.optionsOpened=!this.optionsOpened,this.optionsOpened&&setTimeout(()=>{const e=document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer");if(!e||!this.$refs.menuOptions||!this.$refs.actionIcon)return;const t=this.$refs.menuOptions.getBoundingClientRect().height,a=this.$refs.actionIcon.getBoundingClientRect().top;e.getBoundingClientRect().top-a>t+50?this.menuOptionsTop=30:this.menuOptionsTop=-t}))},closeOptions(){this.optionsOpened=!1,this.optionsClosing=!0,this.updateMessageHover(),setTimeout(()=>this.optionsClosing=!1,100)},openEmoji(){this.emojiOpened=!this.emojiOpened},closeEmoji(){this.emojiOpened=!1,this.updateMessageHover()},updateMessageHover(){this.hoverMessageId!==this.message._id&&this.$emit("update-message-hover",!1)},messageActionHandler(e){this.closeOptions(),this.$emit("message-action-handler",e)},sendMessageReaction(e,t){this.$emit("send-message-reaction",{emoji:e,reaction:t}),this.closeEmoji()}}},_2={class:"vac-message-actions-wrapper"},p2={key:"3"},v2={class:"vac-menu-list"},g2=["onClick"];function b2(e,t,a,n,d,o){const k=r.resolveComponent("svg-icon"),C=r.resolveComponent("emoji-picker-container"),L=r.resolveDirective("click-outside");return r.openBlock(),r.createElementBlock("div",_2,[r.createElementVNode("div",{class:"vac-options-container",style:r.normalizeStyle({display:a.hoverAudioProgress?"none":"initial",width:o.filteredMessageActions.length&&a.showReactionEmojis?"70px":"45px"})},[r.createVNode(r.TransitionGroup,{name:"vac-slide-left",tag:"span"},{default:r.withCtx(()=>[o.isMessageActions||o.isMessageReactions?(r.openBlock(),r.createElementBlock("div",{key:"1",class:r.normalizeClass(["vac-blur-container",{"vac-options-me":a.message.senderId===a.currentUserId}])},null,2)):r.createCommentVNode("",!0),o.isMessageActions?(r.openBlock(),r.createElementBlock("div",{ref:"actionIcon",key:"2",class:"vac-svg-button vac-message-options",onClick:t[0]||(t[0]=(...b)=>o.openOptions&&o.openOptions(...b))},[r.renderSlot(e.$slots,"dropdown-icon_"+a.message._id,{},()=>[r.createVNode(k,{name:"dropdown",param:"message"})])],512)):r.createCommentVNode("",!0),o.isMessageReactions?r.withDirectives((r.openBlock(),r.createElementBlock("div",p2,[r.renderSlot(e.$slots,"emoji-picker",r.mergeProps({emojiOpened:d.emojiOpened},{addEmoji:o.sendMessageReaction}),()=>[r.createVNode(C,{class:"vac-message-emojis",style:r.normalizeStyle({right:o.isMessageActions?"30px":"5px"}),"emoji-opened":d.emojiOpened,"emoji-reaction":!0,"position-right":a.message.senderId===a.currentUserId,"message-id":a.message._id,onAddEmoji:o.sendMessageReaction,onOpenEmoji:o.openEmoji},r.createSlots({_:2},[r.renderList(e.$slots,(b,E)=>({name:E,fn:r.withCtx(h=>[r.renderSlot(e.$slots,E,r.normalizeProps(r.guardReactiveProps(h)))])}))]),1032,["style","emoji-opened","position-right","message-id","onAddEmoji","onOpenEmoji"])])])),[[L,o.closeEmoji]]):r.createCommentVNode("",!0)]),_:3})],4),o.filteredMessageActions.length?(r.openBlock(),r.createBlock(r.Transition,{key:0,name:a.message.senderId===a.currentUserId?"vac-slide-left":"vac-slide-right"},{default:r.withCtx(()=>[d.optionsOpened?r.withDirectives((r.openBlock(),r.createElementBlock("div",{key:0,ref:"menuOptions",class:r.normalizeClass(["vac-menu-options",{"vac-menu-left":a.message.senderId!==a.currentUserId}]),style:r.normalizeStyle({top:`${d.menuOptionsTop}px`})},[r.createElementVNode("div",v2,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(o.filteredMessageActions,b=>(r.openBlock(),r.createElementBlock("div",{key:b.name},[r.createElementVNode("div",{class:"vac-menu-item",onClick:E=>o.messageActionHandler(b)},r.toDisplayString(b.title),9,g2)]))),128))])],6)),[[L,o.closeOptions]]):r.createCommentVNode("",!0)]),_:1},8,["name"])):r.createCommentVNode("",!0)])}var y2=Ye(f2,[["render",b2]]);const x2={name:"MessageReactions",props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0}},emits:["send-message-reaction"],methods:{sendMessageReaction(e,t){this.$emit("send-message-reaction",{emoji:e,reaction:t})}}},w2=["onClick"];function k2(e,t,a,n,d,o){return a.message.deleted?r.createCommentVNode("",!0):(r.openBlock(),r.createBlock(r.TransitionGroup,{key:0,name:"vac-slide-left",tag:"span"},{default:r.withCtx(()=>[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.message.reactions,(k,C)=>r.withDirectives((r.openBlock(),r.createElementBlock("button",{key:C+0,class:r.normalizeClass(["vac-button-reaction",{"vac-reaction-me":k.indexOf(a.currentUserId)!==-1}]),style:r.normalizeStyle({float:a.message.senderId===a.currentUserId?"right":"left"}),onClick:L=>o.sendMessageReaction({unicode:C},k)},[r.createTextVNode(r.toDisplayString(C),1),r.createElementVNode("span",null,r.toDisplayString(k.length),1)],14,w2)),[[r.vShow,k.length]])),128))]),_:1}))}var S2=Ye(x2,[["render",k2]]);function E2(e){if(!((n,d)=>d.every(o=>{let k=!1;return(o.type[0]==="array"&&Array.isArray(n[o.key])||o.type.find(C=>C===typeof n[o.key]))&&(k=!0),k&&Js(n,o.key)}))(e,[{key:"roomId",type:["string","number"]},{key:"roomName",type:["string"]},{key:"users",type:["array"]}]))throw new Error("Rooms object is not valid! Must contain roomId[String, Number], roomName[String] and users[Array]")}function M2(e){if(!((n,d)=>d.every(o=>o.type.find(C=>C===typeof n[o.key])&&Js(n,o.key)))(e,[{key:"_id",type:["string","number"]},{key:"username",type:["string"]}]))throw new Error("Participants object is not valid! Must contain _id[String, Number] and username[String]")}function R2(e){if(!((n,d)=>d.every(o=>o.type.find(C=>C===typeof n[o.key])&&Js(n,o.key)))(e,[{key:"_id",type:["string","number"]},{key:"content",type:["string","number"]},{key:"senderId",type:["string","number"]}]))throw new Error("Messages object is not valid! Must contain _id[String, Number], content[String, Number] and senderId[String, Number]")}function Js(e,t){return Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==null&&e[t]!==void 0}const A2={name:"RoomMessage",components:{SvgIcon:mt,FormatMessage:or,AudioPlayer:zs,MessageReply:Ym,MessageFiles:u2,MessageActions:y2,MessageReactions:S2},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},index:{type:Number,required:!0},message:{type:Object,required:!0},messages:{type:Array,required:!0},editedMessageId:{type:[String,Number],default:null},roomUsers:{type:Array,default:()=>[]},messageActions:{type:Array,required:!0},newMessages:{type:Array,default:()=>[]},showReactionEmojis:{type:Boolean,required:!0},showNewMessagesDivider:{type:Boolean,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},usernameOptions:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0},selectedMessages:{type:Array,default:()=>[]}},emits:["message-added","open-file","open-user-tag","open-failed-message","message-action-handler","send-message-reaction","select-message","unselect-message"],data(){return{hoverMessageId:null,messageHover:!1,optionsOpened:!1,emojiOpened:!1,newMessage:{},progressTime:"- : -",hoverAudioProgress:!1}},computed:{showUsername(){return!this.usernameOptions.currentUser&&this.message.senderId===this.currentUserId?!1:this.roomUsers.length>=this.usernameOptions.minUsers},showDate(){return this.index>0&&this.message.date!==this.messages[this.index-1].date},messageOffset(){return this.index>0&&this.message.senderId!==this.messages[this.index-1].senderId},isMessageHover(){return this.editedMessageId===this.message._id||this.hoverMessageId===this.message._id},isAudio(){var e;return(e=this.message.files)==null?void 0:e.some(t=>Hr(t))},isCheckmarkVisible(){return this.message.senderId===this.currentUserId&&!this.message.deleted&&(this.message.saved||this.message.distributed||this.message.seen)},hasCurrentUserAvatar(){return this.messages.some(e=>e.senderId===this.currentUserId&&e.avatar)},hasSenderUserAvatar(){return this.messages.some(e=>e.senderId!==this.currentUserId&&e.avatar)},isMessageSelected(){return this.messageSelectionEnabled&&!!this.selectedMessages.find(e=>e._id===this.message._id)}},watch:{newMessages:{immediate:!0,deep:!0,handler(e){if(!e.length||!this.showNewMessagesDivider){this.newMessage={};return}this.newMessage=e.reduce((t,a)=>a.index<t.index?a:t)}},messageSelectionEnabled(){this.resetMessageHover()}},mounted(){R2(this.message),this.$emit("message-added",{message:this.message,index:this.index,ref:this.$refs.message})},methods:{onHoverMessage(){this.messageSelectionEnabled||(this.messageHover=!0,this.canEditMessage()&&(this.hoverMessageId=this.message._id))},canEditMessage(){return!this.message.deleted},onLeaveMessage(){this.messageSelectionEnabled||(!this.optionsOpened&&!this.emojiOpened&&(this.messageHover=!1),this.hoverMessageId=null)},resetMessageHover(){this.messageHover=!1,this.hoverMessageId=null},openFile(e){this.$emit("open-file",{message:this.message,file:e})},openUserTag(e){this.$emit("open-user-tag",{user:e})},messageActionHandler(e){this.resetMessageHover(),setTimeout(()=>{this.$emit("message-action-handler",{action:e,message:this.message})},300)},sendMessageReaction({emoji:e,reaction:t}){this.$emit("send-message-reaction",{messageId:this.message._id,reaction:e,remove:t&&t.indexOf(this.currentUserId)!==-1}),this.messageHover=!1},selectMessage(){this.messageSelectionEnabled&&(this.isMessageSelected?this.$emit("unselect-message",this.message._id):this.$emit("select-message",this.message))}}},T2=["id"],B2={key:0,class:"vac-card-info vac-card-date"},C2={key:1,class:"vac-line-new"},O2={key:2,class:"vac-card-info vac-card-system"},N2={key:1,class:"vac-avatar-offset"},L2={key:0,class:"vac-progress-time"},I2={class:"vac-text-timestamp"},j2={key:0,class:"vac-icon-edited"},V2={key:1},H2=[r.createElementVNode("div",{class:"vac-failure-text"},"!",-1)],P2={key:3,class:"vac-avatar-current-offset"};function F2(e,t,a,n,d,o){const k=r.resolveComponent("format-message"),C=r.resolveComponent("message-reply"),L=r.resolveComponent("message-files"),b=r.resolveComponent("audio-player"),E=r.resolveComponent("svg-icon"),h=r.resolveComponent("message-actions"),R=r.resolveComponent("message-reactions");return r.openBlock(),r.createElementBlock("div",{id:a.message._id,ref:"message",class:"vac-message-wrapper"},[o.showDate?(r.openBlock(),r.createElementBlock("div",B2,r.toDisplayString(a.message.date),1)):r.createCommentVNode("",!0),d.newMessage._id===a.message._id?(r.openBlock(),r.createElementBlock("div",C2,r.toDisplayString(a.textMessages.NEW_MESSAGES),1)):r.createCommentVNode("",!0),a.message.system?(r.openBlock(),r.createElementBlock("div",O2,[r.renderSlot(e.$slots,"message_"+a.message._id,{},()=>[r.createVNode(k,{"message-id":a.message._id,content:a.message.content,deleted:!!a.message.deleted,users:a.roomUsers,"text-messages":a.textMessages,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onOpenUserTag:o.openUserTag},r.createSlots({_:2},[r.renderList(e.$slots,(w,s)=>({name:s,fn:r.withCtx(F=>[r.renderSlot(e.$slots,s,r.normalizeProps(r.guardReactiveProps(F)))])}))]),1032,["message-id","content","deleted","users","text-messages","text-formatting","link-options","onOpenUserTag"])])])):(r.openBlock(),r.createElementBlock("div",{key:3,class:r.normalizeClass(["vac-message-box",{"vac-offset-current":a.message.senderId===a.currentUserId}]),onClick:t[8]||(t[8]=(...w)=>o.selectMessage&&o.selectMessage(...w))},[r.renderSlot(e.$slots,"message_"+a.message._id,{},()=>[a.message.avatar&&a.message.senderId!==a.currentUserId?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-avatar",style:r.normalizeStyle({"background-image":`url('${a.message.avatar}')`})},null,4)):r.createCommentVNode("",!0),o.hasSenderUserAvatar&&!a.message.avatar?(r.openBlock(),r.createElementBlock("div",N2)):r.createCommentVNode("",!0),r.createElementVNode("div",{class:r.normalizeClass(["vac-message-container",{"vac-message-container-offset":o.messageOffset}])},[r.createElementVNode("div",{class:r.normalizeClass(["vac-message-card",{"vac-message-highlight":o.isMessageHover,"vac-message-current":a.message.senderId===a.currentUserId,"vac-message-deleted":a.message.deleted,"vac-item-clickable":a.messageSelectionEnabled,"vac-message-selected":o.isMessageSelected}]),onMouseover:t[5]||(t[5]=(...w)=>o.onHoverMessage&&o.onHoverMessage(...w)),onMouseleave:t[6]||(t[6]=(...w)=>o.onLeaveMessage&&o.onLeaveMessage(...w))},[o.showUsername?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-text-username",{"vac-username-reply":!a.message.deleted&&a.message.replyMessage}])},[r.createElementVNode("span",null,r.toDisplayString(a.message.username),1)],2)):r.createCommentVNode("",!0),!a.message.deleted&&a.message.replyMessage?(r.openBlock(),r.createBlock(C,{key:1,message:a.message,"room-users":a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions},r.createSlots({_:2},[r.renderList(e.$slots,(w,s)=>({name:s,fn:r.withCtx(F=>[r.renderSlot(e.$slots,s,r.normalizeProps(r.guardReactiveProps(F)))])}))]),1032,["message","room-users","text-formatting","link-options"])):!!a.message.deleted||!a.message.files||!a.message.files.length?(r.openBlock(),r.createBlock(k,{key:2,"message-id":a.message._id,content:a.message.content,deleted:!!a.message.deleted,users:a.roomUsers,"text-formatting":a.textFormatting,"text-messages":a.textMessages,"link-options":a.linkOptions,onOpenUserTag:o.openUserTag},r.createSlots({_:2},[r.renderList(e.$slots,(w,s)=>({name:s,fn:r.withCtx(F=>[r.renderSlot(e.$slots,s,r.normalizeProps(r.guardReactiveProps(F)))])}))]),1032,["message-id","content","deleted","users","text-formatting","text-messages","link-options","onOpenUserTag"])):!o.isAudio||a.message.files.length>1?(r.openBlock(),r.createBlock(L,{key:3,"current-user-id":a.currentUserId,message:a.message,"room-users":a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"message-selection-enabled":a.messageSelectionEnabled,onOpenFile:o.openFile,onOpenUserTag:o.openUserTag},r.createSlots({_:2},[r.renderList(e.$slots,(w,s)=>({name:s,fn:r.withCtx(F=>[r.renderSlot(e.$slots,s,r.normalizeProps(r.guardReactiveProps(F)))])}))]),1032,["current-user-id","message","room-users","text-formatting","link-options","message-selection-enabled","onOpenFile","onOpenUserTag"])):(r.openBlock(),r.createElementBlock(r.Fragment,{key:4},[r.createVNode(b,{"message-id":a.message._id,src:a.message.files[0].url,"message-selection-enabled":a.messageSelectionEnabled,onUpdateProgressTime:t[0]||(t[0]=w=>d.progressTime=w),onHoverAudioProgress:t[1]||(t[1]=w=>d.hoverAudioProgress=w)},r.createSlots({_:2},[r.renderList(e.$slots,(w,s)=>({name:s,fn:r.withCtx(F=>[r.renderSlot(e.$slots,s,r.normalizeProps(r.guardReactiveProps(F)))])}))]),1032,["message-id","src","message-selection-enabled"]),a.message.deleted?r.createCommentVNode("",!0):(r.openBlock(),r.createElementBlock("div",L2,r.toDisplayString(d.progressTime),1))],64)),r.createElementVNode("div",I2,[a.message.edited&&!a.message.deleted?(r.openBlock(),r.createElementBlock("div",j2,[r.renderSlot(e.$slots,"pencil-icon_"+a.message._id,{},()=>[r.createVNode(E,{name:"pencil"})])])):r.createCommentVNode("",!0),r.createElementVNode("span",null,r.toDisplayString(a.message.timestamp),1),o.isCheckmarkVisible?(r.openBlock(),r.createElementBlock("span",V2,[r.renderSlot(e.$slots,"checkmark-icon_"+a.message._id,{},()=>[r.createVNode(E,{name:a.message.distributed?"double-checkmark":"checkmark",param:a.message.seen?"seen":"",class:"vac-icon-check"},null,8,["name","param"])])])):r.createCommentVNode("",!0)]),r.createVNode(h,{"current-user-id":a.currentUserId,message:a.message,"message-actions":a.messageActions,"show-reaction-emojis":a.showReactionEmojis,"message-hover":d.messageHover,"hover-message-id":d.hoverMessageId,"hover-audio-progress":d.hoverAudioProgress,onUpdateMessageHover:t[2]||(t[2]=w=>d.messageHover=w),onUpdateOptionsOpened:t[3]||(t[3]=w=>d.optionsOpened=w),onUpdateEmojiOpened:t[4]||(t[4]=w=>d.emojiOpened=w),onMessageActionHandler:o.messageActionHandler,onSendMessageReaction:o.sendMessageReaction},r.createSlots({_:2},[r.renderList(e.$slots,(w,s)=>({name:s,fn:r.withCtx(F=>[r.renderSlot(e.$slots,s,r.normalizeProps(r.guardReactiveProps(F)))])}))]),1032,["current-user-id","message","message-actions","show-reaction-emojis","message-hover","hover-message-id","hover-audio-progress","onMessageActionHandler","onSendMessageReaction"])],34),r.createVNode(R,{"current-user-id":a.currentUserId,message:a.message,onSendMessageReaction:o.sendMessageReaction},null,8,["current-user-id","message","onSendMessageReaction"])],2),r.renderSlot(e.$slots,"message-failure_"+a.message._id,{},()=>[a.message.failure&&a.message.senderId===a.currentUserId?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-failure-container vac-svg-button",{"vac-failure-container-avatar":a.message.avatar&&a.message.senderId===a.currentUserId}]),onClick:t[7]||(t[7]=w=>e.$emit("open-failed-message",{message:a.message}))},H2,2)):r.createCommentVNode("",!0)]),a.message.avatar&&a.message.senderId===a.currentUserId?(r.openBlock(),r.createElementBlock("div",{key:2,class:"vac-avatar vac-avatar-current",style:r.normalizeStyle({"background-image":`url('${a.message.avatar}')`})},null,4)):r.createCommentVNode("",!0),o.hasCurrentUserAvatar&&!a.message.avatar?(r.openBlock(),r.createElementBlock("div",P2)):r.createCommentVNode("",!0)])],2))],8,T2)}var D2=Ye(A2,[["render",F2]]);const U2={name:"ChatRoom",components:{Loader:Rr,SvgIcon:mt,RoomHeader:q0,RoomFooter:Om,RoomMessage:D2},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},singleRoom:{type:Boolean,required:!0},showRoomsList:{type:Boolean,required:!0},isMobile:{type:Boolean,required:!0},rooms:{type:Array,required:!0},roomId:{type:[String,Number],required:!0},loadFirstRoom:{type:Boolean,required:!0},messages:{type:Array,required:!0},roomMessage:{type:String,default:null},messagesLoaded:{type:Boolean,required:!0},menuActions:{type:Array,required:!0},messageActions:{type:Array,required:!0},messageSelectionActions:{type:Array,required:!0},autoScroll:{type:Object,required:!0},showSendIcon:{type:Boolean,required:!0},showFiles:{type:Boolean,required:!0},showAudio:{type:Boolean,required:!0},audioBitRate:{type:Number,required:!0},audioSampleRate:{type:Number,required:!0},showEmojis:{type:Boolean,required:!0},showReactionEmojis:{type:Boolean,required:!0},showNewMessagesDivider:{type:Boolean,required:!0},showFooter:{type:Boolean,required:!0},acceptedFiles:{type:String,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},loadingRooms:{type:Boolean,required:!0},roomInfoEnabled:{type:Boolean,required:!0},textareaActionEnabled:{type:Boolean,required:!0},textareaAutoFocus:{type:Boolean,required:!0},userTagsEnabled:{type:Boolean,required:!0},emojisSuggestionEnabled:{type:Boolean,required:!0},scrollDistance:{type:Number,required:!0},templatesText:{type:Array,default:null},usernameOptions:{type:Object,required:!0}},emits:["toggle-rooms-list","room-info","menu-action-handler","message-selection-action-handler","edit-message","send-message","delete-message","message-action-handler","fetch-messages","send-message-reaction","typing-message","open-file","open-user-tag","open-failed-message","textarea-action-handler"],data(){return{editedMessageId:null,initReplyMessage:null,initEditMessage:null,infiniteState:null,loadingMessages:!1,observer:null,showLoader:!0,loadingMoreMessages:!1,scrollIcon:!1,scrollMessagesCount:0,newMessages:[],messageSelectionEnabled:!1,selectedMessages:[]}},computed:{room(){return this.rooms.find(e=>e.roomId===this.roomId)||{}},showNoMessages(){return this.roomId&&!this.messages.length&&!this.loadingMessages&&!this.loadingRooms},showNoRoom(){const e=!this.rooms.length&&!this.loadingRooms||!this.roomId&&!this.loadFirstRoom;return e&&this.updateLoadingMessages(!1),e},showMessagesStarted(){return this.messages.length&&this.messagesLoaded}},watch:{roomId(){this.onRoomChanged()},messages:{deep:!0,handler(e,t){e.forEach((a,n)=>{this.showNewMessagesDivider&&!a.seen&&a.senderId!==this.currentUserId&&this.newMessages.push({_id:a._id,index:n})}),(t==null?void 0:t.length)===(e==null?void 0:e.length)-1&&(this.newMessages=[]),this.infiniteState&&this.infiniteState.loaded(),setTimeout(()=>this.loadingMoreMessages=!1)}},messagesLoaded(e){e&&this.updateLoadingMessages(!1),this.infiniteState&&this.infiniteState.complete()}},mounted(){this.newMessages=[]},methods:{updateLoadingMessages(e){this.loadingMessages=e,e?this.infiniteState=null:(this.infiniteState&&this.infiniteState.loaded(),setTimeout(()=>this.initIntersectionObserver()))},initIntersectionObserver(){this.observer&&(this.showLoader=!0,this.observer.disconnect());const e=document.querySelector("vue-advanced-chat").shadowRoot.getElementById("infinite-loader-messages");if(e){const t={root:document.querySelector("vue-advanced-chat").shadowRoot.getElementById("messages-list"),rootMargin:`${this.scrollDistance}px`,threshold:0};this.observer=new IntersectionObserver(a=>{a[0].isIntersecting&&this.loadMoreMessages()},t),this.observer.observe(e)}},preventTopScroll(){const e=this.$refs.scrollContainer,t=e.scrollHeight,a=new ResizeObserver(d=>{e.scrollHeight!==t&&this.$refs.scrollContainer&&(this.$refs.scrollContainer.scrollTo({top:e.scrollHeight-t}),a.disconnect())});for(var n=0;n<e.children.length;n++)a.observe(e.children[n])},touchStart(e){if(!this.singleRoom&&e.changedTouches.length===1){const t=e.changedTouches[0].clientX,a=e.changedTouches[0].clientY;addEventListener("touchend",n=>this.touchEnd(n,t,a),{once:!0})}},touchEnd(e,t,a){if(e.changedTouches.length===1){const n=e.changedTouches[0].clientX,d=e.changedTouches[0].clientY,o=n-t>100,k=Math.abs(d-a)>50;o&&!k&&this.$emit("toggle-rooms-list")}},onRoomChanged(){this.updateLoadingMessages(!0),this.scrollIcon=!1,this.scrollMessagesCount=0,this.resetMessageSelection();const e=this.$watch(()=>this.messages,t=>{if(!t||!t.length)return;const a=this.$refs.scrollContainer;!a||(e(),setTimeout(()=>{a.scrollTo({top:a.scrollHeight}),this.updateLoadingMessages(!1)}))})},resetMessageSelection(){this.messageSelectionEnabled=!1,this.selectedMessages=[]},selectMessage(e){this.selectedMessages.push(e)},unselectMessage(e){this.selectedMessages=this.selectedMessages.filter(t=>t._id!==e)},onMessageAdded({message:e,index:t,ref:a}){if(t!==this.messages.length-1)return;const n=a.offsetHeight+60;setTimeout(()=>{const d=this.getBottomScroll(this.$refs.scrollContainer)>n;e.senderId===this.currentUserId?d?this.autoScroll.send.newAfterScrollUp&&this.scrollToBottom():this.autoScroll.send.new&&this.scrollToBottom():d?this.autoScroll.receive.newAfterScrollUp?this.scrollToBottom():(this.scrollIcon=!0,this.scrollMessagesCount++):this.autoScroll.receive.new?this.scrollToBottom():(this.scrollIcon=!0,this.scrollMessagesCount++)})},onContainerScroll(e){if(!e.target)return;const t=this.getBottomScroll(e.target);t<60&&(this.scrollMessagesCount=0),this.scrollIcon=t>500||this.scrollMessagesCount},loadMoreMessages(){this.loadingMessages||setTimeout(()=>{if(!this.loadingMoreMessages){if(this.messagesLoaded||!this.roomId){this.loadingMoreMessages=!1,this.showLoader=!1;return}this.preventTopScroll(),this.$emit("fetch-messages"),this.loadingMoreMessages=!0}},500)},messageActionHandler({action:e,message:t}){switch(e.name){case"replyMessage":this.initReplyMessage=t;return;case"editMessage":this.initEditMessage=t;return;case"deleteMessage":return this.$emit("delete-message",t);case"selectMessages":this.selectedMessages=[t],this.messageSelectionEnabled=!0;return;default:return this.$emit("message-action-handler",{action:e,message:t})}},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",{action:e,messages:this.selectedMessages}),this.resetMessageSelection()},sendMessageReaction(e){this.$emit("send-message-reaction",e)},getBottomScroll(e){const{scrollHeight:t,clientHeight:a,scrollTop:n}=e;return t-a-n},scrollToBottom(){setTimeout(()=>{const e=this.$refs.scrollContainer;e.classList.add("vac-scroll-smooth"),e.scrollTo({top:e.scrollHeight,behavior:"smooth"}),setTimeout(()=>e.classList.remove("vac-scroll-smooth"))},50)},openFile({message:e,file:t}){this.$emit("open-file",{message:e,file:t})},openUserTag(e){this.$emit("open-user-tag",e)}}},z2={class:"vac-container-center vac-room-empty"},q2={class:"vac-messages-container"},Y2={key:0,class:"vac-text-started"},X2={key:1,class:"vac-text-started"},G2={key:0,id:"infinite-loader-messages"},K2={key:2},Z2={key:0,class:"vac-badge-counter vac-messages-count"};function W2(e,t,a,n,d,o){const k=r.resolveComponent("room-header"),C=r.resolveComponent("loader"),L=r.resolveComponent("room-message"),b=r.resolveComponent("svg-icon"),E=r.resolveComponent("room-footer");return r.withDirectives((r.openBlock(),r.createElementBlock("div",{class:"vac-col-messages",onTouchstart:t[12]||(t[12]=(...h)=>o.touchStart&&o.touchStart(...h))},[o.showNoRoom?r.renderSlot(e.$slots,"no-room-selected",{key:0},()=>[r.createElementVNode("div",z2,[r.createElementVNode("div",null,r.toDisplayString(a.textMessages.ROOM_EMPTY),1)])]):(r.openBlock(),r.createBlock(k,{key:1,"current-user-id":a.currentUserId,"text-messages":a.textMessages,"single-room":a.singleRoom,"show-rooms-list":a.showRoomsList,"is-mobile":a.isMobile,"room-info-enabled":a.roomInfoEnabled,"menu-actions":a.menuActions,room:o.room,"message-selection-enabled":d.messageSelectionEnabled,"message-selection-actions":a.messageSelectionActions,"selected-messages-total":d.selectedMessages.length,onToggleRoomsList:t[0]||(t[0]=h=>e.$emit("toggle-rooms-list")),onRoomInfo:t[1]||(t[1]=h=>e.$emit("room-info")),onMenuActionHandler:t[2]||(t[2]=h=>e.$emit("menu-action-handler",h)),onMessageSelectionActionHandler:o.messageSelectionActionHandler,onCancelMessageSelection:t[3]||(t[3]=h=>d.messageSelectionEnabled=!1)},r.createSlots({_:2},[r.renderList(e.$slots,(h,R)=>({name:R,fn:r.withCtx(w=>[r.renderSlot(e.$slots,R,r.normalizeProps(r.guardReactiveProps(w)))])}))]),1032,["current-user-id","text-messages","single-room","show-rooms-list","is-mobile","room-info-enabled","menu-actions","room","message-selection-enabled","message-selection-actions","selected-messages-total","onMessageSelectionActionHandler"])),r.createElementVNode("div",{id:"messages-list",ref:"scrollContainer",class:"vac-container-scroll",onScroll:t[5]||(t[5]=(...h)=>o.onContainerScroll&&o.onContainerScroll(...h))},[r.createVNode(C,{show:d.loadingMessages,type:"messages"},r.createSlots({_:2},[r.renderList(e.$slots,(h,R)=>({name:R,fn:r.withCtx(w=>[r.renderSlot(e.$slots,R,r.normalizeProps(r.guardReactiveProps(w)))])}))]),1032,["show"]),r.createElementVNode("div",q2,[r.createElementVNode("div",{class:r.normalizeClass({"vac-messages-hidden":d.loadingMessages})},[r.createVNode(r.Transition,{name:"vac-fade-message"},{default:r.withCtx(()=>[r.createElementVNode("div",null,[o.showNoMessages?(r.openBlock(),r.createElementBlock("div",Y2,[r.renderSlot(e.$slots,"messages-empty",{},()=>[r.createTextVNode(r.toDisplayString(a.textMessages.MESSAGES_EMPTY),1)])])):r.createCommentVNode("",!0),o.showMessagesStarted?(r.openBlock(),r.createElementBlock("div",X2,r.toDisplayString(a.textMessages.CONVERSATION_STARTED)+" "+r.toDisplayString(a.messages[0].date),1)):r.createCommentVNode("",!0)])]),_:3}),a.messages.length&&!a.messagesLoaded?(r.openBlock(),r.createElementBlock("div",G2,[r.createVNode(C,{show:!0,infinite:!0,type:"infinite-messages"},r.createSlots({_:2},[r.renderList(e.$slots,(h,R)=>({name:R,fn:r.withCtx(w=>[r.renderSlot(e.$slots,R,r.normalizeProps(r.guardReactiveProps(w)))])}))]),1024)])):r.createCommentVNode("",!0),(r.openBlock(),r.createBlock(r.TransitionGroup,{key:a.roomId,name:"vac-fade-message",tag:"span"},{default:r.withCtx(()=>[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.messages,(h,R)=>(r.openBlock(),r.createElementBlock("div",{key:h.indexId||h._id},[r.createVNode(L,{"current-user-id":a.currentUserId,message:h,index:R,messages:a.messages,"edited-message-id":d.editedMessageId,"message-actions":a.messageActions,"room-users":o.room.users,"text-messages":a.textMessages,"new-messages":d.newMessages,"show-reaction-emojis":a.showReactionEmojis,"show-new-messages-divider":a.showNewMessagesDivider,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"username-options":a.usernameOptions,"message-selection-enabled":d.messageSelectionEnabled,"selected-messages":d.selectedMessages,onMessageAdded:o.onMessageAdded,onMessageActionHandler:o.messageActionHandler,onOpenFile:o.openFile,onOpenUserTag:o.openUserTag,onOpenFailedMessage:t[4]||(t[4]=w=>e.$emit("open-failed-message",w)),onSendMessageReaction:o.sendMessageReaction,onSelectMessage:o.selectMessage,onUnselectMessage:o.unselectMessage},r.createSlots({_:2},[r.renderList(e.$slots,(w,s)=>({name:s,fn:r.withCtx(F=>[r.renderSlot(e.$slots,s,r.normalizeProps(r.guardReactiveProps(F)))])}))]),1032,["current-user-id","message","index","messages","edited-message-id","message-actions","room-users","text-messages","new-messages","show-reaction-emojis","show-new-messages-divider","text-formatting","link-options","username-options","message-selection-enabled","selected-messages","onMessageAdded","onMessageActionHandler","onOpenFile","onOpenUserTag","onSendMessageReaction","onSelectMessage","onUnselectMessage"])]))),128))]),_:3}))],2)])],544),d.loadingMessages?r.createCommentVNode("",!0):(r.openBlock(),r.createElementBlock("div",K2,[r.createVNode(r.Transition,{name:"vac-bounce"},{default:r.withCtx(()=>[d.scrollIcon?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-icon-scroll",onClick:t[6]||(t[6]=(...h)=>o.scrollToBottom&&o.scrollToBottom(...h))},[r.createVNode(r.Transition,{name:"vac-bounce"},{default:r.withCtx(()=>[d.scrollMessagesCount?(r.openBlock(),r.createElementBlock("div",Z2,r.toDisplayString(d.scrollMessagesCount),1)):r.createCommentVNode("",!0)]),_:1}),r.renderSlot(e.$slots,"scroll-icon",{},()=>[r.createVNode(b,{name:"dropdown",param:"scroll"})])])):r.createCommentVNode("",!0)]),_:3})])),r.createVNode(E,{room:o.room,"room-id":a.roomId,"room-message":a.roomMessage,"text-messages":a.textMessages,"show-send-icon":a.showSendIcon,"show-files":a.showFiles,"show-audio":a.showAudio,"show-emojis":a.showEmojis,"show-footer":a.showFooter,"accepted-files":a.acceptedFiles,"textarea-action-enabled":a.textareaActionEnabled,"textarea-auto-focus":a.textareaAutoFocus,"user-tags-enabled":a.userTagsEnabled,"emojis-suggestion-enabled":a.emojisSuggestionEnabled,"templates-text":a.templatesText,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"audio-bit-rate":a.audioBitRate,"audio-sample-rate":a.audioSampleRate,"init-reply-message":d.initReplyMessage,"init-edit-message":d.initEditMessage,onUpdateEditedMessageId:t[7]||(t[7]=h=>d.editedMessageId=h),onEditMessage:t[8]||(t[8]=h=>e.$emit("edit-message",h)),onSendMessage:t[9]||(t[9]=h=>e.$emit("send-message",h)),onTypingMessage:t[10]||(t[10]=h=>e.$emit("typing-message",h)),onTextareaActionHandler:t[11]||(t[11]=h=>e.$emit("textarea-action-handler",h))},r.createSlots({_:2},[r.renderList(e.$slots,(h,R)=>({name:R,fn:r.withCtx(w=>[r.renderSlot(e.$slots,R,r.normalizeProps(r.guardReactiveProps(w)))])}))]),1032,["room","room-id","room-message","text-messages","show-send-icon","show-files","show-audio","show-emojis","show-footer","accepted-files","textarea-action-enabled","textarea-auto-focus","user-tags-enabled","emojis-suggestion-enabled","templates-text","text-formatting","link-options","audio-bit-rate","audio-sample-rate","init-reply-message","init-edit-message"])],544)),[[r.vShow,a.isMobile&&!a.showRoomsList||!a.isMobile||a.singleRoom]])}var Q2=Ye(U2,[["render",W2]]);const J2={name:"MediaPreview",components:{SvgIcon:mt},props:{file:{type:Object,required:!0}},emits:["close-media-preview"],computed:{isImage(){return La(this.file)},isVideo(){return ir(this.file)}},mounted(){this.$refs.modal.focus()},methods:{closeModal(){this.$emit("close-media-preview")}}},$2={key:0,class:"vac-media-preview-container"},eh={key:1,class:"vac-media-preview-container"},th={width:"100%",height:"100%",controls:"",autoplay:""},ah=["src"],rh={class:"vac-svg-button"};function sh(e,t,a,n,d,o){const k=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",{ref:"modal",tabindex:"0",class:"vac-media-preview",onClick:t[0]||(t[0]=r.withModifiers((...C)=>o.closeModal&&o.closeModal(...C),["stop"])),onKeydown:t[1]||(t[1]=r.withKeys((...C)=>o.closeModal&&o.closeModal(...C),["esc"]))},[r.createVNode(r.Transition,{name:"vac-bounce-preview",appear:""},{default:r.withCtx(()=>[o.isImage?(r.openBlock(),r.createElementBlock("div",$2,[r.createElementVNode("div",{class:"vac-image-preview",style:r.normalizeStyle({"background-image":`url('${a.file.url}')`})},null,4)])):o.isVideo?(r.openBlock(),r.createElementBlock("div",eh,[r.createElementVNode("video",th,[r.createElementVNode("source",{src:a.file.url},null,8,ah)])])):r.createCommentVNode("",!0)]),_:1}),r.createElementVNode("div",rh,[r.renderSlot(e.$slots,"preview-close-icon",{},()=>[r.createVNode(k,{name:"close-outline",param:"preview"})])])],544)}var oh=Ye(J2,[["render",sh]]),nh={ROOMS_EMPTY:"No rooms",ROOM_EMPTY:"No room selected",NEW_MESSAGES:"New Messages",MESSAGE_DELETED:"This message was deleted",MESSAGES_EMPTY:"No messages",CONVERSATION_STARTED:"Conversation started on:",TYPE_MESSAGE:"Type message",SEARCH:"Search",IS_ONLINE:"is online",LAST_SEEN:"last seen ",IS_TYPING:"is writing...",CANCEL_SELECT_MESSAGE:"Cancel"};const ih={light:{general:{color:"#0a0a0a",colorButtonClear:"#1976d2",colorButton:"#fff",backgroundColorButton:"#1976d2",backgroundInput:"#fff",colorPlaceholder:"#9ca6af",colorCaret:"#1976d2",colorSpinner:"#333",borderStyle:"1px solid #e1e4e8",backgroundScrollIcon:"#fff"},container:{border:"none",borderRadius:"4px",boxShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)"},header:{background:"#fff",colorRoomName:"#0a0a0a",colorRoomInfo:"#9ca6af"},footer:{background:"#f8f9fa",borderStyleInput:"1px solid #e1e4e8",borderInputSelected:"#1976d2",backgroundReply:"#e5e5e6",backgroundTagActive:"#e5e5e6",backgroundTag:"#f8f9fa"},content:{background:"#f8f9fa"},sidemenu:{background:"#fff",backgroundHover:"#f6f6f6",backgroundActive:"#e5effa",colorActive:"#1976d2",borderColorSearch:"#e1e5e8"},dropdown:{background:"#fff",backgroundHover:"#f6f6f6"},message:{background:"#fff",backgroundMe:"#ccf2cf",color:"#0a0a0a",colorStarted:"#9ca6af",backgroundDeleted:"#dadfe2",backgroundSelected:"#c2dcf2",colorDeleted:"#757e85",colorUsername:"#9ca6af",colorTimestamp:"#828c94",backgroundDate:"#e5effa",colorDate:"#505a62",backgroundSystem:"#e5effa",colorSystem:"#505a62",backgroundMedia:"rgba(0, 0, 0, 0.15)",backgroundReply:"rgba(0, 0, 0, 0.08)",colorReplyUsername:"#0a0a0a",colorReply:"#6e6e6e",colorTag:"#0d579c",backgroundImage:"#ddd",colorNewMessages:"#1976d2",backgroundScrollCounter:"#0696c7",colorScrollCounter:"#fff",backgroundReaction:"#eee",borderStyleReaction:"1px solid #eee",backgroundReactionHover:"#fff",borderStyleReactionHover:"1px solid #ddd",colorReactionCounter:"#0a0a0a",backgroundReactionMe:"#cfecf5",borderStyleReactionMe:"1px solid #3b98b8",backgroundReactionHoverMe:"#cfecf5",borderStyleReactionHoverMe:"1px solid #3b98b8",colorReactionCounterMe:"#0b59b3",backgroundAudioRecord:"#eb4034",backgroundAudioLine:"rgba(0, 0, 0, 0.15)",backgroundAudioProgress:"#455247",backgroundAudioProgressSelector:"#455247",colorFileExtension:"#757e85"},markdown:{background:"rgba(239, 239, 239, 0.7)",border:"rgba(212, 212, 212, 0.9)",color:"#e01e5a",colorMulti:"#0a0a0a"},room:{colorUsername:"#0a0a0a",colorMessage:"#67717a",colorTimestamp:"#a2aeb8",colorStateOnline:"#4caf50",colorStateOffline:"#9ca6af",backgroundCounterBadge:"#0696c7",colorCounterBadge:"#fff"},emoji:{background:"#fff"},icons:{search:"#9ca6af",add:"#1976d2",toggle:"#0a0a0a",menu:"#0a0a0a",close:"#9ca6af",closeImage:"#fff",file:"#1976d2",paperclip:"#1976d2",closeOutline:"#000",closePreview:"#fff",send:"#1976d2",sendDisabled:"#9ca6af",emoji:"#1976d2",emojiReaction:"rgba(0, 0, 0, 0.3)",document:"#1976d2",pencil:"#9e9e9e",checkmark:"#9e9e9e",checkmarkSeen:"#0696c7",eye:"#fff",dropdownMessage:"#fff",dropdownMessageBackground:"rgba(0, 0, 0, 0.25)",dropdownRoom:"#9e9e9e",dropdownScroll:"#0a0a0a",microphone:"#1976d2",audioPlay:"#455247",audioPause:"#455247",audioCancel:"#eb4034",audioConfirm:"#1ba65b"}},dark:{general:{color:"#fff",colorButtonClear:"#fff",colorButton:"#fff",backgroundColorButton:"#1976d2",backgroundInput:"#202223",colorPlaceholder:"#596269",colorCaret:"#fff",colorSpinner:"#fff",borderStyle:"none",backgroundScrollIcon:"#fff"},container:{border:"none",borderRadius:"4px",boxShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)"},header:{background:"#181a1b",colorRoomName:"#fff",colorRoomInfo:"#9ca6af"},footer:{background:"#131415",borderStyleInput:"none",borderInputSelected:"#1976d2",backgroundReply:"#1b1c1c",backgroundTagActive:"#1b1c1c",backgroundTag:"#131415"},content:{background:"#131415"},sidemenu:{background:"#181a1b",backgroundHover:"#202224",backgroundActive:"#151617",colorActive:"#fff",borderColorSearch:"#181a1b"},dropdown:{background:"#2a2c33",backgroundHover:"#26282e"},message:{background:"#22242a",backgroundMe:"#1f7e80",color:"#fff",colorStarted:"#9ca6af",backgroundDeleted:"#1b1c21",backgroundSelected:"#c2dcf2",colorDeleted:"#a2a5a8",colorUsername:"#b3bac9",colorTimestamp:"#ebedf2",backgroundDate:"rgba(0, 0, 0, 0.3)",colorDate:"#bec5cc",backgroundSystem:"rgba(0, 0, 0, 0.3)",colorSystem:"#bec5cc",backgroundMedia:"rgba(0, 0, 0, 0.18)",backgroundReply:"rgba(0, 0, 0, 0.18)",colorReplyUsername:"#fff",colorReply:"#d6d6d6",colorTag:"#f0c60a",backgroundImage:"#ddd",colorNewMessages:"#fff",backgroundScrollCounter:"#1976d2",colorScrollCounter:"#fff",backgroundReaction:"none",borderStyleReaction:"none",backgroundReactionHover:"#202223",borderStyleReactionHover:"none",colorReactionCounter:"#fff",backgroundReactionMe:"#4e9ad1",borderStyleReactionMe:"none",backgroundReactionHoverMe:"#4e9ad1",borderStyleReactionHoverMe:"none",colorReactionCounterMe:"#fff",backgroundAudioRecord:"#eb4034",backgroundAudioLine:"rgba(255, 255, 255, 0.15)",backgroundAudioProgress:"#b7d4d3",backgroundAudioProgressSelector:"#b7d4d3",colorFileExtension:"#a2a5a8"},markdown:{background:"rgba(239, 239, 239, 0.7)",border:"rgba(212, 212, 212, 0.9)",color:"#e01e5a",colorMulti:"#0a0a0a"},room:{colorUsername:"#fff",colorMessage:"#6c7278",colorTimestamp:"#6c7278",colorStateOnline:"#4caf50",colorStateOffline:"#596269",backgroundCounterBadge:"#1976d2",colorCounterBadge:"#fff"},emoji:{background:"#343740"},icons:{search:"#596269",add:"#fff",toggle:"#fff",menu:"#fff",close:"#9ca6af",closeImage:"#fff",file:"#1976d2",paperclip:"#fff",closeOutline:"#fff",closePreview:"#fff",send:"#fff",sendDisabled:"#646a70",emoji:"#fff",emojiReaction:"#fff",document:"#1976d2",pencil:"#ebedf2",checkmark:"#ebedf2",checkmarkSeen:"#f0d90a",eye:"#fff",dropdownMessage:"#fff",dropdownMessageBackground:"rgba(0, 0, 0, 0.25)",dropdownRoom:"#fff",dropdownScroll:"#0a0a0a",microphone:"#fff",audioPlay:"#b7d4d3",audioPause:"#b7d4d3",audioCancel:"#eb4034",audioConfirm:"#1ba65b"}}},lh=({general:e,container:t,header:a,footer:n,sidemenu:d,content:o,dropdown:k,message:C,markdown:L,room:b,emoji:E,icons:h})=>({"--chat-color":e.color,"--chat-color-button-clear":e.colorButtonClear,"--chat-color-button":e.colorButton,"--chat-bg-color-button":e.backgroundColorButton,"--chat-bg-color-input":e.backgroundInput,"--chat-color-spinner":e.colorSpinner,"--chat-color-placeholder":e.colorPlaceholder,"--chat-color-caret":e.colorCaret,"--chat-border-style":e.borderStyle,"--chat-bg-scroll-icon":e.backgroundScrollIcon,"--chat-container-border":t.border,"--chat-container-border-radius":t.borderRadius,"--chat-container-box-shadow":t.boxShadow,"--chat-header-bg-color":a.background,"--chat-header-color-name":a.colorRoomName,"--chat-header-color-info":a.colorRoomInfo,"--chat-footer-bg-color":n.background,"--chat-border-style-input":n.borderStyleInput,"--chat-border-color-input-selected":n.borderInputSelected,"--chat-footer-bg-color-reply":n.backgroundReply,"--chat-footer-bg-color-tag-active":n.backgroundTagActive,"--chat-footer-bg-color-tag":n.backgroundTag,"--chat-content-bg-color":o.background,"--chat-sidemenu-bg-color":d.background,"--chat-sidemenu-bg-color-hover":d.backgroundHover,"--chat-sidemenu-bg-color-active":d.backgroundActive,"--chat-sidemenu-color-active":d.colorActive,"--chat-sidemenu-border-color-search":d.borderColorSearch,"--chat-dropdown-bg-color":k.background,"--chat-dropdown-bg-color-hover":k.backgroundHover,"--chat-message-bg-color":C.background,"--chat-message-bg-color-me":C.backgroundMe,"--chat-message-color-started":C.colorStarted,"--chat-message-bg-color-deleted":C.backgroundDeleted,"--chat-message-bg-color-selected":C.backgroundSelected,"--chat-message-color-deleted":C.colorDeleted,"--chat-message-color-username":C.colorUsername,"--chat-message-color-timestamp":C.colorTimestamp,"--chat-message-bg-color-date":C.backgroundDate,"--chat-message-color-date":C.colorDate,"--chat-message-bg-color-system":C.backgroundSystem,"--chat-message-color-system":C.colorSystem,"--chat-message-color":C.color,"--chat-message-bg-color-media":C.backgroundMedia,"--chat-message-bg-color-reply":C.backgroundReply,"--chat-message-color-reply-username":C.colorReplyUsername,"--chat-message-color-reply-content":C.colorReply,"--chat-message-color-tag":C.colorTag,"--chat-message-bg-color-image":C.backgroundImage,"--chat-message-color-new-messages":C.colorNewMessages,"--chat-message-bg-color-scroll-counter":C.backgroundScrollCounter,"--chat-message-color-scroll-counter":C.colorScrollCounter,"--chat-message-bg-color-reaction":C.backgroundReaction,"--chat-message-border-style-reaction":C.borderStyleReaction,"--chat-message-bg-color-reaction-hover":C.backgroundReactionHover,"--chat-message-border-style-reaction-hover":C.borderStyleReactionHover,"--chat-message-color-reaction-counter":C.colorReactionCounter,"--chat-message-bg-color-reaction-me":C.backgroundReactionMe,"--chat-message-border-style-reaction-me":C.borderStyleReactionMe,"--chat-message-bg-color-reaction-hover-me":C.backgroundReactionHoverMe,"--chat-message-border-style-reaction-hover-me":C.borderStyleReactionHoverMe,"--chat-message-color-reaction-counter-me":C.colorReactionCounterMe,"--chat-message-bg-color-audio-record":C.backgroundAudioRecord,"--chat-message-bg-color-audio-line":C.backgroundAudioLine,"--chat-message-bg-color-audio-progress":C.backgroundAudioProgress,"--chat-message-bg-color-audio-progress-selector":C.backgroundAudioProgressSelector,"--chat-message-color-file-extension":C.colorFileExtension,"--chat-markdown-bg":L.background,"--chat-markdown-border":L.border,"--chat-markdown-color":L.color,"--chat-markdown-color-multi":L.colorMulti,"--chat-room-color-username":b.colorUsername,"--chat-room-color-message":b.colorMessage,"--chat-room-color-timestamp":b.colorTimestamp,"--chat-room-color-online":b.colorStateOnline,"--chat-room-color-offline":b.colorStateOffline,"--chat-room-bg-color-badge":b.backgroundCounterBadge,"--chat-room-color-badge":b.colorCounterBadge,"--chat-emoji-bg-color":E.background,"--chat-icon-color-search":h.search,"--chat-icon-color-add":h.add,"--chat-icon-color-toggle":h.toggle,"--chat-icon-color-menu":h.menu,"--chat-icon-color-close":h.close,"--chat-icon-color-close-image":h.closeImage,"--chat-icon-color-file":h.file,"--chat-icon-color-paperclip":h.paperclip,"--chat-icon-color-close-outline":h.closeOutline,"--chat-icon-color-close-preview":h.closePreview,"--chat-icon-color-send":h.send,"--chat-icon-color-send-disabled":h.sendDisabled,"--chat-icon-color-emoji":h.emoji,"--chat-icon-color-emoji-reaction":h.emojiReaction,"--chat-icon-color-document":h.document,"--chat-icon-color-pencil":h.pencil,"--chat-icon-color-checkmark":h.checkmark,"--chat-icon-color-checkmark-seen":h.checkmarkSeen,"--chat-icon-color-eye":h.eye,"--chat-icon-color-dropdown-message":h.dropdownMessage,"--chat-icon-bg-dropdown-message":h.dropdownMessageBackground,"--chat-icon-color-dropdown-room":h.dropdownRoom,"--chat-icon-color-dropdown-scroll":h.dropdownScroll,"--chat-icon-color-microphone":h.microphone,"--chat-icon-color-audio-play":h.audioPlay,"--chat-icon-color-audio-pause":h.audioPause,"--chat-icon-color-audio-cancel":h.audioCancel,"--chat-icon-color-audio-confirm":h.audioConfirm});var ch=`.vac-fade-spinner-enter-from{opacity:0}.vac-fade-spinner-enter-active{transition:opacity .8s}.vac-fade-spinner-leave-active{transition:opacity .2s;opacity:0}.vac-fade-image-enter-from{opacity:0}.vac-fade-image-enter-active{transition:opacity 1s}.vac-fade-image-leave-active{transition:opacity .5s;opacity:0}.vac-fade-message-enter-from{opacity:0}.vac-fade-message-enter-active{transition:opacity .5s}.vac-fade-message-leave-active{transition:opacity .2s;opacity:0}.vac-slide-left-enter-active,.vac-slide-right-enter-active{transition:all .3s ease;transition-property:transform,opacity}.vac-slide-left-leave-active,.vac-slide-right-leave-active{transition:all .2s cubic-bezier(1,.5,.8,1)!important;transition-property:transform,opacity}.vac-slide-left-enter-from,.vac-slide-left-leave-to{transform:translate(10px);opacity:0}.vac-slide-right-enter-from,.vac-slide-right-leave-to{transform:translate(-10px);opacity:0}.vac-slide-up-enter-active{transition:all .3s ease}.vac-slide-up-leave-active{transition:all .2s cubic-bezier(1,.5,.8,1)}.vac-slide-up-enter-from,.vac-slide-up-leave-to{transform:translateY(10px);opacity:0}.vac-bounce-enter-active{animation:vac-bounce-in .5s}.vac-bounce-leave-active{animation:vac-bounce-in .3s reverse}@keyframes vac-bounce-in{0%{transform:scale(0)}50%{transform:scale(1.05)}to{transform:scale(1)}}.vac-fade-preview-enter{opacity:0}.vac-fade-preview-enter-active{transition:opacity .1s}.vac-fade-preview-leave-active{transition:opacity .2s;opacity:0}.vac-bounce-preview-enter-active{animation:vac-bounce-image-in .4s}.vac-bounce-preview-leave-active{animation:vac-bounce-image-in .3s reverse}@keyframes vac-bounce-image-in{0%{transform:scale(.6)}to{transform:scale(1)}}.vac-menu-list{border-radius:4px;display:block;cursor:pointer;background:var(--chat-dropdown-bg-color);padding:6px 0}.vac-menu-list :hover{background:var(--chat-dropdown-bg-color-hover);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-menu-list :not(:hover){transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-menu-item{-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-ms-flex:1 1 100%;flex:1 1 100%;min-height:30px;padding:5px 16px;position:relative;white-space:nowrap;line-height:30px}.vac-menu-options{position:absolute;right:10px;top:20px;z-index:9999;min-width:150px;display:inline-block;border-radius:4px;font-size:14px;color:var(--chat-color);overflow-y:auto;overflow-x:hidden;contain:content;box-shadow:0 2px 2px -4px #0000001a,0 2px 2px 1px #0000001f,0 1px 8px 1px #0000001f}.vac-app-border{border:var(--chat-border-style)}.vac-app-border-t{border-top:var(--chat-border-style)}.vac-app-border-r{border-right:var(--chat-border-style)}.vac-app-border-b{border-bottom:var(--chat-border-style)}.vac-app-box-shadow{transition:all .5s;box-shadow:0 2px 2px -4px #0000001a,0 2px 2px 1px #0000001f,0 1px 8px 1px #0000001f}.vac-item-clickable{cursor:pointer}.vac-vertical-center{display:flex;align-items:center;height:100%}.vac-vertical-center .vac-vertical-container{width:100%;text-align:center}.vac-svg-button{max-height:30px;display:flex;cursor:pointer;transition:all .2s}.vac-svg-button:hover{transform:scale(1.1);opacity:.7}.vac-avatar{background-size:cover;background-position:center center;background-repeat:no-repeat;background-color:#ddd;height:42px;width:42px;min-height:42px;min-width:42px;margin-right:15px;border-radius:50%}.vac-blur-loading{filter:blur(3px)}.vac-badge-counter{height:13px;width:auto;min-width:13px;border-radius:50%;display:flex;align-items:center;justify-content:center;padding:3px;font-size:11px;font-weight:500}.vac-text-ellipsis{width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.vac-text-bold{font-weight:700}.vac-text-italic{font-style:italic}.vac-text-strike{text-decoration:line-through}.vac-text-underline{text-decoration:underline}.vac-text-inline-code{display:inline-block;font-size:12px;color:var(--chat-markdown-color);background:var(--chat-markdown-bg);border:1px solid var(--chat-markdown-border);border-radius:3px;margin:2px 0;padding:2px 3px}.vac-text-multiline-code{display:block;font-size:12px;color:var(--chat-markdown-color-multi);background:var(--chat-markdown-bg);border:1px solid var(--chat-markdown-border);border-radius:3px;margin:4px 0;padding:7px}.vac-text-tag{color:var(--chat-message-color-tag);cursor:pointer}.vac-file-container{display:flex;align-content:center;justify-content:center;flex-wrap:wrap;text-align:center;background:var(--chat-bg-color-input);border:var(--chat-border-style-input);border-radius:4px;padding:10px}.vac-file-container svg{height:28px;width:28px}.vac-file-container .vac-text-extension{font-size:12px;color:var(--chat-message-color-file-extension);margin-top:-2px}.vac-card-window{width:100%;display:block;max-width:100%;background:var(--chat-content-bg-color);color:var(--chat-color);overflow-wrap:break-word;white-space:normal;border:var(--chat-container-border);border-radius:var(--chat-container-border-radius);box-shadow:var(--chat-container-box-shadow);-webkit-tap-highlight-color:transparent}.vac-card-window *{font-family:inherit}.vac-card-window a{color:#0d579c;font-weight:500}.vac-card-window .vac-chat-container{height:100%;display:flex}.vac-card-window .vac-chat-container input{min-width:10px}.vac-card-window .vac-chat-container textarea,.vac-card-window .vac-chat-container input[type=text],.vac-card-window .vac-chat-container input[type=search]{-webkit-appearance:none}.vac-media-preview{position:fixed;top:0;left:0;z-index:99;width:100vw;height:100vh;display:flex;align-items:center;background-color:#000c;outline:none}.vac-media-preview .vac-media-preview-container{height:calc(100% - 140px);width:calc(100% - 80px);padding:70px 40px;margin:0 auto}.vac-media-preview .vac-image-preview{width:100%;height:100%;background-size:contain;background-repeat:no-repeat;background-position:center}.vac-media-preview .vac-svg-button{position:absolute;top:30px;right:30px;transform:scale(1.4)}@media only screen and (max-width: 768px){.vac-media-preview .vac-svg-button{top:20px;right:20px;transform:scale(1.2)}.vac-media-preview .vac-media-preview-container{width:calc(100% - 40px);padding:70px 20px}}.vac-col-messages{position:relative;height:100%;flex:1;overflow:hidden;display:flex;flex-flow:column}.vac-col-messages .vac-container-center{height:100%;width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}.vac-col-messages .vac-room-empty{font-size:14px;color:#9ca6af;font-style:italic;line-height:20px;white-space:pre-line}.vac-col-messages .vac-room-empty div{padding:0 10%}.vac-col-messages .vac-container-scroll{background:var(--chat-content-bg-color);flex:1;overflow-y:auto;margin-right:1px;margin-top:60px;-webkit-overflow-scrolling:touch}.vac-col-messages .vac-container-scroll.vac-scroll-smooth{scroll-behavior:smooth}.vac-col-messages .vac-messages-container{padding:0 5px 5px}.vac-col-messages .vac-text-started{font-size:14px;color:var(--chat-message-color-started);font-style:italic;text-align:center;margin-top:30px;margin-bottom:20px}.vac-col-messages .vac-icon-scroll{position:absolute;bottom:80px;right:20px;padding:8px;background:var(--chat-bg-scroll-icon);border-radius:50%;box-shadow:0 1px 1px -1px #0003,0 1px 1px #00000024,0 1px 2px #0000001f;display:flex;cursor:pointer;z-index:10}.vac-col-messages .vac-icon-scroll svg{height:25px;width:25px}.vac-col-messages .vac-messages-count{position:absolute;top:-8px;left:11px;background-color:var(--chat-message-bg-color-scroll-counter);color:var(--chat-message-color-scroll-counter)}.vac-col-messages .vac-messages-hidden{opacity:0}@media only screen and (max-width: 768px){.vac-col-messages .vac-container-scroll{margin-top:50px}.vac-col-messages .vac-text-started{margin-top:20px}.vac-col-messages .vac-icon-scroll{bottom:70px}}.vac-room-header{position:absolute;display:flex;align-items:center;height:64px;width:100%;z-index:10;margin-right:1px;background:var(--chat-header-bg-color);border-top-right-radius:var(--chat-container-border-radius)}.vac-room-header .vac-room-wrapper{display:flex;align-items:center;min-width:0;height:100%;width:100%;padding:0 16px}.vac-room-header .vac-toggle-button{margin-right:15px}.vac-room-header .vac-toggle-button svg{height:26px;width:26px}.vac-room-header .vac-rotate-icon{transform:rotate(180deg)!important}.vac-room-header .vac-rotate-icon-init{transform:rotate(360deg)}.vac-room-header .vac-info-wrapper,.vac-room-header .vac-room-selection{display:flex;align-items:center;min-width:0;width:100%;height:100%}.vac-room-header .vac-room-selection .vac-selection-button{padding:8px 16px;color:var(--chat-color-button);background-color:var(--chat-bg-color-button);border-radius:4px;margin-right:10px;cursor:pointer;transition:all .2s}.vac-room-header .vac-room-selection .vac-selection-button:hover{opacity:.7}.vac-room-header .vac-room-selection .vac-selection-button:active{opacity:.9}.vac-room-header .vac-room-selection .vac-selection-button .vac-selection-button-count{margin-left:6px;opacity:.9}.vac-room-header .vac-room-selection .vac-selection-cancel{display:flex;align-items:center;margin-left:auto;white-space:nowrap;color:var(--chat-color-button-clear);transition:all .2s}.vac-room-header .vac-room-selection .vac-selection-cancel:hover{opacity:.7}.vac-room-header .vac-room-name{font-size:17px;font-weight:500;line-height:22px;color:var(--chat-header-color-name)}.vac-room-header .vac-room-info{font-size:13px;line-height:18px;color:var(--chat-header-color-info)}.vac-room-header .vac-room-options{margin-left:auto}@media only screen and (max-width: 768px){.vac-room-header{height:50px}.vac-room-header .vac-room-wrapper{padding:0 10px}.vac-room-header .vac-room-name{font-size:16px;line-height:22px}.vac-room-header .vac-room-info{font-size:12px;line-height:16px}.vac-room-header .vac-avatar{height:37px;width:37px;min-height:37px;min-width:37px}}.vac-room-footer{width:100%;border-bottom-right-radius:4px;z-index:10}.vac-box-footer{display:flex;position:relative;background:var(--chat-footer-bg-color);padding:10px 8px}.vac-textarea{height:20px;width:100%;line-height:20px;overflow:hidden;outline:0;resize:none;border-radius:20px;padding:12px 16px;box-sizing:content-box;font-size:16px;background:var(--chat-bg-color-input);color:var(--chat-color);caret-color:var(--chat-color-caret);border:var(--chat-border-style-input)}.vac-textarea::placeholder{color:var(--chat-color-placeholder);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.vac-textarea-outline{border:1px solid var(--chat-border-color-input-selected);box-shadow:inset 0 0 0 1px var(--chat-border-color-input-selected)}.vac-icon-textarea,.vac-icon-textarea-left{display:flex;align-items:center}.vac-icon-textarea svg,.vac-icon-textarea .vac-wrapper,.vac-icon-textarea-left svg,.vac-icon-textarea-left .vac-wrapper{margin:0 7px}.vac-icon-textarea{margin-left:5px}.vac-icon-textarea-left{display:flex;align-items:center;margin-right:5px}.vac-icon-textarea-left svg,.vac-icon-textarea-left .vac-wrapper{margin:0 7px}.vac-icon-textarea-left .vac-icon-microphone{fill:var(--chat-icon-color-microphone);margin:0 7px}.vac-icon-textarea-left .vac-dot-audio-record{height:15px;width:15px;border-radius:50%;background-color:var(--chat-message-bg-color-audio-record);animation:vac-scaling .8s ease-in-out infinite alternate}@keyframes vac-scaling{0%{transform:scale(1);opacity:.4}to{transform:scale(1.1);opacity:1}}.vac-icon-textarea-left .vac-dot-audio-record-time{font-size:16px;color:var(--chat-color);margin-left:8px;width:45px}.vac-icon-textarea-left .vac-icon-audio-stop,.vac-icon-textarea-left .vac-icon-audio-confirm{min-height:28px;min-width:28px}.vac-icon-textarea-left .vac-icon-audio-stop svg,.vac-icon-textarea-left .vac-icon-audio-confirm svg{min-height:28px;min-width:28px}.vac-icon-textarea-left .vac-icon-audio-stop{margin-right:20px}.vac-icon-textarea-left .vac-icon-audio-stop #vac-icon-close-outline{fill:var(--chat-icon-color-audio-cancel)}.vac-icon-textarea-left .vac-icon-audio-confirm{margin-right:3px;margin-left:12px}.vac-icon-textarea-left .vac-icon-audio-confirm #vac-icon-checkmark{fill:var(--chat-icon-color-audio-confirm)}.vac-send-disabled,.vac-send-disabled svg{cursor:none!important;pointer-events:none!important;transform:none!important}@media only screen and (max-width: 768px){.vac-room-footer{width:100%}.vac-box-footer{padding:7px 2px 7px 7px}.vac-box-footer.vac-box-footer-border{border-top:var(--chat-border-style-input)}.vac-textarea{padding:7px;line-height:18px}.vac-textarea::placeholder{color:transparent}.vac-icon-textarea svg,.vac-icon-textarea .vac-wrapper,.vac-icon-textarea-left svg,.vac-icon-textarea-left .vac-wrapper{margin:0 5px!important}}.vac-emojis-container{width:calc(100% - 16px);padding:10px 8px;background:var(--chat-footer-bg-color);display:flex;align-items:center;overflow:auto}.vac-emojis-container .vac-emoji-element{padding:0 8px;font-size:30px;border-radius:4px;cursor:pointer;background:var(--chat-footer-bg-color-tag);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-emojis-container .vac-emoji-element-active{background:var(--chat-footer-bg-color-tag-active)}@media only screen and (max-width: 768px){.vac-emojis-container{width:calc(100% - 10px);padding:7px 5px}.vac-emojis-container .vac-emoji-element{padding:0 7px;font-size:26px}}.vac-reply-container{display:flex;padding:10px 10px 0;background:var(--chat-footer-bg-color);align-items:center;width:calc(100% - 20px)}.vac-reply-container .vac-reply-box{width:100%;overflow:hidden;background:var(--chat-footer-bg-color-reply);border-radius:4px;padding:8px 10px}.vac-reply-container .vac-reply-info{overflow:hidden}.vac-reply-container .vac-reply-username{color:var(--chat-message-color-reply-username);font-size:12px;line-height:15px;margin-bottom:2px}.vac-reply-container .vac-reply-content{font-size:12px;color:var(--chat-message-color-reply-content);white-space:pre-line}.vac-reply-container .vac-icon-reply{margin-left:10px}.vac-reply-container .vac-icon-reply svg{height:20px;width:20px}.vac-reply-container .vac-image-reply{max-height:100px;max-width:200px;margin:4px 10px 0 0;border-radius:4px}.vac-reply-container .vac-audio-reply{margin-right:10px}.vac-reply-container .vac-file-container{max-width:80px}@media only screen and (max-width: 768px){.vac-reply-container{padding:5px 8px;width:calc(100% - 16px)}}.vac-room-files-container{display:flex;align-items:center;padding:10px 6px 0;background:var(--chat-footer-bg-color)}.vac-room-files-container .vac-files-box{display:flex;overflow:auto;width:calc(100% - 30px)}.vac-room-files-container video{height:100px;border:var(--chat-border-style-input);border-radius:4px}.vac-room-files-container .vac-icon-close{margin-left:auto}.vac-room-files-container .vac-icon-close svg{height:20px;width:20px}@media only screen and (max-width: 768px){.vac-files-container{padding:6px 4px 4px 2px}}.vac-room-file-container{display:flex;position:relative;margin:0 4px}.vac-room-file-container .vac-message-image{position:relative;background-color:var(--chat-message-bg-color-image)!important;background-size:cover!important;background-position:center center!important;background-repeat:no-repeat!important;height:100px;width:100px;border:var(--chat-border-style-input);border-radius:4px}.vac-room-file-container .vac-file-container{height:80px;width:80px}.vac-room-file-container .vac-icon-remove{position:absolute;top:6px;left:6px;z-index:10}.vac-room-file-container .vac-icon-remove svg{height:20px;width:20px;border-radius:50%}.vac-room-file-container .vac-icon-remove:before{content:" ";position:absolute;width:100%;height:100%;background:rgba(0,0,0,.5);border-radius:50%;z-index:-1}.vac-tags-container{display:flex;flex-direction:column;align-items:center;width:100%}.vac-tags-container .vac-tags-box{display:flex;width:100%;height:54px;overflow:hidden;cursor:pointer;background:var(--chat-footer-bg-color-tag);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-tags-container .vac-tags-box-active{background:var(--chat-footer-bg-color-tag-active)}.vac-tags-container .vac-tags-info{display:flex;overflow:hidden;padding:0 20px;align-items:center}.vac-tags-container .vac-tags-avatar{height:34px;width:34px;min-height:34px;min-width:34px}.vac-tags-container .vac-tags-username{font-size:14px}@media only screen and (max-width: 768px){.vac-tags-container .vac-tags-box{height:50px}.vac-tags-container .vac-tags-info{padding:0 12px}}.vac-template-container{display:flex;flex-direction:column;align-items:center;width:100%}.vac-template-container .vac-template-box{display:flex;width:100%;height:54px;overflow:hidden;cursor:pointer;background:var(--chat-footer-bg-color-tag);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-template-container .vac-template-active{background:var(--chat-footer-bg-color-tag-active)}.vac-template-container .vac-template-info{display:flex;overflow:hidden;padding:0 20px;align-items:center}.vac-template-container .vac-template-tag{font-size:14px;font-weight:700;margin-right:10px}.vac-template-container .vac-template-text{font-size:14px}@media only screen and (max-width: 768px){.vac-template-container .vac-template-box{height:50px}.vac-template-container .vac-template-info{padding:0 12px}}.vac-rooms-container{display:flex;flex-flow:column;flex:0 0 25%;min-width:260px;max-width:500px;position:relative;background:var(--chat-sidemenu-bg-color);height:100%;border-top-left-radius:var(--chat-container-border-radius);border-bottom-left-radius:var(--chat-container-border-radius)}.vac-rooms-container.vac-rooms-container-full{flex:0 0 100%;max-width:100%}.vac-rooms-container .vac-rooms-empty{font-size:14px;color:#9ca6af;font-style:italic;text-align:center;margin:40px 0;line-height:20px;white-space:pre-line}.vac-rooms-container .vac-room-list{flex:1;position:relative;max-width:100%;cursor:pointer;padding:0 10px 5px;overflow-y:auto}.vac-rooms-container .vac-room-item{border-radius:8px;align-items:center;display:flex;flex:1 1 100%;margin-bottom:5px;padding:0 14px;position:relative;min-height:71px;transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-rooms-container .vac-room-item:hover{background:var(--chat-sidemenu-bg-color-hover)}.vac-rooms-container .vac-room-selected{color:var(--chat-sidemenu-color-active)!important;background:var(--chat-sidemenu-bg-color-active)!important}.vac-rooms-container .vac-room-selected:hover{background:var(--chat-sidemenu-bg-color-active)!important}@media only screen and (max-width: 768px){.vac-rooms-container .vac-room-list{padding:0 7px 5px}.vac-rooms-container .vac-room-item{min-height:60px;padding:0 8px}}.vac-room-container{display:flex;flex:1;align-items:center;width:100%}.vac-room-container .vac-name-container{flex:1}.vac-room-container .vac-title-container{display:flex;align-items:center;line-height:25px}.vac-room-container .vac-state-circle{width:9px;height:9px;border-radius:50%;background-color:var(--chat-room-color-offline);margin-right:6px;transition:.3s}.vac-room-container .vac-state-online{background-color:var(--chat-room-color-online)}.vac-room-container .vac-room-name{flex:1;color:var(--chat-room-color-username);font-weight:500}.vac-room-container .vac-text-date{margin-left:5px;font-size:11px;color:var(--chat-room-color-timestamp)}.vac-room-container .vac-text-last{display:flex;align-items:center;font-size:12px;line-height:19px;color:var(--chat-room-color-message)}.vac-room-container .vac-message-new{color:var(--chat-room-color-username);font-weight:500}.vac-room-container .vac-icon-check{display:flex;vertical-align:middle;height:14px;width:14px;margin-top:-2px;margin-right:2px}.vac-room-container .vac-icon-microphone{height:15px;width:15px;vertical-align:middle;margin:-3px 1px 0 -2px;fill:var(--chat-room-color-message)}.vac-room-container .vac-room-options-container{display:flex;margin-left:auto}.vac-room-container .vac-room-badge{background-color:var(--chat-room-bg-color-badge);color:var(--chat-room-color-badge);margin-left:5px}.vac-room-container .vac-list-room-options{height:19px;width:19px;align-items:center;margin-left:5px}.vac-box-empty{margin-top:10px}@media only screen and (max-width: 768px){.vac-box-empty{margin-top:7px}}.vac-box-search{position:sticky;display:flex;align-items:center;height:64px;padding:0 15px}.vac-box-search .vac-icon-search{display:flex;position:absolute;left:30px}.vac-box-search .vac-icon-search svg{width:18px;height:18px}.vac-box-search .vac-input{height:38px;width:100%;background:var(--chat-bg-color-input);color:var(--chat-color);font-size:15px;outline:0;caret-color:var(--chat-color-caret);padding:10px 10px 10px 40px;border:1px solid var(--chat-sidemenu-border-color-search);border-radius:20px}.vac-box-search .vac-input::placeholder{color:var(--chat-color-placeholder)}.vac-box-search .vac-add-icon{margin-left:auto;padding-left:10px}@media only screen and (max-width: 768px){.vac-box-search{height:58px}}.vac-message-wrapper .vac-card-info{border-radius:4px;text-align:center;margin:10px auto;font-size:12px;padding:4px;display:block;overflow-wrap:break-word;position:relative;white-space:normal;box-shadow:0 1px 1px -1px #0000001a,0 1px 1px -1px #0000001c,0 1px 2px -1px #0000001c}.vac-message-wrapper .vac-card-date{max-width:150px;font-weight:500;text-transform:uppercase;color:var(--chat-message-color-date);background-color:var(--chat-message-bg-color-date)}.vac-message-wrapper .vac-card-system{max-width:250px;padding:8px 4px;color:var(--chat-message-color-system);background-color:var(--chat-message-bg-color-system)}.vac-message-wrapper .vac-line-new{color:var(--chat-message-color-new-messages);position:relative;text-align:center;font-size:13px;padding:10px 0}.vac-message-wrapper .vac-line-new:after,.vac-message-wrapper .vac-line-new:before{border-top:1px solid var(--chat-message-color-new-messages);content:"";left:0;position:absolute;top:50%;width:calc(50% - 60px)}.vac-message-wrapper .vac-line-new:before{left:auto;right:0}.vac-message-wrapper .vac-message-box{display:flex;flex:0 0 50%;max-width:50%;justify-content:flex-start;line-height:1.4}.vac-message-wrapper .vac-avatar{height:28px;width:28px;min-height:28px;min-width:28px;margin:0 0 2px;align-self:flex-end}.vac-message-wrapper .vac-avatar-current-offset{margin-right:28px}.vac-message-wrapper .vac-avatar-offset{margin-left:28px}.vac-message-wrapper .vac-failure-container{position:relative;align-self:flex-end;height:20px;width:20px;margin:0 0 2px -4px;border-radius:50%;background-color:#f44336}.vac-message-wrapper .vac-failure-container.vac-failure-container-avatar{margin-right:6px}.vac-message-wrapper .vac-failure-container .vac-failure-text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:15px;font-weight:700}.vac-message-wrapper .vac-message-container{position:relative;padding:2px 10px;align-items:end;min-width:100px;box-sizing:content-box}.vac-message-wrapper .vac-message-container-offset{margin-top:10px}.vac-message-wrapper .vac-offset-current{margin-left:50%;justify-content:flex-end}.vac-message-wrapper .vac-message-card{background-color:var(--chat-message-bg-color);color:var(--chat-message-color);border-radius:8px;font-size:14px;padding:6px 9px 3px;white-space:pre-line;max-width:100%;-webkit-transition-property:box-shadow,opacity;transition-property:box-shadow,opacity;transition:box-shadow .28s cubic-bezier(.4,0,.2,1);will-change:box-shadow;box-shadow:0 1px 1px -1px #0000001a,0 1px 1px -1px #0000001c,0 1px 2px -1px #0000001c}.vac-message-wrapper .vac-message-highlight{box-shadow:0 1px 2px -1px #0000001a,0 1px 2px -1px #0000001c,0 1px 5px -1px #0000001c}.vac-message-wrapper .vac-message-current{background-color:var(--chat-message-bg-color-me)!important}.vac-message-wrapper .vac-message-deleted{color:var(--chat-message-color-deleted)!important;font-size:13px!important;font-style:italic!important;background-color:var(--chat-message-bg-color-deleted)!important}.vac-message-wrapper .vac-message-selected{background-color:var(--chat-message-bg-color-selected)!important;transition:background-color .2s}.vac-message-wrapper .vac-message-image{position:relative;background-color:var(--chat-message-bg-color-image)!important;background-size:cover!important;background-position:center center!important;background-repeat:no-repeat!important;height:250px;width:250px;max-width:100%;border-radius:4px;margin:4px auto 5px;transition:.4s filter linear}.vac-message-wrapper .vac-text-username{font-size:13px;color:var(--chat-message-color-username);margin-bottom:2px}.vac-message-wrapper .vac-username-reply{margin-bottom:5px}.vac-message-wrapper .vac-text-timestamp{font-size:10px;color:var(--chat-message-color-timestamp);text-align:right}.vac-message-wrapper .vac-progress-time{float:left;margin:-2px 0 0 40px;color:var(--chat-color);font-size:12px}.vac-message-wrapper .vac-icon-edited{-webkit-box-align:center;align-items:center;display:-webkit-inline-box;display:inline-flex;justify-content:center;letter-spacing:normal;line-height:1;text-indent:0;vertical-align:middle;margin:0 4px 2px}.vac-message-wrapper .vac-icon-edited svg{height:12px;width:12px}.vac-message-wrapper .vac-icon-check{height:14px;width:14px;vertical-align:middle;margin:-3px -3px 0 3px}@media only screen and (max-width: 768px){.vac-message-wrapper .vac-message-container{padding:2px 3px 1px}.vac-message-wrapper .vac-message-container-offset{margin-top:10px}.vac-message-wrapper .vac-message-box{flex:0 0 80%;max-width:80%}.vac-message-wrapper .vac-avatar{height:25px;width:25px;min-height:25px;min-width:25px;margin:0 6px 1px 0}.vac-message-wrapper .vac-avatar.vac-avatar-current{margin:0 0 1px 6px}.vac-message-wrapper .vac-avatar-current-offset{margin-right:31px}.vac-message-wrapper .vac-avatar-offset{margin-left:31px}.vac-message-wrapper .vac-failure-container{margin-left:2px}.vac-message-wrapper .vac-failure-container.vac-failure-container-avatar{margin-right:0}.vac-message-wrapper .vac-offset-current{margin-left:20%}.vac-message-wrapper .vac-progress-time{margin-left:37px}}.vac-audio-player{display:flex;margin:8px 0 5px}.vac-audio-player .vac-svg-button{max-width:18px;margin-left:7px}@media only screen and (max-width: 768px){.vac-audio-player{margin:4px 0 0}.vac-audio-player .vac-svg-button{max-width:16px;margin-left:5px}}.vac-player-bar{display:flex;align-items:center;max-width:calc(100% - 18px);margin-right:7px;margin-left:20px}.vac-player-bar .vac-player-progress{width:190px}.vac-player-bar .vac-player-progress .vac-line-container{position:relative;height:4px;border-radius:5px;background-color:var(--chat-message-bg-color-audio-line)}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-progress{position:absolute;height:inherit;background-color:var(--chat-message-bg-color-audio-progress);border-radius:inherit}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot{position:absolute;top:-5px;margin-left:-7px;height:14px;width:14px;border-radius:50%;background-color:var(--chat-message-bg-color-audio-progress-selector);transition:transform .25s}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot__active{transform:scale(1.2)}@media only screen and (max-width: 768px){.vac-player-bar{margin-right:5px}.vac-player-bar .vac-player-progress .vac-line-container{height:3px}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot{height:12px;width:12px;top:-5px;margin-left:-5px}}.vac-message-actions-wrapper .vac-options-container{position:absolute;top:2px;right:10px;height:40px;width:70px;overflow:hidden;border-top-right-radius:8px}.vac-message-actions-wrapper .vac-blur-container{position:absolute;height:100%;width:100%;left:8px;bottom:10px;background:var(--chat-message-bg-color);filter:blur(3px);border-bottom-left-radius:8px}.vac-message-actions-wrapper .vac-options-me{background:var(--chat-message-bg-color-me)}.vac-message-actions-wrapper .vac-message-options{background:var(--chat-icon-bg-dropdown-message);border-radius:50%;position:absolute;top:7px;right:7px}.vac-message-actions-wrapper .vac-message-options svg{height:17px;width:17px;padding:5px;margin:-5px}.vac-message-actions-wrapper .vac-message-emojis{position:absolute;top:6px;right:30px}.vac-message-actions-wrapper .vac-menu-options{right:15px}.vac-message-actions-wrapper .vac-menu-left{right:-118px}@media only screen and (max-width: 768px){.vac-message-actions-wrapper .vac-options-container{right:3px}.vac-message-actions-wrapper .vac-menu-left{right:-50px}}.vac-message-files-container .vac-file-wrapper{position:relative;width:fit-content}.vac-message-files-container .vac-file-wrapper .vac-file-container{height:60px;width:60px;margin:3px 0 5px;cursor:pointer;transition:all .6s}.vac-message-files-container .vac-file-wrapper .vac-file-container:hover{opacity:.85}.vac-message-files-container .vac-file-wrapper .vac-file-container svg{height:30px;width:30px}.vac-message-files-container .vac-file-wrapper .vac-file-container.vac-file-container-progress{background-color:#0000004d}.vac-message-file-container{position:relative;z-index:0}.vac-message-file-container .vac-message-image-container{cursor:pointer}.vac-message-file-container .vac-image-buttons{position:absolute;width:100%;height:100%;border-radius:4px;background:linear-gradient(to bottom,rgba(0,0,0,0) 55%,rgba(0,0,0,.02) 60%,rgba(0,0,0,.05) 65%,rgba(0,0,0,.1) 70%,rgba(0,0,0,.2) 75%,rgba(0,0,0,.3) 80%,rgba(0,0,0,.5) 85%,rgba(0,0,0,.6) 90%,rgba(0,0,0,.7) 95%,rgba(0,0,0,.8) 100%)}.vac-message-file-container .vac-image-buttons svg{height:26px;width:26px}.vac-message-file-container .vac-image-buttons .vac-button-view,.vac-message-file-container .vac-image-buttons .vac-button-download{position:absolute;bottom:6px;left:7px}.vac-message-file-container .vac-image-buttons :first-child{left:40px}.vac-message-file-container .vac-image-buttons .vac-button-view{max-width:18px;bottom:8px}.vac-message-file-container .vac-video-container{width:350px;max-width:100%;margin:4px auto 5px;cursor:pointer}.vac-message-file-container .vac-video-container video{border-radius:4px}.vac-button-reaction{display:inline-flex;align-items:center;border:var(--chat-message-border-style-reaction);outline:none;background:var(--chat-message-bg-color-reaction);border-radius:4px;margin:4px 2px 0;transition:.3s;padding:0 5px;font-size:18px;line-height:23px}.vac-button-reaction span{font-size:11px;font-weight:500;min-width:7px;color:var(--chat-message-color-reaction-counter)}.vac-button-reaction:hover{border:var(--chat-message-border-style-reaction-hover);background:var(--chat-message-bg-color-reaction-hover);cursor:pointer}.vac-button-reaction.vac-reaction-me{border:var(--chat-message-border-style-reaction-me);background:var(--chat-message-bg-color-reaction-me)}.vac-button-reaction.vac-reaction-me span{color:var(--chat-message-color-reaction-counter-me)}.vac-button-reaction.vac-reaction-me:hover{border:var(--chat-message-border-style-reaction-hover-me);background:var(--chat-message-bg-color-reaction-hover-me)}.vac-reply-message{background:var(--chat-message-bg-color-reply);border-radius:4px;margin:-1px -5px 8px;padding:8px 10px}.vac-reply-message .vac-reply-username{color:var(--chat-message-color-reply-username);font-size:12px;line-height:15px;margin-bottom:2px}.vac-reply-message .vac-image-reply-container{width:70px}.vac-reply-message .vac-image-reply-container .vac-message-image-reply{height:70px;width:70px;margin:4px auto 3px}.vac-reply-message .vac-video-reply-container{width:200px;max-width:100%}.vac-reply-message .vac-video-reply-container video{border-radius:4px}.vac-reply-message .vac-reply-content{font-size:12px;color:var(--chat-message-color-reply-content)}.vac-reply-message .vac-file-container{height:60px;width:60px}.vac-emoji-wrapper{position:relative;display:flex}.vac-emoji-wrapper .vac-emoji-reaction svg{height:19px;width:19px}.vac-emoji-wrapper .vac-emoji-picker{position:absolute;z-index:9999;bottom:32px;right:10px;width:300px;padding-top:4px;overflow:scroll;box-sizing:border-box;border-radius:.5rem;background:var(--chat-emoji-bg-color);box-shadow:0 1px 2px -2px #0000001a,0 1px 2px -1px #0000001a,0 1px 2px 1px #0000001a;scrollbar-width:none}.vac-emoji-wrapper .vac-emoji-picker::-webkit-scrollbar{display:none}.vac-emoji-wrapper .vac-emoji-picker.vac-picker-reaction{position:fixed;top:initial;right:initial}.vac-emoji-wrapper .vac-emoji-picker emoji-picker{height:100%;width:100%;--emoji-size: 1.2rem;--background: var(--chat-emoji-bg-color);--emoji-padding: .4rem;--border-color: var(--chat-sidemenu-border-color-search);--button-hover-background: var(--chat-sidemenu-bg-color-hover);--button-active-background: var(--chat-sidemenu-bg-color-hover)}.vac-format-message-wrapper .vac-format-container{display:inline}.vac-format-message-wrapper .vac-icon-deleted{height:14px;width:14px;vertical-align:middle;margin:-2px 2px 0 0;fill:var(--chat-message-color-deleted)}.vac-format-message-wrapper .vac-icon-deleted.vac-icon-deleted-room{margin:-3px 1px 0 0;fill:var(--chat-room-color-message)}.vac-format-message-wrapper .vac-image-link-container{background-color:var(--chat-message-bg-color-media);padding:8px;margin:2px auto;border-radius:4px}.vac-format-message-wrapper .vac-image-link{position:relative;background-color:var(--chat-message-bg-color-image)!important;background-size:contain;background-position:center center!important;background-repeat:no-repeat!important;height:150px;width:150px;max-width:100%;border-radius:4px;margin:0 auto}.vac-format-message-wrapper .vac-image-link-message{max-width:166px;font-size:12px}.vac-loader-wrapper.vac-container-center{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:9}.vac-loader-wrapper.vac-container-top{padding:21px}.vac-loader-wrapper.vac-container-top #vac-circle{height:20px;width:20px}.vac-loader-wrapper #vac-circle{margin:auto;height:28px;width:28px;border:3px rgba(0,0,0,.25) solid;border-top:3px var(--chat-color-spinner) solid;border-right:3px var(--chat-color-spinner) solid;border-bottom:3px var(--chat-color-spinner) solid;border-radius:50%;-webkit-animation:vac-spin 1s infinite linear;animation:vac-spin 1s infinite linear}@media only screen and (max-width: 768px){.vac-loader-wrapper #vac-circle{height:24px;width:24px}.vac-loader-wrapper.vac-container-top{padding:18px}.vac-loader-wrapper.vac-container-top #vac-circle{height:16px;width:16px}}@-webkit-keyframes vac-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@keyframes vac-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}#vac-icon-search{fill:var(--chat-icon-color-search)}#vac-icon-add{fill:var(--chat-icon-color-add)}#vac-icon-toggle{fill:var(--chat-icon-color-toggle)}#vac-icon-menu{fill:var(--chat-icon-color-menu)}#vac-icon-close{fill:var(--chat-icon-color-close)}#vac-icon-close-image{fill:var(--chat-icon-color-close-image)}#vac-icon-file{fill:var(--chat-icon-color-file)}#vac-icon-paperclip{fill:var(--chat-icon-color-paperclip)}#vac-icon-close-outline{fill:var(--chat-icon-color-close-outline)}#vac-icon-close-outline-preview{fill:var(--chat-icon-color-close-preview)}#vac-icon-send{fill:var(--chat-icon-color-send)}#vac-icon-send-disabled{fill:var(--chat-icon-color-send-disabled)}#vac-icon-emoji{fill:var(--chat-icon-color-emoji)}#vac-icon-emoji-reaction{fill:var(--chat-icon-color-emoji-reaction)}#vac-icon-document{fill:var(--chat-icon-color-document)}#vac-icon-pencil{fill:var(--chat-icon-color-pencil)}#vac-icon-checkmark,#vac-icon-double-checkmark{fill:var(--chat-icon-color-checkmark)}#vac-icon-checkmark-seen,#vac-icon-double-checkmark-seen{fill:var(--chat-icon-color-checkmark-seen)}#vac-icon-eye{fill:var(--chat-icon-color-eye)}#vac-icon-dropdown-message{fill:var(--chat-icon-color-dropdown-message)}#vac-icon-dropdown-room{fill:var(--chat-icon-color-dropdown-room)}#vac-icon-dropdown-scroll{fill:var(--chat-icon-color-dropdown-scroll)}#vac-icon-audio-play{fill:var(--chat-icon-color-audio-play)}#vac-icon-audio-pause{fill:var(--chat-icon-color-audio-pause)}.vac-progress-wrapper{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:9}.vac-progress-wrapper circle{transition:stroke-dashoffset .35s;transform:rotate(-90deg);transform-origin:50% 50%}.vac-progress-wrapper .vac-progress-content{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:-1;margin-top:-2px;background-color:#000000b3;border-radius:50%}.vac-progress-wrapper .vac-progress-content .vac-progress-text{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-weight:700;color:#fff}.vac-progress-wrapper .vac-progress-content .vac-progress-text .vac-progress-pourcent{font-size:9px;font-weight:400}
`;const dh={name:"ChatContainer",components:{RoomsList:A0,Room:Q2,MediaPreview:oh},props:{height:{type:String,default:"600px"},theme:{type:String,default:"light"},styles:{type:[Object,String],default:()=>({})},responsiveBreakpoint:{type:Number,default:900},singleRoom:{type:[Boolean,String],default:!1},roomsListOpened:{type:[Boolean,String],default:!0},textMessages:{type:[Object,String],default:()=>({})},currentUserId:{type:String,default:""},rooms:{type:[Array,String],default:()=>[]},roomsOrder:{type:String,default:"desc"},loadingRooms:{type:[Boolean,String],default:!1},roomsLoaded:{type:[Boolean,String],default:!1},roomId:{type:String,default:null},loadFirstRoom:{type:[Boolean,String],default:!0},messages:{type:[Array,String],default:()=>[]},messagesLoaded:{type:[Boolean,String],default:!1},roomActions:{type:[Array,String],default:()=>[]},menuActions:{type:[Array,String],default:()=>[]},messageActions:{type:[Array,String],default:()=>[{name:"replyMessage",title:"Reply"},{name:"editMessage",title:"Edit Message",onlyMe:!0},{name:"deleteMessage",title:"Delete Message",onlyMe:!0},{name:"selectMessages",title:"Select"}]},messageSelectionActions:{type:[Array,String],default:()=>[]},autoScroll:{type:[Object,String],default:()=>({send:{new:!0,newAfterScrollUp:!0},receive:{new:!0,newAfterScrollUp:!1}})},showSearch:{type:[Boolean,String],default:!0},showAddRoom:{type:[Boolean,String],default:!0},showSendIcon:{type:[Boolean,String],default:!0},showFiles:{type:[Boolean,String],default:!0},showAudio:{type:[Boolean,String],default:!0},audioBitRate:{type:Number,default:128},audioSampleRate:{type:Number,default:44100},showEmojis:{type:[Boolean,String],default:!0},showReactionEmojis:{type:[Boolean,String],default:!0},showNewMessagesDivider:{type:[Boolean,String],default:!0},showFooter:{type:[Boolean,String],default:!0},textFormatting:{type:[Object,String],default:()=>({disabled:!1,italic:"_",bold:"*",strike:"~",underline:"\xB0",multilineCode:"```",inlineCode:"`"})},linkOptions:{type:[Object,String],default:()=>({disabled:!1,target:"_blank",rel:null})},roomInfoEnabled:{type:[Boolean,String],default:!1},textareaActionEnabled:{type:[Boolean,String],default:!1},textareaAutoFocus:{type:[Boolean,String],default:!0},userTagsEnabled:{type:[Boolean,String],default:!0},emojisSuggestionEnabled:{type:[Boolean,String],default:!0},roomMessage:{type:String,default:""},scrollDistance:{type:Number,default:60},acceptedFiles:{type:String,default:"*"},templatesText:{type:[Array,String],default:()=>[]},mediaPreviewEnabled:{type:[Boolean,String],default:!0},usernameOptions:{type:[Object,String],default:()=>({minUsers:3,currentUser:!1})}},emits:["toggle-rooms-list","room-info","fetch-messages","send-message","edit-message","delete-message","open-file","open-user-tag","open-failed-message","menu-action-handler","message-action-handler","send-message-reaction","typing-message","textarea-action-handler","fetch-more-rooms","add-room","room-action-handler","message-selection-action-handler"],data(){return{slots:[],room:{},loadingMoreRooms:!1,showRoomsList:!0,isMobile:!1,showMediaPreview:!1,previewFile:{}}},computed:{t(){return{...nh,...this.textMessagesCasted}},cssVars(){const e=ih[this.theme],t={};return Object.keys(e).map(a=>{t[a]={...e[a],...this.stylesCasted[a]||{}}}),lh(t)},orderedRooms(){return this.roomsCasted.slice().sort((e,t)=>{const a=e.index||0,n=t.index||0;return this.roomsOrder==="asc"?a<n?-1:n<a?1:0:a>n?-1:n>a?1:0})},singleRoomCasted(){return this.castBoolean(this.singleRoom)},roomsListOpenedCasted(){return this.castBoolean(this.roomsListOpened)},loadingRoomsCasted(){return this.castBoolean(this.loadingRooms)},roomsLoadedCasted(){return this.castBoolean(this.roomsLoaded)},loadFirstRoomCasted(){return this.castBoolean(this.loadFirstRoom)},messagesLoadedCasted(){return this.castBoolean(this.messagesLoaded)},showSearchCasted(){return this.castBoolean(this.showSearch)},showAddRoomCasted(){return this.castBoolean(this.showAddRoom)},showSendIconCasted(){return this.castBoolean(this.showSendIcon)},showFilesCasted(){return this.castBoolean(this.showFiles)},showAudioCasted(){return this.castBoolean(this.showAudio)},showEmojisCasted(){return this.castBoolean(this.showEmojis)},showReactionEmojisCasted(){return this.castBoolean(this.showReactionEmojis)},showNewMessagesDividerCasted(){return this.castBoolean(this.showNewMessagesDivider)},showFooterCasted(){return this.castBoolean(this.showFooter)},roomInfoEnabledCasted(){return this.castBoolean(this.roomInfoEnabled)},textareaActionEnabledCasted(){return this.castBoolean(this.textareaActionEnabled)},textareaAutoFocusCasted(){return this.castBoolean(this.textareaAutoFocus)},userTagsEnabledCasted(){return this.castBoolean(this.userTagsEnabled)},emojisSuggestionEnabledCasted(){return this.castBoolean(this.emojisSuggestionEnabled)},mediaPreviewEnabledCasted(){return this.castBoolean(this.mediaPreviewEnabled)},roomsCasted(){return this.castArray(this.rooms)},messagesCasted(){return this.castArray(this.messages)},roomActionsCasted(){return this.castArray(this.roomActions)},menuActionsCasted(){return this.castArray(this.menuActions)},messageActionsCasted(){return this.castArray(this.messageActions)},messageSelectionActionsCasted(){return this.castArray(this.messageSelectionActions)},templatesTextCasted(){return this.castArray(this.templatesText)},stylesCasted(){return this.castObject(this.styles)},textMessagesCasted(){return this.castObject(this.textMessages)},autoScrollCasted(){return this.castObject(this.autoScroll)},textFormattingCasted(){return this.castObject(this.textFormatting)},linkOptionsCasted(){return this.castObject(this.linkOptions)},usernameOptionsCasted(){return this.castObject(this.usernameOptions)}},watch:{roomsCasted:{immediate:!0,deep:!0,handler(e,t){if((!e[0]||!e.find(a=>a.roomId===this.room.roomId))&&(this.showRoomsList=!0),!this.loadingMoreRooms&&this.loadFirstRoomCasted&&e[0]&&(!t||e.length!==t.length))if(this.roomId){const a=e.find(n=>n.roomId===this.roomId)||{};this.fetchRoom({room:a})}else!this.isMobile||this.singleRoomCasted?this.fetchRoom({room:this.orderedRooms[0]}):this.showRoomsList=!0}},loadingRoomsCasted(e){e&&(this.room={})},roomId:{immediate:!0,handler(e,t){if(e&&!this.loadingRoomsCasted&&this.roomsCasted.length){const a=this.roomsCasted.find(n=>n.roomId===e);this.fetchRoom({room:a})}else t&&!e&&(this.room={})}},room(e){!e||Object.entries(e).length===0||(E2(e),e.users.forEach(t=>{M2(t)}))},roomsListOpenedCasted(e){this.showRoomsList=e}},created(){this.updateResponsive(),window.addEventListener("resize",e=>{e.isTrusted&&this.updateResponsive()})},updated(){const e=document.querySelectorAll("[slot]");this.slots.length!==e.length&&(this.slots=e)},methods:{castBoolean(e){return e==="true"||e===!0},castArray(e){return e?Array.isArray(e)?e:JSON.parse(e):[]},castObject(e){return e?typeof e=="object"?e:JSON.parse(e):{}},updateResponsive(){this.isMobile=window.innerWidth<Number(this.responsiveBreakpoint)},toggleRoomsList(){this.showRoomsList=!this.showRoomsList,this.isMobile&&(this.room={}),this.$emit("toggle-rooms-list",{opened:this.showRoomsList})},fetchRoom({room:e}){this.room=e,this.fetchMessages({reset:!0}),this.isMobile&&(this.showRoomsList=!1)},fetchMoreRooms(){this.$emit("fetch-more-rooms")},roomInfo(){this.$emit("room-info",this.room)},addRoom(){this.$emit("add-room")},fetchMessages(e){this.$emit("fetch-messages",{room:this.room,options:e})},sendMessage(e){this.$emit("send-message",{...e,roomId:this.room.roomId})},editMessage(e){this.$emit("edit-message",{...e,roomId:this.room.roomId})},deleteMessage(e){this.$emit("delete-message",{message:e,roomId:this.room.roomId})},openFile({message:e,file:t}){this.mediaPreviewEnabledCasted&&t.action==="preview"?(this.previewFile=t.file,this.showMediaPreview=!0):this.$emit("open-file",{message:e,file:t})},openUserTag({user:e}){this.$emit("open-user-tag",{user:e})},openFailedMessage({message:e}){this.$emit("open-failed-message",{message:e,roomId:this.room.roomId})},menuActionHandler(e){this.$emit("menu-action-handler",{action:e,roomId:this.room.roomId})},roomActionHandler({action:e,roomId:t}){this.$emit("room-action-handler",{action:e,roomId:t})},messageActionHandler(e){this.$emit("message-action-handler",{...e,roomId:this.room.roomId})},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",{...e,roomId:this.room.roomId})},sendMessageReaction(e){this.$emit("send-message-reaction",{...e,roomId:this.room.roomId})},typingMessage(e){this.$emit("typing-message",{message:e,roomId:this.room.roomId})},textareaActionHandler(e){this.$emit("textarea-action-handler",{message:e,roomId:this.room.roomId})}}},mh={class:"vac-chat-container"};function hh(e,t,a,n,d,o){const k=r.resolveComponent("rooms-list"),C=r.resolveComponent("room"),L=r.resolveComponent("media-preview");return r.openBlock(),r.createElementBlock("div",{class:"vac-card-window",style:r.normalizeStyle([{height:a.height},o.cssVars])},[r.createElementVNode("div",mh,[o.singleRoomCasted?r.createCommentVNode("",!0):(r.openBlock(),r.createBlock(k,{key:0,"current-user-id":a.currentUserId,rooms:o.orderedRooms,"loading-rooms":o.loadingRoomsCasted,"rooms-loaded":o.roomsLoadedCasted,room:d.room,"room-actions":o.roomActionsCasted,"text-messages":o.t,"show-search":o.showSearchCasted,"show-add-room":o.showAddRoomCasted,"show-rooms-list":d.showRoomsList,"text-formatting":o.textFormattingCasted,"link-options":o.linkOptionsCasted,"is-mobile":d.isMobile,"scroll-distance":a.scrollDistance,onFetchRoom:o.fetchRoom,onFetchMoreRooms:o.fetchMoreRooms,onLoadingMoreRooms:t[0]||(t[0]=b=>d.loadingMoreRooms=b),onAddRoom:o.addRoom,onRoomActionHandler:o.roomActionHandler},r.createSlots({_:2},[r.renderList(d.slots,b=>({name:b.slot,fn:r.withCtx(E=>[r.renderSlot(e.$slots,b.slot,r.normalizeProps(r.guardReactiveProps(E)))])}))]),1032,["current-user-id","rooms","loading-rooms","rooms-loaded","room","room-actions","text-messages","show-search","show-add-room","show-rooms-list","text-formatting","link-options","is-mobile","scroll-distance","onFetchRoom","onFetchMoreRooms","onAddRoom","onRoomActionHandler"])),r.createVNode(C,{"current-user-id":a.currentUserId,rooms:o.roomsCasted,"room-id":d.room.roomId||"","load-first-room":o.loadFirstRoomCasted,messages:o.messagesCasted,"room-message":a.roomMessage,"messages-loaded":o.messagesLoadedCasted,"menu-actions":o.menuActionsCasted,"message-actions":o.messageActionsCasted,"message-selection-actions":o.messageSelectionActionsCasted,"auto-scroll":o.autoScrollCasted,"show-send-icon":o.showSendIconCasted,"show-files":o.showFilesCasted,"show-audio":o.showAudioCasted,"audio-bit-rate":a.audioBitRate,"audio-sample-rate":a.audioSampleRate,"show-emojis":o.showEmojisCasted,"show-reaction-emojis":o.showReactionEmojisCasted,"show-new-messages-divider":o.showNewMessagesDividerCasted,"show-footer":o.showFooterCasted,"text-messages":o.t,"single-room":o.singleRoomCasted,"show-rooms-list":d.showRoomsList,"text-formatting":o.textFormattingCasted,"link-options":o.linkOptionsCasted,"is-mobile":d.isMobile,"loading-rooms":o.loadingRoomsCasted,"room-info-enabled":o.roomInfoEnabledCasted,"textarea-action-enabled":o.textareaActionEnabledCasted,"textarea-auto-focus":o.textareaAutoFocusCasted,"user-tags-enabled":o.userTagsEnabledCasted,"emojis-suggestion-enabled":o.emojisSuggestionEnabledCasted,"scroll-distance":a.scrollDistance,"accepted-files":a.acceptedFiles,"templates-text":o.templatesTextCasted,"username-options":o.usernameOptionsCasted,onToggleRoomsList:o.toggleRoomsList,onRoomInfo:o.roomInfo,onFetchMessages:o.fetchMessages,onSendMessage:o.sendMessage,onEditMessage:o.editMessage,onDeleteMessage:o.deleteMessage,onOpenFile:o.openFile,onOpenUserTag:o.openUserTag,onOpenFailedMessage:o.openFailedMessage,onMenuActionHandler:o.menuActionHandler,onMessageActionHandler:o.messageActionHandler,onMessageSelectionActionHandler:o.messageSelectionActionHandler,onSendMessageReaction:o.sendMessageReaction,onTypingMessage:o.typingMessage,onTextareaActionHandler:o.textareaActionHandler},r.createSlots({_:2},[r.renderList(d.slots,b=>({name:b.slot,fn:r.withCtx(E=>[r.renderSlot(e.$slots,b.slot,r.normalizeProps(r.guardReactiveProps(E)))])}))]),1032,["current-user-id","rooms","room-id","load-first-room","messages","room-message","messages-loaded","menu-actions","message-actions","message-selection-actions","auto-scroll","show-send-icon","show-files","show-audio","audio-bit-rate","audio-sample-rate","show-emojis","show-reaction-emojis","show-new-messages-divider","show-footer","text-messages","single-room","show-rooms-list","text-formatting","link-options","is-mobile","loading-rooms","room-info-enabled","textarea-action-enabled","textarea-auto-focus","user-tags-enabled","emojis-suggestion-enabled","scroll-distance","accepted-files","templates-text","username-options","onToggleRoomsList","onRoomInfo","onFetchMessages","onSendMessage","onEditMessage","onDeleteMessage","onOpenFile","onOpenUserTag","onOpenFailedMessage","onMenuActionHandler","onMessageActionHandler","onMessageSelectionActionHandler","onSendMessageReaction","onTypingMessage","onTextareaActionHandler"])]),r.createVNode(r.Transition,{name:"vac-fade-preview",appear:""},{default:r.withCtx(()=>[d.showMediaPreview?(r.openBlock(),r.createBlock(L,{key:0,file:d.previewFile,onCloseMediaPreview:t[1]||(t[1]=b=>d.showMediaPreview=!1)},r.createSlots({_:2},[r.renderList(d.slots,b=>({name:b.slot,fn:r.withCtx(E=>[r.renderSlot(e.$slots,b.slot,r.normalizeProps(r.guardReactiveProps(E)))])}))]),1032,["file"])):r.createCommentVNode("",!0)]),_:3})],4)}var uh=Ye(dh,[["render",hh],["styles",[ch]]]);const li=r.defineCustomElement(uh),ci="vue-advanced-chat";function fh(){customElements.get(ci)||customElements.define(ci,li)}aa.VueAdvancedChat=li,aa.register=fh,Object.defineProperties(aa,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
