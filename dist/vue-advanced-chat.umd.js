(function(s,Fe){typeof exports=="object"&&typeof module!="undefined"?module.exports=Fe(require("vue")):typeof define=="function"&&define.amd?define(["vue"],Fe):(s=typeof globalThis!="undefined"?globalThis:s||self,s["vue-advanced-chat"]=Fe(s.Vue))})(this,function(s){"use strict";var Fe=(e,t)=>{const a=e.__vccOpts||e;for(const[o,m]of t)a[o]=m;return a};const S0={name:"AppLoader",props:{show:{type:Boolean,default:!1},infinite:{type:Boolean,default:!1}}},E0=s.createElementVNode("div",{id:"vac-circle"},null,-1);function k0(e,t,a,o,m,n){return s.openBlock(),s.createBlock(s.Transition,{name:"vac-fade-spinner",appear:""},{default:s.withCtx(()=>[a.show?(s.openBlock(),s.createElementBlock("div",{key:0,class:s.normalizeClass(["vac-loader-wrapper",{"vac-container-center":!a.infinite,"vac-container-top":a.infinite}])},[s.renderSlot(e.$slots,"spinner-icon",s.normalizeProps(s.guardReactiveProps({show:a.show,infinite:a.infinite})),()=>[E0])],2)):s.createCommentVNode("",!0)]),_:3})}var Zs=Fe(S0,[["render",k0]]);const M0={name:"SvgIcon",props:{name:{type:String,default:null},param:{type:String,default:null}},data(){return{svgItem:{search:{path:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"},add:{path:"M17,13H13V17H11V13H7V11H11V7H13V11H17M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"},toggle:{path:"M5,13L9,17L7.6,18.42L1.18,12L7.6,5.58L9,7L5,11H21V13H5M21,6V8H11V6H21M21,16V18H11V16H21Z"},menu:{path:"M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z"},close:{path:"M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z"},file:{path:"M14,17H7V15H14M17,13H7V11H17M17,9H7V7H17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z"},paperclip:{path:"M16.5,6V17.5A4,4 0 0,1 12.5,21.5A4,4 0 0,1 8.5,17.5V5A2.5,2.5 0 0,1 11,2.5A2.5,2.5 0 0,1 13.5,5V15.5A1,1 0 0,1 12.5,16.5A1,1 0 0,1 11.5,15.5V6H10V15.5A2.5,2.5 0 0,0 12.5,18A2.5,2.5 0 0,0 15,15.5V5A4,4 0 0,0 11,1A4,4 0 0,0 7,5V17.5A5.5,5.5 0 0,0 12.5,23A5.5,5.5 0 0,0 18,17.5V6H16.5Z"},"close-outline":{path:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},send:{path:"M2,21L23,12L2,3V10L17,12L2,14V21Z"},emoji:{path:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"},document:{path:"M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"},pencil:{path:"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"},checkmark:{path:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"},"double-checkmark":{path:"M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z"},eye:{path:"M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"},dropdown:{path:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"},deleted:{path:"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12C4,13.85 4.63,15.55 5.68,16.91L16.91,5.68C15.55,4.63 13.85,4 12,4M12,20A8,8 0 0,0 20,12C20,10.15 19.37,8.45 18.32,7.09L7.09,18.32C8.45,19.37 10.15,20 12,20Z"},microphone:{size:"large",path:"M432.8,216.4v39.2c0,45.2-15.3,84.3-45.2,118.4c-29.8,33.2-67.3,52.8-111.6,57.9v40.9h78.4c5.1,0,10.2,1.7,13.6,6c4.3,4.3,6,8.5,6,13.6c0,5.1-1.7,10.2-6,13.6c-4.3,4.3-8.5,6-13.6,6H157.6c-5.1,0-10.2-1.7-13.6-6c-4.3-4.3-6-8.5-6-13.6c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6H236v-40.9c-44.3-5.1-81.8-23.9-111.6-57.9s-45.2-73.3-45.2-118.4v-39.2c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6s10.2,1.7,13.6,6c4.3,4.3,6,8.5,6,13.6v39.2c0,37.5,13.6,70.7,40,97.1s59.6,40,97.1,40s70.7-13.6,97.1-40c26.4-26.4,40-59.6,40-97.1v-39.2c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6c5.1,0,10.2,1.7,13.6,6C430.2,206.2,432.8,211.3,432.8,216.4z M353.5,98v157.6c0,27.3-9.4,50.3-29,69c-19.6,19.6-42.6,29-69,29s-50.3-9.4-69-29c-19.6-19.6-29-42.6-29-69V98c0-27.3,9.4-50.3,29-69c19.6-19.6,42.6-29,69-29s50.3,9.4,69,29C344.2,47.7,353.5,71.6,353.5,98z"},"audio-play":{size:"medium",path:"M43.331,21.237L7.233,0.397c-0.917-0.529-2.044-0.529-2.96,0c-0.916,0.528-1.48,1.505-1.48,2.563v41.684   c0,1.058,0.564,2.035,1.48,2.563c0.458,0.268,0.969,0.397,1.48,0.397c0.511,0,1.022-0.133,1.48-0.397l36.098-20.84   c0.918-0.529,1.479-1.506,1.479-2.564S44.247,21.767,43.331,21.237z"},"audio-pause":{size:"medium",path:"M17.991,40.976c0,3.662-2.969,6.631-6.631,6.631l0,0c-3.662,0-6.631-2.969-6.631-6.631V6.631C4.729,2.969,7.698,0,11.36,0l0,0c3.662,0,6.631,2.969,6.631,6.631V40.976z",path2:"M42.877,40.976c0,3.662-2.969,6.631-6.631,6.631l0,0c-3.662,0-6.631-2.969-6.631-6.631V6.631C29.616,2.969,32.585,0,36.246,0l0,0c3.662,0,6.631,2.969,6.631,6.631V40.976z"}}}},computed:{svgId(){const e=this.param?"-"+this.param:"";return`vac-icon-${this.name}${e}`},size(){const e=this.svgItem[this.name];return e.size==="large"?512:e.size==="medium"?48:24}}},w0=["viewBox"],R0=["id","d"],A0=["id","d"];function T0(e,t,a,o,m,n){return s.openBlock(),s.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",width:"24",height:"24",viewBox:`0 0 ${n.size} ${n.size}`},[s.createElementVNode("path",{id:n.svgId,d:m.svgItem[a.name].path},null,8,R0),m.svgItem[a.name].path2?(s.openBlock(),s.createElementBlock("path",{key:0,id:n.svgId,d:m.svgItem[a.name].path2},null,8,A0)):s.createCommentVNode("",!0)],8,w0)}var gt=Fe(M0,[["render",T0]]);const x0={name:"RoomsSearch",components:{SvgIcon:gt},props:{textMessages:{type:Object,required:!0},showSearch:{type:Boolean,required:!0},showAddRoom:{type:Boolean,required:!0},rooms:{type:Array,required:!0},loadingRooms:{type:Boolean,required:!0}},emits:["search-room","add-room"],computed:{showSearchBar(){return this.showSearch||this.showAddRoom}}},B0={key:0,class:"vac-icon-search"},C0=["placeholder"];function O0(e,t,a,o,m,n){const M=s.resolveComponent("svg-icon");return s.openBlock(),s.createElementBlock("div",{class:s.normalizeClass({"vac-box-search":n.showSearchBar,"vac-box-empty":!n.showSearchBar})},[a.showSearch?(s.openBlock(),s.createElementBlock(s.Fragment,{key:0},[!a.loadingRooms&&a.rooms.length?(s.openBlock(),s.createElementBlock("div",B0,[s.renderSlot(e.$slots,"search-icon",{},()=>[s.createVNode(M,{name:"search"})])])):s.createCommentVNode("",!0),!a.loadingRooms&&a.rooms.length?(s.openBlock(),s.createElementBlock("input",{key:1,type:"search",placeholder:a.textMessages.SEARCH,autocomplete:"off",class:"vac-input",onInput:t[0]||(t[0]=T=>e.$emit("search-room",T))},null,40,C0)):s.createCommentVNode("",!0)],64)):s.createCommentVNode("",!0),a.showAddRoom?(s.openBlock(),s.createElementBlock("div",{key:1,class:"vac-svg-button vac-add-icon",onClick:t[1]||(t[1]=T=>e.$emit("add-room"))},[s.renderSlot(e.$slots,"add-icon",{},()=>[s.createVNode(M,{name:"add"})])])):s.createCommentVNode("",!0)],2)}var L0=Fe(x0,[["render",O0]]),pt={},Ga={};Ga.__esModule=!0,Ga.inherits=N0;function N0(e,t){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=Object.create(e.prototype);for(var m in a)o[m]=a[m];return o.constructor=t,t.prototype=o,t}var _s={};_s.__esModule=!0;var I0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},It={defaultProtocol:"http",events:null,format:Kn,formatHref:Kn,nl2br:!1,tagName:"a",target:j0,validate:!0,ignoreTags:[],attributes:null,className:"linkified"};_s.defaults=It,_s.Options=Gn,_s.contains=V0;function Gn(e){e=e||{},this.defaultProtocol=e.hasOwnProperty("defaultProtocol")?e.defaultProtocol:It.defaultProtocol,this.events=e.hasOwnProperty("events")?e.events:It.events,this.format=e.hasOwnProperty("format")?e.format:It.format,this.formatHref=e.hasOwnProperty("formatHref")?e.formatHref:It.formatHref,this.nl2br=e.hasOwnProperty("nl2br")?e.nl2br:It.nl2br,this.tagName=e.hasOwnProperty("tagName")?e.tagName:It.tagName,this.target=e.hasOwnProperty("target")?e.target:It.target,this.validate=e.hasOwnProperty("validate")?e.validate:It.validate,this.ignoreTags=[],this.attributes=e.attributes||e.linkAttributes||It.attributes,this.className=e.hasOwnProperty("className")?e.className:e.linkClass||It.className;for(var t=e.hasOwnProperty("ignoreTags")?e.ignoreTags:It.ignoreTags,a=0;a<t.length;a++)this.ignoreTags.push(t[a].toUpperCase())}Gn.prototype={resolve:function(t){var a=t.toHref(this.defaultProtocol);return{formatted:this.get("format",t.toString(),t),formattedHref:this.get("formatHref",a,t),tagName:this.get("tagName",a,t),className:this.get("className",a,t),target:this.get("target",a,t),events:this.getObject("events",a,t),attributes:this.getObject("attributes",a,t)}},check:function(t){return this.get("validate",t.toString(),t)},get:function(t,a,o){var m=void 0,n=this[t];if(!n)return n;switch(typeof n=="undefined"?"undefined":I0(n)){case"function":return n(a,o.type);case"object":return m=n.hasOwnProperty(o.type)?n[o.type]:It[t],typeof m=="function"?m(a,o.type):m}return n},getObject:function(t,a,o){var m=this[t];return typeof m=="function"?m(a,o.type):m}};function V0(e,t){for(var a=0;a<e.length;a++)if(e[a]===t)return!0;return!1}function Kn(e){return e}function j0(e,t){return t==="url"?"_blank":null}var ea={},ca={};ca.__esModule=!0,ca.stateify=ca.TokenState=ca.CharacterState=void 0;var Zn=Ga;function Pr(){return function(e){this.j=[],this.T=e||null}}var Fr=Pr();Fr.prototype={defaultTransition:!1,on:function(t,a){if(t instanceof Array){for(var o=0;o<t.length;o++)this.j.push([t[o],a]);return this}return this.j.push([t,a]),this},next:function(t){for(var a=0;a<this.j.length;a++){var o=this.j[a],m=o[0],n=o[1];if(this.test(t,m))return n}return this.defaultTransition},accepts:function(){return!!this.T},test:function(t,a){return t===a},emit:function(){return this.T}};var Dr=(0,Zn.inherits)(Fr,Pr(),{test:function(t,a){return t===a||a instanceof RegExp&&a.test(t)}}),H0=(0,Zn.inherits)(Fr,Pr(),{jump:function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=this.next(new t(""));return o===this.defaultTransition?(o=new this.constructor(a),this.on(t,o)):a&&(o.T=a),o},test:function(t,a){return t instanceof a}});function P0(e,t,a,o){for(var m=0,n=e.length,M=t,T=[],O=void 0;m<n&&(O=M.next(e[m]));)M=O,m++;if(m>=n)return[];for(;m<n-1;)O=new Dr(o),T.push(O),M.on(e[m],O),M=O,m++;return O=new Dr(a),T.push(O),M.on(e[n-1],O),T}ca.CharacterState=Dr,ca.TokenState=H0,ca.stateify=P0;var Se={},Ws={};Ws.__esModule=!0;function F0(){return function(e){e&&(this.v=e)}}Ws.createTokenClass=F0,Se.__esModule=!0,Se.AMPERSAND=Se.CLOSEPAREN=Se.CLOSEANGLEBRACKET=Se.CLOSEBRACKET=Se.CLOSEBRACE=Se.OPENPAREN=Se.OPENANGLEBRACKET=Se.OPENBRACKET=Se.OPENBRACE=Se.WS=Se.TLD=Se.SYM=Se.UNDERSCORE=Se.SLASH=Se.MAILTO=Se.PROTOCOL=Se.QUERY=Se.POUND=Se.PLUS=Se.NUM=Se.NL=Se.LOCALHOST=Se.PUNCTUATION=Se.DOT=Se.COLON=Se.AT=Se.DOMAIN=Se.Base=void 0;var Wn=Ws,D0=Ga,Ur=(0,Wn.createTokenClass)();Ur.prototype={toString:function(){return this.v+""}};function ze(e){var t=e?{v:e}:{};return(0,D0.inherits)(Ur,(0,Wn.createTokenClass)(),t)}var U0=ze(),q0=ze("@"),z0=ze(":"),X0=ze("."),Y0=ze(),G0=ze(),K0=ze(`
`),Z0=ze(),W0=ze("+"),Q0=ze("#"),$0=ze(),J0=ze("mailto:"),el=ze("?"),tl=ze("/"),al=ze("_"),sl=ze(),rl=ze(),nl=ze(),ol=ze("{"),il=ze("["),ll=ze("<"),cl=ze("("),dl=ze("}"),ml=ze("]"),hl=ze(">"),_l=ze(")"),ul=ze("&");Se.Base=Ur,Se.DOMAIN=U0,Se.AT=q0,Se.COLON=z0,Se.DOT=X0,Se.PUNCTUATION=Y0,Se.LOCALHOST=G0,Se.NL=K0,Se.NUM=Z0,Se.PLUS=W0,Se.POUND=Q0,Se.QUERY=el,Se.PROTOCOL=$0,Se.MAILTO=J0,Se.SLASH=tl,Se.UNDERSCORE=al,Se.SYM=sl,Se.TLD=rl,Se.WS=nl,Se.OPENBRACE=ol,Se.OPENBRACKET=il,Se.OPENANGLEBRACKET=ll,Se.OPENPAREN=cl,Se.CLOSEBRACE=dl,Se.CLOSEBRACKET=ml,Se.CLOSEANGLEBRACKET=hl,Se.CLOSEPAREN=_l,Se.AMPERSAND=ul,ea.__esModule=!0,ea.start=ea.run=ea.TOKENS=ea.State=void 0;var ga=ca,Le=Se,fl=vl(Le);function vl(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}var Qn="aaa|aarp|abarth|abb|abbott|abbvie|abc|able|abogado|abudhabi|ac|academy|accenture|accountant|accountants|aco|active|actor|ad|adac|ads|adult|ae|aeg|aero|aetna|af|afamilycompany|afl|africa|ag|agakhan|agency|ai|aig|aigo|airbus|airforce|airtel|akdn|al|alfaromeo|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|am|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|ao|aol|apartments|app|apple|aq|aquarelle|ar|arab|aramco|archi|army|arpa|art|arte|as|asda|asia|associates|at|athleta|attorney|au|auction|audi|audible|audio|auspost|author|auto|autos|avianca|aw|aws|ax|axa|az|azure|ba|baby|baidu|banamex|bananarepublic|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bb|bbc|bbt|bbva|bcg|bcn|bd|be|beats|beauty|beer|bentley|berlin|best|bestbuy|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|blanco|blockbuster|blog|bloomberg|blue|bm|bms|bmw|bn|bnl|bnpparibas|bo|boats|boehringer|bofa|bom|bond|boo|book|booking|boots|bosch|bostik|boston|bot|boutique|box|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|budapest|bugatti|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|calvinklein|cam|camera|camp|cancerresearch|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|cartier|casa|case|caseih|cash|casino|cat|catering|catholic|cba|cbn|cbre|cbs|cc|cd|ceb|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|chase|chat|cheap|chintai|chloe|christmas|chrome|chrysler|church|ci|cipriani|circle|cisco|citadel|citi|citic|city|cityeats|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|comcast|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cookingchannel|cool|coop|corsica|country|coupon|coupons|courses|cr|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|csc|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|data|date|dating|datsun|day|dclk|dds|de|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dj|dk|dm|dnp|do|docs|doctor|dodge|dog|doha|domains|dot|download|drive|dtv|dubai|duck|dunlop|duns|dupont|durban|dvag|dvr|dz|earth|eat|ec|eco|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epost|epson|equipment|er|ericsson|erni|es|esq|estate|esurance|et|etisalat|eu|eurovision|eus|events|everbank|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fi|fiat|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|flir|florist|flowers|fly|fm|fo|foo|food|foodnetwork|football|ford|forex|forsale|forum|foundation|fox|fr|free|fresenius|frl|frogans|frontdoor|frontier|ftr|fujitsu|fujixerox|fun|fund|furniture|futbol|fyi|ga|gal|gallery|gallo|gallup|game|games|gap|garden|gb|gbiz|gd|gdn|ge|gea|gent|genting|george|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glade|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|godaddy|gold|goldpoint|golf|goo|goodhands|goodyear|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|grocery|group|gs|gt|gu|guardian|gucci|guge|guide|guitars|guru|gw|gy|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hgtv|hiphop|hisamitsu|hitachi|hiv|hk|hkt|hm|hn|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|honeywell|horse|hospital|host|hosting|hot|hoteles|hotels|hotmail|house|how|hr|hsbc|ht|htc|hu|hughes|hyatt|hyundai|ibm|icbc|ice|icu|id|ie|ieee|ifm|ikano|il|im|imamat|imdb|immo|immobilien|in|industries|infiniti|info|ing|ink|institute|insurance|insure|int|intel|international|intuit|investments|io|ipiranga|iq|ir|irish|is|iselect|ismaili|ist|istanbul|it|itau|itv|iveco|iwc|jaguar|java|jcb|jcp|je|jeep|jetzt|jewelry|jio|jlc|jll|jm|jmp|jnj|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|juniper|kaufen|kddi|ke|kerryhotels|kerrylogistics|kerryproperties|kfh|kg|kh|ki|kia|kim|kinder|kindle|kitchen|kiwi|km|kn|koeln|komatsu|kosher|kp|kpmg|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|ladbrokes|lamborghini|lamer|lancaster|lancia|lancome|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|li|liaison|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|linde|link|lipsy|live|living|lixil|lk|loan|loans|locker|locus|loft|lol|london|lotte|lotto|love|lpl|lplfinancial|lr|ls|lt|ltd|ltda|lu|lundbeck|lupin|luxe|luxury|lv|ly|ma|macys|madrid|maif|maison|makeup|man|management|mango|map|market|marketing|markets|marriott|marshalls|maserati|mattel|mba|mc|mckinsey|md|me|med|media|meet|melbourne|meme|memorial|men|menu|meo|merckmsd|metlife|mg|mh|miami|microsoft|mil|mini|mint|mit|mitsubishi|mk|ml|mlb|mls|mm|mma|mn|mo|mobi|mobile|mobily|moda|moe|moi|mom|monash|money|monster|mopar|mormon|mortgage|moscow|moto|motorcycles|mov|movie|movistar|mp|mq|mr|ms|msd|mt|mtn|mtr|mu|museum|mutual|mv|mw|mx|my|mz|na|nab|nadex|nagoya|name|nationwide|natura|navy|nba|nc|ne|nec|net|netbank|netflix|network|neustar|new|newholland|news|next|nextdirect|nexus|nf|nfl|ng|ngo|nhk|ni|nico|nike|nikon|ninja|nissan|nissay|nl|no|nokia|northwesternmutual|norton|now|nowruz|nowtv|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|observer|off|office|okinawa|olayan|olayangroup|oldnavy|ollo|om|omega|one|ong|onl|online|onyourside|ooo|open|oracle|orange|org|organic|origins|osaka|otsuka|ott|ovh|pa|page|panasonic|panerai|paris|pars|partners|parts|party|passagens|pay|pccw|pe|pet|pf|pfizer|pg|ph|pharmacy|phd|philips|phone|photo|photography|photos|physio|piaget|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pnc|pohl|poker|politie|porn|post|pr|pramerica|praxi|press|prime|pro|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|qvc|racing|radio|raid|re|read|realestate|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|rightathome|ril|rio|rip|rmit|ro|rocher|rocks|rodeo|rogers|room|rs|rsvp|ru|rugby|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sapo|sarl|sas|save|saxo|sb|sbi|sbs|sc|sca|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scjohnson|scor|scot|sd|se|search|seat|secure|security|seek|select|sener|services|ses|seven|sew|sex|sexy|sfr|sg|sh|shangrila|sharp|shaw|shell|shia|shiksha|shoes|shop|shopping|shouji|show|showtime|shriram|si|silk|sina|singles|site|sj|sk|ski|skin|sky|skype|sl|sling|sm|smart|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|space|spiegel|spot|spreadbetting|sr|srl|srt|st|stada|staples|star|starhub|statebank|statefarm|statoil|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiftcover|swiss|sx|sy|sydney|symantec|systems|sz|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|tdk|team|tech|technology|tel|telecity|telefonica|temasek|tennis|teva|tf|tg|th|thd|theater|theatre|tiaa|tickets|tienda|tiffany|tips|tires|tirol|tj|tjmaxx|tjx|tk|tkmaxx|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tr|trade|trading|training|travel|travelchannel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubank|ubs|uconnect|ug|uk|unicom|university|uno|uol|ups|us|uy|uz|va|vacations|vana|vanguard|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|vista|vistaprint|viva|vivo|vlaanderen|vn|vodka|volkswagen|volvo|vote|voting|voto|voyage|vu|vuelos|wales|walmart|walter|wang|wanggou|warman|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|ws|wtc|wtf|xbox|xerox|xfinity|xihuan|xin|xn--11b4c3d|xn--1ck2e1b|xn--1qqw23a|xn--2scrj9c|xn--30rr7y|xn--3bst00m|xn--3ds443g|xn--3e0b707e|xn--3hcrj9c|xn--3oq18vl8pn36a|xn--3pxu8k|xn--42c2d9a|xn--45br5cyl|xn--45brj9c|xn--45q11c|xn--4gbrim|xn--54b7fta0cc|xn--55qw42g|xn--55qx5d|xn--5su34j936bgsg|xn--5tzm5g|xn--6frz82g|xn--6qq986b3xl|xn--80adxhks|xn--80ao21a|xn--80aqecdr1a|xn--80asehdb|xn--80aswg|xn--8y0a063a|xn--90a3ac|xn--90ae|xn--90ais|xn--9dbq2a|xn--9et52u|xn--9krt00a|xn--b4w605ferd|xn--bck1b9a5dre4c|xn--c1avg|xn--c2br7g|xn--cck2b3b|xn--cg4bki|xn--clchc0ea0b2g2a9gcd|xn--czr694b|xn--czrs0t|xn--czru2d|xn--d1acj3b|xn--d1alf|xn--e1a4c|xn--eckvdtc9d|xn--efvy88h|xn--estv75g|xn--fct429k|xn--fhbei|xn--fiq228c5hs|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--fjq720a|xn--flw351e|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--fzys8d69uvgm|xn--g2xx48c|xn--gckr3f0f|xn--gecrj9c|xn--gk3at1e|xn--h2breg3eve|xn--h2brj9c|xn--h2brj9c8c|xn--hxt814e|xn--i1b6b1a6a2e|xn--imr513n|xn--io0a7i|xn--j1aef|xn--j1amh|xn--j6w193g|xn--jlq61u9w7b|xn--jvr189m|xn--kcrx77d1x4a|xn--kprw13d|xn--kpry57d|xn--kpu716f|xn--kput3i|xn--l1acc|xn--lgbbat1ad8j|xn--mgb9awbf|xn--mgba3a3ejt|xn--mgba3a4f16a|xn--mgba7c0bbn0a|xn--mgbaakc7dvf|xn--mgbaam7a8h|xn--mgbab2bd|xn--mgbai9azgqp6j|xn--mgbayh7gpa|xn--mgbb9fbpob|xn--mgbbh1a|xn--mgbbh1a71e|xn--mgbc0a9azcg|xn--mgbca7dzdo|xn--mgberp4a5d4ar|xn--mgbgu82a|xn--mgbi4ecexp|xn--mgbpl2fh|xn--mgbt3dhd|xn--mgbtx2b|xn--mgbx4cd0ab|xn--mix891f|xn--mk1bu44c|xn--mxtq1m|xn--ngbc5azd|xn--ngbe9e0a|xn--ngbrx|xn--node|xn--nqv7f|xn--nqv7fs00ema|xn--nyqy26a|xn--o3cw4h|xn--ogbpf8fl|xn--p1acf|xn--p1ai|xn--pbt977c|xn--pgbs0dh|xn--pssy2u|xn--q9jyb4c|xn--qcka1pmc|xn--qxam|xn--rhqv96g|xn--rovu88b|xn--rvc1e0am3e|xn--s9brj9c|xn--ses554g|xn--t60b56a|xn--tckwe|xn--tiq49xqyj|xn--unup4y|xn--vermgensberater-ctb|xn--vermgensberatung-pwb|xn--vhquv|xn--vuq861b|xn--w4r85el8fhu5dnra|xn--w4rs40l|xn--wgbh1c|xn--wgbl6a|xn--xhq521b|xn--xkc2al3hye2a|xn--xkc2dl3a5ee0h|xn--y9a3aq|xn--yfro4i67o|xn--ygbi2ammx|xn--zfr164b|xperia|xxx|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|you|youtube|yt|yun|za|zappos|zara|zero|zip|zippo|zm|zone|zuerich|zw".split("|"),qr="0123456789".split(""),Qs="0123456789abcdefghijklmnopqrstuvwxyz".split(""),$n=[" ","\f","\r","	","\v","\xA0","\u1680","\u180E"],wt=[],Ue=function(t){return new ga.CharacterState(t)},qt=Ue(),zr=Ue(Le.NUM),Ka=Ue(Le.DOMAIN),us=Ue(),Xr=Ue(Le.WS);qt.on("@",Ue(Le.AT)).on(".",Ue(Le.DOT)).on("+",Ue(Le.PLUS)).on("#",Ue(Le.POUND)).on("?",Ue(Le.QUERY)).on("/",Ue(Le.SLASH)).on("_",Ue(Le.UNDERSCORE)).on(":",Ue(Le.COLON)).on("{",Ue(Le.OPENBRACE)).on("[",Ue(Le.OPENBRACKET)).on("<",Ue(Le.OPENANGLEBRACKET)).on("(",Ue(Le.OPENPAREN)).on("}",Ue(Le.CLOSEBRACE)).on("]",Ue(Le.CLOSEBRACKET)).on(">",Ue(Le.CLOSEANGLEBRACKET)).on(")",Ue(Le.CLOSEPAREN)).on("&",Ue(Le.AMPERSAND)).on([",",";","!",'"',"'"],Ue(Le.PUNCTUATION)),qt.on(`
`,Ue(Le.NL)).on($n,Xr),Xr.on($n,Xr);for(var Yr=0;Yr<Qn.length;Yr++){var gl=(0,ga.stateify)(Qn[Yr],qt,Le.TLD,Le.DOMAIN);wt.push.apply(wt,gl)}var Jn=(0,ga.stateify)("file",qt,Le.DOMAIN,Le.DOMAIN),eo=(0,ga.stateify)("ftp",qt,Le.DOMAIN,Le.DOMAIN),to=(0,ga.stateify)("http",qt,Le.DOMAIN,Le.DOMAIN),ao=(0,ga.stateify)("mailto",qt,Le.DOMAIN,Le.DOMAIN);wt.push.apply(wt,Jn),wt.push.apply(wt,eo),wt.push.apply(wt,to),wt.push.apply(wt,ao);var pl=Jn.pop(),bl=eo.pop(),yl=to.pop(),Sl=ao.pop(),$s=Ue(Le.DOMAIN),Js=Ue(Le.PROTOCOL),El=Ue(Le.MAILTO);bl.on("s",$s).on(":",Js),yl.on("s",$s).on(":",Js),wt.push($s),pl.on(":",Js),$s.on(":",Js),Sl.on(":",El);var kl=(0,ga.stateify)("localhost",qt,Le.LOCALHOST,Le.DOMAIN);wt.push.apply(wt,kl),qt.on(qr,zr),zr.on("-",us).on(qr,zr).on(Qs,Ka),Ka.on("-",us).on(Qs,Ka);for(var Gr=0;Gr<wt.length;Gr++)wt[Gr].on("-",us).on(Qs,Ka);us.on("-",us).on(qr,Ka).on(Qs,Ka),qt.defaultTransition=Ue(Le.SYM);var Ml=function(t){for(var a=t.replace(/[A-Z]/g,function(y){return y.toLowerCase()}),o=t.length,m=[],n=0;n<o;){for(var M=qt,T=null,O=0,g=null,N=-1;n<o&&(T=M.next(a[n]));)M=T,M.accepts()?(N=0,g=M):N>=0&&N++,O++,n++;if(!(N<0)){n-=N,O-=N;var u=g.emit();m.push(new u(t.substr(n-O,O)))}}return m},wl=qt;ea.State=ga.CharacterState,ea.TOKENS=fl,ea.run=Ml,ea.start=wl;var ta={},At={};At.__esModule=!0,At.URL=At.TEXT=At.NL=At.EMAIL=At.MAILTOEMAIL=At.Base=void 0;var Za=Ws,fs=Ga,vs=Se;function Rl(e){return e instanceof vs.DOMAIN||e instanceof vs.TLD}var ka=(0,Za.createTokenClass)();ka.prototype={type:"token",isLink:!1,toString:function(){for(var t=[],a=0;a<this.v.length;a++)t.push(this.v[a].toString());return t.join("")},toHref:function(){return this.toString()},toObject:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http";return{type:this.type,value:this.toString(),href:this.toHref(t)}}};var Al=(0,fs.inherits)(ka,(0,Za.createTokenClass)(),{type:"email",isLink:!0}),Tl=(0,fs.inherits)(ka,(0,Za.createTokenClass)(),{type:"email",isLink:!0,toHref:function(){return"mailto:"+this.toString()}}),xl=(0,fs.inherits)(ka,(0,Za.createTokenClass)(),{type:"text"}),Bl=(0,fs.inherits)(ka,(0,Za.createTokenClass)(),{type:"nl"}),Cl=(0,fs.inherits)(ka,(0,Za.createTokenClass)(),{type:"url",isLink:!0,toHref:function(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http",a=!1,o=!1,m=this.v,n=[],M=0;m[M]instanceof vs.PROTOCOL;)a=!0,n.push(m[M].toString().toLowerCase()),M++;for(;m[M]instanceof vs.SLASH;)o=!0,n.push(m[M].toString()),M++;for(;Rl(m[M]);)n.push(m[M].toString().toLowerCase()),M++;for(;M<m.length;M++)n.push(m[M].toString());return n=n.join(""),a||o||(n=t+"://"+n),n},hasProtocol:function(){return this.v[0]instanceof vs.PROTOCOL}});At.Base=ka,At.MAILTOEMAIL=Al,At.EMAIL=Tl,At.NL=Bl,At.TEXT=xl,At.URL=Cl,ta.__esModule=!0,ta.start=ta.run=ta.TOKENS=ta.State=void 0;var so=ca,Tt=At,Ol=Ll(Tt),_e=Se;function Ll(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}var Ne=function(t){return new so.TokenState(t)},er=Ne(),ro=Ne(),no=Ne(),Kr=Ne(),oo=Ne(),pa=Ne(),tr=Ne(),gs=Ne(Tt.URL),io=Ne(),lo=Ne(Tt.URL),Je=Ne(Tt.URL),ps=Ne(),bs=Ne(),ys=Ne(),Ss=Ne(),Es=Ne(),Ma=Ne(Tt.URL),wa=Ne(Tt.URL),Ra=Ne(Tt.URL),Aa=Ne(Tt.URL),ks=Ne(),Ms=Ne(),ws=Ne(),Rs=Ne(),Wa=Ne(),Zr=Ne(),ar=Ne(Tt.EMAIL),co=Ne(),Nl=Ne(Tt.EMAIL),Ta=Ne(Tt.MAILTOEMAIL),Wr=Ne(),Qa=Ne(),sr=Ne(),mo=Ne(),Il=Ne(Tt.NL);er.on(_e.NL,Il).on(_e.PROTOCOL,ro).on(_e.MAILTO,no).on(_e.SLASH,Kr),ro.on(_e.SLASH,Kr),Kr.on(_e.SLASH,oo),er.on(_e.TLD,pa).on(_e.DOMAIN,pa).on(_e.LOCALHOST,gs).on(_e.NUM,pa),oo.on(_e.TLD,Je).on(_e.DOMAIN,Je).on(_e.NUM,Je).on(_e.LOCALHOST,Je),pa.on(_e.DOT,tr),Wa.on(_e.DOT,Zr),tr.on(_e.TLD,gs).on(_e.DOMAIN,pa).on(_e.NUM,pa).on(_e.LOCALHOST,pa),Zr.on(_e.TLD,ar).on(_e.DOMAIN,Wa).on(_e.NUM,Wa).on(_e.LOCALHOST,Wa),gs.on(_e.DOT,tr),ar.on(_e.DOT,Zr),gs.on(_e.COLON,io).on(_e.SLASH,Je),io.on(_e.NUM,lo),lo.on(_e.SLASH,Je),ar.on(_e.COLON,co),co.on(_e.NUM,Nl);var bt=[_e.DOMAIN,_e.AT,_e.LOCALHOST,_e.NUM,_e.PLUS,_e.POUND,_e.PROTOCOL,_e.SLASH,_e.TLD,_e.UNDERSCORE,_e.SYM,_e.AMPERSAND],yt=[_e.COLON,_e.DOT,_e.QUERY,_e.PUNCTUATION,_e.CLOSEBRACE,_e.CLOSEBRACKET,_e.CLOSEANGLEBRACKET,_e.CLOSEPAREN,_e.OPENBRACE,_e.OPENBRACKET,_e.OPENANGLEBRACKET,_e.OPENPAREN];Je.on(_e.OPENBRACE,bs).on(_e.OPENBRACKET,ys).on(_e.OPENANGLEBRACKET,Ss).on(_e.OPENPAREN,Es),ps.on(_e.OPENBRACE,bs).on(_e.OPENBRACKET,ys).on(_e.OPENANGLEBRACKET,Ss).on(_e.OPENPAREN,Es),bs.on(_e.CLOSEBRACE,Je),ys.on(_e.CLOSEBRACKET,Je),Ss.on(_e.CLOSEANGLEBRACKET,Je),Es.on(_e.CLOSEPAREN,Je),Ma.on(_e.CLOSEBRACE,Je),wa.on(_e.CLOSEBRACKET,Je),Ra.on(_e.CLOSEANGLEBRACKET,Je),Aa.on(_e.CLOSEPAREN,Je),ks.on(_e.CLOSEBRACE,Je),Ms.on(_e.CLOSEBRACKET,Je),ws.on(_e.CLOSEANGLEBRACKET,Je),Rs.on(_e.CLOSEPAREN,Je),bs.on(bt,Ma),ys.on(bt,wa),Ss.on(bt,Ra),Es.on(bt,Aa),bs.on(yt,ks),ys.on(yt,Ms),Ss.on(yt,ws),Es.on(yt,Rs),Ma.on(bt,Ma),wa.on(bt,wa),Ra.on(bt,Ra),Aa.on(bt,Aa),Ma.on(yt,Ma),wa.on(yt,wa),Ra.on(yt,Ra),Aa.on(yt,Aa),ks.on(bt,Ma),Ms.on(bt,wa),ws.on(bt,Ra),Rs.on(bt,Aa),ks.on(yt,ks),Ms.on(yt,Ms),ws.on(yt,ws),Rs.on(yt,Rs),Je.on(bt,Je),ps.on(bt,Je),Je.on(yt,ps),ps.on(yt,ps),no.on(_e.TLD,Ta).on(_e.DOMAIN,Ta).on(_e.NUM,Ta).on(_e.LOCALHOST,Ta),Ta.on(bt,Ta).on(yt,Wr),Wr.on(bt,Ta).on(yt,Wr);var As=[_e.DOMAIN,_e.NUM,_e.PLUS,_e.POUND,_e.QUERY,_e.UNDERSCORE,_e.SYM,_e.AMPERSAND,_e.TLD];pa.on(As,Qa).on(_e.AT,sr),gs.on(As,Qa).on(_e.AT,sr),tr.on(As,Qa),Qa.on(As,Qa).on(_e.AT,sr).on(_e.DOT,mo),mo.on(As,Qa),sr.on(_e.TLD,Wa).on(_e.DOMAIN,Wa).on(_e.LOCALHOST,ar);var Vl=function(t){for(var a=t.length,o=0,m=[],n=[];o<a;){for(var M=er,T=null,O=null,g=0,N=null,u=-1;o<a&&!(T=M.next(t[o]));)n.push(t[o++]);for(;o<a&&(O=T||M.next(t[o]));)T=null,M=O,M.accepts()?(u=0,N=M):u>=0&&u++,o++,g++;if(u<0)for(var y=o-g;y<o;y++)n.push(t[y]);else{n.length>0&&(m.push(new Tt.TEXT(n)),n=[]),o-=u,g-=u;var k=N.emit();m.push(new k(t.slice(o-g,o)))}}return n.length>0&&m.push(new Tt.TEXT(n)),m};ta.State=so.TokenState,ta.TOKENS=Ol,ta.run=Vl,ta.start=er,pt.__esModule=!0,pt.tokenize=pt.test=pt.scanner=pt.parser=pt.options=pt.inherits=pt.find=void 0;var jl=Ga,Hl=_s,Pl=Qr(Hl),Fl=ea,ho=Qr(Fl),Dl=ta,_o=Qr(Dl);function Qr(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"});var $r=function(t){return _o.run(ho.run(t))},Ul=function(t){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=$r(t),m=[],n=0;n<o.length;n++){var M=o[n];M.isLink&&(!a||M.type===a)&&m.push(M.toObject())}return m},ql=function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=$r(t);return o.length===1&&o[0].isLink&&(!a||o[0].type===a)};pt.find=Ul,pt.inherits=jl.inherits,pt.options=Pl,pt.parser=_o,pt.scanner=ho,pt.test=ql,pt.tokenize=$r;var uo=pt,zl=(e,t,a)=>{const o={bold:a.bold,italic:a.italic,strike:a.strike,underline:a.underline,multilineCode:a.multilineCode,inlineCode:a.inlineCode},m={[o.bold]:{end:"\\"+o.bold,allowed_chars:".",type:"bold"},[o.italic]:{end:o.italic,allowed_chars:".",type:"italic"},[o.strike]:{end:o.strike,allowed_chars:".",type:"strike"},[o.underline]:{end:o.underline,allowed_chars:".",type:"underline"},[o.multilineCode]:{end:o.multilineCode,allowed_chars:`(.|
)`,type:"multiline-code"},[o.inlineCode]:{end:o.inlineCode,allowed_chars:".",type:"inline-code"},"<usertag>":{allowed_chars:".",end:"</usertag>",type:"tag"}},n=rr(e,m),M=Xl(n,m),T=[].concat.apply([],M);return t&&Gl(T),T};function rr(e,t){let a=[],o=-1,m=null,n=uo.find(e),M=!1;if(n.length>0&&(o=e.indexOf(n[0].value),M=!0),Object.keys(t).forEach(T=>{const O=e.indexOf(T);O>=0&&(o<0||O<o)&&(o=O,m=T,M=!1)}),M&&m!==-1){let T=e.substr(0,o),O=e.substr(o,n[0].value.length),g=e.substr(o+n[0].value.length);return a.push(T),a.push(O),a=a.concat(rr(g,t)),a}if(m){let T=e.substr(0,o);const O=m;let g=e.substr(o+O.length);if(e.replace(/\s/g,"").length===O.length*2)return[e];const N=g.match(new RegExp("^("+(t[O].allowed_chars||".")+"*"+(t[O].end?"?":"")+")"+(t[O].end?"("+t[O].end+")":""),"m"));if(!N||!N[1])T=T+O,a.push(T);else{T&&a.push(T);const u={start:O,content:rr(N[1],t),end:N[2],type:t[O].type};a.push(u),g=g.substr(N[0].length)}return a=a.concat(rr(g,t)),a}else return e?[e]:[]}function Xl(e,t){const a=[];return e.forEach(o=>{typeof o=="string"?a.push({types:[],value:o}):t[o.start]&&a.push(Yl(o))}),a}function Yl(e){const t=[];return fo(e,t,[]),t}function fo(e,t,a){e.content.forEach(o=>{typeof o=="string"?t.push({types:vo(a.concat([e.type])),value:o}):fo(o,t,vo([o.type].concat([e.type]).concat(a)))})}function vo(e){return[...new Set(e)]}function Gl(e){const t=[];return e.forEach(a=>{const o=uo.find(a.value);if(o.length){const m=a.value.replace(o[0].value,"");t.push({types:a.types,value:m}),a.types=["url"].concat(a.types),a.href=o[0].href,a.value=o[0].value}t.push(a)}),t}const Jr=["png","jpg","jpeg","webp","svg","gif"],go=["mp4","video/ogg","webm","quicktime"],Kl=["mp3","audio/ogg","wav","mpeg"],Zl={name:"FormatMessage",components:{SvgIcon:gt},props:{content:{type:[String,Number],required:!0},deleted:{type:Boolean,default:!1},users:{type:Array,default:()=>[]},linkify:{type:Boolean,default:!0},singleLine:{type:Boolean,default:!1},reply:{type:Boolean,default:!1},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0}},emits:["open-user-tag"],computed:{linkifiedMessage(){const e=zl(this.formatTags(this.content),this.linkify&&!this.linkOptions.disabled,this.textFormatting);return e.forEach(t=>{t.url=this.checkType(t,"url"),t.bold=this.checkType(t,"bold"),t.italic=this.checkType(t,"italic"),t.strike=this.checkType(t,"strike"),t.underline=this.checkType(t,"underline"),t.inline=this.checkType(t,"inline-code"),t.multiline=this.checkType(t,"multiline-code"),t.tag=this.checkType(t,"tag"),t.image=this.checkImageType(t),t.value=this.replaceEmojiByElement(t.value)}),e},formattedContent(){return this.formatTags(this.content)}},methods:{checkType(e,t){return e.types.indexOf(t)!==-1},checkImageType(e){let t=e.value.lastIndexOf(".");e.value.lastIndexOf("/")>t&&(t=-1);const o=e.value.substring(t+1,e.value.length),m=t>0&&Jr.some(n=>o.toLowerCase().includes(n));return m&&this.setImageSize(e),m},setImageSize(e){const t=new Image;t.src=e.value,t.addEventListener("load",a);function a(o){const m=o.path[0].width/150;e.height=Math.round(o.path[0].height/m)+"px",t.removeEventListener("load",a)}},formatTags(e){const t="<usertag>",a="</usertag>",o=[...e.matchAll(new RegExp(t,"gi"))].map(n=>n.index),m=e;return o.forEach(n=>{const M=m.substring(n+t.length,m.indexOf(a,n)),T=this.users.find(O=>O._id===M);e=e.replaceAll(M,`@${(T==null?void 0:T.username)||"unknown"}`)}),e},openTag(e){if(!this.singleLine&&this.checkType(e,"tag")){const t=this.users.find(a=>e.value.indexOf(a.username)!==-1);this.$emit("open-user-tag",t)}},replaceEmojiByElement(e){let t;return this.singleLine?t=16:t=this.containsOnlyEmojis()?28:20,e.replaceAll(/[\p{Extended_Pictographic}\u{1F3FB}-\u{1F3FF}\u{1F9B0}-\u{1F9B3}]/gu,a=>`<span style="font-size: ${t}px">${a}</span>`)},containsOnlyEmojis(){const e=this.content.replace(new RegExp("[\0-\u1EEFf]","g"),""),t=this.content.replace(new RegExp(`[
\rs]+|( )+`,"g"),"");return e.length===t.length}}},Wl={class:"vac-image-link-container"},Ql={class:"vac-image-link-message"},$l=["innerHTML"],Jl=["innerHTML"];function e1(e,t,a,o,m,n){const M=s.resolveComponent("svg-icon");return s.openBlock(),s.createElementBlock("div",{class:s.normalizeClass(["vac-format-message-wrapper",{"vac-text-ellipsis":a.singleLine}])},[a.textFormatting.disabled?(s.openBlock(),s.createElementBlock("div",{key:1,innerHTML:n.formattedContent},null,8,Jl)):(s.openBlock(),s.createElementBlock("div",{key:0,class:s.normalizeClass({"vac-text-ellipsis":a.singleLine})},[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(n.linkifiedMessage,(T,O)=>(s.openBlock(),s.createElementBlock("div",{key:O,class:"vac-format-container"},[(s.openBlock(),s.createBlock(s.resolveDynamicComponent(T.url?"a":"span"),{class:s.normalizeClass({"vac-text-ellipsis":a.singleLine,"vac-text-bold":T.bold,"vac-text-italic":a.deleted||T.italic,"vac-text-strike":T.strike,"vac-text-underline":T.underline,"vac-text-inline-code":!a.singleLine&&T.inline,"vac-text-multiline-code":!a.singleLine&&T.multiline,"vac-text-tag":!a.singleLine&&!a.reply&&T.tag}),href:T.href,target:T.href?a.linkOptions.target:null,rel:T.href?a.linkOptions.rel:null,onClick:g=>n.openTag(T)},{default:s.withCtx(()=>[s.renderSlot(e.$slots,"deleted-icon",s.normalizeProps(s.guardReactiveProps({deleted:a.deleted})),()=>[a.deleted?(s.openBlock(),s.createBlock(M,{key:0,name:"deleted",class:"vac-icon-deleted"})):s.createCommentVNode("",!0)]),T.url&&T.image?(s.openBlock(),s.createElementBlock(s.Fragment,{key:0},[s.createElementVNode("div",Wl,[s.createElementVNode("div",{class:"vac-image-link",style:s.normalizeStyle({"background-image":`url('${T.value}')`,height:T.height})},null,4)]),s.createElementVNode("div",Ql,[s.createElementVNode("span",null,s.toDisplayString(T.value),1)])],64)):(s.openBlock(),s.createElementBlock("span",{key:1,innerHTML:T.value},null,8,$l))]),_:2},1032,["class","href","target","rel","onClick"]))]))),128))],2))],2)}var Ts=Fe(Zl,[["render",e1]]);const xa="__v-click-outside",po=typeof window!="undefined",t1=typeof navigator!="undefined",a1=po&&("ontouchstart"in window||t1&&navigator.msMaxTouchPoints>0)?["touchstart"]:["click"],s1=e=>{const t=typeof e=="function";if(!t&&typeof e!="object")throw new Error("v-click-outside: Binding value must be a function or an object");return{handler:t?e:e.handler,middleware:e.middleware||(a=>a),events:e.events||a1,isActive:e.isActive!==!1,detectIframe:e.detectIframe!==!1,capture:Boolean(e.capture)}},bo=({event:e,handler:t,middleware:a})=>{a(e)&&t(e)},r1=({el:e,event:t,handler:a,middleware:o})=>{setTimeout(()=>{const{activeElement:m}=document;m&&m.tagName==="IFRAME"&&!e.contains(m)&&bo({event:t,handler:a,middleware:o})},0)},n1=({el:e,event:t,handler:a,middleware:o})=>{const m=t.path||t.composedPath&&t.composedPath();(m?m.indexOf(e)<0:!e.contains(t.target))&&bo({event:t,handler:a,middleware:o})},yo=(e,{value:t})=>{const{events:a,handler:o,middleware:m,isActive:n,detectIframe:M,capture:T}=s1(t);if(!!n){if(e[xa]=a.map(O=>({event:O,srcTarget:document.documentElement,handler:g=>n1({el:e,event:g,handler:o,middleware:m}),capture:T})),M){const O={event:"blur",srcTarget:window,handler:g=>r1({el:e,event:g,handler:o,middleware:m}),capture:T};e[xa]=[...e[xa],O]}e[xa].forEach(({event:O,srcTarget:g,handler:N})=>setTimeout(()=>{!e[xa]||g.addEventListener(O,N,T)},0))}},So=e=>{(e[xa]||[]).forEach(({event:a,srcTarget:o,handler:m,capture:n})=>o.removeEventListener(a,m,n)),delete e[xa]};var nr=po?{beforeMount:yo,updated:(e,{value:t,oldValue:a})=>{JSON.stringify(t)!==JSON.stringify(a)&&(So(e),yo(e,{value:t}))},unmounted:So}:{},Eo=(e,t,a)=>{if(e.typingUsers&&e.typingUsers.length){const o=e.users.filter(m=>{if(m._id!==t&&e.typingUsers.indexOf(m._id)!==-1&&!(m.status&&m.status.state==="offline"))return!0});return o.length?e.users.length===2?a.IS_TYPING:o.map(m=>m.username).join(", ")+" "+a.IS_TYPING:void 0}};function xs(e,t){if(!(!t||!t.type))return e.some(a=>t.type.toLowerCase().includes(a))}function $a(e){return xs(Jr,e)}function Bs(e){return xs(go,e)}function ko(e){return xs(Jr,e)||xs(go,e)}function or(e){return xs(Kl,e)}const o1={name:"RoomsContent",components:{SvgIcon:gt,FormatMessage:Ts},directives:{clickOutside:nr},props:{currentUserId:{type:[String,Number],required:!0},room:{type:Object,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},textMessages:{type:Object,required:!0},roomActions:{type:Array,required:!0}},emits:["room-action-handler"],data(){return{roomMenuOpened:null}},computed:{getLastMessage(){const e=this.typingUsers;if(e)return e;const t=this.room.lastMessage.deleted?this.textMessages.MESSAGE_DELETED:this.room.lastMessage.content;if(this.room.users.length<=2)return t;const a=this.room.users.find(o=>o._id===this.room.lastMessage.senderId);return this.room.lastMessage.username?`${this.room.lastMessage.username} - ${t}`:!a||a._id===this.currentUserId?t:`${a.username} - ${t}`},userStatus(){if(!this.room.users||this.room.users.length!==2)return;const e=this.room.users.find(t=>t._id!==this.currentUserId);return e&&e.status?e.status.state:null},typingUsers(){return Eo(this.room,this.currentUserId,this.textMessages)},isMessageCheckmarkVisible(){return!this.typingUsers&&this.room.lastMessage&&!this.room.lastMessage.deleted&&this.room.lastMessage.senderId===this.currentUserId&&(this.room.lastMessage.saved||this.room.lastMessage.distributed||this.room.lastMessage.seen)},formattedDuration(){var t,a;const e=(a=(t=this.room.lastMessage)==null?void 0:t.files)==null?void 0:a[0];if(e){if(!e.duration)return`${e.name}.${e.extension}`;let o=Math.floor(e.duration);return(o-(o%=60))/60+(o>9?":":":0")+o}return""},isAudio(){return this.room.lastMessage.files?or(this.room.lastMessage.files[0]):!1}},methods:{roomActionHandler(e){this.closeRoomMenu(),this.$emit("room-action-handler",{action:e,roomId:this.room.roomId})},closeRoomMenu(){this.roomMenuOpened=null}}},i1={class:"vac-room-container"},l1={class:"vac-name-container vac-text-ellipsis"},c1={class:"vac-title-container"},d1={class:"vac-room-name vac-text-ellipsis"},m1={key:1,class:"vac-text-date"},h1={key:0},_1={key:1,class:"vac-text-ellipsis"},u1={key:3,class:"vac-text-ellipsis"},f1={class:"vac-room-options-container"},v1={key:0,class:"vac-badge-counter vac-room-badge"},g1={key:0,class:"vac-menu-options"},p1={class:"vac-menu-list"},b1=["onClick"];function y1(e,t,a,o,m,n){const M=s.resolveComponent("svg-icon"),T=s.resolveComponent("format-message"),O=s.resolveDirective("click-outside");return s.openBlock(),s.createElementBlock("div",i1,[s.renderSlot(e.$slots,"room-list-item",s.normalizeProps(s.guardReactiveProps({room:a.room})),()=>[s.renderSlot(e.$slots,"room-list-avatar",s.normalizeProps(s.guardReactiveProps({room:a.room})),()=>[a.room.avatar?(s.openBlock(),s.createElementBlock("div",{key:0,class:"vac-avatar",style:s.normalizeStyle({"background-image":`url('${a.room.avatar}')`})},null,4)):s.createCommentVNode("",!0)]),s.createElementVNode("div",l1,[s.createElementVNode("div",c1,[n.userStatus?(s.openBlock(),s.createElementBlock("div",{key:0,class:s.normalizeClass(["vac-state-circle",{"vac-state-online":n.userStatus==="online"}])},null,2)):s.createCommentVNode("",!0),s.createElementVNode("div",d1,s.toDisplayString(a.room.roomName),1),a.room.lastMessage?(s.openBlock(),s.createElementBlock("div",m1,s.toDisplayString(a.room.lastMessage.timestamp),1)):s.createCommentVNode("",!0)]),s.createElementVNode("div",{class:s.normalizeClass(["vac-text-last",{"vac-message-new":a.room.lastMessage&&a.room.lastMessage.new&&!n.typingUsers}])},[n.isMessageCheckmarkVisible?(s.openBlock(),s.createElementBlock("span",h1,[s.renderSlot(e.$slots,"checkmark-icon",s.normalizeProps(s.guardReactiveProps({message:a.room.lastMessage})),()=>[s.createVNode(M,{name:a.room.lastMessage.distributed?"double-checkmark":"checkmark",param:a.room.lastMessage.seen?"seen":"",class:"vac-icon-check"},null,8,["name","param"])])])):s.createCommentVNode("",!0),a.room.lastMessage&&!a.room.lastMessage.deleted&&n.isAudio?(s.openBlock(),s.createElementBlock("div",_1,[s.renderSlot(e.$slots,"microphone-icon",{},()=>[s.createVNode(M,{name:"microphone",class:"vac-icon-microphone"})]),s.createTextVNode(" "+s.toDisplayString(n.formattedDuration),1)])):a.room.lastMessage?(s.openBlock(),s.createBlock(T,{key:2,content:n.getLastMessage,deleted:!!a.room.lastMessage.deleted&&!n.typingUsers,users:a.room.users,linkify:!1,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"single-line":!0},{"deleted-icon":s.withCtx(g=>[s.renderSlot(e.$slots,"deleted-icon",s.normalizeProps(s.guardReactiveProps(g)))]),_:3},8,["content","deleted","users","text-formatting","link-options"])):s.createCommentVNode("",!0),!a.room.lastMessage&&n.typingUsers?(s.openBlock(),s.createElementBlock("div",u1,s.toDisplayString(n.typingUsers),1)):s.createCommentVNode("",!0),s.createElementVNode("div",f1,[a.room.unreadCount?(s.openBlock(),s.createElementBlock("div",v1,s.toDisplayString(a.room.unreadCount),1)):s.createCommentVNode("",!0),s.renderSlot(e.$slots,"room-list-options",s.normalizeProps(s.guardReactiveProps({room:a.room})),()=>[a.roomActions.length?(s.openBlock(),s.createElementBlock("div",{key:0,class:"vac-svg-button vac-list-room-options",onClick:t[0]||(t[0]=s.withModifiers(g=>m.roomMenuOpened=a.room.roomId,["stop"]))},[s.renderSlot(e.$slots,"room-list-options-icon",{},()=>[s.createVNode(M,{name:"dropdown",param:"room"})])])):s.createCommentVNode("",!0),a.roomActions.length?(s.openBlock(),s.createBlock(s.Transition,{key:1,name:"vac-slide-left"},{default:s.withCtx(()=>[m.roomMenuOpened===a.room.roomId?s.withDirectives((s.openBlock(),s.createElementBlock("div",g1,[s.createElementVNode("div",p1,[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(a.roomActions,g=>(s.openBlock(),s.createElementBlock("div",{key:g.name},[s.createElementVNode("div",{class:"vac-menu-item",onClick:s.withModifiers(N=>n.roomActionHandler(g),["stop"])},s.toDisplayString(g.title),9,b1)]))),128))])])),[[O,n.closeRoomMenu]]):s.createCommentVNode("",!0)]),_:1})):s.createCommentVNode("",!0)])])],2)])])])}var S1=Fe(o1,[["render",y1]]),en=(e,t,a,o=!1)=>!a||a===""?e:e.filter(m=>o?ir(m[t]).startsWith(ir(a)):ir(m[t]).includes(ir(a)));function ir(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}const E1={name:"RoomsList",components:{Loader:Zs,RoomsSearch:L0,RoomContent:S1},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},showRoomsList:{type:Boolean,required:!0},showSearch:{type:Boolean,required:!0},showAddRoom:{type:Boolean,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},isMobile:{type:Boolean,required:!0},rooms:{type:Array,required:!0},loadingRooms:{type:Boolean,required:!0},roomsLoaded:{type:Boolean,required:!0},room:{type:Object,required:!0},roomActions:{type:Array,required:!0},scrollDistance:{type:Number,required:!0}},emits:["add-room","room-action-handler","loading-more-rooms","fetch-room","fetch-more-rooms"],data(){return{filteredRooms:this.rooms||[],observer:null,showLoader:!0,loadingMoreRooms:!1,selectedRoomId:""}},watch:{rooms:{deep:!0,handler(e,t){this.filteredRooms=e,(e.length!==t.length||this.roomsLoaded)&&(this.loadingMoreRooms=!1)}},loadingRooms(e){e||setTimeout(()=>this.initIntersectionObserver())},loadingMoreRooms(e){this.$emit("loading-more-rooms",e)},roomsLoaded:{immediate:!0,handler(e){e&&(this.loadingMoreRooms=!1,this.loadingRooms||(this.showLoader=!1))}},room:{immediate:!0,handler(e){e&&!this.isMobile&&(this.selectedRoomId=e.roomId)}}},methods:{initIntersectionObserver(){this.observer&&(this.showLoader=!0,this.observer.disconnect());const e=document.getElementById("infinite-loader-rooms");if(e){const t={root:document.getElementById("rooms-list"),rootMargin:`${this.scrollDistance}px`,threshold:0};this.observer=new IntersectionObserver(a=>{a[0].isIntersecting&&this.loadMoreRooms()},t),this.observer.observe(e)}},searchRoom(e){this.filteredRooms=en(this.rooms,"roomName",e.target.value)},openRoom(e){e.roomId===this.room.roomId&&!this.isMobile||(this.isMobile||(this.selectedRoomId=e.roomId),this.$emit("fetch-room",{room:e}))},loadMoreRooms(){if(!this.loadingMoreRooms){if(this.roomsLoaded){this.loadingMoreRooms=!1,this.showLoader=!1;return}this.$emit("fetch-more-rooms"),this.loadingMoreRooms=!0}}}},k1={key:0,class:"vac-rooms-empty"},M1={key:1,id:"rooms-list",class:"vac-room-list"},w1=["id","onClick"],R1={key:0,id:"infinite-loader-rooms"};function A1(e,t,a,o,m,n){const M=s.resolveComponent("rooms-search"),T=s.resolveComponent("loader"),O=s.resolveComponent("room-content");return s.withDirectives((s.openBlock(),s.createElementBlock("div",{class:s.normalizeClass(["vac-rooms-container",{"vac-rooms-container-full":a.isMobile,"vac-app-border-r":!a.isMobile}])},[s.renderSlot(e.$slots,"rooms-header"),s.renderSlot(e.$slots,"rooms-list-search",{},()=>[s.createVNode(M,{rooms:a.rooms,"loading-rooms":a.loadingRooms,"text-messages":a.textMessages,"show-search":a.showSearch,"show-add-room":a.showAddRoom,onSearchRoom:n.searchRoom,onAddRoom:t[0]||(t[0]=g=>e.$emit("add-room"))},s.createSlots({_:2},[s.renderList(e.$slots,(g,N)=>({name:N,fn:s.withCtx(u=>[s.renderSlot(e.$slots,N,s.normalizeProps(s.guardReactiveProps(u)))])}))]),1032,["rooms","loading-rooms","text-messages","show-search","show-add-room","onSearchRoom"])]),s.createVNode(T,{show:a.loadingRooms},s.createSlots({_:2},[s.renderList(e.$slots,(g,N)=>({name:N,fn:s.withCtx(u=>[s.renderSlot(e.$slots,N,s.normalizeProps(s.guardReactiveProps(u)))])}))]),1032,["show"]),!a.loadingRooms&&!a.rooms.length?(s.openBlock(),s.createElementBlock("div",k1,[s.renderSlot(e.$slots,"rooms-empty",{},()=>[s.createTextVNode(s.toDisplayString(a.textMessages.ROOMS_EMPTY),1)])])):s.createCommentVNode("",!0),a.loadingRooms?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",M1,[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(m.filteredRooms,g=>(s.openBlock(),s.createElementBlock("div",{id:g.roomId,key:g.roomId,class:s.normalizeClass(["vac-room-item",{"vac-room-selected":m.selectedRoomId===g.roomId}]),onClick:N=>n.openRoom(g)},[s.createVNode(O,{"current-user-id":a.currentUserId,room:g,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"text-messages":a.textMessages,"room-actions":a.roomActions,onRoomActionHandler:t[1]||(t[1]=N=>e.$emit("room-action-handler",N))},s.createSlots({_:2},[s.renderList(e.$slots,(N,u)=>({name:u,fn:s.withCtx(y=>[s.renderSlot(e.$slots,u,s.normalizeProps(s.guardReactiveProps(y)))])}))]),1032,["current-user-id","room","text-formatting","link-options","text-messages","room-actions"])],10,w1))),128)),s.createVNode(s.Transition,{name:"vac-fade-message"},{default:s.withCtx(()=>[a.rooms.length&&!a.loadingRooms?(s.openBlock(),s.createElementBlock("div",R1,[s.createVNode(T,{show:m.showLoader,infinite:!0},s.createSlots({_:2},[s.renderList(e.$slots,(g,N)=>({name:N,fn:s.withCtx(u=>[s.renderSlot(e.$slots,N,s.normalizeProps(s.guardReactiveProps(u)))])}))]),1032,["show"])])):s.createCommentVNode("",!0)]),_:3})]))],2)),[[s.vShow,a.showRoomsList]])}var T1=Fe(E1,[["render",A1]]);const x1={name:"RoomHeader",components:{SvgIcon:gt},directives:{clickOutside:nr},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},singleRoom:{type:Boolean,required:!0},showRoomsList:{type:Boolean,required:!0},isMobile:{type:Boolean,required:!0},roomInfoEnabled:{type:Boolean,required:!0},menuActions:{type:Array,required:!0},room:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0},messageSelectionActions:{type:Array,required:!0},selectedMessagesTotal:{type:Number,required:!0}},emits:["toggle-rooms-list","room-info","menu-action-handler","cancel-message-selection","message-selection-action-handler"],data(){return{menuOpened:!1,messageSelectionAnimationEnded:!0}},computed:{typingUsers(){return Eo(this.room,this.currentUserId,this.textMessages)},userStatus(){if(!this.room.users||this.room.users.length!==2)return;const e=this.room.users.find(a=>a._id!==this.currentUserId);if(!e.status)return;let t="";return e.status.state==="online"?t=this.textMessages.IS_ONLINE:e.status.lastChanged&&(t=this.textMessages.LAST_SEEN+e.status.lastChanged),t}},watch:{messageSelectionEnabled(e){e?this.messageSelectionAnimationEnded=!1:setTimeout(()=>{this.messageSelectionAnimationEnded=!0},300)}},methods:{menuActionHandler(e){this.closeMenu(),this.$emit("menu-action-handler",e)},closeMenu(){this.menuOpened=!1},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",e)}}},B1={class:"vac-room-header vac-app-border-b"},C1={class:"vac-room-wrapper"},O1={key:0,class:"vac-room-selection"},L1=["id"],N1=["onClick"],I1={class:"vac-selection-button-count"},V1={class:"vac-text-ellipsis"},j1={class:"vac-room-name vac-text-ellipsis"},H1={key:0,class:"vac-room-info vac-text-ellipsis"},P1={key:1,class:"vac-room-info vac-text-ellipsis"},F1={key:0,class:"vac-menu-options"},D1={class:"vac-menu-list"},U1=["onClick"];function q1(e,t,a,o,m,n){const M=s.resolveComponent("svg-icon"),T=s.resolveDirective("click-outside");return s.openBlock(),s.createElementBlock("div",B1,[s.renderSlot(e.$slots,"room-header",s.normalizeProps(s.guardReactiveProps({room:a.room,typingUsers:n.typingUsers,userStatus:n.userStatus})),()=>[s.createElementVNode("div",C1,[s.createVNode(s.Transition,{name:"vac-slide-up"},{default:s.withCtx(()=>[a.messageSelectionEnabled?(s.openBlock(),s.createElementBlock("div",O1,[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(a.messageSelectionActions,O=>(s.openBlock(),s.createElementBlock("div",{id:O.name,key:O.name},[s.createElementVNode("div",{class:"vac-selection-button",onClick:g=>n.messageSelectionActionHandler(O)},[s.createTextVNode(s.toDisplayString(O.title)+" ",1),s.createElementVNode("span",I1,s.toDisplayString(a.selectedMessagesTotal),1)],8,N1)],8,L1))),128)),s.createElementVNode("div",{class:"vac-selection-cancel vac-item-clickable",onClick:t[0]||(t[0]=O=>e.$emit("cancel-message-selection"))},s.toDisplayString(a.textMessages.CANCEL_SELECT_MESSAGE),1)])):s.createCommentVNode("",!0)]),_:1}),!a.messageSelectionEnabled&&m.messageSelectionAnimationEnded?(s.openBlock(),s.createElementBlock(s.Fragment,{key:0},[a.singleRoom?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",{key:0,class:s.normalizeClass(["vac-svg-button vac-toggle-button",{"vac-rotate-icon-init":!a.isMobile,"vac-rotate-icon":!a.showRoomsList&&!a.isMobile}]),onClick:t[1]||(t[1]=O=>e.$emit("toggle-rooms-list"))},[s.renderSlot(e.$slots,"toggle-icon",{},()=>[s.createVNode(M,{name:"toggle"})])],2)),s.createElementVNode("div",{class:s.normalizeClass(["vac-info-wrapper",{"vac-item-clickable":a.roomInfoEnabled}]),onClick:t[2]||(t[2]=O=>e.$emit("room-info"))},[s.renderSlot(e.$slots,"room-header-avatar",s.normalizeProps(s.guardReactiveProps({room:a.room})),()=>[a.room.avatar?(s.openBlock(),s.createElementBlock("div",{key:0,class:"vac-avatar",style:s.normalizeStyle({"background-image":`url('${a.room.avatar}')`})},null,4)):s.createCommentVNode("",!0)]),s.renderSlot(e.$slots,"room-header-info",s.normalizeProps(s.guardReactiveProps({room:a.room,typingUsers:n.typingUsers,userStatus:n.userStatus})),()=>[s.createElementVNode("div",V1,[s.createElementVNode("div",j1,s.toDisplayString(a.room.roomName),1),n.typingUsers?(s.openBlock(),s.createElementBlock("div",H1,s.toDisplayString(n.typingUsers),1)):(s.openBlock(),s.createElementBlock("div",P1,s.toDisplayString(n.userStatus),1))])])],2),a.room.roomId?s.renderSlot(e.$slots,"room-options",{key:1},()=>[a.menuActions.length?(s.openBlock(),s.createElementBlock("div",{key:0,class:"vac-svg-button vac-room-options",onClick:t[3]||(t[3]=O=>m.menuOpened=!m.menuOpened)},[s.renderSlot(e.$slots,"menu-icon",{},()=>[s.createVNode(M,{name:"menu"})])])):s.createCommentVNode("",!0),a.menuActions.length?(s.openBlock(),s.createBlock(s.Transition,{key:1,name:"vac-slide-left"},{default:s.withCtx(()=>[m.menuOpened?s.withDirectives((s.openBlock(),s.createElementBlock("div",F1,[s.createElementVNode("div",D1,[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(a.menuActions,O=>(s.openBlock(),s.createElementBlock("div",{key:O.name},[s.createElementVNode("div",{class:"vac-menu-item",onClick:g=>n.menuActionHandler(O)},s.toDisplayString(O.title),9,U1)]))),128))])])),[[T,n.closeMenu]]):s.createCommentVNode("",!0)]),_:1})):s.createCommentVNode("",!0)]):s.createCommentVNode("",!0)],64)):s.createCommentVNode("",!0)])])])}var z1=Fe(x1,[["render",q1]]);function lr(e){if(typeof e!="string"||!e)throw new Error("expected a non-empty string, got: "+e)}function tn(e){if(typeof e!="number")throw new Error("expected a number, got: "+e)}const X1=1,Y1=1,Ba="emoji",Ja="keyvalue",an="favorites",G1="tokens",Mo="tokens",K1="unicode",wo="count",Z1="group",W1="order",Ro="group-order",sn="eTag",cr="url",Ao="skinTone",es="readonly",rn="readwrite",To="skinUnicodes",Q1="skinUnicodes",$1="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",J1="en";function ec(e,t){const a=new Set,o=[];for(const m of e){const n=t(m);a.has(n)||(a.add(n),o.push(m))}return o}function xo(e){return ec(e,t=>t.unicode)}function tc(e){function t(a,o,m){const n=o?e.createObjectStore(a,{keyPath:o}):e.createObjectStore(a);if(m)for(const[M,[T,O]]of Object.entries(m))n.createIndex(M,T,{multiEntry:O});return n}t(Ja),t(Ba,K1,{[Mo]:[G1,!0],[Ro]:[[Z1,W1]],[To]:[Q1,!0]}),t(an,void 0,{[wo]:[""]})}const nn={},dr={},mr={};function Bo(e,t,a){a.onerror=()=>t(a.error),a.onblocked=()=>t(new Error("IDB blocked")),a.onsuccess=()=>e(a.result)}async function ac(e){const t=await new Promise((a,o)=>{const m=indexedDB.open(e,X1);nn[e]=m,m.onupgradeneeded=n=>{n.oldVersion<Y1&&tc(m.result)},Bo(a,o,m)});return t.onclose=()=>on(e),t}function sc(e){return dr[e]||(dr[e]=ac(e)),dr[e]}function da(e,t,a,o){return new Promise((m,n)=>{const M=e.transaction(t,a,{durability:"relaxed"}),T=typeof t=="string"?M.objectStore(t):t.map(g=>M.objectStore(g));let O;o(T,M,g=>{O=g}),M.oncomplete=()=>m(O),M.onerror=()=>n(M.error)})}function on(e){const t=nn[e],a=t&&t.result;if(a){a.close();const o=mr[e];if(o)for(const m of o)m()}delete nn[e],delete dr[e],delete mr[e]}function rc(e){return new Promise((t,a)=>{on(e);const o=indexedDB.deleteDatabase(e);Bo(t,a,o)})}function nc(e,t){let a=mr[e];a||(a=mr[e]=[]),a.push(t)}const oc=new Set([":D","XD",":'D","O:)",":X",":P",";P","XP",":L",":Z",":j","8D","XO","8)",":B",":O",":S",":'o","Dx","X(","D:",":C",">0)",":3","</3","<3","\\M/",":E","8#"]);function ts(e){return e.split(/[\s_]+/).map(t=>!t.match(/\w/)||oc.has(t)?t.toLowerCase():t.replace(/[)(:,]/g,"").replace(/’/g,"'").toLowerCase()).filter(Boolean)}const ic=2;function Co(e){return e.filter(Boolean).map(t=>t.toLowerCase()).filter(t=>t.length>=ic)}function lc(e){return e.map(({annotation:a,emoticon:o,group:m,order:n,shortcodes:M,skins:T,tags:O,emoji:g,version:N})=>{const u=[...new Set(Co([...(M||[]).map(ts).flat(),...O.map(ts).flat(),...ts(a),o]))].sort(),y={annotation:a,group:m,order:n,tags:O,tokens:u,unicode:g,version:N};if(o&&(y.emoticon=o),M&&(y.shortcodes=M),T){y.skinTones=[],y.skinUnicodes=[],y.skinVersions=[];for(const{tone:k,emoji:r,version:H}of T)y.skinTones.push(k),y.skinUnicodes.push(r),y.skinVersions.push(H)}return y})}function Oo(e,t,a,o){e[t](a).onsuccess=m=>o&&o(m.target.result)}function Ca(e,t,a){Oo(e,"get",t,a)}function Lo(e,t,a){Oo(e,"getAll",t,a)}function ln(e){e.commit&&e.commit()}function cc(e,t){let a=e[0];for(let o=1;o<e.length;o++){const m=e[o];t(a)>t(m)&&(a=m)}return a}function No(e,t){const a=cc(e,m=>m.length),o=[];for(const m of a)e.some(n=>n.findIndex(M=>t(M)===t(m))===-1)||o.push(m);return o}async function dc(e){return!await cn(e,Ja,cr)}async function mc(e,t,a){const[o,m]=await Promise.all([sn,cr].map(n=>cn(e,Ja,n)));return o===a&&m===t}async function hc(e,t){return da(e,Ba,es,(o,m,n)=>{let M;const T=()=>{o.getAll(M&&IDBKeyRange.lowerBound(M,!0),50).onsuccess=O=>{const g=O.target.result;for(const N of g)if(M=N.unicode,t(N))return n(N);if(g.length<50)return n();T()}};T()})}async function Io(e,t,a,o){try{const m=lc(t);await da(e,[Ba,Ja],rn,([n,M],T)=>{let O,g,N=0;function u(){++N===2&&y()}function y(){if(!(O===o&&g===a)){n.clear();for(const k of m)n.put(k);M.put(o,sn),M.put(a,cr),ln(T)}}Ca(M,sn,k=>{O=k,u()}),Ca(M,cr,k=>{g=k,u()})})}finally{}}async function _c(e,t){return da(e,Ba,es,(a,o,m)=>{const n=IDBKeyRange.bound([t,0],[t+1,0],!1,!0);Lo(a.index(Ro),n,m)})}async function Vo(e,t){const a=Co(ts(t));return a.length?da(e,Ba,es,(o,m,n)=>{const M=[],T=()=>{M.length===a.length&&O()},O=()=>{const g=No(M,N=>N.unicode);n(g.sort((N,u)=>N.order<u.order?-1:1))};for(let g=0;g<a.length;g++){const N=a[g],u=g===a.length-1?IDBKeyRange.bound(N,N+"\uFFFF",!1,!0):IDBKeyRange.only(N);Lo(o.index(Mo),u,y=>{M.push(y),T()})}}):[]}async function uc(e,t){const a=await Vo(e,t);return a.length?a.filter(o=>(o.shortcodes||[]).map(n=>n.toLowerCase()).includes(t.toLowerCase()))[0]||null:await hc(e,m=>(m.shortcodes||[]).includes(t.toLowerCase()))||null}async function fc(e,t){return da(e,Ba,es,(a,o,m)=>Ca(a,t,n=>{if(n)return m(n);Ca(a.index(To),t,M=>m(M||null))}))}function cn(e,t,a){return da(e,t,es,(o,m,n)=>Ca(o,a,n))}function vc(e,t,a,o){return da(e,t,rn,(m,n)=>{m.put(o,a),ln(n)})}function gc(e,t){return da(e,an,rn,(a,o)=>Ca(a,t,m=>{a.put((m||0)+1,t),ln(o)}))}function pc(e,t,a){return a===0?[]:da(e,[an,Ba],es,([o,m],n,M)=>{const T=[];o.index(wo).openCursor(void 0,"prev").onsuccess=O=>{const g=O.target.result;if(!g)return M(T);function N(k){if(T.push(k),T.length===a)return M(T);g.continue()}const u=g.primaryKey,y=t.byName(u);if(y)return N(y);Ca(m,u,k=>{if(k)return N(k);g.continue()})}})}const hr="";function bc(e,t){const a=new Map;for(const m of e){const n=t(m);for(const M of n){let T=a;for(let g=0;g<M.length;g++){const N=M.charAt(g);let u=T.get(N);u||(u=new Map,T.set(N,u)),T=u}let O=T.get(hr);O||(O=[],T.set(hr,O)),O.push(m)}}return(m,n)=>{let M=a;for(let g=0;g<m.length;g++){const N=m.charAt(g),u=M.get(N);if(u)M=u;else return[]}if(n)return M.get(hr)||[];const T=[],O=[M];for(;O.length;){const N=[...O.shift().entries()].sort((u,y)=>u[0]<y[0]?-1:1);for(const[u,y]of N)u===hr?T.push(...y):O.push(y)}return T}}const yc=["name","url"];function Sc(e){const t=e&&Array.isArray(e),a=t&&e.length&&(!e[0]||yc.some(o=>!(o in e[0])));if(!t||a)throw new Error("Custom emojis are in the wrong format")}function jo(e){Sc(e);const t=(y,k)=>y.name.toLowerCase()<k.name.toLowerCase()?-1:1,a=e.sort(t),m=bc(e,y=>[...new Set((y.shortcodes||[]).map(k=>ts(k)).flat())]),n=y=>m(y,!0),M=y=>m(y,!1),T=y=>{const k=ts(y),r=k.map((H,j)=>(j<k.length-1?n:M)(H));return No(r,H=>H.name).sort(t)},O=new Map,g=new Map;for(const y of e){g.set(y.name.toLowerCase(),y);for(const k of y.shortcodes||[])O.set(k.toLowerCase(),y)}return{all:a,search:T,byShortcode:y=>O.get(y.toLowerCase()),byName:y=>g.get(y.toLowerCase())}}function Cs(e){if(!e)return e;if(delete e.tokens,e.skinTones){const t=e.skinTones.length;e.skins=Array(t);for(let a=0;a<t;a++)e.skins[a]={tone:e.skinTones[a],unicode:e.skinUnicodes[a],version:e.skinVersions[a]};delete e.skinTones,delete e.skinUnicodes,delete e.skinVersions}return e}function Ho(e){e||console.warn("emoji-picker-element is more efficient if the dataSource server exposes an ETag header.")}const Ec=["annotation","emoji","group","order","tags","version"];function kc(e){if(!e||!Array.isArray(e)||!e[0]||typeof e[0]!="object"||Ec.some(t=>!(t in e[0])))throw new Error("Emoji data is in the wrong format")}function Po(e,t){if(Math.floor(e.status/100)!==2)throw new Error("Failed to fetch: "+t+":  "+e.status)}async function Mc(e){const t=await fetch(e,{method:"HEAD"});Po(t,e);const a=t.headers.get("etag");return Ho(a),a}async function dn(e){const t=await fetch(e);Po(t,e);const a=t.headers.get("etag");Ho(a);const o=await t.json();return kc(o),[a,o]}function wc(e){for(var t="",a=new Uint8Array(e),o=a.byteLength,m=-1;++m<o;)t+=String.fromCharCode(a[m]);return t}function Rc(e){for(var t=e.length,a=new ArrayBuffer(t),o=new Uint8Array(a),m=-1;++m<t;)o[m]=e.charCodeAt(m);return a}async function Fo(e){const t=JSON.stringify(e),a=Rc(t),o=await crypto.subtle.digest("SHA-1",a),m=wc(o);return btoa(m)}async function Ac(e,t){let a,o=await Mc(t);if(!o){const m=await dn(t);o=m[0],a=m[1],o||(o=await Fo(a))}await mc(e,t,o)||(a||(a=(await dn(t))[1]),await Io(e,a,t,o))}async function Tc(e,t){let[a,o]=await dn(t);a||(a=await Fo(o)),await Io(e,o,t,a)}class Do{constructor({dataSource:t=$1,locale:a=J1,customEmoji:o=[]}={}){this.dataSource=t,this.locale=a,this._dbName=`emoji-picker-element-${this.locale}`,this._db=void 0,this._lazyUpdate=void 0,this._custom=jo(o),this._clear=this._clear.bind(this),this._ready=this._init()}async _init(){const t=this._db=await sc(this._dbName);nc(this._dbName,this._clear);const a=this.dataSource;await dc(t)?await Tc(t,a):this._lazyUpdate=Ac(t,a)}async ready(){const t=async()=>(this._ready||(this._ready=this._init()),this._ready);await t(),this._db||await t()}async getEmojiByGroup(t){return tn(t),await this.ready(),xo(await _c(this._db,t)).map(Cs)}async getEmojiBySearchQuery(t){lr(t),await this.ready();const a=this._custom.search(t),o=xo(await Vo(this._db,t)).map(Cs);return[...a,...o]}async getEmojiByShortcode(t){lr(t),await this.ready();const a=this._custom.byShortcode(t);return a||Cs(await uc(this._db,t))}async getEmojiByUnicodeOrName(t){lr(t),await this.ready();const a=this._custom.byName(t);return a||Cs(await fc(this._db,t))}async getPreferredSkinTone(){return await this.ready(),await cn(this._db,Ja,Ao)||0}async setPreferredSkinTone(t){return tn(t),await this.ready(),vc(this._db,Ja,Ao,t)}async incrementFavoriteEmojiCount(t){return lr(t),await this.ready(),gc(this._db,t)}async getTopFavoriteEmoji(t){return tn(t),await this.ready(),(await pc(this._db,this._custom,t)).map(Cs)}set customEmoji(t){this._custom=jo(t)}get customEmoji(){return this._custom.all}async _shutdown(){await this.ready();try{await this._lazyUpdate}catch{}}_clear(){this._db=this._ready=this._lazyUpdate=void 0}async close(){await this._shutdown(),await on(this._dbName)}async delete(){await this._shutdown(),await rc(this._dbName)}}function Os(){}function Uo(e){return e()}function qo(){return Object.create(null)}function Ls(e){e.forEach(Uo)}function zo(e){return typeof e=="function"}function xc(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let _r;function ur(e,t){return _r||(_r=document.createElement("a")),_r.href=t,e===_r.href}function Bc(e){return Object.keys(e).length===0}function Cc(e){return e&&zo(e.destroy)?e.destroy:Os}function Xe(e,t){e.appendChild(t)}function Gt(e,t,a){e.insertBefore(t,a||null)}function Kt(e){e.parentNode.removeChild(e)}function qe(e){return document.createElement(e)}function aa(e){return document.createTextNode(e)}function Zt(e,t,a,o){return e.addEventListener(t,a,o),()=>e.removeEventListener(t,a,o)}function Q(e,t,a){a==null?e.removeAttribute(t):e.getAttribute(t)!==a&&e.setAttribute(t,a)}function sa(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function Xo(e,t){e.value=t==null?"":t}function ba(e,t,a,o){a===null?e.style.removeProperty(t):e.style.setProperty(t,a,o?"important":"")}let mn;function Ns(e){mn=e}const Is=[],as=[],fr=[],Yo=[],Go=Promise.resolve();let hn=!1;function Ko(){hn||(hn=!0,Go.then(Zo))}function Oc(){return Ko(),Go}function _n(e){fr.push(e)}const un=new Set;let vr=0;function Zo(){const e=mn;do{for(;vr<Is.length;){const t=Is[vr];vr++,Ns(t),Lc(t.$$)}for(Ns(null),Is.length=0,vr=0;as.length;)as.pop()();for(let t=0;t<fr.length;t+=1){const a=fr[t];un.has(a)||(un.add(a),a())}fr.length=0}while(Is.length);for(;Yo.length;)Yo.pop()();hn=!1,un.clear(),Ns(e)}function Lc(e){if(e.fragment!==null){e.update(),Ls(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(_n)}}const Nc=new Set;function Ic(e,t){e&&e.i&&(Nc.delete(e),e.i(t))}const Vc=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;function Vs(e,t){e.d(1),t.delete(e.key)}function js(e,t,a,o,m,n,M,T,O,g,N,u){let y=e.length,k=n.length,r=y;const H={};for(;r--;)H[e[r].key]=r;const j=[],V=new Map,d=new Map;for(r=k;r--;){const B=u(m,n,r),i=a(B);let E=M.get(i);E?o&&E.p(B,t):(E=g(i,B),E.c()),V.set(i,j[r]=E),i in H&&d.set(i,Math.abs(r-H[i]))}const R=new Set,x=new Set;function C(B){Ic(B,1),B.m(T,N),M.set(B.key,B),N=B.first,k--}for(;y&&k;){const B=j[k-1],i=e[y-1],E=B.key,p=i.key;B===i?(N=B.first,y--,k--):V.has(p)?!M.has(E)||R.has(E)?C(B):x.has(p)?y--:d.get(E)>d.get(p)?(x.add(E),C(B)):(R.add(p),y--):(O(i,M),y--)}for(;y--;){const B=e[y];V.has(B.key)||O(B,M)}for(;k;)C(j[k-1]);return j}function jc(e,t,a,o){const{fragment:m,on_mount:n,on_destroy:M,after_update:T}=e.$$;m&&m.m(t,a),o||_n(()=>{const O=n.map(Uo).filter(zo);M?M.push(...O):Ls(O),e.$$.on_mount=[]}),T.forEach(_n)}function Hc(e,t){const a=e.$$;a.fragment!==null&&(Ls(a.on_destroy),a.fragment&&a.fragment.d(t),a.on_destroy=a.fragment=null,a.ctx=[])}function Pc(e,t){e.$$.dirty[0]===-1&&(Is.push(e),Ko(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Fc(e,t,a,o,m,n,M,T=[-1]){const O=mn;Ns(e);const g=e.$$={fragment:null,ctx:null,props:n,update:Os,not_equal:m,bound:qo(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(O?O.$$.context:[]),callbacks:qo(),dirty:T,skip_bound:!1,root:t.target||O.$$.root};M&&M(g.root);let N=!1;g.ctx=a?a(e,t.props||{},(u,y,...k)=>{const r=k.length?k[0]:y;return g.ctx&&m(g.ctx[u],g.ctx[u]=r)&&(!g.skip_bound&&g.bound[u]&&g.bound[u](r),N&&Pc(e,u)),y}):[],g.update(),N=!0,Ls(g.before_update),g.fragment=o?o(g.ctx):!1,t.target&&(g.fragment&&g.fragment.c(),jc(e,t.target,void 0,void 0),Zo()),Ns(O)}class Dc{$destroy(){Hc(this,1),this.$destroy=Os}$on(t,a){const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(a),()=>{const m=o.indexOf(a);m!==-1&&o.splice(m,1)}}$set(t){this.$$set&&!Bc(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Wo=[[-1,"\u2728","custom"],[0,"\u{1F600}","smileys-emotion"],[1,"\u{1F44B}","people-body"],[3,"\u{1F431}","animals-nature"],[4,"\u{1F34E}","food-drink"],[5,"\u{1F3E0}\uFE0F","travel-places"],[6,"\u26BD","activities"],[7,"\u{1F4DD}","objects"],[8,"\u26D4\uFE0F","symbols"],[9,"\u{1F3C1}","flags"]].map(([e,t,a])=>({id:e,emoji:t,name:a})),gr=Wo.slice(1),Uc=Wo[0],qc=2,Qo=6,$o=typeof requestIdleCallback=="function"?requestIdleCallback:setTimeout;function Jo(e){return e.unicode.includes("\u200D")}const zc={"\u{1FAE0}":14,"\u{1F972}":13.1,"\u{1F97B}":12.1,"\u{1F970}":11,"\u{1F929}":5,"\u{1F471}\u200D\u2640\uFE0F":4,"\u{1F923}":3,"\u{1F441}\uFE0F\u200D\u{1F5E8}\uFE0F":2,"\u{1F600}":1,"\u{1F610}\uFE0F":.7,"\u{1F603}":.6},Xc=1e3,Yc="\u{1F590}\uFE0F",Gc=8,Kc=["\u{1F60A}","\u{1F612}","\u2665\uFE0F","\u{1F44D}\uFE0F","\u{1F60D}","\u{1F602}","\u{1F62D}","\u263A\uFE0F","\u{1F614}","\u{1F629}","\u{1F60F}","\u{1F495}","\u{1F64C}","\u{1F618}"],ei='"Twemoji Mozilla","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji","EmojiOne Color","Android Emoji",sans-serif',Zc=(e,t)=>e<t?-1:e>t?1:0,ti=(e,t)=>{const a=document.createElement("canvas");a.width=a.height=1;const o=a.getContext("2d");return o.textBaseline="top",o.font=`100px ${ei}`,o.fillStyle=t,o.scale(.01,.01),o.fillText(e,0,0),o.getImageData(0,0,1,1).data},Wc=(e,t)=>{const a=[...e].join(","),o=[...t].join(",");return a===o&&!a.startsWith("0,0,0,")};function Qc(e){const t=ti(e,"#000"),a=ti(e,"#fff");return t&&a&&Wc(t,a)}function $c(){const e=Object.entries(zc);try{for(const[t,a]of e)if(Qc(t))return a}catch{}finally{}return e[0][1]}const fn=new Promise(e=>$o(()=>e($c()))),vn=new Map,Jc="\uFE0F",ed="\uD83C",td="\u200D",ad=127995,sd=57339;function rd(e,t){if(t===0)return e;const a=e.indexOf(td);return a!==-1?e.substring(0,a)+String.fromCodePoint(ad+t-1)+e.substring(a):(e.endsWith(Jc)&&(e=e.substring(0,e.length-1)),e+ed+String.fromCodePoint(sd+t-1))}function ya(e){e.preventDefault(),e.stopPropagation()}function gn(e,t,a){return t+=e?-1:1,t<0?t=a.length-1:t>=a.length&&(t=0),t}function ai(e,t){const a=new Set,o=[];for(const m of e){const n=t(m);a.has(n)||(a.add(n),o.push(m))}return o}function nd(e,t){const a=o=>{const m={};for(const n of o)typeof n.tone=="number"&&n.version<=t&&(m[n.tone]=n.unicode);return m};return e.map(({unicode:o,skins:m,shortcodes:n,url:M,name:T,category:O})=>({unicode:o,name:T,shortcodes:n,url:M,category:O,id:o||T,skins:m&&a(m),title:(n||[]).join(", ")}))}const pr=requestAnimationFrame;let od=typeof ResizeObserver=="function";function id(e,t){let a;return od?(a=new ResizeObserver(o=>t(o[0].contentRect.width)),a.observe(e)):pr(()=>t(e.getBoundingClientRect().width)),{destroy(){a&&a.disconnect()}}}function si(e){{const t=document.createRange();return t.selectNode(e.firstChild),t.getBoundingClientRect().width}}let pn;function ld(e,t,a){for(const o of e){const m=a(o),n=si(m);typeof pn=="undefined"&&(pn=si(t));const M=n/1.8<pn;vn.set(o.unicode,M)}}function cd(e){return ai(e,t=>t)}const{Map:Hs}=Vc;function ri(e,t,a){const o=e.slice();return o[63]=t[a],o[65]=a,o}function ni(e,t,a){const o=e.slice();return o[66]=t[a],o[65]=a,o}function oi(e,t,a){const o=e.slice();return o[63]=t[a],o[65]=a,o}function ii(e,t,a){const o=e.slice();return o[69]=t[a],o}function li(e,t,a){const o=e.slice();return o[72]=t[a],o[65]=a,o}function ci(e,t){let a,o=t[72]+"",m,n,M,T,O,g;return{key:e,first:null,c(){a=qe("div"),m=aa(o),Q(a,"id",n="skintone-"+t[65]),Q(a,"class",M="emoji hide-focus "+(t[65]===t[20]?"active":"")),Q(a,"aria-selected",T=t[65]===t[20]),Q(a,"role","option"),Q(a,"title",O=t[0].skinTones[t[65]]),Q(a,"tabindex","-1"),Q(a,"aria-label",g=t[0].skinTones[t[65]]),this.first=a},m(N,u){Gt(N,a,u),Xe(a,m)},p(N,u){t=N,u[0]&512&&o!==(o=t[72]+"")&&sa(m,o),u[0]&512&&n!==(n="skintone-"+t[65])&&Q(a,"id",n),u[0]&1049088&&M!==(M="emoji hide-focus "+(t[65]===t[20]?"active":""))&&Q(a,"class",M),u[0]&1049088&&T!==(T=t[65]===t[20])&&Q(a,"aria-selected",T),u[0]&513&&O!==(O=t[0].skinTones[t[65]])&&Q(a,"title",O),u[0]&513&&g!==(g=t[0].skinTones[t[65]])&&Q(a,"aria-label",g)},d(N){N&&Kt(a)}}}function di(e,t){let a,o,m=t[69].emoji+"",n,M,T,O,g,N,u;function y(){return t[49](t[69])}return{key:e,first:null,c(){a=qe("button"),o=qe("div"),n=aa(m),Q(o,"class","nav-emoji emoji"),Q(a,"role","tab"),Q(a,"class","nav-button"),Q(a,"aria-controls",M="tab-"+t[69].id),Q(a,"aria-label",T=t[0].categories[t[69].name]),Q(a,"aria-selected",O=!t[4]&&t[13].id===t[69].id),Q(a,"title",g=t[0].categories[t[69].name]),this.first=a},m(k,r){Gt(k,a,r),Xe(a,o),Xe(o,n),N||(u=Zt(a,"click",y),N=!0)},p(k,r){t=k,r[0]&4096&&m!==(m=t[69].emoji+"")&&sa(n,m),r[0]&4096&&M!==(M="tab-"+t[69].id)&&Q(a,"aria-controls",M),r[0]&4097&&T!==(T=t[0].categories[t[69].name])&&Q(a,"aria-label",T),r[0]&12304&&O!==(O=!t[4]&&t[13].id===t[69].id)&&Q(a,"aria-selected",O),r[0]&4097&&g!==(g=t[0].categories[t[69].name])&&Q(a,"title",g)},d(k){k&&Kt(a),N=!1,u()}}}function dd(e){let t,a;return{c(){t=qe("img"),Q(t,"class","custom-emoji"),ur(t.src,a=e[63].url)||Q(t,"src",a),Q(t,"alt",""),Q(t,"loading","lazy")},m(o,m){Gt(o,t,m)},p(o,m){m[0]&32768&&!ur(t.src,a=o[63].url)&&Q(t,"src",a)},d(o){o&&Kt(t)}}}function md(e){let t=e[27](e[63],e[8])+"",a;return{c(){a=aa(t)},m(o,m){Gt(o,a,m)},p(o,m){m[0]&33024&&t!==(t=o[27](o[63],o[8])+"")&&sa(a,t)},d(o){o&&Kt(a)}}}function mi(e,t){let a,o,m,n,M,T,O;function g(y,k){return y[63].unicode?md:dd}let N=g(t),u=N(t);return{key:e,first:null,c(){a=qe("button"),u.c(),Q(a,"role",o=t[4]?"option":"menuitem"),Q(a,"aria-selected",m=t[4]?t[65]==t[5]:""),Q(a,"aria-label",n=t[28](t[63],t[8])),Q(a,"title",M=t[63].title),Q(a,"class",T="emoji "+(t[4]&&t[65]===t[5]?"active":"")),Q(a,"id",O="emo-"+t[63].id),this.first=a},m(y,k){Gt(y,a,k),u.m(a,null)},p(y,k){t=y,N===(N=g(t))&&u?u.p(t,k):(u.d(1),u=N(t),u&&(u.c(),u.m(a,null))),k[0]&16&&o!==(o=t[4]?"option":"menuitem")&&Q(a,"role",o),k[0]&32816&&m!==(m=t[4]?t[65]==t[5]:"")&&Q(a,"aria-selected",m),k[0]&33024&&n!==(n=t[28](t[63],t[8]))&&Q(a,"aria-label",n),k[0]&32768&&M!==(M=t[63].title)&&Q(a,"title",M),k[0]&32816&&T!==(T="emoji "+(t[4]&&t[65]===t[5]?"active":""))&&Q(a,"class",T),k[0]&32768&&O!==(O="emo-"+t[63].id)&&Q(a,"id",O)},d(y){y&&Kt(a),u.d()}}}function hi(e,t){let a,o=(t[4]?t[0].searchResultsLabel:t[66].category?t[66].category:t[15].length>1?t[0].categories.custom:t[0].categories[t[13].name])+"",m,n,M,T,O=[],g=new Hs,N,u,y,k=t[66].emojis;const r=H=>H[63].id;for(let H=0;H<k.length;H+=1){let j=oi(t,k,H),V=r(j);g.set(V,O[H]=mi(V,j))}return{key:e,first:null,c(){a=qe("div"),m=aa(o),T=qe("div");for(let H=0;H<O.length;H+=1)O[H].c();Q(a,"id",n="menu-label-"+t[65]),Q(a,"class",M="category "+(t[15].length===1&&t[15][0].category===""?"gone":"")),Q(a,"aria-hidden","true"),Q(T,"class","emoji-menu"),Q(T,"role",N=t[4]?"listbox":"menu"),Q(T,"aria-labelledby",u="menu-label-"+t[65]),Q(T,"id",y=t[4]?"search-results":""),this.first=a},m(H,j){Gt(H,a,j),Xe(a,m),Gt(H,T,j);for(let V=0;V<O.length;V+=1)O[V].m(T,null)},p(H,j){t=H,j[0]&40977&&o!==(o=(t[4]?t[0].searchResultsLabel:t[66].category?t[66].category:t[15].length>1?t[0].categories.custom:t[0].categories[t[13].name])+"")&&sa(m,o),j[0]&32768&&n!==(n="menu-label-"+t[65])&&Q(a,"id",n),j[0]&32768&&M!==(M="category "+(t[15].length===1&&t[15][0].category===""?"gone":""))&&Q(a,"class",M),j[0]&402686256&&(k=t[66].emojis,O=js(O,j,r,1,t,k,g,T,Vs,mi,null,oi)),j[0]&16&&N!==(N=t[4]?"listbox":"menu")&&Q(T,"role",N),j[0]&32768&&u!==(u="menu-label-"+t[65])&&Q(T,"aria-labelledby",u),j[0]&16&&y!==(y=t[4]?"search-results":"")&&Q(T,"id",y)},d(H){H&&Kt(a),H&&Kt(T);for(let j=0;j<O.length;j+=1)O[j].d()}}}function hd(e){let t,a;return{c(){t=qe("img"),Q(t,"class","custom-emoji"),ur(t.src,a=e[63].url)||Q(t,"src",a),Q(t,"alt",""),Q(t,"loading","lazy")},m(o,m){Gt(o,t,m)},p(o,m){m[0]&1024&&!ur(t.src,a=o[63].url)&&Q(t,"src",a)},d(o){o&&Kt(t)}}}function _d(e){let t=e[27](e[63],e[8])+"",a;return{c(){a=aa(t)},m(o,m){Gt(o,a,m)},p(o,m){m[0]&1280&&t!==(t=o[27](o[63],o[8])+"")&&sa(a,t)},d(o){o&&Kt(a)}}}function _i(e,t){let a,o,m,n;function M(g,N){return g[63].unicode?_d:hd}let T=M(t),O=T(t);return{key:e,first:null,c(){a=qe("button"),O.c(),Q(a,"role","menuitem"),Q(a,"aria-label",o=t[28](t[63],t[8])),Q(a,"title",m=t[63].title),Q(a,"class","emoji"),Q(a,"id",n="fav-"+t[63].id),this.first=a},m(g,N){Gt(g,a,N),O.m(a,null)},p(g,N){t=g,T===(T=M(t))&&O?O.p(t,N):(O.d(1),O=T(t),O&&(O.c(),O.m(a,null))),N[0]&1280&&o!==(o=t[28](t[63],t[8]))&&Q(a,"aria-label",o),N[0]&1024&&m!==(m=t[63].title)&&Q(a,"title",m),N[0]&1024&&n!==(n="fav-"+t[63].id)&&Q(a,"id",n)},d(g){g&&Kt(a),O.d()}}}function ud(e){let t,a,o,m,n,M,T,O,g,N=e[0].searchLabel+"",u,y,k=e[0].searchDescription+"",r,H,j,V,d,R,x,C=e[0].skinToneDescription+"",B,i,E=[],p=new Hs,h,b,S,c,_,f=[],L=new Hs,Y,F,U,l,v,Z,W,se,me=[],ce=new Hs,he,ke,ve,de,Re,je=[],Be=new Hs,De,He,Pe,Ge,St,_t,lt=e[9];const Et=le=>le[72];for(let le=0;le<lt.length;le+=1){let ge=li(e,lt,le),J=Et(ge);p.set(J,E[le]=ci(J,ge))}let Ot=e[12];const Pt=le=>le[69].id;for(let le=0;le<Ot.length;le+=1){let ge=ii(e,Ot,le),J=Pt(ge);L.set(J,f[le]=di(J,ge))}let ht=e[15];const Yt=le=>le[66].category;for(let le=0;le<ht.length;le+=1){let ge=ni(e,ht,le),J=Yt(ge);ce.set(J,me[le]=hi(J,ge))}let kt=e[10];const ft=le=>le[63].id;for(let le=0;le<kt.length;le+=1){let ge=ri(e,kt,le),J=ft(ge);Be.set(J,je[le]=_i(J,ge))}return{c(){t=qe("section"),a=qe("div"),o=qe("div"),m=qe("div"),n=qe("input"),g=qe("label"),u=aa(N),y=qe("span"),r=aa(k),H=qe("div"),j=qe("button"),V=aa(e[21]),x=qe("span"),B=aa(C),i=qe("div");for(let le=0;le<E.length;le+=1)E[le].c();_=qe("div");for(let le=0;le<f.length;le+=1)f[le].c();F=qe("div"),U=qe("div"),l=qe("div"),v=aa(e[18]),W=qe("div"),se=qe("div");for(let le=0;le<me.length;le+=1)me[le].c();Re=qe("div");for(let le=0;le<je.length;le+=1)je[le].c();Pe=qe("button"),Pe.textContent="\u{1F600}",Q(a,"class","pad-top"),Q(n,"id","search"),Q(n,"class","search"),Q(n,"type","search"),Q(n,"role","combobox"),Q(n,"enterkeyhint","search"),Q(n,"placeholder",M=e[0].searchLabel),Q(n,"autocapitalize","none"),Q(n,"autocomplete","off"),Q(n,"spellcheck","true"),Q(n,"aria-expanded",T=!!(e[4]&&e[1].length)),Q(n,"aria-controls","search-results"),Q(n,"aria-describedby","search-description"),Q(n,"aria-autocomplete","list"),Q(n,"aria-activedescendant",O=e[26]?`emo-${e[26]}`:""),Q(g,"class","sr-only"),Q(g,"for","search"),Q(y,"id","search-description"),Q(y,"class","sr-only"),Q(m,"class","search-wrapper"),Q(j,"id","skintone-button"),Q(j,"class",d="emoji "+(e[6]?"hide-focus":"")),Q(j,"aria-label",e[23]),Q(j,"title",e[23]),Q(j,"aria-describedby","skintone-description"),Q(j,"aria-haspopup","listbox"),Q(j,"aria-expanded",e[6]),Q(j,"aria-controls","skintone-list"),Q(H,"class",R="skintone-button-wrapper "+(e[19]?"expanded":"")),Q(x,"id","skintone-description"),Q(x,"class","sr-only"),Q(i,"id","skintone-list"),Q(i,"class",h="skintone-list "+(e[6]?"":"hidden no-animate")),ba(i,"transform","translateY("+(e[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),Q(i,"role","listbox"),Q(i,"aria-label",b=e[0].skinTonesLabel),Q(i,"aria-activedescendant",S="skintone-"+e[20]),Q(i,"aria-hidden",c=!e[6]),Q(o,"class","search-row"),Q(_,"class","nav"),Q(_,"role","tablist"),ba(_,"grid-template-columns","repeat("+e[12].length+", 1fr)"),Q(_,"aria-label",Y=e[0].categoriesLabel),Q(U,"class","indicator"),ba(U,"transform","translateX("+(e[24]?-1:1)*e[11]*100+"%)"),Q(F,"class","indicator-wrapper"),Q(l,"class",Z="message "+(e[18]?"":"gone")),Q(l,"role","alert"),Q(l,"aria-live","polite"),Q(W,"class",he="tabpanel "+(!e[14]||e[18]?"gone":"")),Q(W,"role",ke=e[4]?"region":"tabpanel"),Q(W,"aria-label",ve=e[4]?e[0].searchResultsLabel:e[0].categories[e[13].name]),Q(W,"id",de=e[4]?"":`tab-${e[13].id}`),Q(W,"tabindex","0"),Q(Re,"class",De="favorites emoji-menu "+(e[18]?"gone":"")),Q(Re,"role","menu"),Q(Re,"aria-label",He=e[0].favoritesLabel),ba(Re,"padding-inline-end",e[25]+"px"),Q(Pe,"aria-hidden","true"),Q(Pe,"tabindex","-1"),Q(Pe,"class","abs-pos hidden emoji"),Q(t,"class","picker"),Q(t,"aria-label",Ge=e[0].regionLabel),Q(t,"style",e[22])},m(le,ge){Gt(le,t,ge),Xe(t,a),Xe(t,o),Xe(o,m),Xe(m,n),Xo(n,e[2]),Xe(m,g),Xe(g,u),Xe(m,y),Xe(y,r),Xe(o,H),Xe(H,j),Xe(j,V),Xe(o,x),Xe(x,B),Xe(o,i);for(let J=0;J<E.length;J+=1)E[J].m(i,null);e[48](i),Xe(t,_);for(let J=0;J<f.length;J+=1)f[J].m(_,null);Xe(t,F),Xe(F,U),Xe(t,l),Xe(l,v),Xe(t,W),Xe(W,se);for(let J=0;J<me.length;J+=1)me[J].m(se,null);e[50](W),Xe(t,Re);for(let J=0;J<je.length;J+=1)je[J].m(Re,null);Xe(t,Pe),e[51](Pe),e[52](t),St||(_t=[Zt(n,"input",e[47]),Zt(n,"keydown",e[30]),Zt(j,"click",e[35]),Zt(i,"focusout",e[38]),Zt(i,"click",e[34]),Zt(i,"keydown",e[36]),Zt(i,"keyup",e[37]),Zt(_,"keydown",e[32]),Cc(e[29].call(null,se)),Zt(W,"click",e[33]),Zt(Re,"click",e[33])],St=!0)},p(le,ge){ge[0]&1&&M!==(M=le[0].searchLabel)&&Q(n,"placeholder",M),ge[0]&18&&T!==(T=!!(le[4]&&le[1].length))&&Q(n,"aria-expanded",T),ge[0]&67108864&&O!==(O=le[26]?`emo-${le[26]}`:"")&&Q(n,"aria-activedescendant",O),ge[0]&4&&Xo(n,le[2]),ge[0]&1&&N!==(N=le[0].searchLabel+"")&&sa(u,N),ge[0]&1&&k!==(k=le[0].searchDescription+"")&&sa(r,k),ge[0]&2097152&&sa(V,le[21]),ge[0]&64&&d!==(d="emoji "+(le[6]?"hide-focus":""))&&Q(j,"class",d),ge[0]&8388608&&Q(j,"aria-label",le[23]),ge[0]&8388608&&Q(j,"title",le[23]),ge[0]&64&&Q(j,"aria-expanded",le[6]),ge[0]&524288&&R!==(R="skintone-button-wrapper "+(le[19]?"expanded":""))&&Q(H,"class",R),ge[0]&1&&C!==(C=le[0].skinToneDescription+"")&&sa(B,C),ge[0]&1049089&&(lt=le[9],E=js(E,ge,Et,1,le,lt,p,i,Vs,ci,null,li)),ge[0]&64&&h!==(h="skintone-list "+(le[6]?"":"hidden no-animate"))&&Q(i,"class",h),ge[0]&64&&ba(i,"transform","translateY("+(le[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),ge[0]&1&&b!==(b=le[0].skinTonesLabel)&&Q(i,"aria-label",b),ge[0]&1048576&&S!==(S="skintone-"+le[20])&&Q(i,"aria-activedescendant",S),ge[0]&64&&c!==(c=!le[6])&&Q(i,"aria-hidden",c),ge[0]&12305|ge[1]&1&&(Ot=le[12],f=js(f,ge,Pt,1,le,Ot,L,_,Vs,di,null,ii)),ge[0]&4096&&ba(_,"grid-template-columns","repeat("+le[12].length+", 1fr)"),ge[0]&1&&Y!==(Y=le[0].categoriesLabel)&&Q(_,"aria-label",Y),ge[0]&16779264&&ba(U,"transform","translateX("+(le[24]?-1:1)*le[11]*100+"%)"),ge[0]&262144&&sa(v,le[18]),ge[0]&262144&&Z!==(Z="message "+(le[18]?"":"gone"))&&Q(l,"class",Z),ge[0]&402694449&&(ht=le[15],me=js(me,ge,Yt,1,le,ht,ce,se,Vs,hi,null,ni)),ge[0]&278528&&he!==(he="tabpanel "+(!le[14]||le[18]?"gone":""))&&Q(W,"class",he),ge[0]&16&&ke!==(ke=le[4]?"region":"tabpanel")&&Q(W,"role",ke),ge[0]&8209&&ve!==(ve=le[4]?le[0].searchResultsLabel:le[0].categories[le[13].name])&&Q(W,"aria-label",ve),ge[0]&8208&&de!==(de=le[4]?"":`tab-${le[13].id}`)&&Q(W,"id",de),ge[0]&402654464&&(kt=le[10],je=js(je,ge,ft,1,le,kt,Be,Re,Vs,_i,null,ri)),ge[0]&262144&&De!==(De="favorites emoji-menu "+(le[18]?"gone":""))&&Q(Re,"class",De),ge[0]&1&&He!==(He=le[0].favoritesLabel)&&Q(Re,"aria-label",He),ge[0]&33554432&&ba(Re,"padding-inline-end",le[25]+"px"),ge[0]&1&&Ge!==(Ge=le[0].regionLabel)&&Q(t,"aria-label",Ge),ge[0]&4194304&&Q(t,"style",le[22])},i:Os,o:Os,d(le){le&&Kt(t);for(let ge=0;ge<E.length;ge+=1)E[ge].d();e[48](null);for(let ge=0;ge<f.length;ge+=1)f[ge].d();for(let ge=0;ge<me.length;ge+=1)me[ge].d();e[50](null);for(let ge=0;ge<je.length;ge+=1)je[ge].d();e[51](null),e[52](null),St=!1,Ls(_t)}}}function fd(e,t,a){let{skinToneEmoji:o}=t,{i18n:m}=t,{database:n}=t,{customEmoji:M}=t,{customCategorySorting:T}=t,O=!0,g=[],N=[],u="",y="",k,r,H,j=!1,V=-1,d,R=!1,x=!1,C,B=0,i=0,E,p,h="",b=[],S=[],c,_=Gc,f=!1,L=0,Y=0,F=gr,U,l=!1,v;const Z=J=>{k.getRootNode().getElementById(J).focus()},W=(J,be)=>{k.dispatchEvent(new CustomEvent(J,{detail:be,bubbles:!0,composed:!0}))},se=(J,be)=>be&&J.skins&&J.skins[be]||J.unicode,me=(J,be)=>cd([J.name||se(J,be),...J.shortcodes||[]]).join(", "),ce=J=>/^skintone-/.test(J.id);fn.then(J=>{J||a(18,d=m.emojiUnsupportedMessage)});function he(J){return id(J,be=>{{const w=getComputedStyle(k),A=parseInt(w.getPropertyValue("--num-columns"),10),P=w.getPropertyValue("direction")==="rtl",z=J.parentElement.getBoundingClientRect().width-be;a(46,_=A),a(25,L=z),a(24,f=P)}})}function ke(J){const be=k.getRootNode();ld(J,r,A=>be.getElementById(`emo-${A.id}`)),a(1,g=g)}function ve(J){return!J.unicode||!Jo(J)||vn.get(J.unicode)}async function de(J){const be=await fn;return J.filter(({version:w})=>!w||w<=be)}async function Re(J){return nd(J,await fn)}async function je(J){if(typeof J=="undefined")return[];const be=J===-1?M:await n.getEmojiByGroup(J);return Re(await de(be))}async function Be(J){return Re(await de(await n.getEmojiBySearchQuery(J)))}function De(J){if(!j||!g.length)return;const be=w=>{ya(J),a(5,V=gn(w,V,g))};switch(J.key){case"ArrowDown":return be(!1);case"ArrowUp":return be(!0);case"Enter":if(V!==-1)return ya(J),Ge(g[V].id);g.length&&a(5,V=0)}}function He(J){a(2,u=""),a(44,y=""),a(5,V=-1),a(11,Y=F.findIndex(be=>be.id===J.id))}function Pe(J){const{target:be,key:w}=J,A=P=>{P&&(ya(J),P.focus())};switch(w){case"ArrowLeft":return A(be.previousSibling);case"ArrowRight":return A(be.nextSibling);case"Home":return A(be.parentElement.firstChild);case"End":return A(be.parentElement.lastChild)}}async function Ge(J){const be=await n.getEmojiByUnicodeOrName(J),w=[...g,...S].find(P=>P.id===J),A=w.unicode&&se(w,B);await n.incrementFavoriteEmojiCount(J),W("emoji-click",{emoji:be,skinTone:B,...A&&{unicode:A},...w.name&&{name:w.name}})}async function St(J){const{target:be}=J;if(!be.classList.contains("emoji"))return;ya(J);const w=be.id.substring(4);Ge(w)}async function _t(J){const{target:be}=J;if(!ce(be))return;ya(J);const w=parseInt(be.id.slice(9),10);a(8,B=w),a(6,R=!1),Z("skintone-button"),W("skin-tone-change",{skinTone:w}),n.setPreferredSkinTone(w)}async function lt(J){a(6,R=!R),a(20,i=B),R&&(ya(J),pr(()=>Z(`skintone-${i}`)))}function Et(J){if(!R)return;const be=async w=>{ya(J),a(20,i=w),await Oc(),Z(`skintone-${i}`)};switch(J.key){case"ArrowUp":return be(gn(!0,i,b));case"ArrowDown":return be(gn(!1,i,b));case"Home":return be(0);case"End":return be(b.length-1);case"Enter":return _t(J);case"Escape":return ya(J),a(6,R=!1),Z("skintone-button")}}function Ot(J){if(!!R)switch(J.key){case" ":return _t(J)}}async function Pt(J){const{relatedTarget:be}=J;(!be||!ce(be))&&a(6,R=!1)}function ht(){u=this.value,a(2,u)}function Yt(J){as[J?"unshift":"push"](()=>{C=J,a(7,C)})}const kt=J=>He(J);function ft(J){as[J?"unshift":"push"](()=>{H=J,a(3,H)})}function le(J){as[J?"unshift":"push"](()=>{r=J,a(17,r)})}function ge(J){as[J?"unshift":"push"](()=>{k=J,a(16,k)})}return e.$$set=J=>{"skinToneEmoji"in J&&a(40,o=J.skinToneEmoji),"i18n"in J&&a(0,m=J.i18n),"database"in J&&a(39,n=J.database),"customEmoji"in J&&a(41,M=J.customEmoji),"customCategorySorting"in J&&a(42,T=J.customCategorySorting)},e.$$.update=()=>{if(e.$$.dirty[1]&1280&&M&&n&&a(39,n.customEmoji=M,n),e.$$.dirty[0]&1|e.$$.dirty[1]&256){async function J(){let be=!1;const w=setTimeout(()=>{be=!0,a(18,d=m.loadingMessage)},Xc);try{await n.ready(),a(14,l=!0)}catch(A){console.error(A),a(18,d=m.networkErrorMessage)}finally{clearTimeout(w),be&&(be=!1,a(18,d=""))}}n&&J()}if(e.$$.dirty[0]&6144|e.$$.dirty[1]&1024&&(M&&M.length?a(12,F=[Uc,...gr]):F!==gr&&(Y&&a(11,Y--,Y),a(12,F=gr))),e.$$.dirty[0]&4&&$o(()=>{a(44,y=(u||"").trim()),a(5,V=-1)}),e.$$.dirty[0]&6144&&a(13,U=F[Y]),e.$$.dirty[0]&24576|e.$$.dirty[1]&8192){async function J(){if(!l)a(1,g=[]),a(4,j=!1);else if(y.length>=qc){const be=y,w=await Be(be);be===y&&(a(1,g=w),a(4,j=!0))}else if(U){const be=U.id,w=await je(be);be===U.id&&(a(1,g=w),a(4,j=!1))}}J()}if(e.$$.dirty[0]&4112&&a(22,p=`
  --font-family: ${ei};
  --num-groups: ${F.length}; 
  --indicator-opacity: ${j?0:1}; 
  --num-skintones: ${Qo};`),e.$$.dirty[0]&16384|e.$$.dirty[1]&256){async function J(){l&&a(8,B=await n.getPreferredSkinTone())}J()}if(e.$$.dirty[1]&512&&a(9,b=Array(Qo).fill().map((J,be)=>rd(o,be))),e.$$.dirty[0]&768&&a(21,E=b[B]),e.$$.dirty[0]&257&&a(23,h=m.skinToneLabel.replace("{skinTone}",m.skinTones[B])),e.$$.dirty[0]&16384|e.$$.dirty[1]&256){async function J(){a(45,c=(await Promise.all(Kc.map(be=>n.getEmojiByUnicodeOrName(be)))).filter(Boolean))}l&&J()}if(e.$$.dirty[0]&16384|e.$$.dirty[1]&49408){async function J(){const be=await n.getTopFavoriteEmoji(_),w=await Re(ai([...be,...c],A=>A.unicode||A.name).slice(0,_));a(10,S=w)}l&&c&&J()}if(e.$$.dirty[0]&10){const J=g.filter(be=>be.unicode).filter(be=>Jo(be)&&!vn.has(be.unicode));J.length?pr(()=>ke(J)):(a(1,g=g.filter(ve)),pr(()=>{(H||{}).scrollTop=0}))}e.$$.dirty[0]&1026|e.$$.dirty[1]&4096,e.$$.dirty[0]&18|e.$$.dirty[1]&2048&&a(15,N=function(){if(j)return[{category:"",emojis:g}];const be=new Map;for(const w of g){const A=w.category||"";let P=be.get(A);P||(P=[],be.set(A,P)),P.push(w)}return[...be.entries()].map(([w,A])=>({category:w,emojis:A})).sort((w,A)=>T(w.category,A.category))}()),e.$$.dirty[0]&34&&a(26,v=V!==-1&&g[V].id),e.$$.dirty[0]&192&&(R?C.addEventListener("transitionend",()=>{a(19,x=!0)},{once:!0}):a(19,x=!1))},[m,g,u,H,j,V,R,C,B,b,S,Y,F,U,l,N,k,r,d,x,i,E,p,h,f,L,v,se,me,he,De,He,Pe,St,_t,lt,Et,Ot,Pt,n,o,M,T,O,y,c,_,ht,Yt,kt,ft,le,ge]}class vd extends Dc{constructor(t){super(),Fc(this,t,fd,ud,xc,{skinToneEmoji:40,i18n:0,database:39,customEmoji:41,customCategorySorting:42},null,[-1,-1,-1])}}const gd="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",pd="en";var bd={categoriesLabel:"Categories",emojiUnsupportedMessage:"Your browser does not support color emoji.",favoritesLabel:"Favorites",loadingMessage:"Loading\u2026",networkErrorMessage:"Could not load emoji.",regionLabel:"Emoji picker",searchDescription:"When search results are available, press up or down to select and enter to choose.",searchLabel:"Search",searchResultsLabel:"Search results",skinToneDescription:"When expanded, press up or down to select and enter to choose.",skinToneLabel:"Choose a skin tone (currently {skinTone})",skinTonesLabel:"Skin tones",skinTones:["Default","Light","Medium-Light","Medium","Medium-Dark","Dark"],categories:{custom:"Custom","smileys-emotion":"Smileys and emoticons","people-body":"People and body","animals-nature":"Animals and nature","food-drink":"Food and drink","travel-places":"Travel and places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"}};const ui=["customEmoji","customCategorySorting","database","dataSource","i18n","locale","skinToneEmoji"];class fi extends HTMLElement{constructor(t){super(),this.attachShadow({mode:"open"});const a=document.createElement("style");a.textContent=":host{--emoji-size:1.375rem;--emoji-padding:0.5rem;--category-emoji-size:var(--emoji-size);--category-emoji-padding:var(--emoji-padding);--indicator-height:3px;--input-border-radius:0.5rem;--input-border-size:1px;--input-font-size:1rem;--input-line-height:1.5;--input-padding:0.25rem;--num-columns:8;--outline-size:2px;--border-size:1px;--skintone-border-radius:1rem;--category-font-size:1rem;display:flex;width:min-content;height:400px}:host,:host(.light){--background:#fff;--border-color:#e0e0e0;--indicator-color:#385ac1;--input-border-color:#999;--input-font-color:#111;--input-placeholder-color:#999;--outline-color:#999;--category-font-color:#111;--button-active-background:#e6e6e6;--button-hover-background:#d9d9d9}:host(.dark){--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}@media (prefers-color-scheme:dark){:host{--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}}:host([hidden]){display:none}button{margin:0;padding:0;border:0;background:0 0;box-shadow:none;-webkit-tap-highlight-color:transparent}button::-moz-focus-inner{border:0}input{padding:0;margin:0;line-height:1.15;font-family:inherit}input[type=search]{-webkit-appearance:none}:focus{outline:var(--outline-color) solid var(--outline-size);outline-offset:calc(-1*var(--outline-size))}:host([data-js-focus-visible]) :focus:not([data-focus-visible-added]){outline:0}:focus:not(:focus-visible){outline:0}.hide-focus{outline:0}*{box-sizing:border-box}.picker{contain:content;display:flex;flex-direction:column;background:var(--background);border:var(--border-size) solid var(--border-color);width:100%;height:100%;overflow:hidden;--total-emoji-size:calc(var(--emoji-size) + (2 * var(--emoji-padding)));--total-category-emoji-size:calc(var(--category-emoji-size) + (2 * var(--category-emoji-padding)))}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.hidden{opacity:0;pointer-events:none}.abs-pos{position:absolute;left:0;top:0}.gone{display:none!important}.skintone-button-wrapper,.skintone-list{background:var(--background);z-index:3}.skintone-button-wrapper.expanded{z-index:1}.skintone-list{position:absolute;inset-inline-end:0;top:0;z-index:2;overflow:visible;border-bottom:var(--border-size) solid var(--border-color);border-radius:0 0 var(--skintone-border-radius) var(--skintone-border-radius);will-change:transform;transition:transform .2s ease-in-out;transform-origin:center 0}@media (prefers-reduced-motion:reduce){.skintone-list{transition-duration:.001s}}@supports not (inset-inline-end:0){.skintone-list{right:0}}.skintone-list.no-animate{transition:none}.tabpanel{overflow-y:auto;-webkit-overflow-scrolling:touch;will-change:transform;min-height:0;flex:1;contain:content}.emoji-menu{display:grid;grid-template-columns:repeat(var(--num-columns),var(--total-emoji-size));justify-content:space-around;align-items:flex-start;width:100%}.category{padding:var(--emoji-padding);font-size:var(--category-font-size);color:var(--category-font-color)}.custom-emoji,.emoji,button.emoji{height:var(--total-emoji-size);width:var(--total-emoji-size)}.emoji,button.emoji{font-size:var(--emoji-size);display:flex;align-items:center;justify-content:center;border-radius:100%;line-height:1;overflow:hidden;font-family:var(--font-family);cursor:pointer}@media (hover:hover) and (pointer:fine){.emoji:hover,button.emoji:hover{background:var(--button-hover-background)}}.emoji.active,.emoji:active,button.emoji.active,button.emoji:active{background:var(--button-active-background)}.custom-emoji{padding:var(--emoji-padding);object-fit:contain;pointer-events:none;background-repeat:no-repeat;background-position:center center;background-size:var(--emoji-size) var(--emoji-size)}.nav,.nav-button{align-items:center}.nav{display:grid;justify-content:space-between;contain:content}.nav-button{display:flex;justify-content:center}.nav-emoji{font-size:var(--category-emoji-size);width:var(--total-category-emoji-size);height:var(--total-category-emoji-size)}.indicator-wrapper{display:flex;border-bottom:1px solid var(--border-color)}.indicator{width:calc(100%/var(--num-groups));height:var(--indicator-height);opacity:var(--indicator-opacity);background-color:var(--indicator-color);will-change:transform,opacity;transition:opacity .1s linear,transform .25s ease-in-out}@media (prefers-reduced-motion:reduce){.indicator{will-change:opacity;transition:opacity .1s linear}}.pad-top,input.search{background:var(--background);width:100%}.pad-top{height:var(--emoji-padding);z-index:3}.search-row{display:flex;align-items:center;position:relative;padding-inline-start:var(--emoji-padding);padding-bottom:var(--emoji-padding)}.search-wrapper{flex:1;min-width:0}input.search{padding:var(--input-padding);border-radius:var(--input-border-radius);border:var(--input-border-size) solid var(--input-border-color);color:var(--input-font-color);font-size:var(--input-font-size);line-height:var(--input-line-height)}input.search::placeholder{color:var(--input-placeholder-color)}.favorites{display:flex;flex-direction:row;border-top:var(--border-size) solid var(--border-color);contain:content}.message{padding:var(--emoji-padding)}",this.shadowRoot.appendChild(a),this._ctx={locale:pd,dataSource:gd,skinToneEmoji:Yc,customCategorySorting:Zc,customEmoji:null,i18n:bd,...t};for(const o of ui)o!=="database"&&Object.prototype.hasOwnProperty.call(this,o)&&(this._ctx[o]=this[o],delete this[o]);this._dbFlush()}connectedCallback(){this._cmp=new vd({target:this.shadowRoot,props:this._ctx})}disconnectedCallback(){this._cmp.$destroy(),this._cmp=void 0;const{database:t}=this._ctx;t&&t.close().catch(a=>console.error(a))}static get observedAttributes(){return["locale","data-source","skin-tone-emoji"]}attributeChangedCallback(t,a,o){this._set(t.replace(/-([a-z])/g,(m,n)=>n.toUpperCase()),o)}_set(t,a){this._ctx[t]=a,this._cmp&&this._cmp.$set({[t]:a}),["locale","dataSource"].includes(t)&&this._dbFlush()}_dbCreate(){const{locale:t,dataSource:a,database:o}=this._ctx;(!o||o.locale!==t||o.dataSource!==a)&&this._set("database",new Do({locale:t,dataSource:a}))}_dbFlush(){Promise.resolve().then(()=>this._dbCreate())}}const vi={};for(const e of ui)vi[e]={get(){return e==="database"&&this._dbCreate(),this._ctx[e]},set(t){if(e==="database")throw new Error("database is read-only");this._set(e,t)}};Object.defineProperties(fi.prototype,vi),customElements.get("emoji-picker")||customElements.define("emoji-picker",fi);const yd={name:"EmojiPickerContainer",components:{SvgIcon:gt},props:{emojiOpened:{type:Boolean,default:!1},emojiReaction:{type:Boolean,default:!1},positionTop:{type:Boolean,default:!1},positionRight:{type:Boolean,default:!1}},emits:["add-emoji","open-emoji"],data(){return{emojiPickerHeight:320,emojiPickerTop:0,emojiPickerRight:""}},watch:{emojiOpened(e){e&&setTimeout(()=>{this.addCustomStyling(),this.$refs.emojiPicker.shadowRoot.addEventListener("emoji-click",({detail:t})=>{this.$emit("add-emoji",{unicode:t.unicode})})},0)}},methods:{addCustomStyling(){const e=`.picker {
				border: none;
			}`,t=`.nav {
				overflow-x: auto;
			}`,a=`.search-wrapper {
				padding-right: 2px;
				padding-left: 2px;
			}`,o=`input.search {
				height: 32px;
				font-size: 14px;
				border-radius: 10rem;
				border: var(--chat-border-style);
				padding: 5px 10px;
				outline: none;
				background: var(--chat-bg-color-input);
				color: var(--chat-color);
			}`,m=document.createElement("style");m.textContent=e+t+a+o,this.$refs.emojiPicker.shadowRoot.appendChild(m)},openEmoji(e){this.$emit("open-emoji",!this.emojiOpened),this.setEmojiPickerPosition(e.clientY,e.view.innerWidth,e.view.innerHeight)},setEmojiPickerPosition(e,t,a){const o=t<500||a<700,m=document.getElementById("room-footer");if(!m){o&&(this.emojiPickerRight="-50px");return}o?(this.emojiPickerRight=t/2-(this.positionTop?200:150)+"px",this.emojiPickerTop=100,this.emojiPickerHeight=a-200):(m.getBoundingClientRect().top-e>this.emojiPickerHeight-50?this.emojiPickerTop=e+10:this.emojiPickerTop=e-this.emojiPickerHeight-10,this.emojiPickerRight=this.positionTop?"0px":this.positionRight?"60px":"")}}},Sd={class:"vac-emoji-wrapper"},Ed={ref:"emojiPicker","v-if":"emojiOpened"};function kd(e,t,a,o,m,n){const M=s.resolveComponent("svg-icon");return s.openBlock(),s.createElementBlock("div",Sd,[s.createElementVNode("div",{class:s.normalizeClass(["vac-svg-button",{"vac-emoji-reaction":a.emojiReaction}]),onClick:t[0]||(t[0]=(...T)=>n.openEmoji&&n.openEmoji(...T))},[s.renderSlot(e.$slots,"emoji-picker-icon",{},()=>[s.createVNode(M,{name:"emoji",param:a.emojiReaction?"reaction":""},null,8,["param"])])],2),a.emojiOpened?(s.openBlock(),s.createBlock(s.Transition,{key:0,name:"vac-slide-up",appear:""},{default:s.withCtx(()=>[s.createElementVNode("div",{class:s.normalizeClass(["vac-emoji-picker",{"vac-picker-reaction":a.emojiReaction}]),style:s.normalizeStyle({height:`${m.emojiPickerHeight}px`,top:a.positionTop?m.emojiPickerHeight:`${m.emojiPickerTop}px`,right:m.emojiPickerRight,display:m.emojiPickerTop||!a.emojiReaction?"initial":"none"})},[s.createElementVNode("emoji-picker",Ed,null,512)],6)]),_:1})):s.createCommentVNode("",!0)])}var gi=Fe(yd,[["render",kd]]);const Md={name:"RoomFiles",components:{Loader:Zs,SvgIcon:gt},props:{file:{type:Object,required:!0},index:{type:Number,required:!0}},emits:["remove-file"],computed:{isImage(){return $a(this.file)},isVideo(){return Bs(this.file)}}},wd={class:"vac-room-file-container"},Rd=["src"],Ad={class:"vac-text-ellipsis"},Td={key:0,class:"vac-text-ellipsis vac-text-extension"};function xd(e,t,a,o,m,n){const M=s.resolveComponent("loader"),T=s.resolveComponent("svg-icon");return s.openBlock(),s.createElementBlock("div",wd,[s.createVNode(M,{show:a.file.loading},s.createSlots({_:2},[s.renderList(e.$slots,(O,g)=>({name:g,fn:s.withCtx(N=>[s.renderSlot(e.$slots,g,s.normalizeProps(s.guardReactiveProps(N)))])}))]),1032,["show"]),s.createElementVNode("div",{class:"vac-svg-button vac-icon-remove",onClick:t[0]||(t[0]=O=>e.$emit("remove-file",a.index))},[s.renderSlot(e.$slots,"image-close-icon",{},()=>[s.createVNode(T,{name:"close",param:"image"})])]),n.isImage?(s.openBlock(),s.createElementBlock("div",{key:0,class:s.normalizeClass(["vac-message-image",{"vac-blur-loading":a.file.loading}]),style:s.normalizeStyle({"background-image":`url('${a.file.localUrl||a.file.url}')`})},null,6)):n.isVideo?(s.openBlock(),s.createElementBlock("video",{key:1,controls:"",class:s.normalizeClass({"vac-blur-loading":a.file.loading})},[s.createElementVNode("source",{src:a.file.localUrl||a.file.url},null,8,Rd)],2)):(s.openBlock(),s.createElementBlock("div",{key:2,class:s.normalizeClass(["vac-file-container",{"vac-blur-loading":a.file.loading}])},[s.createElementVNode("div",null,[s.renderSlot(e.$slots,"file-icon",{},()=>[s.createVNode(T,{name:"file"})])]),s.createElementVNode("div",Ad,s.toDisplayString(a.file.name),1),a.file.extension?(s.openBlock(),s.createElementBlock("div",Td,s.toDisplayString(a.file.extension),1)):s.createCommentVNode("",!0)],2))])}var Bd=Fe(Md,[["render",xd]]);const Cd={name:"RoomFiles",components:{SvgIcon:gt,RoomFile:Bd},props:{files:{type:Array,required:!0}},emits:["remove-file","reset-message"],computed:{footerHeight(){return document.getElementById("room-footer").clientHeight}}},Od={class:"vac-files-box"},Ld={class:"vac-icon-close"};function Nd(e,t,a,o,m,n){const M=s.resolveComponent("room-file"),T=s.resolveComponent("svg-icon");return s.openBlock(),s.createBlock(s.Transition,{name:"vac-slide-up"},{default:s.withCtx(()=>[a.files.length?(s.openBlock(),s.createElementBlock("div",{key:0,class:"vac-room-files-container",style:s.normalizeStyle({bottom:`${n.footerHeight}px`})},[s.createElementVNode("div",Od,[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(a.files,(O,g)=>(s.openBlock(),s.createElementBlock("div",{key:g},[s.createVNode(M,{file:O,index:g,onRemoveFile:t[0]||(t[0]=N=>e.$emit("remove-file",N))},null,8,["file","index"])]))),128))]),s.createElementVNode("div",Ld,[s.createElementVNode("div",{class:"vac-svg-button",onClick:t[1]||(t[1]=O=>e.$emit("reset-message"))},[s.renderSlot(e.$slots,"reply-close-icon",{},()=>[s.createVNode(T,{name:"close-outline"})])])])],4)):s.createCommentVNode("",!0)]),_:3})}var Id=Fe(Cd,[["render",Nd]]);const Vd={props:{percentage:{type:Number,default:0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["hover-audio-progress","change-linehead"],data(){return{isMouseDown:!1}},methods:{onMouseDown(e){if(this.messageSelectionEnabled)return;this.isMouseDown=!0;const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)},onMouseUp(e){if(this.messageSelectionEnabled)return;this.isMouseDown=!1,document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove);const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t)},onMouseMove(e){if(this.messageSelectionEnabled)return;const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t)},calculateLineHeadPosition(e,t){const a=t.getBoundingClientRect().width,o=t.getBoundingClientRect().left;let m=(e.clientX-o)/a;return m=m<0?0:m,m=m>1?1:m,m}}},jd={class:"vac-player-progress"},Hd={class:"vac-line-container"};function Pd(e,t,a,o,m,n){return s.openBlock(),s.createElementBlock("div",{ref:"progress",class:"vac-player-bar",onMousedown:t[0]||(t[0]=(...M)=>n.onMouseDown&&n.onMouseDown(...M)),onMouseover:t[1]||(t[1]=M=>e.$emit("hover-audio-progress",!0)),onMouseout:t[2]||(t[2]=M=>e.$emit("hover-audio-progress",!1))},[s.createElementVNode("div",jd,[s.createElementVNode("div",Hd,[s.createElementVNode("div",{class:"vac-line-progress",style:s.normalizeStyle({width:`${a.percentage}%`})},null,4),s.createElementVNode("div",{class:s.normalizeClass(["vac-line-dot",{"vac-line-dot__active":m.isMouseDown}]),style:s.normalizeStyle({left:`${a.percentage}%`})},null,6)])])],544)}var Fd=Fe(Vd,[["render",Pd]]);const Dd={name:"AudioPlayer",components:{SvgIcon:gt,AudioControl:Fd},props:{messageId:{type:[String,Number],default:null},src:{type:String,default:null},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["hover-audio-progress","update-progress-time"],data(){return{isPlaying:!1,duration:this.convertTimeMMSS(0),playedTime:this.convertTimeMMSS(0),progress:0}},computed:{playerUniqId(){return`audio-player${this.messageId}`},audioSource(){return this.src?this.src:(this.resetProgress(),null)}},mounted(){this.player=document.getElementById(this.playerUniqId),this.player.addEventListener("ended",()=>{this.isPlaying=!1}),this.player.addEventListener("loadeddata",()=>{this.resetProgress(),this.duration=this.convertTimeMMSS(this.player.duration),this.updateProgressTime()}),this.player.addEventListener("timeupdate",this.onTimeUpdate)},methods:{convertTimeMMSS(e){return new Date(e*1e3).toISOString().substr(14,5)},playback(){this.messageSelectionEnabled||!this.audioSource||(this.isPlaying?this.player.pause():setTimeout(()=>this.player.play()),this.isPlaying=!this.isPlaying)},resetProgress(){this.isPlaying&&this.player.pause(),this.duration=this.convertTimeMMSS(0),this.playedTime=this.convertTimeMMSS(0),this.progress=0,this.isPlaying=!1,this.updateProgressTime()},onTimeUpdate(){this.playedTime=this.convertTimeMMSS(this.player.currentTime),this.progress=this.player.currentTime/this.player.duration*100,this.updateProgressTime()},onUpdateProgress(e){e&&(this.player.currentTime=e*this.player.duration)},updateProgressTime(){this.$emit("update-progress-time",this.progress>1?this.playedTime:this.duration)}}},Ud={class:"vac-audio-player"},qd=["id","src"];function zd(e,t,a,o,m,n){const M=s.resolveComponent("svg-icon"),T=s.resolveComponent("audio-control");return s.openBlock(),s.createElementBlock("div",null,[s.createElementVNode("div",Ud,[s.createElementVNode("div",{class:"vac-svg-button",onClick:t[0]||(t[0]=(...O)=>n.playback&&n.playback(...O))},[m.isPlaying?s.renderSlot(e.$slots,"audio-pause-icon",{key:0},()=>[s.createVNode(M,{name:"audio-pause"})]):s.renderSlot(e.$slots,"audio-play-icon",{key:1},()=>[s.createVNode(M,{name:"audio-play"})])]),s.createVNode(T,{percentage:m.progress,"message-selection-enabled":a.messageSelectionEnabled,onChangeLinehead:n.onUpdateProgress,onHoverAudioProgress:t[1]||(t[1]=O=>e.$emit("hover-audio-progress",O))},null,8,["percentage","message-selection-enabled","onChangeLinehead"]),s.createElementVNode("audio",{id:n.playerUniqId,src:n.audioSource},null,8,qd)])])}var bn=Fe(Dd,[["render",zd]]);const Xd={name:"RoomMessageReply",components:{SvgIcon:gt,FormatMessage:Ts,AudioPlayer:bn},props:{room:{type:Object,required:!0},messageReply:{type:Object,default:null},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0}},emits:["reset-message"],computed:{footerHeight(){return document.getElementById("room-footer").clientHeight},firstFile(){var e,t;return(t=(e=this.messageReply)==null?void 0:e.files)!=null&&t.length?this.messageReply.files[0]:{}},isImage(){return $a(this.firstFile)},isVideo(){return Bs(this.firstFile)},isAudio(){return or(this.firstFile)},isOtherFile(){var e,t;return((t=(e=this.messageReply)==null?void 0:e.files)==null?void 0:t.length)&&!this.isAudio&&!this.isVideo&&!this.isImage}}},Yd={class:"vac-reply-box"},Gd={class:"vac-reply-info"},Kd={class:"vac-reply-username"},Zd={class:"vac-reply-content"},Wd=["src"],Qd={key:1,controls:"",class:"vac-image-reply"},$d=["src"],Jd={key:3,class:"vac-image-reply vac-file-container"},em={class:"vac-text-ellipsis"},tm={key:0,class:"vac-text-ellipsis vac-text-extension"},am={class:"vac-icon-reply"};function sm(e,t,a,o,m,n){const M=s.resolveComponent("format-message"),T=s.resolveComponent("audio-player"),O=s.resolveComponent("svg-icon");return s.openBlock(),s.createBlock(s.Transition,{name:"vac-slide-up"},{default:s.withCtx(()=>[a.messageReply?(s.openBlock(),s.createElementBlock("div",{key:0,class:"vac-reply-container",style:s.normalizeStyle({bottom:`${n.footerHeight}px`})},[s.createElementVNode("div",Yd,[s.createElementVNode("div",Gd,[s.createElementVNode("div",Kd,s.toDisplayString(a.messageReply.username),1),s.createElementVNode("div",Zd,[s.createVNode(M,{content:a.messageReply.content,users:a.room.users,"text-formatting":a.textFormatting,"link-options":a.linkOptions,reply:!0},s.createSlots({_:2},[s.renderList(e.$slots,(g,N)=>({name:N,fn:s.withCtx(u=>[s.renderSlot(e.$slots,N,s.normalizeProps(s.guardReactiveProps(u)))])}))]),1032,["content","users","text-formatting","link-options"])])]),n.isImage?(s.openBlock(),s.createElementBlock("img",{key:0,src:n.firstFile.url,class:"vac-image-reply"},null,8,Wd)):n.isVideo?(s.openBlock(),s.createElementBlock("video",Qd,[s.createElementVNode("source",{src:n.firstFile.url},null,8,$d)])):n.isAudio?(s.openBlock(),s.createBlock(T,{key:2,src:n.firstFile.url,class:"vac-audio-reply"},s.createSlots({_:2},[s.renderList(e.$slots,(g,N)=>({name:N,fn:s.withCtx(u=>[s.renderSlot(e.$slots,N,s.normalizeProps(s.guardReactiveProps(u)))])}))]),1032,["src"])):n.isOtherFile?(s.openBlock(),s.createElementBlock("div",Jd,[s.createElementVNode("div",null,[s.renderSlot(e.$slots,"file-icon",{},()=>[s.createVNode(O,{name:"file"})])]),s.createElementVNode("div",em,s.toDisplayString(n.firstFile.name),1),n.firstFile.extension?(s.openBlock(),s.createElementBlock("div",tm,s.toDisplayString(n.firstFile.extension),1)):s.createCommentVNode("",!0)])):s.createCommentVNode("",!0)]),s.createElementVNode("div",am,[s.createElementVNode("div",{class:"vac-svg-button",onClick:t[0]||(t[0]=g=>e.$emit("reset-message"))},[s.renderSlot(e.$slots,"reply-close-icon",{},()=>[s.createVNode(O,{name:"close-outline"})])])])],4)):s.createCommentVNode("",!0)]),_:3})}var rm=Fe(Xd,[["render",sm]]);const nm={name:"RoomUsersTag",props:{filteredUsersTag:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-user-tag","activate-item"],data(){return{activeItem:null}},computed:{footerHeight(){return document.getElementById("room-footer").clientHeight}},watch:{filteredUsersTag(e,t){(!t.length||e.length!==t.length)&&(this.activeItem=0)},selectItem(e){e&&this.$emit("select-user-tag",this.filteredUsersTag[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredUsersTag.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},om=["onMouseover","onClick"],im={class:"vac-tags-info"},lm={class:"vac-tags-username"};function cm(e,t,a,o,m,n){return s.openBlock(),s.createBlock(s.Transition,{name:"vac-slide-up"},{default:s.withCtx(()=>[a.filteredUsersTag.length?(s.openBlock(),s.createElementBlock("div",{key:0,class:"vac-tags-container",style:s.normalizeStyle({bottom:`${n.footerHeight}px`})},[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(a.filteredUsersTag,(M,T)=>(s.openBlock(),s.createElementBlock("div",{key:M._id,class:s.normalizeClass(["vac-tags-box",{"vac-tags-box-active":T===m.activeItem}]),onMouseover:O=>m.activeItem=T,onClick:O=>e.$emit("select-user-tag",M)},[s.createElementVNode("div",im,[M.avatar?(s.openBlock(),s.createElementBlock("div",{key:0,class:"vac-avatar vac-tags-avatar",style:s.normalizeStyle({"background-image":`url('${M.avatar}')`})},null,4)):s.createCommentVNode("",!0),s.createElementVNode("div",lm,s.toDisplayString(M.username),1)])],42,om))),128))],4)):s.createCommentVNode("",!0)]),_:1})}var dm=Fe(nm,[["render",cm]]);const mm={name:"RoomEmojis",props:{filteredEmojis:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-emoji","activate-item"],data(){return{activeItem:null}},computed:{footerHeight(){return document.getElementById("room-footer").clientHeight}},watch:{filteredEmojis(e,t){(!t.length||e.length!==t.length)&&(this.activeItem=0)},selectItem(e){e&&this.$emit("select-emoji",this.filteredEmojis[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredEmojis.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},hm=["onMouseover","onClick"];function _m(e,t,a,o,m,n){return s.openBlock(),s.createBlock(s.Transition,{name:"vac-slide-up"},{default:s.withCtx(()=>[a.filteredEmojis.length?(s.openBlock(),s.createElementBlock("div",{key:0,class:"vac-emojis-container",style:s.normalizeStyle({bottom:`${n.footerHeight}px`})},[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(a.filteredEmojis,(M,T)=>(s.openBlock(),s.createElementBlock("div",{key:M,class:s.normalizeClass(["vac-emoji-element",{"vac-emoji-element-active":T===m.activeItem}]),onMouseover:O=>m.activeItem=T,onClick:O=>e.$emit("select-emoji",M)},s.toDisplayString(M),43,hm))),128))],4)):s.createCommentVNode("",!0)]),_:1})}var um=Fe(mm,[["render",_m]]);const fm={name:"RoomTemplatesText",props:{filteredTemplatesText:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-template-text","activate-item"],data(){return{activeItem:null}},computed:{footerHeight(){return document.getElementById("room-footer").clientHeight}},watch:{filteredTemplatesText(e,t){(!t.length||e.length!==t.length)&&(this.activeItem=0)},selectItem(e){e&&this.$emit("select-template-text",this.filteredTemplatesText[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredTemplatesText.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},vm=["onMouseover","onClick"],gm={class:"vac-template-info"},pm={class:"vac-template-tag"},bm={class:"vac-template-text"};function ym(e,t,a,o,m,n){return s.openBlock(),s.createBlock(s.Transition,{name:"vac-slide-up"},{default:s.withCtx(()=>[a.filteredTemplatesText.length?(s.openBlock(),s.createElementBlock("div",{key:0,class:"vac-template-container vac-app-box-shadow",style:s.normalizeStyle({bottom:`${n.footerHeight}px`})},[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(a.filteredTemplatesText,(M,T)=>(s.openBlock(),s.createElementBlock("div",{key:T,class:s.normalizeClass(["vac-template-box",{"vac-template-active":T===m.activeItem}]),onMouseover:O=>m.activeItem=T,onClick:O=>e.$emit("select-template-text",M)},[s.createElementVNode("div",gm,[s.createElementVNode("div",pm," /"+s.toDisplayString(M.tag),1),s.createElementVNode("div",bm,s.toDisplayString(M.text),1)])],42,vm))),128))],4)):s.createCommentVNode("",!0)]),_:1})}var Sm=Fe(fm,[["render",ym]]);function Em(e){return new Int8Array(e)}function pi(e){return new Int16Array(e)}function bi(e){return new Int32Array(e)}function yi(e){return new Float32Array(e)}function km(e){return new Float64Array(e)}function Si(e){if(e.length==1)return yi(e[0]);var t=e[0];e=e.slice(1);for(var a=[],o=0;o<t;o++)a.push(Si(e));return a}function Ei(e){if(e.length==1)return bi(e[0]);var t=e[0];e=e.slice(1);for(var a=[],o=0;o<t;o++)a.push(Ei(e));return a}function ki(e){if(e.length==1)return pi(e[0]);var t=e[0];e=e.slice(1);for(var a=[],o=0;o<t;o++)a.push(ki(e));return a}function Mi(e){if(e.length==1)return new Array(e[0]);var t=e[0];e=e.slice(1);for(var a=[],o=0;o<t;o++)a.push(Mi(e));return a}var wi={};wi.fill=function(e,t,a,o){if(arguments.length==2)for(var m=0;m<e.length;m++)e[m]=arguments[1];else for(var m=t;m<a;m++)e[m]=o};var Ps={};Ps.arraycopy=function(e,t,a,o,m){for(var n=t+m;t<n;)a[o++]=e[t++]},Ps.out={},Ps.out.println=function(e){console.log(e)},Ps.out.printf=function(){console.log.apply(console,arguments)};var br={};br.SQRT2=1.4142135623730951,br.FAST_LOG10=function(e){return Math.log10(e)},br.FAST_LOG10_X=function(e,t){return Math.log10(e)*t};function ma(e){this.ordinal=e}ma.short_block_allowed=new ma(0),ma.short_block_coupled=new ma(1),ma.short_block_dispensed=new ma(2),ma.short_block_forced=new ma(3);var Ri={};Ri.MAX_VALUE=34028235e31;function Vt(e){this.ordinal=e}Vt.vbr_off=new Vt(0),Vt.vbr_mt=new Vt(1),Vt.vbr_rh=new Vt(2),Vt.vbr_abr=new Vt(3),Vt.vbr_mtrh=new Vt(4),Vt.vbr_default=Vt.vbr_mtrh;var Mm=function(e){},Ze={System:Ps,VbrMode:Vt,Float:Ri,ShortBlock:ma,Util:br,Arrays:wi,new_array_n:Mi,new_byte:Em,new_double:km,new_float:yi,new_float_n:Si,new_int:bi,new_int_n:Ei,new_short:pi,new_short_n:ki,assert:Mm},yr=Ze,wm=yr.System,tt=yr.Util,Rm=yr.Arrays,Am=yr.new_float,jt=Rt;function Tm(){var e=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*tt.SQRT2*.5/2384e-9,.017876148*tt.SQRT2*.5/2384e-9,.003134727*tt.SQRT2*.5/2384e-9,.002457142*tt.SQRT2*.5/2384e-9,971317e-9*tt.SQRT2*.5/2384e-9,218868e-9*tt.SQRT2*.5/2384e-9,101566e-9*tt.SQRT2*.5/2384e-9,13828e-9*tt.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],t=12,a=36,o=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],m=o[jt.SHORT_TYPE],n=o[jt.SHORT_TYPE],M=o[jt.SHORT_TYPE],T=o[jt.SHORT_TYPE],O=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function g(y,k,r){for(var H=10,j=k+238-14-286,V=-15;V<0;V++){var d,R,x;d=e[H+-10],R=y[j+-224]*d,x=y[k+224]*d,d=e[H+-9],R+=y[j+-160]*d,x+=y[k+160]*d,d=e[H+-8],R+=y[j+-96]*d,x+=y[k+96]*d,d=e[H+-7],R+=y[j+-32]*d,x+=y[k+32]*d,d=e[H+-6],R+=y[j+32]*d,x+=y[k+-32]*d,d=e[H+-5],R+=y[j+96]*d,x+=y[k+-96]*d,d=e[H+-4],R+=y[j+160]*d,x+=y[k+-160]*d,d=e[H+-3],R+=y[j+224]*d,x+=y[k+-224]*d,d=e[H+-2],R+=y[k+-256]*d,x-=y[j+256]*d,d=e[H+-1],R+=y[k+-192]*d,x-=y[j+192]*d,d=e[H+0],R+=y[k+-128]*d,x-=y[j+128]*d,d=e[H+1],R+=y[k+-64]*d,x-=y[j+64]*d,d=e[H+2],R+=y[k+0]*d,x-=y[j+0]*d,d=e[H+3],R+=y[k+64]*d,x-=y[j+-64]*d,d=e[H+4],R+=y[k+128]*d,x-=y[j+-128]*d,d=e[H+5],R+=y[k+192]*d,x-=y[j+-192]*d,R*=e[H+6],d=x-R,r[30+V*2]=x+R,r[31+V*2]=e[H+7]*d,H+=18,k--,j++}{var R,x,C,B;x=y[k+-16]*e[H+-10],R=y[k+-32]*e[H+-2],x+=(y[k+-48]-y[k+16])*e[H+-9],R+=y[k+-96]*e[H+-1],x+=(y[k+-80]+y[k+48])*e[H+-8],R+=y[k+-160]*e[H+0],x+=(y[k+-112]-y[k+80])*e[H+-7],R+=y[k+-224]*e[H+1],x+=(y[k+-144]+y[k+112])*e[H+-6],R-=y[k+32]*e[H+2],x+=(y[k+-176]-y[k+144])*e[H+-5],R-=y[k+96]*e[H+3],x+=(y[k+-208]+y[k+176])*e[H+-4],R-=y[k+160]*e[H+4],x+=(y[k+-240]-y[k+208])*e[H+-3],R-=y[k+224],C=R-x,B=R+x,x=r[14],R=r[15]-x,r[31]=B+x,r[30]=C+R,r[15]=C-R,r[14]=B-x}{var i;i=r[28]-r[0],r[0]+=r[28],r[28]=i*e[H+-2*18+7],i=r[29]-r[1],r[1]+=r[29],r[29]=i*e[H+-2*18+7],i=r[26]-r[2],r[2]+=r[26],r[26]=i*e[H+-4*18+7],i=r[27]-r[3],r[3]+=r[27],r[27]=i*e[H+-4*18+7],i=r[24]-r[4],r[4]+=r[24],r[24]=i*e[H+-6*18+7],i=r[25]-r[5],r[5]+=r[25],r[25]=i*e[H+-6*18+7],i=r[22]-r[6],r[6]+=r[22],r[22]=i*tt.SQRT2,i=r[23]-r[7],r[7]+=r[23],r[23]=i*tt.SQRT2-r[7],r[7]-=r[6],r[22]-=r[7],r[23]-=r[22],i=r[6],r[6]=r[31]-i,r[31]=r[31]+i,i=r[7],r[7]=r[30]-i,r[30]=r[30]+i,i=r[22],r[22]=r[15]-i,r[15]=r[15]+i,i=r[23],r[23]=r[14]-i,r[14]=r[14]+i,i=r[20]-r[8],r[8]+=r[20],r[20]=i*e[H+-10*18+7],i=r[21]-r[9],r[9]+=r[21],r[21]=i*e[H+-10*18+7],i=r[18]-r[10],r[10]+=r[18],r[18]=i*e[H+-12*18+7],i=r[19]-r[11],r[11]+=r[19],r[19]=i*e[H+-12*18+7],i=r[16]-r[12],r[12]+=r[16],r[16]=i*e[H+-14*18+7],i=r[17]-r[13],r[13]+=r[17],r[17]=i*e[H+-14*18+7],i=-r[20]+r[24],r[20]+=r[24],r[24]=i*e[H+-12*18+7],i=-r[21]+r[25],r[21]+=r[25],r[25]=i*e[H+-12*18+7],i=r[4]-r[8],r[4]+=r[8],r[8]=i*e[H+-12*18+7],i=r[5]-r[9],r[5]+=r[9],r[9]=i*e[H+-12*18+7],i=r[0]-r[12],r[0]+=r[12],r[12]=i*e[H+-4*18+7],i=r[1]-r[13],r[1]+=r[13],r[13]=i*e[H+-4*18+7],i=r[16]-r[28],r[16]+=r[28],r[28]=i*e[H+-4*18+7],i=-r[17]+r[29],r[17]+=r[29],r[29]=i*e[H+-4*18+7],i=tt.SQRT2*(r[2]-r[10]),r[2]+=r[10],r[10]=i,i=tt.SQRT2*(r[3]-r[11]),r[3]+=r[11],r[11]=i,i=tt.SQRT2*(-r[18]+r[26]),r[18]+=r[26],r[26]=i-r[18],i=tt.SQRT2*(-r[19]+r[27]),r[19]+=r[27],r[27]=i-r[19],i=r[2],r[19]-=r[3],r[3]-=i,r[2]=r[31]-i,r[31]+=i,i=r[3],r[11]-=r[19],r[18]-=i,r[3]=r[30]-i,r[30]+=i,i=r[18],r[27]-=r[11],r[19]-=i,r[18]=r[15]-i,r[15]+=i,i=r[19],r[10]-=i,r[19]=r[14]-i,r[14]+=i,i=r[10],r[11]-=i,r[10]=r[23]-i,r[23]+=i,i=r[11],r[26]-=i,r[11]=r[22]-i,r[22]+=i,i=r[26],r[27]-=i,r[26]=r[7]-i,r[7]+=i,i=r[27],r[27]=r[6]-i,r[6]+=i,i=tt.SQRT2*(r[0]-r[4]),r[0]+=r[4],r[4]=i,i=tt.SQRT2*(r[1]-r[5]),r[1]+=r[5],r[5]=i,i=tt.SQRT2*(r[16]-r[20]),r[16]+=r[20],r[20]=i,i=tt.SQRT2*(r[17]-r[21]),r[17]+=r[21],r[21]=i,i=-tt.SQRT2*(r[8]-r[12]),r[8]+=r[12],r[12]=i-r[8],i=-tt.SQRT2*(r[9]-r[13]),r[9]+=r[13],r[13]=i-r[9],i=-tt.SQRT2*(r[25]-r[29]),r[25]+=r[29],r[29]=i-r[25],i=-tt.SQRT2*(r[24]+r[28]),r[24]-=r[28],r[28]=i-r[24],i=r[24]-r[16],r[24]=i,i=r[20]-i,r[20]=i,i=r[28]-i,r[28]=i,i=r[25]-r[17],r[25]=i,i=r[21]-i,r[21]=i,i=r[29]-i,r[29]=i,i=r[17]-r[1],r[17]=i,i=r[9]-i,r[9]=i,i=r[25]-i,r[25]=i,i=r[5]-i,r[5]=i,i=r[21]-i,r[21]=i,i=r[13]-i,r[13]=i,i=r[29]-i,r[29]=i,i=r[1]-r[0],r[1]=i,i=r[16]-i,r[16]=i,i=r[17]-i,r[17]=i,i=r[8]-i,r[8]=i,i=r[9]-i,r[9]=i,i=r[24]-i,r[24]=i,i=r[25]-i,r[25]=i,i=r[4]-i,r[4]=i,i=r[5]-i,r[5]=i,i=r[20]-i,r[20]=i,i=r[21]-i,r[21]=i,i=r[12]-i,r[12]=i,i=r[13]-i,r[13]=i,i=r[28]-i,r[28]=i,i=r[29]-i,r[29]=i,i=r[0],r[0]+=r[31],r[31]-=i,i=r[1],r[1]+=r[30],r[30]-=i,i=r[16],r[16]+=r[15],r[15]-=i,i=r[17],r[17]+=r[14],r[14]-=i,i=r[8],r[8]+=r[23],r[23]-=i,i=r[9],r[9]+=r[22],r[22]-=i,i=r[24],r[24]+=r[7],r[7]-=i,i=r[25],r[25]+=r[6],r[6]-=i,i=r[4],r[4]+=r[27],r[27]-=i,i=r[5],r[5]+=r[26],r[26]-=i,i=r[20],r[20]+=r[11],r[11]-=i,i=r[21],r[21]+=r[10],r[10]-=i,i=r[12],r[12]+=r[19],r[19]-=i,i=r[13],r[13]+=r[18],r[18]-=i,i=r[28],r[28]+=r[3],r[3]-=i,i=r[29],r[29]+=r[2],r[2]-=i}}function N(y,k){for(var r=0;r<3;r++){var H,j,V,d,R,x;d=y[k+2*3]*o[jt.SHORT_TYPE][0]-y[k+5*3],H=y[k+0*3]*o[jt.SHORT_TYPE][2]-y[k+3*3],j=d+H,V=d-H,d=y[k+5*3]*o[jt.SHORT_TYPE][0]+y[k+2*3],H=y[k+3*3]*o[jt.SHORT_TYPE][2]+y[k+0*3],R=d+H,x=-d+H,H=(y[k+1*3]*o[jt.SHORT_TYPE][1]-y[k+4*3])*2069978111953089e-26,d=(y[k+4*3]*o[jt.SHORT_TYPE][1]+y[k+1*3])*2069978111953089e-26,y[k+3*0]=j*190752519173728e-25+H,y[k+3*5]=-R*190752519173728e-25+d,V=V*.8660254037844387*1907525191737281e-26,R=R*.5*1907525191737281e-26+d,y[k+3*1]=V-R,y[k+3*2]=V+R,j=j*.5*1907525191737281e-26-H,x=x*.8660254037844387*1907525191737281e-26,y[k+3*3]=j+x,y[k+3*4]=j-x,k++}}function u(y,k,r){var H,j;{var V,d,R,x,C,B,i,E;V=r[17]-r[9],R=r[15]-r[11],x=r[14]-r[12],C=r[0]+r[8],B=r[1]+r[7],i=r[2]+r[6],E=r[3]+r[5],y[k+17]=C+i-E-(B-r[4]),j=(C+i-E)*n[12+7]+(B-r[4]),H=(V-R-x)*n[12+6],y[k+5]=H+j,y[k+6]=H-j,d=(r[16]-r[10])*n[12+6],B=B*n[12+7]+r[4],H=V*n[12+0]+d+R*n[12+1]+x*n[12+2],j=-C*n[12+4]+B-i*n[12+5]+E*n[12+3],y[k+1]=H+j,y[k+2]=H-j,H=V*n[12+1]-d-R*n[12+2]+x*n[12+0],j=-C*n[12+5]+B-i*n[12+3]+E*n[12+4],y[k+9]=H+j,y[k+10]=H-j,H=V*n[12+2]-d+R*n[12+0]-x*n[12+1],j=C*n[12+3]-B+i*n[12+4]-E*n[12+5],y[k+13]=H+j,y[k+14]=H-j}{var p,h,b,S,c,_,f,L;p=r[8]-r[0],b=r[6]-r[2],S=r[5]-r[3],c=r[17]+r[9],_=r[16]+r[10],f=r[15]+r[11],L=r[14]+r[12],y[k+0]=c+f+L+(_+r[13]),H=(c+f+L)*n[12+7]-(_+r[13]),j=(p-b+S)*n[12+6],y[k+11]=H+j,y[k+12]=H-j,h=(r[7]-r[1])*n[12+6],_=r[13]-_*n[12+7],H=c*n[12+3]-_+f*n[12+4]+L*n[12+5],j=p*n[12+2]+h+b*n[12+0]+S*n[12+1],y[k+3]=H+j,y[k+4]=H-j,H=-c*n[12+5]+_-f*n[12+3]-L*n[12+4],j=p*n[12+1]+h-b*n[12+2]-S*n[12+0],y[k+7]=H+j,y[k+8]=H-j,H=-c*n[12+4]+_-f*n[12+5]-L*n[12+3],j=p*n[12+0]-h+b*n[12+1]-S*n[12+2],y[k+15]=H+j,y[k+16]=H-j}}this.mdct_sub48=function(y,k,r){for(var H=k,j=286,V=0;V<y.channels_out;V++){for(var d=0;d<y.mode_gr;d++){for(var R,x=y.l3_side.tt[d][V],C=x.xr,B=0,i=y.sb_sample[V][1-d],E=0,p=0;p<18/2;p++)for(g(H,j,i[E]),g(H,j+32,i[E+1]),E+=2,j+=64,R=1;R<32;R+=2)i[E-1][R]*=-1;for(R=0;R<32;R++,B+=18){var h=x.block_type,b=y.sb_sample[V][d],S=y.sb_sample[V][1-d];if(x.mixed_block_flag!=0&&R<2&&(h=0),y.amp_filter[R]<1e-12)Rm.fill(C,B+0,B+18,0);else{if(y.amp_filter[R]<1)for(var p=0;p<18;p++)S[p][O[R]]*=y.amp_filter[R];if(h==jt.SHORT_TYPE){for(var p=-t/4;p<0;p++){var c=o[jt.SHORT_TYPE][p+3];C[B+p*3+9]=b[9+p][O[R]]*c-b[8-p][O[R]],C[B+p*3+18]=b[14-p][O[R]]*c+b[15+p][O[R]],C[B+p*3+10]=b[15+p][O[R]]*c-b[14-p][O[R]],C[B+p*3+19]=S[2-p][O[R]]*c+S[3+p][O[R]],C[B+p*3+11]=S[3+p][O[R]]*c-S[2-p][O[R]],C[B+p*3+20]=S[8-p][O[R]]*c+S[9+p][O[R]]}N(C,B)}else{for(var _=Am(18),p=-a/4;p<0;p++){var f,L;f=o[h][p+27]*S[p+9][O[R]]+o[h][p+36]*S[8-p][O[R]],L=o[h][p+9]*b[p+9][O[R]]-o[h][p+18]*b[8-p][O[R]],_[p+9]=f-L*m[3+p+9],_[p+18]=f*m[3+p+9]+L}u(C,B,_)}}if(h!=jt.SHORT_TYPE&&R!=0)for(var p=7;p>=0;--p){var Y,F;Y=C[B+p]*M[20+p]+C[B+-1-p]*T[28+p],F=C[B+p]*T[28+p]-C[B+-1-p]*M[20+p],C[B+-1-p]=Y,C[B+p]=F}}}if(H=r,j=286,y.mode_gr==1)for(var U=0;U<18;U++)wm.arraycopy(y.sb_sample[V][1][U],0,y.sb_sample[V][0][U],0,32)}}}var xm=Tm,Sr=Rt,yn=Ze,Bm=yn.System,Cm=yn.new_float,Om=yn.new_float_n;function Lm(){this.l=Cm(Sr.SBMAX_l),this.s=Om([Sr.SBMAX_s,3]);var e=this;this.assign=function(t){Bm.arraycopy(t.l,0,e.l,0,Sr.SBMAX_l);for(var a=0;a<Sr.SBMAX_s;a++)for(var o=0;o<3;o++)e.s[a][o]=t.s[a][o]}}var Ai=Lm,Ti=Ai;function Nm(){this.thm=new Ti,this.en=new Ti}var Im=Nm,Oa=Ze,xi=Oa.System,Er=Oa.VbrMode,Bi=Oa.new_array_n,Ci=Oa.new_float,Vm=Oa.new_float_n,jm=Oa.new_int,kr=Oa.assert;Oe.ENCDELAY=576,Oe.POSTDELAY=1152,Oe.MDCTDELAY=48,Oe.FFTOFFSET=224+Oe.MDCTDELAY,Oe.DECDELAY=528,Oe.SBLIMIT=32,Oe.CBANDS=64,Oe.SBPSY_l=21,Oe.SBPSY_s=12,Oe.SBMAX_l=22,Oe.SBMAX_s=13,Oe.PSFB21=6,Oe.PSFB12=6,Oe.BLKSIZE=1024,Oe.HBLKSIZE=Oe.BLKSIZE/2+1,Oe.BLKSIZE_s=256,Oe.HBLKSIZE_s=Oe.BLKSIZE_s/2+1,Oe.NORM_TYPE=0,Oe.START_TYPE=1,Oe.SHORT_TYPE=2,Oe.STOP_TYPE=3,Oe.MPG_MD_LR_LR=0,Oe.MPG_MD_LR_I=1,Oe.MPG_MD_MS_LR=2,Oe.MPG_MD_MS_I=3,Oe.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function Oe(){var e=xm,t=Im,a=Oe.FFTOFFSET,o=Oe.MPG_MD_MS_LR,m=null;this.psy=null;var n=null,M=null,T=null;this.setModules=function(y,k,r,H){m=y,this.psy=k,n=k,M=H,T=r};var O=new e;function g(y){var k,r;if(y.ATH.useAdjust==0){y.ATH.adjust=1;return}if(r=y.loudness_sq[0][0],k=y.loudness_sq[1][0],y.channels_out==2?(r+=y.loudness_sq[0][1],k+=y.loudness_sq[1][1]):(r+=r,k+=k),y.mode_gr==2&&(r=Math.max(r,k)),r*=.5,r*=y.ATH.aaSensitivityP,r>.03125)y.ATH.adjust>=1?y.ATH.adjust=1:y.ATH.adjust<y.ATH.adjustLimit&&(y.ATH.adjust=y.ATH.adjustLimit),y.ATH.adjustLimit=1;else{var H=31.98*r+625e-6;y.ATH.adjust>=H?(y.ATH.adjust*=H*.075+.925,y.ATH.adjust<H&&(y.ATH.adjust=H)):y.ATH.adjustLimit>=H?y.ATH.adjust=H:y.ATH.adjust<y.ATH.adjustLimit&&(y.ATH.adjust=y.ATH.adjustLimit),y.ATH.adjustLimit=H}}function N(y){var k,r;for(kr(0<=y.bitrate_index&&y.bitrate_index<16),kr(0<=y.mode_ext&&y.mode_ext<4),y.bitrate_stereoMode_Hist[y.bitrate_index][4]++,y.bitrate_stereoMode_Hist[15][4]++,y.channels_out==2&&(y.bitrate_stereoMode_Hist[y.bitrate_index][y.mode_ext]++,y.bitrate_stereoMode_Hist[15][y.mode_ext]++),k=0;k<y.mode_gr;++k)for(r=0;r<y.channels_out;++r){var H=y.l3_side.tt[k][r].block_type|0;y.l3_side.tt[k][r].mixed_block_flag!=0&&(H=4),y.bitrate_blockType_Hist[y.bitrate_index][H]++,y.bitrate_blockType_Hist[y.bitrate_index][5]++,y.bitrate_blockType_Hist[15][H]++,y.bitrate_blockType_Hist[15][5]++}}function u(y,k){var r=y.internal_flags,H,j;if(r.lame_encode_frame_init==0){var V,d,R=Ci(2014),x=Ci(286+1152+576);for(r.lame_encode_frame_init=1,V=0,d=0;V<286+576*(1+r.mode_gr);++V)V<576*r.mode_gr?(R[V]=0,r.channels_out==2&&(x[V]=0)):(R[V]=k[0][d],r.channels_out==2&&(x[V]=k[1][d]),++d);for(j=0;j<r.mode_gr;j++)for(H=0;H<r.channels_out;H++)r.l3_side.tt[j][H].block_type=Oe.SHORT_TYPE;O.mdct_sub48(r,R,x),kr(r.mf_size>=Oe.BLKSIZE+y.framesize-Oe.FFTOFFSET),kr(r.mf_size>=512+y.framesize-32)}}this.lame_encode_mp3_frame=function(y,k,r,H,j,V){var d,R=Bi([2,2]);R[0][0]=new t,R[0][1]=new t,R[1][0]=new t,R[1][1]=new t;var x=Bi([2,2]);x[0][0]=new t,x[0][1]=new t,x[1][0]=new t,x[1][1]=new t;var C,B=[null,null],i=y.internal_flags,E=Vm([2,4]),p=[.5,.5],h=[[0,0],[0,0]],b=[[0,0],[0,0]],S,c,_;if(B[0]=k,B[1]=r,i.lame_encode_frame_init==0&&u(y,B),i.padding=0,(i.slot_lag-=i.frac_SpF)<0&&(i.slot_lag+=y.out_samplerate,i.padding=1),i.psymodel!=0){var f,L=[null,null],Y=0,F=jm(2);for(_=0;_<i.mode_gr;_++){for(c=0;c<i.channels_out;c++)L[c]=B[c],Y=576+_*576-Oe.FFTOFFSET;if(y.VBR==Er.vbr_mtrh||y.VBR==Er.vbr_mt?f=n.L3psycho_anal_vbr(y,L,Y,_,R,x,h[_],b[_],E[_],F):f=n.L3psycho_anal_ns(y,L,Y,_,R,x,h[_],b[_],E[_],F),f!=0)return-4;for(y.mode==MPEGMode.JOINT_STEREO&&(p[_]=E[_][2]+E[_][3],p[_]>0&&(p[_]=E[_][3]/p[_])),c=0;c<i.channels_out;c++){var U=i.l3_side.tt[_][c];U.block_type=F[c],U.mixed_block_flag=0}}}else for(_=0;_<i.mode_gr;_++)for(c=0;c<i.channels_out;c++)i.l3_side.tt[_][c].block_type=Oe.NORM_TYPE,i.l3_side.tt[_][c].mixed_block_flag=0,b[_][c]=h[_][c]=700;if(g(i),O.mdct_sub48(i,B[0],B[1]),i.mode_ext=Oe.MPG_MD_LR_LR,y.force_ms)i.mode_ext=Oe.MPG_MD_MS_LR;else if(y.mode==MPEGMode.JOINT_STEREO){var l=0,v=0;for(_=0;_<i.mode_gr;_++)for(c=0;c<i.channels_out;c++)l+=b[_][c],v+=h[_][c];if(l<=1*v){var Z=i.l3_side.tt[0],W=i.l3_side.tt[i.mode_gr-1];Z[0].block_type==Z[1].block_type&&W[0].block_type==W[1].block_type&&(i.mode_ext=Oe.MPG_MD_MS_LR)}}if(i.mode_ext==o?(C=x,S=b):(C=R,S=h),y.analysis&&i.pinfo!=null)for(_=0;_<i.mode_gr;_++)for(c=0;c<i.channels_out;c++)i.pinfo.ms_ratio[_]=i.ms_ratio[_],i.pinfo.ms_ener_ratio[_]=p[_],i.pinfo.blocktype[_][c]=i.l3_side.tt[_][c].block_type,i.pinfo.pe[_][c]=S[_][c],xi.arraycopy(i.l3_side.tt[_][c].xr,0,i.pinfo.xr[_][c],0,576),i.mode_ext==o&&(i.pinfo.ers[_][c]=i.pinfo.ers[_][c+2],xi.arraycopy(i.pinfo.energy[_][c+2],0,i.pinfo.energy[_][c],0,i.pinfo.energy[_][c].length));if(y.VBR==Er.vbr_off||y.VBR==Er.vbr_abr){var se,me;for(se=0;se<18;se++)i.nsPsy.pefirbuf[se]=i.nsPsy.pefirbuf[se+1];for(me=0,_=0;_<i.mode_gr;_++)for(c=0;c<i.channels_out;c++)me+=S[_][c];for(i.nsPsy.pefirbuf[18]=me,me=i.nsPsy.pefirbuf[9],se=0;se<9;se++)me+=(i.nsPsy.pefirbuf[se]+i.nsPsy.pefirbuf[18-se])*Oe.fircoef[se];for(me=670*5*i.mode_gr*i.channels_out/me,_=0;_<i.mode_gr;_++)for(c=0;c<i.channels_out;c++)S[_][c]*=me}if(i.iteration_loop.iteration_loop(y,S,p,C),m.format_bitstream(y),d=m.copy_buffer(i,H,j,V,1),y.bWriteVbrTag&&M.addVbrFrame(y),y.analysis&&i.pinfo!=null){for(c=0;c<i.channels_out;c++){var ce;for(ce=0;ce<a;ce++)i.pinfo.pcmdata[c][ce]=i.pinfo.pcmdata[c][ce+y.framesize];for(ce=a;ce<1600;ce++)i.pinfo.pcmdata[c][ce]=B[c][ce-a]}T.set_frame_pinfo(y,C)}return N(i),d}}var Rt=Oe,Oi=Ze,Li=Oi.Util,Ni=Oi.new_float,it=Rt;function Hm(){var e=Ni(it.BLKSIZE),t=Ni(it.BLKSIZE_s/2),a=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function o(n,M,T){var O=0,g,N,u;T<<=1;var y=M+T;g=4;do{var k,r,H,j,V,d,R;R=g>>1,j=g,V=g<<1,d=V+j,g=V<<1,N=M,u=N+R;do{var x,C,B,i;C=n[N+0]-n[N+j],x=n[N+0]+n[N+j],i=n[N+V]-n[N+d],B=n[N+V]+n[N+d],n[N+V]=x-B,n[N+0]=x+B,n[N+d]=C-i,n[N+j]=C+i,C=n[u+0]-n[u+j],x=n[u+0]+n[u+j],i=Li.SQRT2*n[u+d],B=Li.SQRT2*n[u+V],n[u+V]=x-B,n[u+0]=x+B,n[u+d]=C-i,n[u+j]=C+i,u+=g,N+=g}while(N<y);for(r=a[O+0],k=a[O+1],H=1;H<R;H++){var E,p;E=1-2*k*k,p=2*k*r,N=M+H,u=M+j-H;do{var h,b,S,x,C,c,B,_,i,f;b=p*n[N+j]-E*n[u+j],h=E*n[N+j]+p*n[u+j],C=n[N+0]-h,x=n[N+0]+h,c=n[u+0]-b,S=n[u+0]+b,b=p*n[N+d]-E*n[u+d],h=E*n[N+d]+p*n[u+d],i=n[N+V]-h,B=n[N+V]+h,f=n[u+V]-b,_=n[u+V]+b,b=k*B-r*f,h=r*B+k*f,n[N+V]=x-h,n[N+0]=x+h,n[u+d]=c-b,n[u+j]=c+b,b=r*_-k*i,h=k*_+r*i,n[u+V]=S-h,n[u+0]=S+h,n[N+d]=C-b,n[N+j]=C+b,u+=g,N+=g}while(N<y);E=r,r=E*a[O+0]-k*a[O+1],k=E*a[O+1]+k*a[O+0]}O+=2}while(g<T)}var m=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(n,M,T,O,g){for(var N=0;N<3;N++){var u=it.BLKSIZE_s/2,y=65535&576/3*(N+1),k=it.BLKSIZE_s/8-1;do{var r,H,j,V,d,R=m[k<<2]&255;r=t[R]*O[T][g+R+y],d=t[127-R]*O[T][g+R+y+128],H=r-d,r=r+d,j=t[R+64]*O[T][g+R+y+64],d=t[63-R]*O[T][g+R+y+192],V=j-d,j=j+d,u-=4,M[N][u+0]=r+j,M[N][u+2]=r-j,M[N][u+1]=H+V,M[N][u+3]=H-V,r=t[R+1]*O[T][g+R+y+1],d=t[126-R]*O[T][g+R+y+129],H=r-d,r=r+d,j=t[R+65]*O[T][g+R+y+65],d=t[62-R]*O[T][g+R+y+193],V=j-d,j=j+d,M[N][u+it.BLKSIZE_s/2+0]=r+j,M[N][u+it.BLKSIZE_s/2+2]=r-j,M[N][u+it.BLKSIZE_s/2+1]=H+V,M[N][u+it.BLKSIZE_s/2+3]=H-V}while(--k>=0);o(M[N],u,it.BLKSIZE_s/2)}},this.fft_long=function(n,M,T,O,g){var N=it.BLKSIZE/8-1,u=it.BLKSIZE/2;do{var y,k,r,H,j,V=m[N]&255;y=e[V]*O[T][g+V],j=e[V+512]*O[T][g+V+512],k=y-j,y=y+j,r=e[V+256]*O[T][g+V+256],j=e[V+768]*O[T][g+V+768],H=r-j,r=r+j,u-=4,M[u+0]=y+r,M[u+2]=y-r,M[u+1]=k+H,M[u+3]=k-H,y=e[V+1]*O[T][g+V+1],j=e[V+513]*O[T][g+V+513],k=y-j,y=y+j,r=e[V+257]*O[T][g+V+257],j=e[V+769]*O[T][g+V+769],H=r-j,r=r+j,M[u+it.BLKSIZE/2+0]=y+r,M[u+it.BLKSIZE/2+2]=y-r,M[u+it.BLKSIZE/2+1]=k+H,M[u+it.BLKSIZE/2+3]=k-H}while(--N>=0);o(M,u,it.BLKSIZE/2)},this.init_fft=function(n){for(var M=0;M<it.BLKSIZE;M++)e[M]=.42-.5*Math.cos(2*Math.PI*(M+.5)/it.BLKSIZE)+.08*Math.cos(4*Math.PI*(M+.5)/it.BLKSIZE);for(var M=0;M<it.BLKSIZE_s/2;M++)t[M]=.5*(1-Math.cos(2*Math.PI*(M+.5)/it.BLKSIZE_s))}}var Pm=Hm,ha=Ze,ss=ha.VbrMode,Ii=ha.Float,rs=ha.ShortBlock,xt=ha.Util,Fm=ha.Arrays,dt=ha.new_float,zt=ha.new_float_n,La=ha.new_int,xe=ha.assert,Dm=Pm,ae=Rt;function Um(){var e=new Dm,t=2.302585092994046,a=2,o=16,m=2,n=16,M=.34,T=1/(14752*14752)/(ae.BLKSIZE/2),O=.01,g=.8,N=.6,u=.3,y=3.5,k=21,r=.2302585093;function H(w){return w}function j(w,A){for(var P=0,D=0;D<ae.BLKSIZE/2;++D)P+=w[D]*A.ATH.eql_w[D];return P*=T,P}function V(w,A,P,D,z,I,X,G,q,ee,K){var te=w.internal_flags;if(q<2)e.fft_long(te,D[z],q,ee,K),e.fft_short(te,I[X],q,ee,K);else if(q==2){for(var ue=ae.BLKSIZE-1;ue>=0;--ue){var Me=D[z+0][ue],re=D[z+1][ue];D[z+0][ue]=(Me+re)*xt.SQRT2*.5,D[z+1][ue]=(Me-re)*xt.SQRT2*.5}for(var Ee=2;Ee>=0;--Ee)for(var ue=ae.BLKSIZE_s-1;ue>=0;--ue){var Me=I[X+0][Ee][ue],re=I[X+1][Ee][ue];I[X+0][Ee][ue]=(Me+re)*xt.SQRT2*.5,I[X+1][Ee][ue]=(Me-re)*xt.SQRT2*.5}}A[0]=D[z+0][0],A[0]*=A[0];for(var ue=ae.BLKSIZE/2-1;ue>=0;--ue){var $=D[z+0][ae.BLKSIZE/2-ue],pe=D[z+0][ae.BLKSIZE/2+ue];A[ae.BLKSIZE/2-ue]=($*$+pe*pe)*.5}for(var Ee=2;Ee>=0;--Ee){P[Ee][0]=I[X+0][Ee][0],P[Ee][0]*=P[Ee][0];for(var ue=ae.BLKSIZE_s/2-1;ue>=0;--ue){var $=I[X+0][Ee][ae.BLKSIZE_s/2-ue],pe=I[X+0][Ee][ae.BLKSIZE_s/2+ue];P[Ee][ae.BLKSIZE_s/2-ue]=($*$+pe*pe)*.5}}{for(var Te=0,ue=11;ue<ae.HBLKSIZE;ue++)Te+=A[ue];te.tot_ener[q]=Te}if(w.analysis){for(var ue=0;ue<ae.HBLKSIZE;ue++)te.pinfo.energy[G][q][ue]=te.pinfo.energy_save[q][ue],te.pinfo.energy_save[q][ue]=A[ue];te.pinfo.pe[G][q]=te.pe[q]}w.athaa_loudapprox==2&&q<2&&(te.loudness_sq[G][q]=te.loudness_sq_save[q],te.loudness_sq_save[q]=j(A,te))}var d=8,R=23,x=15,C,B,i,E=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function p(){C=Math.pow(10,(d+1)/16),B=Math.pow(10,(R+1)/16),i=Math.pow(10,x/10)}var h=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],b=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],S=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function c(w,A,P,D,z,I){var X;if(A>w)if(A<w*B)X=A/w;else return w+A;else{if(w>=A*B)return w+A;X=w/A}if(w+=A,D+3<=3+3){if(X>=C)return w;var G=0|xt.FAST_LOG10_X(X,16);return w*b[G]}var G=0|xt.FAST_LOG10_X(X,16);if(I!=0?A=z.ATH.cb_s[P]*z.ATH.adjust:A=z.ATH.cb_l[P]*z.ATH.adjust,w<i*A){if(w>A){var q,ee;return q=1,G<=13&&(q=S[G]),ee=xt.FAST_LOG10_X(w/A,10/15),w*((h[G]-q)*ee+q)}return G>13?w:w*S[G]}return w*h[G]}var _=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function f(w,A,P){var D;if(w<0&&(w=0),A<0&&(A=0),w<=0)return A;if(A<=0)return w;if(A>w?D=A/w:D=w/A,-2<=P&&P<=2){if(D>=C)return w+A;var z=0|xt.FAST_LOG10_X(D,16);return(w+A)*_[z]}return D<B?w+A:(w<A&&(w=A),w)}function L(w,A){var P=w.internal_flags;if(P.channels_out>1){for(var D=0;D<ae.SBMAX_l;D++){var z=P.thm[0].l[D],I=P.thm[1].l[D];P.thm[0].l[D]+=I*A,P.thm[1].l[D]+=z*A}for(var D=0;D<ae.SBMAX_s;D++)for(var X=0;X<3;X++){var z=P.thm[0].s[D][X],I=P.thm[1].s[D][X];P.thm[0].s[D][X]+=I*A,P.thm[1].s[D][X]+=z*A}}}function Y(w){for(var A=0;A<ae.SBMAX_l;A++)if(!(w.thm[0].l[A]>1.58*w.thm[1].l[A]||w.thm[1].l[A]>1.58*w.thm[0].l[A])){var P=w.mld_l[A]*w.en[3].l[A],D=Math.max(w.thm[2].l[A],Math.min(w.thm[3].l[A],P));P=w.mld_l[A]*w.en[2].l[A];var z=Math.max(w.thm[3].l[A],Math.min(w.thm[2].l[A],P));w.thm[2].l[A]=D,w.thm[3].l[A]=z}for(var A=0;A<ae.SBMAX_s;A++)for(var I=0;I<3;I++)if(!(w.thm[0].s[A][I]>1.58*w.thm[1].s[A][I]||w.thm[1].s[A][I]>1.58*w.thm[0].s[A][I])){var P=w.mld_s[A]*w.en[3].s[A][I],D=Math.max(w.thm[2].s[A][I],Math.min(w.thm[3].s[A][I],P));P=w.mld_s[A]*w.en[2].s[A][I];var z=Math.max(w.thm[3].s[A][I],Math.min(w.thm[2].s[A][I],P));w.thm[2].s[A][I]=D,w.thm[3].s[A][I]=z}}function F(w,A,P){var D=A,z=Math.pow(10,P);A*=2,D*=2;for(var I=0;I<ae.SBMAX_l;I++){var X,G,q,ee;if(ee=w.ATH.cb_l[w.bm_l[I]]*z,X=Math.min(Math.max(w.thm[0].l[I],ee),Math.max(w.thm[1].l[I],ee)),G=Math.max(w.thm[2].l[I],ee),q=Math.max(w.thm[3].l[I],ee),X*A<G+q){var K=X*D/(G+q);G*=K,q*=K}w.thm[2].l[I]=Math.min(G,w.thm[2].l[I]),w.thm[3].l[I]=Math.min(q,w.thm[3].l[I])}z*=ae.BLKSIZE_s/ae.BLKSIZE;for(var I=0;I<ae.SBMAX_s;I++)for(var te=0;te<3;te++){var X,G,q,ee;if(ee=w.ATH.cb_s[w.bm_s[I]]*z,X=Math.min(Math.max(w.thm[0].s[I][te],ee),Math.max(w.thm[1].s[I][te],ee)),G=Math.max(w.thm[2].s[I][te],ee),q=Math.max(w.thm[3].s[I][te],ee),X*A<G+q){var K=X*A/(G+q);G*=K,q*=K}w.thm[2].s[I][te]=Math.min(w.thm[2].s[I][te],G),w.thm[3].s[I][te]=Math.min(w.thm[3].s[I][te],q)}}function U(w,A,P,D,z){var I,X,G=0,q=0;for(I=X=0;I<ae.SBMAX_s;++X,++I){for(var ee=w.bo_s[I],K=w.npart_s,te=ee<K?ee:K;X<te;)xe(A[X]>=0),xe(P[X]>=0),G+=A[X],q+=P[X],X++;if(w.en[D].s[I][z]=G,w.thm[D].s[I][z]=q,X>=K){++I;break}xe(A[X]>=0),xe(P[X]>=0);{var ue=w.PSY.bo_s_weight[I],Me=1-ue;G=ue*A[X],q=ue*P[X],w.en[D].s[I][z]+=G,w.thm[D].s[I][z]+=q,G=Me*A[X],q=Me*P[X]}}for(;I<ae.SBMAX_s;++I)w.en[D].s[I][z]=0,w.thm[D].s[I][z]=0}function l(w,A,P,D){var z,I,X=0,G=0;for(z=I=0;z<ae.SBMAX_l;++I,++z){for(var q=w.bo_l[z],ee=w.npart_l,K=q<ee?q:ee;I<K;)xe(A[I]>=0),xe(P[I]>=0),X+=A[I],G+=P[I],I++;if(w.en[D].l[z]=X,w.thm[D].l[z]=G,I>=ee){++z;break}xe(A[I]>=0),xe(P[I]>=0);{var te=w.PSY.bo_l_weight[z],ue=1-te;X=te*A[I],G=te*P[I],w.en[D].l[z]+=X,w.thm[D].l[z]+=G,X=ue*A[I],G=ue*P[I]}}for(;z<ae.SBMAX_l;++z)w.en[D].l[z]=0,w.thm[D].l[z]=0}function v(w,A,P,D,z,I){var X=w.internal_flags,G,q;for(q=G=0;q<X.npart_s;++q){for(var ee=0,K=X.numlines_s[q],te=0;te<K;++te,++G){var ue=A[I][G];ee+=ue}P[q]=ee}for(xe(q==X.npart_s),G=q=0;q<X.npart_s;q++){var Me=X.s3ind_s[q][0],re=X.s3_ss[G++]*P[Me];for(++Me;Me<=X.s3ind_s[q][1];)re+=X.s3_ss[G]*P[Me],++G,++Me;{var Ee=m*X.nb_s1[z][q];D[q]=Math.min(re,Ee)}if(X.blocktype_old[z&1]==ae.SHORT_TYPE){var Ee=n*X.nb_s2[z][q],$=D[q];D[q]=Math.min(Ee,$)}X.nb_s2[z][q]=X.nb_s1[z][q],X.nb_s1[z][q]=re,xe(D[q]>=0)}for(;q<=ae.CBANDS;++q)P[q]=0,D[q]=0}function Z(w,A,P,D){var z=w.internal_flags;w.short_blocks==rs.short_block_coupled&&!(A[0]!=0&&A[1]!=0)&&(A[0]=A[1]=0);for(var I=0;I<z.channels_out;I++)D[I]=ae.NORM_TYPE,w.short_blocks==rs.short_block_dispensed&&(A[I]=1),w.short_blocks==rs.short_block_forced&&(A[I]=0),A[I]!=0?(xe(z.blocktype_old[I]!=ae.START_TYPE),z.blocktype_old[I]==ae.SHORT_TYPE&&(D[I]=ae.STOP_TYPE)):(D[I]=ae.SHORT_TYPE,z.blocktype_old[I]==ae.NORM_TYPE&&(z.blocktype_old[I]=ae.START_TYPE),z.blocktype_old[I]==ae.STOP_TYPE&&(z.blocktype_old[I]=ae.SHORT_TYPE)),P[I]=z.blocktype_old[I],z.blocktype_old[I]=D[I]}function W(w,A,P){return P>=1?w:P<=0?A:A>0?Math.pow(w/A,P)*A:0}var se=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function me(w,A){for(var P=309.07,D=0;D<ae.SBMAX_s-1;D++)for(var z=0;z<3;z++){var I=w.thm.s[D][z];if(I>0){var X=I*A,G=w.en.s[D][z];G>X&&(G>X*1e10?P+=se[D]*(10*t):P+=se[D]*xt.FAST_LOG10(G/X))}}return P}var ce=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function he(w,A){for(var P=281.0575,D=0;D<ae.SBMAX_l-1;D++){var z=w.thm.l[D];if(z>0){var I=z*A,X=w.en.l[D];X>I&&(X>I*1e10?P+=ce[D]*(10*t):P+=ce[D]*xt.FAST_LOG10(X/I))}}return P}function ke(w,A,P,D,z){var I,X;for(I=X=0;I<w.npart_l;++I){var G=0,q=0,ee;for(ee=0;ee<w.numlines_l[I];++ee,++X){var K=A[X];G+=K,q<K&&(q=K)}P[I]=G,D[I]=q,z[I]=G*w.rnumlines_l[I],xe(w.rnumlines_l[I]>=0),xe(P[I]>=0),xe(D[I]>=0),xe(z[I]>=0)}}function ve(w,A,P,D){var z=E.length-1,I=0,X=P[I]+P[I+1];if(X>0){var G=A[I];G<A[I+1]&&(G=A[I+1]),xe(w.numlines_l[I]+w.numlines_l[I+1]-1>0),X=20*(G*2-X)/(X*(w.numlines_l[I]+w.numlines_l[I+1]-1));var q=0|X;q>z&&(q=z),D[I]=q}else D[I]=0;for(I=1;I<w.npart_l-1;I++)if(X=P[I-1]+P[I]+P[I+1],X>0){var G=A[I-1];G<A[I]&&(G=A[I]),G<A[I+1]&&(G=A[I+1]),xe(w.numlines_l[I-1]+w.numlines_l[I]+w.numlines_l[I+1]-1>0),X=20*(G*3-X)/(X*(w.numlines_l[I-1]+w.numlines_l[I]+w.numlines_l[I+1]-1));var q=0|X;q>z&&(q=z),D[I]=q}else D[I]=0;if(xe(I==w.npart_l-1),X=P[I-1]+P[I],X>0){var G=A[I-1];G<A[I]&&(G=A[I]),xe(w.numlines_l[I-1]+w.numlines_l[I]-1>0),X=20*(G*2-X)/(X*(w.numlines_l[I-1]+w.numlines_l[I]-1));var q=0|X;q>z&&(q=z),D[I]=q}else D[I]=0;xe(I==w.npart_l-1)}var de=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(w,A,P,D,z,I,X,G,q,ee){var K=w.internal_flags,te=zt([2,ae.BLKSIZE]),ue=zt([2,3,ae.BLKSIZE_s]),Me=dt(ae.CBANDS+1),re=dt(ae.CBANDS+1),Ee=dt(ae.CBANDS+2),$=La(2),pe=La(2),Te,ne,ye,oe,we,Ke,fe,Ae,Ce=zt([2,576]),We,Ft=La(ae.CBANDS+2),ct=La(ae.CBANDS+2);for(Fm.fill(ct,0),Te=K.channels_out,w.mode==MPEGMode.JOINT_STEREO&&(Te=4),w.VBR==ss.vbr_off?We=K.ResvMax==0?0:K.ResvSize/K.ResvMax*.5:w.VBR==ss.vbr_rh||w.VBR==ss.vbr_mtrh||w.VBR==ss.vbr_mt?We=.6:We=1,ne=0;ne<K.channels_out;ne++){var Qe=A[ne],Lt=P+576-350-k+192;for(oe=0;oe<576;oe++){var Dt,Ut;for(Dt=Qe[Lt+oe+10],Ut=0,we=0;we<(k-1)/2-1;we+=2)Dt+=de[we]*(Qe[Lt+oe+we]+Qe[Lt+oe+k-we]),Ut+=de[we+1]*(Qe[Lt+oe+we+1]+Qe[Lt+oe+k-we-1]);Ce[ne][oe]=Dt+Ut}z[D][ne].en.assign(K.en[ne]),z[D][ne].thm.assign(K.thm[ne]),Te>2&&(I[D][ne].en.assign(K.en[ne+2]),I[D][ne].thm.assign(K.thm[ne+2]))}for(ne=0;ne<Te;ne++){var $t,Jt,Mt=dt(12),la=[0,0,0,0],hs=dt(12),Pn=1,f0,v0=dt(ae.CBANDS),g0=dt(ae.CBANDS),$e=[0,0,0,0],p0=dt(ae.HBLKSIZE),b0=zt([3,ae.HBLKSIZE_s]);for(xe(K.npart_s<=ae.CBANDS),xe(K.npart_l<=ae.CBANDS),oe=0;oe<3;oe++)Mt[oe]=K.nsPsy.last_en_subshort[ne][oe+6],xe(K.nsPsy.last_en_subshort[ne][oe+4]>0),hs[oe]=Mt[oe]/K.nsPsy.last_en_subshort[ne][oe+4],la[0]+=Mt[oe];if(ne==2)for(oe=0;oe<576;oe++){var Fn,Dn;Fn=Ce[0][oe],Dn=Ce[1][oe],Ce[0][oe]=Fn+Dn,Ce[1][oe]=Fn-Dn}{var y0=Ce[ne&1],Xs=0;for(oe=0;oe<9;oe++){for(var Su=Xs+64,vt=1;Xs<Su;Xs++)vt<Math.abs(y0[Xs])&&(vt=Math.abs(y0[Xs]));K.nsPsy.last_en_subshort[ne][oe]=Mt[oe+3]=vt,la[1+oe/3]+=vt,vt>Mt[oe+3-2]?(xe(Mt[oe+3-2]>0),vt=vt/Mt[oe+3-2]):Mt[oe+3-2]>vt*10?vt=Mt[oe+3-2]/(vt*10):vt=0,hs[oe+3]=vt}}if(w.analysis){var Un=hs[0];for(oe=1;oe<12;oe++)Un<hs[oe]&&(Un=hs[oe]);K.pinfo.ers[D][ne]=K.pinfo.ers_save[ne],K.pinfo.ers_save[ne]=Un}for(f0=ne==3?K.nsPsy.attackthre_s:K.nsPsy.attackthre,oe=0;oe<12;oe++)$e[oe/3]==0&&hs[oe]>f0&&($e[oe/3]=oe%3+1);for(oe=1;oe<4;oe++){var qn;la[oe-1]>la[oe]?(xe(la[oe]>0),qn=la[oe-1]/la[oe]):(xe(la[oe-1]>0),qn=la[oe]/la[oe-1]),qn<1.7&&($e[oe]=0,oe==1&&($e[0]=0))}for($e[0]!=0&&K.nsPsy.lastAttacks[ne]!=0&&($e[0]=0),(K.nsPsy.lastAttacks[ne]==3||$e[0]+$e[1]+$e[2]+$e[3]!=0)&&(Pn=0,$e[1]!=0&&$e[0]!=0&&($e[1]=0),$e[2]!=0&&$e[1]!=0&&($e[2]=0),$e[3]!=0&&$e[2]!=0&&($e[3]=0)),ne<2?pe[ne]=Pn:Pn==0&&(pe[0]=pe[1]=0),q[ne]=K.tot_ener[ne],Jt=ue,$t=te,V(w,p0,b0,$t,ne&1,Jt,ne&1,D,ne,A,P),ke(K,p0,Me,v0,g0),ve(K,v0,g0,Ft),Ae=0;Ae<3;Ae++){var zn,Nt;for(v(w,b0,re,Ee,ne,Ae),U(K,re,Ee,ne,Ae),fe=0;fe<ae.SBMAX_s;fe++){if(Nt=K.thm[ne].s[fe][Ae],Nt*=g,$e[Ae]>=2||$e[Ae+1]==1){var Ys=Ae!=0?Ae-1:2,vt=W(K.thm[ne].s[fe][Ys],Nt,N*We);Nt=Math.min(Nt,vt)}if($e[Ae]==1){var Ys=Ae!=0?Ae-1:2,vt=W(K.thm[ne].s[fe][Ys],Nt,u*We);Nt=Math.min(Nt,vt)}else if(Ae!=0&&$e[Ae-1]==3||Ae==0&&K.nsPsy.lastAttacks[ne]==3){var Ys=Ae!=2?Ae+1:0,vt=W(K.thm[ne].s[fe][Ys],Nt,u*We);Nt=Math.min(Nt,vt)}zn=Mt[Ae*3+3]+Mt[Ae*3+4]+Mt[Ae*3+5],Mt[Ae*3+5]*6<zn&&(Nt*=.5,Mt[Ae*3+4]*6<zn&&(Nt*=.5)),K.thm[ne].s[fe][Ae]=Nt}}for(K.nsPsy.lastAttacks[ne]=$e[2],Ke=0,ye=0;ye<K.npart_l;ye++){for(var Xa=K.s3ind[ye][0],Xn=Me[Xa]*E[Ft[Xa]],Ya=K.s3_ll[Ke++]*Xn;++Xa<=K.s3ind[ye][1];)Xn=Me[Xa]*E[Ft[Xa]],Ya=c(Ya,K.s3_ll[Ke++]*Xn,Xa,Xa-ye,K,0);Ya*=.158489319246111,K.blocktype_old[ne&1]==ae.SHORT_TYPE?Ee[ye]=Ya:Ee[ye]=W(Math.min(Ya,Math.min(a*K.nb_1[ne][ye],o*K.nb_2[ne][ye])),Ya,We),K.nb_2[ne][ye]=K.nb_1[ne][ye],K.nb_1[ne][ye]=Ya}for(;ye<=ae.CBANDS;++ye)Me[ye]=0,Ee[ye]=0;l(K,Me,Ee,ne)}if((w.mode==MPEGMode.STEREO||w.mode==MPEGMode.JOINT_STEREO)&&w.interChRatio>0&&L(w,w.interChRatio),w.mode==MPEGMode.JOINT_STEREO){var Yn;Y(K),Yn=w.msfix,Math.abs(Yn)>0&&F(K,Yn,w.ATHlower*K.ATH.adjust)}for(Z(w,pe,ee,$),ne=0;ne<Te;ne++){var Gs,Ks=0,jr,Hr;ne>1?(Gs=G,Ks=-2,jr=ae.NORM_TYPE,(ee[0]==ae.SHORT_TYPE||ee[1]==ae.SHORT_TYPE)&&(jr=ae.SHORT_TYPE),Hr=I[D][ne-2]):(Gs=X,Ks=0,jr=ee[ne],Hr=z[D][ne]),jr==ae.SHORT_TYPE?Gs[Ks+ne]=me(Hr,K.masking_lower):Gs[Ks+ne]=he(Hr,K.masking_lower),w.analysis&&(K.pinfo.pe[D][ne]=Gs[Ks+ne])}return 0};function Re(w,A,P,D,z,I,X,G){var q=w.internal_flags;if(D<2)e.fft_long(q,X[G],D,A,P);else if(D==2)for(var ee=ae.BLKSIZE-1;ee>=0;--ee){var K=X[G+0][ee],te=X[G+1][ee];X[G+0][ee]=(K+te)*xt.SQRT2*.5,X[G+1][ee]=(K-te)*xt.SQRT2*.5}I[0]=X[G+0][0],I[0]*=I[0];for(var ee=ae.BLKSIZE/2-1;ee>=0;--ee){var ue=X[G+0][ae.BLKSIZE/2-ee],Me=X[G+0][ae.BLKSIZE/2+ee];I[ae.BLKSIZE/2-ee]=(ue*ue+Me*Me)*.5}{for(var re=0,ee=11;ee<ae.HBLKSIZE;ee++)re+=I[ee];q.tot_ener[D]=re}if(w.analysis){for(var ee=0;ee<ae.HBLKSIZE;ee++)q.pinfo.energy[z][D][ee]=q.pinfo.energy_save[D][ee],q.pinfo.energy_save[D][ee]=I[ee];q.pinfo.pe[z][D]=q.pe[D]}}function je(w,A,P,D,z,I,X,G){var q=w.internal_flags;if(z==0&&D<2&&e.fft_short(q,X[G],D,A,P),D==2)for(var ee=ae.BLKSIZE_s-1;ee>=0;--ee){var K=X[G+0][z][ee],te=X[G+1][z][ee];X[G+0][z][ee]=(K+te)*xt.SQRT2*.5,X[G+1][z][ee]=(K-te)*xt.SQRT2*.5}I[z][0]=X[G+0][z][0],I[z][0]*=I[z][0];for(var ee=ae.BLKSIZE_s/2-1;ee>=0;--ee){var ue=X[G+0][z][ae.BLKSIZE_s/2-ee],Me=X[G+0][z][ae.BLKSIZE_s/2+ee];I[z][ae.BLKSIZE_s/2-ee]=(ue*ue+Me*Me)*.5}}function Be(w,A,P,D){var z=w.internal_flags;w.athaa_loudapprox==2&&P<2&&(z.loudness_sq[A][P]=z.loudness_sq_save[P],z.loudness_sq_save[P]=j(D,z))}var De=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function He(w,A,P,D,z,I,X,G,q,ee){for(var K=zt([2,576]),te=w.internal_flags,ue=te.channels_out,Me=w.mode==MPEGMode.JOINT_STEREO?4:ue,re=0;re<ue;re++){firbuf=A[re];for(var Ee=P+576-350-k+192,$=0;$<576;$++){var pe,Te;pe=firbuf[Ee+$+10],Te=0;for(var ne=0;ne<(k-1)/2-1;ne+=2)pe+=De[ne]*(firbuf[Ee+$+ne]+firbuf[Ee+$+k-ne]),Te+=De[ne+1]*(firbuf[Ee+$+ne+1]+firbuf[Ee+$+k-ne-1]);K[re][$]=pe+Te}z[D][re].en.assign(te.en[re]),z[D][re].thm.assign(te.thm[re]),Me>2&&(I[D][re].en.assign(te.en[re+2]),I[D][re].thm.assign(te.thm[re+2]))}for(var re=0;re<Me;re++){var ye=dt(12),oe=dt(12),we=[0,0,0,0],Ke=K[re&1],fe=0,Ae=re==3?te.nsPsy.attackthre_s:te.nsPsy.attackthre,Ce=1;if(re==2)for(var $=0,ne=576;ne>0;++$,--ne){var We=K[0][$],Ft=K[1][$];K[0][$]=We+Ft,K[1][$]=We-Ft}for(var $=0;$<3;$++)oe[$]=te.nsPsy.last_en_subshort[re][$+6],xe(te.nsPsy.last_en_subshort[re][$+4]>0),ye[$]=oe[$]/te.nsPsy.last_en_subshort[re][$+4],we[0]+=oe[$];for(var $=0;$<9;$++){for(var ct=fe+64,Qe=1;fe<ct;fe++)Qe<Math.abs(Ke[fe])&&(Qe=Math.abs(Ke[fe]));te.nsPsy.last_en_subshort[re][$]=oe[$+3]=Qe,we[1+$/3]+=Qe,Qe>oe[$+3-2]?(xe(oe[$+3-2]>0),Qe=Qe/oe[$+3-2]):oe[$+3-2]>Qe*10?Qe=oe[$+3-2]/(Qe*10):Qe=0,ye[$+3]=Qe}for(var $=0;$<3;++$){var Lt=oe[$*3+3]+oe[$*3+4]+oe[$*3+5],Dt=1;oe[$*3+5]*6<Lt&&(Dt*=.5,oe[$*3+4]*6<Lt&&(Dt*=.5)),G[re][$]=Dt}if(w.analysis){for(var Ut=ye[0],$=1;$<12;$++)Ut<ye[$]&&(Ut=ye[$]);te.pinfo.ers[D][re]=te.pinfo.ers_save[re],te.pinfo.ers_save[re]=Ut}for(var $=0;$<12;$++)q[re][$/3]==0&&ye[$]>Ae&&(q[re][$/3]=$%3+1);for(var $=1;$<4;$++){var $t=we[$-1],Jt=we[$],Mt=Math.max($t,Jt);Mt<4e4&&$t<1.7*Jt&&Jt<1.7*$t&&($==1&&q[re][0]<=q[re][$]&&(q[re][0]=0),q[re][$]=0)}q[re][0]<=te.nsPsy.lastAttacks[re]&&(q[re][0]=0),(te.nsPsy.lastAttacks[re]==3||q[re][0]+q[re][1]+q[re][2]+q[re][3]!=0)&&(Ce=0,q[re][1]!=0&&q[re][0]!=0&&(q[re][1]=0),q[re][2]!=0&&q[re][1]!=0&&(q[re][2]=0),q[re][3]!=0&&q[re][2]!=0&&(q[re][3]=0)),re<2?ee[re]=Ce:Ce==0&&(ee[0]=ee[1]=0),X[re]=te.tot_ener[re]}}function Pe(w,A,P){if(P==0)for(var D=0;D<w.npart_s;D++)w.nb_s2[A][D]=w.nb_s1[A][D],w.nb_s1[A][D]=0}function Ge(w,A){for(var P=0;P<w.npart_l;P++)w.nb_2[A][P]=w.nb_1[A][P],w.nb_1[A][P]=0}function St(w,A,P,D){var z=E.length-1,I=0,X=P[I]+P[I+1];if(X>0){var G=A[I];G<A[I+1]&&(G=A[I+1]),xe(w.numlines_s[I]+w.numlines_s[I+1]-1>0),X=20*(G*2-X)/(X*(w.numlines_s[I]+w.numlines_s[I+1]-1));var q=0|X;q>z&&(q=z),D[I]=q}else D[I]=0;for(I=1;I<w.npart_s-1;I++)if(X=P[I-1]+P[I]+P[I+1],xe(I+1<w.npart_s),X>0){var G=A[I-1];G<A[I]&&(G=A[I]),G<A[I+1]&&(G=A[I+1]),xe(w.numlines_s[I-1]+w.numlines_s[I]+w.numlines_s[I+1]-1>0),X=20*(G*3-X)/(X*(w.numlines_s[I-1]+w.numlines_s[I]+w.numlines_s[I+1]-1));var q=0|X;q>z&&(q=z),D[I]=q}else D[I]=0;if(xe(I==w.npart_s-1),X=P[I-1]+P[I],X>0){var G=A[I-1];G<A[I]&&(G=A[I]),xe(w.numlines_s[I-1]+w.numlines_s[I]-1>0),X=20*(G*2-X)/(X*(w.numlines_s[I-1]+w.numlines_s[I]-1));var q=0|X;q>z&&(q=z),D[I]=q}else D[I]=0;xe(I==w.npart_s-1)}function _t(w,A,P,D,z,I){var X=w.internal_flags,G=new float[ae.CBANDS],q=dt(ae.CBANDS),ee,K,te,ue=new int[ae.CBANDS];for(te=K=0;te<X.npart_s;++te){var Me=0,re=0,Ee=X.numlines_s[te];for(ee=0;ee<Ee;++ee,++K){var $=A[I][K];Me+=$,re<$&&(re=$)}P[te]=Me,G[te]=re,q[te]=Me/Ee,xe(q[te]>=0)}for(xe(te==X.npart_s);te<ae.CBANDS;++te)G[te]=0,q[te]=0;for(St(X,G,q,ue),K=te=0;te<X.npart_s;te++){var pe=X.s3ind_s[te][0],Te=X.s3ind_s[te][1],ne,ye,oe,we,Ke;for(ne=ue[pe],ye=1,we=X.s3_ss[K]*P[pe]*E[ue[pe]],++K,++pe;pe<=Te;)ne+=ue[pe],ye+=1,oe=X.s3_ss[K]*P[pe]*E[ue[pe]],we=f(we,oe,pe-te),++K,++pe;ne=(1+2*ne)/(2*ye),Ke=E[ne]*.5,we*=Ke,D[te]=we,X.nb_s2[z][te]=X.nb_s1[z][te],X.nb_s1[z][te]=we,oe=G[te],oe*=X.minval_s[te],oe*=Ke,D[te]>oe&&(D[te]=oe),X.masking_lower>1&&(D[te]*=X.masking_lower),D[te]>P[te]&&(D[te]=P[te]),X.masking_lower<1&&(D[te]*=X.masking_lower),xe(D[te]>=0)}for(;te<ae.CBANDS;++te)P[te]=0,D[te]=0}function lt(w,A,P,D,z){var I=dt(ae.CBANDS),X=dt(ae.CBANDS),G=La(ae.CBANDS+2),q;ke(w,A,P,I,X),ve(w,I,X,G);var ee=0;for(q=0;q<w.npart_l;q++){var K,te,ue,Me,re=w.s3ind[q][0],Ee=w.s3ind[q][1],$=0,pe=0;for($=G[re],pe+=1,te=w.s3_ll[ee]*P[re]*E[G[re]],++ee,++re;re<=Ee;)$+=G[re],pe+=1,K=w.s3_ll[ee]*P[re]*E[G[re]],Me=f(te,K,re-q),te=Me,++ee,++re;if($=(1+2*$)/(2*pe),ue=E[$]*.5,te*=ue,w.blocktype_old[z&1]==ae.SHORT_TYPE){var Te=a*w.nb_1[z][q];Te>0?D[q]=Math.min(te,Te):D[q]=Math.min(te,P[q]*u)}else{var ne=o*w.nb_2[z][q],ye=a*w.nb_1[z][q],Te;ne<=0&&(ne=te),ye<=0&&(ye=te),w.blocktype_old[z&1]==ae.NORM_TYPE?Te=Math.min(ye,ne):Te=ye,D[q]=Math.min(te,Te)}w.nb_2[z][q]=w.nb_1[z][q],w.nb_1[z][q]=te,K=I[q],K*=w.minval_l[q],K*=ue,D[q]>K&&(D[q]=K),w.masking_lower>1&&(D[q]*=w.masking_lower),D[q]>P[q]&&(D[q]=P[q]),w.masking_lower<1&&(D[q]*=w.masking_lower),xe(D[q]>=0)}for(;q<ae.CBANDS;++q)P[q]=0,D[q]=0}function Et(w,A){var P=w.internal_flags;w.short_blocks==rs.short_block_coupled&&!(A[0]!=0&&A[1]!=0)&&(A[0]=A[1]=0);for(var D=0;D<P.channels_out;D++)w.short_blocks==rs.short_block_dispensed&&(A[D]=1),w.short_blocks==rs.short_block_forced&&(A[D]=0)}function Ot(w,A,P){for(var D=w.internal_flags,z=0;z<D.channels_out;z++){var I=ae.NORM_TYPE;A[z]!=0?(xe(D.blocktype_old[z]!=ae.START_TYPE),D.blocktype_old[z]==ae.SHORT_TYPE&&(I=ae.STOP_TYPE)):(I=ae.SHORT_TYPE,D.blocktype_old[z]==ae.NORM_TYPE&&(D.blocktype_old[z]=ae.START_TYPE),D.blocktype_old[z]==ae.STOP_TYPE&&(D.blocktype_old[z]=ae.SHORT_TYPE)),P[z]=D.blocktype_old[z],D.blocktype_old[z]=I}}function Pt(w,A,P,D,z,I,X){for(var G=I*2,q=I>0?Math.pow(10,z):1,ee,K,te=0;te<X;++te){var ue=w[2][te],Me=w[3][te],re=A[0][te],Ee=A[1][te],$=A[2][te],pe=A[3][te];if(re<=1.58*Ee&&Ee<=1.58*re){var Te=P[te]*Me,ne=P[te]*ue;K=Math.max($,Math.min(pe,Te)),ee=Math.max(pe,Math.min($,ne))}else K=$,ee=pe;if(I>0){var ye,oe,we=D[te]*q;if(ye=Math.min(Math.max(re,we),Math.max(Ee,we)),$=Math.max(K,we),pe=Math.max(ee,we),oe=$+pe,oe>0&&ye*G<oe){var Ke=ye*G/oe;$*=Ke,pe*=Ke}K=Math.min($,K),ee=Math.min(pe,ee)}K>ue&&(K=ue),ee>Me&&(ee=Me),A[2][te]=K,A[3][te]=ee}}this.L3psycho_anal_vbr=function(w,A,P,D,z,I,X,G,q,ee){var K=w.internal_flags,te,ue,Me=dt(ae.HBLKSIZE),re=zt([3,ae.HBLKSIZE_s]),Ee=zt([2,ae.BLKSIZE]),$=zt([2,3,ae.BLKSIZE_s]),pe=zt([4,ae.CBANDS]),Te=zt([4,ae.CBANDS]),ne=zt([4,3]),ye=.6,oe=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],we=La(2),Ke=w.mode==MPEGMode.JOINT_STEREO?4:K.channels_out;He(w,A,P,D,z,I,q,ne,oe,we),Et(w,we);{for(var fe=0;fe<Ke;fe++){var Ae=fe&1;te=Ee,Re(w,A,P,fe,D,Me,te,Ae),Be(w,D,fe,Me),we[Ae]!=0?lt(K,Me,pe[fe],Te[fe],fe):Ge(K,fe)}we[0]+we[1]==2&&w.mode==MPEGMode.JOINT_STEREO&&Pt(pe,Te,K.mld_cb_l,K.ATH.cb_l,w.ATHlower*K.ATH.adjust,w.msfix,K.npart_l);for(var fe=0;fe<Ke;fe++){var Ae=fe&1;we[Ae]!=0&&l(K,pe[fe],Te[fe],fe)}}{for(var Ce=0;Ce<3;Ce++){for(var fe=0;fe<Ke;++fe){var Ae=fe&1;we[Ae]!=0?Pe(K,fe,Ce):(ue=$,je(w,A,P,fe,Ce,re,ue,Ae),_t(w,re,pe[fe],Te[fe],fe,Ce))}we[0]+we[1]==0&&w.mode==MPEGMode.JOINT_STEREO&&Pt(pe,Te,K.mld_cb_s,K.ATH.cb_s,w.ATHlower*K.ATH.adjust,w.msfix,K.npart_s);for(var fe=0;fe<Ke;++fe){var Ae=fe&1;we[Ae]==0&&U(K,pe[fe],Te[fe],fe,Ce)}}for(var fe=0;fe<Ke;fe++){var Ae=fe&1;if(we[Ae]==0)for(var We=0;We<ae.SBMAX_s;We++){for(var Ft=dt(3),Ce=0;Ce<3;Ce++){var ct=K.thm[fe].s[We][Ce];if(ct*=g,oe[fe][Ce]>=2||oe[fe][Ce+1]==1){var Qe=Ce!=0?Ce-1:2,Lt=W(K.thm[fe].s[We][Qe],ct,N*ye);ct=Math.min(ct,Lt)}else if(oe[fe][Ce]==1){var Qe=Ce!=0?Ce-1:2,Lt=W(K.thm[fe].s[We][Qe],ct,u*ye);ct=Math.min(ct,Lt)}else if(Ce!=0&&oe[fe][Ce-1]==3||Ce==0&&K.nsPsy.lastAttacks[fe]==3){var Qe=Ce!=2?Ce+1:0,Lt=W(K.thm[fe].s[We][Qe],ct,u*ye);ct=Math.min(ct,Lt)}ct*=ne[fe][Ce],Ft[Ce]=ct}for(var Ce=0;Ce<3;Ce++)K.thm[fe].s[We][Ce]=Ft[Ce]}}}for(var fe=0;fe<Ke;fe++)K.nsPsy.lastAttacks[fe]=oe[fe][2];Ot(w,we,ee);for(var fe=0;fe<Ke;fe++){var Dt,Ut,$t,Jt;fe>1?(Dt=G,Ut=-2,$t=ae.NORM_TYPE,(ee[0]==ae.SHORT_TYPE||ee[1]==ae.SHORT_TYPE)&&($t=ae.SHORT_TYPE),Jt=I[D][fe-2]):(Dt=X,Ut=0,$t=ee[fe],Jt=z[D][fe]),$t==ae.SHORT_TYPE?Dt[Ut+fe]=me(Jt,K.masking_lower):Dt[Ut+fe]=he(Jt,K.masking_lower),w.analysis&&(K.pinfo.pe[D][fe]=Dt[Ut+fe])}return 0};function ht(w,A){var P=w,D;return P>=0?D=-P*27:D=P*A,D<=-72?0:Math.exp(D*r)}function Yt(w){var A=0,P=0;{var D=0,z,I;for(D=0;ht(D,w)>1e-20;D-=1);for(z=D,I=0;Math.abs(I-z)>1e-12;)D=(I+z)/2,ht(D,w)>0?I=D:z=D;A=z}{var D=0,z,I;for(D=0;ht(D,w)>1e-20;D+=1);for(z=0,I=D;Math.abs(I-z)>1e-12;)D=(I+z)/2,ht(D,w)>0?z=D:I=D;P=I}{var X=0,G=1e3,q;for(q=0;q<=G;++q){var D=A+q*(P-A)/G,ee=ht(D,w);X+=ee}{var K=(G+1)/(X*(P-A));return K}}}function kt(w){var A,P,D,z;return A=w,A>=0?A*=3:A*=1.5,A>=.5&&A<=2.5?(z=A-.5,P=8*(z*z-2*z)):P=0,A+=.474,D=15.811389+7.5*A-17.5*Math.sqrt(1+A*A),D<=-60?0:(A=Math.exp((P+D)*r),A/=.6609193,A)}function ft(w){return w<0&&(w=0),w=w*.001,13*Math.atan(.76*w)+3.5*Math.atan(w*w/(7.5*7.5))}function le(w,A,P,D,z,I,X,G,q,ee,K,te){var ue=dt(ae.CBANDS+1),Me=G/(te>15?2*576:2*192),re=La(ae.HBLKSIZE),Ee;G/=q;var $=0,pe=0;for(Ee=0;Ee<ae.CBANDS;Ee++){var Te,ne;for(Te=ft(G*$),ue[Ee]=G*$,ne=$;ft(G*ne)-Te<M&&ne<=q/2;ne++);for(w[Ee]=ne-$,pe=Ee+1;$<ne;)re[$++]=Ee;if($>q/2){$=q/2,++Ee;break}}ue[Ee]=G*$;for(var ye=0;ye<te;ye++){var oe,we,Ke,fe,Ae;Ke=ee[ye],fe=ee[ye+1],oe=0|Math.floor(.5+K*(Ke-.5)),oe<0&&(oe=0),we=0|Math.floor(.5+K*(fe-.5)),we>q/2&&(we=q/2),P[ye]=(re[oe]+re[we])/2,A[ye]=re[we];var Ce=Me*fe;X[ye]=(Ce-ue[A[ye]])/(ue[A[ye]+1]-ue[A[ye]]),X[ye]<0?X[ye]=0:X[ye]>1&&(X[ye]=1),Ae=ft(G*ee[ye]*K),Ae=Math.min(Ae,15.5)/15.5,I[ye]=Math.pow(10,1.25*(1-Math.cos(Math.PI*Ae))-2.5)}$=0;for(var We=0;We<pe;We++){var Ft=w[We],Te,ct;Te=ft(G*$),ct=ft(G*($+Ft-1)),D[We]=.5*(Te+ct),Te=ft(G*($-.5)),ct=ft(G*($+Ft-.5)),z[We]=ct-Te,$+=Ft}return pe}function ge(w,A,P,D,z,I){var X=zt([ae.CBANDS,ae.CBANDS]),G,q=0;if(I)for(var ee=0;ee<A;ee++)for(G=0;G<A;G++){var K=kt(P[ee]-P[G])*D[G];X[ee][G]=K*z[ee]}else for(G=0;G<A;G++)for(var te=15+Math.min(21/P[G],12),ue=Yt(te),ee=0;ee<A;ee++){var K=ue*ht(P[ee]-P[G],te)*D[G];X[ee][G]=K*z[ee]}for(var ee=0;ee<A;ee++){for(G=0;G<A&&!(X[ee][G]>0);G++);for(w[ee][0]=G,G=A-1;G>0&&!(X[ee][G]>0);G--);w[ee][1]=G,q+=w[ee][1]-w[ee][0]+1}for(var Me=dt(q),re=0,ee=0;ee<A;ee++)for(G=w[ee][0];G<=w[ee][1];G++)Me[re++]=X[ee][G];return Me}function J(w){var A=ft(w);return A=Math.min(A,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*A))-2.5)}this.psymodel_init=function(w){var A=w.internal_flags,P,D=!0,z=13,I=24,X=0,G=0,q=-8.25,ee=-4.5,K=dt(ae.CBANDS),te=dt(ae.CBANDS),ue=dt(ae.CBANDS),Me=w.out_samplerate;switch(w.experimentalZ){default:case 0:D=!0;break;case 1:D=!(w.VBR==ss.vbr_mtrh||w.VBR==ss.vbr_mt);break;case 2:D=!1;break;case 3:z=8,X=-1.75,G=-.0125,q=-8.25,ee=-2.25;break}for(A.ms_ener_ratio_old=.25,A.blocktype_old[0]=A.blocktype_old[1]=ae.NORM_TYPE,P=0;P<4;++P){for(var $=0;$<ae.CBANDS;++$)A.nb_1[P][$]=1e20,A.nb_2[P][$]=1e20,A.nb_s1[P][$]=A.nb_s2[P][$]=1;for(var re=0;re<ae.SBMAX_l;re++)A.en[P].l[re]=1e20,A.thm[P].l[re]=1e20;for(var $=0;$<3;++$){for(var re=0;re<ae.SBMAX_s;re++)A.en[P].s[re][$]=1e20,A.thm[P].s[re][$]=1e20;A.nsPsy.lastAttacks[P]=0}for(var $=0;$<9;$++)A.nsPsy.last_en_subshort[P][$]=10}for(A.loudness_sq_save[0]=A.loudness_sq_save[1]=0,A.npart_l=le(A.numlines_l,A.bo_l,A.bm_l,K,te,A.mld_l,A.PSY.bo_l_weight,Me,ae.BLKSIZE,A.scalefac_band.l,ae.BLKSIZE/(2*576),ae.SBMAX_l),xe(A.npart_l<ae.CBANDS),P=0;P<A.npart_l;P++){var Ee=X;K[P]>=z&&(Ee=G*(K[P]-z)/(I-z)+X*(I-K[P])/(I-z)),ue[P]=Math.pow(10,Ee/10),A.numlines_l[P]>0?A.rnumlines_l[P]=1/A.numlines_l[P]:A.rnumlines_l[P]=0}A.s3_ll=ge(A.s3ind,A.npart_l,K,te,ue,D);var $=0;for(P=0;P<A.npart_l;P++){var pe;pe=Ii.MAX_VALUE;for(var Te=0;Te<A.numlines_l[P];Te++,$++){var ne=Me*$/(1e3*ae.BLKSIZE),ye;ye=this.ATHformula(ne*1e3,w)-20,ye=Math.pow(10,.1*ye),ye*=A.numlines_l[P],pe>ye&&(pe=ye)}A.ATH.cb_l[P]=pe,pe=-20+K[P]*20/10,pe>6&&(pe=100),pe<-15&&(pe=-15),pe-=8,A.minval_l[P]=Math.pow(10,pe/10)*A.numlines_l[P]}for(A.npart_s=le(A.numlines_s,A.bo_s,A.bm_s,K,te,A.mld_s,A.PSY.bo_s_weight,Me,ae.BLKSIZE_s,A.scalefac_band.s,ae.BLKSIZE_s/(2*192),ae.SBMAX_s),xe(A.npart_s<ae.CBANDS),$=0,P=0;P<A.npart_s;P++){var pe,Ee=q;K[P]>=z&&(Ee=ee*(K[P]-z)/(I-z)+q*(I-K[P])/(I-z)),ue[P]=Math.pow(10,Ee/10),pe=Ii.MAX_VALUE;for(var Te=0;Te<A.numlines_s[P];Te++,$++){var ne=Me*$/(1e3*ae.BLKSIZE_s),ye;ye=this.ATHformula(ne*1e3,w)-20,ye=Math.pow(10,.1*ye),ye*=A.numlines_s[P],pe>ye&&(pe=ye)}A.ATH.cb_s[P]=pe,pe=-7+K[P]*7/12,K[P]>12&&(pe*=1+Math.log(1+pe)*3.1),K[P]<12&&(pe*=1+Math.log(1-pe)*2.3),pe<-15&&(pe=-15),pe-=8,A.minval_s[P]=Math.pow(10,pe/10)*A.numlines_s[P]}A.s3_ss=ge(A.s3ind_s,A.npart_s,K,te,ue,D),p(),e.init_fft(A),A.decay=Math.exp(-1*t/(O*Me/192));{var oe;oe=y,(w.exp_nspsytune&2)!=0&&(oe=1),Math.abs(w.msfix)>0&&(oe=w.msfix),w.msfix=oe;for(var we=0;we<A.npart_l;we++)A.s3ind[we][1]>A.npart_l-1&&(A.s3ind[we][1]=A.npart_l-1)}var Ke=576*A.mode_gr/Me;if(A.ATH.decay=Math.pow(10,-12/10*Ke),A.ATH.adjust=.01,A.ATH.adjustLimit=1,xe(A.bo_l[ae.SBMAX_l-1]<=A.npart_l),xe(A.bo_s[ae.SBMAX_s-1]<=A.npart_s),w.ATHtype!=-1){var ne,fe=w.out_samplerate/ae.BLKSIZE,Ae=0;for(ne=0,P=0;P<ae.BLKSIZE/2;++P)ne+=fe,A.ATH.eql_w[P]=1/Math.pow(10,this.ATHformula(ne,w)/10),Ae+=A.ATH.eql_w[P];for(Ae=1/Ae,P=ae.BLKSIZE/2;--P>=0;)A.ATH.eql_w[P]*=Ae}{for(var we=$=0;we<A.npart_s;++we)for(P=0;P<A.numlines_s[we];++P)++$;for(var we=$=0;we<A.npart_l;++we)for(P=0;P<A.numlines_l[we];++P)++$}for($=0,P=0;P<A.npart_l;P++){var ne=Me*($+A.numlines_l[P]/2)/(1*ae.BLKSIZE);A.mld_cb_l[P]=J(ne),$+=A.numlines_l[P]}for(;P<ae.CBANDS;++P)A.mld_cb_l[P]=1;for($=0,P=0;P<A.npart_s;P++){var ne=Me*($+A.numlines_s[P]/2)/(1*ae.BLKSIZE_s);A.mld_cb_s[P]=J(ne),$+=A.numlines_s[P]}for(;P<ae.CBANDS;++P)A.mld_cb_s[P]=1;return 0};function be(w,A){w<-.3&&(w=3410),w/=1e3,w=Math.max(.1,w);var P=3.64*Math.pow(w,-.8)-6.8*Math.exp(-.6*Math.pow(w-3.4,2))+6*Math.exp(-.15*Math.pow(w-8.7,2))+(.6+.04*A)*.001*Math.pow(w,4);return P}this.ATHformula=function(w,A){var P;switch(A.ATHtype){case 0:P=be(w,9);break;case 1:P=be(w,-1);break;case 2:P=be(w,0);break;case 3:P=be(w,1)+6;break;case 4:P=be(w,A.ATHcurve);break;default:P=be(w,0);break}return P}}var qm=Um;function Wt(e){var t=e;this.ordinal=function(){return t}}Wt.STEREO=new Wt(0),Wt.JOINT_STEREO=new Wt(1),Wt.DUAL_CHANNEL=new Wt(2),Wt.MONO=new Wt(3),Wt.NOT_SET=new Wt(4);var Sn=Wt,zm=Sn;function Xm(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=zm.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var Ym=Xm,Gm=Rt,Vi={};Vi.SFBMAX=Gm.SBMAX_s*3;var Mr=Vi,ji=Ze,Km=ji.new_float,Na=ji.new_int,En=Mr;function Zm(){this.xr=Km(576),this.l3_enc=Na(576),this.scalefac=Na(En.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=Na(3),this.subblock_gain=Na(3+1),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=Na(En.SFBMAX),this.window=Na(En.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=Na(4),this.max_nonzero_coeff=0;var e=this;function t(o){return new Int32Array(o)}function a(o){return new Float32Array(o)}this.assign=function(o){e.xr=a(o.xr),e.l3_enc=t(o.l3_enc),e.scalefac=t(o.scalefac),e.xrpow_max=o.xrpow_max,e.part2_3_length=o.part2_3_length,e.big_values=o.big_values,e.count1=o.count1,e.global_gain=o.global_gain,e.scalefac_compress=o.scalefac_compress,e.block_type=o.block_type,e.mixed_block_flag=o.mixed_block_flag,e.table_select=t(o.table_select),e.subblock_gain=t(o.subblock_gain),e.region0_count=o.region0_count,e.region1_count=o.region1_count,e.preflag=o.preflag,e.scalefac_scale=o.scalefac_scale,e.count1table_select=o.count1table_select,e.part2_length=o.part2_length,e.sfb_lmax=o.sfb_lmax,e.sfb_smin=o.sfb_smin,e.psy_lmax=o.psy_lmax,e.sfbmax=o.sfbmax,e.psymax=o.psymax,e.sfbdivide=o.sfbdivide,e.width=t(o.width),e.window=t(o.window),e.count1bits=o.count1bits,e.sfb_partition_table=o.sfb_partition_table.slice(0),e.slen=t(o.slen),e.max_nonzero_coeff=o.max_nonzero_coeff}}var kn=Zm,Wm=Ze,Hi=Wm.new_int,Qm=kn;function $m(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[Hi(4),Hi(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new Qm}var Jm=$m,Pi=Ze,wr=Pi.System,Rr=Pi.new_int,Ar=Rt;function e2(e,t,a,o){this.l=Rr(1+Ar.SBMAX_l),this.s=Rr(1+Ar.SBMAX_s),this.psfb21=Rr(1+Ar.PSFB21),this.psfb12=Rr(1+Ar.PSFB12);var m=this.l,n=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],wr.arraycopy(this.arrL,0,m,0,Math.min(this.arrL.length,this.l.length)),wr.arraycopy(this.arrS,0,n,0,Math.min(this.arrS.length,this.s.length)),wr.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),wr.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var Fi=e2,Mn=Ze,wn=Mn.new_float,t2=Mn.new_float_n,a2=Mn.new_int,Di=Rt;function s2(){this.last_en_subshort=t2([4,9]),this.lastAttacks=a2(4),this.pefirbuf=wn(19),this.longfact=wn(Di.SBMAX_l),this.shortfact=wn(Di.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var r2=s2;function n2(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var o2=n2,ns=Ze,i2=ns.new_byte,l2=ns.new_double,Xt=ns.new_float,Ia=ns.new_float_n,Qt=ns.new_int,Tr=ns.new_int_n,c2=Jm,d2=Fi,m2=r2,h2=o2,Ui=Ai,at=Rt,_2=Mr;_a.MFSIZE=3*1152+at.ENCDELAY-at.MDCTDELAY,_a.MAX_HEADER_BUF=256,_a.MAX_BITS_PER_CHANNEL=4095,_a.MAX_BITS_PER_GRANULE=7680,_a.BPC=320;function _a(){var e=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=Ia([2,_a.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new c2,this.ms_ratio=Xt(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=Qt(2),this.CurrentStep=Qt(2),this.masking_lower=0,this.bv_scf=Qt(576),this.pseudohalf=Qt(_2.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*_a.BPC+1),this.itime=l2(2),this.sideinfo_len=0,this.sb_sample=Ia([2,2,18,at.SBLIMIT]),this.amp_filter=Xt(32);function t(){this.write_timing=0,this.ptr=0,this.buf=i2(e)}this.header=new Array(_a.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new d2,this.minval_l=Xt(at.CBANDS),this.minval_s=Xt(at.CBANDS),this.nb_1=Ia([4,at.CBANDS]),this.nb_2=Ia([4,at.CBANDS]),this.nb_s1=Ia([4,at.CBANDS]),this.nb_s2=Ia([4,at.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=Xt(4),this.loudness_sq=Ia([2,2]),this.loudness_sq_save=Xt(2),this.mld_l=Xt(at.SBMAX_l),this.mld_s=Xt(at.SBMAX_s),this.bm_l=Qt(at.SBMAX_l),this.bo_l=Qt(at.SBMAX_l),this.bm_s=Qt(at.SBMAX_s),this.bo_s=Qt(at.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=Tr([at.CBANDS,2]),this.s3ind_s=Tr([at.CBANDS,2]),this.numlines_s=Qt(at.CBANDS),this.numlines_l=Qt(at.CBANDS),this.rnumlines_l=Xt(at.CBANDS),this.mld_cb_l=Xt(at.CBANDS),this.mld_cb_s=Xt(at.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Xt(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=Qt(2),this.nsPsy=new m2,this.VBR_seek_table=new h2,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=Tr([16,4+1]),this.bitrate_blockType_Hist=Tr([16,4+1+1]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var a=0;a<this.en.length;a++)this.en[a]=new Ui;for(var a=0;a<this.thm.length;a++)this.thm[a]=new Ui;for(var a=0;a<this.header.length;a++)this.header[a]=new t}var xr=_a,u2=Ze,Va=u2.new_float,ja=Rt;function f2(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=Va(ja.SBMAX_l),this.s=Va(ja.SBMAX_s),this.psfb21=Va(ja.PSFB21),this.psfb12=Va(ja.PSFB12),this.cb_l=Va(ja.CBANDS),this.cb_s=Va(ja.CBANDS),this.eql_w=Va(ja.BLKSIZE/2)}var v2=f2,qi=Ze,Bt=qi.System,zi=qi.Arrays;st.STEPS_per_dB=100,st.MAX_dB=120,st.GAIN_NOT_ENOUGH_SAMPLES=-24601,st.GAIN_ANALYSIS_ERROR=0,st.GAIN_ANALYSIS_OK=1,st.INIT_GAIN_ANALYSIS_ERROR=0,st.INIT_GAIN_ANALYSIS_OK=1,st.YULE_ORDER=10,st.MAX_ORDER=st.YULE_ORDER,st.MAX_SAMP_FREQ=48e3,st.RMS_WINDOW_TIME_NUMERATOR=1,st.RMS_WINDOW_TIME_DENOMINATOR=20,st.MAX_SAMPLES_PER_WINDOW=st.MAX_SAMP_FREQ*st.RMS_WINDOW_TIME_NUMERATOR/st.RMS_WINDOW_TIME_DENOMINATOR+1;function st(){var e=64.82,t=.95,a=st.RMS_WINDOW_TIME_NUMERATOR,o=st.RMS_WINDOW_TIME_DENOMINATOR,m=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],n=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function M(u,y,k,r,H,j){for(;H--!=0;)k[r]=1e-10+u[y+0]*j[0]-k[r-1]*j[1]+u[y-1]*j[2]-k[r-2]*j[3]+u[y-2]*j[4]-k[r-3]*j[5]+u[y-3]*j[6]-k[r-4]*j[7]+u[y-4]*j[8]-k[r-5]*j[9]+u[y-5]*j[10]-k[r-6]*j[11]+u[y-6]*j[12]-k[r-7]*j[13]+u[y-7]*j[14]-k[r-8]*j[15]+u[y-8]*j[16]-k[r-9]*j[17]+u[y-9]*j[18]-k[r-10]*j[19]+u[y-10]*j[20],++r,++y}function T(u,y,k,r,H,j){for(;H--!=0;)k[r]=u[y+0]*j[0]-k[r-1]*j[1]+u[y-1]*j[2]-k[r-2]*j[3]+u[y-2]*j[4],++r,++y}function O(u,y){for(var k=0;k<MAX_ORDER;k++)u.linprebuf[k]=u.lstepbuf[k]=u.loutbuf[k]=u.rinprebuf[k]=u.rstepbuf[k]=u.routbuf[k]=0;switch(0|y){case 48e3:u.reqindex=0;break;case 44100:u.reqindex=1;break;case 32e3:u.reqindex=2;break;case 24e3:u.reqindex=3;break;case 22050:u.reqindex=4;break;case 16e3:u.reqindex=5;break;case 12e3:u.reqindex=6;break;case 11025:u.reqindex=7;break;case 8e3:u.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return u.sampleWindow=0|(y*a+o-1)/o,u.lsum=0,u.rsum=0,u.totsamp=0,zi.ill(u.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(u,y){return O(u,y)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(u.linpre=MAX_ORDER,u.rinpre=MAX_ORDER,u.lstep=MAX_ORDER,u.rstep=MAX_ORDER,u.lout=MAX_ORDER,u.rout=MAX_ORDER,zi.fill(u.B,0),INIT_GAIN_ANALYSIS_OK)};function g(u){return u*u}this.AnalyzeSamples=function(u,y,k,r,H,j,V){var d,R,x,C,B,i,E;if(j==0)return GAIN_ANALYSIS_OK;switch(E=0,B=j,V){case 1:r=y,H=k;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(j<MAX_ORDER?(Bt.arraycopy(y,k,u.linprebuf,MAX_ORDER,j),Bt.arraycopy(r,H,u.rinprebuf,MAX_ORDER,j)):(Bt.arraycopy(y,k,u.linprebuf,MAX_ORDER,MAX_ORDER),Bt.arraycopy(r,H,u.rinprebuf,MAX_ORDER,MAX_ORDER));B>0;){i=B>u.sampleWindow-u.totsamp?u.sampleWindow-u.totsamp:B,E<MAX_ORDER?(d=u.linpre+E,R=u.linprebuf,x=u.rinpre+E,C=u.rinprebuf,i>MAX_ORDER-E&&(i=MAX_ORDER-E)):(d=k+E,R=y,x=H+E,C=r),M(R,d,u.lstepbuf,u.lstep+u.totsamp,i,m[u.reqindex]),M(C,x,u.rstepbuf,u.rstep+u.totsamp,i,m[u.reqindex]),T(u.lstepbuf,u.lstep+u.totsamp,u.loutbuf,u.lout+u.totsamp,i,n[u.reqindex]),T(u.rstepbuf,u.rstep+u.totsamp,u.routbuf,u.rout+u.totsamp,i,n[u.reqindex]),d=u.lout+u.totsamp,R=u.loutbuf,x=u.rout+u.totsamp,C=u.routbuf;for(var p=i%8;p--!=0;)u.lsum+=g(R[d++]),u.rsum+=g(C[x++]);for(p=i/8;p--!=0;)u.lsum+=g(R[d+0])+g(R[d+1])+g(R[d+2])+g(R[d+3])+g(R[d+4])+g(R[d+5])+g(R[d+6])+g(R[d+7]),d+=8,u.rsum+=g(C[x+0])+g(C[x+1])+g(C[x+2])+g(C[x+3])+g(C[x+4])+g(C[x+5])+g(C[x+6])+g(C[x+7]),x+=8;if(B-=i,E+=i,u.totsamp+=i,u.totsamp==u.sampleWindow){var h=st.STEPS_per_dB*10*Math.log10((u.lsum+u.rsum)/u.totsamp*.5+1e-37),b=h<=0?0:0|h;b>=u.A.length&&(b=u.A.length-1),u.A[b]++,u.lsum=u.rsum=0,Bt.arraycopy(u.loutbuf,u.totsamp,u.loutbuf,0,MAX_ORDER),Bt.arraycopy(u.routbuf,u.totsamp,u.routbuf,0,MAX_ORDER),Bt.arraycopy(u.lstepbuf,u.totsamp,u.lstepbuf,0,MAX_ORDER),Bt.arraycopy(u.rstepbuf,u.totsamp,u.rstepbuf,0,MAX_ORDER),u.totsamp=0}if(u.totsamp>u.sampleWindow)return GAIN_ANALYSIS_ERROR}return j<MAX_ORDER?(Bt.arraycopy(u.linprebuf,j,u.linprebuf,0,MAX_ORDER-j),Bt.arraycopy(u.rinprebuf,j,u.rinprebuf,0,MAX_ORDER-j),Bt.arraycopy(y,k,u.linprebuf,MAX_ORDER-j,j),Bt.arraycopy(r,H,u.rinprebuf,MAX_ORDER-j,j)):(Bt.arraycopy(y,k+j-MAX_ORDER,u.linprebuf,0,MAX_ORDER),Bt.arraycopy(r,H+j-MAX_ORDER,u.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function N(u,y){var k,r=0;for(k=0;k<y;k++)r+=u[k];if(r==0)return GAIN_NOT_ENOUGH_SAMPLES;var H=0|Math.ceil(r*(1-t));for(k=y;k-- >0&&!((H-=u[k])<=0););return e-k/st.STEPS_per_dB}this.GetTitleGain=function(u){for(var y=N(u.A,u.A.length),k=0;k<u.A.length;k++)u.B[k]+=u.A[k],u.A[k]=0;for(var k=0;k<MAX_ORDER;k++)u.linprebuf[k]=u.lstepbuf[k]=u.loutbuf[k]=u.rinprebuf[k]=u.rstepbuf[k]=u.routbuf[k]=0;return u.totsamp=0,u.lsum=u.rsum=0,y}}var Xi=st,Yi=Ze,os=Yi.new_float,Gi=Yi.new_int,Ct=Xi;function g2(){this.linprebuf=os(Ct.MAX_ORDER*2),this.linpre=0,this.lstepbuf=os(Ct.MAX_SAMPLES_PER_WINDOW+Ct.MAX_ORDER),this.lstep=0,this.loutbuf=os(Ct.MAX_SAMPLES_PER_WINDOW+Ct.MAX_ORDER),this.lout=0,this.rinprebuf=os(Ct.MAX_ORDER*2),this.rinpre=0,this.rstepbuf=os(Ct.MAX_SAMPLES_PER_WINDOW+Ct.MAX_ORDER),this.rstep=0,this.routbuf=os(Ct.MAX_SAMPLES_PER_WINDOW+Ct.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=Gi(0|Ct.STEPS_per_dB*Ct.MAX_dB),this.B=Gi(0|Ct.STEPS_per_dB*Ct.MAX_dB)}var p2=g2;function b2(e){this.bits=e}var Ki=b2,Rn=Ze,Zi=Rn.new_float,y2=Rn.new_int,Wi=Rn.assert,S2=Ki,Qi=Rt,E2=Mr,k2=xr;function M2(e){var t=e;this.quantize=t,this.iteration_loop=function(a,o,m,n){var M=a.internal_flags,T=Zi(E2.SFBMAX),O=Zi(576),g=y2(2),N=0,u,y=M.l3_side,k=new S2(N);this.quantize.rv.ResvFrameBegin(a,k),N=k.bits;for(var r=0;r<M.mode_gr;r++){u=this.quantize.qupvt.on_pe(a,o,g,N,r,r),M.mode_ext==Qi.MPG_MD_MS_LR&&(this.quantize.ms_convert(M.l3_side,r),this.quantize.qupvt.reduce_side(g,m[r],N,u));for(var H=0;H<M.channels_out;H++){var j,V,d=y.tt[r][H];d.block_type!=Qi.SHORT_TYPE?(j=0,V=M.PSY.mask_adjust-j):(j=0,V=M.PSY.mask_adjust_short-j),M.masking_lower=Math.pow(10,V*.1),this.quantize.init_outer_loop(M,d),this.quantize.init_xrpow(M,d,O)&&(this.quantize.qupvt.calc_xmin(a,n[r][H],d,T),this.quantize.outer_loop(a,d,T,O,H,g[H])),this.quantize.iteration_finish_one(M,r,H),Wi(d.part2_3_length<=k2.MAX_BITS_PER_CHANNEL),Wi(d.part2_3_length<=g[H])}}this.quantize.rv.ResvFrameEnd(M,N)}}var w2=M2;function Ie(e,t,a,o){this.xlen=e,this.linmax=t,this.table=a,this.hlen=o}var ie={};ie.t1HB=[1,1,1,0],ie.t2HB=[1,2,1,3,1,1,3,2,0],ie.t3HB=[3,2,1,1,1,1,3,2,0],ie.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],ie.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],ie.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],ie.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],ie.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],ie.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],ie.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],ie.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],ie.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],ie.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],ie.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],ie.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],ie.t32HB=[1<<0,5<<1,4<<1,5<<2,6<<1,5<<2,4<<2,4<<3,7<<1,3<<2,6<<2,0<<3,7<<2,2<<3,3<<3,1<<4],ie.t33HB=[15<<0,14<<1,13<<1,12<<2,11<<1,10<<2,9<<2,8<<3,7<<1,6<<2,5<<2,4<<3,3<<2,2<<3,1<<3,0<<4],ie.t1l=[1,4,3,5],ie.t2l=[1,4,7,4,5,7,6,7,8],ie.t3l=[2,3,7,4,4,7,6,7,8],ie.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],ie.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],ie.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],ie.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],ie.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],ie.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],ie.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],ie.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],ie.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],ie.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],ie.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],ie.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],ie.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],ie.t32l=[1+0,4+1,4+1,5+2,4+1,6+2,5+2,6+3,4+1,5+2,5+2,6+3,5+2,6+3,6+3,6+4],ie.t33l=[4+0,4+1,4+1,4+2,4+1,4+2,4+2,4+3,4+1,4+2,4+2,4+3,4+2,4+3,4+3,4+4],ie.ht=[new Ie(0,0,null,null),new Ie(2,0,ie.t1HB,ie.t1l),new Ie(3,0,ie.t2HB,ie.t2l),new Ie(3,0,ie.t3HB,ie.t3l),new Ie(0,0,null,null),new Ie(4,0,ie.t5HB,ie.t5l),new Ie(4,0,ie.t6HB,ie.t6l),new Ie(6,0,ie.t7HB,ie.t7l),new Ie(6,0,ie.t8HB,ie.t8l),new Ie(6,0,ie.t9HB,ie.t9l),new Ie(8,0,ie.t10HB,ie.t10l),new Ie(8,0,ie.t11HB,ie.t11l),new Ie(8,0,ie.t12HB,ie.t12l),new Ie(16,0,ie.t13HB,ie.t13l),new Ie(0,0,null,ie.t16_5l),new Ie(16,0,ie.t15HB,ie.t15l),new Ie(1,1,ie.t16HB,ie.t16l),new Ie(2,3,ie.t16HB,ie.t16l),new Ie(3,7,ie.t16HB,ie.t16l),new Ie(4,15,ie.t16HB,ie.t16l),new Ie(6,63,ie.t16HB,ie.t16l),new Ie(8,255,ie.t16HB,ie.t16l),new Ie(10,1023,ie.t16HB,ie.t16l),new Ie(13,8191,ie.t16HB,ie.t16l),new Ie(4,15,ie.t24HB,ie.t24l),new Ie(5,31,ie.t24HB,ie.t24l),new Ie(6,63,ie.t24HB,ie.t24l),new Ie(7,127,ie.t24HB,ie.t24l),new Ie(8,255,ie.t24HB,ie.t24l),new Ie(9,511,ie.t24HB,ie.t24l),new Ie(11,2047,ie.t24HB,ie.t24l),new Ie(13,8191,ie.t24HB,ie.t24l),new Ie(0,0,ie.t32HB,ie.t32l),new Ie(0,0,ie.t33HB,ie.t33l)],ie.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],ie.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],ie.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],ie.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],ie.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],ie.scfsi_band=[0,6,11,16,21];var An=ie,ua=Fi,is=Ze,Ha=is.VbrMode,Br=is.Float,Tn=is.Util,Pa=is.new_float,R2=is.new_int,Fs=is.assert,ut=Rt,A2=Ki,Ht=xr;fa.Q_MAX=256+1,fa.Q_MAX2=116,fa.LARGE_BITS=1e5,fa.IXMAX_VAL=8206;function fa(){var e=null,t=null,a=null;this.setModules=function(d,R,x){e=d,t=R,a=x};function o(d){return u[d+fa.Q_MAX2]}this.IPOW20=function(d){return y[d]};var m=2220446049250313e-31,n=fa.IXMAX_VAL,M=n+2,T=fa.Q_MAX,O=fa.Q_MAX2,g=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var N=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=N,this.sfBandIndex=[new ua([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new ua([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new ua([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new ua([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new ua([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new ua([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new ua([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new ua([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new ua([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var u=Pa(T+O+1),y=Pa(T),k=Pa(M),r=Pa(M);this.adj43=r;function H(d,R){var x=a.ATHformula(R,d);return x-=g,x=Math.pow(10,x/10+d.ATHlower),x}function j(d){for(var R=d.internal_flags.ATH.l,x=d.internal_flags.ATH.psfb21,C=d.internal_flags.ATH.s,B=d.internal_flags.ATH.psfb12,i=d.internal_flags,E=d.out_samplerate,p=0;p<ut.SBMAX_l;p++){var h=i.scalefac_band.l[p],b=i.scalefac_band.l[p+1];R[p]=Br.MAX_VALUE;for(var S=h;S<b;S++){var c=S*E/1152,_=H(d,c);R[p]=Math.min(R[p],_)}}for(var p=0;p<ut.PSFB21;p++){var h=i.scalefac_band.psfb21[p],b=i.scalefac_band.psfb21[p+1];x[p]=Br.MAX_VALUE;for(var S=h;S<b;S++){var c=S*E/1152,_=H(d,c);x[p]=Math.min(x[p],_)}}for(var p=0;p<ut.SBMAX_s;p++){var h=i.scalefac_band.s[p],b=i.scalefac_band.s[p+1];C[p]=Br.MAX_VALUE;for(var S=h;S<b;S++){var c=S*E/384,_=H(d,c);C[p]=Math.min(C[p],_)}C[p]*=i.scalefac_band.s[p+1]-i.scalefac_band.s[p]}for(var p=0;p<ut.PSFB12;p++){var h=i.scalefac_band.psfb12[p],b=i.scalefac_band.psfb12[p+1];B[p]=Br.MAX_VALUE;for(var S=h;S<b;S++){var c=S*E/384,_=H(d,c);B[p]=Math.min(B[p],_)}B[p]*=i.scalefac_band.s[13]-i.scalefac_band.s[12]}if(d.noATH){for(var p=0;p<ut.SBMAX_l;p++)R[p]=1e-20;for(var p=0;p<ut.PSFB21;p++)x[p]=1e-20;for(var p=0;p<ut.SBMAX_s;p++)C[p]=1e-20;for(var p=0;p<ut.PSFB12;p++)B[p]=1e-20}i.ATH.floor=10*Math.log10(H(d,-1))}this.iteration_init=function(d){var R=d.internal_flags,x=R.l3_side,C;if(R.iteration_init_init==0){for(R.iteration_init_init=1,x.main_data_begin=0,j(d),k[0]=0,C=1;C<M;C++)k[C]=Math.pow(C,4/3);for(C=0;C<M-1;C++)r[C]=C+1-Math.pow(.5*(k[C]+k[C+1]),.75);for(r[C]=.5,C=0;C<T;C++)y[C]=Math.pow(2,(C-210)*-.1875);for(C=0;C<=T+O;C++)u[C]=Math.pow(2,(C-210-O)*.25);e.huffman_init(R);{var B,i,E,p;for(C=d.exp_nspsytune>>2&63,C>=32&&(C-=64),B=Math.pow(10,C/4/10),C=d.exp_nspsytune>>8&63,C>=32&&(C-=64),i=Math.pow(10,C/4/10),C=d.exp_nspsytune>>14&63,C>=32&&(C-=64),E=Math.pow(10,C/4/10),C=d.exp_nspsytune>>20&63,C>=32&&(C-=64),p=E*Math.pow(10,C/4/10),C=0;C<ut.SBMAX_l;C++){var h;C<=6?h=B:C<=13?h=i:C<=20?h=E:h=p,R.nsPsy.longfact[C]=h}for(C=0;C<ut.SBMAX_s;C++){var h;C<=5?h=B:C<=10?h=i:C<=11?h=E:h=p,R.nsPsy.shortfact[C]=h}}}},this.on_pe=function(d,R,x,C,B,i){var E=d.internal_flags,p=0,h,b=R2(2),S,c=new A2(p),_=t.ResvMaxBits(d,C,c,i);p=c.bits;var f=p+_;for(f>Ht.MAX_BITS_PER_GRANULE&&(f=Ht.MAX_BITS_PER_GRANULE),h=0,S=0;S<E.channels_out;++S)x[S]=Math.min(Ht.MAX_BITS_PER_CHANNEL,p/E.channels_out),b[S]=0|x[S]*R[B][S]/700-x[S],b[S]>C*3/4&&(b[S]=C*3/4),b[S]<0&&(b[S]=0),b[S]+x[S]>Ht.MAX_BITS_PER_CHANNEL&&(b[S]=Math.max(0,Ht.MAX_BITS_PER_CHANNEL-x[S])),h+=b[S];if(h>_)for(S=0;S<E.channels_out;++S)b[S]=_*b[S]/h;for(S=0;S<E.channels_out;++S)x[S]+=b[S],_-=b[S];for(h=0,S=0;S<E.channels_out;++S)h+=x[S];if(h>Ht.MAX_BITS_PER_GRANULE){var L=0;for(S=0;S<E.channels_out;++S)x[S]*=Ht.MAX_BITS_PER_GRANULE,x[S]/=h,L+=x[S]}return f},this.reduce_side=function(d,R,x,C){Fs(d[0]+d[1]<=Ht.MAX_BITS_PER_GRANULE);var B=.33*(.5-R)/.5;B<0&&(B=0),B>.5&&(B=.5);var i=0|B*.5*(d[0]+d[1]);i>Ht.MAX_BITS_PER_CHANNEL-d[0]&&(i=Ht.MAX_BITS_PER_CHANNEL-d[0]),i<0&&(i=0),d[1]>=125&&(d[1]-i>125?(d[0]<x&&(d[0]+=i),d[1]-=i):(d[0]+=d[1]-125,d[1]=125)),i=d[0]+d[1],i>C&&(d[0]=C*d[0]/i,d[1]=C*d[1]/i),Fs(d[0]<=Ht.MAX_BITS_PER_CHANNEL),Fs(d[1]<=Ht.MAX_BITS_PER_CHANNEL),Fs(d[0]+d[1]<=Ht.MAX_BITS_PER_GRANULE)},this.athAdjust=function(d,R,x){var C=90.30873362,B=94.82444863,i=Tn.FAST_LOG10_X(R,10),E=d*d,p=0;return i-=x,E>1e-20&&(p=1+Tn.FAST_LOG10_X(E,10/C)),p<0&&(p=0),i*=p,i+=x+C-B,Math.pow(10,.1*i)},this.calc_xmin=function(d,R,x,C){var B=0,i=d.internal_flags,E,p=0,h=0,b=i.ATH,S=x.xr,c=d.VBR==Ha.vbr_mtrh?1:0,_=i.masking_lower;for((d.VBR==Ha.vbr_mtrh||d.VBR==Ha.vbr_mt)&&(_=1),E=0;E<x.psy_lmax;E++){var f,L,Y,F,U,l;d.VBR==Ha.vbr_rh||d.VBR==Ha.vbr_mtrh?L=athAdjust(b.adjust,b.l[E],b.floor):L=b.adjust*b.l[E],U=x.width[E],Y=L/U,F=m,l=U>>1,f=0;do{var v,Z;v=S[p]*S[p],f+=v,F+=v<Y?v:Y,p++,Z=S[p]*S[p],f+=Z,F+=Z<Y?Z:Y,p++}while(--l>0);if(f>L&&h++,E==ut.SBPSY_l){var W=L*i.nsPsy.longfact[E];F<W&&(F=W)}if(c!=0&&(L=F),!d.ATHonly){var se=R.en.l[E];if(se>0){var W;W=f*R.thm.l[E]*_/se,c!=0&&(W*=i.nsPsy.longfact[E]),L<W&&(L=W)}}c!=0?C[B++]=L:C[B++]=L*i.nsPsy.longfact[E]}var me=575;if(x.block_type!=ut.SHORT_TYPE)for(var ce=576;ce--!=0&&BitStream.EQ(S[ce],0);)me=ce;x.max_nonzero_coeff=me;for(var he=x.sfb_smin;E<x.psymax;he++,E+=3){var U,ke,ve;for(d.VBR==Ha.vbr_rh||d.VBR==Ha.vbr_mtrh?ve=athAdjust(b.adjust,b.s[he],b.floor):ve=b.adjust*b.s[he],U=x.width[E],ke=0;ke<3;ke++){var f=0,L,Y,F,l=U>>1;Y=ve/U,F=m;do{var v,Z;v=S[p]*S[p],f+=v,F+=v<Y?v:Y,p++,Z=S[p]*S[p],f+=Z,F+=Z<Y?Z:Y,p++}while(--l>0);if(f>ve&&h++,he==ut.SBPSY_s){var W=ve*i.nsPsy.shortfact[he];F<W&&(F=W)}if(c!=0?L=F:L=ve,!d.ATHonly&&!d.ATHshort){var se=R.en.s[he][ke];if(se>0){var W;W=f*R.thm.s[he][ke]*_/se,c!=0&&(W*=i.nsPsy.shortfact[he]),L<W&&(L=W)}}c!=0?C[B++]=L:C[B++]=L*i.nsPsy.shortfact[he]}d.useTemporal&&(C[B-3]>C[B-3+1]&&(C[B-3+1]+=(C[B-3]-C[B-3+1])*i.decay),C[B-3+1]>C[B-3+2]&&(C[B-3+2]+=(C[B-3+1]-C[B-3+2])*i.decay))}return h};function V(d){this.s=d}this.calc_noise_core=function(d,R,x,C){var B=0,i=R.s,E=d.l3_enc;if(i>d.count1)for(;x--!=0;){var p;p=d.xr[i],i++,B+=p*p,p=d.xr[i],i++,B+=p*p}else if(i>d.big_values){var h=Pa(2);for(h[0]=0,h[1]=C;x--!=0;){var p;p=Math.abs(d.xr[i])-h[E[i]],i++,B+=p*p,p=Math.abs(d.xr[i])-h[E[i]],i++,B+=p*p}}else for(;x--!=0;){var p;p=Math.abs(d.xr[i])-k[E[i]]*C,i++,B+=p*p,p=Math.abs(d.xr[i])-k[E[i]]*C,i++,B+=p*p}return R.s=i,B},this.calc_noise=function(d,R,x,C,B){var i=0,E=0,p,h,b=0,S=0,c=0,_=-20,f=0,L=d.scalefac,Y=0;for(C.over_SSD=0,p=0;p<d.psymax;p++){var F=d.global_gain-(L[Y++]+(d.preflag!=0?N[p]:0)<<d.scalefac_scale+1)-d.subblock_gain[d.window[p]]*8,U=0;if(B!=null&&B.step[p]==F)U=B.noise[p],f+=d.width[p],x[i++]=U/R[E++],U=B.noise_log[p];else{var l=o(F);if(h=d.width[p]>>1,f+d.width[p]>d.max_nonzero_coeff){var v;v=d.max_nonzero_coeff-f+1,v>0?h=v>>1:h=0}var Z=new V(f);U=this.calc_noise_core(d,Z,h,l),f=Z.s,B!=null&&(B.step[p]=F,B.noise[p]=U),U=x[i++]=U/R[E++],U=Tn.FAST_LOG10(Math.max(U,1e-20)),B!=null&&(B.noise_log[p]=U)}if(B!=null&&(B.global_gain=d.global_gain),c+=U,U>0){var W;W=Math.max(0|U*10+.5,1),C.over_SSD+=W*W,b++,S+=U}_=Math.max(_,U)}return C.over_count=b,C.tot_noise=c,C.over_noise=S,C.max_noise=_,b},this.set_pinfo=function(d,R,x,C,B){var i=d.internal_flags,E,p,h,b,S,c=R.scalefac_scale==0?.5:1,_=R.scalefac,f=Pa(L3Side.SFBMAX),L=Pa(L3Side.SFBMAX),Y=new CalcNoiseResult;calc_xmin(d,x,R,f),calc_noise(R,f,L,Y,null);var F=0;for(p=R.sfb_lmax,R.block_type!=ut.SHORT_TYPE&&R.mixed_block_flag==0&&(p=22),E=0;E<p;E++){var U=i.scalefac_band.l[E],l=i.scalefac_band.l[E+1],v=l-U;for(b=0;F<l;F++)b+=R.xr[F]*R.xr[F];b/=v,S=1e15,i.pinfo.en[C][B][E]=S*b,i.pinfo.xfsf[C][B][E]=S*f[E]*L[E]/v,x.en.l[E]>0&&!d.ATHonly?b=b/x.en.l[E]:b=0,i.pinfo.thr[C][B][E]=S*Math.max(b*x.thm.l[E],i.ATH.l[E]),i.pinfo.LAMEsfb[C][B][E]=0,R.preflag!=0&&E>=11&&(i.pinfo.LAMEsfb[C][B][E]=-c*N[E]),E<ut.SBPSY_l&&(Fs(_[E]>=0),i.pinfo.LAMEsfb[C][B][E]-=c*_[E])}if(R.block_type==ut.SHORT_TYPE)for(p=E,E=R.sfb_smin;E<ut.SBMAX_s;E++)for(var U=i.scalefac_band.s[E],l=i.scalefac_band.s[E+1],v=l-U,Z=0;Z<3;Z++){for(b=0,h=U;h<l;h++)b+=R.xr[F]*R.xr[F],F++;b=Math.max(b/v,1e-20),S=1e15,i.pinfo.en_s[C][B][3*E+Z]=S*b,i.pinfo.xfsf_s[C][B][3*E+Z]=S*f[p]*L[p]/v,x.en.s[E][Z]>0?b=b/x.en.s[E][Z]:b=0,(d.ATHonly||d.ATHshort)&&(b=0),i.pinfo.thr_s[C][B][3*E+Z]=S*Math.max(b*x.thm.s[E][Z],i.ATH.s[E]),i.pinfo.LAMEsfb_s[C][B][3*E+Z]=-2*R.subblock_gain[Z],E<ut.SBPSY_s&&(i.pinfo.LAMEsfb_s[C][B][3*E+Z]-=c*_[p]),p++}i.pinfo.LAMEqss[C][B]=R.global_gain,i.pinfo.LAMEmainbits[C][B]=R.part2_3_length+R.part2_length,i.pinfo.LAMEsfbits[C][B]=R.part2_length,i.pinfo.over[C][B]=Y.over_count,i.pinfo.max_noise[C][B]=Y.max_noise*10,i.pinfo.over_noise[C][B]=Y.over_noise*10,i.pinfo.tot_noise[C][B]=Y.tot_noise*10,i.pinfo.over_SSD[C][B]=Y.over_SSD}}var $i=fa,Cr=Ze,T2=Cr.System,x2=Cr.Arrays,Ds=Cr.new_int,xn=Cr.assert,rt=Rt,et=An,B2=kn,Fa=$i;function Bn(){var e=null;this.qupvt=null,this.setModules=function(h){this.qupvt=h,e=h};function t(h){this.bits=0|h}var a=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function o(h,b,S,c,_,f){var L=.5946/b;for(h=h>>1;h--!=0;)_[f++]=L>S[c++]?0:1,_[f++]=L>S[c++]?0:1}function m(h,b,S,c,_,f){h=h>>1;var L=h%2;for(h=h>>1;h--!=0;){var Y,F,U,l,v,Z,W,se;Y=S[c++]*b,F=S[c++]*b,v=0|Y,U=S[c++]*b,Z=0|F,l=S[c++]*b,W=0|U,Y+=e.adj43[v],se=0|l,F+=e.adj43[Z],_[f++]=0|Y,U+=e.adj43[W],_[f++]=0|F,l+=e.adj43[se],_[f++]=0|U,_[f++]=0|l}if(L!=0){var Y,F,v,Z;Y=S[c++]*b,F=S[c++]*b,v=0|Y,Z=0|F,Y+=e.adj43[v],F+=e.adj43[Z],_[f++]=0|Y,_[f++]=0|F}}function n(h,b,S,c,_){var f,L,Y=0,F,U=0,l=0,v=0,Z=b,W=0,se=Z,me=0,ce=h,he=0;for(F=_!=null&&c.global_gain==_.global_gain,c.block_type==rt.SHORT_TYPE?L=38:L=21,f=0;f<=L;f++){var ke=-1;if((F||c.block_type==rt.NORM_TYPE)&&(ke=c.global_gain-(c.scalefac[f]+(c.preflag!=0?e.pretab[f]:0)<<c.scalefac_scale+1)-c.subblock_gain[c.window[f]]*8),xn(c.width[f]>=0),F&&_.step[f]==ke)U!=0&&(m(U,S,ce,he,se,me),U=0),l!=0&&(o(l,S,ce,he,se,me),l=0);else{var ve=c.width[f];if(Y+c.width[f]>c.max_nonzero_coeff){var de;de=c.max_nonzero_coeff-Y+1,x2.fill(b,c.max_nonzero_coeff,576,0),ve=de,ve<0&&(ve=0),f=L+1}if(U==0&&l==0&&(se=Z,me=W,ce=h,he=v),_!=null&&_.sfb_count1>0&&f>=_.sfb_count1&&_.step[f]>0&&ke>=_.step[f]?(U!=0&&(m(U,S,ce,he,se,me),U=0,se=Z,me=W,ce=h,he=v),l+=ve):(l!=0&&(o(l,S,ce,he,se,me),l=0,se=Z,me=W,ce=h,he=v),U+=ve),ve<=0){l!=0&&(o(l,S,ce,he,se,me),l=0),U!=0&&(m(U,S,ce,he,se,me),U=0);break}}f<=L&&(W+=c.width[f],v+=c.width[f],Y+=c.width[f])}U!=0&&(m(U,S,ce,he,se,me),U=0),l!=0&&(o(l,S,ce,he,se,me),l=0)}function M(h,b,S){var c=0,_=0;do{var f=h[b++],L=h[b++];c<f&&(c=f),_<L&&(_=L)}while(b<S);return c<_&&(c=_),c}function T(h,b,S,c,_,f){var L=et.ht[c].xlen*65536+et.ht[_].xlen,Y=0,F;do{var U=h[b++],l=h[b++];U!=0&&(U>14&&(U=15,Y+=L),U*=16),l!=0&&(l>14&&(l=15,Y+=L),U+=l),Y+=et.largetbl[U]}while(b<S);return F=Y&65535,Y>>=16,Y>F&&(Y=F,c=_),f.bits+=Y,c}function O(h,b,S,c){var _=0,f=et.ht[1].hlen;do{var L=h[b+0]*2+h[b+1];b+=2,_+=f[L]}while(b<S);return c.bits+=_,1}function g(h,b,S,c,_){var f=0,L,Y=et.ht[c].xlen,F;c==2?F=et.table23:F=et.table56;do{var U=h[b+0]*Y+h[b+1];b+=2,f+=F[U]}while(b<S);return L=f&65535,f>>=16,f>L&&(f=L,c++),_.bits+=f,c}function N(h,b,S,c,_){var f=0,L=0,Y=0,F=et.ht[c].xlen,U=et.ht[c].hlen,l=et.ht[c+1].hlen,v=et.ht[c+2].hlen;do{var Z=h[b+0]*F+h[b+1];b+=2,f+=U[Z],L+=l[Z],Y+=v[Z]}while(b<S);var W=c;return f>L&&(f=L,W++),f>Y&&(f=Y,W=c+2),_.bits+=f,W}var u=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function y(h,b,S,c){var _=M(h,b,S);switch(_){case 0:return _;case 1:return O(h,b,S,c);case 2:case 3:return g(h,b,S,u[_-1],c);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return N(h,b,S,u[_-1],c);default:if(_>Fa.IXMAX_VAL)return c.bits=Fa.LARGE_BITS,-1;_-=15;var f;for(f=24;f<32&&!(et.ht[f].linmax>=_);f++);var L;for(L=f-8;L<24&&!(et.ht[L].linmax>=_);L++);return T(h,b,S,L,f,c)}}this.noquant_count_bits=function(h,b,S){var c=b.l3_enc,_=Math.min(576,b.max_nonzero_coeff+2>>1<<1);for(S!=null&&(S.sfb_count1=0);_>1&&(c[_-1]|c[_-2])==0;_-=2);b.count1=_;for(var f=0,L=0;_>3;_-=4){var Y;if(((c[_-1]|c[_-2]|c[_-3]|c[_-4])&2147483647)>1)break;Y=((c[_-4]*2+c[_-3])*2+c[_-2])*2+c[_-1],f+=et.t32l[Y],L+=et.t33l[Y]}var F=f;if(b.count1table_select=0,f>L&&(F=L,b.count1table_select=1),b.count1bits=F,b.big_values=_,_==0)return F;if(b.block_type==rt.SHORT_TYPE)f=3*h.scalefac_band.s[3],f>b.big_values&&(f=b.big_values),L=b.big_values;else if(b.block_type==rt.NORM_TYPE){if(f=b.region0_count=h.bv_scf[_-2],L=b.region1_count=h.bv_scf[_-1],L=h.scalefac_band.l[f+L+2],f=h.scalefac_band.l[f+1],L<_){var U=new t(F);b.table_select[2]=y(c,L,_,U),F=U.bits}}else b.region0_count=7,b.region1_count=rt.SBMAX_l-1-7-1,f=h.scalefac_band.l[7+1],L=_,f>L&&(f=L);if(f=Math.min(f,_),L=Math.min(L,_),0<f){var U=new t(F);b.table_select[0]=y(c,0,f,U),F=U.bits}if(f<L){var U=new t(F);b.table_select[1]=y(c,f,L,U),F=U.bits}if(h.use_best_huffman==2&&(b.part2_3_length=F,best_huffman_divide(h,b),F=b.part2_3_length),S!=null&&b.block_type==rt.NORM_TYPE){for(var l=0;h.scalefac_band.l[l]<b.big_values;)l++;S.sfb_count1=l}return F},this.count_bits=function(h,b,S,c){var _=S.l3_enc,f=Fa.IXMAX_VAL/e.IPOW20(S.global_gain);if(S.xrpow_max>f)return Fa.LARGE_BITS;if(n(b,_,e.IPOW20(S.global_gain),S,c),(h.substep_shaping&2)!=0)for(var L=0,Y=S.global_gain+S.scalefac_scale,F=.634521682242439/e.IPOW20(Y),U=0;U<S.sfbmax;U++){var l=S.width[U];if(h.pseudohalf[U]==0)L+=l;else{var v;for(v=L,L+=l;v<L;++v)_[v]=b[v]>=F?_[v]:0}}return this.noquant_count_bits(h,S,c)};function k(h,b,S,c,_,f,L){for(var Y=b.big_values,F=0;F<=7+15;F++)c[F]=Fa.LARGE_BITS;for(var F=0;F<16;F++){var U=h.scalefac_band.l[F+1];if(U>=Y)break;var l=0,v=new t(l),Z=y(S,0,U,v);l=v.bits;for(var W=0;W<8;W++){var se=h.scalefac_band.l[F+W+2];if(se>=Y)break;var me=l;v=new t(me);var ce=y(S,U,se,v);me=v.bits,c[F+W]>me&&(c[F+W]=me,_[F+W]=F,f[F+W]=Z,L[F+W]=ce)}}}function r(h,b,S,c,_,f,L,Y){for(var F=b.big_values,U=2;U<rt.SBMAX_l+1;U++){var l=h.scalefac_band.l[U];if(l>=F)break;var v=_[U-2]+b.count1bits;if(S.part2_3_length<=v)break;var Z=new t(v),W=y(c,l,F,Z);v=Z.bits,!(S.part2_3_length<=v)&&(S.assign(b),S.part2_3_length=v,S.region0_count=f[U-2],S.region1_count=U-2-f[U-2],S.table_select[0]=L[U-2],S.table_select[1]=Y[U-2],S.table_select[2]=W)}}this.best_huffman_divide=function(h,b){var S=new B2,c=b.l3_enc,_=Ds(7+15+1),f=Ds(7+15+1),L=Ds(7+15+1),Y=Ds(7+15+1);if(!(b.block_type==rt.SHORT_TYPE&&h.mode_gr==1)){S.assign(b),b.block_type==rt.NORM_TYPE&&(k(h,b,c,_,f,L,Y),r(h,S,b,c,_,f,L,Y));var F=S.big_values;if(!(F==0||(c[F-2]|c[F-1])>1)&&(F=b.count1+2,!(F>576))){S.assign(b),S.count1=F;for(var U=0,l=0;F>S.big_values;F-=4){var v=((c[F-4]*2+c[F-3])*2+c[F-2])*2+c[F-1];U+=et.t32l[v],l+=et.t33l[v]}if(S.big_values=F,S.count1table_select=0,U>l&&(U=l,S.count1table_select=1),S.count1bits=U,S.block_type==rt.NORM_TYPE)r(h,S,b,c,_,f,L,Y);else{if(S.part2_3_length=U,U=h.scalefac_band.l[7+1],U>F&&(U=F),U>0){var Z=new t(S.part2_3_length);S.table_select[0]=y(c,0,U,Z),S.part2_3_length=Z.bits}if(F>U){var Z=new t(S.part2_3_length);S.table_select[1]=y(c,U,F,Z),S.part2_3_length=Z.bits}b.part2_3_length>S.part2_3_length&&b.assign(S)}}}};var H=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],j=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],V=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],d=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];Bn.slen1_tab=V,Bn.slen2_tab=d;function R(h,b){for(var S,c=b.tt[1][h],_=b.tt[0][h],f=0;f<et.scfsi_band.length-1;f++){for(S=et.scfsi_band[f];S<et.scfsi_band[f+1]&&!(_.scalefac[S]!=c.scalefac[S]&&c.scalefac[S]>=0);S++);if(S==et.scfsi_band[f+1]){for(S=et.scfsi_band[f];S<et.scfsi_band[f+1];S++)c.scalefac[S]=-1;b.scfsi[h][f]=1}}var L=0,Y=0;for(S=0;S<11;S++)c.scalefac[S]!=-1&&(Y++,L<c.scalefac[S]&&(L=c.scalefac[S]));for(var F=0,U=0;S<rt.SBPSY_l;S++)c.scalefac[S]!=-1&&(U++,F<c.scalefac[S]&&(F=c.scalefac[S]));for(var f=0;f<16;f++)if(L<H[f]&&F<j[f]){var l=V[f]*Y+d[f]*U;c.part2_length>l&&(c.part2_length=l,c.scalefac_compress=f)}}this.best_scalefac_store=function(h,b,S,c){var _=c.tt[b][S],f,L,Y,F,U=0;for(Y=0,f=0;f<_.sfbmax;f++){var l=_.width[f];for(Y+=l,F=-l;F<0&&_.l3_enc[F+Y]==0;F++);F==0&&(_.scalefac[f]=U=-2)}if(_.scalefac_scale==0&&_.preflag==0){var v=0;for(f=0;f<_.sfbmax;f++)_.scalefac[f]>0&&(v|=_.scalefac[f]);if((v&1)==0&&v!=0){for(f=0;f<_.sfbmax;f++)_.scalefac[f]>0&&(_.scalefac[f]>>=1);_.scalefac_scale=U=1}}if(_.preflag==0&&_.block_type!=rt.SHORT_TYPE&&h.mode_gr==2){for(f=11;f<rt.SBPSY_l&&!(_.scalefac[f]<e.pretab[f]&&_.scalefac[f]!=-2);f++);if(f==rt.SBPSY_l){for(f=11;f<rt.SBPSY_l;f++)_.scalefac[f]>0&&(_.scalefac[f]-=e.pretab[f]);_.preflag=U=1}}for(L=0;L<4;L++)c.scfsi[S][L]=0;for(h.mode_gr==2&&b==1&&c.tt[0][S].block_type!=rt.SHORT_TYPE&&c.tt[1][S].block_type!=rt.SHORT_TYPE&&(R(S,c),U=0),f=0;f<_.sfbmax;f++)_.scalefac[f]==-2&&(_.scalefac[f]=0);U!=0&&(h.mode_gr==2?this.scale_bitcount(_):this.scale_bitcount_lsf(h,_))};function x(h,b){for(var S=0;S<b;++S)if(h[S]<0)return!1;return!0}var C=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],B=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],i=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(h){var b,S,c=0,_=0,f,L=h.scalefac;if(xn(x(L,h.sfbmax)),h.block_type==rt.SHORT_TYPE)f=C,h.mixed_block_flag!=0&&(f=B);else if(f=i,h.preflag==0){for(S=11;S<rt.SBPSY_l&&!(L[S]<e.pretab[S]);S++);if(S==rt.SBPSY_l)for(h.preflag=1,S=11;S<rt.SBPSY_l;S++)L[S]-=e.pretab[S]}for(S=0;S<h.sfbdivide;S++)c<L[S]&&(c=L[S]);for(;S<h.sfbmax;S++)_<L[S]&&(_=L[S]);for(h.part2_length=Fa.LARGE_BITS,b=0;b<16;b++)c<H[b]&&_<j[b]&&h.part2_length>f[b]&&(h.part2_length=f[b],h.scalefac_compress=b);return h.part2_length==Fa.LARGE_BITS};var E=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(h,b){var S,c,_,f,L,Y,F,U,l=Ds(4),v=b.scalefac;for(b.preflag!=0?S=2:S=0,F=0;F<4;F++)l[F]=0;if(b.block_type==rt.SHORT_TYPE){c=1;var Z=e.nr_of_sfb_block[S][c];for(U=0,_=0;_<4;_++)for(f=Z[_]/3,F=0;F<f;F++,U++)for(L=0;L<3;L++)v[U*3+L]>l[_]&&(l[_]=v[U*3+L])}else{c=0;var Z=e.nr_of_sfb_block[S][c];for(U=0,_=0;_<4;_++)for(f=Z[_],F=0;F<f;F++,U++)v[U]>l[_]&&(l[_]=v[U])}for(Y=!1,_=0;_<4;_++)l[_]>E[S][_]&&(Y=!0);if(!Y){var W,se,me,ce;for(b.sfb_partition_table=e.nr_of_sfb_block[S][c],_=0;_<4;_++)b.slen[_]=p[l[_]];switch(W=b.slen[0],se=b.slen[1],me=b.slen[2],ce=b.slen[3],S){case 0:b.scalefac_compress=(W*5+se<<4)+(me<<2)+ce;break;case 1:b.scalefac_compress=400+(W*5+se<<2)+me;break;case 2:b.scalefac_compress=500+W*3+se;break;default:T2.err.printf(`intensity stereo not implemented yet
`);break}}if(!Y)for(xn(b.sfb_partition_table!=null),b.part2_length=0,_=0;_<4;_++)b.part2_length+=b.slen[_]*b.sfb_partition_table[_];return Y};var p=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(h){for(var b=2;b<=576;b+=2){for(var S=0,c;h.scalefac_band.l[++S]<b;);for(c=a[S][0];h.scalefac_band.l[c+1]>b;)c--;for(c<0&&(c=a[S][0]),h.bv_scf[b-2]=c,c=a[S][1];h.scalefac_band.l[c+h.bv_scf[b-2]+2]>b;)c--;c<0&&(c=a[S][1]),h.bv_scf[b-1]=c}}}var Ji=Bn,ls=Ze,ra=ls.System,C2=ls.Arrays,O2=ls.new_byte,L2=ls.new_float_n,N2=ls.new_int,nt=ls.assert,e0=Ji,Cn=An,Or=Rt,Da=xr;Lr.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=Math.abs(e)*1e-6:Math.abs(e-t)<=Math.abs(t)*1e-6},Lr.NEQ=function(e,t){return!Lr.EQ(e,t)};function Lr(){var e=this,t=32773,a=null,o=null,m=null,n=null;this.setModules=function(E,p,h,b){a=E,o=p,m=h,n=b};var M=null,T=0,O=0,g=0;this.getframebits=function(E){var p=E.internal_flags,h;p.bitrate_index!=0?h=Cn.bitrate_table[E.version][p.bitrate_index]:h=E.brate;var b=0|(E.version+1)*72e3*h/E.out_samplerate+p.padding;return 8*b};function N(E){ra.arraycopy(E.header[E.w_ptr].buf,0,M,O,E.sideinfo_len),O+=E.sideinfo_len,T+=E.sideinfo_len*8,E.w_ptr=E.w_ptr+1&Da.MAX_HEADER_BUF-1}function u(E,p,h){for(;h>0;){var b;g==0&&(g=8,O++,nt(O<Lame.LAME_MAXMP3BUFFER),nt(E.header[E.w_ptr].write_timing>=T),E.header[E.w_ptr].write_timing==T&&N(E),M[O]=0),b=Math.min(h,g),h-=b,g-=b,M[O]|=p>>h<<g,T+=b}}function y(E,p,h){for(;h>0;){var b;g==0&&(g=8,O++,nt(O<Lame.LAME_MAXMP3BUFFER),M[O]=0),b=Math.min(h,g),h-=b,g-=b,M[O]|=p>>h<<g,T+=b}}function k(E,p){var h=E.internal_flags,b;if(p>=8&&(u(h,76,8),p-=8),p>=8&&(u(h,65,8),p-=8),p>=8&&(u(h,77,8),p-=8),p>=8&&(u(h,69,8),p-=8),p>=32){var S=m.getLameShortVersion();if(p>=32)for(b=0;b<S.length&&p>=8;++b)p-=8,u(h,S.charAt(b),8)}for(;p>=1;p-=1)u(h,h.ancillary_flag,1),h.ancillary_flag^=E.disable_reservoir?0:1}function r(E,p,h){for(var b=E.header[E.h_ptr].ptr;h>0;){var S=Math.min(h,8-(b&7));h-=S,E.header[E.h_ptr].buf[b>>3]|=p>>h<<8-(b&7)-S,b+=S}E.header[E.h_ptr].ptr=b}function H(E,p){E<<=8;for(var h=0;h<8;h++)E<<=1,p<<=1,((p^E)&65536)!=0&&(p^=t);return p}this.CRC_writeheader=function(E,p){var h=65535;h=H(p[2]&255,h),h=H(p[3]&255,h);for(var b=6;b<E.sideinfo_len;b++)h=H(p[b]&255,h);p[4]=byte(h>>8),p[5]=byte(h&255)};function j(E,p){var h=E.internal_flags,b,S,c;if(b=h.l3_side,h.header[h.h_ptr].ptr=0,C2.fill(h.header[h.h_ptr].buf,0,h.sideinfo_len,0),E.out_samplerate<16e3?r(h,4094,12):r(h,4095,12),r(h,E.version,1),r(h,4-3,2),r(h,E.error_protection?0:1,1),r(h,h.bitrate_index,4),r(h,h.samplerate_index,2),r(h,h.padding,1),r(h,E.extension,1),r(h,E.mode.ordinal(),2),r(h,h.mode_ext,2),r(h,E.copyright,1),r(h,E.original,1),r(h,E.emphasis,2),E.error_protection&&r(h,0,16),E.version==1){for(nt(b.main_data_begin>=0),r(h,b.main_data_begin,9),h.channels_out==2?r(h,b.private_bits,3):r(h,b.private_bits,5),c=0;c<h.channels_out;c++){var _;for(_=0;_<4;_++)r(h,b.scfsi[c][_],1)}for(S=0;S<2;S++)for(c=0;c<h.channels_out;c++){var f=b.tt[S][c];r(h,f.part2_3_length+f.part2_length,12),r(h,f.big_values/2,9),r(h,f.global_gain,8),r(h,f.scalefac_compress,4),f.block_type!=Or.NORM_TYPE?(r(h,1,1),r(h,f.block_type,2),r(h,f.mixed_block_flag,1),f.table_select[0]==14&&(f.table_select[0]=16),r(h,f.table_select[0],5),f.table_select[1]==14&&(f.table_select[1]=16),r(h,f.table_select[1],5),r(h,f.subblock_gain[0],3),r(h,f.subblock_gain[1],3),r(h,f.subblock_gain[2],3)):(r(h,0,1),f.table_select[0]==14&&(f.table_select[0]=16),r(h,f.table_select[0],5),f.table_select[1]==14&&(f.table_select[1]=16),r(h,f.table_select[1],5),f.table_select[2]==14&&(f.table_select[2]=16),r(h,f.table_select[2],5),nt(0<=f.region0_count&&f.region0_count<16),nt(0<=f.region1_count&&f.region1_count<8),r(h,f.region0_count,4),r(h,f.region1_count,3)),r(h,f.preflag,1),r(h,f.scalefac_scale,1),r(h,f.count1table_select,1)}}else for(nt(b.main_data_begin>=0),r(h,b.main_data_begin,8),r(h,b.private_bits,h.channels_out),S=0,c=0;c<h.channels_out;c++){var f=b.tt[S][c];r(h,f.part2_3_length+f.part2_length,12),r(h,f.big_values/2,9),r(h,f.global_gain,8),r(h,f.scalefac_compress,9),f.block_type!=Or.NORM_TYPE?(r(h,1,1),r(h,f.block_type,2),r(h,f.mixed_block_flag,1),f.table_select[0]==14&&(f.table_select[0]=16),r(h,f.table_select[0],5),f.table_select[1]==14&&(f.table_select[1]=16),r(h,f.table_select[1],5),r(h,f.subblock_gain[0],3),r(h,f.subblock_gain[1],3),r(h,f.subblock_gain[2],3)):(r(h,0,1),f.table_select[0]==14&&(f.table_select[0]=16),r(h,f.table_select[0],5),f.table_select[1]==14&&(f.table_select[1]=16),r(h,f.table_select[1],5),f.table_select[2]==14&&(f.table_select[2]=16),r(h,f.table_select[2],5),nt(0<=f.region0_count&&f.region0_count<16),nt(0<=f.region1_count&&f.region1_count<8),r(h,f.region0_count,4),r(h,f.region1_count,3)),r(h,f.scalefac_scale,1),r(h,f.count1table_select,1)}E.error_protection&&CRC_writeheader(h,h.header[h.h_ptr].buf);{var L=h.h_ptr;nt(h.header[L].ptr==h.sideinfo_len*8),h.h_ptr=L+1&Da.MAX_HEADER_BUF-1,h.header[h.h_ptr].write_timing=h.header[L].write_timing+p,h.h_ptr==h.w_ptr&&ra.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function V(E,p){var h=Cn.ht[p.count1table_select+32],b,S=0,c=p.big_values,_=p.big_values;for(nt(p.count1table_select<2),b=(p.count1-p.big_values)/4;b>0;--b){var f=0,L=0,Y;Y=p.l3_enc[c+0],Y!=0&&(L+=8,p.xr[_+0]<0&&f++),Y=p.l3_enc[c+1],Y!=0&&(L+=4,f*=2,p.xr[_+1]<0&&f++),Y=p.l3_enc[c+2],Y!=0&&(L+=2,f*=2,p.xr[_+2]<0&&f++),Y=p.l3_enc[c+3],Y!=0&&(L++,f*=2,p.xr[_+3]<0&&f++),c+=4,_+=4,u(E,f+h.table[L],h.hlen[L]),S+=h.hlen[L]}return S}function d(E,p,h,b,S){var c=Cn.ht[p],_=0;if(p==0)return _;for(var f=h;f<b;f+=2){var L=0,Y=0,F=c.xlen,U=c.xlen,l=0,v=S.l3_enc[f],Z=S.l3_enc[f+1];if(v!=0&&(S.xr[f]<0&&l++,L--),p>15){if(v>14){var W=v-15;nt(W<=c.linmax),l|=W<<1,Y=F,v=15}if(Z>14){var se=Z-15;nt(se<=c.linmax),l<<=F,l|=se,Y+=F,Z=15}U=16}Z!=0&&(l<<=1,S.xr[f+1]<0&&l++,L--),v=v*U+Z,Y-=L,L+=c.hlen[v],u(E,c.table[v],L),u(E,l,Y),_+=L+Y}return _}function R(E,p){var h=3*E.scalefac_band.s[3];h>p.big_values&&(h=p.big_values);var b=d(E,p.table_select[0],0,h,p);return b+=d(E,p.table_select[1],h,p.big_values,p),b}function x(E,p){var h,b,S,c;h=p.big_values;var _=p.region0_count+1;return nt(_<E.scalefac_band.l.length),S=E.scalefac_band.l[_],_+=p.region1_count+1,nt(_<E.scalefac_band.l.length),c=E.scalefac_band.l[_],S>h&&(S=h),c>h&&(c=h),b=d(E,p.table_select[0],0,S,p),b+=d(E,p.table_select[1],S,c,p),b+=d(E,p.table_select[2],c,h,p),b}function C(E){var p,h,b,S,c=0,_=E.internal_flags,f=_.l3_side;if(E.version==1)for(p=0;p<2;p++)for(h=0;h<_.channels_out;h++){var L=f.tt[p][h],Y=e0.slen1_tab[L.scalefac_compress],F=e0.slen2_tab[L.scalefac_compress];for(S=0,b=0;b<L.sfbdivide;b++)L.scalefac[b]!=-1&&(u(_,L.scalefac[b],Y),S+=Y);for(;b<L.sfbmax;b++)L.scalefac[b]!=-1&&(u(_,L.scalefac[b],F),S+=F);nt(S==L.part2_length),L.block_type==Or.SHORT_TYPE?S+=R(_,L):S+=x(_,L),S+=V(_,L),nt(S==L.part2_3_length+L.part2_length),c+=S}else for(p=0,h=0;h<_.channels_out;h++){var L=f.tt[p][h],U,l,v=0;if(nt(L.sfb_partition_table!=null),S=0,b=0,l=0,L.block_type==Or.SHORT_TYPE){for(;l<4;l++){var Z=L.sfb_partition_table[l]/3,W=L.slen[l];for(U=0;U<Z;U++,b++)u(_,Math.max(L.scalefac[b*3+0],0),W),u(_,Math.max(L.scalefac[b*3+1],0),W),u(_,Math.max(L.scalefac[b*3+2],0),W),v+=3*W}S+=R(_,L)}else{for(;l<4;l++){var Z=L.sfb_partition_table[l],W=L.slen[l];for(U=0;U<Z;U++,b++)u(_,Math.max(L.scalefac[b],0),W),v+=W}S+=x(_,L)}S+=V(_,L),nt(S==L.part2_3_length),nt(v==L.part2_length),c+=v+S}return c}function B(){this.total=0}function i(E,p){var h=E.internal_flags,b,S,c,_,f;return f=h.w_ptr,_=h.h_ptr-1,_==-1&&(_=Da.MAX_HEADER_BUF-1),b=h.header[_].write_timing-T,p.total=b,b>=0&&(S=1+_-f,_<f&&(S=1+_-f+Da.MAX_HEADER_BUF),b-=S*8*h.sideinfo_len),c=e.getframebits(E),b+=c,p.total+=c,p.total%8!=0?p.total=1+p.total/8:p.total=p.total/8,p.total+=O+1,b<0&&ra.err.println(`strange error flushing buffer ... 
`),b}this.flush_bitstream=function(E){var p=E.internal_flags,h,b,S=p.h_ptr-1;if(S==-1&&(S=Da.MAX_HEADER_BUF-1),h=p.l3_side,!((b=i(E,new B))<0)){if(k(E,b),nt(p.header[S].write_timing+this.getframebits(E)==T),p.ResvSize=0,h.main_data_begin=0,p.findReplayGain){var c=a.GetTitleGain(p.rgdata);nt(NEQ(c,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),p.RadioGain=Math.floor(c*10+.5)|0}p.findPeakSample&&(p.noclipGainChange=Math.ceil(Math.log10(p.PeakSample/32767)*20*10)|0,p.noclipGainChange>0&&(EQ(E.scale,1)||EQ(E.scale,0))?p.noclipScale=Math.floor(32767/p.PeakSample*100)/100:p.noclipScale=-1)}},this.add_dummy_byte=function(E,p,h){for(var b=E.internal_flags,S;h-- >0;)for(y(b,p,8),S=0;S<Da.MAX_HEADER_BUF;++S)b.header[S].write_timing+=8},this.format_bitstream=function(E){var p=E.internal_flags,h;h=p.l3_side;var b=this.getframebits(E);k(E,h.resvDrain_pre),j(E,b);var S=8*p.sideinfo_len;if(S+=C(E),k(E,h.resvDrain_post),S+=h.resvDrain_post,h.main_data_begin+=(b-S)/8,i(E,new B)!=p.ResvSize&&ra.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),h.main_data_begin*8!=p.ResvSize&&(ra.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*h.main_data_begin,p.ResvSize,h.resvDrain_post,h.resvDrain_pre,8*p.sideinfo_len,S-h.resvDrain_post-8*p.sideinfo_len,S,S%8,b),ra.err.println("This is a fatal error.  It has several possible causes:"),ra.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),ra.err.println(" 9%%  Your system is overclocked"),ra.err.println(" 1%%  bug in LAME encoding library"),p.ResvSize=h.main_data_begin*8),T>1e9){var c;for(c=0;c<Da.MAX_HEADER_BUF;++c)p.header[c].write_timing-=T;T=0}return 0},this.copy_buffer=function(E,p,h,b,S){var c=O+1;if(c<=0)return 0;if(b!=0&&c>b)return-1;if(ra.arraycopy(M,0,p,h,c),O=-1,g=0,S!=0){var _=N2(1);if(_[0]=E.nMusicCRC,n.updateMusicCRC(_,p,h,c),E.nMusicCRC=_[0],c>0&&(E.VBR_seek_table.nBytesWritten+=c),E.decode_on_the_fly){for(var f=L2([2,1152]),L=c,Y=-1,F;Y!=0;)if(Y=o.hip_decode1_unclipped(E.hip,p,h,L,f[0],f[1]),L=0,Y==-1&&(Y=0),Y>0){if(E.findPeakSample){for(F=0;F<Y;F++)f[0][F]>E.PeakSample?E.PeakSample=f[0][F]:-f[0][F]>E.PeakSample&&(E.PeakSample=-f[0][F]);if(E.channels_out>1)for(F=0;F<Y;F++)f[1][F]>E.PeakSample?E.PeakSample=f[1][F]:-f[1][F]>E.PeakSample&&(E.PeakSample=-f[1][F])}if(E.findReplayGain&&a.AnalyzeSamples(E.rgdata,f[0],0,f[1],0,Y,E.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return c},this.init_bit_stream_w=function(E){M=O2(Lame.LAME_MAXMP3BUFFER),E.h_ptr=E.w_ptr=0,E.header[E.h_ptr].write_timing=0,O=-1,g=0,T=0}}var t0=Lr,Ua=Ze,I2=Ua.System,Ye=Ua.VbrMode,On=Ua.ShortBlock,qa=Ua.new_float,a0=Ua.new_int_n,V2=Ua.new_short_n,Sa=Ua.assert,Ln=qm,j2=Ym,Nr=xr,H2=v2,P2=p2,F2=w2,za=t0,na=An,ot=Rt,va=Sn;function mt(){var e=this,t=128*1024;mt.V9=410,mt.V8=420,mt.V7=430,mt.V6=440,mt.V5=450,mt.V4=460,mt.V3=470,mt.V2=480,mt.V1=490,mt.V0=500,mt.R3MIX=1e3,mt.STANDARD=1001,mt.EXTREME=1002,mt.INSANE=1003,mt.STANDARD_FAST=1004,mt.EXTREME_FAST=1005,mt.MEDIUM=1006,mt.MEDIUM_FAST=1007;var a=16384+t;mt.LAME_MAXMP3BUFFER=a;var o,m,n,M,T,O=new Ln,g,N,u;this.enc=new ot,this.setModules=function(l,v,Z,W,se,me,ce,he,ke){o=l,m=v,n=Z,M=W,T=se,g=me,N=he,u=ke,this.enc.setModules(m,O,M,g)};function y(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=qa(ot.SBMAX_l),this.bo_s_weight=qa(ot.SBMAX_s)}function k(){this.lowerlimit=0}function r(l,v){this.lowpass=v}var H=4294479419;function j(l){var v;return l.class_id=H,v=l.internal_flags=new Nr,l.mode=va.NOT_SET,l.original=1,l.in_samplerate=44100,l.num_channels=2,l.num_samples=-1,l.bWriteVbrTag=!0,l.quality=-1,l.short_blocks=null,v.subblock_gain=-1,l.lowpassfreq=0,l.highpassfreq=0,l.lowpasswidth=-1,l.highpasswidth=-1,l.VBR=Ye.vbr_off,l.VBR_q=4,l.ATHcurve=-1,l.VBR_mean_bitrate_kbps=128,l.VBR_min_bitrate_kbps=0,l.VBR_max_bitrate_kbps=0,l.VBR_hard_min=0,v.VBR_min_bitrate=1,v.VBR_max_bitrate=13,l.quant_comp=-1,l.quant_comp_short=-1,l.msfix=-1,v.resample_ratio=1,v.OldValue[0]=180,v.OldValue[1]=180,v.CurrentStep[0]=4,v.CurrentStep[1]=4,v.masking_lower=1,v.nsPsy.attackthre=-1,v.nsPsy.attackthre_s=-1,l.scale=-1,l.athaa_type=-1,l.ATHtype=-1,l.athaa_loudapprox=-1,l.athaa_sensitivity=0,l.useTemporal=null,l.interChRatio=-1,v.mf_samples_to_encode=ot.ENCDELAY+ot.POSTDELAY,l.encoder_padding=0,v.mf_size=ot.ENCDELAY-ot.MDCTDELAY,l.findReplayGain=!1,l.decode_on_the_fly=!1,v.decode_on_the_fly=!1,v.findReplayGain=!1,v.findPeakSample=!1,v.RadioGain=0,v.AudiophileGain=0,v.noclipGainChange=0,v.noclipScale=-1,l.preset=0,l.write_id3tag_automatic=!0,0}this.lame_init=function(){var l=new j2;return j(l),l.lame_allocated_gfp=1,l};function V(l){return l>1?0:l<=0?1:Math.cos(Math.PI/2*l)}this.nearestBitrateFullIndex=function(l){var v=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],Z=0,W=0,se=0,me=0;me=v[16],se=16,W=v[16],Z=16;for(var ce=0;ce<16;ce++)if(Math.max(l,v[ce+1])!=l){me=v[ce+1],se=ce+1,W=v[ce],Z=ce;break}return me-l>l-W?Z:se};function d(l,v){var Z=44100;return v>=48e3?Z=48e3:v>=44100?Z=44100:v>=32e3?Z=32e3:v>=24e3?Z=24e3:v>=22050?Z=22050:v>=16e3?Z=16e3:v>=12e3?Z=12e3:v>=11025?Z=11025:v>=8e3&&(Z=8e3),l==-1?Z:(l<=15960&&(Z=44100),l<=15250&&(Z=32e3),l<=11220&&(Z=24e3),l<=9970&&(Z=22050),l<=7230&&(Z=16e3),l<=5420&&(Z=12e3),l<=4510&&(Z=11025),l<=3970&&(Z=8e3),v<Z?v>44100?48e3:v>32e3?44100:v>24e3?32e3:v>22050?24e3:v>16e3?22050:v>12e3?16e3:v>11025?12e3:v>8e3?11025:8e3:Z)}function R(l,v){switch(l){case 44100:return v.version=1,0;case 48e3:return v.version=1,1;case 32e3:return v.version=1,2;case 22050:return v.version=0,0;case 24e3:return v.version=0,1;case 16e3:return v.version=0,2;case 11025:return v.version=0,0;case 12e3:return v.version=0,1;case 8e3:return v.version=0,2;default:return v.version=0,-1}}function x(l,v,Z){Z<16e3&&(v=2);for(var W=na.bitrate_table[v][1],se=2;se<=14;se++)na.bitrate_table[v][se]>0&&Math.abs(na.bitrate_table[v][se]-l)<Math.abs(W-l)&&(W=na.bitrate_table[v][se]);return W}function C(l,v,Z){Z<16e3&&(v=2);for(var W=0;W<=14;W++)if(na.bitrate_table[v][W]>0&&na.bitrate_table[v][W]==l)return W;return-1}function B(l,v){var Z=[new r(8,2e3),new r(16,3700),new r(24,3900),new r(32,5500),new r(40,7e3),new r(48,7500),new r(56,1e4),new r(64,11e3),new r(80,13500),new r(96,15100),new r(112,15600),new r(128,17e3),new r(160,17500),new r(192,18600),new r(224,19400),new r(256,19700),new r(320,20500)],W=e.nearestBitrateFullIndex(v);l.lowerlimit=Z[W].lowpass}function i(l){var v=l.internal_flags,Z=32,W=-1;if(v.lowpass1>0){for(var se=999,me=0;me<=31;me++){var ce=me/31;ce>=v.lowpass2&&(Z=Math.min(Z,me)),v.lowpass1<ce&&ce<v.lowpass2&&(se=Math.min(se,me))}se==999?v.lowpass1=(Z-.75)/31:v.lowpass1=(se-.75)/31,v.lowpass2=Z/31}if(v.highpass2>0&&v.highpass2<.9*(.75/31)&&(v.highpass1=0,v.highpass2=0,I2.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),v.highpass2>0){for(var he=-1,me=0;me<=31;me++){var ce=me/31;ce<=v.highpass1&&(W=Math.max(W,me)),v.highpass1<ce&&ce<v.highpass2&&(he=Math.max(he,me))}v.highpass1=W/31,he==-1?v.highpass2=(W+.75)/31:v.highpass2=(he+.75)/31}for(var me=0;me<32;me++){var ke,ve,ce=me/31;v.highpass2>v.highpass1?ke=V((v.highpass2-ce)/(v.highpass2-v.highpass1+1e-20)):ke=1,v.lowpass2>v.lowpass1?ve=V((ce-v.lowpass1)/(v.lowpass2-v.lowpass1+1e-20)):ve=1,v.amp_filter[me]=ke*ve}}function E(l){var v=l.internal_flags;switch(l.quality){default:case 9:v.psymodel=0,v.noise_shaping=0,v.noise_shaping_amp=0,v.noise_shaping_stop=0,v.use_best_huffman=0,v.full_outer_loop=0;break;case 8:l.quality=7;case 7:v.psymodel=1,v.noise_shaping=0,v.noise_shaping_amp=0,v.noise_shaping_stop=0,v.use_best_huffman=0,v.full_outer_loop=0;break;case 6:v.psymodel=1,v.noise_shaping==0&&(v.noise_shaping=1),v.noise_shaping_amp=0,v.noise_shaping_stop=0,v.subblock_gain==-1&&(v.subblock_gain=1),v.use_best_huffman=0,v.full_outer_loop=0;break;case 5:v.psymodel=1,v.noise_shaping==0&&(v.noise_shaping=1),v.noise_shaping_amp=0,v.noise_shaping_stop=0,v.subblock_gain==-1&&(v.subblock_gain=1),v.use_best_huffman=0,v.full_outer_loop=0;break;case 4:v.psymodel=1,v.noise_shaping==0&&(v.noise_shaping=1),v.noise_shaping_amp=0,v.noise_shaping_stop=0,v.subblock_gain==-1&&(v.subblock_gain=1),v.use_best_huffman=1,v.full_outer_loop=0;break;case 3:v.psymodel=1,v.noise_shaping==0&&(v.noise_shaping=1),v.noise_shaping_amp=1,v.noise_shaping_stop=1,v.subblock_gain==-1&&(v.subblock_gain=1),v.use_best_huffman=1,v.full_outer_loop=0;break;case 2:v.psymodel=1,v.noise_shaping==0&&(v.noise_shaping=1),v.substep_shaping==0&&(v.substep_shaping=2),v.noise_shaping_amp=1,v.noise_shaping_stop=1,v.subblock_gain==-1&&(v.subblock_gain=1),v.use_best_huffman=1,v.full_outer_loop=0;break;case 1:v.psymodel=1,v.noise_shaping==0&&(v.noise_shaping=1),v.substep_shaping==0&&(v.substep_shaping=2),v.noise_shaping_amp=2,v.noise_shaping_stop=1,v.subblock_gain==-1&&(v.subblock_gain=1),v.use_best_huffman=1,v.full_outer_loop=0;break;case 0:v.psymodel=1,v.noise_shaping==0&&(v.noise_shaping=1),v.substep_shaping==0&&(v.substep_shaping=2),v.noise_shaping_amp=2,v.noise_shaping_stop=1,v.subblock_gain==-1&&(v.subblock_gain=1),v.use_best_huffman=1,v.full_outer_loop=0;break}}function p(l){var v=l.internal_flags;l.frameNum=0,l.write_id3tag_automatic&&N.id3tag_write_v2(l),v.bitrate_stereoMode_Hist=a0([16,4+1]),v.bitrate_blockType_Hist=a0([16,4+1+1]),v.PeakSample=0,l.bWriteVbrTag&&g.InitVbrTag(l)}this.lame_init_params=function(l){var v=l.internal_flags;if(v.Class_ID=0,v.ATH==null&&(v.ATH=new H2),v.PSY==null&&(v.PSY=new y),v.rgdata==null&&(v.rgdata=new P2),v.channels_in=l.num_channels,v.channels_in==1&&(l.mode=va.MONO),v.channels_out=l.mode==va.MONO?1:2,v.mode_ext=ot.MPG_MD_MS_LR,l.mode==va.MONO&&(l.force_ms=!1),l.VBR==Ye.vbr_off&&l.VBR_mean_bitrate_kbps!=128&&l.brate==0&&(l.brate=l.VBR_mean_bitrate_kbps),l.VBR==Ye.vbr_off||l.VBR==Ye.vbr_mtrh||l.VBR==Ye.vbr_mt||(l.free_format=!1),l.VBR==Ye.vbr_off&&l.brate==0&&za.EQ(l.compression_ratio,0)&&(l.compression_ratio=11.025),l.VBR==Ye.vbr_off&&l.compression_ratio>0&&(l.out_samplerate==0&&(l.out_samplerate=map2MP3Frequency(int(.97*l.in_samplerate))),l.brate=0|l.out_samplerate*16*v.channels_out/(1e3*l.compression_ratio),v.samplerate_index=R(l.out_samplerate,l),l.free_format||(l.brate=x(l.brate,l.version,l.out_samplerate))),l.out_samplerate!=0&&(l.out_samplerate<16e3?(l.VBR_mean_bitrate_kbps=Math.max(l.VBR_mean_bitrate_kbps,8),l.VBR_mean_bitrate_kbps=Math.min(l.VBR_mean_bitrate_kbps,64)):l.out_samplerate<32e3?(l.VBR_mean_bitrate_kbps=Math.max(l.VBR_mean_bitrate_kbps,8),l.VBR_mean_bitrate_kbps=Math.min(l.VBR_mean_bitrate_kbps,160)):(l.VBR_mean_bitrate_kbps=Math.max(l.VBR_mean_bitrate_kbps,32),l.VBR_mean_bitrate_kbps=Math.min(l.VBR_mean_bitrate_kbps,320))),l.lowpassfreq==0){var Z=16e3;switch(l.VBR){case Ye.vbr_off:{var W=new k;B(W,l.brate),Z=W.lowerlimit;break}case Ye.vbr_abr:{var W=new k;B(W,l.VBR_mean_bitrate_kbps),Z=W.lowerlimit;break}case Ye.vbr_rh:{var se=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=l.VBR_q&&l.VBR_q<=9){var me=se[l.VBR_q],ce=se[l.VBR_q+1],he=l.VBR_q_frac;Z=linear_int(me,ce,he)}else Z=19500;break}default:{var se=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=l.VBR_q&&l.VBR_q<=9){var me=se[l.VBR_q],ce=se[l.VBR_q+1],he=l.VBR_q_frac;Z=linear_int(me,ce,he)}else Z=19500}}l.mode==va.MONO&&(l.VBR==Ye.vbr_off||l.VBR==Ye.vbr_abr)&&(Z*=1.5),l.lowpassfreq=Z|0}if(l.out_samplerate==0&&(2*l.lowpassfreq>l.in_samplerate&&(l.lowpassfreq=l.in_samplerate/2),l.out_samplerate=d(l.lowpassfreq|0,l.in_samplerate)),l.lowpassfreq=Math.min(20500,l.lowpassfreq),l.lowpassfreq=Math.min(l.out_samplerate/2,l.lowpassfreq),l.VBR==Ye.vbr_off&&(l.compression_ratio=l.out_samplerate*16*v.channels_out/(1e3*l.brate)),l.VBR==Ye.vbr_abr&&(l.compression_ratio=l.out_samplerate*16*v.channels_out/(1e3*l.VBR_mean_bitrate_kbps)),l.bWriteVbrTag||(l.findReplayGain=!1,l.decode_on_the_fly=!1,v.findPeakSample=!1),v.findReplayGain=l.findReplayGain,v.decode_on_the_fly=l.decode_on_the_fly,v.decode_on_the_fly&&(v.findPeakSample=!0),v.findReplayGain&&o.InitGainAnalysis(v.rgdata,l.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return l.internal_flags=null,-6;switch(v.decode_on_the_fly&&!l.decode_only&&(v.hip!=null&&u.hip_decode_exit(v.hip),v.hip=u.hip_decode_init()),v.mode_gr=l.out_samplerate<=24e3?1:2,l.framesize=576*v.mode_gr,l.encoder_delay=ot.ENCDELAY,v.resample_ratio=l.in_samplerate/l.out_samplerate,l.VBR){case Ye.vbr_mt:case Ye.vbr_rh:case Ye.vbr_mtrh:{var ke=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];l.compression_ratio=ke[l.VBR_q]}break;case Ye.vbr_abr:l.compression_ratio=l.out_samplerate*16*v.channels_out/(1e3*l.VBR_mean_bitrate_kbps);break;default:l.compression_ratio=l.out_samplerate*16*v.channels_out/(1e3*l.brate);break}if(l.mode==va.NOT_SET&&(l.mode=va.JOINT_STEREO),l.highpassfreq>0?(v.highpass1=2*l.highpassfreq,l.highpasswidth>=0?v.highpass2=2*(l.highpassfreq+l.highpasswidth):v.highpass2=(1+0)*2*l.highpassfreq,v.highpass1/=l.out_samplerate,v.highpass2/=l.out_samplerate):(v.highpass1=0,v.highpass2=0),l.lowpassfreq>0?(v.lowpass2=2*l.lowpassfreq,l.lowpasswidth>=0?(v.lowpass1=2*(l.lowpassfreq-l.lowpasswidth),v.lowpass1<0&&(v.lowpass1=0)):v.lowpass1=(1-0)*2*l.lowpassfreq,v.lowpass1/=l.out_samplerate,v.lowpass2/=l.out_samplerate):(v.lowpass1=0,v.lowpass2=0),i(l),v.samplerate_index=R(l.out_samplerate,l),v.samplerate_index<0)return l.internal_flags=null,-1;if(l.VBR==Ye.vbr_off){if(l.free_format)v.bitrate_index=0;else if(l.brate=x(l.brate,l.version,l.out_samplerate),v.bitrate_index=C(l.brate,l.version,l.out_samplerate),v.bitrate_index<=0)return l.internal_flags=null,-1}else v.bitrate_index=1;l.analysis&&(l.bWriteVbrTag=!1),v.pinfo!=null&&(l.bWriteVbrTag=!1),m.init_bit_stream_w(v);for(var ve=v.samplerate_index+3*l.version+6*(l.out_samplerate<16e3?1:0),de=0;de<ot.SBMAX_l+1;de++)v.scalefac_band.l[de]=M.sfBandIndex[ve].l[de];for(var de=0;de<ot.PSFB21+1;de++){var Re=(v.scalefac_band.l[22]-v.scalefac_band.l[21])/ot.PSFB21,je=v.scalefac_band.l[21]+de*Re;v.scalefac_band.psfb21[de]=je}v.scalefac_band.psfb21[ot.PSFB21]=576;for(var de=0;de<ot.SBMAX_s+1;de++)v.scalefac_band.s[de]=M.sfBandIndex[ve].s[de];for(var de=0;de<ot.PSFB12+1;de++){var Re=(v.scalefac_band.s[13]-v.scalefac_band.s[12])/ot.PSFB12,je=v.scalefac_band.s[12]+de*Re;v.scalefac_band.psfb12[de]=je}v.scalefac_band.psfb12[ot.PSFB12]=192,l.version==1?v.sideinfo_len=v.channels_out==1?4+17:4+32:v.sideinfo_len=v.channels_out==1?4+9:4+17,l.error_protection&&(v.sideinfo_len+=2),p(l),v.Class_ID=H;{var Be;for(Be=0;Be<19;Be++)v.nsPsy.pefirbuf[Be]=700*v.mode_gr*v.channels_out;l.ATHtype==-1&&(l.ATHtype=4)}switch(Sa(l.VBR_q<=9),Sa(l.VBR_q>=0),l.VBR){case Ye.vbr_mt:l.VBR=Ye.vbr_mtrh;case Ye.vbr_mtrh:{l.useTemporal==null&&(l.useTemporal=!1),n.apply_preset(l,500-l.VBR_q*10,0),l.quality<0&&(l.quality=LAME_DEFAULT_QUALITY),l.quality<5&&(l.quality=0),l.quality>5&&(l.quality=5),v.PSY.mask_adjust=l.maskingadjust,v.PSY.mask_adjust_short=l.maskingadjust_short,l.experimentalY?v.sfb21_extra=!1:v.sfb21_extra=l.out_samplerate>44e3,v.iteration_loop=new VBRNewIterationLoop(T);break}case Ye.vbr_rh:{n.apply_preset(l,500-l.VBR_q*10,0),v.PSY.mask_adjust=l.maskingadjust,v.PSY.mask_adjust_short=l.maskingadjust_short,l.experimentalY?v.sfb21_extra=!1:v.sfb21_extra=l.out_samplerate>44e3,l.quality>6&&(l.quality=6),l.quality<0&&(l.quality=LAME_DEFAULT_QUALITY),v.iteration_loop=new VBROldIterationLoop(T);break}default:{var De;v.sfb21_extra=!1,l.quality<0&&(l.quality=LAME_DEFAULT_QUALITY),De=l.VBR,De==Ye.vbr_off&&(l.VBR_mean_bitrate_kbps=l.brate),n.apply_preset(l,l.VBR_mean_bitrate_kbps,0),l.VBR=De,v.PSY.mask_adjust=l.maskingadjust,v.PSY.mask_adjust_short=l.maskingadjust_short,De==Ye.vbr_off?v.iteration_loop=new F2(T):v.iteration_loop=new ABRIterationLoop(T);break}}if(Sa(l.scale>=0),l.VBR!=Ye.vbr_off){if(v.VBR_min_bitrate=1,v.VBR_max_bitrate=14,l.out_samplerate<16e3&&(v.VBR_max_bitrate=8),l.VBR_min_bitrate_kbps!=0&&(l.VBR_min_bitrate_kbps=x(l.VBR_min_bitrate_kbps,l.version,l.out_samplerate),v.VBR_min_bitrate=C(l.VBR_min_bitrate_kbps,l.version,l.out_samplerate),v.VBR_min_bitrate<0)||l.VBR_max_bitrate_kbps!=0&&(l.VBR_max_bitrate_kbps=x(l.VBR_max_bitrate_kbps,l.version,l.out_samplerate),v.VBR_max_bitrate=C(l.VBR_max_bitrate_kbps,l.version,l.out_samplerate),v.VBR_max_bitrate<0))return-1;l.VBR_min_bitrate_kbps=na.bitrate_table[l.version][v.VBR_min_bitrate],l.VBR_max_bitrate_kbps=na.bitrate_table[l.version][v.VBR_max_bitrate],l.VBR_mean_bitrate_kbps=Math.min(na.bitrate_table[l.version][v.VBR_max_bitrate],l.VBR_mean_bitrate_kbps),l.VBR_mean_bitrate_kbps=Math.max(na.bitrate_table[l.version][v.VBR_min_bitrate],l.VBR_mean_bitrate_kbps)}return l.tune&&(v.PSY.mask_adjust+=l.tune_value_a,v.PSY.mask_adjust_short+=l.tune_value_a),E(l),Sa(l.scale>=0),l.athaa_type<0?v.ATH.useAdjust=3:v.ATH.useAdjust=l.athaa_type,v.ATH.aaSensitivityP=Math.pow(10,l.athaa_sensitivity/-10),l.short_blocks==null&&(l.short_blocks=On.short_block_allowed),l.short_blocks==On.short_block_allowed&&(l.mode==va.JOINT_STEREO||l.mode==va.STEREO)&&(l.short_blocks=On.short_block_coupled),l.quant_comp<0&&(l.quant_comp=1),l.quant_comp_short<0&&(l.quant_comp_short=0),l.msfix<0&&(l.msfix=0),l.exp_nspsytune=l.exp_nspsytune|1,l.internal_flags.nsPsy.attackthre<0&&(l.internal_flags.nsPsy.attackthre=Ln.NSATTACKTHRE),l.internal_flags.nsPsy.attackthre_s<0&&(l.internal_flags.nsPsy.attackthre_s=Ln.NSATTACKTHRE_S),Sa(l.scale>=0),l.scale<0&&(l.scale=1),l.ATHtype<0&&(l.ATHtype=4),l.ATHcurve<0&&(l.ATHcurve=4),l.athaa_loudapprox<0&&(l.athaa_loudapprox=2),l.interChRatio<0&&(l.interChRatio=0),l.useTemporal==null&&(l.useTemporal=!0),v.slot_lag=v.frac_SpF=0,l.VBR==Ye.vbr_off&&(v.slot_lag=v.frac_SpF=(l.version+1)*72e3*l.brate%l.out_samplerate|0),M.iteration_init(l),O.psymodel_init(l),Sa(l.scale>=0),0};function h(l,v){(l.in_buffer_0==null||l.in_buffer_nsamples<v)&&(l.in_buffer_0=qa(v),l.in_buffer_1=qa(v),l.in_buffer_nsamples=v)}this.lame_encode_flush=function(l,v,Z,W){var se=l.internal_flags,me=V2([2,1152]),ce=0,he,ke,ve,de,Re=se.mf_samples_to_encode-ot.POSTDELAY,je=b(l);if(se.mf_samples_to_encode<1)return 0;for(he=0,l.in_samplerate!=l.out_samplerate&&(Re+=16*l.out_samplerate/l.in_samplerate),ve=l.framesize-Re%l.framesize,ve<576&&(ve+=l.framesize),l.encoder_padding=ve,de=(Re+ve)/l.framesize;de>0&&ce>=0;){var Be=je-se.mf_size,De=l.frameNum;Be*=l.in_samplerate,Be/=l.out_samplerate,Be>1152&&(Be=1152),Be<1&&(Be=1),ke=W-he,W==0&&(ke=0),ce=this.lame_encode_buffer(l,me[0],me[1],Be,v,Z,ke),Z+=ce,he+=ce,de-=De!=l.frameNum?1:0}if(se.mf_samples_to_encode=0,ce<0||(ke=W-he,W==0&&(ke=0),m.flush_bitstream(l),ce=m.copy_buffer(se,v,Z,ke,1),ce<0))return ce;if(Z+=ce,he+=ce,ke=W-he,W==0&&(ke=0),l.write_id3tag_automatic){if(N.id3tag_write_v1(l),ce=m.copy_buffer(se,v,Z,ke,0),ce<0)return ce;he+=ce}return he},this.lame_encode_buffer=function(l,v,Z,W,se,me,ce){var he=l.internal_flags,ke=[null,null];if(he.Class_ID!=H)return-3;if(W==0)return 0;h(he,W),ke[0]=he.in_buffer_0,ke[1]=he.in_buffer_1;for(var ve=0;ve<W;ve++)ke[0][ve]=v[ve],he.channels_in>1&&(ke[1][ve]=Z[ve]);return S(l,ke[0],ke[1],W,se,me,ce)};function b(l){var v=ot.BLKSIZE+l.framesize-ot.FFTOFFSET;return v=Math.max(v,512+l.framesize-32),v}function S(l,v,Z,W,se,me,ce){var he=l.internal_flags,ke=0,ve,de,Re,je,Be,De=[null,null],He=[null,null];if(he.Class_ID!=H)return-3;if(W==0)return 0;if(Be=m.copy_buffer(he,se,me,ce,0),Be<0)return Be;if(me+=Be,ke+=Be,He[0]=v,He[1]=Z,za.NEQ(l.scale,0)&&za.NEQ(l.scale,1))for(de=0;de<W;++de)He[0][de]*=l.scale,he.channels_out==2&&(He[1][de]*=l.scale);if(za.NEQ(l.scale_left,0)&&za.NEQ(l.scale_left,1))for(de=0;de<W;++de)He[0][de]*=l.scale_left;if(za.NEQ(l.scale_right,0)&&za.NEQ(l.scale_right,1))for(de=0;de<W;++de)He[1][de]*=l.scale_right;if(l.num_channels==2&&he.channels_out==1)for(de=0;de<W;++de)He[0][de]=.5*(He[0][de]+He[1][de]),He[1][de]=0;je=b(l),De[0]=he.mfbuf[0],De[1]=he.mfbuf[1];for(var Pe=0;W>0;){var Ge=[null,null],St=0,_t=0;Ge[0]=He[0],Ge[1]=He[1];var lt=new _;if(U(l,De,Ge,Pe,W,lt),St=lt.n_in,_t=lt.n_out,he.findReplayGain&&!he.decode_on_the_fly&&o.AnalyzeSamples(he.rgdata,De[0],he.mf_size,De[1],he.mf_size,_t,he.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(W-=St,Pe+=St,he.channels_out==2,he.mf_size+=_t,Sa(he.mf_size<=Nr.MFSIZE),he.mf_samples_to_encode<1&&(he.mf_samples_to_encode=ot.ENCDELAY+ot.POSTDELAY),he.mf_samples_to_encode+=_t,he.mf_size>=je){var Et=ce-ke;if(ce==0&&(Et=0),ve=c(l,De[0],De[1],se,me,Et),ve<0)return ve;for(me+=ve,ke+=ve,he.mf_size-=l.framesize,he.mf_samples_to_encode-=l.framesize,Re=0;Re<he.channels_out;Re++)for(de=0;de<he.mf_size;de++)De[Re][de]=De[Re][de+l.framesize]}}return ke}function c(l,v,Z,W,se,me){var ce=e.enc.lame_encode_mp3_frame(l,v,Z,W,se,me);return l.frameNum++,ce}function _(){this.n_in=0,this.n_out=0}function f(){this.num_used=0}function L(l,v){return v!=0?L(v,l%v):l}function Y(l,v,Z){var W=Math.PI*v;l/=Z,l<0&&(l=0),l>1&&(l=1);var se=l-.5,me=.42-.5*Math.cos(2*l*Math.PI)+.08*Math.cos(4*l*Math.PI);return Math.abs(se)<1e-9?W/Math.PI:me*Math.sin(Z*W*se)/(Math.PI*Z*se)}function F(l,v,Z,W,se,me,ce,he,ke){var ve=l.internal_flags,de,Re=0,je,Be=l.out_samplerate/L(l.out_samplerate,l.in_samplerate);Be>Nr.BPC&&(Be=Nr.BPC);var De=Math.abs(ve.resample_ratio-Math.floor(.5+ve.resample_ratio))<1e-4?1:0,He=1/ve.resample_ratio;He>1&&(He=1);var Pe=31;Pe%2==0&&--Pe,Pe+=De;var Ge=Pe+1;if(ve.fill_buffer_resample_init==0){for(ve.inbuf_old[0]=qa(Ge),ve.inbuf_old[1]=qa(Ge),de=0;de<=2*Be;++de)ve.blackfilt[de]=qa(Ge);for(ve.itime[0]=0,ve.itime[1]=0,Re=0;Re<=2*Be;Re++){var St=0,_t=(Re-Be)/(2*Be);for(de=0;de<=Pe;de++)St+=ve.blackfilt[Re][de]=Y(de-_t,He,Pe);for(de=0;de<=Pe;de++)ve.blackfilt[Re][de]/=St}ve.fill_buffer_resample_init=1}var lt=ve.inbuf_old[ke];for(je=0;je<W;je++){var Et,Ot;if(Et=je*ve.resample_ratio,Re=0|Math.floor(Et-ve.itime[ke]),Pe+Re-Pe/2>=ce)break;var _t=Et-ve.itime[ke]-(Re+.5*(Pe%2));Ot=0|Math.floor(_t*2*Be+Be+.5);var Pt=0;for(de=0;de<=Pe;++de){var ht=0|de+Re-Pe/2,Yt;Yt=ht<0?lt[Ge+ht]:se[me+ht],Pt+=Yt*ve.blackfilt[Ot][de]}v[Z+je]=Pt}if(he.num_used=Math.min(ce,Pe+Re-Pe/2),ve.itime[ke]+=he.num_used-je*ve.resample_ratio,he.num_used>=Ge)for(de=0;de<Ge;de++)lt[de]=se[me+he.num_used+de-Ge];else{var kt=Ge-he.num_used;for(de=0;de<kt;++de)lt[de]=lt[de+he.num_used];for(Re=0;de<Ge;++de,++Re)lt[de]=se[me+Re];Sa(Re==he.num_used)}return je}function U(l,v,Z,W,se,me){var ce=l.internal_flags;if(ce.resample_ratio<.9999||ce.resample_ratio>1.0001)for(var he=0;he<ce.channels_out;he++){var ke=new f;me.n_out=F(l,v[he],ce.mf_size,l.framesize,Z[he],W,se,ke,he),me.n_in=ke.num_used}else{me.n_out=Math.min(l.framesize,se),me.n_in=me.n_out;for(var ve=0;ve<me.n_out;++ve)v[0][ce.mf_size+ve]=Z[0][W+ve],ce.channels_out==2&&(v[1][ce.mf_size+ve]=Z[1][W+ve])}}}var D2=mt,U2=Ze,oa=U2.VbrMode;function q2(){function e(g,N,u,y,k,r,H,j,V,d,R,x,C,B,i){this.vbr_q=g,this.quant_comp=N,this.quant_comp_s=u,this.expY=y,this.st_lrm=k,this.st_s=r,this.masking_adj=H,this.masking_adj_short=j,this.ath_lower=V,this.ath_curve=d,this.ath_sensitivity=R,this.interch=x,this.safejoint=C,this.sfb21mod=B,this.msfix=i}function t(g,N,u,y,k,r,H,j,V,d,R,x,C,B){this.quant_comp=N,this.quant_comp_s=u,this.safejoint=y,this.nsmsfix=k,this.st_lrm=r,this.st_s=H,this.nsbass=j,this.scale=V,this.masking_adj=d,this.ath_lower=R,this.ath_curve=x,this.interch=C,this.sfscale=B}var a;this.setModules=function(g){a=g};var o=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],m=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function n(g,N,u){var y=g.VBR==oa.vbr_rh?o:m,k=g.VBR_q_frac,r=y[N],H=y[N+1],j=r;r.st_lrm=r.st_lrm+k*(H.st_lrm-r.st_lrm),r.st_s=r.st_s+k*(H.st_s-r.st_s),r.masking_adj=r.masking_adj+k*(H.masking_adj-r.masking_adj),r.masking_adj_short=r.masking_adj_short+k*(H.masking_adj_short-r.masking_adj_short),r.ath_lower=r.ath_lower+k*(H.ath_lower-r.ath_lower),r.ath_curve=r.ath_curve+k*(H.ath_curve-r.ath_curve),r.ath_sensitivity=r.ath_sensitivity+k*(H.ath_sensitivity-r.ath_sensitivity),r.interch=r.interch+k*(H.interch-r.interch),r.msfix=r.msfix+k*(H.msfix-r.msfix),O(g,j.vbr_q),u!=0?g.quant_comp=j.quant_comp:Math.abs(g.quant_comp- -1)>0||(g.quant_comp=j.quant_comp),u!=0?g.quant_comp_short=j.quant_comp_s:Math.abs(g.quant_comp_short- -1)>0||(g.quant_comp_short=j.quant_comp_s),j.expY!=0&&(g.experimentalY=j.expY!=0),u!=0?g.internal_flags.nsPsy.attackthre=j.st_lrm:Math.abs(g.internal_flags.nsPsy.attackthre- -1)>0||(g.internal_flags.nsPsy.attackthre=j.st_lrm),u!=0?g.internal_flags.nsPsy.attackthre_s=j.st_s:Math.abs(g.internal_flags.nsPsy.attackthre_s- -1)>0||(g.internal_flags.nsPsy.attackthre_s=j.st_s),u!=0?g.maskingadjust=j.masking_adj:Math.abs(g.maskingadjust-0)>0||(g.maskingadjust=j.masking_adj),u!=0?g.maskingadjust_short=j.masking_adj_short:Math.abs(g.maskingadjust_short-0)>0||(g.maskingadjust_short=j.masking_adj_short),u!=0?g.ATHlower=-j.ath_lower/10:Math.abs(-g.ATHlower*10-0)>0||(g.ATHlower=-j.ath_lower/10),u!=0?g.ATHcurve=j.ath_curve:Math.abs(g.ATHcurve- -1)>0||(g.ATHcurve=j.ath_curve),u!=0?g.athaa_sensitivity=j.ath_sensitivity:Math.abs(g.athaa_sensitivity- -1)>0||(g.athaa_sensitivity=j.ath_sensitivity),j.interch>0&&(u!=0?g.interChRatio=j.interch:Math.abs(g.interChRatio- -1)>0||(g.interChRatio=j.interch)),j.safejoint>0&&(g.exp_nspsytune=g.exp_nspsytune|j.safejoint),j.sfb21mod>0&&(g.exp_nspsytune=g.exp_nspsytune|j.sfb21mod<<20),u!=0?g.msfix=j.msfix:Math.abs(g.msfix- -1)>0||(g.msfix=j.msfix),u==0&&(g.VBR_q=N,g.VBR_q_frac=k)}var M=[new t(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new t(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new t(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new t(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new t(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new t(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new t(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new t(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new t(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new t(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new t(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new t(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new t(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new t(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new t(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function T(g,N,u){var y=N,k=a.nearestBitrateFullIndex(N);if(g.VBR=oa.vbr_abr,g.VBR_mean_bitrate_kbps=y,g.VBR_mean_bitrate_kbps=Math.min(g.VBR_mean_bitrate_kbps,320),g.VBR_mean_bitrate_kbps=Math.max(g.VBR_mean_bitrate_kbps,8),g.brate=g.VBR_mean_bitrate_kbps,g.VBR_mean_bitrate_kbps>320&&(g.disable_reservoir=!0),M[k].safejoint>0&&(g.exp_nspsytune=g.exp_nspsytune|2),M[k].sfscale>0&&(g.internal_flags.noise_shaping=2),Math.abs(M[k].nsbass)>0){var r=int(M[k].nsbass*4);r<0&&(r+=64),g.exp_nspsytune=g.exp_nspsytune|r<<2}return u!=0?g.quant_comp=M[k].quant_comp:Math.abs(g.quant_comp- -1)>0||(g.quant_comp=M[k].quant_comp),u!=0?g.quant_comp_short=M[k].quant_comp_s:Math.abs(g.quant_comp_short- -1)>0||(g.quant_comp_short=M[k].quant_comp_s),u!=0?g.msfix=M[k].nsmsfix:Math.abs(g.msfix- -1)>0||(g.msfix=M[k].nsmsfix),u!=0?g.internal_flags.nsPsy.attackthre=M[k].st_lrm:Math.abs(g.internal_flags.nsPsy.attackthre- -1)>0||(g.internal_flags.nsPsy.attackthre=M[k].st_lrm),u!=0?g.internal_flags.nsPsy.attackthre_s=M[k].st_s:Math.abs(g.internal_flags.nsPsy.attackthre_s- -1)>0||(g.internal_flags.nsPsy.attackthre_s=M[k].st_s),u!=0?g.scale=M[k].scale:Math.abs(g.scale- -1)>0||(g.scale=M[k].scale),u!=0?g.maskingadjust=M[k].masking_adj:Math.abs(g.maskingadjust-0)>0||(g.maskingadjust=M[k].masking_adj),M[k].masking_adj>0?u!=0?g.maskingadjust_short=M[k].masking_adj*.9:Math.abs(g.maskingadjust_short-0)>0||(g.maskingadjust_short=M[k].masking_adj*.9):u!=0?g.maskingadjust_short=M[k].masking_adj*1.1:Math.abs(g.maskingadjust_short-0)>0||(g.maskingadjust_short=M[k].masking_adj*1.1),u!=0?g.ATHlower=-M[k].ath_lower/10:Math.abs(-g.ATHlower*10-0)>0||(g.ATHlower=-M[k].ath_lower/10),u!=0?g.ATHcurve=M[k].ath_curve:Math.abs(g.ATHcurve- -1)>0||(g.ATHcurve=M[k].ath_curve),u!=0?g.interChRatio=M[k].interch:Math.abs(g.interChRatio- -1)>0||(g.interChRatio=M[k].interch),N}this.apply_preset=function(g,N,u){switch(N){case Lame.R3MIX:{N=Lame.V3,g.VBR=oa.vbr_mtrh;break}case Lame.MEDIUM:{N=Lame.V4,g.VBR=oa.vbr_rh;break}case Lame.MEDIUM_FAST:{N=Lame.V4,g.VBR=oa.vbr_mtrh;break}case Lame.STANDARD:{N=Lame.V2,g.VBR=oa.vbr_rh;break}case Lame.STANDARD_FAST:{N=Lame.V2,g.VBR=oa.vbr_mtrh;break}case Lame.EXTREME:{N=Lame.V0,g.VBR=oa.vbr_rh;break}case Lame.EXTREME_FAST:{N=Lame.V0,g.VBR=oa.vbr_mtrh;break}case Lame.INSANE:return N=320,g.preset=N,T(g,N,u),g.VBR=oa.vbr_off,N}switch(g.preset=N,N){case Lame.V9:return n(g,9,u),N;case Lame.V8:return n(g,8,u),N;case Lame.V7:return n(g,7,u),N;case Lame.V6:return n(g,6,u),N;case Lame.V5:return n(g,5,u),N;case Lame.V4:return n(g,4,u),N;case Lame.V3:return n(g,3,u),N;case Lame.V2:return n(g,2,u),N;case Lame.V1:return n(g,1,u),N;case Lame.V0:return n(g,0,u),N}return 8<=N&&N<=320?T(g,N,u):(g.preset=0,N)};function O(g,N){var u=0;return 0>N&&(u=-1,N=0),9<N&&(u=-1,N=9),g.VBR_q=N,g.VBR_q_frac=0,u}}var z2=q2;function X2(){this.setModules=function(e,t){}}var Y2=X2;function G2(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var K2=G2,s0=Ze,r0=s0.new_float,Z2=s0.new_int;function W2(){this.global_gain=0,this.sfb_count1=0,this.step=Z2(39),this.noise=r0(39),this.noise_log=r0(39)}var Q2=W2,cs=Ze,Ea=cs.System,n0=cs.VbrMode,Nn=cs.Util,ds=cs.Arrays,Us=cs.new_float,qs=cs.assert,$2=Y2,In=K2,J2=Q2,Ve=Rt,o0=kn,i0=Mr;function eh(){var e;this.rv=null;var t;this.qupvt=null;var a,o=new $2,m;this.setModules=function(V,d,R,x){e=V,t=d,this.rv=d,a=R,this.qupvt=R,m=x,o.setModules(a,m)},this.ms_convert=function(V,d){for(var R=0;R<576;++R){var x=V.tt[d][0].xr[R],C=V.tt[d][1].xr[R];V.tt[d][0].xr[R]=(x+C)*(Nn.SQRT2*.5),V.tt[d][1].xr[R]=(x-C)*(Nn.SQRT2*.5)}};function n(V,d,R,x){x=0;for(var C=0;C<=R;++C){var B=Math.abs(V.xr[C]);x+=B,d[C]=Math.sqrt(B*Math.sqrt(B)),d[C]>V.xrpow_max&&(V.xrpow_max=d[C])}return x}this.init_xrpow=function(V,d,R){var x=0,C=0|d.max_nonzero_coeff;if(d.xrpow_max=0,ds.fill(R,C,576,0),x=n(d,R,C,x),x>1e-20){var B=0;(V.substep_shaping&2)!=0&&(B=1);for(var i=0;i<d.psymax;i++)V.pseudohalf[i]=B;return!0}return ds.fill(d.l3_enc,0,576,0),!1};function M(V,d){var R=V.ATH,x=d.xr;if(d.block_type!=Ve.SHORT_TYPE)for(var C=!1,B=Ve.PSFB21-1;B>=0&&!C;B--){var i=V.scalefac_band.psfb21[B],E=V.scalefac_band.psfb21[B+1],p=a.athAdjust(R.adjust,R.psfb21[B],R.floor);V.nsPsy.longfact[21]>1e-12&&(p*=V.nsPsy.longfact[21]);for(var h=E-1;h>=i;h--)if(Math.abs(x[h])<p)x[h]=0;else{C=!0;break}}else for(var b=0;b<3;b++)for(var C=!1,B=Ve.PSFB12-1;B>=0&&!C;B--){var i=V.scalefac_band.s[12]*3+(V.scalefac_band.s[13]-V.scalefac_band.s[12])*b+(V.scalefac_band.psfb12[B]-V.scalefac_band.psfb12[0]),E=i+(V.scalefac_band.psfb12[B+1]-V.scalefac_band.psfb12[B]),S=a.athAdjust(R.adjust,R.psfb12[B],R.floor);V.nsPsy.shortfact[12]>1e-12&&(S*=V.nsPsy.shortfact[12]);for(var h=E-1;h>=i;h--)if(Math.abs(x[h])<S)x[h]=0;else{C=!0;break}}}this.init_outer_loop=function(V,d){d.part2_3_length=0,d.big_values=0,d.count1=0,d.global_gain=210,d.scalefac_compress=0,d.table_select[0]=0,d.table_select[1]=0,d.table_select[2]=0,d.subblock_gain[0]=0,d.subblock_gain[1]=0,d.subblock_gain[2]=0,d.subblock_gain[3]=0,d.region0_count=0,d.region1_count=0,d.preflag=0,d.scalefac_scale=0,d.count1table_select=0,d.part2_length=0,d.sfb_lmax=Ve.SBPSY_l,d.sfb_smin=Ve.SBPSY_s,d.psy_lmax=V.sfb21_extra?Ve.SBMAX_l:Ve.SBPSY_l,d.psymax=d.psy_lmax,d.sfbmax=d.sfb_lmax,d.sfbdivide=11;for(var R=0;R<Ve.SBMAX_l;R++)d.width[R]=V.scalefac_band.l[R+1]-V.scalefac_band.l[R],d.window[R]=3;if(d.block_type==Ve.SHORT_TYPE){var x=Us(576);d.sfb_smin=0,d.sfb_lmax=0,d.mixed_block_flag!=0&&(d.sfb_smin=3,d.sfb_lmax=V.mode_gr*2+4),d.psymax=d.sfb_lmax+3*((V.sfb21_extra?Ve.SBMAX_s:Ve.SBPSY_s)-d.sfb_smin),d.sfbmax=d.sfb_lmax+3*(Ve.SBPSY_s-d.sfb_smin),d.sfbdivide=d.sfbmax-18,d.psy_lmax=d.sfb_lmax;var C=V.scalefac_band.l[d.sfb_lmax];Ea.arraycopy(d.xr,0,x,0,576);for(var R=d.sfb_smin;R<Ve.SBMAX_s;R++)for(var B=V.scalefac_band.s[R],i=V.scalefac_band.s[R+1],E=0;E<3;E++)for(var p=B;p<i;p++)d.xr[C++]=x[3*p+E];for(var h=d.sfb_lmax,R=d.sfb_smin;R<Ve.SBMAX_s;R++)d.width[h]=d.width[h+1]=d.width[h+2]=V.scalefac_band.s[R+1]-V.scalefac_band.s[R],d.window[h]=0,d.window[h+1]=1,d.window[h+2]=2,h+=3}d.count1bits=0,d.sfb_partition_table=a.nr_of_sfb_block[0][0],d.slen[0]=0,d.slen[1]=0,d.slen[2]=0,d.slen[3]=0,d.max_nonzero_coeff=575,ds.fill(d.scalefac,0),M(V,d)};function T(V){this.ordinal=V}T.BINSEARCH_NONE=new T(0),T.BINSEARCH_UP=new T(1),T.BINSEARCH_DOWN=new T(2);function O(V,d,R,x,C){var B,i=V.CurrentStep[x],E=!1,p=V.OldValue[x],h=T.BINSEARCH_NONE;for(d.global_gain=p,R-=d.part2_length;;){var b;if(B=m.count_bits(V,C,d,null),i==1||B==R)break;B>R?(h==T.BINSEARCH_DOWN&&(E=!0),E&&(i/=2),h=T.BINSEARCH_UP,b=i):(h==T.BINSEARCH_UP&&(E=!0),E&&(i/=2),h=T.BINSEARCH_DOWN,b=-i),d.global_gain+=b,d.global_gain<0&&(d.global_gain=0,E=!0),d.global_gain>255&&(d.global_gain=255,E=!0)}for(qs(d.global_gain>=0),qs(d.global_gain<256);B>R&&d.global_gain<255;)d.global_gain++,B=m.count_bits(V,C,d,null);return V.CurrentStep[x]=p-d.global_gain>=4?4:2,V.OldValue[x]=d.global_gain,d.part2_3_length=B,B}this.trancate_smallspectrums=function(V,d,R,x){var C=Us(i0.SFBMAX);if(!((V.substep_shaping&4)==0&&d.block_type==Ve.SHORT_TYPE||(V.substep_shaping&128)!=0)){a.calc_noise(d,R,C,new In,null);for(var i=0;i<576;i++){var B=0;d.l3_enc[i]!=0&&(B=Math.abs(d.xr[i])),x[i]=B}var i=0,E=8;d.block_type==Ve.SHORT_TYPE&&(E=6);do{var p,h,b,S,c=d.width[E];if(i+=c,!(C[E]>=1)&&(ds.sort(x,i-c,c),!BitStream.EQ(x[i-1],0))){p=(1-C[E])*R[E],h=0,S=0;do{var _;for(b=1;S+b<c&&!BitStream.NEQ(x[S+i-c],x[S+i+b-c]);b++);if(_=x[S+i-c]*x[S+i-c]*b,p<_){S!=0&&(h=x[S+i-c-1]);break}p-=_,S+=b}while(S<c);if(!BitStream.EQ(h,0))do Math.abs(d.xr[i-c])<=h&&(d.l3_enc[i-c]=0);while(--c>0)}}while(++E<d.psymax);d.part2_3_length=m.noquant_count_bits(V,d,null)}};function g(V){for(var d=0;d<V.sfbmax;d++)if(V.scalefac[d]+V.subblock_gain[V.window[d]]==0)return!1;return!0}function N(V){return Nn.FAST_LOG10(.368+.632*V*V*V)}function u(V,d){for(var R=1e-37,x=0;x<d.psymax;x++)R+=N(V[x]);return Math.max(1e-20,R)}function y(V,d,R,x,C){var B;switch(V){default:case 9:{d.over_count>0?(B=R.over_SSD<=d.over_SSD,R.over_SSD==d.over_SSD&&(B=R.bits<d.bits)):B=R.max_noise<0&&R.max_noise*10+R.bits<=d.max_noise*10+d.bits;break}case 0:B=R.over_count<d.over_count||R.over_count==d.over_count&&R.over_noise<d.over_noise||R.over_count==d.over_count&&BitStream.EQ(R.over_noise,d.over_noise)&&R.tot_noise<d.tot_noise;break;case 8:R.max_noise=u(C,x);case 1:B=R.max_noise<d.max_noise;break;case 2:B=R.tot_noise<d.tot_noise;break;case 3:B=R.tot_noise<d.tot_noise&&R.max_noise<d.max_noise;break;case 4:B=R.max_noise<=0&&d.max_noise>.2||R.max_noise<=0&&d.max_noise<0&&d.max_noise>R.max_noise-.2&&R.tot_noise<d.tot_noise||R.max_noise<=0&&d.max_noise>0&&d.max_noise>R.max_noise-.2&&R.tot_noise<d.tot_noise+d.over_noise||R.max_noise>0&&d.max_noise>-.05&&d.max_noise>R.max_noise-.1&&R.tot_noise+R.over_noise<d.tot_noise+d.over_noise||R.max_noise>0&&d.max_noise>-.1&&d.max_noise>R.max_noise-.15&&R.tot_noise+R.over_noise+R.over_noise<d.tot_noise+d.over_noise+d.over_noise;break;case 5:B=R.over_noise<d.over_noise||BitStream.EQ(R.over_noise,d.over_noise)&&R.tot_noise<d.tot_noise;break;case 6:B=R.over_noise<d.over_noise||BitStream.EQ(R.over_noise,d.over_noise)&&(R.max_noise<d.max_noise||BitStream.EQ(R.max_noise,d.max_noise)&&R.tot_noise<=d.tot_noise);break;case 7:B=R.over_count<d.over_count||R.over_noise<d.over_noise;break}return d.over_count==0&&(B=B&&R.bits<d.bits),B}function k(V,d,R,x,C){var B=V.internal_flags,i;d.scalefac_scale==0?i=1.2968395546510096:i=1.6817928305074292;for(var E=0,p=0;p<d.sfbmax;p++)E<R[p]&&(E=R[p]);var h=B.noise_shaping_amp;switch(h==3&&(C?h=2:h=1),h){case 2:break;case 1:E>1?E=Math.pow(E,.5):E*=.95;break;case 0:default:E>1?E=1:E*=.95;break}for(var b=0,p=0;p<d.sfbmax;p++){var S=d.width[p],c;if(b+=S,!(R[p]<E)){if((B.substep_shaping&2)!=0&&(B.pseudohalf[p]=B.pseudohalf[p]==0?1:0,B.pseudohalf[p]==0&&B.noise_shaping_amp==2))return;for(d.scalefac[p]++,c=-S;c<0;c++)x[b+c]*=i,x[b+c]>d.xrpow_max&&(d.xrpow_max=x[b+c]);if(B.noise_shaping_amp==2)return}}}function r(V,d){for(var R=1.2968395546510096,x=0,C=0;C<V.sfbmax;C++){var B=V.width[C],i=V.scalefac[C];if(V.preflag!=0&&(i+=a.pretab[C]),x+=B,(i&1)!=0){i++;for(var E=-B;E<0;E++)d[x+E]*=R,d[x+E]>V.xrpow_max&&(V.xrpow_max=d[x+E])}V.scalefac[C]=i>>1}V.preflag=0,V.scalefac_scale=1}function H(V,d,R){var x,C=d.scalefac;for(x=0;x<d.sfb_lmax;x++)if(C[x]>=16)return!0;for(var B=0;B<3;B++){var i=0,E=0;for(x=d.sfb_lmax+B;x<d.sfbdivide;x+=3)i<C[x]&&(i=C[x]);for(;x<d.sfbmax;x+=3)E<C[x]&&(E=C[x]);if(!(i<16&&E<8)){if(d.subblock_gain[B]>=7)return!0;d.subblock_gain[B]++;var p=V.scalefac_band.l[d.sfb_lmax];for(x=d.sfb_lmax+B;x<d.sfbmax;x+=3){var h,b=d.width[x],S=C[x];if(S=S-(4>>d.scalefac_scale),S>=0){C[x]=S,p+=b*3;continue}C[x]=0;{var c=210+(S<<d.scalefac_scale+1);h=a.IPOW20(c)}p+=b*(B+1);for(var _=-b;_<0;_++)R[p+_]*=h,R[p+_]>d.xrpow_max&&(d.xrpow_max=R[p+_]);p+=b*(3-B-1)}{var h=a.IPOW20(202);p+=d.width[x]*(B+1);for(var _=-d.width[x];_<0;_++)R[p+_]*=h,R[p+_]>d.xrpow_max&&(d.xrpow_max=R[p+_])}}}return!1}function j(V,d,R,x,C){var B=V.internal_flags;k(V,d,R,x,C);var i=g(d);return i?!1:(B.mode_gr==2?i=m.scale_bitcount(d):i=m.scale_bitcount_lsf(B,d),i?(B.noise_shaping>1&&(ds.fill(B.pseudohalf,0),d.scalefac_scale==0?(r(d,x),i=!1):d.block_type==Ve.SHORT_TYPE&&B.subblock_gain>0&&(i=H(B,d,x)||g(d))),i||(B.mode_gr==2?i=m.scale_bitcount(d):i=m.scale_bitcount_lsf(B,d)),!i):!0)}this.outer_loop=function(V,d,R,x,C,B){var i=V.internal_flags,E=new o0,p=Us(576),h=Us(i0.SFBMAX),b=new In,S,c=new J2,_=9999999,f=!1,L=!1,Y=0;if(O(i,d,B,C,x),i.noise_shaping==0)return 100;a.calc_noise(d,R,h,b,c),b.bits=d.part2_3_length,E.assign(d);var F=0;for(Ea.arraycopy(x,0,p,0,576);!f;){do{var U=new In,l,v=255;if((i.substep_shaping&2)!=0?l=20:l=3,i.sfb21_extra&&(h[E.sfbmax]>1||E.block_type==Ve.SHORT_TYPE&&(h[E.sfbmax+1]>1||h[E.sfbmax+2]>1))||!j(V,E,h,x,L))break;E.scalefac_scale!=0&&(v=254);var Z=B-E.part2_length;if(Z<=0)break;for(;(E.part2_3_length=m.count_bits(i,x,E,c))>Z&&E.global_gain<=v;)E.global_gain++;if(E.global_gain>v)break;if(b.over_count==0){for(;(E.part2_3_length=m.count_bits(i,x,E,c))>_&&E.global_gain<=v;)E.global_gain++;if(E.global_gain>v)break}if(a.calc_noise(E,R,h,U,c),U.bits=E.part2_3_length,d.block_type!=Ve.SHORT_TYPE?S=V.quant_comp:S=V.quant_comp_short,S=y(S,b,U,E,h)?1:0,S!=0)_=d.part2_3_length,b=U,d.assign(E),F=0,Ea.arraycopy(x,0,p,0,576);else if(i.full_outer_loop==0&&(++F>l&&b.over_count==0||i.noise_shaping_amp==3&&L&&F>30||i.noise_shaping_amp==3&&L&&E.global_gain-Y>15))break}while(E.global_gain+E.scalefac_scale<255);i.noise_shaping_amp==3?L?f=!0:(E.assign(d),Ea.arraycopy(p,0,x,0,576),F=0,Y=E.global_gain,L=!0):f=!0}return qs(d.global_gain+d.scalefac_scale<=255),V.VBR==n0.vbr_rh||V.VBR==n0.vbr_mtrh?Ea.arraycopy(p,0,x,0,576):(i.substep_shaping&1)!=0&&trancate_smallspectrums(i,d,R,x),b.over_count},this.iteration_finish_one=function(V,d,R){var x=V.l3_side,C=x.tt[d][R];m.best_scalefac_store(V,d,R,x),V.use_best_huffman==1&&m.best_huffman_divide(V,C),t.ResvAdjust(V,C)},this.VBR_encode_granule=function(V,d,R,x,C,B,i){var E=V.internal_flags,p=new o0,h=Us(576),b=i,S=i+1,c=(i+B)/2,_,f,L=0,Y=E.sfb21_extra;qs(b<=LameInternalFlags.MAX_BITS_PER_CHANNEL),ds.fill(p.l3_enc,0);do c>b-42?E.sfb21_extra=!1:E.sfb21_extra=Y,f=outer_loop(V,d,R,x,C,c),f<=0?(L=1,S=d.part2_3_length,p.assign(d),Ea.arraycopy(x,0,h,0,576),i=S-32,_=i-B,c=(i+B)/2):(B=c+32,_=i-B,c=(i+B)/2,L!=0&&(L=2,d.assign(p),Ea.arraycopy(h,0,x,0,576)));while(_>12);E.sfb21_extra=Y,L==2&&Ea.arraycopy(p.l3_enc,0,d.l3_enc,0,576),qs(d.part2_3_length<=b)},this.get_framebits=function(V,d){var R=V.internal_flags;R.bitrate_index=R.VBR_min_bitrate;var x=e.getframebits(V);R.bitrate_index=1,x=e.getframebits(V);for(var C=1;C<=R.VBR_max_bitrate;C++){R.bitrate_index=C;var B=new MeanBits(x);d[C]=t.ResvFrameBegin(V,B),x=B.bits}},this.VBR_old_prepare=function(V,d,R,x,C,B,i,E,p){var h=V.internal_flags,b,S=0,c=1,_=0;h.bitrate_index=h.VBR_max_bitrate;var f=t.ResvFrameBegin(V,new MeanBits(0))/h.mode_gr;get_framebits(V,B);for(var L=0;L<h.mode_gr;L++){var Y=a.on_pe(V,d,E[L],f,L,0);h.mode_ext==Ve.MPG_MD_MS_LR&&(ms_convert(h.l3_side,L),a.reduce_side(E[L],R[L],f,Y));for(var F=0;F<h.channels_out;++F){var U=h.l3_side.tt[L][F];U.block_type!=Ve.SHORT_TYPE?(S=1.28/(1+Math.exp(3.5-d[L][F]/300))-.05,b=h.PSY.mask_adjust-S):(S=2.56/(1+Math.exp(3.5-d[L][F]/300))-.14,b=h.PSY.mask_adjust_short-S),h.masking_lower=Math.pow(10,b*.1),init_outer_loop(h,U),p[L][F]=a.calc_xmin(V,x[L][F],U,C[L][F]),p[L][F]!=0&&(c=0),i[L][F]=126,_+=E[L][F]}}for(var L=0;L<h.mode_gr;L++)for(var F=0;F<h.channels_out;F++)_>B[h.VBR_max_bitrate]&&(E[L][F]*=B[h.VBR_max_bitrate],E[L][F]/=_),i[L][F]>E[L][F]&&(i[L][F]=E[L][F]);return c},this.bitpressure_strategy=function(V,d,R,x){for(var C=0;C<V.mode_gr;C++)for(var B=0;B<V.channels_out;B++){for(var i=V.l3_side.tt[C][B],E=d[C][B],p=0,h=0;h<i.psy_lmax;h++)E[p++]*=1+.029*h*h/Ve.SBMAX_l/Ve.SBMAX_l;if(i.block_type==Ve.SHORT_TYPE)for(var h=i.sfb_smin;h<Ve.SBMAX_s;h++)E[p++]*=1+.029*h*h/Ve.SBMAX_s/Ve.SBMAX_s,E[p++]*=1+.029*h*h/Ve.SBMAX_s/Ve.SBMAX_s,E[p++]*=1+.029*h*h/Ve.SBMAX_s/Ve.SBMAX_s;x[C][B]=0|Math.max(R[C][B],.9*x[C][B])}},this.VBR_new_prepare=function(V,d,R,x,C,B){var i=V.internal_flags,E=1,p=0,h=0,b;if(V.free_format){i.bitrate_index=0;var S=new MeanBits(p);b=t.ResvFrameBegin(V,S),p=S.bits,C[0]=b}else{i.bitrate_index=i.VBR_max_bitrate;var S=new MeanBits(p);t.ResvFrameBegin(V,S),p=S.bits,get_framebits(V,C),b=C[i.VBR_max_bitrate]}for(var c=0;c<i.mode_gr;c++){a.on_pe(V,d,B[c],p,c,0),i.mode_ext==Ve.MPG_MD_MS_LR&&ms_convert(i.l3_side,c);for(var _=0;_<i.channels_out;++_){var f=i.l3_side.tt[c][_];i.masking_lower=Math.pow(10,i.PSY.mask_adjust*.1),init_outer_loop(i,f),a.calc_xmin(V,R[c][_],f,x[c][_])!=0&&(E=0),h+=B[c][_]}}for(var c=0;c<i.mode_gr;c++)for(var _=0;_<i.channels_out;_++)h>b&&(B[c][_]*=b,B[c][_]/=h);return E},this.calc_target_bits=function(V,d,R,x,C,B){var i=V.internal_flags,E=i.l3_side,p,h,b,S,c=0;i.bitrate_index=i.VBR_max_bitrate;var _=new MeanBits(c);for(B[0]=t.ResvFrameBegin(V,_),c=_.bits,i.bitrate_index=1,c=e.getframebits(V)-i.sideinfo_len*8,C[0]=c/(i.mode_gr*i.channels_out),c=V.VBR_mean_bitrate_kbps*V.framesize*1e3,(i.substep_shaping&1)!=0&&(c*=1.09),c/=V.out_samplerate,c-=i.sideinfo_len*8,c/=i.mode_gr*i.channels_out,p=.93+.07*(11-V.compression_ratio)/(11-5.5),p<.9&&(p=.9),p>1&&(p=1),h=0;h<i.mode_gr;h++){var f=0;for(b=0;b<i.channels_out;b++){if(x[h][b]=int(p*c),d[h][b]>700){var L=int((d[h][b]-700)/1.4),Y=E.tt[h][b];x[h][b]=int(p*c),Y.block_type==Ve.SHORT_TYPE&&L<c/2&&(L=c/2),L>c*3/2?L=c*3/2:L<0&&(L=0),x[h][b]+=L}x[h][b]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(x[h][b]=LameInternalFlags.MAX_BITS_PER_CHANNEL),f+=x[h][b]}if(f>LameInternalFlags.MAX_BITS_PER_GRANULE)for(b=0;b<i.channels_out;++b)x[h][b]*=LameInternalFlags.MAX_BITS_PER_GRANULE,x[h][b]/=f}if(i.mode_ext==Ve.MPG_MD_MS_LR)for(h=0;h<i.mode_gr;h++)a.reduce_side(x[h],R[h],c*i.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(S=0,h=0;h<i.mode_gr;h++)for(b=0;b<i.channels_out;b++)x[h][b]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(x[h][b]=LameInternalFlags.MAX_BITS_PER_CHANNEL),S+=x[h][b];if(S>B[0])for(h=0;h<i.mode_gr;h++)for(b=0;b<i.channels_out;b++)x[h][b]*=B[0],x[h][b]/=S}}var th=eh,ah=Ze,l0=ah.assert;function sh(){var e;this.setModules=function(t){e=t},this.ResvFrameBegin=function(t,a){var o=t.internal_flags,m,n=o.l3_side,M=e.getframebits(t);a.bits=(M-o.sideinfo_len*8)/o.mode_gr;var T=8*256*o.mode_gr-8;t.brate>320?m=8*int(t.brate*1e3/(t.out_samplerate/1152)/8+.5):(m=8*1440,t.strict_ISO&&(m=8*int(32e4/(t.out_samplerate/1152)/8+.5))),o.ResvMax=m-M,o.ResvMax>T&&(o.ResvMax=T),(o.ResvMax<0||t.disable_reservoir)&&(o.ResvMax=0);var O=a.bits*o.mode_gr+Math.min(o.ResvSize,o.ResvMax);return O>m&&(O=m),l0(o.ResvMax%8==0),l0(o.ResvMax>=0),n.resvDrain_pre=0,o.pinfo!=null&&(o.pinfo.mean_bits=a.bits/2,o.pinfo.resvsize=o.ResvSize),O},this.ResvMaxBits=function(t,a,o,m){var n=t.internal_flags,M,T=n.ResvSize,O=n.ResvMax;m!=0&&(T+=a),(n.substep_shaping&1)!=0&&(O*=.9),o.bits=a,T*10>O*9?(M=T-O*9/10,o.bits+=M,n.substep_shaping|=128):(M=0,n.substep_shaping&=127,!t.disable_reservoir&&(n.substep_shaping&1)==0&&(o.bits-=.1*a));var g=T<n.ResvMax*6/10?T:n.ResvMax*6/10;return g-=M,g<0&&(g=0),g},this.ResvAdjust=function(t,a){t.ResvSize-=a.part2_3_length+a.part2_length},this.ResvFrameEnd=function(t,a){var o,m=t.l3_side;t.ResvSize+=a*t.mode_gr;var n=0;m.resvDrain_post=0,m.resvDrain_pre=0,(o=t.ResvSize%8)!=0&&(n+=o),o=t.ResvSize-n-t.ResvMax,o>0&&(n+=o);{var M=Math.min(m.main_data_begin*8,n)/8;m.resvDrain_pre+=8*M,n-=8*M,t.ResvSize-=8*M,m.main_data_begin-=M}m.resvDrain_post+=n,t.ResvSize-=n}}var rh=sh;function nh(){var e="http://www.mp3dev.org/",t=3,a=98,o=4,m=0,n=93;this.getLameVersion=function(){return t+"."+a+"."+o},this.getLameShortVersion=function(){return t+"."+a+"."+o},this.getLameVeryShortVersion=function(){return"LAME"+t+"."+a+"r"},this.getPsyVersion=function(){return m+"."+n},this.getLameUrl=function(){return e},this.getLameOsBitness=function(){return"32bits"}}var oh=nh,ms=Ze,ih=ms.System,Vn=ms.VbrMode,c0=ms.ShortBlock,lh=ms.Arrays,Ir=ms.new_byte,ch=ms.assert;zs.NUMTOCENTRIES=100,zs.MAXFRAMESIZE=2880;function zs(){var e,t,a;this.setModules=function(c,_,f){e=c,t=_,a=f};var o=1,m=2,n=4,M=8,T=zs.NUMTOCENTRIES,O=zs.MAXFRAMESIZE,g=T+4+4+4+4+4,N=g+9+1+1+8+1+1+3+1+1+2+4+2+2,u=128,y=64,k=32,r=null,H="Xing",j="Info",V=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function d(c,_){if(c.nVbrNumFrames++,c.sum+=_,c.seen++,!(c.seen<c.want)&&(c.pos<c.size&&(c.bag[c.pos]=c.sum,c.pos++,c.seen=0),c.pos==c.size)){for(var f=1;f<c.size;f+=2)c.bag[f/2]=c.bag[f];c.want*=2,c.pos/=2}}function R(c,_){if(!(c.pos<=0))for(var f=1;f<T;++f){var L=f/T,Y,F,U=0|Math.floor(L*c.pos);U>c.pos-1&&(U=c.pos-1),Y=c.bag[U],F=c.sum;var l=0|256*Y/F;l>255&&(l=255),_[f]=255&l}}this.addVbrFrame=function(c){var _=c.internal_flags,f=Tables.bitrate_table[c.version][_.bitrate_index];ch(_.VBR_seek_table.bag!=null),d(_.VBR_seek_table,f)};function x(c,_){var f=c[_+0]&255;return f<<=8,f|=c[_+1]&255,f<<=8,f|=c[_+2]&255,f<<=8,f|=c[_+3]&255,f}function C(c,_,f){c[_+0]=255&(f>>24&255),c[_+1]=255&(f>>16&255),c[_+2]=255&(f>>8&255),c[_+3]=255&(f&255)}function B(c,_,f){c[_+0]=255&(f>>8&255),c[_+1]=255&(f&255)}function i(c,_){return new String(c,_,H.length(),r).equals(H)||new String(c,_,j.length(),r).equals(j)}function E(c,_,f){return 255&(c<<_|f&~(-1<<_))}function p(c,_){var f=c.internal_flags;_[0]=E(_[0],8,255),_[1]=E(_[1],3,7),_[1]=E(_[1],1,c.out_samplerate<16e3?0:1),_[1]=E(_[1],1,c.version),_[1]=E(_[1],2,4-3),_[1]=E(_[1],1,c.error_protection?0:1),_[2]=E(_[2],4,f.bitrate_index),_[2]=E(_[2],2,f.samplerate_index),_[2]=E(_[2],1,0),_[2]=E(_[2],1,c.extension),_[3]=E(_[3],2,c.mode.ordinal()),_[3]=E(_[3],2,f.mode_ext),_[3]=E(_[3],1,c.copyright),_[3]=E(_[3],1,c.original),_[3]=E(_[3],2,c.emphasis),_[0]=255;var L=255&(_[1]&241),Y;c.version==1?Y=u:c.out_samplerate<16e3?Y=k:Y=y,c.VBR==Vn.vbr_off&&(Y=c.brate);var F;c.free_format?F=0:F=255&16*e.BitrateIndex(Y,c.version,c.out_samplerate),c.version==1?(_[1]=255&(L|10),L=255&(_[2]&13),_[2]=255&(F|L)):(_[1]=255&(L|2),L=255&(_[2]&13),_[2]=255&(F|L))}this.getVbrTag=function(c){var _=new VBRTagData,f=0;_.flags=0;var L=c[f+1]>>3&1,Y=c[f+2]>>2&3,F=c[f+3]>>6&3,U=c[f+2]>>4&15;if(U=Tables.bitrate_table[L][U],c[f+1]>>4==14?_.samprate=Tables.samplerate_table[2][Y]:_.samprate=Tables.samplerate_table[L][Y],L!=0?F!=3?f+=32+4:f+=17+4:F!=3?f+=17+4:f+=9+4,!i(c,f))return null;f+=4,_.hId=L;var l=_.flags=x(c,f);if(f+=4,(l&o)!=0&&(_.frames=x(c,f),f+=4),(l&m)!=0&&(_.bytes=x(c,f),f+=4),(l&n)!=0){if(_.toc!=null)for(var v=0;v<T;v++)_.toc[v]=c[f+v];f+=T}_.vbrScale=-1,(l&M)!=0&&(_.vbrScale=x(c,f),f+=4),_.headersize=(L+1)*72e3*U/_.samprate,f+=21;var Z=c[f+0]<<4;Z+=c[f+1]>>4;var W=(c[f+1]&15)<<8;return W+=c[f+2]&255,(Z<0||Z>3e3)&&(Z=-1),(W<0||W>3e3)&&(W=-1),_.encDelay=Z,_.encPadding=W,_},this.InitVbrTag=function(c){var _=c.internal_flags,f;c.version==1?f=u:c.out_samplerate<16e3?f=k:f=y,c.VBR==Vn.vbr_off&&(f=c.brate);var L=(c.version+1)*72e3*f/c.out_samplerate,Y=_.sideinfo_len+N;if(_.VBR_seek_table.TotalFrameSize=L,L<Y||L>O){c.bWriteVbrTag=!1;return}_.VBR_seek_table.nVbrNumFrames=0,_.VBR_seek_table.nBytesWritten=0,_.VBR_seek_table.sum=0,_.VBR_seek_table.seen=0,_.VBR_seek_table.want=1,_.VBR_seek_table.pos=0,_.VBR_seek_table.bag==null&&(_.VBR_seek_table.bag=new int[400],_.VBR_seek_table.size=400);var F=Ir(O);p(c,F);for(var U=_.VBR_seek_table.TotalFrameSize,l=0;l<U;++l)t.add_dummy_byte(c,F[l]&255,1)};function h(c,_){var f=_^c;return _=_>>8^V[f&255],_}this.updateMusicCRC=function(c,_,f,L){for(var Y=0;Y<L;++Y)c[0]=h(_[f+Y],c[0])};function b(c,_,f,L,Y){var F=c.internal_flags,U=0,l=c.encoder_delay,v=c.encoder_padding,Z=100-10*c.VBR_q-c.quality,W=a.getLameVeryShortVersion(),se,me=0,ce,he=[1,5,3,2,4,0,3],ke=0|(c.lowpassfreq/100+.5>255?255:c.lowpassfreq/100+.5),ve=0,de=0,Re=0,je=c.internal_flags.noise_shaping,Be=0,De=0,He=0,Pe=0,Ge=0,St=(c.exp_nspsytune&1)!=0,_t=(c.exp_nspsytune&2)!=0,lt=!1,Et=!1,Ot=c.internal_flags.nogap_total,Pt=c.internal_flags.nogap_current,ht=c.ATHtype,Yt=0,kt;switch(c.VBR){case vbr_abr:kt=c.VBR_mean_bitrate_kbps;break;case vbr_off:kt=c.brate;break;default:kt=c.VBR_min_bitrate_kbps}switch(c.VBR.ordinal()<he.length?se=he[c.VBR.ordinal()]:se=0,ce=16*me+se,F.findReplayGain&&(F.RadioGain>510&&(F.RadioGain=510),F.RadioGain<-510&&(F.RadioGain=-510),de=8192,de|=3072,F.RadioGain>=0?de|=F.RadioGain:(de|=512,de|=-F.RadioGain)),F.findPeakSample&&(ve=Math.abs(0|F.PeakSample/32767*Math.pow(2,23)+.5)),Ot!=-1&&(Pt>0&&(Et=!0),Pt<Ot-1&&(lt=!0)),Yt=ht+((St?1:0)<<4)+((_t?1:0)<<5)+((lt?1:0)<<6)+((Et?1:0)<<7),Z<0&&(Z=0),c.mode){case MONO:Be=0;break;case STEREO:Be=1;break;case DUAL_CHANNEL:Be=2;break;case JOINT_STEREO:c.force_ms?Be=4:Be=3;break;case NOT_SET:default:Be=7;break}c.in_samplerate<=32e3?He=0:c.in_samplerate==48e3?He=2:c.in_samplerate>48e3?He=3:He=1,(c.short_blocks==c0.short_block_forced||c.short_blocks==c0.short_block_dispensed||c.lowpassfreq==-1&&c.highpassfreq==-1||c.scale_left<c.scale_right||c.scale_left>c.scale_right||c.disable_reservoir&&c.brate<320||c.noATH||c.ATHonly||ht==0||c.in_samplerate<=32e3)&&(De=1),Pe=je+(Be<<2)+(De<<5)+(He<<6),Ge=F.nMusicCRC,C(f,L+U,Z),U+=4;for(var ft=0;ft<9;ft++)f[L+U+ft]=255&W.charAt(ft);U+=9,f[L+U]=255&ce,U++,f[L+U]=255&ke,U++,C(f,L+U,ve),U+=4,B(f,L+U,de),U+=2,B(f,L+U,Re),U+=2,f[L+U]=255&Yt,U++,kt>=255?f[L+U]=255:f[L+U]=255&kt,U++,f[L+U]=255&l>>4,f[L+U+1]=255&(l<<4)+(v>>8),f[L+U+2]=255&v,U+=3,f[L+U]=255&Pe,U++,f[L+U++]=0,B(f,L+U,c.preset),U+=2,C(f,L+U,_),U+=4,B(f,L+U,Ge),U+=2;for(var le=0;le<U;le++)Y=h(f[L+le],Y);return B(f,L+U,Y),U+=2,U}function S(c){c.seek(0);var _=Ir(10);c.readFully(_);var f;return new String(_,"ISO-8859-1").startsWith("ID3")?f=0:f=((_[6]&127)<<21|(_[7]&127)<<14|(_[8]&127)<<7|_[9]&127)+_.length,f}this.getLameTagFrame=function(c,_){var f=c.internal_flags;if(!c.bWriteVbrTag||f.Class_ID!=Lame.LAME_ID||f.VBR_seek_table.pos<=0)return 0;if(_.length<f.VBR_seek_table.TotalFrameSize)return f.VBR_seek_table.TotalFrameSize;lh.fill(_,0,f.VBR_seek_table.TotalFrameSize,0),p(c,_);var L=Ir(T);if(c.free_format)for(var Y=1;Y<T;++Y)L[Y]=255&255*Y/100;else R(f.VBR_seek_table,L);var F=f.sideinfo_len;c.error_protection&&(F-=2),c.VBR==Vn.vbr_off?(_[F++]=255&j.charAt(0),_[F++]=255&j.charAt(1),_[F++]=255&j.charAt(2),_[F++]=255&j.charAt(3)):(_[F++]=255&H.charAt(0),_[F++]=255&H.charAt(1),_[F++]=255&H.charAt(2),_[F++]=255&H.charAt(3)),C(_,F,o+m+n+M),F+=4,C(_,F,f.VBR_seek_table.nVbrNumFrames),F+=4;var U=f.VBR_seek_table.nBytesWritten+f.VBR_seek_table.TotalFrameSize;C(_,F,0|U),F+=4,ih.arraycopy(L,0,_,F,L.length),F+=L.length,c.error_protection&&t.CRC_writeheader(f,_);for(var l=0,Y=0;Y<F;Y++)l=h(_[Y],l);return F+=b(c,U,_,F,l),f.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(c,_){var f=c.internal_flags;if(f.VBR_seek_table.pos<=0||(_.seek(_.length()),_.length()==0))return-1;var L=S(_);_.seek(L);var Y=Ir(O),F=getLameTagFrame(c,Y);return F>Y.length?-1:(F<1||_.write(Y,0,F),0)}}var dh=zs,d0=Ze,m0=d0.new_byte,mh=d0.assert,hh=D2,_h=z2,uh=Xi,fh=$i,vh=th,gh=Ji,ph=rh,bh=Sn,yh=t0,Sh=oh,Eh=dh;function kh(){this.setModules=function(e,t){}}function Mh(){this.setModules=function(e,t,a){}}function wh(){}function Rh(){this.setModules=function(e,t){}}function Ah(e,t,a){console.error("hello lib"),arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,t=44100,a=128);var o=new hh,m=new kh,n=new uh,M=new yh,T=new _h,O=new fh,g=new vh,N=new Eh,u=new Sh,y=new Rh,k=new ph,r=new gh,H=new Mh,j=new wh;o.setModules(n,M,T,O,g,N,u,y,j),M.setModules(n,j,u,N),y.setModules(M,u),T.setModules(o),g.setModules(M,k,O,r),O.setModules(r,k,o.enc.psy),k.setModules(M),r.setModules(O),N.setModules(o,M,u),m.setModules(H,j),H.setModules(u,y,T);var V=o.lame_init();V.num_channels=e,V.in_samplerate=t,V.brate=a,V.mode=bh.STEREO,V.quality=3,V.bWriteVbrTag=!1,V.disable_reservoir=!0,V.write_id3tag_automatic=!1,o.lame_init_params(V);var d=1152,R=0|1.25*d+7200,x=m0(R);this.encodeBuffer=function(C,B){e==1&&(B=C),mh(C.length==B.length),C.length>d&&(d=C.length,R=0|1.25*d+7200,x=m0(R));var i=o.lame_encode_buffer(V,C,B,C.length,x,0,R);return new Int8Array(x.subarray(0,i))},this.flush=function(){var C=o.lame_encode_flush(V,x,0,R);return new Int8Array(x.subarray(0,C))}}function ia(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function Vr(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}ia.RIFF=Vr("RIFF"),ia.WAVE=Vr("WAVE"),ia.fmt_=Vr("fmt "),ia.data=Vr("data"),ia.readHeader=function(e){var t=new ia,a=e.getUint32(0,!1);if(ia.RIFF==a&&(e.getUint32(4,!0),ia.WAVE==e.getUint32(8,!1)&&ia.fmt_==e.getUint32(12,!1))){var o=e.getUint32(16,!0),m=16+4;switch(o){case 16:case 18:t.channels=e.getUint16(m+2,!0),t.sampleRate=e.getUint32(m+4,!0);break;default:throw"extended fmt chunk not implemented"}m+=o;for(var n=ia.data,M=0;n!=a&&(a=e.getUint32(m,!1),M=e.getUint32(m+4,!0),n!=a);)m+=M+8;return t.dataLen=M,t.dataOffset=m+8,t}};var h0=Ah;class Th{constructor(t){this.bitRate=t.bitRate,this.sampleRate=t.sampleRate,this.dataBuffer=[],console.log(h0),this.encoder=new h0(1,this.sampleRate,this.bitRate)}encode(t){const o=this._convertBuffer(t);let m=o.length;for(let n=0;m>=0;n+=1152){const M=o.subarray(n,n+1152),T=this.encoder.encodeBuffer(M);this.dataBuffer.push(new Int8Array(T)),m-=1152}}finish(){this.dataBuffer.push(this.encoder.flush());const t=new Blob(this.dataBuffer,{type:"audio/mp3"});return this.dataBuffer=[],{id:Date.now(),blob:t,url:URL.createObjectURL(t)}}_floatTo16BitPCM(t,a){for(let o=0;o<t.length;o++){const m=Math.max(-1,Math.min(1,t[o]));a[o]=m<0?m*32768:m*32767}}_convertBuffer(t){const a=new Float32Array(t),o=new Int16Array(t.length);return this._floatTo16BitPCM(a,o),o}}class xh{constructor(t={}){this.beforeRecording=t.beforeRecording,this.pauseRecording=t.pauseRecording,this.afterRecording=t.afterRecording,this.micFailed=t.micFailed,this.encoderOptions={bitRate:t.bitRate,sampleRate:t.sampleRate},this.bufferSize=4096,this.records=[],this.isPause=!1,this.isRecording=!1,this.duration=0,this.volume=0,this._duration=0}start(){const t={video:!1,audio:{channelCount:1,echoCancellation:!1}};this.beforeRecording&&this.beforeRecording("start recording"),navigator.mediaDevices.getUserMedia(t).then(this._micCaptured.bind(this)).catch(this._micError.bind(this)),this.isPause=!1,this.isRecording=!0,this.lameEncoder||(this.lameEncoder=new Th(this.encoderOptions))}stop(){this.stream.getTracks().forEach(a=>a.stop()),this.input.disconnect(),this.processor.disconnect(),this.context.close();let t=null;t=this.lameEncoder.finish(),t.duration=this.duration,this.records.push(t),this._duration=0,this.duration=0,this.isPause=!1,this.isRecording=!1,this.afterRecording&&this.afterRecording(t)}pause(){this.stream.getTracks().forEach(t=>t.stop()),this.input.disconnect(),this.processor.disconnect(),this._duration=this.duration,this.isPause=!0,this.pauseRecording&&this.pauseRecording("pause recording")}_micCaptured(t){this.context=new(window.AudioContext||window.webkitAudioContext),this.duration=this._duration,this.input=this.context.createMediaStreamSource(t),this.processor=this.context.createScriptProcessor(this.bufferSize,1,1),this.stream=t,this.processor.onaudioprocess=a=>{const o=a.inputBuffer.getChannelData(0);let m=0;this.lameEncoder&&this.lameEncoder.encode(o);for(let n=0;n<o.length;++n)m+=o[n]*o[n];this.duration=parseFloat(this._duration)+parseFloat(this.context.currentTime.toFixed(2)),this.volume=Math.sqrt(m/o.length).toFixed(2)},this.input.connect(this.processor),this.processor.connect(this.context.destination)}_micError(t){this.micFailed&&this.micFailed(t)}}function _0(){var e=Bh(),t=e.substr(0,4);return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw(n|u)|c55\/|capi|ccwa|cdm|cell|chtm|cldc|cmd|co(mp|nd)|craw|da(it|ll|ng)|dbte|dcs|devi|dica|dmob|do(c|p)o|ds(12|d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(|_)|g1 u|g560|gene|gf5|gmo|go(\.w|od)|gr(ad|un)|haie|hcit|hd(m|p|t)|hei|hi(pt|ta)|hp( i|ip)|hsc|ht(c(| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i(20|go|ma)|i230|iac( ||\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|[a-w])|libw|lynx|m1w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|mcr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|([1-8]|c))|phil|pire|pl(ay|uc)|pn2|po(ck|rt|se)|prox|psio|ptg|qaa|qc(07|12|21|32|60|[2-7]|i)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h|oo|p)|sdk\/|se(c(|0|1)|47|mc|nd|ri)|sgh|shar|sie(|m)|sk0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h|v|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl|tdg|tel(i|m)|tim|tmo|to(pl|sh)|ts(70|m|m3|m5)|tx9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas|your|zeto|zte/i.test(t)}function Bh(){var e=navigator.userAgent||navigator.vendor||window.opera||null;if(!e)throw new Error("Failed to look for user agent information.");return e}const Ch={name:"RoomFooter",components:{SvgIcon:gt,EmojiPickerContainer:gi,RoomFiles:Id,RoomMessageReply:rm,RoomUsersTag:dm,RoomEmojis:um,RoomTemplatesText:Sm},directives:{clickOutside:nr},props:{room:{type:Object,required:!0},roomId:{type:[String,Number],required:!0},roomMessage:{type:String,default:null},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},textMessages:{type:Object,required:!0},showSendIcon:{type:Boolean,required:!0},showFiles:{type:Boolean,required:!0},showAudio:{type:Boolean,required:!0},showEmojis:{type:Boolean,required:!0},showFooter:{type:Boolean,required:!0},acceptedFiles:{type:String,required:!0},textareaActionEnabled:{type:Boolean,required:!0},textareaAutoFocus:{type:Boolean,required:!0},userTagsEnabled:{type:Boolean,required:!0},emojisSuggestionEnabled:{type:Boolean,required:!0},templatesText:{type:Array,default:null},audioBitRate:{type:Number,required:!0},audioSampleRate:{type:Number,required:!0},initReplyMessage:{type:Object,default:null},initEditMessage:{type:Object,default:null}},emits:["edit-message","send-message","update-edited-message-id","textarea-action-handler","typing-message"],data(){return{message:"",editedMessage:{},messageReply:null,cursorRangePosition:null,files:[],fileDialog:!1,selectUsersTagItem:null,selectEmojiItem:null,selectTemplatesTextItem:null,format:"mp3",activeUpOrDownEmojis:null,activeUpOrDownUsersTag:null,activeUpOrDownTemplatesText:null,emojisDB:new Do,emojiOpened:!1,keepKeyboardOpen:!1,filteredEmojis:[],filteredUsersTag:[],selectedUsersTag:[],filteredTemplatesText:[],recorder:this.initRecorder(),isRecording:!1}},computed:{isMessageEmpty(){return!this.files.length&&!this.message.trim()},isFileLoading(){return this.files.some(e=>e.loading)},recordedTime(){return new Date(this.recorder.duration*1e3).toISOString().substr(14,5)},shadowFooter(){return!!this.filteredEmojis.length||!!this.filteredUsersTag.length||!!this.filteredTemplatesText.length||!!this.files.length||!!this.messageReply}},watch:{roomId(){this.resetMessage(!0,!0),this.roomMessage&&(this.message=this.roomMessage,setTimeout(()=>this.onChangeInput()))},message(e){this.getTextareaRef().value=e},roomMessage:{immediate:!0,handler(e){e&&(this.message=this.roomMessage)}},editedMessage(e){this.$emit("update-edited-message-id",e._id)},initReplyMessage(e){this.replyMessage(e)},initEditMessage(e){this.editMessage(e)}},mounted(){const e=_0();let t=!0;this.getTextareaRef().addEventListener("keyup",a=>{a.key==="Enter"&&!a.shiftKey&&!this.fileDialog&&(e?(this.message=this.message+`
`,setTimeout(()=>this.onChangeInput())):t&&!this.filteredEmojis.length&&!this.filteredUsersTag.length&&!this.filteredTemplatesText.length&&this.sendMessage()),t=!a.isComposing,setTimeout(()=>{this.updateFooterLists()},60)}),this.getTextareaRef().addEventListener("click",()=>{e&&(this.keepKeyboardOpen=!0),this.updateFooterLists()}),this.getTextareaRef().addEventListener("blur",()=>{this.resetFooterList(),e&&setTimeout(()=>this.keepKeyboardOpen=!1)})},beforeUnmount(){this.stopRecorder()},methods:{getTextareaRef(){return this.$refs.roomTextarea},focusTextarea(e){_0()&&e||!this.getTextareaRef()||(this.getTextareaRef().focus(),this.cursorRangePosition&&setTimeout(()=>{this.getTextareaRef().setSelectionRange(this.cursorRangePosition,this.cursorRangePosition),this.cursorRangePosition=null}))},onChangeInput(){var e,t,a;(((e=this.getTextareaRef())==null?void 0:e.value)||((t=this.getTextareaRef())==null?void 0:t.value)==="")&&(this.message=(a=this.getTextareaRef())==null?void 0:a.value),this.keepKeyboardOpen=!0,this.resizeTextarea(),this.$emit("typing-message",this.message)},resizeTextarea(){const e=this.getTextareaRef();if(!e)return;const t=window.getComputedStyle(e,null).getPropertyValue("padding-top").replace("px","");e.style.height=0,e.style.height=e.scrollHeight-t*2+"px"},escapeTextarea(){this.filteredEmojis.length?this.filteredEmojis=[]:this.filteredUsersTag.length?this.filteredUsersTag=[]:this.filteredTemplatesText.length?this.filteredTemplatesText=[]:this.resetMessage()},onPasteImage(e){var a;const t=(a=e.clipboardData)==null?void 0:a.items;t&&Array.from(t).forEach(o=>{if(o.type.includes("image")){const m=o.getAsFile();this.onFileChange([m])}})},updateActiveUpOrDown(e){this.filteredEmojis.length?this.activeUpOrDownEmojis=e:this.filteredUsersTag.length?this.activeUpOrDownUsersTag=e:this.filteredTemplatesText.length&&(this.activeUpOrDownTemplatesText=e)},selectItem(){this.filteredEmojis.length?this.selectEmojiItem=!0:this.filteredUsersTag.length?this.selectUsersTagItem=!0:this.filteredTemplatesText.length&&(this.selectTemplatesTextItem=!0)},selectEmoji(e){if(this.selectEmojiItem=!1,!e)return;const{position:t,endPosition:a}=this.getCharPosition(":");this.message=this.message.substr(0,t-1)+e+this.message.substr(a,this.message.length-1),this.cursorRangePosition=t,this.focusTextarea()},selectTemplateText(e){if(this.selectTemplatesTextItem=!1,!e)return;const{position:t,endPosition:a}=this.getCharPosition("/"),o=this.message.substr(a,a).length?"":" ";this.message=this.message.substr(0,t-1)+e.text+o+this.message.substr(a,this.message.length-1),this.cursorRangePosition=t+e.text.length+o.length+1,this.focusTextarea()},addEmoji(e){this.message+=e.unicode,this.focusTextarea(!0)},launchFilePicker(){this.$refs.file.value="",this.$refs.file.click()},async onFileChange(e){this.fileDialog=!0,this.focusTextarea(),Array.from(e).forEach(async t=>{const a=URL.createObjectURL(t),o=t.name.lastIndexOf(".");this.files.push({loading:!0,name:t.name.substring(0,o),size:t.size,type:t.type,extension:t.name.substring(o+1),localUrl:a});const m=await fetch(a).then(M=>M.blob());let n=this.files.find(M=>M.localUrl===a);n&&(n.blob=m,n.loading=!1,delete n.loading)}),setTimeout(()=>this.fileDialog=!1,500)},removeFile(e){this.files.splice(e,1),this.focusTextarea()},toggleRecorder(e){if(this.isRecording=e,!this.recorder.isRecording)setTimeout(()=>this.recorder.start(),200);else try{this.recorder.stop();const t=this.recorder.records[0];this.files.push({blob:t.blob,name:`audio.${this.format}`,size:t.blob.size,duration:t.duration,type:t.blob.type,audio:!0,localUrl:URL.createObjectURL(t.blob)}),this.recorder=this.initRecorder(),this.sendMessage()}catch{setTimeout(()=>this.stopRecorder(),100)}},stopRecorder(){if(this.recorder.isRecording)try{this.recorder.stop(),this.recorder=this.initRecorder()}catch{setTimeout(()=>this.stopRecorder(),100)}},textareaActionHandler(){this.$emit("textarea-action-handler",this.message)},sendMessage(){var a;let e=this.message.trim();if(!this.files.length&&!e||this.isFileLoading)return;this.selectedUsersTag.forEach(o=>{e=e.replace(`@${o.username}`,`<usertag>${o._id}</usertag>`)});const t=this.files.length?this.files:null;this.editedMessage._id?(this.editedMessage.content!==e||((a=this.editedMessage.files)==null?void 0:a.length)||this.files.length)&&this.$emit("edit-message",{messageId:this.editedMessage._id,newContent:e,files:t,replyMessage:this.messageReply,usersTag:this.selectedUsersTag}):this.$emit("send-message",{content:e,files:t,replyMessage:this.messageReply,usersTag:this.selectedUsersTag}),this.resetMessage(!0)},editMessage(e){this.resetMessage(),this.editedMessage={...e};let t=e.content;const a=t,o="<usertag>",m="</usertag>";[...t.matchAll(new RegExp(o,"gi"))].map(M=>M.index).forEach(M=>{const T=a.substring(M+o.length,a.indexOf(m,M)),O=this.room.users.find(g=>g._id===T);t=t.replace(`${o}${T}${m}`,`@${(O==null?void 0:O.username)||"unknown"}`),this.selectUserTag(O,!0)}),this.message=t,e.files&&(this.files=[...e.files]),setTimeout(()=>this.resizeTextarea())},replyMessage(e){this.editedMessage={},this.messageReply=e,this.focusTextarea()},updateFooterLists(){this.updateFooterList("@"),this.updateFooterList(":"),this.updateFooterList("/")},updateFooterList(e){if(!this.getTextareaRef()||e===":"&&!this.emojisSuggestionEnabled||e==="@"&&(!this.userTagsEnabled||!this.room.users)||e==="/"&&!this.templatesText)return;const t=this.getTextareaRef().selectionStart;let a=t;for(;a>0&&this.message.charAt(a-1)!==e&&(this.message.charAt(a-1)!==" "||e!==":");)a--;const o=this.message.charAt(a-2),m=!o.match(/^[0-9a-zA-Z]+$/);if(this.message.charAt(a-1)===e&&(!o||o===" "||m)){const n=this.message.substring(a,t);e===":"?this.updateEmojis(n):e==="@"?this.updateShowUsersTag(n):e==="/"&&this.updateShowTemplatesText(n)}else this.resetFooterList(e)},updateShowUsersTag(e){this.filteredUsersTag=en(this.room.users,"username",e,!0).filter(t=>t._id!==this.currentUserId)},selectUserTag(e,t=!1){if(this.selectUsersTagItem=!1,!e)return;const{position:a,endPosition:o}=this.getCharPosition("@"),m=this.message.substr(o,o).length?"":" ";this.message=this.message.substr(0,a)+e.username+m+this.message.substr(o,this.message.length-1),this.selectedUsersTag=[...this.selectedUsersTag,{...e}],t||(this.cursorRangePosition=a+e.username.length+m.length+1),this.focusTextarea()},updateShowTemplatesText(e){this.filteredTemplatesText=en(this.templatesText,"tag",e,!0)},getCharPosition(e){let a=this.getTextareaRef().selectionStart;for(;a>0&&this.message.charAt(a-1)!==e;)a--;const o=this.getTextareaRef().selectionEnd;return{position:a,endPosition:o}},async updateEmojis(e){if(!e)return;const t=await this.emojisDB.getEmojiBySearchQuery(e);this.filteredEmojis=t.map(a=>a.unicode)},resetFooterList(e=null){e===":"?this.filteredEmojis=[]:e==="@"?this.filteredUsersTag=[]:e==="/"?this.filteredTemplatesText=[]:(this.filteredEmojis=[],this.filteredUsersTag=[],this.filteredTemplatesText=[])},resetMessage(e=!1,t=!1){t||this.$emit("typing-message",null),this.selectedUsersTag=[],this.resetFooterList(),this.resetTextareaSize(),this.message="",this.editedMessage={},this.messageReply=null,this.files=[],this.emojiOpened=!1,this.preventKeyboardFromClosing(),(this.textareaAutoFocus||!t)&&setTimeout(()=>this.focusTextarea(e))},resetTextareaSize(){this.getTextareaRef()&&(this.getTextareaRef().style.height="20px")},preventKeyboardFromClosing(){this.keepKeyboardOpen&&this.getTextareaRef().focus()},initRecorder(){return this.isRecording=!1,new xh({bitRate:this.audioBitRate,sampleRate:this.audioSampleRate,beforeRecording:null,afterRecording:null,pauseRecording:null,micFailed:this.micFailed})},micFailed(){this.isRecording=!1,this.recorder=this.initRecorder()}}},Oh={key:0,class:"vac-icon-textarea-left"},Lh=s.createElementVNode("div",{class:"vac-dot-audio-record"},null,-1),Nh={class:"vac-dot-audio-record-time"},Ih=["placeholder"],Vh={class:"vac-icon-textarea"},jh={key:1},Hh=["accept"];function Ph(e,t,a,o,m,n){const M=s.resolveComponent("room-emojis"),T=s.resolveComponent("room-users-tag"),O=s.resolveComponent("room-templates-text"),g=s.resolveComponent("room-message-reply"),N=s.resolveComponent("room-files"),u=s.resolveComponent("svg-icon"),y=s.resolveComponent("emoji-picker-container"),k=s.resolveDirective("click-outside");return s.withDirectives((s.openBlock(),s.createElementBlock("div",{id:"room-footer",class:s.normalizeClass(["vac-room-footer",{"vac-app-box-shadow":n.shadowFooter}])},[s.createVNode(M,{"filtered-emojis":m.filteredEmojis,"select-item":m.selectEmojiItem,"active-up-or-down":m.activeUpOrDownEmojis,onSelectEmoji:t[0]||(t[0]=r=>n.selectEmoji(r)),onActivateItem:t[1]||(t[1]=r=>m.activeUpOrDownEmojis=0)},null,8,["filtered-emojis","select-item","active-up-or-down"]),s.createVNode(T,{"filtered-users-tag":m.filteredUsersTag,"select-item":m.selectUsersTagItem,"active-up-or-down":m.activeUpOrDownUsersTag,onSelectUserTag:t[2]||(t[2]=r=>n.selectUserTag(r)),onActivateItem:t[3]||(t[3]=r=>m.activeUpOrDownUsersTag=0)},null,8,["filtered-users-tag","select-item","active-up-or-down"]),s.createVNode(O,{"filtered-templates-text":m.filteredTemplatesText,"select-item":m.selectTemplatesTextItem,"active-up-or-down":m.activeUpOrDownTemplatesText,onSelectTemplateText:t[4]||(t[4]=r=>n.selectTemplateText(r)),onActivateItem:t[5]||(t[5]=r=>m.activeUpOrDownTemplatesText=0)},null,8,["filtered-templates-text","select-item","active-up-or-down"]),s.createVNode(g,{room:a.room,"message-reply":m.messageReply,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onResetMessage:n.resetMessage},s.createSlots({_:2},[s.renderList(e.$slots,(r,H)=>({name:H,fn:s.withCtx(j=>[s.renderSlot(e.$slots,H,s.normalizeProps(s.guardReactiveProps(j)))])}))]),1032,["room","message-reply","text-formatting","link-options","onResetMessage"]),s.createVNode(N,{files:m.files,onRemoveFile:n.removeFile,onResetMessage:n.resetMessage},s.createSlots({_:2},[s.renderList(e.$slots,(r,H)=>({name:H,fn:s.withCtx(j=>[s.renderSlot(e.$slots,H,s.normalizeProps(s.guardReactiveProps(j)))])}))]),1032,["files","onRemoveFile","onResetMessage"]),s.createElementVNode("div",{class:s.normalizeClass(["vac-box-footer",{"vac-box-footer-border":!m.files.length}])},[a.showAudio&&!m.files.length?(s.openBlock(),s.createElementBlock("div",Oh,[m.isRecording?(s.openBlock(),s.createElementBlock(s.Fragment,{key:0},[s.createElementVNode("div",{class:"vac-svg-button vac-icon-audio-stop",onClick:t[6]||(t[6]=(...r)=>n.stopRecorder&&n.stopRecorder(...r))},[s.renderSlot(e.$slots,"audio-stop-icon",{},()=>[s.createVNode(u,{name:"close-outline"})])]),Lh,s.createElementVNode("div",Nh,s.toDisplayString(n.recordedTime),1),s.createElementVNode("div",{class:"vac-svg-button vac-icon-audio-confirm",onClick:t[7]||(t[7]=r=>n.toggleRecorder(!1))},[s.renderSlot(e.$slots,"audio-stop-icon",{},()=>[s.createVNode(u,{name:"checkmark"})])])],64)):(s.openBlock(),s.createElementBlock("div",{key:1,class:"vac-svg-button",onClick:t[8]||(t[8]=r=>n.toggleRecorder(!0))},[s.renderSlot(e.$slots,"microphone-icon",{},()=>[s.createVNode(u,{name:"microphone",class:"vac-icon-microphone"})])]))])):s.createCommentVNode("",!0),s.createElementVNode("textarea",{id:"roomTextarea",ref:"roomTextarea",placeholder:a.textMessages.TYPE_MESSAGE,class:s.normalizeClass(["vac-textarea",{"vac-textarea-outline":m.editedMessage._id}]),style:{"min-height":"20px","padding-left":"12px"},onInput:t[9]||(t[9]=(...r)=>n.onChangeInput&&n.onChangeInput(...r)),onKeydown:[t[10]||(t[10]=s.withKeys((...r)=>n.escapeTextarea&&n.escapeTextarea(...r),["esc"])),t[11]||(t[11]=s.withKeys(s.withModifiers((...r)=>n.selectItem&&n.selectItem(...r),["exact","prevent"]),["enter"])),t[13]||(t[13]=s.withKeys(s.withModifiers(()=>{},["exact","prevent"]),["tab"])),t[14]||(t[14]=s.withKeys((...r)=>n.selectItem&&n.selectItem(...r),["tab"])),t[15]||(t[15]=s.withKeys(s.withModifiers(()=>{},["exact","prevent"]),["up"])),t[16]||(t[16]=s.withKeys(r=>n.updateActiveUpOrDown(-1),["up"])),t[17]||(t[17]=s.withKeys(s.withModifiers(()=>{},["exact","prevent"]),["down"])),t[18]||(t[18]=s.withKeys(r=>n.updateActiveUpOrDown(1),["down"]))],onPaste:t[12]||(t[12]=(...r)=>n.onPasteImage&&n.onPasteImage(...r))},null,42,Ih),s.createElementVNode("div",Vh,[m.editedMessage._id?(s.openBlock(),s.createElementBlock("div",{key:0,class:"vac-svg-button",onClick:t[19]||(t[19]=(...r)=>n.resetMessage&&n.resetMessage(...r))},[s.renderSlot(e.$slots,"edit-close-icon",{},()=>[s.createVNode(u,{name:"close-outline"})])])):s.createCommentVNode("",!0),a.showEmojis?s.withDirectives((s.openBlock(),s.createElementBlock("div",jh,[s.renderSlot(e.$slots,"emoji-picker",s.mergeProps({emojiOpened:m.emojiOpened},{addEmoji:n.addEmoji}),()=>[s.createVNode(y,{"emoji-opened":m.emojiOpened,"position-top":!0,onAddEmoji:n.addEmoji,onOpenEmoji:t[20]||(t[20]=r=>m.emojiOpened=r)},{"emoji-picker-icon":s.withCtx(()=>[s.renderSlot(e.$slots,"emoji-picker-icon")]),_:3},8,["emoji-opened","onAddEmoji"])])])),[[k,()=>m.emojiOpened=!1]]):s.createCommentVNode("",!0),a.showFiles?(s.openBlock(),s.createElementBlock("div",{key:2,class:"vac-svg-button",onClick:t[21]||(t[21]=(...r)=>n.launchFilePicker&&n.launchFilePicker(...r))},[s.renderSlot(e.$slots,"paperclip-icon",{},()=>[s.createVNode(u,{name:"paperclip"})])])):s.createCommentVNode("",!0),a.textareaActionEnabled?(s.openBlock(),s.createElementBlock("div",{key:3,class:"vac-svg-button",onClick:t[22]||(t[22]=(...r)=>n.textareaActionHandler&&n.textareaActionHandler(...r))},[s.renderSlot(e.$slots,"custom-action-icon",{},()=>[s.createVNode(u,{name:"deleted"})])])):s.createCommentVNode("",!0),a.showFiles?(s.openBlock(),s.createElementBlock("input",{key:4,ref:"file",type:"file",multiple:"",accept:a.acceptedFiles,style:{display:"none"},onChange:t[23]||(t[23]=r=>n.onFileChange(r.target.files))},null,40,Hh)):s.createCommentVNode("",!0),a.showSendIcon?(s.openBlock(),s.createElementBlock("div",{key:5,class:s.normalizeClass(["vac-svg-button",{"vac-send-disabled":n.isMessageEmpty}]),onClick:t[24]||(t[24]=(...r)=>n.sendMessage&&n.sendMessage(...r))},[s.renderSlot(e.$slots,"send-icon",{},()=>[s.createVNode(u,{name:"send",param:n.isMessageEmpty||n.isFileLoading?"disabled":""},null,8,["param"])])],2)):s.createCommentVNode("",!0)])],2)],2)),[[s.vShow,Object.keys(a.room).length&&a.showFooter]])}var Fh=Fe(Ch,[["render",Ph]]);const Dh={name:"MessageReply",components:{AudioPlayer:bn,SvgIcon:gt,FormatMessage:Ts},props:{message:{type:Object,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},roomUsers:{type:Array,required:!0}},computed:{replyUsername(){const{senderId:e}=this.message.replyMessage,t=this.roomUsers.find(a=>a._id===e);return t?t.username:""},firstFile(){var e,t;return(t=(e=this.message.replyMessage)==null?void 0:e.files)!=null&&t.length?this.message.replyMessage.files[0]:{}},isAudio(){return or(this.firstFile)},isImage(){return $a(this.firstFile)},isVideo(){return Bs(this.firstFile)},isOtherFile(){var e;return((e=this.message.replyMessage.files)==null?void 0:e.length)&&!this.isAudio&&!this.isVideo&&!this.isImage}}},Uh={class:"vac-reply-message"},qh={class:"vac-reply-username"},zh={key:0,class:"vac-image-reply-container"},Xh={key:1,class:"vac-video-reply-container"},Yh={width:"100%",height:"100%",controls:""},Gh=["src"],Kh={key:3,class:"vac-file-container"},Zh={class:"vac-text-ellipsis"},Wh={key:0,class:"vac-text-ellipsis vac-text-extension"},Qh={class:"vac-reply-content"};function $h(e,t,a,o,m,n){const M=s.resolveComponent("audio-player"),T=s.resolveComponent("svg-icon"),O=s.resolveComponent("format-message");return s.openBlock(),s.createElementBlock("div",Uh,[s.createElementVNode("div",qh,s.toDisplayString(n.replyUsername),1),n.isImage?(s.openBlock(),s.createElementBlock("div",zh,[s.createElementVNode("div",{class:"vac-message-image vac-message-image-reply",style:s.normalizeStyle({"background-image":`url('${n.firstFile.url}')`})},null,4)])):n.isVideo?(s.openBlock(),s.createElementBlock("div",Xh,[s.createElementVNode("video",Yh,[s.createElementVNode("source",{src:n.firstFile.url},null,8,Gh)])])):n.isAudio?(s.openBlock(),s.createBlock(M,{key:2,src:n.firstFile.url,onUpdateProgressTime:t[0]||(t[0]=g=>e.progressTime=g),onHoverAudioProgress:t[1]||(t[1]=g=>e.hoverAudioProgress=g)},s.createSlots({_:2},[s.renderList(e.$slots,(g,N)=>({name:N,fn:s.withCtx(u=>[s.renderSlot(e.$slots,N,s.normalizeProps(s.guardReactiveProps(u)))])}))]),1032,["src"])):n.isOtherFile?(s.openBlock(),s.createElementBlock("div",Kh,[s.createElementVNode("div",null,[s.renderSlot(e.$slots,"file-icon",{},()=>[s.createVNode(T,{name:"file"})])]),s.createElementVNode("div",Zh,s.toDisplayString(n.firstFile.name),1),n.firstFile.extension?(s.openBlock(),s.createElementBlock("div",Wh,s.toDisplayString(n.firstFile.extension),1)):s.createCommentVNode("",!0)])):s.createCommentVNode("",!0),s.createElementVNode("div",Qh,[s.createVNode(O,{content:a.message.replyMessage.content,users:a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,reply:!0},s.createSlots({_:2},[s.renderList(e.$slots,(g,N)=>({name:N,fn:s.withCtx(u=>[s.renderSlot(e.$slots,N,s.normalizeProps(s.guardReactiveProps(u)))])}))]),1032,["content","users","text-formatting","link-options"])])])}var Jh=Fe(Dh,[["render",$h]]);const e_={name:"ProgressBar",props:{progress:{type:Number,default:0}},data(){const o=54*Math.PI;return{radius:35,stroke:4,normalizedRadius:27,circumference:o}},computed:{strokeDashoffset(){return this.circumference-this.progress/100*this.circumference}}},t_={ref:"progress",class:"vac-progress-wrapper"},a_=["height","width"],s_=["stroke-dasharray","stroke-width","r","cx","cy"],r_={class:"vac-progress-text"},n_=s.createElementVNode("span",{class:"vac-progress-pourcent"},"%",-1);function o_(e,t,a,o,m,n){return s.openBlock(),s.createBlock(s.Transition,{name:"vac-fade-spinner",appear:""},{default:s.withCtx(()=>[s.createElementVNode("div",t_,[(s.openBlock(),s.createElementBlock("svg",{height:m.radius*2,width:m.radius*2},[s.createElementVNode("circle",{stroke:"rgba(255, 255, 255, 0.7)","stroke-dasharray":m.circumference+" "+m.circumference,style:s.normalizeStyle({strokeDashoffset:n.strokeDashoffset,strokeLinecap:"round"}),"stroke-width":m.stroke,fill:"transparent",r:m.normalizedRadius,cx:m.radius,cy:m.radius},null,12,s_)],8,a_)),s.createElementVNode("div",{class:"vac-progress-content",style:s.normalizeStyle({height:m.radius*2-19+"px",width:m.radius*2-19+"px"})},[s.createElementVNode("div",r_,[s.createTextVNode(s.toDisplayString(a.progress),1),n_])],4)],512)]),_:1})}var u0=Fe(e_,[["render",o_]]);const i_={name:"MessageFile",components:{SvgIcon:gt,Loader:Zs,ProgressBar:u0},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},file:{type:Object,required:!0},index:{type:Number,required:!0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["open-file"],data(){return{imageResponsive:"",imageLoading:!1,imageHover:!1}},computed:{isImageLoading(){return this.file.url.indexOf("blob:http")!==-1||this.imageLoading},isImage(){return $a(this.file)},isVideo(){return Bs(this.file)}},watch:{file:{immediate:!0,handler(){this.checkImgLoad()}}},mounted(){const e=this.$refs["imageRef"+this.index];e&&(this.imageResponsive={maxHeight:e.clientWidth-18,loaderTop:e.clientHeight/2-9})},methods:{checkImgLoad(){if(!$a(this.file))return;this.imageLoading=!0;const e=new Image;e.src=this.file.url,e.addEventListener("load",()=>this.imageLoading=!1)},openFile(e,t){this.messageSelectionEnabled||(e.stopPropagation(),this.$emit("open-file",{file:this.file,action:t}))}}},l_={class:"vac-message-file-container"},c_={key:0,class:"vac-image-buttons"},d_={width:"100%",height:"100%",controls:""},m_=["src"];function h_(e,t,a,o,m,n){const M=s.resolveComponent("progress-bar"),T=s.resolveComponent("loader"),O=s.resolveComponent("svg-icon");return s.openBlock(),s.createElementBlock("div",l_,[n.isImage?(s.openBlock(),s.createElementBlock("div",{key:0,ref:"imageRef"+a.index,class:"vac-message-image-container",onMouseover:t[2]||(t[2]=g=>m.imageHover=!0),onMouseleave:t[3]||(t[3]=g=>m.imageHover=!1),onClick:t[4]||(t[4]=g=>n.openFile(g,"preview"))},[a.file.progress>=0?(s.openBlock(),s.createBlock(M,{key:0,progress:a.file.progress,style:s.normalizeStyle({top:`${m.imageResponsive.loaderTop}px`})},null,8,["progress","style"])):(s.openBlock(),s.createBlock(T,{key:1,show:n.isImageLoading,style:s.normalizeStyle({top:`${m.imageResponsive.loaderTop}px`})},s.createSlots({_:2},[s.renderList(e.$slots,(g,N)=>({name:N,fn:s.withCtx(u=>[s.renderSlot(e.$slots,N,s.normalizeProps(s.guardReactiveProps(u)))])}))]),1032,["show","style"])),s.createElementVNode("div",{class:s.normalizeClass(["vac-message-image",{"vac-blur-loading":n.isImageLoading&&a.message.senderId===a.currentUserId}]),style:s.normalizeStyle({"background-image":`url('${n.isImageLoading&&a.file.preview||a.file.url}')`,"max-height":`${m.imageResponsive.maxHeight}px`})},[s.createVNode(s.Transition,{name:"vac-fade-image"},{default:s.withCtx(()=>[!a.messageSelectionEnabled&&m.imageHover&&!n.isImageLoading?(s.openBlock(),s.createElementBlock("div",c_,[s.createElementVNode("div",{class:"vac-svg-button vac-button-view",onClick:t[0]||(t[0]=g=>n.openFile(g,"preview"))},[s.renderSlot(e.$slots,"eye-icon",{},()=>[s.createVNode(O,{name:"eye"})])]),s.createElementVNode("div",{class:"vac-svg-button vac-button-download",onClick:t[1]||(t[1]=g=>n.openFile(g,"download"))},[s.renderSlot(e.$slots,"document-icon",{},()=>[s.createVNode(O,{name:"document"})])])])):s.createCommentVNode("",!0)]),_:3})],6)],544)):n.isVideo?(s.openBlock(),s.createElementBlock("div",{key:1,class:"vac-video-container",onClick:t[5]||(t[5]=s.withModifiers(g=>n.openFile("preview"),["prevent"]))},[a.file.progress>=0?(s.openBlock(),s.createBlock(M,{key:0,progress:a.file.progress},null,8,["progress"])):s.createCommentVNode("",!0),s.createElementVNode("video",d_,[s.createElementVNode("source",{src:a.file.url},null,8,m_)])])):s.createCommentVNode("",!0)])}var __=Fe(i_,[["render",h_]]);const u_={name:"MessageFiles",components:{SvgIcon:gt,FormatMessage:Ts,ProgressBar:u0,MessageFile:__},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},roomUsers:{type:Array,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["open-file","open-user-tag"],computed:{imageVideoFiles(){return this.message.files.filter(e=>ko(e))},otherFiles(){return this.message.files.filter(e=>!ko(e))}},methods:{openFile(e,t,a){this.messageSelectionEnabled||(e.stopPropagation(),this.$emit("open-file",{file:t,action:a}))}}},f_={class:"vac-message-files-container"},v_=["onClick"],g_={class:"vac-svg-button"},p_={class:"vac-text-ellipsis"},b_={key:0,class:"vac-text-ellipsis vac-text-extension"};function y_(e,t,a,o,m,n){const M=s.resolveComponent("message-file"),T=s.resolveComponent("progress-bar"),O=s.resolveComponent("svg-icon"),g=s.resolveComponent("format-message");return s.openBlock(),s.createElementBlock("div",f_,[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(n.imageVideoFiles,(N,u)=>(s.openBlock(),s.createElementBlock("div",{key:u+"iv"},[s.createVNode(M,{file:N,"current-user-id":a.currentUserId,message:a.message,index:u,"message-selection-enabled":a.messageSelectionEnabled,onOpenFile:t[0]||(t[0]=y=>e.$emit("open-file",y))},s.createSlots({_:2},[s.renderList(e.$slots,(y,k)=>({name:k,fn:s.withCtx(r=>[s.renderSlot(e.$slots,k,s.normalizeProps(s.guardReactiveProps(r)))])}))]),1032,["file","current-user-id","message","index","message-selection-enabled"])]))),128)),(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(n.otherFiles,(N,u)=>(s.openBlock(),s.createElementBlock("div",{key:u+"a",class:"vac-file-wrapper"},[N.progress>=0?(s.openBlock(),s.createBlock(T,{key:0,progress:N.progress,style:{top:"44px"}},null,8,["progress"])):s.createCommentVNode("",!0),s.createElementVNode("div",{class:s.normalizeClass(["vac-file-container",{"vac-file-container-progress":N.progress>=0}]),onClick:y=>n.openFile(y,N,"download")},[s.createElementVNode("div",g_,[s.renderSlot(e.$slots,"document-icon",{},()=>[s.createVNode(O,{name:"document"})])]),s.createElementVNode("div",p_,s.toDisplayString(N.name),1),N.extension?(s.openBlock(),s.createElementBlock("div",b_,s.toDisplayString(N.extension),1)):s.createCommentVNode("",!0)],10,v_)]))),128)),s.createVNode(g,{content:a.message.content,users:a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onOpenUserTag:t[1]||(t[1]=N=>e.$emit("open-user-tag",N))},s.createSlots({_:2},[s.renderList(e.$slots,(N,u)=>({name:u,fn:s.withCtx(y=>[s.renderSlot(e.$slots,u,s.normalizeProps(s.guardReactiveProps(y)))])}))]),1032,["content","users","text-formatting","link-options"])])}var S_=Fe(u_,[["render",y_]]);const E_={name:"MessageActions",components:{SvgIcon:gt,EmojiPickerContainer:gi},directives:{clickOutside:nr},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},messageActions:{type:Array,required:!0},showReactionEmojis:{type:Boolean,required:!0},messageHover:{type:Boolean,required:!0},hoverMessageId:{type:[String,Number],default:null},hoverAudioProgress:{type:Boolean,required:!0}},emits:["update-emoji-opened","update-options-opened","update-message-hover","message-action-handler","send-message-reaction"],data(){return{menuOptionsTop:0,optionsOpened:!1,optionsClosing:!1,emojiOpened:!1}},computed:{isMessageActions(){return this.filteredMessageActions.length&&this.messageHover&&!this.message.deleted&&!this.message.disableActions&&!this.hoverAudioProgress},isMessageReactions(){return this.showReactionEmojis&&this.messageHover&&!this.message.deleted&&!this.message.disableReactions&&!this.hoverAudioProgress},filteredMessageActions(){return this.message.senderId===this.currentUserId?this.messageActions:this.messageActions.filter(e=>!e.onlyMe)}},watch:{emojiOpened(e){this.$emit("update-emoji-opened",e),e&&(this.optionsOpened=!1)},optionsOpened(e){this.$emit("update-options-opened",e)}},methods:{openOptions(){this.optionsClosing||(this.optionsOpened=!this.optionsOpened,this.optionsOpened&&setTimeout(()=>{const e=document.getElementById("room-footer");if(!e||!this.$refs.menuOptions||!this.$refs.actionIcon)return;const t=this.$refs.menuOptions.getBoundingClientRect().height,a=this.$refs.actionIcon.getBoundingClientRect().top;e.getBoundingClientRect().top-a>t+50?this.menuOptionsTop=30:this.menuOptionsTop=-t}))},closeOptions(){this.optionsOpened=!1,this.optionsClosing=!0,this.updateMessageHover(),setTimeout(()=>this.optionsClosing=!1,100)},openEmoji(){this.emojiOpened=!this.emojiOpened},closeEmoji(){this.emojiOpened=!1,this.updateMessageHover()},updateMessageHover(){this.hoverMessageId!==this.message._id&&this.$emit("update-message-hover",!1)},messageActionHandler(e){this.closeOptions(),this.$emit("message-action-handler",e)},sendMessageReaction(e,t){this.$emit("send-message-reaction",{emoji:e,reaction:t}),this.closeEmoji()}}},k_={class:"vac-message-actions-wrapper"},M_={key:"3"},w_={class:"vac-menu-list"},R_=["onClick"];function A_(e,t,a,o,m,n){const M=s.resolveComponent("svg-icon"),T=s.resolveComponent("emoji-picker-container"),O=s.resolveDirective("click-outside");return s.openBlock(),s.createElementBlock("div",k_,[s.createElementVNode("div",{class:"vac-options-container",style:s.normalizeStyle({display:a.hoverAudioProgress?"none":"initial",width:n.filteredMessageActions.length&&a.showReactionEmojis?"70px":"45px"})},[s.createVNode(s.TransitionGroup,{name:"vac-slide-left",tag:"span"},{default:s.withCtx(()=>[n.isMessageActions||n.isMessageReactions?(s.openBlock(),s.createElementBlock("div",{key:"1",class:s.normalizeClass(["vac-blur-container",{"vac-options-me":a.message.senderId===a.currentUserId}])},null,2)):s.createCommentVNode("",!0),n.isMessageActions?(s.openBlock(),s.createElementBlock("div",{ref:"actionIcon",key:"2",class:"vac-svg-button vac-message-options",onClick:t[0]||(t[0]=(...g)=>n.openOptions&&n.openOptions(...g))},[s.renderSlot(e.$slots,"dropdown-icon",{},()=>[s.createVNode(M,{name:"dropdown",param:"message"})])],512)):s.createCommentVNode("",!0),n.isMessageReactions?s.withDirectives((s.openBlock(),s.createElementBlock("div",M_,[s.renderSlot(e.$slots,"emoji-picker",s.mergeProps({emojiOpened:m.emojiOpened},{addEmoji:n.sendMessageReaction}),()=>[s.createVNode(T,{class:"vac-message-emojis",style:s.normalizeStyle({right:n.isMessageActions?"30px":"5px"}),"emoji-opened":m.emojiOpened,"emoji-reaction":!0,"position-right":a.message.senderId===a.currentUserId,onAddEmoji:n.sendMessageReaction,onOpenEmoji:n.openEmoji},{"emoji-picker-icon":s.withCtx(()=>[s.renderSlot(e.$slots,"emoji-picker-reaction-icon")]),_:3},8,["style","emoji-opened","position-right","onAddEmoji","onOpenEmoji"])])])),[[O,n.closeEmoji]]):s.createCommentVNode("",!0)]),_:3})],4),n.filteredMessageActions.length?(s.openBlock(),s.createBlock(s.Transition,{key:0,name:a.message.senderId===a.currentUserId?"vac-slide-left":"vac-slide-right"},{default:s.withCtx(()=>[m.optionsOpened?s.withDirectives((s.openBlock(),s.createElementBlock("div",{key:0,ref:"menuOptions",class:s.normalizeClass(["vac-menu-options",{"vac-menu-left":a.message.senderId!==a.currentUserId}]),style:s.normalizeStyle({top:`${m.menuOptionsTop}px`})},[s.createElementVNode("div",w_,[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(n.filteredMessageActions,g=>(s.openBlock(),s.createElementBlock("div",{key:g.name},[s.createElementVNode("div",{class:"vac-menu-item",onClick:N=>n.messageActionHandler(g)},s.toDisplayString(g.title),9,R_)]))),128))])],6)),[[O,n.closeOptions]]):s.createCommentVNode("",!0)]),_:1},8,["name"])):s.createCommentVNode("",!0)])}var T_=Fe(E_,[["render",A_]]);const x_={name:"MessageReactions",props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0}},emits:["send-message-reaction"],methods:{sendMessageReaction(e,t){this.$emit("send-message-reaction",{emoji:e,reaction:t})}}},B_=["onClick"];function C_(e,t,a,o,m,n){return a.message.deleted?s.createCommentVNode("",!0):(s.openBlock(),s.createBlock(s.TransitionGroup,{key:0,name:"vac-slide-left",tag:"span"},{default:s.withCtx(()=>[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(a.message.reactions,(M,T)=>s.withDirectives((s.openBlock(),s.createElementBlock("button",{key:T+0,class:s.normalizeClass(["vac-button-reaction",{"vac-reaction-me":M.indexOf(a.currentUserId)!==-1}]),style:s.normalizeStyle({float:a.message.senderId===a.currentUserId?"right":"left"}),onClick:O=>n.sendMessageReaction({unicode:T},M)},[s.createTextVNode(s.toDisplayString(T),1),s.createElementVNode("span",null,s.toDisplayString(M.length),1)],14,B_)),[[s.vShow,M.length]])),128))]),_:1}))}var O_=Fe(x_,[["render",C_]]);function L_(e){if(!((o,m)=>m.every(n=>{let M=!1;return(n.type[0]==="array"&&Array.isArray(o[n.key])||n.type.find(T=>T===typeof o[n.key]))&&(M=!0),M&&jn(o,n.key)}))(e,[{key:"roomId",type:["string","number"]},{key:"roomName",type:["string"]},{key:"users",type:["array"]}]))throw new Error("Rooms object is not valid! Must contain roomId[String, Number], roomName[String] and users[Array]")}function N_(e){if(!((o,m)=>m.every(n=>n.type.find(T=>T===typeof o[n.key])&&jn(o,n.key)))(e,[{key:"_id",type:["string","number"]},{key:"username",type:["string"]}]))throw new Error("Participants object is not valid! Must contain _id[String, Number] and username[String]")}function I_(e){if(!((o,m)=>m.every(n=>n.type.find(T=>T===typeof o[n.key])&&jn(o,n.key)))(e,[{key:"_id",type:["string","number"]},{key:"content",type:["string","number"]},{key:"senderId",type:["string","number"]}]))throw new Error("Messages object is not valid! Must contain _id[String, Number], content[String, Number] and senderId[String, Number]")}function jn(e,t){return Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==null&&e[t]!==void 0}const V_={name:"RoomMessage",components:{SvgIcon:gt,FormatMessage:Ts,AudioPlayer:bn,MessageReply:Jh,MessageFiles:S_,MessageActions:T_,MessageReactions:O_},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},index:{type:Number,required:!0},message:{type:Object,required:!0},messages:{type:Array,required:!0},editedMessageId:{type:[String,Number],default:null},roomUsers:{type:Array,default:()=>[]},messageActions:{type:Array,required:!0},newMessages:{type:Array,default:()=>[]},showReactionEmojis:{type:Boolean,required:!0},showNewMessagesDivider:{type:Boolean,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},usernameOptions:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0},selectedMessages:{type:Array,default:()=>[]}},emits:["message-added","open-file","open-user-tag","open-failed-message","message-action-handler","send-message-reaction","select-message","unselect-message"],data(){return{hoverMessageId:null,messageHover:!1,optionsOpened:!1,emojiOpened:!1,newMessage:{},progressTime:"- : -",hoverAudioProgress:!1}},computed:{showUsername(){return!this.usernameOptions.currentUser&&this.message.senderId===this.currentUserId?!1:this.roomUsers.length>=this.usernameOptions.minUsers},showDate(){return this.index>0&&this.message.date!==this.messages[this.index-1].date},messageOffset(){return this.index>0&&this.message.senderId!==this.messages[this.index-1].senderId},isMessageHover(){return this.editedMessageId===this.message._id||this.hoverMessageId===this.message._id},isAudio(){var e;return(e=this.message.files)==null?void 0:e.some(t=>or(t))},isCheckmarkVisible(){return this.message.senderId===this.currentUserId&&!this.message.deleted&&(this.message.saved||this.message.distributed||this.message.seen)},hasCurrentUserAvatar(){return this.messages.some(e=>e.senderId===this.currentUserId&&e.avatar)},hasSenderUserAvatar(){return this.messages.some(e=>e.senderId!==this.currentUserId&&e.avatar)},isMessageSelected(){return this.messageSelectionEnabled&&!!this.selectedMessages.find(e=>e._id===this.message._id)}},watch:{newMessages:{immediate:!0,deep:!0,handler(e){if(!e.length||!this.showNewMessagesDivider){this.newMessage={};return}this.newMessage=e.reduce((t,a)=>a.index<t.index?a:t)}},messageSelectionEnabled(){this.resetMessageHover()}},mounted(){I_(this.message),this.$emit("message-added",{message:this.message,index:this.index,ref:this.$refs.message})},methods:{onHoverMessage(){this.messageSelectionEnabled||(this.messageHover=!0,this.canEditMessage()&&(this.hoverMessageId=this.message._id))},canEditMessage(){return!this.message.deleted},onLeaveMessage(){this.messageSelectionEnabled||(!this.optionsOpened&&!this.emojiOpened&&(this.messageHover=!1),this.hoverMessageId=null)},resetMessageHover(){this.messageHover=!1,this.hoverMessageId=null},openFile(e){this.$emit("open-file",{message:this.message,file:e})},openUserTag(e){this.$emit("open-user-tag",{user:e})},messageActionHandler(e){this.resetMessageHover(),setTimeout(()=>{this.$emit("message-action-handler",{action:e,message:this.message})},300)},sendMessageReaction({emoji:e,reaction:t}){this.$emit("send-message-reaction",{messageId:this.message._id,reaction:e,remove:t&&t.indexOf(this.currentUserId)!==-1}),this.messageHover=!1},selectMessage(){this.messageSelectionEnabled&&(this.isMessageSelected?this.$emit("unselect-message",this.message._id):this.$emit("select-message",this.message))}}},j_=["id"],H_={key:0,class:"vac-card-info vac-card-date"},P_={key:1,class:"vac-line-new"},F_={key:2,class:"vac-card-info vac-card-system"},D_={key:1,class:"vac-avatar-offset"},U_={key:2},q_={key:0,class:"vac-progress-time"},z_={class:"vac-text-timestamp"},X_={key:0,class:"vac-icon-edited"},Y_={key:1},G_=[s.createElementVNode("div",{class:"vac-failure-text"}," ! ",-1)],K_={key:3,class:"vac-avatar-current-offset"};function Z_(e,t,a,o,m,n){const M=s.resolveComponent("format-message"),T=s.resolveComponent("message-reply"),O=s.resolveComponent("svg-icon"),g=s.resolveComponent("message-files"),N=s.resolveComponent("audio-player"),u=s.resolveComponent("message-actions"),y=s.resolveComponent("message-reactions");return s.openBlock(),s.createElementBlock("div",{id:a.message._id,ref:"message",class:"vac-message-wrapper"},[n.showDate?(s.openBlock(),s.createElementBlock("div",H_,s.toDisplayString(a.message.date),1)):s.createCommentVNode("",!0),m.newMessage._id===a.message._id?(s.openBlock(),s.createElementBlock("div",P_,s.toDisplayString(a.textMessages.NEW_MESSAGES),1)):s.createCommentVNode("",!0),a.message.system?(s.openBlock(),s.createElementBlock("div",F_,[s.renderSlot(e.$slots,"system-message",s.normalizeProps(s.guardReactiveProps({message:a.message})),()=>[s.createVNode(M,{content:a.message.content,users:a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onOpenUserTag:n.openUserTag},s.createSlots({_:2},[s.renderList(e.$slots,(k,r)=>({name:r,fn:s.withCtx(H=>[s.renderSlot(e.$slots,r,s.normalizeProps(s.guardReactiveProps(H)))])}))]),1032,["content","users","text-formatting","link-options","onOpenUserTag"])])])):(s.openBlock(),s.createElementBlock("div",{key:3,class:s.normalizeClass(["vac-message-box",{"vac-offset-current":a.message.senderId===a.currentUserId}]),onClick:t[8]||(t[8]=(...k)=>n.selectMessage&&n.selectMessage(...k))},[s.renderSlot(e.$slots,"message",s.normalizeProps(s.guardReactiveProps({message:a.message})),()=>[a.message.avatar&&a.message.senderId!==a.currentUserId?(s.openBlock(),s.createElementBlock("div",{key:0,class:"vac-avatar",style:s.normalizeStyle({"background-image":`url('${a.message.avatar}')`})},null,4)):s.createCommentVNode("",!0),n.hasSenderUserAvatar&&!a.message.avatar?(s.openBlock(),s.createElementBlock("div",D_)):s.createCommentVNode("",!0),s.createElementVNode("div",{class:s.normalizeClass(["vac-message-container",{"vac-message-container-offset":n.messageOffset}])},[s.createElementVNode("div",{class:s.normalizeClass(["vac-message-card",{"vac-message-highlight":n.isMessageHover,"vac-message-current":a.message.senderId===a.currentUserId,"vac-message-deleted":a.message.deleted,"vac-item-clickable":a.messageSelectionEnabled,"vac-message-selected":n.isMessageSelected}]),onMouseover:t[5]||(t[5]=(...k)=>n.onHoverMessage&&n.onHoverMessage(...k)),onMouseleave:t[6]||(t[6]=(...k)=>n.onLeaveMessage&&n.onLeaveMessage(...k))},[n.showUsername?(s.openBlock(),s.createElementBlock("div",{key:0,class:s.normalizeClass(["vac-text-username",{"vac-username-reply":!a.message.deleted&&a.message.replyMessage}])},[s.createElementVNode("span",null,s.toDisplayString(a.message.username),1)],2)):s.createCommentVNode("",!0),!a.message.deleted&&a.message.replyMessage?(s.openBlock(),s.createBlock(T,{key:1,message:a.message,"room-users":a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions},s.createSlots({_:2},[s.renderList(e.$slots,(k,r)=>({name:r,fn:s.withCtx(H=>[s.renderSlot(e.$slots,r,s.normalizeProps(s.guardReactiveProps(H)))])}))]),1032,["message","room-users","text-formatting","link-options"])):s.createCommentVNode("",!0),a.message.deleted?(s.openBlock(),s.createElementBlock("div",U_,[s.renderSlot(e.$slots,"deleted-icon",{},()=>[s.createVNode(O,{name:"deleted",class:"vac-icon-deleted"})]),s.createElementVNode("span",null,s.toDisplayString(a.textMessages.MESSAGE_DELETED),1)])):!a.message.files||!a.message.files.length?(s.openBlock(),s.createBlock(M,{key:3,content:a.message.content,users:a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onOpenUserTag:n.openUserTag},s.createSlots({_:2},[s.renderList(e.$slots,(k,r)=>({name:r,fn:s.withCtx(H=>[s.renderSlot(e.$slots,r,s.normalizeProps(s.guardReactiveProps(H)))])}))]),1032,["content","users","text-formatting","link-options","onOpenUserTag"])):!n.isAudio||a.message.files.length>1?(s.openBlock(),s.createBlock(g,{key:4,"current-user-id":a.currentUserId,message:a.message,"room-users":a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"message-selection-enabled":a.messageSelectionEnabled,onOpenFile:n.openFile,onOpenUserTag:n.openUserTag},s.createSlots({_:2},[s.renderList(e.$slots,(k,r)=>({name:r,fn:s.withCtx(H=>[s.renderSlot(e.$slots,r,s.normalizeProps(s.guardReactiveProps(H)))])}))]),1032,["current-user-id","message","room-users","text-formatting","link-options","message-selection-enabled","onOpenFile","onOpenUserTag"])):(s.openBlock(),s.createElementBlock(s.Fragment,{key:5},[s.createVNode(N,{"message-id":a.message._id,src:a.message.files[0].url,"message-selection-enabled":a.messageSelectionEnabled,onUpdateProgressTime:t[0]||(t[0]=k=>m.progressTime=k),onHoverAudioProgress:t[1]||(t[1]=k=>m.hoverAudioProgress=k)},s.createSlots({_:2},[s.renderList(e.$slots,(k,r)=>({name:r,fn:s.withCtx(H=>[s.renderSlot(e.$slots,r,s.normalizeProps(s.guardReactiveProps(H)))])}))]),1032,["message-id","src","message-selection-enabled"]),a.message.deleted?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",q_,s.toDisplayString(m.progressTime),1))],64)),s.createElementVNode("div",z_,[a.message.edited&&!a.message.deleted?(s.openBlock(),s.createElementBlock("div",X_,[s.renderSlot(e.$slots,"pencil-icon",{},()=>[s.createVNode(O,{name:"pencil"})])])):s.createCommentVNode("",!0),s.createElementVNode("span",null,s.toDisplayString(a.message.timestamp),1),n.isCheckmarkVisible?(s.openBlock(),s.createElementBlock("span",Y_,[s.renderSlot(e.$slots,"checkmark-icon",s.normalizeProps(s.guardReactiveProps({message:a.message})),()=>[s.createVNode(O,{name:a.message.distributed?"double-checkmark":"checkmark",param:a.message.seen?"seen":"",class:"vac-icon-check"},null,8,["name","param"])])])):s.createCommentVNode("",!0)]),s.createVNode(u,{"current-user-id":a.currentUserId,message:a.message,"message-actions":a.messageActions,"show-reaction-emojis":a.showReactionEmojis,"message-hover":m.messageHover,"hover-message-id":m.hoverMessageId,"hover-audio-progress":m.hoverAudioProgress,onUpdateMessageHover:t[2]||(t[2]=k=>m.messageHover=k),onUpdateOptionsOpened:t[3]||(t[3]=k=>m.optionsOpened=k),onUpdateEmojiOpened:t[4]||(t[4]=k=>m.emojiOpened=k),onMessageActionHandler:n.messageActionHandler,onSendMessageReaction:n.sendMessageReaction},s.createSlots({_:2},[s.renderList(e.$slots,(k,r)=>({name:r,fn:s.withCtx(H=>[s.renderSlot(e.$slots,r,s.normalizeProps(s.guardReactiveProps(H)))])}))]),1032,["current-user-id","message","message-actions","show-reaction-emojis","message-hover","hover-message-id","hover-audio-progress","onMessageActionHandler","onSendMessageReaction"])],34),s.createVNode(y,{"current-user-id":a.currentUserId,message:a.message,onSendMessageReaction:n.sendMessageReaction},null,8,["current-user-id","message","onSendMessageReaction"])],2),s.renderSlot(e.$slots,"message-failure",s.normalizeProps(s.guardReactiveProps({message:a.message})),()=>[a.message.failure&&a.message.senderId===a.currentUserId?(s.openBlock(),s.createElementBlock("div",{key:0,class:s.normalizeClass(["vac-failure-container vac-svg-button",{"vac-failure-container-avatar":a.message.avatar&&a.message.senderId===a.currentUserId}]),onClick:t[7]||(t[7]=k=>e.$emit("open-failed-message",{message:a.message}))},G_,2)):s.createCommentVNode("",!0)]),a.message.avatar&&a.message.senderId===a.currentUserId?(s.openBlock(),s.createElementBlock("div",{key:2,class:"vac-avatar vac-avatar-current",style:s.normalizeStyle({"background-image":`url('${a.message.avatar}')`})},null,4)):s.createCommentVNode("",!0),n.hasCurrentUserAvatar&&!a.message.avatar?(s.openBlock(),s.createElementBlock("div",K_)):s.createCommentVNode("",!0)])],2))],8,j_)}var W_=Fe(V_,[["render",Z_]]);const Q_={name:"ChatRoom",components:{Loader:Zs,SvgIcon:gt,RoomHeader:z1,RoomFooter:Fh,RoomMessage:W_},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},singleRoom:{type:Boolean,required:!0},showRoomsList:{type:Boolean,required:!0},isMobile:{type:Boolean,required:!0},rooms:{type:Array,required:!0},roomId:{type:[String,Number],required:!0},loadFirstRoom:{type:Boolean,required:!0},messages:{type:Array,required:!0},roomMessage:{type:String,default:null},messagesLoaded:{type:Boolean,required:!0},menuActions:{type:Array,required:!0},messageActions:{type:Array,required:!0},messageSelectionActions:{type:Array,required:!0},autoScroll:{type:Object,required:!0},showSendIcon:{type:Boolean,required:!0},showFiles:{type:Boolean,required:!0},showAudio:{type:Boolean,required:!0},audioBitRate:{type:Number,required:!0},audioSampleRate:{type:Number,required:!0},showEmojis:{type:Boolean,required:!0},showReactionEmojis:{type:Boolean,required:!0},showNewMessagesDivider:{type:Boolean,required:!0},showFooter:{type:Boolean,required:!0},acceptedFiles:{type:String,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},loadingRooms:{type:Boolean,required:!0},roomInfoEnabled:{type:Boolean,required:!0},textareaActionEnabled:{type:Boolean,required:!0},textareaAutoFocus:{type:Boolean,required:!0},userTagsEnabled:{type:Boolean,required:!0},emojisSuggestionEnabled:{type:Boolean,required:!0},scrollDistance:{type:Number,required:!0},templatesText:{type:Array,default:null},usernameOptions:{type:Object,required:!0}},emits:["toggle-rooms-list","room-info","menu-action-handler","message-selection-action-handler","edit-message","send-message","delete-message","message-action-handler","fetch-messages","send-message-reaction","typing-message","open-file","open-user-tag","open-failed-message","textarea-action-handler"],data(){return{editedMessageId:null,initReplyMessage:null,initEditMessage:null,infiniteState:null,loadingMessages:!1,observer:null,showLoader:!0,loadingMoreMessages:!1,scrollIcon:!1,scrollMessagesCount:0,newMessages:[],messageSelectionEnabled:!1,selectedMessages:[]}},computed:{room(){return this.rooms.find(e=>e.roomId===this.roomId)||{}},showNoMessages(){return this.roomId&&!this.messages.length&&!this.loadingMessages&&!this.loadingRooms},showNoRoom(){const e=!this.rooms.length&&!this.loadingRooms||!this.roomId&&!this.loadFirstRoom;return e&&(this.loadingMessages=!1),e},showMessagesStarted(){return this.messages.length&&this.messagesLoaded}},watch:{loadingMessages(e){e?this.infiniteState=null:(this.infiniteState&&this.infiniteState.loaded(),setTimeout(()=>this.initIntersectionObserver()))},roomId(){this.onRoomChanged()},messages:{deep:!0,handler(e,t){e.forEach((a,o)=>{this.showNewMessagesDivider&&!a.seen&&a.senderId!==this.currentUserId&&this.newMessages.push({_id:a._id,index:o})}),(t==null?void 0:t.length)===(e==null?void 0:e.length)-1&&(this.newMessages=[]),this.infiniteState&&this.infiniteState.loaded(),setTimeout(()=>this.loadingMoreMessages=!1)}},messagesLoaded(e){e&&(this.loadingMessages=!1),this.infiniteState&&this.infiniteState.complete()}},mounted(){this.newMessages=[]},methods:{initIntersectionObserver(){this.observer&&(this.showLoader=!0,this.observer.disconnect());const e=document.getElementById("infinite-loader-messages");if(e){const t={root:document.getElementById("messages-list"),rootMargin:`${this.scrollDistance}px`,threshold:0};this.observer=new IntersectionObserver(a=>{a[0].isIntersecting&&this.loadMoreMessages()},t),this.observer.observe(e)}},preventTopScroll(){const e=this.$refs.scrollContainer,t=e.scrollHeight,a=new ResizeObserver(m=>{e.scrollHeight!==t&&this.$refs.scrollContainer&&(this.$refs.scrollContainer.scrollTo({top:e.scrollHeight-t}),a.disconnect())});for(var o=0;o<e.children.length;o++)a.observe(e.children[o])},touchStart(e){if(!this.singleRoom&&e.changedTouches.length===1){const t=e.changedTouches[0].clientX,a=e.changedTouches[0].clientY;addEventListener("touchend",o=>this.touchEnd(o,t,a),{once:!0})}},touchEnd(e,t,a){if(e.changedTouches.length===1){const o=e.changedTouches[0].clientX,m=e.changedTouches[0].clientY,n=o-t>100,M=Math.abs(m-a)>50;n&&!M&&this.$emit("toggle-rooms-list")}},onRoomChanged(){this.loadingMessages=!0,this.scrollIcon=!1,this.scrollMessagesCount=0,this.resetMessageSelection(),!this.messages.length&&this.messagesLoaded&&(this.loadingMessages=!1);const e=this.$watch(()=>this.messages,t=>{if(!t||!t.length)return;const a=this.$refs.scrollContainer;!a||(e(),setTimeout(()=>{a.scrollTo({top:a.scrollHeight}),this.loadingMessages=!1}))})},resetMessageSelection(){this.messageSelectionEnabled=!1,this.selectedMessages=[]},selectMessage(e){this.selectedMessages.push(e)},unselectMessage(e){this.selectedMessages=this.selectedMessages.filter(t=>t._id!==e)},onMessageAdded({message:e,index:t,ref:a}){if(t!==this.messages.length-1)return;const o=a.offsetHeight+60;setTimeout(()=>{const m=this.getBottomScroll(this.$refs.scrollContainer)>o;e.senderId===this.currentUserId?m?this.autoScroll.send.newAfterScrollUp&&this.scrollToBottom():this.autoScroll.send.new&&this.scrollToBottom():m?this.autoScroll.receive.newAfterScrollUp?this.scrollToBottom():(this.scrollIcon=!0,this.scrollMessagesCount++):this.autoScroll.receive.new?this.scrollToBottom():(this.scrollIcon=!0,this.scrollMessagesCount++)})},onContainerScroll(e){if(!e.target)return;const t=this.getBottomScroll(e.target);t<60&&(this.scrollMessagesCount=0),this.scrollIcon=t>500||this.scrollMessagesCount},loadMoreMessages(){this.loadingMessages||setTimeout(()=>{if(!this.loadingMoreMessages){if(this.messagesLoaded||!this.roomId){this.loadingMoreMessages=!1,this.showLoader=!1;return}this.preventTopScroll(),this.$emit("fetch-messages"),this.loadingMoreMessages=!0}},500)},messageActionHandler({action:e,message:t}){switch(e.name){case"replyMessage":this.initReplyMessage=t;return;case"editMessage":this.initEditMessage=t;return;case"deleteMessage":return this.$emit("delete-message",t);case"selectMessages":this.selectedMessages=[t],this.messageSelectionEnabled=!0;return;default:return this.$emit("message-action-handler",{action:e,message:t})}},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",{action:e,messages:this.selectedMessages}),this.resetMessageSelection()},sendMessageReaction(e){this.$emit("send-message-reaction",e)},getBottomScroll(e){const{scrollHeight:t,clientHeight:a,scrollTop:o}=e;return t-a-o},scrollToBottom(){setTimeout(()=>{const e=this.$refs.scrollContainer;e.classList.add("vac-scroll-smooth"),e.scrollTo({top:e.scrollHeight,behavior:"smooth"}),setTimeout(()=>e.classList.remove("vac-scroll-smooth"))},50)},openFile({message:e,file:t}){this.$emit("open-file",{message:e,file:t})},openUserTag(e){this.$emit("open-user-tag",e)}}},$_={class:"vac-container-center vac-room-empty"},J_={class:"vac-messages-container"},eu={key:0,class:"vac-text-started"},tu={key:1,class:"vac-text-started"},au={key:0,id:"infinite-loader-messages"},su={key:2},ru={key:0,class:"vac-badge-counter vac-messages-count"};function nu(e,t,a,o,m,n){const M=s.resolveComponent("room-header"),T=s.resolveComponent("loader"),O=s.resolveComponent("room-message"),g=s.resolveComponent("svg-icon"),N=s.resolveComponent("room-footer");return s.withDirectives((s.openBlock(),s.createElementBlock("div",{class:"vac-col-messages",onTouchstart:t[12]||(t[12]=(...u)=>n.touchStart&&n.touchStart(...u))},[n.showNoRoom?s.renderSlot(e.$slots,"no-room-selected",{key:0},()=>[s.createElementVNode("div",$_,[s.createElementVNode("div",null,s.toDisplayString(a.textMessages.ROOM_EMPTY),1)])]):(s.openBlock(),s.createBlock(M,{key:1,"current-user-id":a.currentUserId,"text-messages":a.textMessages,"single-room":a.singleRoom,"show-rooms-list":a.showRoomsList,"is-mobile":a.isMobile,"room-info-enabled":a.roomInfoEnabled,"menu-actions":a.menuActions,room:n.room,"message-selection-enabled":m.messageSelectionEnabled,"message-selection-actions":a.messageSelectionActions,"selected-messages-total":m.selectedMessages.length,onToggleRoomsList:t[0]||(t[0]=u=>e.$emit("toggle-rooms-list")),onRoomInfo:t[1]||(t[1]=u=>e.$emit("room-info")),onMenuActionHandler:t[2]||(t[2]=u=>e.$emit("menu-action-handler",u)),onMessageSelectionActionHandler:n.messageSelectionActionHandler,onCancelMessageSelection:t[3]||(t[3]=u=>m.messageSelectionEnabled=!1)},s.createSlots({_:2},[s.renderList(e.$slots,(u,y)=>({name:y,fn:s.withCtx(k=>[s.renderSlot(e.$slots,y,s.normalizeProps(s.guardReactiveProps(k)))])}))]),1032,["current-user-id","text-messages","single-room","show-rooms-list","is-mobile","room-info-enabled","menu-actions","room","message-selection-enabled","message-selection-actions","selected-messages-total","onMessageSelectionActionHandler"])),s.createElementVNode("div",{id:"messages-list",ref:"scrollContainer",class:"vac-container-scroll",onScroll:t[5]||(t[5]=(...u)=>n.onContainerScroll&&n.onContainerScroll(...u))},[s.createVNode(T,{show:m.loadingMessages},s.createSlots({_:2},[s.renderList(e.$slots,(u,y)=>({name:y,fn:s.withCtx(k=>[s.renderSlot(e.$slots,y,s.normalizeProps(s.guardReactiveProps(k)))])}))]),1032,["show"]),s.createElementVNode("div",J_,[s.createElementVNode("div",{class:s.normalizeClass({"vac-messages-hidden":m.loadingMessages})},[s.createVNode(s.Transition,{name:"vac-fade-message"},{default:s.withCtx(()=>[s.createElementVNode("div",null,[n.showNoMessages?(s.openBlock(),s.createElementBlock("div",eu,[s.renderSlot(e.$slots,"messages-empty",{},()=>[s.createTextVNode(s.toDisplayString(a.textMessages.MESSAGES_EMPTY),1)])])):s.createCommentVNode("",!0),n.showMessagesStarted?(s.openBlock(),s.createElementBlock("div",tu,s.toDisplayString(a.textMessages.CONVERSATION_STARTED)+" "+s.toDisplayString(a.messages[0].date),1)):s.createCommentVNode("",!0)])]),_:3}),a.messages.length&&!a.messagesLoaded?(s.openBlock(),s.createElementBlock("div",au,[s.createVNode(T,{show:!0,infinite:!0},s.createSlots({_:2},[s.renderList(e.$slots,(u,y)=>({name:y,fn:s.withCtx(k=>[s.renderSlot(e.$slots,y,s.normalizeProps(s.guardReactiveProps(k)))])}))]),1024)])):s.createCommentVNode("",!0),(s.openBlock(),s.createBlock(s.TransitionGroup,{key:a.roomId,name:"vac-fade-message",tag:"span"},{default:s.withCtx(()=>[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(a.messages,(u,y)=>(s.openBlock(),s.createElementBlock("div",{key:u.indexId||u._id},[s.createVNode(O,{"current-user-id":a.currentUserId,message:u,index:y,messages:a.messages,"edited-message-id":m.editedMessageId,"message-actions":a.messageActions,"room-users":n.room.users,"text-messages":a.textMessages,"new-messages":m.newMessages,"show-reaction-emojis":a.showReactionEmojis,"show-new-messages-divider":a.showNewMessagesDivider,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"username-options":a.usernameOptions,"message-selection-enabled":m.messageSelectionEnabled,"selected-messages":m.selectedMessages,onMessageAdded:n.onMessageAdded,onMessageActionHandler:n.messageActionHandler,onOpenFile:n.openFile,onOpenUserTag:n.openUserTag,onOpenFailedMessage:t[4]||(t[4]=k=>e.$emit("open-failed-message",k)),onSendMessageReaction:n.sendMessageReaction,onSelectMessage:n.selectMessage,onUnselectMessage:n.unselectMessage},s.createSlots({_:2},[s.renderList(e.$slots,(k,r)=>({name:r,fn:s.withCtx(H=>[s.renderSlot(e.$slots,r,s.normalizeProps(s.guardReactiveProps(H)))])}))]),1032,["current-user-id","message","index","messages","edited-message-id","message-actions","room-users","text-messages","new-messages","show-reaction-emojis","show-new-messages-divider","text-formatting","link-options","username-options","message-selection-enabled","selected-messages","onMessageAdded","onMessageActionHandler","onOpenFile","onOpenUserTag","onSendMessageReaction","onSelectMessage","onUnselectMessage"])]))),128))]),_:3}))],2)])],544),m.loadingMessages?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",su,[s.createVNode(s.Transition,{name:"vac-bounce"},{default:s.withCtx(()=>[m.scrollIcon?(s.openBlock(),s.createElementBlock("div",{key:0,class:"vac-icon-scroll",onClick:t[6]||(t[6]=(...u)=>n.scrollToBottom&&n.scrollToBottom(...u))},[s.createVNode(s.Transition,{name:"vac-bounce"},{default:s.withCtx(()=>[m.scrollMessagesCount?(s.openBlock(),s.createElementBlock("div",ru,s.toDisplayString(m.scrollMessagesCount),1)):s.createCommentVNode("",!0)]),_:1}),s.renderSlot(e.$slots,"scroll-icon",{},()=>[s.createVNode(g,{name:"dropdown",param:"scroll"})])])):s.createCommentVNode("",!0)]),_:3})])),s.createVNode(N,{room:n.room,"room-id":a.roomId,"room-message":a.roomMessage,"text-messages":a.textMessages,"show-send-icon":a.showSendIcon,"show-files":a.showFiles,"show-audio":a.showAudio,"show-emojis":a.showEmojis,"show-footer":a.showFooter,"accepted-files":a.acceptedFiles,"textarea-action-enabled":a.textareaActionEnabled,"textarea-auto-focus":a.textareaAutoFocus,"user-tags-enabled":a.userTagsEnabled,"emojis-suggestion-enabled":a.emojisSuggestionEnabled,"templates-text":a.templatesText,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"audio-bit-rate":a.audioBitRate,"audio-sample-rate":a.audioSampleRate,"init-reply-message":m.initReplyMessage,"init-edit-message":m.initEditMessage,onUpdateEditedMessageId:t[7]||(t[7]=u=>m.editedMessageId=u),onEditMessage:t[8]||(t[8]=u=>e.$emit("edit-message",u)),onSendMessage:t[9]||(t[9]=u=>e.$emit("send-message",u)),onTypingMessage:t[10]||(t[10]=u=>e.$emit("typing-message",u)),onTextareaActionHandler:t[11]||(t[11]=u=>e.$emit("textarea-action-handler",u))},s.createSlots({_:2},[s.renderList(e.$slots,(u,y)=>({name:y,fn:s.withCtx(k=>[s.renderSlot(e.$slots,y,s.normalizeProps(s.guardReactiveProps(k)))])}))]),1032,["room","room-id","room-message","text-messages","show-send-icon","show-files","show-audio","show-emojis","show-footer","accepted-files","textarea-action-enabled","textarea-auto-focus","user-tags-enabled","emojis-suggestion-enabled","templates-text","text-formatting","link-options","audio-bit-rate","audio-sample-rate","init-reply-message","init-edit-message"])],544)),[[s.vShow,a.isMobile&&!a.showRoomsList||!a.isMobile||a.singleRoom]])}var ou=Fe(Q_,[["render",nu]]);const iu={name:"MediaPreview",components:{SvgIcon:gt},props:{file:{type:Object,required:!0}},emits:["close-media-preview"],computed:{isImage(){return $a(this.file)},isVideo(){return Bs(this.file)}},mounted(){this.$refs.modal.focus()},methods:{closeModal(){this.$emit("close-media-preview")}}},lu={key:0,class:"vac-media-preview-container"},cu={key:1,class:"vac-media-preview-container"},du={width:"100%",height:"100%",controls:"",autoplay:""},mu=["src"],hu={class:"vac-svg-button"};function _u(e,t,a,o,m,n){const M=s.resolveComponent("svg-icon");return s.openBlock(),s.createElementBlock("div",{ref:"modal",tabindex:"0",class:"vac-media-preview",onClick:t[0]||(t[0]=s.withModifiers((...T)=>n.closeModal&&n.closeModal(...T),["stop"])),onKeydown:t[1]||(t[1]=s.withKeys((...T)=>n.closeModal&&n.closeModal(...T),["esc"]))},[s.createVNode(s.Transition,{name:"vac-bounce-preview",appear:""},{default:s.withCtx(()=>[n.isImage?(s.openBlock(),s.createElementBlock("div",lu,[s.createElementVNode("div",{class:"vac-image-preview",style:s.normalizeStyle({"background-image":`url('${a.file.url}')`})},null,4)])):n.isVideo?(s.openBlock(),s.createElementBlock("div",cu,[s.createElementVNode("video",du,[s.createElementVNode("source",{src:a.file.url},null,8,mu)])])):s.createCommentVNode("",!0)]),_:1}),s.createElementVNode("div",hu,[s.renderSlot(e.$slots,"preview-close-icon",{},()=>[s.createVNode(M,{name:"close-outline",param:"preview"})])])],544)}var uu=Fe(iu,[["render",_u]]),fu={ROOMS_EMPTY:"No rooms",ROOM_EMPTY:"No room selected",NEW_MESSAGES:"New Messages",MESSAGE_DELETED:"This message was deleted",MESSAGES_EMPTY:"No messages",CONVERSATION_STARTED:"Conversation started on:",TYPE_MESSAGE:"Type message",SEARCH:"Search",IS_ONLINE:"is online",LAST_SEEN:"last seen ",IS_TYPING:"is writing...",CANCEL_SELECT_MESSAGE:"Cancel"};const vu={light:{general:{color:"#0a0a0a",colorButtonClear:"#1976d2",colorButton:"#fff",backgroundColorButton:"#1976d2",backgroundInput:"#fff",colorPlaceholder:"#9ca6af",colorCaret:"#1976d2",colorSpinner:"#333",borderStyle:"1px solid #e1e4e8",backgroundScrollIcon:"#fff"},container:{border:"none",borderRadius:"4px",boxShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)"},header:{background:"#fff",colorRoomName:"#0a0a0a",colorRoomInfo:"#9ca6af"},footer:{background:"#f8f9fa",borderStyleInput:"1px solid #e1e4e8",borderInputSelected:"#1976d2",backgroundReply:"#e5e5e6",backgroundTagActive:"#e5e5e6",backgroundTag:"#f8f9fa"},content:{background:"#f8f9fa"},sidemenu:{background:"#fff",backgroundHover:"#f6f6f6",backgroundActive:"#e5effa",colorActive:"#1976d2",borderColorSearch:"#e1e5e8"},dropdown:{background:"#fff",backgroundHover:"#f6f6f6"},message:{background:"#fff",backgroundMe:"#ccf2cf",color:"#0a0a0a",colorStarted:"#9ca6af",backgroundDeleted:"#dadfe2",backgroundSelected:"#c2dcf2",colorDeleted:"#757e85",colorUsername:"#9ca6af",colorTimestamp:"#828c94",backgroundDate:"#e5effa",colorDate:"#505a62",backgroundSystem:"#e5effa",colorSystem:"#505a62",backgroundMedia:"rgba(0, 0, 0, 0.15)",backgroundReply:"rgba(0, 0, 0, 0.08)",colorReplyUsername:"#0a0a0a",colorReply:"#6e6e6e",colorTag:"#0d579c",backgroundImage:"#ddd",colorNewMessages:"#1976d2",backgroundScrollCounter:"#0696c7",colorScrollCounter:"#fff",backgroundReaction:"#eee",borderStyleReaction:"1px solid #eee",backgroundReactionHover:"#fff",borderStyleReactionHover:"1px solid #ddd",colorReactionCounter:"#0a0a0a",backgroundReactionMe:"#cfecf5",borderStyleReactionMe:"1px solid #3b98b8",backgroundReactionHoverMe:"#cfecf5",borderStyleReactionHoverMe:"1px solid #3b98b8",colorReactionCounterMe:"#0b59b3",backgroundAudioRecord:"#eb4034",backgroundAudioLine:"rgba(0, 0, 0, 0.15)",backgroundAudioProgress:"#455247",backgroundAudioProgressSelector:"#455247",colorFileExtension:"#757e85"},markdown:{background:"rgba(239, 239, 239, 0.7)",border:"rgba(212, 212, 212, 0.9)",color:"#e01e5a",colorMulti:"#0a0a0a"},room:{colorUsername:"#0a0a0a",colorMessage:"#67717a",colorTimestamp:"#a2aeb8",colorStateOnline:"#4caf50",colorStateOffline:"#9ca6af",backgroundCounterBadge:"#0696c7",colorCounterBadge:"#fff"},emoji:{background:"#fff"},icons:{search:"#9ca6af",add:"#1976d2",toggle:"#0a0a0a",menu:"#0a0a0a",close:"#9ca6af",closeImage:"#fff",file:"#1976d2",paperclip:"#1976d2",closeOutline:"#000",closePreview:"#fff",send:"#1976d2",sendDisabled:"#9ca6af",emoji:"#1976d2",emojiReaction:"rgba(0, 0, 0, 0.3)",document:"#1976d2",pencil:"#9e9e9e",checkmark:"#9e9e9e",checkmarkSeen:"#0696c7",eye:"#fff",dropdownMessage:"#fff",dropdownMessageBackground:"rgba(0, 0, 0, 0.25)",dropdownRoom:"#9e9e9e",dropdownScroll:"#0a0a0a",microphone:"#1976d2",audioPlay:"#455247",audioPause:"#455247",audioCancel:"#eb4034",audioConfirm:"#1ba65b"}},dark:{general:{color:"#fff",colorButtonClear:"#fff",colorButton:"#fff",backgroundColorButton:"#1976d2",backgroundInput:"#202223",colorPlaceholder:"#596269",colorCaret:"#fff",colorSpinner:"#fff",borderStyle:"none",backgroundScrollIcon:"#fff"},container:{border:"none",borderRadius:"4px",boxShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)"},header:{background:"#181a1b",colorRoomName:"#fff",colorRoomInfo:"#9ca6af"},footer:{background:"#131415",borderStyleInput:"none",borderInputSelected:"#1976d2",backgroundReply:"#1b1c1c",backgroundTagActive:"#1b1c1c",backgroundTag:"#131415"},content:{background:"#131415"},sidemenu:{background:"#181a1b",backgroundHover:"#202224",backgroundActive:"#151617",colorActive:"#fff",borderColorSearch:"#181a1b"},dropdown:{background:"#2a2c33",backgroundHover:"#26282e"},message:{background:"#22242a",backgroundMe:"#1f7e80",color:"#fff",colorStarted:"#9ca6af",backgroundDeleted:"#1b1c21",backgroundSelected:"#c2dcf2",colorDeleted:"#a2a5a8",colorUsername:"#b3bac9",colorTimestamp:"#ebedf2",backgroundDate:"rgba(0, 0, 0, 0.3)",colorDate:"#bec5cc",backgroundSystem:"rgba(0, 0, 0, 0.3)",colorSystem:"#bec5cc",backgroundMedia:"rgba(0, 0, 0, 0.18)",backgroundReply:"rgba(0, 0, 0, 0.18)",colorReplyUsername:"#fff",colorReply:"#d6d6d6",colorTag:"#f0c60a",backgroundImage:"#ddd",colorNewMessages:"#fff",backgroundScrollCounter:"#1976d2",colorScrollCounter:"#fff",backgroundReaction:"none",borderStyleReaction:"none",backgroundReactionHover:"#202223",borderStyleReactionHover:"none",colorReactionCounter:"#fff",backgroundReactionMe:"#4e9ad1",borderStyleReactionMe:"none",backgroundReactionHoverMe:"#4e9ad1",borderStyleReactionHoverMe:"none",colorReactionCounterMe:"#fff",backgroundAudioRecord:"#eb4034",backgroundAudioLine:"rgba(255, 255, 255, 0.15)",backgroundAudioProgress:"#b7d4d3",backgroundAudioProgressSelector:"#b7d4d3",colorFileExtension:"#a2a5a8"},markdown:{background:"rgba(239, 239, 239, 0.7)",border:"rgba(212, 212, 212, 0.9)",color:"#e01e5a",colorMulti:"#0a0a0a"},room:{colorUsername:"#fff",colorMessage:"#6c7278",colorTimestamp:"#6c7278",colorStateOnline:"#4caf50",colorStateOffline:"#596269",backgroundCounterBadge:"#1976d2",colorCounterBadge:"#fff"},emoji:{background:"#343740"},icons:{search:"#596269",add:"#fff",toggle:"#fff",menu:"#fff",close:"#9ca6af",closeImage:"#fff",file:"#1976d2",paperclip:"#fff",closeOutline:"#fff",closePreview:"#fff",send:"#fff",sendDisabled:"#646a70",emoji:"#fff",emojiReaction:"#fff",document:"#1976d2",pencil:"#ebedf2",checkmark:"#ebedf2",checkmarkSeen:"#f0d90a",eye:"#fff",dropdownMessage:"#fff",dropdownMessageBackground:"rgba(0, 0, 0, 0.25)",dropdownRoom:"#fff",dropdownScroll:"#0a0a0a",microphone:"#fff",audioPlay:"#b7d4d3",audioPause:"#b7d4d3",audioCancel:"#eb4034",audioConfirm:"#1ba65b"}}},gu=({general:e,container:t,header:a,footer:o,sidemenu:m,content:n,dropdown:M,message:T,markdown:O,room:g,emoji:N,icons:u})=>({"--chat-color":e.color,"--chat-color-button-clear":e.colorButtonClear,"--chat-color-button":e.colorButton,"--chat-bg-color-button":e.backgroundColorButton,"--chat-bg-color-input":e.backgroundInput,"--chat-color-spinner":e.colorSpinner,"--chat-color-placeholder":e.colorPlaceholder,"--chat-color-caret":e.colorCaret,"--chat-border-style":e.borderStyle,"--chat-bg-scroll-icon":e.backgroundScrollIcon,"--chat-container-border":t.border,"--chat-container-border-radius":t.borderRadius,"--chat-container-box-shadow":t.boxShadow,"--chat-header-bg-color":a.background,"--chat-header-color-name":a.colorRoomName,"--chat-header-color-info":a.colorRoomInfo,"--chat-footer-bg-color":o.background,"--chat-border-style-input":o.borderStyleInput,"--chat-border-color-input-selected":o.borderInputSelected,"--chat-footer-bg-color-reply":o.backgroundReply,"--chat-footer-bg-color-tag-active":o.backgroundTagActive,"--chat-footer-bg-color-tag":o.backgroundTag,"--chat-content-bg-color":n.background,"--chat-sidemenu-bg-color":m.background,"--chat-sidemenu-bg-color-hover":m.backgroundHover,"--chat-sidemenu-bg-color-active":m.backgroundActive,"--chat-sidemenu-color-active":m.colorActive,"--chat-sidemenu-border-color-search":m.borderColorSearch,"--chat-dropdown-bg-color":M.background,"--chat-dropdown-bg-color-hover":M.backgroundHover,"--chat-message-bg-color":T.background,"--chat-message-bg-color-me":T.backgroundMe,"--chat-message-color-started":T.colorStarted,"--chat-message-bg-color-deleted":T.backgroundDeleted,"--chat-message-bg-color-selected":T.backgroundSelected,"--chat-message-color-deleted":T.colorDeleted,"--chat-message-color-username":T.colorUsername,"--chat-message-color-timestamp":T.colorTimestamp,"--chat-message-bg-color-date":T.backgroundDate,"--chat-message-color-date":T.colorDate,"--chat-message-bg-color-system":T.backgroundSystem,"--chat-message-color-system":T.colorSystem,"--chat-message-color":T.color,"--chat-message-bg-color-media":T.backgroundMedia,"--chat-message-bg-color-reply":T.backgroundReply,"--chat-message-color-reply-username":T.colorReplyUsername,"--chat-message-color-reply-content":T.colorReply,"--chat-message-color-tag":T.colorTag,"--chat-message-bg-color-image":T.backgroundImage,"--chat-message-color-new-messages":T.colorNewMessages,"--chat-message-bg-color-scroll-counter":T.backgroundScrollCounter,"--chat-message-color-scroll-counter":T.colorScrollCounter,"--chat-message-bg-color-reaction":T.backgroundReaction,"--chat-message-border-style-reaction":T.borderStyleReaction,"--chat-message-bg-color-reaction-hover":T.backgroundReactionHover,"--chat-message-border-style-reaction-hover":T.borderStyleReactionHover,"--chat-message-color-reaction-counter":T.colorReactionCounter,"--chat-message-bg-color-reaction-me":T.backgroundReactionMe,"--chat-message-border-style-reaction-me":T.borderStyleReactionMe,"--chat-message-bg-color-reaction-hover-me":T.backgroundReactionHoverMe,"--chat-message-border-style-reaction-hover-me":T.borderStyleReactionHoverMe,"--chat-message-color-reaction-counter-me":T.colorReactionCounterMe,"--chat-message-bg-color-audio-record":T.backgroundAudioRecord,"--chat-message-bg-color-audio-line":T.backgroundAudioLine,"--chat-message-bg-color-audio-progress":T.backgroundAudioProgress,"--chat-message-bg-color-audio-progress-selector":T.backgroundAudioProgressSelector,"--chat-message-color-file-extension":T.colorFileExtension,"--chat-markdown-bg":O.background,"--chat-markdown-border":O.border,"--chat-markdown-color":O.color,"--chat-markdown-color-multi":O.colorMulti,"--chat-room-color-username":g.colorUsername,"--chat-room-color-message":g.colorMessage,"--chat-room-color-timestamp":g.colorTimestamp,"--chat-room-color-online":g.colorStateOnline,"--chat-room-color-offline":g.colorStateOffline,"--chat-room-bg-color-badge":g.backgroundCounterBadge,"--chat-room-color-badge":g.colorCounterBadge,"--chat-emoji-bg-color":N.background,"--chat-icon-color-search":u.search,"--chat-icon-color-add":u.add,"--chat-icon-color-toggle":u.toggle,"--chat-icon-color-menu":u.menu,"--chat-icon-color-close":u.close,"--chat-icon-color-close-image":u.closeImage,"--chat-icon-color-file":u.file,"--chat-icon-color-paperclip":u.paperclip,"--chat-icon-color-close-outline":u.closeOutline,"--chat-icon-color-close-preview":u.closePreview,"--chat-icon-color-send":u.send,"--chat-icon-color-send-disabled":u.sendDisabled,"--chat-icon-color-emoji":u.emoji,"--chat-icon-color-emoji-reaction":u.emojiReaction,"--chat-icon-color-document":u.document,"--chat-icon-color-pencil":u.pencil,"--chat-icon-color-checkmark":u.checkmark,"--chat-icon-color-checkmark-seen":u.checkmarkSeen,"--chat-icon-color-eye":u.eye,"--chat-icon-color-dropdown-message":u.dropdownMessage,"--chat-icon-bg-dropdown-message":u.dropdownMessageBackground,"--chat-icon-color-dropdown-room":u.dropdownRoom,"--chat-icon-color-dropdown-scroll":u.dropdownScroll,"--chat-icon-color-microphone":u.microphone,"--chat-icon-color-audio-play":u.audioPlay,"--chat-icon-color-audio-pause":u.audioPause,"--chat-icon-color-audio-cancel":u.audioCancel,"--chat-icon-color-audio-confirm":u.audioConfirm});var Ru="";const pu={name:"ChatContainer",components:{RoomsList:T1,Room:ou,MediaPreview:uu},props:{height:{type:String,default:"600px"},theme:{type:String,default:"light"},styles:{type:Object,default:()=>({})},responsiveBreakpoint:{type:Number,default:900},singleRoom:{type:Boolean,default:!1},roomsListOpened:{type:Boolean,default:!0},textMessages:{type:Object,default:null},currentUserId:{type:[String,Number],default:""},rooms:{type:Array,default:()=>[]},roomsOrder:{type:String,default:"desc"},loadingRooms:{type:Boolean,default:!1},roomsLoaded:{type:Boolean,default:!1},roomId:{type:[String,Number],default:null},loadFirstRoom:{type:Boolean,default:!0},messages:{type:Array,default:()=>[]},messagesLoaded:{type:Boolean,default:!1},roomActions:{type:Array,default:()=>[]},menuActions:{type:Array,default:()=>[]},messageActions:{type:Array,default:()=>[{name:"replyMessage",title:"Reply"},{name:"editMessage",title:"Edit Message",onlyMe:!0},{name:"deleteMessage",title:"Delete Message",onlyMe:!0},{name:"selectMessages",title:"Select"}]},messageSelectionActions:{type:Array,default:()=>[]},autoScroll:{type:Object,default:()=>({send:{new:!0,newAfterScrollUp:!0},receive:{new:!0,newAfterScrollUp:!1}})},showSearch:{type:Boolean,default:!0},showAddRoom:{type:Boolean,default:!0},showSendIcon:{type:Boolean,default:!0},showFiles:{type:Boolean,default:!0},showAudio:{type:Boolean,default:!0},audioBitRate:{type:Number,default:128},audioSampleRate:{type:Number,default:44100},showEmojis:{type:Boolean,default:!0},showReactionEmojis:{type:Boolean,default:!0},showNewMessagesDivider:{type:Boolean,default:!0},showFooter:{type:Boolean,default:!0},textFormatting:{type:Object,default:()=>({disabled:!1,italic:"_",bold:"*",strike:"~",underline:"\xB0",multilineCode:"```",inlineCode:"`"})},linkOptions:{type:Object,default:()=>({disabled:!1,target:"_blank",rel:null})},roomInfoEnabled:{type:Boolean,default:!1},textareaActionEnabled:{type:Boolean,default:!1},textareaAutoFocus:{type:Boolean,default:!0},userTagsEnabled:{type:Boolean,default:!0},emojisSuggestionEnabled:{type:Boolean,default:!0},roomMessage:{type:String,default:""},scrollDistance:{type:Number,default:60},acceptedFiles:{type:String,default:"*"},templatesText:{type:Array,default:null},mediaPreviewEnabled:{type:Boolean,default:!0},usernameOptions:{type:Object,default:()=>({minUsers:3,currentUser:!1})}},emits:["toggle-rooms-list","room-info","fetch-messages","send-message","edit-message","delete-message","open-file","open-user-tag","open-failed-message","menu-action-handler","message-action-handler","send-message-reaction","typing-message","textarea-action-handler","fetch-more-rooms","add-room","room-action-handler","message-selection-action-handler"],data(){return{room:{},loadingMoreRooms:!1,showRoomsList:!0,isMobile:!1,showMediaPreview:!1,previewFile:{}}},computed:{t(){return{...fu,...this.textMessages}},cssVars(){const e=vu[this.theme],t={};return Object.keys(e).map(a=>{t[a]={...e[a],...this.styles[a]||{}}}),gu(t)},orderedRooms(){return this.rooms.slice().sort((e,t)=>{const a=e.index||0,o=t.index||0;return this.roomsOrder==="asc"?a<o?-1:o<a?1:0:a>o?-1:o>a?1:0})}},watch:{rooms:{immediate:!0,deep:!0,handler(e,t){if((!e[0]||!e.find(a=>a.roomId===this.room.roomId))&&(this.showRoomsList=!0),!this.loadingMoreRooms&&this.loadFirstRoom&&e[0]&&(!t||e.length!==t.length))if(this.roomId){const a=e.find(o=>o.roomId===this.roomId)||{};this.fetchRoom({room:a})}else!this.isMobile||this.singleRoom?this.fetchRoom({room:this.orderedRooms[0]}):this.showRoomsList=!0}},loadingRooms(e){e&&(this.room={})},roomId:{immediate:!0,handler(e,t){if(e&&!this.loadingRooms&&this.rooms.length){const a=this.rooms.find(o=>o.roomId===e);this.fetchRoom({room:a})}else t&&!e&&(this.room={})}},room(e){!e||Object.entries(e).length===0||(L_(e),e.users.forEach(t=>{N_(t)}))},roomsListOpened(e){this.showRoomsList=e}},created(){this.updateResponsive(),window.addEventListener("resize",e=>{e.isTrusted&&this.updateResponsive()})},methods:{updateResponsive(){this.isMobile=window.innerWidth<this.responsiveBreakpoint},toggleRoomsList(){this.showRoomsList=!this.showRoomsList,this.isMobile&&(this.room={}),this.$emit("toggle-rooms-list",{opened:this.showRoomsList})},fetchRoom({room:e}){this.room=e,this.fetchMessages({reset:!0}),this.isMobile&&(this.showRoomsList=!1)},fetchMoreRooms(){this.$emit("fetch-more-rooms")},roomInfo(){this.$emit("room-info",this.room)},addRoom(){this.$emit("add-room")},fetchMessages(e){this.$emit("fetch-messages",{room:this.room,options:e})},sendMessage(e){this.$emit("send-message",{...e,roomId:this.room.roomId})},editMessage(e){this.$emit("edit-message",{...e,roomId:this.room.roomId})},deleteMessage(e){this.$emit("delete-message",{message:e,roomId:this.room.roomId})},openFile({message:e,file:t}){this.mediaPreviewEnabled&&t.action==="preview"?(this.previewFile=t.file,this.showMediaPreview=!0):this.$emit("open-file",{message:e,file:t})},openUserTag({user:e}){this.$emit("open-user-tag",{user:e})},openFailedMessage({message:e}){this.$emit("open-failed-message",{message:e,roomId:this.room.roomId})},menuActionHandler(e){this.$emit("menu-action-handler",{action:e,roomId:this.room.roomId})},roomActionHandler({action:e,roomId:t}){this.$emit("room-action-handler",{action:e,roomId:t})},messageActionHandler(e){this.$emit("message-action-handler",{...e,roomId:this.room.roomId})},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",{...e,roomId:this.room.roomId})},sendMessageReaction(e){this.$emit("send-message-reaction",{...e,roomId:this.room.roomId})},typingMessage(e){this.$emit("typing-message",{message:e,roomId:this.room.roomId})},textareaActionHandler(e){this.$emit("textarea-action-handler",{message:e,roomId:this.room.roomId})}}},bu={class:"vac-chat-container"};function yu(e,t,a,o,m,n){const M=s.resolveComponent("rooms-list"),T=s.resolveComponent("room"),O=s.resolveComponent("media-preview");return s.openBlock(),s.createElementBlock("div",{class:"vac-card-window",style:s.normalizeStyle([{height:a.height},n.cssVars])},[s.createElementVNode("div",bu,[a.singleRoom?s.createCommentVNode("",!0):(s.openBlock(),s.createBlock(M,{key:0,"current-user-id":a.currentUserId,rooms:n.orderedRooms,"loading-rooms":a.loadingRooms,"rooms-loaded":a.roomsLoaded,room:m.room,"room-actions":a.roomActions,"text-messages":n.t,"show-search":a.showSearch,"show-add-room":a.showAddRoom,"show-rooms-list":m.showRoomsList,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"is-mobile":m.isMobile,"scroll-distance":a.scrollDistance,onFetchRoom:n.fetchRoom,onFetchMoreRooms:n.fetchMoreRooms,onLoadingMoreRooms:t[0]||(t[0]=g=>m.loadingMoreRooms=g),onAddRoom:n.addRoom,onRoomActionHandler:n.roomActionHandler},s.createSlots({_:2},[s.renderList(e.$slots,(g,N)=>({name:N,fn:s.withCtx(u=>[s.renderSlot(e.$slots,N,s.normalizeProps(s.guardReactiveProps(u)))])}))]),1032,["current-user-id","rooms","loading-rooms","rooms-loaded","room","room-actions","text-messages","show-search","show-add-room","show-rooms-list","text-formatting","link-options","is-mobile","scroll-distance","onFetchRoom","onFetchMoreRooms","onAddRoom","onRoomActionHandler"])),s.createVNode(T,{"current-user-id":a.currentUserId,rooms:a.rooms,"room-id":m.room.roomId||"","load-first-room":a.loadFirstRoom,messages:a.messages,"room-message":a.roomMessage,"messages-loaded":a.messagesLoaded,"menu-actions":a.menuActions,"message-actions":a.messageActions,"message-selection-actions":a.messageSelectionActions,"auto-scroll":a.autoScroll,"show-send-icon":a.showSendIcon,"show-files":a.showFiles,"show-audio":a.showAudio,"audio-bit-rate":a.audioBitRate,"audio-sample-rate":a.audioSampleRate,"show-emojis":a.showEmojis,"show-reaction-emojis":a.showReactionEmojis,"show-new-messages-divider":a.showNewMessagesDivider,"show-footer":a.showFooter,"text-messages":n.t,"single-room":a.singleRoom,"show-rooms-list":m.showRoomsList,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"is-mobile":m.isMobile,"loading-rooms":a.loadingRooms,"room-info-enabled":a.roomInfoEnabled,"textarea-action-enabled":a.textareaActionEnabled,"textarea-auto-focus":a.textareaAutoFocus,"user-tags-enabled":a.userTagsEnabled,"emojis-suggestion-enabled":a.emojisSuggestionEnabled,"scroll-distance":a.scrollDistance,"accepted-files":a.acceptedFiles,"templates-text":a.templatesText,"username-options":a.usernameOptions,onToggleRoomsList:n.toggleRoomsList,onRoomInfo:n.roomInfo,onFetchMessages:n.fetchMessages,onSendMessage:n.sendMessage,onEditMessage:n.editMessage,onDeleteMessage:n.deleteMessage,onOpenFile:n.openFile,onOpenUserTag:n.openUserTag,onOpenFailedMessage:n.openFailedMessage,onMenuActionHandler:n.menuActionHandler,onMessageActionHandler:n.messageActionHandler,onMessageSelectionActionHandler:n.messageSelectionActionHandler,onSendMessageReaction:n.sendMessageReaction,onTypingMessage:n.typingMessage,onTextareaActionHandler:n.textareaActionHandler},s.createSlots({_:2},[s.renderList(e.$slots,(g,N)=>({name:N,fn:s.withCtx(u=>[s.renderSlot(e.$slots,N,s.normalizeProps(s.guardReactiveProps(u)))])}))]),1032,["current-user-id","rooms","room-id","load-first-room","messages","room-message","messages-loaded","menu-actions","message-actions","message-selection-actions","auto-scroll","show-send-icon","show-files","show-audio","audio-bit-rate","audio-sample-rate","show-emojis","show-reaction-emojis","show-new-messages-divider","show-footer","text-messages","single-room","show-rooms-list","text-formatting","link-options","is-mobile","loading-rooms","room-info-enabled","textarea-action-enabled","textarea-auto-focus","user-tags-enabled","emojis-suggestion-enabled","scroll-distance","accepted-files","templates-text","username-options","onToggleRoomsList","onRoomInfo","onFetchMessages","onSendMessage","onEditMessage","onDeleteMessage","onOpenFile","onOpenUserTag","onOpenFailedMessage","onMenuActionHandler","onMessageActionHandler","onMessageSelectionActionHandler","onSendMessageReaction","onTypingMessage","onTextareaActionHandler"])]),s.createVNode(s.Transition,{name:"vac-fade-preview",appear:""},{default:s.withCtx(()=>[m.showMediaPreview?(s.openBlock(),s.createBlock(O,{key:0,file:m.previewFile,onCloseMediaPreview:t[1]||(t[1]=g=>m.showMediaPreview=!1)},null,8,["file"])):s.createCommentVNode("",!0)]),_:1})],4)}var Hn=Fe(pu,[["render",yu]]);return Object.defineProperty(Hn,"install",{configurable:!1,enumerable:!1,value(e){e.component("ChatWindow",Hn)}}),Hn});
